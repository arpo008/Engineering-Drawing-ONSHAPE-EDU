// 22.04.2025 by Graebert GmbH Copyright 2014 Graebert GmbH
function getGoogleAnalytics(){return window.googleAnalyticsService||googleAnalyticsServiceDummy}(()=>{function t(e,t){var i=t.m_CommandGlobalName,r=t.m_CommandStarted,t=!r&&2<=t.m_CommandCounter-e.m_CommandCounter;(r||t)&&getGoogleAnalytics().trackEvent("EDITOR","COMMAND",i)}document.addEventListener("PreUpdate_XeCommandProcessor",function(e){t.states.prev=e.m_Item.copy()}),document.addEventListener("Update_XeCommandProcessor",function(e){t.states.current=e.m_Item.copy(),t(t.states.prev,t.states.current)}),t.states={prev:{},current:{}};let a={},s={timestamp:(new Date).getTime(),bPan:!1,fpsMesuarmentsArray:[],avgPan:0},c={bytes:0};document.addEventListener("XeDocument_SSR_Updated",function(e){"STARTUP"===e.m_Key&&(e=window.getXeActiveDocument())&&(getGoogleAnalytics().trackEvent("EDITOR","PERFORMANCE_OPEN",e.m_FileId,e.m_STARTUP_TIME),getGoogleAnalytics().trackEvent("EDITOR_SESSION",e.m_UserId,e.m_FileId))}),document.addEventListener("XeWebDrawerEngine.setPan",function(e){e=e.data;let r=getGoogleAnalytics.localDebug?console.log:function(){};if(s.bPan!=e.bPan){var n=(new Date).getTime()-s.timestamp;s.timestamp=(new Date).getTime();let t=window.getXeApplication().getDrawingEngine(),i=(s.bPan=e.bPan,s.handleTimeout&&clearTimeout(s.handleTimeout),s.handleInterval&&clearTimeout(s.handleInterval),s.handleTimeout=0,s.handleInterval=0,s.fpsMesuarmentsArray);if(0<i.length){let t=0;for(let e=0;e<i.length;e++)t+=i[e];s.avgPan=t/i.length}if(500<i.length&&(s.fpsMesuarmentsArray=[],i=s.fpsMesuarmentsArray),s.bPan)r("XePerfStat wait for collecting pan data .... "),s.handleTimeout=setTimeout(()=>{r("XePerfStat start collecting pan data .... "),s.handleInterval=setInterval(()=>{r("XePerfStat collecting pan data .... ");var e=t.getStats();e&&(e=e.getCurrentFPS(),i.push(e))},200)},200);else{for(var o in r("FPS average : "+s.avgPan.toFixed(2)+" frame per second"),a)r("glDrawCountInfo."+o+" => "+a[o]);r("Downloaded data : "+(c.bytes/1048576).toFixed(2)+" Mb"),150<n&&s.avgPan<13&&getGoogleAnalytics().trackEvent("EDITOR","PERFORMANCE_WARNING","FPS",Math.floor(s.avgPan))}}},!1),document.addEventListener("XeWebGlRendererInitEvent",function(e){e.data},!1),document.addEventListener("XeGLDrawCountInfoEvent",function(e){var t,i,r=e.data;for(t in a.gl_memory_summ=0,a.gl_draw_calls=0,a.gl_points=0,a.gl_lines=0,a.gl_triangles=0,a.gl_instanced_points=0,a.gl_instanced_lines=0,a.gl_instanced_triangles=0,r)r.hasOwnProperty(t)&&(i=r[t])&&(a.gl_memory_summ+=i.gl_attr_mem_used+i.gl_unif_mem_used,a.gl_draw_calls+=i.gldrawcalls,a.gl_points+=i.points,a.gl_lines+=i.lines,a.gl_triangles+=i.triangles,a.gl_instanced_points+=i.instanced_points,a.gl_instanced_lines+=i.instanced_lines,a.gl_instanced_triangles+=i.instanced_triangles)},!1),document.addEventListener("WT_WS_DATAIN_LOG",function(e){c.bytes+=e.data.bytes},!1)})(),getGoogleAnalytics.localDebug=!1;let googleAnalyticsServiceDummy={trackPageView:function(e){getGoogleAnalytics.localDebug&&window.XeLogger.log(e)},trackEvent:function(e,t,i,r){getGoogleAnalytics.localDebug&&window.XeLogger.log(e,t,i,r)}},GoogleAnalyticsService=function(t,e){let i=this,r=e;i.trackPageView=function(e){var t;window.ga&&((t=document.location.pathname).split("&"),window.ga("send","pageview",t))},i.trackEvent=function(e,t,i,r){var n;window.ds_event?(n={event:"clic",event_category:e,event_action:t,event_name:i},void 0!==r&&(n.event_value=r),window.ds_event("this","clic",n)):window.ga&&window.ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:i,eventValue:r})},i.onInit=function(){};{let e=t;uploadSriptPromise(e=e?e:("https:"===document.location.protocol?"https://":"http://")+"www.google-analytics.com/analytics.js",!0,!1).then(e=>{if(window.ds_init_add_script){let e=setInterval(()=>{window.ds_event&&(clearInterval(e),window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("LOG_G_ANALYTICS")&&window.XeLogger.log(" <<<<<<<<<<<<<<<<<< DS Analitics loaded, and inited >>>>>>>>>>>>>>>>>"),i.trackPageView(),i.onInit())},70)}else window.ga?window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("LOG_G_ANALYTICS")&&window.XeLogger.log(" <<<<<<<<<<<<<<<<<< GoogleAnalitics loaded, and inited >>>>>>>>>>>>>>>>>"):(window.ga=function(){},window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("LOG_G_ANALYTICS")&&window.XeLogger.error(" <<<<<<<<<<<<<<<<<< GoogleAnalitics loaded, but failed to init ! >>>>>>>>>>>>>>>>>")),window.ga.l=Date.now(),window.ga("create",r,"auto"),i.trackPageView(),i.onInit()},()=>{window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("LOG_G_ANALYTICS")&&window.XeLogger.error(" <<<<<<<<<<<<<<<<<< GoogleAnalitics failed to load ! >>>>>>>>>>>>>>>>>")})}},GoogleAnalyticsService_iFrame=function(){let e=this;e.trackPageView=function(){var e;window!==window.parent&&(document.location.pathname,e={messageName:"google-analytics-data",hitType:"pageview",components:document.location.pathname},window.parent.postMessage(e,"*"))},e.trackEvent=function(e,t,i,r){window!==window.parent&&window.parent.postMessage({messageName:"google-analytics-data",hitType:"event",eventCategory:e,eventAction:t,eventLabel:i,eventValue:r},"*")},e.onInit=function(){},e.trackPageView(),e.onInit()};window.Wt.WT.PE.add("WPopupMenu",null,function(n,e){let o=e[1];e=e[1].attributes[1].value;let t;n.onDocumentKeyDown=function(e){var t=document.activeElement,t=/INPUT|SELECT|TEXTAREA/i.test(t.tagName)&&!t.disabled&&!t.readOnly&&!t.xeAllowFireShortCuts;if(!t&&n.stillExist())switch(e.keyCode){case 27:n.doHide();break;case 38:var i=$("#"+o.id).children(".active"),r=n.previousActiveElement(i);i.removeClass("active"),r.addClass("active"),n.scrollToSelected(r);break;case 40:i=$("#"+o.id).children(".active"),r=n.nextActiveElement(i);i.removeClass("active"),r.addClass("active"),n.scrollToSelected(r);break;case 13:i=$("#"+o.id+" .active > a");null!=i&&(i.click(),e.preventDefault(),e.stopPropagation())}},"ASContextMenudata"===e&&(t=setTimeout(function(){document.activeElement!==n&&n.doHide()},800),n.mouseEnter=function(e){t&&(clearTimeout(t),t=null),o.style.display="block"},o.addEventListener("mousemove",function(){t&&(clearTimeout(t),t=null)})),n.scrollToSelected=function(e){var t,e=e[0];e&&(t=e.parentNode)&&(e.offsetTop+e.offsetHeight>t.scrollTop+t.clientHeight?t.scrollTop=e.offsetTop+e.offsetHeight-t.clientHeight:e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop))}}),window.Wt.WT.PE.add("WSpinBox",null,function(s,e){let r=e[1],t=r.id;var n=e[2],i=e[3],o=e[4],c=e[5],l=e[6],a=e[7],d=e[8],u=e[9],p=e[0].WT,m=new UnitsFormatter,h={UT_LENGTH:0,UT_ANGLE:1,UT_REAL:2,UT_ORIENT:3};function g(){var e,t=r.value;return(t=("string"!=typeof(e=t)||e.trim())&&null!=e?t:"0").substr(0,i.length)==i&&(t=t.substr(i.length)).length>o.length&&t.substr(t.length-o.length,o.length)==o?(t=t.substr(0,t.length-o.length),t=(t=u?t.split(u).join(""):t).replace(d,"."),Number((e=>{var t,i=e,r=window.getXeActiveDocument();switch(r.getXeDatabase().getLUNITS()<4&&(i=i.replace(/[ ]/g,"")),s.m_unitType){case h.UT_LENGTH:t=m.StringToReal(r,i,!1);break;case h.UT_REAL:t=m.StringToReal(r,i,!0);break;case h.UT_ANGLE:t=m.StringToAngle(r,i,s.m_iUnit,0,!0),0<i.length&&"-"==i.charAt(0)&&(t-=m.getOda2PIinRad());break;case h.UT_ORIENT:t=m.StringToOrient(r,i,s.m_iUnit),0<i.length&&"-"==i.charAt(0)&&(t-=m.getOda2PIinRad())}return t})(t))):null}function y(e){l<e?e=l:e<c&&(e=c);e=(e=>{var t,i=window.getXeActiveDocument();switch(s.m_unitType){case h.UT_LENGTH:t=s.m_onlyIntValue?m.IntToString(i,e):m.RealToString(i,e,s.m_iUnit,n);break;case h.UT_REAL:t=m.RealToString(i,e,2,n,-1);break;case h.UT_ANGLE:var r=s.getAUnits();-1!=s.m_iUnit&&(r=s.m_iUnit),t=m.formatAngle(i,r,e,n,-1,!0);break;case h.UT_ORIENT:t=m.formatOrientation(e,s.m_iUnit,n,-1);break;default:t="undefined"}return t})(e);r.value=i+e+o,s.changed=!0}s.applyPE=function(){console.log("WSpinBox::applyPE called of "+t+" ; by PE")},s.m_unitType=null,s.m_onlyIntValue=!1,s.m_useCustomAUnits=!1,s.m_customAUnits=0,s.m_iUnit=-1,s.setUnitType=function(e){s.m_unitType=e},s.getUnitType=function(){return s.m_unitType},s.setOnlyIntValue=function(e){s.m_onlyIntValue=e},s.getOnlyIntValue=function(){return s.m_onlyIntValue},s.setUseCustomAUnits=function(e){s.m_useCustomAUnits=e},s.getUseCustomAUnits=function(){return s.m_useCustomAUnits},s.setCustomAUnits=function(e){s.m_customAUnits=e},s.setUseOnlyPoints=function(e){s.m_iUnit=e?2:-1},s.setPrecision=function(e){n=e},s.getAUnits=function(){return s.m_useCustomAUnits?s.m_customAUnits:window.getXeActiveDocument().getXeDatabase().getAUNITS()},s.getUnitTypeStr=function(){var e;switch(s.m_unitType){case h.UT_LENGTH:e="UT_LENGTH";break;case h.UT_ANGLE:e="UT_ANGLE";break;case h.UT_REAL:e="UT_REAL";break;case h.UT_ORIENT:e="UT_ORIENT";break;default:e="undefined"}return e},s.base_validate=s.validate.bind(s),s.base_mouseDown=s.mouseDown.bind(s),s.base_configure=s.configure.bind(s),s.base_mouseMove=s.mouseMove.bind(s),s.base_inc=s.inc.bind(s),s.base_dec=s.dec.bind(s),s.setupCustomUnitSpinBox=function(e){s.unitType=e,s.configure(n,i,o,c,l,a)},s.configure=function(e,t,i,r,n,o){s.base_configure(e,t,i,r,n,o)},s.inc=function(){var e;null===s.m_unitType?s.base_inc():null===(e=g())||isNaN(e)||y(e+=a)},s.dec=function(){var e;null===s.m_unitType?s.base_dec():null===(e=g())||isNaN(e)||y(e-=a)},s.mouseMove=function(e,t){null===s.m_unitType?s.base_mouseMove(e,t):s.isReadOnly()||s.dragStartXY||(e=p.widgetCoordinates(r,t),(r.classList.contains(s.CLASS_DOWN)||r.classList.contains(s.CLASS_UP))&&r.classList.remove(s.CLASS_DOWN).remove(s.CLASS_UP),t=r.offsetWidth-72,e.x>t?r.style.cursor="pointer":r.style.cursor="text")},s.mouseDown=function(e,t){var i;null===s.m_unitType?s.base_mouseDown(e,t):(p.capture(null),s.isReadOnly()||(e=p.widgetCoordinates(r,t),i=r.offsetWidth-72,e.x>i&&(p.cancelEvent(t),p.capture(r),r.classList.add(s.CLASS_UNSELECTABLE),e.x<36+i?p.eventRepeat(function(){s.dec()}):p.eventRepeat(function(){s.inc()}))))},s.validate=function(e,t,i,r,n,o){var a;if(null!==s.m_unitType)return 0==e.length?t?{valid:!1,message:o}:{valid:!0}:e.trim()?null==(t=g())||isNaN(t)?{valid:!1,message:i}:(t=Number(t.toFixed(10)),i=Number(c.toFixed(10)),a=Number(l.toFixed(10)),null!==c&&t<i?{valid:!1,message:r}:null!==l&&a<t?{valid:!1,message:n}:{valid:!0}):{valid:!1,message:o};s.base_validate(e)}}),window.Wt.WT.PE.add("WSuggestionPopup",null,function(c,e){var t=e[0];let l=e[1];let d=e[8],u=t.WT;c.editKeyDown=function(i,r){if(!c.checkEdit(i))return!0;if(c.editId!==i.id)if(i.classList.contains("Wt-suggest-onedit"))c.editId=i.id,c.droppedDown=!1;else{if(!i.classList.contains("Wt-suggest-dropdown")||r.keyCode!==c.key_down)return!(c.editId=null);c.editId=i.id,c.droppedDown=!0}if(c.visible()){let e=c.selId?u.getElement(c.selId):null;if(r.keyCode===c.key_enter||r.keyCode===c.key_tab)return e?(c.suggestionClicked(e),u.cancelEvent(r),setTimeout(function(){i.focus()},0)):c.hidePopup(),!1;if(r.keyCode===c.key_down||r.keyCode===c.key_up||r.keyCode===c.key_pdown||r.keyCode===c.key_pup){if("KEYDOWN"===r.type.toUpperCase()&&(c.kd=!0,u.cancelEvent(r,u.CancelDefaultAction)),"KEYPRESS"===r.type.toUpperCase()&&!0===c.kd)u.cancelEvent(r);else{let t=e;var n,o=r.keyCode===c.key_down||r.keyCode===c.key_pdown;if(!t&&c.first)t=c.first(o),c.scrollToSelected(t);else{var a=r.keyCode===c.key_pdown||r.keyCode===c.key_pup?l.clientHeight/e.offsetHeight:1;for(let e=0;t&&e<a;++e){var s=c.next(t,o);if(!s&&d)break;t=s}}e&&(e.classList.remove("active"),c.isBS5&&c.isBS5()&&e.firstChild.classList.remove("active"),c.selId=null),t&&u.hasTag(t,"LI")&&(t.classList.add("active"),c.isBS5&&c.isBS5()&&t.firstChild.classList.add("active"),c.scrollToSelected(t),c.selId=t.id,c.editId=i.id,(n=(e=c.selId?u.getElement(c.selId):null).firstChild.firstChild).innerHTML,n.getAttribute("sug"),i.focus(),Wt.emit(l,"selectionChanged",e.id,i.id))}return!1}}return r.keyCode!=c.key_enter&&r.keyCode!=c.key_tab}}),Wt.WT.positionXY=function(e,t,i){var r=window.Wt.WT,e=r.getElement(e);e&&(e.waitingForOsCopyPromise?e.positionXYOnPromise={x:t,y:i}:r.isHidden(e)||(e.style.display="block",r.fitToWindow(e,t,i,t,i)))},window.Wt.WT.PE.add("WPopupMenu",null,function(r,e){var t=e[0];let n=e[1];let i=n.id,o=t.WT;r.setHidden=function(e){if(r.hideTimeout&&(clearTimeout(r.hideTimeout),r.hideTimeout=null),r.current=null,e)n.style.position="",n.style.display="",n.style.left="",n.style.top="",document.removeEventListener("mousedown",r.onDocumentDown),r.unbindDocumentClick(),document.removeEventListener("keydown",r.onDocumentKeyDown);else{setTimeout(function(){document.addEventListener("mousedown",r.onDocumentDown),r.bindDocumentClick(),document.addEventListener("keydown",r.onDocumentKeyDown)},0);let t=n.querySelector("[data-object-name=MenuItem_ID_OSPASTE]");t?window!==window.parent&&window.osc?(n.waitingForOsCopyPromise=!0,window.osc._gLI("oscopy").then(function(e){e||(t.style.display="none",null===t.previousSibling&&window.CFxUI.css_helper.hasStyleClass(t.nextSibling,"divider")&&(t.nextSibling.style.display="none")),n.waitingForOsCopyPromise=!1,n.positionXYOnPromise&&(n.style.display="block",o.positionXY(i,n.positionXYOnPromise.x,n.positionXYOnPromise.y))})):window.localStorage.hasOwnProperty("oscopy")||(t.style.display="none",null===t.previousSibling&&window.CFxUI.css_helper.hasStyleClass(t.nextSibling,"divider")&&(t.nextSibling.style.display="none")):n.style.display="block"}r.setOthersInactive(n,null)},r.onDocumentKeyDown=function(t){var e=document.activeElement,e=/INPUT|SELECT|TEXTAREA/i.test(e.tagName)&&!e.disabled&&!e.readOnly&&!e.xeAllowFireShortCuts;if(!e&&r.stillExist()){let e=null;switch(t.keyCode){case 27:r.doHide();break;case 38:e=$("#"+n.id).children(".active");var i=r.previousActiveElement(e);e.removeClass("active"),i.addClass("active"),i[0].offsetTop<n.scrollTop&&(n.scrollTop=i[0].offsetTop),t.preventDefault();break;case 40:e=$("#"+n.id).children(".active");i=r.nextActiveElement(e),i=(e.removeClass("active"),i.addClass("active"),i[0].offsetTop+i[0].offsetHeight);i>n.scrollTop+n.offsetHeight&&(n.scrollTop=i-n.offsetHeight),t.preventDefault();break;case 13:null!=(e=$("#"+n.id+" .active > a"))&&null!=e&&(e.click(),t.preventDefault())}}},r.onScroll=function(e){$(n.parentElement).unbind("scroll",r.onScroll),r.doHide()}}),window.Wt.WT.PE.add("WTableView",null,function(a,e){var t=e[0];let s=e[1],c=e[2],l=e[4],i=l.children[0],d=t.WT;function u(e,t,i){var r=window.getXeActiveDocument().getXeDatabase().getXeEntities(),n=new XeEntityPreview;return e&&0<e.length&&(n.setSortingByDrawOrder(!1),n.getXeDrawDecoration().setLWThick(2),n.getXeDrawDecoration().setType(1),n.getXeDrawDecoration().setColor(t),n.getXeDrawDecoration().setAlpha(i),t=r.getByStringGiPath(e),n.addXeEntity(t,!1)),n}a.resizeHandleMDown=function(e,t){let i=e.parentNode,r=d.pxself(i,"width")-1,n=13-r,o=1e4;document.body.classList.contains("Wt-rtl")&&([n,o]=[-o,-n]),new d.SizeHandle(d,"h",1,c.offsetHeight+l.offsetHeight,n,o,"Wt-hsh2",function(e){a.resizeColumn(i,e)},e,s,t,3,-1)};let n=c.querySelector(".Wt-tv-contents");function r(){if(n.firstElementChild){var e=n.firstElementChild.className,t=s.querySelectorAll("."+e);for(let e=0;e<t.length;e++){var i,r=t[e];r&&(i=$(r).parents(".tcontainer")[0].scrollLeft,r.style.transform="translateX("+i+"px)")}}}c.addEventListener("scroll",function(e){r()}),n.addEventListener("mousedown",function(e){var t;n.firstElementChild&&(t=n.firstElementChild.className,e.target.offsetParent.classList.contains(t))&&(document.dispatchEvent(new window.Event(e.type,e)),d.cancelEvent(e,1),Wt.emit(s,{name:"headerColumnMouseWentDown",eventObject:e.target.offsetParent,event:e}))}),n.addEventListener("mouseup",function(e){var t;n.firstElementChild&&(t=n.firstElementChild.className,e.target.offsetParent.classList.contains(t))&&(document.dispatchEvent(new window.Event(e.type,e)),d.cancelEvent(e,1),Wt.emit(s,{name:"headerColumnMouseWentUp",eventObject:e.target.offsetParent,event:e}))}),n.addEventListener("mouseover",function(e){var t,i,r,n,o;window.getXeApplication().GetCapability("drw_inspection_panel_cross_highlighting")&&(i=e.target.getAttribute("data-cross-highlight-handle"),t=[],(e=e.target.getAttribute("data-cross-highlight-dependency-handle"))&&t.push(e),t.push(i),i=window.OnshapeColors.highlight,r=window.OnshapeColors.dependancy,n=getXeApplication().getDrawingEngine().getXeRenderer(),o=getXeActiveDocument().getXeGsDevice().getActiveViewport(),u(t[0],i.rgb,i.alpha).draw_gl(n,o),e)&&u(t[1],r.rgb,r.alpha).draw_gl(n,o)}),n.addEventListener("mouseout",function(e){var t,i,r,n,o;window.getXeApplication().GetCapability("drw_inspection_panel_cross_highlighting")&&(t=getXeApplication().getDrawingEngine().getXeRenderer(),i=window.getXeActiveDocument(),r=i.getXeDatabase().getXeLayout().getPaper(),(i=i.getXeGsDevice()).getOverallViewport()?getXeApplication().getDrawingEngine().getImpl().clearScreen(t,r.getPaperBackColor(),1):getXeApplication().getDrawingEngine().getImpl().clearScreen(t,i.getPaperBackColor,1),r=window.GetXeDevicePixelRatio(),n=i.getPixelWidth(),o=i.getPixelHeight(),n=Math.floor(n*r),o=Math.floor(o*r),getXeApplication().getDrawingEngine().getImpl().draw_to_screen(t,n,o,i.__screenCacheTexture),getXeApplication().getDrawingEngine().getImpl().RenderTrackers(window.getXeApplication().getXeActiveDocument()))}),n.addEventListener("click",function(e){var t;n.firstElementChild&&(t=n.firstElementChild.className,e.target.offsetParent.classList.contains(t))&&(d.cancelEvent(e,1),d.isDblClick(e.target.offsetParent,e)?Wt.emit(s,{name:"headerColumnDblClick",eventObject:e.target.offsetParent,event:e}):(t=e,document.dispatchEvent(new window.Event(t.type,t)),Wt.emit(s,{name:"headerColumnClick",eventObject:e.target.offsetParent,event:e}),((e=d.isIElt9&&document.createEventObject?document.createEventObject(e):e).target.offsetParent.wtE1=e).target.offsetParent.wtClickTimeout=setTimeout(function(){e.target.offsetParent&&(e.target.offsetParent.wtClickTimeout=null,e.target.offsetParent.wtE1=null)},500)))});e=new window.ResizeObserver(e=>{c.scrollHeight!==c.clientHeight?i.style.width=c.firstChild.clientWidth+24+"px":i.style.width=c.firstChild.clientWidth+"px",i.parentElement.scrollLeft=c.scrollLeft});e.observe(c),e.observe(c.firstChild),new window.MutationObserver(e=>{r()}).observe(n,{childList:!0})});var WT_Jquery_DraggableFix=function(r,n,o){function a(e){o||(r.style.cursor="url('https://ssl.gstatic.com/ui/v1/icons/mail/images/2/closedhand.cur'), auto"),n.style.position="absolute",n.style.top=s+e.clientY+"px",n.style.left=c+e.clientX+"px"}r.addEventListener("mousedown",function(e){var t,i=e.target;i&&i.classList&&(t=!1,o?t="move"===$(r).css("cursor")||"move"===$(i).css("cursor"):(t=!0,r.style.cursor="url('https://ssl.gstatic.com/ui/v1/icons/mail/images/2/closedhand.cur'), auto"),t)&&(window.addEventListener("mousemove",a,!0),s=parseInt(n.style.top.replace("px",""),10)-e.clientY,c=parseInt(n.style.left.replace("px",""),10)-e.clientX)},!1),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",a,!0),o||(r.style.cursor="url('https://ssl.gstatic.com/ui/v1/icons/mail/images/2/openhand.cur'), auto")},!1),o||(r.onmouseover=function(){r.style.cursor="url('https://ssl.gstatic.com/ui/v1/icons/mail/images/2/openhand.cur'), auto"});var s=0,c=0;r.m_XeWidgetDraggableApplier=this},CFxUITextViewImpl=function(){var s,c,l,d,u=this,p=[],r=null;window.addEventListener("keyup",function(e){var t,i=e.target;null!==i&&i.hasAttribute("data-object-name")&&("tvComment"===(t=i.getAttribute("data-object-name"))||"tvPictureDescription"===t)&&window.CFxUITextViewImpl.getCursorElement&&u.getCursorElement(e,i)}),window.addEventListener("keydown",function(e){var t=(new Date).getTime(),i=e.target;null!==i&&("@"===e.key||"Enter"===e.key?"@"===e.key?r=t:"Enter"===e.key&&null!==r&&t-r<=500&&e.preventDefault():r=null,i.hasAttribute("data-object-name"))&&("tvComment"===(t=i.getAttribute("data-object-name"))||"tvPictureDescription"===t)&&window.CFxUITextViewImpl.getCursorElement&&u.getCursorElement(e,i)}),u.getCursorElement=function(e,t){s=t,window.getSelection&&(t=window.getSelection(),l=t.getRangeAt(0),!t&&t.anchorNode||(c=t.anchorNode,0<t.rangeCount&&(t=t.getRangeAt(0).getBoundingClientRect(),p[0]=t.left+t.width/2,p[1]=t.top+t.height,u.onMenuPopup(e))))},document.addEventListener("on::WPopupMenu::show",function(e){setTimeout(function(){u.onMenuPopup(e)},200)}),u.onMenuPopup=function(e){if(!(p.length<=0)){let t,i=document.querySelectorAll('[data-object-name="mentionUserList"]');for(let e=0;e<i.length;e++){var r=i[e],n=window.getComputedStyle(r);if("none"!==n.display&&"hidden"!==n.visibility){t=r;break}}var o,a,s;t&&(!e||40!==e.keyCode&&38!==e.keyCode||e.preventDefault(),e=t.clientWidth,o=t.clientHeight,a=(s=document.querySelectorAll('[data-object-name="XeDrawingEngineWidget0"]')[0]).clientWidth,s=s.clientHeight,a<p[0]+e&&(p[0]=p[0]-e),s<p[1]+o&&(p[1]=p[1]-o-15),p[0]<=50||(t.style.position="fixed",t.style.left=p[0]+"px",t.style.top=p[1]+"px"))}},u.insertXHTMLText=function(t){if(window.getSelection){var i,r,n,o,a,t=t.match(/@([^<]+)/);let e;t&&1<t.length&&(e=t[1].trim(),e+=" ",t=l.startContainer,d=t,r=l.endContainer,"DIV"!==t.tagName&&t.data?(d=t.parentNode,o=document.createTextNode(t.data.substring(0,l.startOffset))):t=d.childNodes[l.startOffset],"DIV"!==r.tagName&&r.data&&(i=document.createTextNode(r.data.substring(l.endOffset,r.length))),o&&i&&0<(n=o.data).length&&0<=(a=n.lastIndexOf("@"))&&(o.data=n.substring(0,a),c.data=n.substring(0,a)),(o=document.createElement("span")).setAttribute("contenteditable","false"),o.style.color="#4389FF",o.style.userSelect="none",o.textContent="@"+e,n=r.nextSibling,t||d.appendChild(o),a=document.createTextNode(" "),n?(d.insertBefore(o,n),d.insertBefore(a,n),i&&d.insertBefore(i,n)):(d.appendChild(o),d.appendChild(a),i&&d.appendChild(i)),u.setCursor(d,a),Wt.emit(s,"XeRichTextEditChanged",s.innerText,s.innerHTML))}},u.setCursor=function(e,t){var i,r,n;window.getSelection&&(i=document.createRange(),n=0,r=e,n=t?Array.prototype.indexOf.call(e.childNodes,t)+1:(e=(r=0<(t=e.getElementsByTagName("div")).length?t[t.length-1]:r).getElementsByTagName("br")[0],Array.prototype.indexOf.call(r.childNodes,e)),i.setStart(r,n),i.setEnd(r,n),i.collapse(!0),(t=window.getSelection()).removeAllRanges(),t.addRange(i))}},XeCFxCommandLine=function(){var c,l,d=this,s=[],u=[],r=[],p=[],m=-1,h=null,g=!0,y=!0,o=!0,f=!0,_="",w=!0,v=!0,C=!1;function T(e,t,i){t&&(t.value=""),e.stopPropagation&&e.stopPropagation(),e.preventDefault(),X();t="^C^C"+i;window.getXeActiveDocument().RunCmd(t)}function n(e,t,i){t.selectionEnd-t.selectionStart==0&&(t=window.CXeShortcutsManager.shortcuts[i])&&(e.clipboardData.setData("text/plain",""),e.stopPropagation&&e.stopPropagation(),e.preventDefault(),window.CFxUI.fire(t))}function b(e,t){e&&(a(e),m>=e.length?m=0:m<0&&(m=e.length-1),e[m])&&(e[m].classList.add("autocomplete-active"),e[m].scrollIntoViewIfNeeded?e[m].scrollIntoViewIfNeeded(!1):e[m].scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),t&&(h.value=e[m].innerText.split(" ")[0]),e[m].focus(),h.setSelectionRange)&&(h.focus(),t=h.value.length,w&&_?h.setSelectionRange(_.length+0,t):h.setSelectionRange(t,2*t))}function a(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}function X(){for(var e=document.getElementsByClassName("autocomplete-items"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])}function S(e){var t,i=document.getElementById(d.getLineEditId()+"autocomplete-list");i&&(i=i.children,(t=Array.prototype.indexOf.call(i,e.currentTarget))!==m)&&(e.stopPropagation(),e.preventDefault(),e.target,i[m=t])&&i[t].classList&&(a(i),i[t].classList.add("autocomplete-active"))}function P(e){var t=jQuery("#"+O)[0];switch(e.stopPropagation(),e.target.dataset.itemId){case"FxCommandLine_AutoSuggestion":w=!w,Wt.emit(t,"SetAutoComPref","_AUTO",w);break;case"FxCommandLine_IncludeAliases":g=!g,Wt.emit(t,"SetAutoComPref","_Aliases",g);break;case"FxCommandLine_IncludeMidstringSearch":y=!y,Wt.emit(t,"SetAutoComPref","_MIDSTRING",y);break;case"FxCommandLine_IncludeSystemVariables":o=!o,Wt.emit(t,"SetAutoComPref","_SYSTEM",o);break;case"FxCommandLine_DisplaySuggestionList":window.getXeApplication().RequestLocalizedStringMap().then(function(e){var t;e.hasOwnProperty("FxCommandLine_CloseSuggestionListTitle")&&e.hasOwnProperty("FxCommandLine_CloseSuggestionListMessage")&&(t="<div class='autocomplete dialog-ovelay'><div class='dialog'><header> <h3> "+(t=e.FxCommandLine_CloseSuggestionListTitle)+" </h3> <i class='fa fa-close'></i></header><div class='dialog-msg'> <p> "+e.FxCommandLine_CloseSuggestionListMessage+" </p> </div><footer><div class='controls'> <button class='button button-danger doAction'>"+e.FxCommandLine_CloseSuggestionListYesOption+"</button>  <button class='button button-default cancelAction'>"+e.FxCommandLine_CloseSuggestionListNoOption+"</button> </div></footer></div></div>",$("body").prepend(t),$(".doAction").click(function(){var e=jQuery("#"+O)[0];d.toggleAutoSuggList(!1),Wt.emit(e,"SetAutoComPref","_LIST",f),X(),$(this).parents(".dialog-ovelay").fadeOut(0,function(){$(this).remove()})}),$(".cancelAction, .fa-close").click(function(){$(this).parents(".dialog-ovelay").fadeOut(0,function(){$(this).remove()})}),$(document).ready(function(){$(".dialog").draggable({handle:"header"})}))})}d.hideContextMenu(),d.prepareList(),f&&d.input()}function D(e){e.preventDefault(),d.hideContextMenu();e.currentTarget;let t=e.clientX,i=e.clientY;window.getXeApplication().RequestLocalizedStringMap().then(function(r){var n,e=document.createElement("DIV");e.setAttribute("class","autocomplete-contextmenu"),document.body.appendChild(e),(n=document.createElement("ul")).setAttribute("class","menu-options"),n.addEventListener("click",P,!1),["FxCommandLine_AutoSuggestion","FxCommandLine_IncludeAliases","FxCommandLine_IncludeMidstringSearch","FxCommandLine_IncludeSystemVariables","FxCommandLine_DisplaySuggestionList"].forEach(function(e){var t,i;r.hasOwnProperty(e)&&(t=r[e],(i=document.createElement("li")).setAttribute("class","menu-option"),i.dataset.itemId=e,(w&&"FxCommandLine_AutoSuggestion"===e||g&&"FxCommandLine_IncludeAliases"===e||y&&"FxCommandLine_IncludeMidstringSearch"===e||o&&"FxCommandLine_IncludeSystemVariables"===e||f&&"FxCommandLine_DisplaySuggestionList"===e)&&i.setAttribute("class","checked"),e=document.createTextNode(t),i.appendChild(e),n.appendChild(i))}),e.appendChild(n),e.style.left=t+"px",e.style.top=i+"px",e.style.display="block"})}d.getLineEditId=function(){return x},d.setLineEditId=function(e){var t,i;x=e,(h=document.getElementById(x))&&(window.IsOsVersion()||(e=window.m_XeApplication.RequestAliasesList(),t=window.m_XeApplication.RequestCommandList(),i=window.m_XeApplication.RequestSysVarList(),Promise.all([e,t,i]).then(e=>{r=e[0],s=e[1],u=e[2],d.prepareList()}),h.addEventListener("input",d.input)),h.onkeydown=function(e){l=e.keyCode;var t=window.getXeActiveDocument(),i=t.getXeInputPointManager(),r=window.IsOsVersion(),n=t.getViewMode(),o=document.getElementById(this.id+"autocomplete-list");if(o?o=o.getElementsByTagName("div"):m=-1,e.ctrlKey&&"KeyZ"===e.code)T(e,this,"_U");else if(e.ctrlKey&&"KeyS"===e.code)e.preventDefault();else if(e.ctrlKey&&"KeyO"===e.code)e.preventDefault();else if(e.ctrlKey&&"KeyY"===e.code)T(e,this,"_Redo");else if(!e.ctrlKey||"F8"!==e.code&&"F3"!==e.code&&"F7"!==e.code&&"F11"!==e.code&&"F10"!==e.code)switch(e.keyCode){case 27:var a=document.getElementById(x);a&&(a.value=""),X(),c=m=-1;break;case 13:case 32:i.m_bClientPending=!0,i.m_ClearClientPendingStateTimeout&&clearTimeout(i.m_ClearClientPendingStateTimeout),i.m_ClearClientPendingStateTimeout=setTimeout(i.ClearClientPendingState,750,i),-1<c&&!r&&(o&&0<o.length&&(a=a||document.getElementById(x),C||(a.value=o[c].innerText.split(" ")[0]),a.setSelectionRange)&&a.setSelectionRange(a.value.length,a.value.length),X()),c=m=-1;break;case 46:n||""==document.getElementById(x).value&&0<window.getXeActiveDocument().getXeMainSelectionSet().getHandles().length&&window.getXeActiveDocument().cmdERASE();break;case 40:r||(c=++m,b(o,!0));break;case 38:r||(c=--m,b(o,!0))}else m=-1;e.xeCustomEvent=!0,e.xeWidgetId=O,e.stopPropagation(),m<0&&i.getInputPointManager().updateInput(e)},h.onkeypress=function(e){window.getXeActiveDocument().getXeInputPointManager().getInputPointManager()&&(e.xeCustomEvent=!0,e.xeWidgetId=O,e.stopPropagation())},h.onkeyup=function(e){var t=window.getXeActiveDocument().getXeInputPointManager().getInputPointManager();t&&(e.xeCustomEvent=!0,e.xeWidgetId=O,e.stopPropagation(),t.updateInput(e))},h.oncopy=function(e){n(e,this,"CTRL+C")},h.oncut=function(e){n(e,this,"CTRL+X")},h.onpaste=function(e){var t;e.clipboardData.getData("text/plain")||(t=window.CXeShortcutsManager.shortcuts["CTRL+V"])&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault(),window.CFxUI.fire(t))})},d.updateCommandLine=function(e){var t;0!=document.getElementsByClassName("XeSheetControlGroupTrimble").length&&(t=document.querySelector('[data-object-name="CommandLinePrompt"]'),null!=h)&&null!=t&&(!0===e||0!==t.innerText.length?window.CFxUI.css_helper.hasStyleClass(h,"activated")||(window.CFxUI.css_helper.removeStyleClass(h,"inactive"),window.CFxUI.css_helper.addStyleClass(h,"activated")):0===h.value.length&&window.CFxUI.css_helper.hasStyleClass(h,"activated")&&(window.CFxUI.css_helper.removeStyleClass(h,"activated"),window.CFxUI.css_helper.hasStyleClass(h,"inactive")||window.CFxUI.css_helper.addStyleClass(h,"inactive")))},d.dragElement=function(e,t){var i=0,r=0,n=0,o=0,a=document.getElementById(e),e=document.getElementById(t);function s(e){(e=e||window.event).preventDefault();var t=document.getElementsByClassName("no-focus-border"),i=document.createElement("canvas");i.setAttribute("class","CmdTempDiv"),i.width=t[0].wtWidth,i.height=t[0].wtHeight,i.style.position="absolute",t[0].appendChild(i),n=e.clientX,o=e.clientY,document.onmouseup=l,document.onmousemove=c}function c(e){(e=e||window.event).preventDefault(),e.clientX<0||e.clientY<0||e.clientX>window.innerWidth||e.clientY>window.innerHeight||(i=n-e.clientX,r=o-e.clientY,n=e.clientX,o=e.clientY,a.style.top=a.offsetTop-r+"px",a.style.left=a.offsetLeft-i+"px",a.style.bottom=null,a.style.position="absolute")}function l(){document.onmouseup=null,document.onmousemove=null,$(".CmdTempDiv").remove()}a.style.position="relative",a.style.bottom="68px",a.style.left=null,a.style.top=null,e?e.onmousedown=s:a.onmousedown=s,window.addEventListener("resize",function(e){a.style.position="relative",a.style.bottom="68px",a.style.left=null,a.style.top=null},!1)},d.input=function(e){clearTimeout(void 0);var t,r=(h=h||document.getElementById(x)).value,n=[],o=[],a=[],i=!0,s=(X(),window.getXeActiveDocument().getXeInputPointManager().getInsideCommand());if(!r||-1!==r.indexOf(" ",0)||s)return!1;d.updateCommandLine(),(s=document.createElement("DIV")).setAttribute("id",h.id+"autocomplete-list"),s.setAttribute("class","autocomplete-items"),h.parentNode.prepend(s),p.forEach((e,t)=>{var i=e.split(" ")[0];g&&!v&&(e=i),i===r.toUpperCase()?o.push(e):i.substr(0,r.length)===r.toUpperCase()||y&&3<=r.length&&i.startsWith("-")&&i.substr(1,r.length)===r.toUpperCase()?n.push(e):!i.startsWith("_")&&y&&3<=r.length&&-1!==i.indexOf(r.toUpperCase(),0)&&a.push(e)}),n.length<=0&&o.length<=0&&(i=!1),n.sort(function(e,t){return e.indexOf(r.toUpperCase(),0)-t.indexOf(r.toUpperCase(),0)}),a.sort(),t=[...o,...n,...a],d.createAutoSuggList(t,r,s),f||(s.style.display="none"),_=r,C=!1,c=m=0,"Microsoft Internet Explorer"===window.XeUtils.UserAgentDetector.browser||"Microsoft Edge"===window.XeUtils.UserAgentDetector.browser?l&&8===l?b(s.getElementsByTagName("div")):b(s.getElementsByTagName("div"),i&&w):e&&"deleteContentBackward"===e.inputType?(b(s.getElementsByTagName("div")),C=!0):b(s.getElementsByTagName("div"),i&&w)},document.addEventListener("click",function(e){X(),d.updateCommandLine(),(e=>{var t=document.querySelector('[data-object-name="CXeTrSheetWidget"]');if(null!=t){var i=[...document.querySelectorAll('[data-object-name="Model"]')].concat([...document.querySelectorAll('[data-object-name="layers_menu"]')]).map(e=>e.id);if(null!=e.target){var r=e.target.id;if(null!=e.target.parentElement){var n=e.target.parentElement.id;for(let e=0;e<i.length;e++)if(i[e]===r||i[e]===n)return;t.style.display="none",document.querySelector('[data-object-name="layers_menu"]').classList.remove("active"),Wt.emit(t,"hidePopup")}}}})(e),d.hideContextMenu()}),d.createAutoSuggList=function(n,o,a){n.forEach((e,t)=>{var i=document.createElement("DIV"),r=u.includes(e);s.includes(e)?(i.innerHTML="<strong style='pointer-events:none'>"+n[t].substr(0,o.length),i.innerHTML+="<strong style='pointer-events:none'>"+n[t].substr(o.length)):r?(i.innerHTML="<i style='pointer-events:none'>"+n[t].substr(0,o.length)+"</strong>",i.innerHTML+="<i style='pointer-events:none'>"+n[t].substr(o.length)):(i.innerHTML=n[t].substr(0,o.length),i.innerHTML+=n[t].substr(o.length)),i.innerHTML+="<input type='hidden' value='"+n[t]+"'>",i.addEventListener("click",function(e){e.stopPropagation();e="^C^C"+i.getElementsByTagName("input")[0].value.split(" ")[0];window.getXeActiveDocument().RunCmd(e),X()}),i.addEventListener("mousemove",S,!1),i.addEventListener("contextmenu",D,!1),a.appendChild(i)})},d.hideContextMenu=function(){for(var e=document.getElementsByClassName("autocomplete-contextmenu"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},d.toggleAutoSuggList=function(e){f=e},d.toggleAutoSuggestion=function(e){w=e},d.toggleAddSysVar=function(e){o=e,d.prepareList()},d.toggleAddMidString=function(e){y=e},d.toggleAddAliases=function(e){g=e,d.prepareList()},d.toggleAddAliasesWithCmd=function(e){v=e},d.connectSetFocus=function(e){O=e,document.getElementById(O).focus=function(){var e;window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker")||(e=document.getElementById(x))&&(e.focus(),setTimeout(function(){d.input()},500))}},d.prepareList=function(){p=[],g&&p.push(...r),p.push(...s),o&&p.push(...u),p.sort()};var x=null,O=null},XeFxQtWidgetDimPalletManager=function(){var r=this,n=(e("setFocusOnShow",!1),e("isShown",!0),{isShown:!1,setFocusOnShow:!1,closeTime:1e3,onCloseAreaWidgetOffset:30});function e(t,i){Object.defineProperty(r,t,{get:function(){return n[t]},set:function(e){if(i)throw"you can't set property : "+t;n[t]=e},enumerable:!0,configurable:!0})}var t={mouseBtn:-1,func:function(e){t.mouseBtn===e.which&&(t.mouseBtn=-1,n.isDragging=!1,document.removeEventListener("mouseup",t.func,!1))}};function i(){window.getXeApplication().getXeUI().HideDimPallete()}function o(e,t){return!(!e||!e.parentElement)&&(e.parentElement.id===t||o(e.parentElement,t))}function a(){document.removeEventListener("mousemove",a,!1),n.closeTimeoutHandler=setTimeout(function(){var e=n.widget;if(window.getXeActiveDocument()&&window.getXeActiveDocument().getXeDatabase()){if(document.activeElement.id===e.id||o(document.activeElement,e.id))return void(n.closeTimeoutHandler=0);e=window.getXeActiveDocument().getXeDatabase().getCMDNAMES();e&&e.length&&"_DIMPAL"===e[0]&&i()}n.closeTimeoutHandler=0},n.closeTime)}function s(){n.closeTimeoutHandler&&(clearTimeout(n.closeTimeoutHandler),n.closeTimeoutHandler=0)}function c(e){var t=n.widget;t&&!o(e.target,t.id)&&i()}r.updateInput=function(e){var t=window.getXeActiveDocument().getXeInputPointManager().getHitTestInfo();return!(!t.IsKeyboardEvent()||"escape"!==t.GetKey().toLowerCase())},document.addEventListener("XeFxQtWidgetDimPallet.setPosition",function(e){var t;e.widget&&((t=n.widget=e.widget).parentElement&&(t.parentElement.style.overflow="hidden"),t.style.left=e.position[0]+"px",t.style.top=e.position[1]+"px")}),document.addEventListener("XeFxQtWidgetDimPallet.showPalette",function(e){e.widget&&(s(),n.widget=e.widget,n.firstFocusWidget=e.firstFocusWidget,document.addEventListener("mousedown",c,!1),window.getXeActiveDocument().getXeInputPointManager().getInputPointManager().pushToEventLoop(r),window.Wt.WT.$(n.widget.id).wtObj.centerDialog=function(){},(n.isShown||n.setFocusOnShow)&&setTimeout(function(){n.firstFocusWidget&&n.firstFocusWidget.focus()},150),n.onCloseAreaWidget||(n.onCloseAreaWidget=document.createElement("div"),n.onCloseAreaWidget.id=n.widget.id+"_onCloseAreaWidget",n.onCloseAreaWidget.style.position="absolute",n.onCloseAreaWidget.makeAligment=function(){var e=n.widget.getBoundingClientRect();n.onCloseAreaWidget.style.left=e.x-n.onCloseAreaWidgetOffset+"px",n.onCloseAreaWidget.style.top=e.y-n.onCloseAreaWidgetOffset+"px",n.onCloseAreaWidget.style.width=e.width+2*n.onCloseAreaWidgetOffset+"px",n.onCloseAreaWidget.style.height=e.height+2*n.onCloseAreaWidgetOffset+"px",n.onCloseAreaWidget.style.zIndex=n.widget.style.zIndex-1},n.onCloseAreaWidget.makeAligment(),n.onCloseAreaWidget.style.overflow="hidden",n.widget.parentElement.style.overflow="hidden",n.widget.parentElement.appendChild(n.onCloseAreaWidget),new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&n.onCloseAreaWidget.makeAligment()})}).observe(n.widget,{attributes:!0})),n.onCloseAreaWidget.style.visibility="visible",n.onCloseAreaWidget.style.display="",n.onCloseAreaWidget.tabIndex=0,n.onCloseAreaWidget.style.outline="none",n.isShown||n.setFocusOnShow?n.onCloseAreaWidget.onmouseleave=void 0:n.onCloseAreaWidget.onmouseleave=function(e){n.isDragging||window.getXeActiveDocument().getXeGsDevice().getPan()||e.relatedTarget===n.widget||o(e.relatedTarget,n.widget.id)||i()},n.widget.onmouseover=n.onCloseAreaWidget.onmouseover=function(){s()},n.widget.onmousedown=function(e){n.isDragging||(t.mouseBtn=e.which,n.isDragging=!0,document.addEventListener("mouseup",t.func,!1)),n.onCloseAreaWidget.onmouseleave=void 0},document.removeEventListener("mousemove",a,!1),n.isShown||n.setFocusOnShow||document.addEventListener("mousemove",a,!1),n.isShown=!0,n.setFocusOnShow=!1)}),document.addEventListener("XeFxQtWidgetDimPallet.hidePalette",function(e){e.widget&&(s(),n.widget=e.widget,document.removeEventListener("mousedown",c,!1),window.getXeActiveDocument().getXeInputPointManager().getInputPointManager().removeFromEventLoop(r),window.IsOsVersion()&&(n.onCloseAreaWidget&&(n.onCloseAreaWidget.style.visibility="hidden",n.onCloseAreaWidget.style.display="none",n.onCloseAreaWidget.onmouseleave=void 0,n.onCloseAreaWidget.onmouseover=void 0),n.widget.onmouseover=void 0,n.widget.onmousedown=void 0,document.removeEventListener("mousemove",a,!1),document.removeEventListener("mouseup",t.func,!1)),n.isShown=!1,n.isDragging=!1,n.firstFocusWidget=null,n.setFocusOnShow=!1)}),Object.seal(r)};function IsWidgetVisible(e){return"none"!=e.parents(0,"div")[0].parentElement.style.display}window.Wt._p_.applyOnDragStartExtension=function(e,t,i){var r=$("#COsSheetManager");IsWidgetVisible(r)&&(r=r.find(".active"),t=!t&&r?r[0]:t)&&t.classList&&(!t.classList.contains("xenon-reference-ele-parent")&&(t.classList.contains("Wt-ctrl")||t.classList.contains("Wt-item"))||(e.style.backgroundColor="#1b5faa",e.style.borderRadius="25px",e.style.opacity="0.75",null!==r&&1<r.length?e.innerHTML=r.length+" Items":t&&t.classList.contains("xenon-reference-ele-parent")?t.lastElementChild&&t.lastElementChild.innerText&&0!=t.lastElementChild.innerText.length&&(e.innerHTML=t.lastElementChild.innerText):t&&0!=t.getElementsByTagName("span").length?e.innerHTML=t.getElementsByTagName("span")[0].innerHTML:t&&t.innerHTML&&0!=t.innerHTML.length?e.innerHTML=t.innerHTML:t&&t.nextSibling&&t.nextSibling.innerHTML&&0!=t.nextSibling.innerHTML.length&&(e.innerHTML=t.nextSibling.innerHTML),e.style.textAlign="center",e.style.color="white",e.style.lineHeight="32px",e.style.marginTop="10px",e.style.borderLeft="10px solid #1b5faa",e.style.borderRight="10px solid #1b5faa"))},window.Wt._p_.applyCustomMimeType=function(e,t){""==e.mimeType&&t.classList.contains("xenon-onshape-sheet-tree")&&(e.mimeType="application/x-wabstractitemmodelselection")},window.Wt._p_.startCustomDrag=function(e,t){!IsWidgetVisible($("#COsSheetManager"))||t.target&&t.target.classList&&(t.target.classList.contains("Wt-item")||t.target.classList.contains("Wt-ctrl"))&&!t.target.classList.contains("xenon-reference-ele-parent")||window.Wt._p_.dragStart(e,t)},window.Wt._p_.subElementClick=function(e,t){var i=$("#COsSheetManager"),r=$("#COsReferenceManager");(IsWidgetVisible(i)||IsWidgetVisible(r))&&t.target&&t.target.classList&&t.target.classList.contains("xenon-reference-version")&&window.Wt.emit(e,"subElementClick")},window.Wt._p_.customDrop=function(e,t,i,r,n){var o;IsWidgetVisible($("#COsSheetManager"))&&((o=n.target)&&o.classList&&(o.classList.contains("Wt-tv-c")||o.parentElement&&o.parentElement.classList&&o.parentElement.classList.contains("Wt-tv-c"))||o.classList.contains("cwidth")||o.classList.contains("custom-enable-drop"))&&(o.classList.contains("custom-enable-drop")&&(o.classList.add("Wt-tv-c"),o.setAttribute("drop","true")),"drop"==t)&&(window.Wt._p_.dragSeperator(n,e,!0),o.classList.contains("cwidth"))&&window.Wt.emit(e,"lastDrop",i,r,n)},window.Wt._p_.removeDropTargetStyle=function(){hideSeperator()},window.Wt._p_.dragSeperator=function(e,t,i){var r,n=0,o=0,a=e.target;if(a){var s=a,c=document.getElementById("COsSheetManager"),l=c.offsetWidth;if(createSeperator(),a.classList.contains("Wt-tv-c")||a.parentElement.classList.contains("Wt-tv-c")||a.classList.contains("cwidth")||a.classList.contains("xenon-reference-ele-parent")){var d=!1;if(!a.classList.contains("Wt-tv-c"))if(a.parentElement.classList.contains("Wt-tv-c")&&(a.parentElement.classList.contains("Wt-drop-site")||i))s=a.parentElement;else if(a.classList.contains("cwidth")&&i)d=!0,window.Wt.emit(t,"dropBelowItem",d);else if(!a.classList.contains("Wt-drop-site")&&!i&&!a.classList.contains("xenon-reference-ele-parent"))return;if(s.offsetParent){for(;n+=s.offsetLeft,o+=s.offsetTop,s=s.offsetParent;);null!=(r=void 0!==document.getElementsByClassName("cwidth")&&null!==document.getElementsByClassName("cwidth")&&1<document.getElementsByClassName("cwidth").length?document.getElementsByClassName("cwidth")[1]:r)&&r.scrollHeight>c.offsetHeight&&(o-=r.scrollTop,l-=14),e.clientX>n&&e.clientX<l&&(a=o+25,c=o+12.5,e.clientY>o)&&e.clientY<a&&(e.clientY>c?(d=!0,styleSeperator(a,n,l)):e.clientY<c&&(d=!1,styleSeperator(o,n,l)),i)&&window.Wt.emit(t,"dropBelowItem",d)}}else hideSeperator()}};var styleSeperator=function(e,t,i){var r=document.getElementById("hiddenSeperator");null!==r&&(r.style.height="2px",r.style.width=i+"px",r.style.position="absolute",r.style.backgroundColor="#1b5faa",r.style.borderRadius="25px",r.style.opacity="1",r.style.color="black",r.style.lineHeight="32px",r.style.top=e+"px",r.style.left="0px",r.style.display="block")},createSeperator=function(){var e="hiddenSeperator",t=document.getElementById(e);null===t&&((t=document.createElement("div")).id=e,t.style.display="none",t.style.zIndex="9999",document.body.appendChild(t))},hideSeperator=function(){var e=document.getElementById("hiddenSeperator");null!==e&&(e.style.display="none")},OsDlgMoveToSheet=function(){var t=null,i=(document.addEventListener("OsDlgMoveToSheet.show",function(e){(t=e.widget).style.left=0+i.x+"px",t.style.top=0+i.y+"px"}),{x:0,y:0});function e(e){e.touches&&e.touches.length&&e.touches[0]?(i.x=e.touches[0].clientX,i.y=e.touches[0].clientY):(i.x=e.clientX,i.y=e.clientY)}window.addEventListener("mouseup",e),window.addEventListener("mouseup",e)},OsDlgTableResize=function(){var t=null,i=(document.addEventListener("OsDlgTableResize.show",function(e){(t=e.widget).style.left=0+i.x+"px",t.style.top=0+i.y+"px"}),{x:0,y:0});window.addEventListener("mouseup",function(e){e.touches&&e.touches.length&&e.touches[0]?(i.x=e.touches[0].clientX,i.y=e.touches[0].clientY):(i.x=e.clientX,i.y=e.clientY)})},XeFxQtWidgetDimPalletManager=function(){var e=this,r=(t("setFocusOnShow",!1),t("isShown",!0),{isShown:!1,setFocusOnShow:!1,closeTime:1e3,onCloseAreaWidgetOffset:30});function t(t,i){Object.defineProperty(e,t,{get:function(){return r[t]},set:function(e){if(i)throw"you can't set property : "+t;r[t]=e},enumerable:!0,configurable:!0})}var i={mouseBtn:-1,func:function(e){i.mouseBtn===e.which&&(i.mouseBtn=-1,r.isDragging=!1,document.removeEventListener("mouseup",i.func,!1))}};function n(e,t){return!(!e||!e.parentElement)&&(e.parentElement.id===t||n(e.parentElement,t))}function o(){document.removeEventListener("mousemove",o,!1),r.closeTimeoutHandler=setTimeout(function(){var e=r.widget;if(window.getXeActiveDocument()&&window.getXeActiveDocument().getXeDatabase()){if(document.activeElement.id===e.id||n(document.activeElement,e.id))return void(r.closeTimeoutHandler=0);e=window.getXeActiveDocument().getXeDatabase().getCMDNAMES();e&&e.length&&"_DIMPAL"===e[0]&&window.getXeActiveDocument().RunCmd("^C^C")}r.closeTimeoutHandler=0},r.closeTime)}function a(){r.closeTimeoutHandler&&(clearTimeout(r.closeTimeoutHandler),r.closeTimeoutHandler=0)}document.addEventListener("XeFxQtWidgetDimPallet.setPosition",function(e){var t;e.widget&&((t=r.widget=e.widget).parentElement&&(t.parentElement.style.overflow="hidden"),t.style.left=e.position[0]+"px",t.style.top=e.position[1]+"px")}),document.addEventListener("XeFxQtWidgetDimPallet.showPalette",function(e){e.widget&&(a(),r.widget=e.widget,r.firstFocusWidget=e.firstFocusWidget,window.Wt.WT.$(r.widget.id).wtObj.centerDialog=function(){},window.IsOsVersion()&&((r.isShown||r.setFocusOnShow)&&setTimeout(function(){r.firstFocusWidget&&r.firstFocusWidget.focus()},150),r.onCloseAreaWidget||(r.onCloseAreaWidget=document.createElement("div"),r.onCloseAreaWidget.id=r.widget.id+"_onCloseAreaWidget",r.onCloseAreaWidget.style.position="absolute",r.onCloseAreaWidget.makeAligment=function(){var e=r.widget.getBoundingClientRect();r.onCloseAreaWidget.style.left=e.x-r.onCloseAreaWidgetOffset+"px",r.onCloseAreaWidget.style.top=e.y-r.onCloseAreaWidgetOffset+"px",r.onCloseAreaWidget.style.width=e.width+2*r.onCloseAreaWidgetOffset+"px",r.onCloseAreaWidget.style.height=e.height+2*r.onCloseAreaWidgetOffset+"px",r.onCloseAreaWidget.style.zIndex=r.widget.style.zIndex-1},r.onCloseAreaWidget.makeAligment(),r.onCloseAreaWidget.style.overflow="hidden",r.widget.parentElement.style.overflow="hidden",r.widget.parentElement.appendChild(r.onCloseAreaWidget),new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&r.onCloseAreaWidget.makeAligment()})}).observe(r.widget,{attributes:!0})),r.onCloseAreaWidget.style.visibility="visible",r.onCloseAreaWidget.style.display="",r.onCloseAreaWidget.tabIndex=0,r.onCloseAreaWidget.style.outline="none",r.isShown||r.setFocusOnShow?r.onCloseAreaWidget.onmouseleave=void 0:r.onCloseAreaWidget.onmouseleave=function(e){r.isDragging||window.getXeActiveDocument().getXeGsDevice().getPan()||e.relatedTarget===r.widget||n(e.relatedTarget,r.widget.id)||window.getXeActiveDocument().RunCmd("^C^C")},r.widget.onmouseover=r.onCloseAreaWidget.onmouseover=function(){a()},r.widget.onmousedown=function(e){r.isDragging||(i.mouseBtn=e.which,r.isDragging=!0,document.addEventListener("mouseup",i.func,!1)),r.onCloseAreaWidget.onmouseleave=void 0},document.removeEventListener("mousemove",o,!1),r.isShown||r.setFocusOnShow||document.addEventListener("mousemove",o,!1)),r.isShown=!0,r.setFocusOnShow=!1)}),document.addEventListener("XeFxQtWidgetDimPallet.hidePalette",function(e){e.widget&&(a(),r.widget=e.widget,window.IsOsVersion()&&(r.onCloseAreaWidget&&(r.onCloseAreaWidget.style.visibility="hidden",r.onCloseAreaWidget.style.display="none",r.onCloseAreaWidget.onmouseleave=void 0,r.onCloseAreaWidget.onmouseover=void 0),r.widget.onmouseover=void 0,r.widget.onmousedown=void 0,document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",i.func,!1)),r.isShown=!1,r.isDragging=!1,r.firstFocusWidget=null,r.setFocusOnShow=!1)}),Object.seal(e)},OsMiniToolbar=function(){var i=this,a=null,r=null;document.addEventListener("OsMiniToolbar.initContextMenu",function(e){r=e.contextmenu}),document.addEventListener("OsMiniToolbar.showToolbar",function(e){a=e.widget;var e=window.Wt.WT,t=window.getXeActiveDocument().getXeInputPointManager();if(!e||!t)return!1;var i,r,n,o=t.getMousePosition();o.y<0||((i=e.$(a.id).wtObj)&&(i.centerDialog=function(){}),i=e.widgetPageCoordinates(t.getCanvas()),e=o.x+i.x+10,t=o.y+i.y+10,o=$("#"+a.id),i=$(document).height(),r=$(document).width(),n=o.width(),i<t+(o=o.height())&&o<i&&(t=i-o-10),a.style.left=(e=r<e+n&&n<r?r-n-10:e)+"px",a.style.top=t+"px",a.style.display="block")}),document.addEventListener("mousedown",function(e){var t;a&&(t=!1,"which"in e&&(t=3==e.which),i.handleContextMenu(e.target)||!0===t||e.target.dataset.objectName&&e.target.dataset.objectName.startsWith("button_MiniToolbar")||e.target.parentElement&&e.target.parentElement.dataset.objectName&&e.target.parentElement.dataset.objectName.startsWith("button_MiniToolbar")||i.hideToolbar(e.target))}),document.addEventListener("mouseup",function(e){var t;a&&!(t=!1)!==(t="which"in e?3==e.which:t)&&(e.target.dataset.objectName&&e.target.dataset.objectName.startsWith("button_MiniToolbar")&&!window.CFxUI.isUIDisabled(e.target)||e.target.parentElement&&e.target.parentElement.dataset.objectName&&e.target.parentElement.dataset.objectName.startsWith("button_MiniToolbar")&&!window.CFxUI.isUIDisabled(e.target.parentElement))&&i.hideToolbar(null)}),document.addEventListener("keydown",function(e){27===e.keyCode&&i.hideToolbar(null)}),i.handleContextMenu=function(e){for(var t=e;(t=t.parentElement)&&"OsMiniToolbarCustomize"!==t.dataset.objectName;);if(t)return window.XeClientMessageProxy&&window.XeClientMessageProxy.openDrawingMiniToolbarPreferences(),!0;for(t=e;(t=t.parentElement)&&"OsMiniToolbarContextMenu"!==t.dataset.objectName;);return!!t||!(!r||"none"===r.style.display||""===r.style.display||(r.style.display="none",0))},i.hideToolbar=function(e){if(e){for(var t=e;"OsMiniToolbarContextMenu"!==t.dataset.objectName&&t!==a&&(t=t.parentElement););if(t)return}r&&"none"!==r.style.display&&""!==r.style.display&&(r.style.display="none"),a&&"none"!==a.style.display&&""!==a.style.display&&(a.style.display="none")}},PanelResizeHandler=function(){let a=new Map;this.setPanelResizable=function(e,t,i,r,n,o){a.set(t.id,{panel:e,offset:i,minWidth:r,maxWidth:n,bLeftHandSide:o}),void 0!==e&&void 0!==t&&t.addEventListener("mousedown",s)};let i,r,n;function s(e){n=e.srcElement.id;var t=a.get(n);i=e.clientX+t.offset,r=t.panel.offsetWidth,document.documentElement.addEventListener("mousemove",o),document.documentElement.addEventListener("mouseup",c)}function o(e){var t=a.get(n);let i=e.clientX;(i=!1===t.bLeftHandSide?window.innerWidth-e.clientX:i)>=t.minWidth?i+=t.offset:i=t.minWidth+t.offset,void 0!==t.panel&&void 0!==t.panel.style&&(t.panel.style.width=i+"px")}function c(e){document.documentElement.removeEventListener("mousemove",o),document.documentElement.removeEventListener("mouseup",c)}},OsQlvItemWidget=function(){this.handleDragDropItemRows=function(e){e.handleDragDrop=function(n,e,o,a,s){if("end"===n||"drop"===n)this.previousSibling.style.display="none","drop"===n&&Wt.emit(this,{name:"_drop",eventObject:this,event:o},a,s);else{e.className="Wt-valid-drop";let r=Wt.WT.target(o);for(;r&&(!r.classList||!r.classList.contains("OsQlvItemRow"));)r=r.parentNode;if(r){let e=0,t=r;for(;t&&(!t.classList||!t.classList.contains("OsQlvItem"));)t=t.parentNode;t&&(e=t.scrollTop,(n=o.y-r.offsetParent.offsetTop-t.offsetTop)<(a=2*r.offsetHeight)?e=t.scrollTop-a:n>t.offsetHeight-a&&(e=t.scrollTop+a),e!==t.scrollTop)&&(t.scroll({top:e,behavior:"smooth"}),e=t.scrollTop);s=o.y-r.offsetParent.offsetTop-r.offsetTop+e;let i=r.offsetTop-this.offsetTop-e;s>=r.offsetHeight/2&&(i+=r.offsetHeight),this.previousSibling.style.display="",this.previousSibling.style.transform="translateY("+i+"px)"}}}},this.scrollToRow=function(e){let t=e;for(;t&&(!t.classList||!t.classList.contains("OsQlvItem"));)t=t.parentNode;var i;t&&(i=e.offsetTop-t.offsetTop,t.scrollTop+t.offsetHeight-e.offsetHeight<i)&&(i=i-t.offsetHeight+2*e.offsetHeight,t.scroll({top:i,behavior:"smooth"}))}},OsStyledDialogHelper=(window.OsQlvItemWidget=new OsQlvItemWidget,function(){var s=this,r=(s.add=function(e){e=jQuery("[id$='"+e+"']")[0];e&&s.values.arr.push(e.id)},s.remove=function(e){e=s.values.arr.indexOf(e);0<=e&&s.values.arr.splice(e,1)},s.closeLast=function(){var e;s.values.arr.length&&(e=s.values.arr[s.values.arr.length-1],document.getElementById(e)&&window.getXeActiveDocument().RunCmd("^C^C"),s.remove(e))},/INPUT|TEXTAREA/i),n=0;$(document).bind("keyup",function(e){var t,i;s.values.arr.length&&(t=window.XeUtils.IsNoteCommand(window.getXeActiveDocument()),i=(r.test(e.target.tagName)||window.CFxUI.css_helper.hasStyleClass(e.target,"BalloonTextEdit"))&&!e.target.disabled&&!e.target.readOnly&&!e.target.xeAllowFireShortCuts,t||i||8===e.keyCode&&(n?(clearTimeout(n),n=0,s.closeLast()):n=setTimeout(function(){clearTimeout(n),n=0},300)))}),s.values={arr:[]},s.updatePosition=function(){var i=window.innerWidth,r=window.innerHeight;if(s.values.arr.length){var n=s.values.arr[s.values.arr.length-1],n=document.getElementById(n);if(null!=n){var o=n.getBoundingClientRect(),a=o.height;let e=o.x,t=o.y;(e=i<o.right?i-o.width:e)<0&&(e=0),(t=r<o.bottom?r-a:t)<36&&(t=36),n.style.left=e+"px",n.style.top=t+"px"}}}}),OsTableManager=function(){document.addEventListener("paste",function(e){var e=(e.clipboardData||window.clipboardData).getData("text/html"),i=e.length,r=indexedDB.open("TableDatabase",1);if(r.onerror=function(e){window.XeLogger.error("Error while opening table database:",e.target.errorCode)},r.onupgradeneeded=function(e){e.target.result.createObjectStore("pasteTableData",{autoIncrement:!0})},0<i&&e){let t=window.btoa(encodeURIComponent(e));r=t.length,i=(window.XeLogger.log("Size of pastedDataHtml:",r,"bytes (or",r/1024,"KB)"),indexedDB.open("TableDatabase",1));i.onerror=function(e){window.XeLogger.error("Error while opening table database:",e.target.errorCode)},i.onsuccess=function(e){var e=e.target.result;e.objectStoreNames.contains("pasteTableData")&&((e=e.transaction(["pasteTableData"],"readwrite").objectStore("pasteTableData").add(t)).onsuccess=function(e){window.XeLogger.log("Data stored in table database successfully")},e.onerror=function(e){window.XeLogger.error("Error while storing data in table database:",e.target.errorCode)})}}}),this.pasteFromCtrlV=function(){if(window!==window.parent&&window.osc)window.osc._gLI("oscopy").then(function(e){null===e&&(e="");var t=window.getXeActiveDocument();t.RunCmd(e+"\\n"),t.RunCmd(t.getXeInputPointManager().getCursorPosition().toString())});else{let e=localStorage.getItem("oscopy");null===e&&(e="");var t=window.getXeActiveDocument();t.RunCmd(e+"\\n"),t.RunCmd(t.getXeInputPointManager().getCursorPosition().toString())}},this.clearClipBoard=function(){var e=document.createElement("textarea");e.value=" ",e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),window.XeLogger.log("clip board data is cleared now from table paste")},this.OsClearClipBoardData=function(){window!==window.parent&&window.osc&&(window.osc._cOCT(),window.XeLogger.log("clip board data is cleared now from OnShape side post meassage"))},this.pasteTableFromCtrlV=function(r){var e;window!==window.parent&&window.osc&&((e=indexedDB.open("TableDatabase")).onerror=function(e){window.XeLogger.error("Error opening table database:",e.target.errorCode);window.getXeActiveDocument().RunCmd(" \\n")},e.onsuccess=function(e){let i=e.target.result;i.objectStoreNames.contains("pasteTableData")?((e=i.transaction(["pasteTableData"],"readonly").objectStore("pasteTableData").getAll()).onsuccess=function(e){var t,e=e.target.result;0<e.length?(e=e[0],(t=i.transaction(["pasteTableData"],"readwrite").objectStore("pasteTableData").clear()).onsuccess=function(e){window.XeLogger.log("Table Database records cleared successfully.")},t.onerror=function(e){window.XeLogger.error("Error in clearing TableDatabase records:",e.target.error)},(t=new XMLHttpRequest).open("POST",r,!0),t.setRequestHeader("Content-Type","application/octet-stream"),t.send(e)):window.getXeActiveDocument().RunCmd(" \\n")},e.onerror=function(e){window.XeLogger.error("Error retrieving data from table database:",e.target.errorCode);window.getXeActiveDocument().RunCmd(" \\n")}):window.getXeActiveDocument().RunCmd(" \\n")})},this.pasteFromRMB=function(i){window!==window.parent&&window.osc&&window.osc._gCT().then(function(e){null===e&&(e=" ");var t=new XMLHttpRequest;t.open("POST",i,!0),t.setRequestHeader("Content-Type","application/octet-stream"),t.send(e)})}},OsViewReplicationManager=function(){this.copyForReplication=function(e,t,i,r,n){window!==window.parent&&window.osc&&window.osc._pCFR(e,t,i,r,n)},this.replicateAnnotations=function(e,t,i,r,n,o,a){window!==window.parent&&window.osc&&window.osc._pRA(e,t,i,r,n,o,a)},this.clearSourceDrawingViewCorrespondence=function(){window!==window.parent&&window.osc&&window.osc._gCRVD()},this.getSourceDrawingViewCorrespondence=function(){window!==window.parent&&window.osc&&window.osc._gRV().then(function(e){null===e&&(e=" ");var t=window.getXeActiveDocument(),e=JSON.stringify(e);t.RunCmd(e)})}},g_StartTime=(window.XeCFxCommandLine=new XeCFxCommandLine,window.XeFxQtWidgetDimPalletManager=new XeFxQtWidgetDimPalletManager,window.CFxUITextViewImpl=new CFxUITextViewImpl,window.OsDlgMoveToSheet=new OsDlgMoveToSheet,window.OsDlgTableResize=new OsDlgTableResize,window.panelResizeHandler=new PanelResizeHandler,window.OsMiniToolbar=new OsMiniToolbar,window.OsStyledDialogHelper=new OsStyledDialogHelper,window.OsTableManager=new OsTableManager,window.OsViewReplicationManager=new OsViewReplicationManager,(l=>{function t(e,t,i){var r=!1,n=e.length(),o=t.length();return n<=l.equalVector()?o<=l.equalVector()&&(r=!0):o>l.equalVector()&&(e.x/=n,e.y/=n,e.z/=n,t.x/=o,t.y/=o,t.z/=o,r=i?e.isEqualTo(t)||e.isEqualTo(t.negate()):e.isEqualTo(t)),r}l.OdPositive=function(e,t=1e-10){return t<e},l.OdNegative=function(e,t=1e-10){return e<-t},l.OdZero=function(e,t=1e-10){return!l.OdPositive(e,t)&&!l.OdNegative(e,t)},l.OdNonZero=function(e,t=1e-10){return l.OdPositive(e,t)||l.OdNegative(e,t)},l.OdEqual=function(e,t,i=1e-10){return l.OdZero(e-t,i)},l.OdLess=function(e,t,i=1e-10){return e<t-i},l.OdLessOrEqual=function(e,t,i=1e-10){return e<=t+i},l.OdGreater=function(e,t,i=1e-10){return t+i<e},l.OdGreaterOrEqual=function(e,t,i=1e-10){return t-i<=e},l.OdCmpDouble=function(e,t,i=1e-10){return l.OdZero(e-t,i)?0:l.OdPositive(e-t,i)?1:-1},l.equalPoint=function(){return 1e-10},l.equalVector=function(){return 1e-10},l.OdGeMatrix3d=function(e){this.entry=[[],[],[],[]],void 0===e?this.setToIdentity():this.set(e)},l.OdGeMatrix3d.prototype.setToIdentity=function(){return this.entry[0][1]=this.entry[0][2]=this.entry[0][3]=this.entry[1][0]=this.entry[1][2]=this.entry[1][3]=this.entry[2][0]=this.entry[2][1]=this.entry[2][3]=this.entry[3][0]=this.entry[3][1]=this.entry[3][2]=0,this.entry[0][0]=this.entry[1][1]=this.entry[2][2]=this.entry[3][3]=1,this},l.OdGeMatrix3d.alignCoordSys=function(e,t,i,r,n,o,a,s){var c=new l.OdGeMatrix3d,e=(c.setCoordSystem(e,t,i,r),c.invert(),new l.OdGeMatrix3d);return e.setCoordSystem(n,o,a,s),e.mult(c)},l.OdGeMatrix3d.prototype.setToAlignCoordSys=function(e,t,i,r,n,o,a,s){return this.set(l.OdGeMatrix3d.alignCoordSys(e,t,i,r,n,o,a,s)),this},l.OdGeMatrix3d.prototype.det=function(){return this.entry[0][0]*this.entry[1][1]*this.entry[2][2]+this.entry[1][0]*this.entry[2][1]*this.entry[0][2]+this.entry[2][0]*this.entry[0][1]*this.entry[1][2]-this.entry[2][0]*this.entry[1][1]*this.entry[0][2]-this.entry[1][0]*this.entry[0][1]*this.entry[2][2]-this.entry[0][0]*this.entry[2][1]*this.entry[1][2]},l.OdGeMatrix3d.prototype.getCoordSystem=function(e,t,i,r){t.set(this.entry[0][0],this.entry[1][0],this.entry[2][0]),i.set(this.entry[0][1],this.entry[1][1],this.entry[2][1]),r.set(this.entry[0][2],this.entry[1][2],this.entry[2][2]),e.set(this.entry[0][3],this.entry[1][3],this.entry[2][3])},l.OdGeMatrix3d.prototype.getCsOrigin=function(){return new l.OdGeVector3d(this.entry[0][3],this.entry[1][3],this.entry[2][3])},l.OdGeMatrix3d.prototype.getCsXAxis=function(){return new l.OdGeVector3d(this.entry[0][0],this.entry[1][0],this.entry[2][0])},l.OdGeMatrix3d.prototype.getCsYAxis=function(){return new l.OdGeVector3d(this.entry[0][1],this.entry[1][1],this.entry[2][1])},l.OdGeMatrix3d.prototype.getCsZAxis=function(){return new l.OdGeVector3d(this.entry[0][2],this.entry[1][2],this.entry[2][2])},l.OdGeMatrix3d.prototype.invert=function(){return this.set(this.inverse()),this},l.OdGeMatrix3d.prototype.isEqualTo=function(e){for(var t=l.equalPoint(),i=0;i<4;++i)for(var r=0;r<4;++r)if(Math.abs(this.entry[i][r]-e.entry[i][r])>t)return!1;return!0},l.OdGeMatrix3d.prototype.norm=function(){for(var e=0,t=0;t<3;++t)for(var i=0;i<3;++i){var r=Math.abs(this.entry[t][i]);e<r&&(e=r)}return e},l.OdGeMatrix3d.rotation=function(e,t,i){return(new l.OdGeMatrix3d).setToRotation(e,t,i)},l.OdGeMatrix3d.translation=function(e){return(new l.OdGeMatrix3d).setToTranslation(e)},l.OdGeMatrix3d.prototype.scale=function(){var e=this.getCsXAxis().lengthSqrd(),t=this.getCsYAxis().lengthSqrd(),i=this.getCsZAxis().lengthSqrd();return Math.sqrt(Math.max(e,t,i))},l.OdGeMatrix3d.prototype.mult=function(e){return(new l.OdGeMatrix3d).setToProduct(this,e)},l.OdGeMatrix3d.prototype.multToVector=function(e){var t=new l.OdGeVector3d;return t.x=this.entry[0][0]*e.x+this.entry[0][1]*e.y+this.entry[0][2]*e.z,t.y=this.entry[1][0]*e.x+this.entry[1][1]*e.y+this.entry[1][2]*e.z,t.z=this.entry[2][0]*e.x+this.entry[2][1]*e.y+this.entry[2][2]*e.z,t},l.OdGeMatrix3d.prototype.setCoordSystem=function(e,t,i,r){return this.entry[0][0]=t.x,this.entry[1][0]=t.y,this.entry[2][0]=t.z,this.entry[3][0]=0,this.entry[0][1]=i.x,this.entry[1][1]=i.y,this.entry[2][1]=i.z,this.entry[3][1]=0,this.entry[0][2]=r.x,this.entry[1][2]=r.y,this.entry[2][2]=r.z,this.entry[3][2]=0,this.entry[0][3]=e.x,this.entry[1][3]=e.y,this.entry[2][3]=e.z,this.entry[3][3]=1,this},l.OdGeMatrix3d.prototype.setToProduct=function(e,t){var i=new l.OdGeMatrix3d;return i.entry[0][0]=t.entry[0][0]*e.entry[0][0]+t.entry[1][0]*e.entry[0][1]+t.entry[2][0]*e.entry[0][2]+t.entry[3][0]*e.entry[0][3],i.entry[1][0]=t.entry[0][0]*e.entry[1][0]+t.entry[1][0]*e.entry[1][1]+t.entry[2][0]*e.entry[1][2]+t.entry[3][0]*e.entry[1][3],i.entry[2][0]=t.entry[0][0]*e.entry[2][0]+t.entry[1][0]*e.entry[2][1]+t.entry[2][0]*e.entry[2][2]+t.entry[3][0]*e.entry[2][3],i.entry[3][0]=t.entry[0][0]*e.entry[3][0]+t.entry[1][0]*e.entry[3][1]+t.entry[2][0]*e.entry[3][2]+t.entry[3][0]*e.entry[3][3],i.entry[0][1]=t.entry[0][1]*e.entry[0][0]+t.entry[1][1]*e.entry[0][1]+t.entry[2][1]*e.entry[0][2]+t.entry[3][1]*e.entry[0][3],i.entry[1][1]=t.entry[0][1]*e.entry[1][0]+t.entry[1][1]*e.entry[1][1]+t.entry[2][1]*e.entry[1][2]+t.entry[3][1]*e.entry[1][3],i.entry[2][1]=t.entry[0][1]*e.entry[2][0]+t.entry[1][1]*e.entry[2][1]+t.entry[2][1]*e.entry[2][2]+t.entry[3][1]*e.entry[2][3],i.entry[3][1]=t.entry[0][1]*e.entry[3][0]+t.entry[1][1]*e.entry[3][1]+t.entry[2][1]*e.entry[3][2]+t.entry[3][1]*e.entry[3][3],i.entry[0][2]=t.entry[0][2]*e.entry[0][0]+t.entry[1][2]*e.entry[0][1]+t.entry[2][2]*e.entry[0][2]+t.entry[3][2]*e.entry[0][3],i.entry[1][2]=t.entry[0][2]*e.entry[1][0]+t.entry[1][2]*e.entry[1][1]+t.entry[2][2]*e.entry[1][2]+t.entry[3][2]*e.entry[1][3],i.entry[2][2]=t.entry[0][2]*e.entry[2][0]+t.entry[1][2]*e.entry[2][1]+t.entry[2][2]*e.entry[2][2]+t.entry[3][2]*e.entry[2][3],i.entry[3][2]=t.entry[0][2]*e.entry[3][0]+t.entry[1][2]*e.entry[3][1]+t.entry[2][2]*e.entry[3][2]+t.entry[3][2]*e.entry[3][3],i.entry[0][3]=t.entry[0][3]*e.entry[0][0]+t.entry[1][3]*e.entry[0][1]+t.entry[2][3]*e.entry[0][2]+t.entry[3][3]*e.entry[0][3],i.entry[1][3]=t.entry[0][3]*e.entry[1][0]+t.entry[1][3]*e.entry[1][1]+t.entry[2][3]*e.entry[1][2]+t.entry[3][3]*e.entry[1][3],i.entry[2][3]=t.entry[0][3]*e.entry[2][0]+t.entry[1][3]*e.entry[2][1]+t.entry[2][3]*e.entry[2][2]+t.entry[3][3]*e.entry[2][3],i.entry[3][3]=t.entry[0][3]*e.entry[3][0]+t.entry[1][3]*e.entry[3][1]+t.entry[2][3]*e.entry[3][2]+t.entry[3][3]*e.entry[3][3],this.set(i)},l.OdGeMatrix3d.worldToPlane=function(e){var t=new l.OdGeMatrix3d;return t.setToWorldToPlane(e),t},l.OdGeMatrix3d.planeToWorld=function(e){var t=new l.OdGeMatrix3d;return t.setToPlaneToWorld(e),t},l.OdGeMatrix3d.prototype.setToRotation=function(e,t,i){this.setToIdentity();var i=i||l.OdGePoint3d.kOrigin,r=Math.abs(e);return r<1e-10||1e10<r||(this.entry[0][0]=this.entry[1][1]=Math.cos(e),this.entry[0][1]=-(this.entry[1][0]=Math.sin(e)),t.isEqualTo(l.OdGeVector3d.kZAxis)?(r=l.OdGeMatrix3d.translation(i.asVector()),e=l.OdGeMatrix3d.translation(i.asVector().negate()),this.set(r.mult(this.mult(e)))):(r=l.OdGeMatrix3d.translation(i.asVector()),e=l.OdGeMatrix3d.translation(i.asVector().negate()),i=l.OdGeMatrix3d.planeToWorld(t),t=l.OdGeMatrix3d.worldToPlane(t),this.set(r.mult(i.mult(this.mult(t.mult(e))))))),this},l.OdGeMatrix3d.prototype.setToTranslation=function(e){return this.setToIdentity(),this.setTranslation(e),this},l.OdGeMatrix3d.prototype.setToScaling=function(e,t){return this.setToIdentity(),this.entry[0][0]=this.entry[1][1]=this.entry[2][2]=e,this.entry[0][3]=-t.x*e+t.x,this.entry[1][3]=-t.y*e+t.y,this.entry[2][3]=-t.z*e+t.z,this},l.OdGeMatrix3d.prototype.transpose=function(){for(var e=new l.OdGeMatrix3d,t=0;t<4;t++)for(var i=0;i<4;i++)e.entry[t][i]=this.entry[i][t];return e},l.OdGeMatrix3d.prototype.setTranslation=function(e){return this.entry[0][3]=e.x,this.entry[1][3]=e.y,this.entry[2][3]=e.z,this},l.OdGeMatrix3d.prototype.inverse=function(){var e=new l.OdGeMatrix3d,t=this.det();return Math.abs(t)<1e-300?null:(e.entry[0][0]=(this.entry[1][1]*this.entry[2][2]-this.entry[1][2]*this.entry[2][1])/t,e.entry[0][1]=-(this.entry[0][1]*this.entry[2][2]-this.entry[0][2]*this.entry[2][1])/t,e.entry[0][2]=(this.entry[0][1]*this.entry[1][2]-this.entry[0][2]*this.entry[1][1])/t,e.entry[0][3]=-(this.entry[0][1]*this.entry[1][2]*this.entry[2][3]+this.entry[0][2]*this.entry[1][3]*this.entry[2][1]+this.entry[0][3]*this.entry[1][1]*this.entry[2][2]-this.entry[0][3]*this.entry[1][2]*this.entry[2][1]-this.entry[0][2]*this.entry[1][1]*this.entry[2][3]-this.entry[0][1]*this.entry[1][3]*this.entry[2][2])/t,e.entry[1][0]=-(this.entry[1][0]*this.entry[2][2]-this.entry[1][2]*this.entry[2][0])/t,e.entry[1][1]=(this.entry[0][0]*this.entry[2][2]-this.entry[0][2]*this.entry[2][0])/t,e.entry[1][2]=-(this.entry[0][0]*this.entry[1][2]-this.entry[0][2]*this.entry[1][0])/t,e.entry[1][3]=(this.entry[0][0]*this.entry[1][2]*this.entry[2][3]+this.entry[0][2]*this.entry[1][3]*this.entry[2][0]+this.entry[0][3]*this.entry[1][0]*this.entry[2][2]-this.entry[0][3]*this.entry[1][2]*this.entry[2][0]-this.entry[0][2]*this.entry[1][0]*this.entry[2][3]-this.entry[0][0]*this.entry[1][3]*this.entry[2][2])/t,e.entry[2][0]=(this.entry[1][0]*this.entry[2][1]-this.entry[1][1]*this.entry[2][0])/t,e.entry[2][1]=-(this.entry[0][0]*this.entry[2][1]-this.entry[0][1]*this.entry[2][0])/t,e.entry[2][2]=(this.entry[0][0]*this.entry[1][1]-this.entry[0][1]*this.entry[1][0])/t,e.entry[2][3]=-(this.entry[0][0]*this.entry[1][1]*this.entry[2][3]+this.entry[0][1]*this.entry[1][3]*this.entry[2][0]+this.entry[0][3]*this.entry[1][0]*this.entry[2][1]-this.entry[0][3]*this.entry[1][1]*this.entry[2][0]-this.entry[0][1]*this.entry[1][0]*this.entry[2][3]-this.entry[0][0]*this.entry[1][3]*this.entry[2][1])/t,e)},l.OdGeMatrix3d.prototype.setToWorldToPlane=function(e){return this.setToPlaneToWorld(e),this.invert()},l.OdGeMatrix3d.prototype.setToPlaneToWorld=function(e){var t,e=e.normal(),i=(Math.abs(e.x)<.015625&&Math.abs(e.y)<.015625?l.OdGeVector3d.kYAxis:l.OdGeVector3d.kZAxis).crossProduct(e);return i.normalize(),t=e.crossProduct(i),this.setCoordSystem(l.OdGePoint3d.kOrigin,i,t,e),this},l.OdGeMatrix3d.prototype.get=function(e,t){return this.entry[e][t]},l.OdGeMatrix3d.prototype.setentry=function(e,t,i){this.entry[e][t]=i},l.OdGeMatrix3d.prototype.toGLArray=function(e){e&&!this.entry_number_array&&(this.entry_number_array=new Array(16)),this.entry_float32_array||(this.entry_float32_array=new Float32Array(16));var t=this.entry,e=e?this.entry_number_array:this.entry_float32_array;return e[0]=t[0][0],e[1]=t[1][0],e[2]=t[2][0],e[3]=t[3][0],e[4]=t[0][1],e[5]=t[1][1],e[6]=t[2][1],e[7]=t[3][1],e[8]=t[0][2],e[9]=t[1][2],e[10]=t[2][2],e[11]=t[3][2],e[12]=t[0][3],e[13]=t[1][3],e[14]=t[2][3],e[15]=t[3][3],e},l.OdGeMatrix3d.prototype.toArray=function(){this.entry_number_array||(this.entry_number_array=new Array(16));var e=this.entry,t=this.entry_number_array;return t[0]=e[0][0],t[1]=e[0][1],t[2]=e[0][2],t[3]=e[0][3],t[4]=e[1][0],t[5]=e[1][1],t[6]=e[1][2],t[7]=e[1][3],t[8]=e[2][0],t[9]=e[2][1],t[10]=e[2][2],t[11]=e[2][3],t[12]=e[3][0],t[13]=e[3][1],t[14]=e[3][2],t[15]=e[3][3],t},l.OdGeMatrix3d.prototype.fromFlatArray=function(e){var t=this.entry;return t[0][0]=e[0],t[0][1]=e[1],t[0][2]=e[2],t[0][3]=e[3],t[1][0]=e[4],t[1][1]=e[5],t[1][2]=e[6],t[1][3]=e[7],t[2][0]=e[8],t[2][1]=e[9],t[2][2]=e[10],t[2][3]=e[11],t[3][0]=e[12],t[3][1]=e[13],t[3][2]=e[14],t[3][3]=e[15],this},l.OdGeMatrix3d.prototype.set=function(e){var t=this.entry,e=e instanceof Array?e:e.entry;return t[0][0]=e[0][0],t[0][1]=e[0][1],t[0][2]=e[0][2],t[0][3]=e[0][3],t[1][0]=e[1][0],t[1][1]=e[1][1],t[1][2]=e[1][2],t[1][3]=e[1][3],t[2][0]=e[2][0],t[2][1]=e[2][1],t[2][2]=e[2][2],t[2][3]=e[2][3],t[3][0]=e[3][0],t[3][1]=e[3][1],t[3][2]=e[3][2],t[3][3]=e[3][3],this},l.OdGeMatrix3d.kIdentity=new l.OdGeMatrix3d,l.OdGeMatrix2d=function(e){this.entry=[[],[],[]],void 0===e?this.setToIdentity():this.entry=e.entry},l.OdGeMatrix2d.prototype.setToIdentity=function(){return this.entry[0][1]=this.entry[0][2]=this.entry[1][0]=this.entry[1][2]=this.entry[2][0]=this.entry[2][1]=0,this.entry[0][0]=this.entry[1][1]=this.entry[2][2]=1,this},l.OdGeMatrix2d.prototype.setCoordSystem=function(e,t,i){return this.setToIdentity(),this.entry[0][0]=t.x,this.entry[1][0]=t.y,this.entry[0][1]=i.x,this.entry[1][1]=i.y,this.entry[0][2]=e.x,this.entry[1][2]=e.y,this},l.OdGeMatrix2d.prototype.get=function(e,t){return this.entry[e][t]},l.OdGeMatrix2d.prototype.setentry=function(e,t,i){this.entry[e][t]=i},l.OdGeMatrix2d.rotation=function(e,t){return(new l.OdGeMatrix2d).setToRotation(e,t)},l.OdGeMatrix2d.prototype.setToRotation=function(e,t){var i=Math.cos(e),e=Math.sin(e);return this.entry[0][0]=i,this.entry[1][0]=e,this.entry[2][0]=0,this.entry[0][1]=-e,this.entry[1][1]=i,this.entry[2][1]=0,this.entry[0][2]=t.x-t.x*i+t.y*e,this.entry[1][2]=t.y-t.x*e-t.y*i,this.entry[2][2]=1,this},l.OdGeMatrix2d.kIdentity=new l.OdGeMatrix2d,l.OdGePoint3d=function(e,t,i){this.set(e,t,i)},l.OdGePoint3d.prototype.assign=function(e){this.x=e.x,this.y=e.y,this.z=e.z},l.OdGePoint3d.prototype.setToProduct=function(e,t){var i=new l.OdGePoint3d,r=e.get(3,0)*t.x+e.get(3,1)*t.y+e.get(3,2)*t.z+e.get(3,3);return i.x=(e.get(0,0)*t.x+e.get(0,1)*t.y+e.get(0,2)*t.z+e.get(0,3))/r,i.y=(e.get(1,0)*t.x+e.get(1,1)*t.y+e.get(1,2)*t.z+e.get(1,3))/r,i.z=(e.get(2,0)*t.x+e.get(2,1)*t.y+e.get(2,2)*t.z+e.get(2,3))/r,this.set(i)},l.OdGePoint3d.prototype.setToSum=function(e,t){var i=new l.OdGePoint3d;return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,this.set(i)},l.OdGePoint3d.prototype.setToDiff=function(e,t){var i=new l.OdGePoint3d;return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,this.set(i)},l.OdGePoint3d.prototype.transformBy=function(e){var t=this.x,i=this.y,r=this.z,n=e.get(3,0)*t+e.get(3,1)*i+e.get(3,2)*r+e.get(3,3);return this.x=(e.get(0,0)*t+e.get(0,1)*i+e.get(0,2)*r+e.get(0,3))/n,this.y=(e.get(1,0)*t+e.get(1,1)*i+e.get(1,2)*r+e.get(1,3))/n,this.z=(e.get(2,0)*t+e.get(2,1)*i+e.get(2,2)*r+e.get(2,3))/n,this},l.OdGePoint3d.prototype.distanceTo=function(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y)+(this.z-e.z)*(this.z-e.z))},l.OdGePoint3d.prototype.asVector=function(){return new l.OdGeVector3d(this.x,this.y,this.z)},l.OdGePoint3d.prototype.rotateBy=function(e,t,i){return this.transformBy(l.OdGeMatrix3d.rotation(e,t,i))},l.OdGePoint3d.prototype.scaleBy=function(e,t){var i=(i=this.sub(t)).mult(e);return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},l.OdGePoint3d.prototype.isEqualTo=function(e,t){return this.sub(e).isZeroLength(t)},l.OdGePoint3d.prototype.set=function(e,t,i){return void 0===e?(this.x=0,this.y=0,this.z=0):Array.isArray(e)?(this.x=e[0],this.y=e[1],this.z=e[2]):e instanceof l.OdGePoint3d?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=t,this.z=i),this},l.OdGePoint3d.prototype.add=function(e){return new(e instanceof l.OdGePoint3d?l.OdGeVector3d:l.OdGePoint3d)(this.x+e.x,this.y+e.y,this.z+e.z)},l.OdGePoint3d.prototype.addAssign=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},l.OdGePoint3d.prototype.getCopy=function(){return new l.OdGePoint3d(this)},l.OdGePoint3d.prototype.uminus=function(){return new l.OdGePoint3d(-this.x,-this.y,-this.z)},l.OdGePoint3d.prototype.sub=function(e){return new(e instanceof l.OdGePoint3d?l.OdGeVector3d:l.OdGePoint3d)(this.x-e.x,this.y-e.y,this.z-e.z)},l.OdGePoint3d.prototype.translate=function(e){return new l.OdGePoint3d(this.x+e.x,this.y+e.y,this.z+e.z)},l.OdGePoint3d.prototype.convert2d=function(){return new l.OdGePoint2d(this.x,this.y)},l.OdGePoint3d.kOrigin=new l.OdGePoint3d,l.OdGePoint2d=function(e,t){this.set(e,t)},l.OdGePoint2d.prototype.assign=function(e){this.x=e.x,this.y=e.y},l.OdGePoint2d.prototype.setToProduct=function(e,t){var i=new l.OdGePoint2d;return i.x=e.get(0,0)*t.x+e.get(0,1)*t.y+e.get(0,2),i.y=e.get(1,0)*t.x+e.get(1,1)*t.y+e.get(1,2),this.set(i)},l.OdGePoint2d.prototype.setToSum=function(e,t){var i=new l.OdGePoint2d;return i.x=e.x+t.x,i.y=e.y+t.y,this.set(i)},l.OdGePoint2d.prototype.setToDiff=function(e,t){var i=new l.OdGePoint2d;return i.x=e.x-t.x,i.y=e.y-t.y,this.set(x)},l.OdGePoint2d.prototype.transformBy=function(e){var t=this.x,i=this.y;return this.x=e.get(0,0)*t+e.get(0,1)*i+e.get(0,2),this.y=e.get(1,0)*t+e.get(1,1)*i+e.get(1,2),this},l.OdGePoint2d.prototype.distanceTo=function(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))},l.OdGePoint2d.prototype.asVector=function(){return new l.OdGeVector2d(this.x,this.y)},l.OdGePoint2d.prototype.rotateBy=function(e,t,i){return this.transformBy(l.OdGeMatrix2d.rotation(e,t,i))},l.OdGePoint2d.prototype.scaleBy=function(e,t){return this.x=t.x+(this.x-t.x)*e,this.y=t.y+(this.y-t.y)*e,this},l.OdGePoint2d.prototype.set=function(e,t){return void 0===e?(this.x=0,this.y=0):Array.isArray(e)?(this.x=e[0],this.y=e[1]):e instanceof l.OdGePoint2d?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t),this},l.OdGePoint2d.prototype.add=function(e){return new(e instanceof l.OdGePoint2d?l.OdGeVector2d:l.OdGePoint2d)(this.x+e.x,this.y+e.y)},l.OdGePoint2d.prototype.sub=function(e){return new(e instanceof l.OdGePoint2d?l.OdGeVector2d:l.OdGePoint2d)(this.x-e.x,this.y-e.y)},l.OdGePoint2d.prototype.translate=function(e){return new l.OdGePoint2d(this.x+e.x,this.y+e.y)},l.OdGePoint2d.prototype.getCopy=function(){return new l.OdGePoint2d(this)},l.OdGePoint2d.prototype.uminus=function(){return new l.OdGePoint2d(-this.x,-this.y)},l.OdGePoint2d.kOrigin=new l.OdGePoint2d,l.OdGeVector3d=function(e,t,i){this.set(e,t,i)},l.OdGeVector3d.prototype.assign=function(e){this.x=e.x,this.y=e.y,this.z=e.z},l.OdGeVector3d.prototype.setToSum=function(e,t){var i=new l.OdGeVector3d;return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,this.set(i)},l.OdGeVector3d.prototype.setToDiff=function(e,t){var i=new l.OdGeVector3d;return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,this.set(i)},l.OdGeVector3d.prototype.setToProduct=function(e,t){var i=new l.OdGeVector3d;return i.x=e.get(0,0)*t.x+e.get(0,1)*t.y+e.get(0,2)*t.z,i.y=e.get(1,0)*t.x+e.get(1,1)*t.y+e.get(1,2)*t.z,i.z=e.get(2,0)*t.x+e.get(2,1)*t.y+e.get(2,2)*t.z,this.set(i)},l.OdGeVector3d.prototype.perpVector=function(){var e=this.normal(),t=new l.OdGeVector3d;return Math.abs(e.x)<1/64&&Math.abs(e.y)<1/64?(t.x=e.z,t.y=0,t.z=-e.x):(t.x=-e.y,t.y=e.x,t.z=0),t.normalize(),t},l.OdGeVector3d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},l.OdGeVector3d.prototype.length=function(){var e=Math.abs(this.x),t=Math.abs(this.y),i=Math.abs(this.z);let r=t<e?e:t;return 0==(r=i>r?i:r)?0:(e=this.x/r,t=this.y/r,i=this.z/r,Math.sqrt(e*e+t*t+i*i)*r)},l.OdGeVector3d.prototype.lengthSqrd=function(){return this.x*this.x+this.y*this.y+this.z*this.z},l.OdGeVector3d.prototype.rotateBy=function(e,t){var i=new l.OdGeMatrix3d;return i.setToRotation(e,t),this.setToProduct(i,this)},l.OdGeVector3d.prototype.transformBy=function(e){return this.setToProduct(e,this)},l.OdGeVector3d.prototype.dotProduct=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},l.OdGeVector3d.prototype.crossProduct=function(e){return new l.OdGeVector3d(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},l.OdGeVector3d.prototype.isCodirectionalTo=function(e){return t(new l.OdGeVector3d(this),new l.OdGeVector3d(e),!1)},l.OdGeVector3d.prototype.isParallelTo=function(e){return t(new l.OdGeVector3d(this),new l.OdGeVector3d(e),!0)},l.OdGeVector3d.prototype.isPerpendicularTo=function(e){var t=new l.OdGeVector3d(this),e=(t.normalize(),new l.OdGeVector3d(e));return e.normalize(),Math.abs(t.dotProduct(e))<=l.equalVector()},l.OdGeVector3d.prototype.set=function(e,t,i){return void 0===e?(this.x=0,this.y=0,this.z=0):Array.isArray(e)?(this.x=e[0],this.y=e[1],this.z=e[2]):e instanceof l.OdGeVector3d||e instanceof l.OdGePoint3d?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=t,this.z=i),this},l.OdGeVector3d.prototype.mult=function(e){return new l.OdGeVector3d(this.x*e,this.y*e,this.z*e)},l.OdGeVector3d.prototype.add=function(e){return new l.OdGeVector3d(this.x+e.x,this.y+e.y,this.z+e.z)},l.OdGeVector3d.prototype.sub=function(e){return new l.OdGeVector3d(this.x-e.x,this.y-e.y,this.z-e.z)},l.OdGeVector3d.prototype.multAssign=function(e){return this.x*=e,this.y*=e,this.z*=e,this},l.OdGeVector3d.prototype.addAssign=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},l.OdGeVector3d.prototype.normal=function(){var e=new l.OdGeVector3d(this);return e.normalize(),e},l.OdGeVector3d.prototype.getCopy=function(){return new l.OdGeVector3d(this)},l.OdGeVector3d.prototype.uminus=function(){return new l.OdGeVector3d(-this.x,-this.y,-this.z)},l.OdGeVector3d.prototype.orthoProject=function(e){e=e.normal(),e=e.mult(e.dotProduct(this));return this.sub(e)},l.OdGeVector3d.prototype.angleTo=function(e,t){var i,r;return void 0===t?(r=this.dotProduct(e),(i=this.crossProduct(e).length())?Math.atan2(i,r):0<=r?0:Math.PI):(i=this.dotProduct(e),r=this.crossProduct(e),(e=0<=t.dotProduct(r)?r.length():-r.length())?0<=(t=Math.atan2(e,i))?t:t+2*Math.PI:0<=i?0:Math.PI)},l.OdGeVector3d.prototype.normalize=function(){var e=this.length();if(e<l.equalVector())throw"eInvalidInput";return this.x/=e,this.y/=e,this.z/=e,this},l.OdGeVector3d.prototype.isEqualTo=function(e){return Math.abs(this.x-e.x)<=l.equalVector()&&Math.abs(this.y-e.y)<=l.equalVector()&&Math.abs(this.z-e.z)<=l.equalVector()},l.OdGeVector3d.prototype.isZeroLength=function(e){return Number.isFinite(e)||(e=l.equalVector()),this.lengthSqrd()<=e*e},l.OdGeVector3d.prototype.convert2d=function(){return new l.OdGeVector2d(this.x,this.y)},l.OdGeVector3d.kIdentity=new l.OdGeVector3d(0,0,0),l.OdGeVector3d.kXAxis=new l.OdGeVector3d(1,0,0),l.OdGeVector3d.kYAxis=new l.OdGeVector3d(0,1,0),l.OdGeVector3d.kZAxis=new l.OdGeVector3d(0,0,1),l.OdGeVector2d=function(e,t){this.set(e,t)},l.OdGeVector2d.prototype.assign=function(e){this.x=e.x,this.y=e.y},l.OdGeVector2d.prototype.setToSum=function(e,t){var i=new l.OdGeVector2d;return i.x=e.x+t.x,i.y=e.y+t.y,this.set(i)},l.OdGeVector2d.prototype.setToDiff=function(e,t){var i=new l.OdGeVector2d;return i.x=e.x-t.x,i.y=e.y-t.y,this.set(i)},l.OdGeVector2d.prototype.setToProduct=function(e,t){var i=new l.OdGeVector2d;return i.x=e.get(0,0)*t.x+e.get(0,1)*t.y,i.y=e.get(1,0)*t.x+e.get(1,1)*t.y,this.set(i)},l.OdGeVector2d.prototype.perpVector=function(){return new l.OdGeVector2d(-this.y,this.x)},l.OdGeVector2d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},l.OdGeVector2d.prototype.length=function(){var e=Math.abs(this.x),t=Math.abs(this.y),i=t<e?e:t;return 0==i?0:(e=this.x/i,t=this.y/i,Math.sqrt(e*e+t*t)*i)},l.OdGeVector2d.prototype.lengthSqrd=function(){return this.x*this.x+this.y*this.y},l.OdGeVector2d.prototype.rotateBy=function(e){var t=Math.sin(e),e=Math.cos(e);return this.set(this.x*e-this.y*t,this.x*t+this.y*e),this},l.OdGeVector2d.prototype.transformBy=function(e){return this.setToProduct(e,this)},l.OdGeVector2d.prototype.dotProduct=function(e){return this.x*e.x+this.y*e.y},l.OdGeVector2d.prototype.crossProduct=function(e){return this.x*e.y-this.y*e.x},l.OdGeVector2d.prototype.isCodirectionalTo=function(e){return console.error("isCodirectionalTo"),!0},l.OdGeVector2d.prototype.isParallelTo=function(e){return console.error("isParallelTo"),!0},l.OdGeVector2d.prototype.isPerpendicularTo=function(e){return console.error("isPerpendicularTo"),!0},l.OdGeVector2d.prototype.set=function(e,t){return void 0===e?(this.x=0,this.y=0):Array.isArray(e)?(this.x=e[0],this.y=e[1]):e instanceof l.OdGeVector2d||e instanceof l.OdGePoint2d?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t),this},l.OdGeVector2d.prototype.mult=function(e){return new l.OdGeVector2d(this.x*e,this.y*e)},l.OdGeVector2d.prototype.add=function(e){return new l.OdGeVector2d(this.x+e.x,this.y+e.y)},l.OdGeVector2d.prototype.sub=function(e){return new l.OdGeVector2d(this.x-e.x,this.y-e.y)},l.OdGeVector2d.prototype.normal=function(){var e=new l.OdGeVector2d(this);return e.normalize(),e},l.OdGeVector2d.prototype.angleTo=function(e){var t=this.dotProduct(e),e=Math.abs(this.crossProduct(e));return e?Math.atan2(e,t):0<=t?0:Math.PI},l.OdGeVector2d.prototype.normalize=function(){var e=this.length();if(e<l.equalVector())throw"eInvalidInput";return this.x/=e,this.y/=e,this},l.OdGeVector2d.prototype.isEqualTo=function(e){return Math.abs(this.x-e.x)<=l.equalVector()&&Math.abs(this.y-e.y)<=l.equalVector()},l.OdGeVector2d.prototype.isZeroLength=function(){return this.lengthSqrd()<=l.equalVector()*l.equalVector()},l.OdGeVector2d.prototype.getCopy=function(){return new l.OdGeVector2d(this)},l.OdGeVector2d.prototype.uminus=function(){return new l.OdGeVector2d(-this.x,-this.y)},l.OdGeVector2d.kIdentity=new l.OdGeVector2d(0,0),l.OdGeVector2d.kXAxis=new l.OdGeVector2d(1,0),l.OdGeVector2d.kYAxis=new l.OdGeVector2d(0,1),l.OdGeExtents3d=function(e,t){void 0!==e&&void 0!==t?(this._minPoint=new l.OdGePoint3d(e),this._maxPoint=new l.OdGePoint3d(t)):(this._minPoint=new l.OdGePoint3d(1e20,1e20,1e20),this._maxPoint=new l.OdGePoint3d(-1e20,-1e20,-1e20))},l.OdGeExtents3d.prototype.minPoint=function(){return new l.OdGePoint3d(this._minPoint)},l.OdGeExtents3d.prototype.maxPoint=function(){return new l.OdGePoint3d(this._maxPoint)},l.OdGeExtents3d.prototype.center=function(){return new l.OdGePoint3d((this._minPoint.x+this._maxPoint.x)/2,(this._minPoint.y+this._maxPoint.y)/2,(this._minPoint.z+this._maxPoint.z)/2)},l.OdGeExtents3d.prototype.set=function(e,t){return this._minPoint=e,this._maxPoint=t,this},l.OdGeExtents3d.prototype.isValidExtents=function(){return this._maxPoint.x>=this._minPoint.x&&this._maxPoint.y>=this._minPoint.y&&this._maxPoint.z>=this._minPoint.z},l.OdGeExtents3d.prototype.transformBy=function(e){var t=this._maxPoint.sub(this._minPoint);this._maxPoint.set(this._minPoint.transformBy(e)),l.OdNonZero(t.x,1e-200)&&this.expandBy(l.OdGeVector3d.kXAxis.mult(t.x).transformBy(e)),l.OdNonZero(t.y,1e-200)&&this.expandBy(l.OdGeVector3d.kYAxis.mult(t.y).transformBy(e)),l.OdNonZero(t.z,1e-200)&&this.expandBy(l.OdGeVector3d.kZAxis.mult(t.z).transformBy(e))},l.OdGeExtents3d.prototype.expandBy=function(e){var t=this._minPoint.add(e),e=this._maxPoint.add(e);this.addPoint(t),this.addPoint(e)},l.OdGeExtents3d.prototype.addPoint=function(e){this._maxPoint.x<this._minPoint.x||this._maxPoint.y<this._minPoint.y||this._maxPoint.z<this._minPoint.z?(this._maxPoint.set(e.x,e.y,e.z),this._minPoint.set(e.x,e.y,e.z)):(this._maxPoint.x<e.x?this._maxPoint.x=e.x:this._minPoint.x>e.x&&(this._minPoint.x=e.x),this._maxPoint.y<e.y?this._maxPoint.y=e.y:this._minPoint.y>e.y&&(this._minPoint.y=e.y),this._maxPoint.z<e.z?this._maxPoint.z=e.z:this._minPoint.z>e.z&&(this._minPoint.z=e.z))},l.OdGeExtents3d.prototype.contains=function(e){return e.x+l.equalPoint()>=this._minPoint.x&&e.y+l.equalPoint()>=this._minPoint.y&&e.z+l.equalPoint()>=this._minPoint.z&&e.x-l.equalPoint()<=this._maxPoint.x&&e.y-l.equalPoint()<=this._maxPoint.y&&e.z-l.equalPoint()<=this._maxPoint.z},l.OdGeExtents3d.prototype.intersectWithExtents=function(e){return this.isDisjointExtents(e)?l.OdGeExtents3d.kIntersectNot:this.containsExtents(e)?l.OdGeExtents3d.kIntersectOpIn:e.containsExtents(this)?l.OdGeExtents3d.kIntersectOpOut:l.OdGeExtents3d.kIntersectOk},l.OdGeExtents3d.prototype.isDisjointExtents=function(e){return e._minPoint.x-l.equalPoint()>this._maxPoint.x||e._minPoint.y-l.equalPoint()>this._maxPoint.y||e._minPoint.z-l.equalPoint()>this._maxPoint.z||this._minPoint.x>e._maxPoint.x+l.equalPoint()||this._minPoint.y>e._maxPoint.y+l.equalPoint()||this._minPoint.z>e._maxPoint.z+l.equalPoint()},l.OdGeExtents3d.prototype.containsExtents=function(e){return e._minPoint.x+l.equalPoint()>=this._minPoint.x&&e._minPoint.y+l.equalPoint()>=this._minPoint.y&&e._minPoint.z+l.equalPoint()>=this._minPoint.z&&this._maxPoint.x>=e._maxPoint.x-l.equalPoint()&&this._maxPoint.y>=e._maxPoint.y-l.equalPoint()&&this._maxPoint.z>=e._maxPoint.z-l.equalPoint()},l.OdGeExtents3d.kIntersectUnknown=0,l.OdGeExtents3d.kIntersectNot=1,l.OdGeExtents3d.kIntersectOpIn=2,l.OdGeExtents3d.kIntersectOpOut=3,l.OdGeExtents3d.kIntersectOk=4,l.OdGeExtents2d=function(e,t){void 0!==e&&void 0!==t?(this._minPoint=new l.OdGePoint2d(e),this._maxPoint=new l.OdGePoint2d(t)):(this._minPoint=new l.OdGePoint2d(1e20,1e20),this._maxPoint=new l.OdGePoint2d(-1e20,-1e20))},l.OdGeExtents2d.prototype.minPoint=function(){return new l.OdGePoint2d(this._minPoint)},l.OdGeExtents2d.prototype.maxPoint=function(){return new l.OdGePoint2d(this._maxPoint)},l.OdGeExtents2d.prototype.center=function(){return new l.OdGePoint2d((this._minPoint.x+this._maxPoint.x)/2,(this._minPoint.y+this._maxPoint.y)/2)},l.OdGeExtents2d.prototype.set=function(e,t){return this._minPoint.set(e.x,e.y,e.z),this._maxPoint.set(t.x,t.y,t.z),this},l.OdGeExtents2d.prototype.isValidExtents=function(){return this._maxPoint.x>=this._minPoint.x&&this._maxPoint.y>=this._minPoint.y},l.OdGeExtents2d.prototype.transformBy=function(e){var t=this._maxPoint.sub(this._minPoint);return this._maxPoint.set(this._minPoint.transformBy(e)),l.OdNonZero(t.x,1e-200)&&this.expandBy(l.OdGeVector2d.kXAxis.mult(t.x).transformBy(e)),l.OdNonZero(t.y,1e-200)&&this.expandBy(l.OdGeVector2d.kYAxis.mult(t.y).transformBy(e)),this},l.OdGeExtents2d.prototype.expandBy=function(e){var t=this._minPoint.add(e),e=this._maxPoint.add(e);this.addPoint(t),this.addPoint(e)},l.OdGeExtents2d.prototype.contains=function(e){return e.x+l.equalPoint()>=this._minPoint.x&&e.y+l.equalPoint()>=this._minPoint.y&&e.x-l.equalPoint()<=this._maxPoint.x&&e.y-l.equalPoint()<=this._maxPoint.y},l.maxArcStepAngle=function(e){return e<=0?Math.PI/16:e<5e-6?Math.PI/500:(e=1-e)<=-1?Math.PI/2:(e=2*Math.acos(e))>Math.PI/4?Math.PI/4:e},l.OdGeExtents2d.prototype.addPoint=function(e){this._maxPoint.x<this._minPoint.x||this._maxPoint.y<this._minPoint.y?(this._maxPoint.set(e.x,e.y),this._minPoint.set(e.x,e.y)):(this._maxPoint.x<e.x?this._maxPoint.x=e.x:this._minPoint.x>e.x&&(this._minPoint.x=e.x),this._maxPoint.y<e.y?this._maxPoint.y=e.y:this._minPoint.y>e.y&&(this._minPoint.y=e.y))},l.OdGePlane=function(e,t,i){void 0!==e&&void 0!==t&&null!=i?(this.m_origin=new l.OdGePoint3d(e),this.m_uVec=new l.OdGeVector3d(t),this.m_vVec=new l.OdGeVector3d(i),this.m_normal=t.normal().crossProduct(i.normal())):void 0!==e&&void 0!==t?(this.m_origin=new l.OdGePoint3d(e),this.m_normal=new l.OdGeVector3d(t).normalize(),this.m_uVec=this.m_normal.perpVector(),this.m_vVec=t.crossProduct(this.m_uVec)):(this.m_origin=new l.OdGePoint3d,this.m_normal=new l.OdGeVector3d(l.OdGeVector3d.kZAxis),this.m_uVec=new l.OdGeVector3d(l.OdGeVector3d.kXAxis),this.m_vVec=new l.OdGeVector3d(l.OdGeVector3d.kYAxis))},l.OdGePlane.prototype.intersectWithLine3d=function(e,t,i){var r=e,n=t,o=this.m_origin.sub(r),a=this.m_normal.dotProduct(n),o=this.m_normal.dotProduct(o);return!l.OdZero(a,l.equalPoint())&&(i.assign(r.add(n.mult(o/a))),t.isZeroLength()?e.isEqualTo(i):!!e.isEqualTo(i)||(r=l.equalPoint(),l.OdZero(i.sub(e).crossProduct(t).lengthSqrd(),r*r*t.lengthSqrd())))},l.OdGePlane.prototype.distanceFrom=function(e){return Math.abs((this.m_origin.x-e.x)*this.m_normal.x+(this.m_origin.y-e.y)*this.m_normal.y+(this.m_origin.z-(e.z||0))*this.m_normal.z)},l.OdGePlane.prototype.contains=function(e){e=Math.abs(this.m_normal.x*(this.m_origin.x-e.x)+this.m_normal.y*(this.m_origin.y-e.y)+this.m_normal.z*(this.m_origin.z-(e.z||0)));return l.OdZero(e,l.equalPoint())},l.OdGePlane.prototype.closestPointTo=function(e){var t=this.m_origin,i=this.m_normal,t=(t.x-e.x)*i.x+(t.y-e.y)*i.y+(t.z-(e.z||0))*i.z;return new l.OdGePoint3d(e.x+this.m_normal.x*t,e.y+this.m_normal.y*t,(e.z||0)+this.m_normal.z*t)},l.OdGePlane.prototype.evalPoint=function(e,t){var i=this.m_uVec,r=this.m_vVec,n=new l.OdGePoint3d(this.m_origin);return n=(n=n.add(i.mult(e))).add(r.mult(t))},l.OdGeLine3d=function(e,t){this.m_start=new l.OdGePoint3d,this.m_vec=new l.OdGeVector3d,null!=e&&null!=t&&this.set(e,t)},l.OdGeLine3d.prototype.set=function(e,t){return this.m_start.assign(e),t instanceof l.OdGePoint3d?this.m_vec.assign(t.sub(e)):this.m_vec.assign(t),this},l.OdGeLine3d.prototype.isParallelTo=function(e){var t=new l.OdGeVector3d(this.m_vec),e=(t.normalize(),new l.OdGeVector3d(e.m_vec));return e.normalize(),t.sub(e).length()<=l.equalVector()||t.add(e).length()<=l.equalVector()},l.OdGeLine3d.prototype.isOn=function(e){e=e.sub(this.m_start);return this.m_vec.normal().crossProduct(e).lengthSqrd()<=l.equalPoint()*l.equalPoint()},l.OdGeLine3d.prototype.closestPointTo=function(e){var e=e.sub(this.m_start),t=e.length(),i=this.m_vec.length();return l.OdEqual(t,0,l.equalPoint())||l.OdEqual(i,0,l.equalPoint())?new l.OdGePoint3d(this.m_start):(e=e.dotProduct(this.m_vec)/(t*i),new l.OdGePoint3d(this.m_start.add(this.m_vec.mult(t*e/i))))},l.OdGeLine3d.prototype.transformBy=function(e){return this.m_start.transformBy(e),this.m_vec.transformBy(e),this},l.OdGeLine3d.prototype.intersectWith=function(e,t){var i,r,n,o,a;return!(this.isParallelTo(e)||(this.isOn(e.m_start)?(t.assign(e.m_start),0):this.m_vec.isZeroLength()||e.m_vec.isZeroLength()||((o=this.m_vec.normal().crossProduct(e.m_vec.normal())).normalize(),Math.abs(o.dotProduct(e.m_start.sub(this.m_start)))>l.equalPoint())||(n=new l.OdGeMatrix3d,(i=new l.OdGeMatrix3d).setCoordSystem(this.m_start,this.m_vec,e.m_vec,o),n.set(i),n.invert(),o=new l.OdGePoint3d(this.m_start),a=new l.OdGeVector3d(this.m_vec),r=new l.OdGePoint3d(e.m_start),e=new l.OdGeVector3d(e.m_vec),o.transformBy(n),a.transformBy(n),r.transformBy(n),e.transformBy(n),n=new l.OdGeLine2d(o.convert2d(),a.convert2d()),o=new l.OdGeLine2d(r.convert2d(),e.convert2d()),a=new l.OdGePoint2d,!n.intersectWith(o,a))||(t.x=a.x,t.y=a.y,t.z=0,t.transformBy(i),0)))},l.OdGeLine2d=function(e,t){void 0!==e&&null!=t?(this.m_start=new l.OdGePoint2d(e),this.m_vec=new l.OdGeVector2d(t)):(this.m_start=new l.OdGePoint2d,this.m_vec=new l.OdGeVector2d(l.OdGeVector2d.kXAxis))},l.OdGeLine2d.prototype.intersectWith=function(e,t){var i=this.m_vec,r=e.m_vec,n=r.x*i.y-i.x*r.y,o=l.equalVector();return Math.abs(n*n)>o*o*i.lengthSqrd()*r.lengthSqrd()&&(o=(r.x*(e.m_start.y-this.m_start.y)-(e.m_start.x-this.m_start.x)*r.y)/n,t.x=this.m_start.x+i.x*o,t.y=this.m_start.y+i.y*o,!0)}})(window.GeNeo||(window.GeNeo={})),new Date),LOG_HELPER=(window.m_iClientStartTime=g_StartTime.getTime(),window.CXeNavigationToolbarManager={toolbars:{}},window.CXeButtonsManager={buttons:{},addButton:function(i,e){var r=this;r.buttons[i.id]||(i.addEventListener("click",function(e){var t=r.buttons;t[i.id]&&window.CFxUI.fire(t[i.id])},!1),i.addEventListener("dragstart",function(e){e.preventDefault()},!1),e.isToggle&&window.CFxUI.css_helper.addStyleClass(i,"isToggle")),r.buttons[i.id]={element:i,pItemDef:e}},addPopupButton:function(e,t,i){this.addButton(e,i),window.CFxUI.getActiveCommand()&&i.id===window.CFxUI.getActiveCommand().id&&window.CFxUI.setUISelected(i.id)},addSplitPopupButton:function(e,t,i){},setActive:function(e){window.CFxUI._helper_setActive(this.buttons,e)},setToggleActive:function(e,t){window.CFxUI._helper_setToggleActive(this.buttons,e,t)},setFlyoutActive:function(e,t){window.CFxUI._helper_setFlyoutActive(this.buttons,e,t)},removeActiveFromAllDropDown:function(e){},findButtons:function(e){var t,i,r=[];for(t in this.buttons)this.buttons.hasOwnProperty(t)&&(i=this.buttons[t])&&i.pItemDef&&i.pItemDef.id===e&&r.push(i);return r},isUIDisabled:function(e){for(var t=window.CXeButtonsManager.findButtons(e),i=0;i<t.length;i++)if(t[i]&&t[i].element&&window.CXeButtonsManager.isUIVisible(t[i].element)&&window.CFxUI.isUIDisabled(t[i].element))return!0;return!1},isUIVisible:function(e){for(var t=e;(t=t.parentElement)&&!t.classList.contains("xenon-toolbar")&&(!t.classList.contains("Wt-popup")||t.classList.contains("wt-reparented"))&&!t.classList.contains("OsMiniToolbar"););return t&&"none"!==t.style.display},purge:function(){this.buttons={}}},window.CXeShortcutsManager={shortcuts:{},jsMessageShortcuts:{},shortcutsConflicts:{},addShortcut:function(e,t){e=e.toUpperCase();this.shortcuts[e]={element:{id:t.id,className:""},pItemDef:t}},addJSMessageShortcut:function(e,t){this.jsMessageShortcuts[e]=t},addShortcutConflict:function(e,t){this.shortcutsConflicts[e]=t},fireShortcut:function(e){var t=e.toUpperCase(),i=window.XeCFxCommandLine.getLineEditId();if(i){i=document.getElementById(i);if(i&&document.activeElement===i&&("CTRL+C"==e||"META+C"==e||"CTRL+X"==e||"META+X"==e||"CTRL+V"==e||"META+V"==e))return!1}i=this.shortcuts[t];return!(!i||(window.CFxUI.fire(i),"CTRL+C"===e)||"META+C"===e)},setActive:function(e){window.CFxUI._helper_setActive(this.shortcuts,e)},findShortcuts:function(e){var t,i,r=[];for(t in this.shortcuts)this.shortcuts.hasOwnProperty(t)&&(i=this.shortcuts[t])&&i.pItemDef&&i.pItemDef.id===e&&r.push(i);return r},hasShortcut:function(e){e=e.toUpperCase();return!!this.shortcuts[e]},isDeleteShortcut:function(e){e=e.toUpperCase(),e=this.shortcuts[e];return!(!e||!e.pItemDef||"ID_OSDELETE"!==e.pItemDef.id)},isShortcutActive:function(e){e=e.toUpperCase(),e=this.shortcuts[e];return!(!e||e.pItemDef.id!==window.CFxUI.getActiveCommand().id)},purge:function(){this.shortcuts={}},getShortcutJSMessage:function(e){e=this.jsMessageShortcuts[e];if(e)return e},getShortcutConflict:function(e){e=this.shortcutsConflicts[e];if(e)return e}},window.CFxUI={fire:function(e){var t,i,r,n=window.getXeActiveDocument();n&&e&&e.element&&e.pItemDef&&e.pItemDef.id&&e.pItemDef.command&&(t={id:e.pItemDef.id,cmd:e.pItemDef.command},window.CXeButtonsManager.isUIDisabled(t.id)||this.getActiveCommand().isInsideCommand&&"ID_DELETE"===t.id&&t.id!==this.getActiveCommand.id||(i=null,i=(r=window.__IsDebugMode&&window.hasOwnProperty("_xe_cmd_time_rptr_ist")&&window._xe_cmd_time_rptr_ist)&&r.IsVisible()?r.run_simple_cmd_test:n.RunCmd.bind(n),r=!0,window.CFxUI.getActiveCommand().id!==e.pItemDef.id||e.pItemDef.isToggle||(i("^C^C"),r=!1),r&&(this.isTransparentCommand(t.cmd)||this.setUISelected(t.id),e.pItemDef.isToggle&&(r=!this.isUISelected(e.element),window.CXeButtonsManager.setToggleActive(t.id,r)),this.isTransparentCommand(t.cmd)&&this.isCommandActive(t.id)?i("^C^C"):("ID_OSDELETE"!==t.id&&(e=n.getXeInputPointManager().getCursorPosition(),n.NotifyServer("PrimaryPoint",JSON.stringify({x:e[0],y:e[1],z:e[2]})),i(t.cmd)),window.getXeApplication().getXeUI().SetActiveToolbarItem(t.id)))))},isTransparentCommand:function(e){return 0===e.indexOf("'")},Update_CFxUI:function(e){e!=window.getXeActiveDocument()||(this.setActiveCommand(""),(e=e.getXeDatabase().getCMDNAMES())&&0<e.length&&this.setActiveCommand(e[e.length-1]),this.getActiveCommand().isTrasparent)||(this.setUISelected(this.getActiveCommand().id),window.getXeApplication().getXeUI().SetActiveToolbarItem(this.getActiveCommand().id))},Update_CFxUI_DrawingToggleStates:function(){if(window.getXeActiveDocument()&&window.XeActiveTrackers){var e,t,i=window.XeActiveTrackers.TrackerData("OsDrawingToggleStateTracker");for(e in i)i.hasOwnProperty(e)&&(t=i[e],window.CXeButtonsManager.setToggleActive(e,t))}},setActiveCommand:function(e){this._activeCommand={cmd:e,id:"",isTrasparent:!1,isInsideCommand:!1},0<e.length&&(this._activeCommand.isInsideCommand=!0,e&&"'"===e[0]?(this._activeCommand.isTrasparent=!0,this._activeCommand.id="ID"+e.replace("'","")):this._activeCommand.id="ID"+e)},isCommandActive:function(e){return this._activeCommand&&this._activeCommand.id===e},getActiveCommand:function(){return this._activeCommand},getActive:function(){var e,t,i=window.CXeButtonsManager.buttons;for(t in i)if(i.hasOwnProperty(t)&&!(e=i[t]).pItemDef.isToggle&&this.css_helper.hasStyleClass(e.element,"selected"))return e},setUISelected:function(e){window.CXeButtonsManager.setActive(e),window.CXeShortcutsManager.setActive(e)},setUIUnselected:function(e){for(var t,i=window.CXeButtonsManager.findButtons(e),r=0;r<i.length;r++)this.css_helper.removeStyleClass(i[r].element,"selected"),this.css_helper.removeStyleClass(i[r].element,"selected-by-parent"),(t=i[r].element.parentElement)&&this.css_helper.hasStyleClass(t,"toolbar-popup-button")&&this.css_helper.removeStyleClass(t,"selected");var n=window.CXeShortcutsManager.findShortcuts(e);for(r=0;r<n.length;r++)this.css_helper.removeStyleClass(n[r].element,"selected"),this.css_helper.removeStyleClass(n[r].element,"selected-by-parent"),(t=n[r].element.parentElement)&&this.css_helper.hasStyleClass(t,"toolbar-popup-button")&&this.css_helper.removeStyleClass(t,"selected")},isUISelected:function(e){return this.css_helper.hasStyleClass(e,"selected")||this.css_helper.hasStyleClass(e,"selected-by-parent")},setFlyoutActive:function(e,t){window.CXeButtonsManager.setFlyoutActive(e,t)},isUIDisabled:function(e){return this.css_helper.hasStyleClass(e,"disabled")},setUIDisabled:function(e,t){t?this.css_helper.addStyleClass(e,"disabled"):this.css_helper.removeStyleClass(e,"disabled")},getCXeNavigationToolbarManager:function(){return window.CXeNavigationToolbarManager},getCXeButtonsManager:function(){return window.CXeButtonsManager},getCXeShortcutsManager:function(){return window.CXeShortcutsManager},hidePasteItem:function(e){},_helper_setActive:function(e,t){var i,r,n,o,a=[];for(i in e)e.hasOwnProperty(i)&&(r=e[i])&&r.pItemDef&&r.pItemDef.id===t&&!r.pItemDef.uncheckable&&r.element&&a.push(r);for(i in e)if(e.hasOwnProperty(i)&&(r=e[i])&&r.element&&!r.pItemDef.isToggle){for(var s=!1,c=0;c<a.length;c++)if(a[c].element.id===r.element.id){s=!0;break}s||(n=r.element,this.css_helper.removeStyleClass(n,"selected"),(o=n.parentElement)&&this.css_helper.hasStyleClass(o,"toolbar-popup-button")&&(this.css_helper.removeStyleClass(n,"selected-by-parent"),this.css_helper.removeStyleClass(o,"selected")))}for(c=0;c<a.length;c++)(o=(n=a[c].element).parentElement)&&this.css_helper.hasStyleClass(o,"toolbar-popup-button")?(this.css_helper.addStyleClass(n,"selected-by-parent"),this.css_helper.addStyleClass(o,"selected")):this.css_helper.addStyleClass(n,"selected")},_helper_setToggleActive:function(e,t,i){var r,n,o,a=[];for(r in e)e.hasOwnProperty(r)&&(n=e[r])&&n.pItemDef&&n.pItemDef.id===t&&n.pItemDef.isToggle&&n.element&&a.push(n);for(o=0;o<a.length;o++)i?this.css_helper.addStyleClass(a[o].element,"selected"):this.css_helper.removeStyleClass(a[o].element,"selected")},_helper_setFlyoutActive:function(e,t,i){var r,n,o,a=[];for(r in e)e.hasOwnProperty(r)&&(n=e[r])&&n.pItemDef&&n.pItemDef.id===t&&n.pItemDef.isFlyout&&n.element&&a.push(n);for(o=0;o<a.length;o++)i?this.css_helper.addStyleClass(a[o].element,"active-flyout"):this.css_helper.removeStyleClass(a[o].element,"active-flyout")},css_helper:{addStyleClass:function(e,t){!e||this.hasStyleClass(e,t)||(e.className+=" "+t)},removeStyleClass:function(e,t){if(e&&this.hasStyleClass(e,t)){for(var i="",r=e.className.split(" "),n=0;n<r.length;n++)r[n]!==t&&(i+=r[n],n<r.length-1)&&(i+=" ");e.className=i}},hasStyleClass:function(e,t){if(e){if(e.className)for(var i=e.className.split(" "),r=0;r<i.length;r++)if(i[r]===t)return!0;return!1}}},highlightButtonOnCmdRun:function(){}},window.CFxUI.m_bListenersAdded||(document.addEventListener("Update_XeDatabase",function(e){window.CFxUI&&window.CFxUI.Update_CFxUI(e.m_Item.getXeDocument())}),document.addEventListener("Update_XeCommandProcessor",function(e){window.CFxUI&&window.CFxUI.Update_CFxUI(e.m_Item.getXeDocument())}),document.addEventListener("PreUpdate_XeTrackers",function(e){window.CFxUI&&e.m_Item.m_Items&&e.m_Item.m_Items.hasOwnProperty("OsDrawingToggleStateTracker")&&(window.CFxUI.prevDrawingToggleStates=e.m_Item.m_Items.OsDrawingToggleStateTracker)}),document.addEventListener("Update_XeTrackers",function(e){window.CFxUI&&e.m_Item.m_Items.hasOwnProperty("OsDrawingToggleStateTracker")&&(e.m_Item.m_Items.OsDrawingToggleStateTracker!==window.CFxUI.prevDrawingToggleStates&&window.CFxUI.Update_CFxUI_DrawingToggleStates(),window.CFxUI.prevDrawingToggleStates=void 0)}),window.CFxUI.m_bListenersAdded=!0),function(){var r=this;function n(e){return e&&"[object Function]"===getClass.call(e)}var i={SHOW_GL_ERRORS:!(r.SHOW_METHOD=void 0),SHOW_GL_WARNINGS:!0,DRAWING_ENGINE_RENDER_TIME:!1,DRAWING_ENGINE_RESPAWN_TIME:!1,GSDATA_UPDATE_TIME:!0,GSDEVICE_UPDATE_TIME:!0,SHOW_GSDATA_JSON_FOR_GL_TRACKERS:!1,SHOW_GSDEVICE_JSON:!0,SHOW_GSDATA_JSON:!1,SHOW_GSDATA_UPDATE_TIME:!1,GL_DRAW_OBJECT_CREATION:!0,INPUT_POINT_MNG_DRAW_TIME:!1,GET_HANDLES_IN_SEL:!1,XENON_UPDATE_XEDATA:!1,SHOW_COMMANDS:!1,SHOW_START_UP_TIMES:!0,LOG_OSC:!0,OSC_DEBUG:!0,SHOW_ERRORS:!0,SHOW_THREE_ERRORS:!0,SHOW_XERENDERER_VER:!0,DEBUG_CFxGDI:!0,DRAWING_ENGINE_POST_EV:!0,LOG_G_ANALYTICS:!0,WORKER_SELECTION:!0,DIS_CL_SIDE_SEL:!1,XETIMER_LOG:!1};r.SET=function(e,t){i[e]=t},r.GET=function(e){return window.__IsDebugMode&&i[e]},r.SHOW=function(e,t,i){r._SKIP_||r.GET(e)&&(i=n(i)?i:r.SHOW_METHOD,n(i)?i(e,t):console.log(t))},r._SKIP_=!1});function uploadSriptPromise(r,n,o){return new Promise((e,t)=>{let i=document.createElement("script");i.type="text/javascript",i.onload=()=>{e(i)},i.onreadystatechange=function(){"complete"!==i.readyState&&"loaded"!==i.readyState||(i.onreadystatechange=null,e(i))},i.onerror=()=>{t()},o&&(i.crossOrigin="anonymous"),i.async=!!n,i.src=r,document.body.appendChild(i)})}function getURLQueryParams(e,t){t=t||window.location.href,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==e?null:e[1]}function copyXeObjectMember(e){if(e instanceof XeObject)return e.copy();if(check_for_ArrayBuffer(e))return e.slice();if(check_for_Array(e)){for(var t=[],i=0;i<e.length;i++)t[i]=copyXeObjectMember(e[i]);return t}return e instanceof Object?copy_Object(e):e}function check_for_Array(e){return e instanceof Array}function check_for_ArrayBuffer(e){return e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function copy_Object(e){var t=e.m_MyParent,i=(t&&(e.m_MyParent=void 0),JSON.parse(JSON.stringify(e)));return t&&(e.m_MyParent=t),i}function compareArrays(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]instanceof Array&&t[i]instanceof Array){if(compareArrays(e[i],t[i]))return!1}else if(e[i]!=t[i])return!1;return!0}function defineHiddenMember(e,t){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0})}function setValidStateId(e){if(window.imageWidgetInstance)for(var t in window.imageWidgetInstance)window.imageWidgetInstance.hasOwnProperty(t)&&window.imageWidgetInstance[t].SetValidState(e)}function uniq_fast(e){for(var t={},i=[],r=e.length,n=0,o=0;o<r;o++){var a=e[o];1!==t[a]&&(t[a]=1,i[n++]=a)}return i}function isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}function stopBubbles(e){e&&(e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1)}function getWindowTopLeftOffsets(e){var t={offsetLeft:e.offsetLeft,offsetTop:e.offsetTop};return e.offsetParent&&(e=getWindowTopLeftOffsets(e.offsetParent),t.offsetLeft+=e.offsetLeft,t.offsetTop+=e.offsetTop),t}function getRandomColor(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function downloadURL(e){var t="hiddenDownloader",i=document.getElementById(t);null===i&&((i=document.createElement("iframe")).id=t,i.style.display="none",document.body.appendChild(i),i.onload=function(){$.ajax({url:this.src,type:"GET",complete:function(e,t,i){404===e.status&&(window.XeLogger.error("404 on download"),(e=document.createEvent("Event")).initEvent("xepstm_to_p",!0,!0),e._m="connectionLost",window.dispatchEvent(e))}})});i.src=encodeURI(e+"")}function printURL(e){window.open("/"+e)||window.XeClientMessageProxy.showMessageBubble(["Pop-up windows appear to be blocked. Unblock them to enable printing."])}function getAndroidVersion(e){e=(e=(e||navigator.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/);return!!e&&e[1]}function sendResultToServer(e,t){var i=jQuery("#xeMainFrame")[0],e=e();i&&Wt.emit(i,"atfFunction",t,e)}function paint_centered_wrap(e,t,i,r,n,o,a,s,c){var l={RECTANGLE_STROKE_STYLE:"green",RECTANGLE_LINE_WIDTH:2,VALUE_FONT:"12px Arial",VALUE_FILL_STYLE:"red"};c&&(c.RECTANGLE_STROKE_STYLE&&(l.RECTANGLE_STROKE_STYLE=c.RECTANGLE_STROKE_STYLE),c.RECTANGLE_LINE_WIDTH&&(l.RECTANGLE_LINE_WIDTH=c.RECTANGLE_LINE_WIDTH),c.VALUE_FONT&&(l.VALUE_FONT=c.VALUE_FONT),c.VALUE_FILL_STYLE)&&(l.VALUE_FILL_STYLE=c.VALUE_FILL_STYLE),e.strokeStyle=l.RECTANGLE_STROKE_STYLE,e.fillStyle=l.VALUE_FILL_STYLE,e.lineWidth=l.RECTANGLE_LINE_WIDTH,e.strokeRect(t,i,r,n);var d=((e,t,i,r)=>{t-=10,e.font=i;for(var n=r.split(" "),o=n[0],a=[],s=1;s<n.length;++s)e.measureText(o+" "+n[s]).width<t?o+=" "+n[s]:(a.push(o),o=n[s]);return a.push(o),a})(e,r,l.VALUE_FONT,o),c=d.length*(a+s);if(n<=c);else for(var u,p=(n-c)/2+i+s*d.length,m=0;m<d.length;++m,p+=a+s)u=t+r/2-e.measureText(d[m]).width/2,e.fillText(d[m],u,p)}window._LOG_GLOBAL=new LOG_HELPER,window._XE_append_livereload=()=>{var e;window.__IsDebugMode&&((e=document.createElement("script")).src="//localhost:35729/livereload.js",document.head.appendChild(e))},void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),window.getTrackJs=function(){return window.getTrackJs.__promise||(window.TrackJS?window.getTrackJs.__promise=new Promise((e,t)=>{e(window.TrackJS)}):window.getTrackJs.__promise=new Promise((e,t)=>{document.addEventListener("OnTrackJsUploaded",function(){e(window.TrackJS)},!1)})),window.getTrackJs.__promise},window.getTrackJs(),Float32Array.prototype.slice||(Float32Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Float32Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),Int32Array.prototype.slice||(Int32Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Int32Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),Uint32Array.prototype.slice||(Uint32Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Uint32Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),Int16Array.prototype.slice||(Int16Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Int16Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Uint16Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),Int8Array.prototype.slice||(Int8Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Int8Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new Uint8Array(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i}),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){e=e||0,t=t||this.length;for(var i=new ArrayBuffer(t-e),r=0;r<e+t;++r)i[r]=this[e+r];return i});var ClientSideTracker=function(){var e=this,t=(e.x=0,e.y=0,e.drawOrder=0,!1);e.setAlwaysActiveOnPan=function(e){t=e},e.isActiveOnPan=function(e){e=e.getXeGsDevice();return!(e&&!t&&e.getPan())}},JavaScriptClientDetection=(ClientSideTracker.prototype.start=function(e){},ClientSideTracker.prototype.end=function(e){},ClientSideTracker.prototype.isDrawnOnlyInActiveViewport=function(){return!0},ClientSideTracker.prototype.update=function(e,t){},ClientSideTracker.prototype.drawTracker=function(e){return!0},ClientSideTracker.prototype.drawTrackerGl=function(e,t){return!0},ClientSideTracker.prototype.deallocate=function(e){},function(e){var t,i="",r=(screen.width&&(i+=(screen.width||"")+" x "+(screen.height||"")),navigator.appVersion),n=navigator.userAgent,o=navigator.appName,a=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10),c=(-1!=(c=n.indexOf("Opera"))&&(o="Opera",a=n.substring(c+6),-1!=(c=n.indexOf("Version")))&&(a=n.substring(c+8)),-1!=(c=n.indexOf("OPR"))?(o="Opera",a=n.substring(c+4)):-1!=(c=n.indexOf("Edge"))?(o="Microsoft Edge",a=n.substring(c+5)):-1!=(c=n.indexOf("MSIE"))?(o="Microsoft Internet Explorer",a=n.substring(c+5)):-1!=(c=n.indexOf("Chrome"))?(o="Chrome",a=n.substring(c+7)):-1!=(c=n.indexOf("Safari"))?(o="Safari",a=n.substring(c+7),-1!=(c=n.indexOf("Version"))&&(a=n.substring(c+8))):-1!=(c=n.indexOf("Firefox"))?(o="Firefox",a=n.substring(c+8)):-1!=n.indexOf("Trident/")?(o="Microsoft Internet Explorer",a=n.substring(n.indexOf("rv:")+3)):(l=n.lastIndexOf(" ")+1)<(c=n.lastIndexOf("/"))&&(o=n.substring(l,c),a=n.substring(c+1),o.toLowerCase()==o.toUpperCase())&&(o=navigator.appName),-1!=(l=(a=-1!=(l=(a=-1!=(l=a.indexOf(";"))?a.substring(0,l):a).indexOf(" "))?a.substring(0,l):a).indexOf(")"))&&(a=a.substring(0,l)),s=parseInt(""+a,10),isNaN(s)&&(a=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10)),/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(r)),l=!!navigator.cookieEnabled,d=(void 0!==navigator.cookieEnabled||l||(document.cookie="testcookie",l=-1!=document.cookie.indexOf("testcookie")),null),u=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(t in u){var p=u[t];if(p.r.test(n)){d=p.s;break}}var m=null;switch(/Windows/.test(d)&&(m=/Windows (.*)/.exec(d)[1],d="Windows"),d){case"Mac OS X":m=/Mac OS X (\d[\.\_\d]+)/.exec(n)[1];break;case"Android":m=/Android ([\.\_\d]+)/.exec(n)[1];break;case"iOS":m=(m=/OS (\d+)_(\d+)_?(\d+)?/.exec(r))[1]+"."+m[2]+"."+(0|m[3])}var h="no check",e=e.swfobject||document.swfobject;return{screen:i,browser:o,browserVersion:a,browserMajorVersion:s,mobile:c,os:d,osVersion:m,cookies:l,flashVersion:h=void 0!==e?0<(i=e.getFlashPlayerVersion()).major?i.major+"."+i.minor+" r"+i.release:null:h}});let clientSideTrackersHolder={};function registerTracker(e,t){clientSideTrackersHolder[e]=t}function notifyTracker(e,t,i){e.forEach(function(e){e=clientSideTrackersHolder[e];void 0!==e&&void 0!==e[t]&&e[t](i)})}var ClientSideCursorTrackerBase=function(){ClientSideTracker.call(this);this.getUnderCursorImgData=function(){return i.UnderCursorImgData},this.setUnderCursorImgData=function(e){i.UnderCursorImgData=e},this.getLastXY=function(){return{x:i.XY.x,y:i.XY.y}},this.setLastXY=function(e,t){i.XY.x=Math.floor(e),i.XY.y=Math.floor(t)};var i={XY:{x:0,y:0},UnderCursorImgData:null}},ClientSideLineTracker=(ClientSideCursorTrackerBase.prototype=Object.create(ClientSideTracker.prototype),ClientSideCursorTrackerBase.prototype.constructor=ClientSideCursorTrackerBase,ClientSideCursorTrackerBase.prototype.getImgDataWH=function(){throw"ClientSideCursorTrackerBase.prototype.getImgDataWH should be overriden return { w : num, h : num }"},ClientSideCursorTrackerBase.prototype.putImgData=function(e){var t,i,r;return!!e.ctx&&(t=this.getLastXY(),!!(i=this.getUnderCursorImgData()))&&(r=this.getImgDataWH(),e.ctx.putImageData(i,t.x-r.w/2,t.y-r.h/2),!0)},ClientSideCursorTrackerBase.prototype.getCursorPositionData=function(){var e,t,i,r,n,o=window.getXeActiveDocument().getXeInputPointManager().getCursorPosition();return!(!o||(n=window.getXeActiveDocument().getXeInputPointManager(),i=window.getXeActiveDocument().getXeDatabase(),!n)||!i)&&(e=!1,(t=window.XeActiveTrackers.TrackerData("CFxOsnapPointTracker"))&&(t.centers&&t.centers.length||t.location)&&(o=n.getSpecificRubberPoint(),e=!0),e||(t=window.XeActiveTrackers.TrackerData("CFxOtrackPointTracker"))&&(t.line1||t.line2)&&(o=n.getSpecificRubberPoint(),e=!0),{cursorPosition:o=!e&&(t=i.getSNAPMODE(),i=n.getInsideCommand(),n=!1,(r=window.getXeActiveDocument().getXeDatabase().getCMDNAMES()).length&&(n=-1<r[r.length-1].indexOf("_MAINSELECT")),e=t&&i&&!n)?window.getXeActiveDocument().getXeInputPointManager().getSpecificRubberPoint():o,bSnapped:e})},ClientSideCursorTrackerBase.prototype.redrawByCursorPosition=function(e,t){(e=e||this).createDrawInfo(),e.drawInfo.bDrawByRubberPoint=!0;var i=t.getXeInputPointManager().getInputPointManager();i&&i.forceGDIRedraw(t),e.drawInfo.bDrawByRubberPoint=!1},ClientSideCursorTrackerBase.prototype.createDrawInfo=function(){this.drawInfo||(this.drawInfo={bDrawByRubberPoint:!1,timeoutHandler:0,fireTime:250})},function(){ClientSideTracker.call(this),this.drawOrder=5,this.trackerName="ClientSideLineTracker"}),ClientSidePlacementTracker=(ClientSideLineTracker.prototype=Object.create(ClientSideTracker.prototype),ClientSideLineTracker.prototype.constructor=ClientSideLineTracker,ClientSideLineTracker.prototype.drawLine=function(e,t,i,r,n){var o=e.strokeStyle;e.setLineDash(n),e.strokeStyle=r,e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(i[0],i[1]),e.stroke(),e.setLineDash([]),e.strokeStyle=o},ClientSideLineTracker.prototype.drawTracker=function(e){var t,i,r,n,o=window.XeActiveTrackers.TrackerData(this.trackerName);return!o||(e.m_XeViewport?(n=e.m_XeViewport,t=window.getXeActiveDocument().getXeGsDevice().getForeground(),t=window.XeUtils.intRGBToHex(t),i=o.firstPoint,(r=window.getXeActiveDocument().getXeInputPointManager().getSpecificRubberPoint())&&(i=n.PointToSCS(i),r=n.PointToSCS(r),n=[5,2],o.dash&&(n=[1,2]),this.drawLine(e.ctx,i,r,t,n)),!0):void 0)},function(){ClientSideTracker.call(this),this.drawOrder=5}),XeAnimation=(ClientSidePlacementTracker.prototype=Object.create(ClientSideTracker.prototype),ClientSidePlacementTracker.prototype.constructor=ClientSidePlacementTracker,ClientSidePlacementTracker.prototype.drawPreview=function(e,t,i,r,n,o,a,s){var c,l,d,u,p,m=e.ctx;m&&a&&t&&e.m_XeViewport&&(i=(p=t[0]-i/2)+i,r=(t=t[1]-r/2)+r,c=(e=e.m_XeViewport).PointToSCS(p,t,0),l=e.PointToSCS(p,r,0),d=e.PointToSCS(i,r,0),u=e.PointToSCS(i,t,0),i=[i-n,t+o,0],t=e.PointToSCS([p+n,r-o,0]),p=e.PointToSCS(i),a.complete&&a.src&&0<a.naturalWidth&&(n=[p[0]-t[0],p[1]-t[1]],m.drawImage(a,t[0],t[1],n[0],n[1])),m.strokeStyle=window.XeUtils.intRGBToHex(s||11511194),m.beginPath(),m.moveTo(c[0],c[1]),m.lineTo(l[0],l[1]),m.lineTo(d[0],d[1]),m.lineTo(u[0],u[1]),m.lineTo(c[0],c[1]),m.stroke())},ClientSidePlacementTracker.prototype.drawCutLine=function(e,t,i,r,n,o,a){var s,c,l,d=e.ctx;d&&t&&i&&e.m_XeViewport&&(t=(e=e.m_XeViewport).PointToSCS(t),i=e.PointToSCS(i),s=t[0],t=t[1],c=i[0],i=i[1],l=e.PointToSCS(0,0,0),r=e.PointToSCS(r,0,0)[0]-l[0],l=e.PointToSCS(0,0,0),n=e.PointToSCS(n,0,0)[0]-l[0],s===c?(t+=n,i-=n):(s-=n,c+=n),e=window.getXeActiveDocument().getXeGsDevice().getForeground(),l=window.XeUtils.intRGBToHex(e),d.setLineDash([5,2]),d.strokeStyle=l,d.beginPath(),d.moveTo(s,t),d.lineTo(c,i),d.stroke(),d.fillStyle=l,n=a?0:2*r,!0===o&&(r=-r,n=-n),s===c?(d.moveTo(s+n,t),d.lineTo(s-r+n,t+r/6),d.lineTo(s-r+n,t+r/24),d.lineTo(s-2*r+n,t+r/24),d.lineTo(s-2*r+n,t-r/24),d.lineTo(s-r+n,t-r/24),d.lineTo(s-r+n,t-r/6),d.fill(),d.moveTo(c+n,i),d.lineTo(c-r+n,i+r/6),d.lineTo(c-r+n,i+r/24),d.lineTo(c-2*r+n,i+r/24),d.lineTo(c-2*r+n,i-r/24),d.lineTo(c-r+n,i-r/24),d.lineTo(c-r+n,i-r/6)):(d.moveTo(s,t+n),d.lineTo(s+r/6,t-r+n),d.lineTo(s+r/24,t-r+n),d.lineTo(s+r/24,t-2*r+n),d.lineTo(s-r/24,t-2*r+n),d.lineTo(s-r/24,t-r+n),d.lineTo(s-r/6,t-r+n),d.fill(),d.moveTo(c,i+n),d.lineTo(c+r/6,i-r+n),d.lineTo(c+r/24,i-r+n),d.lineTo(c+r/24,i-2*r+n),d.lineTo(c-r/24,i-2*r+n),d.lineTo(c-r/24,i-r+n),d.lineTo(c-r/6,i-r+n)),d.fill(),d.setLineDash([]))},ClientSidePlacementTracker.prototype.SortByXYAxis=function(e,t){0===t?e.sort(function(e,t){return e[1]>t[1]}):e.sort(function(e,t){return e[0]>t[0]})},ClientSidePlacementTracker.prototype.getJoggedPoints=function(e,t,i,r,n,o,a){var s=t[0],t=t[1],c=i[0],i=i[1];a?0===e?(r[0]=s,r[1]=t+(i-t)*o,n[0]=c,n[1]=r[1]):(r[0]=s+(c-s)*o,r[1]=t,n[0]=r[0],n[1]=i):0===e?(r[0]=s,r[1]=(t+i)/2,n[0]=c,n[1]=(t+i)/2):(r[0]=(s+c)/2,r[1]=t,n[0]=(s+c)/2,n[1]=i)},function(){var t=this,i=(t.setAnimationTime=function(e){if(0<a)throw"XeAnimation :: use only one function setAnimationTime or setAnimationFrames!";o=e},t.setAnimationFrames=function(e){if(0<o)throw"XeAnimation :: use only one function setAnimationTime or setAnimationFrames!";a=e},t.setAnimationFunc=function(e){s=e},t.setAnimationSpeed=function(e){l=e},t.setLoop=function(e){d=e},t.start=function(e){if(t.m_XeDocument=e,0===o&&0===a||!s)throw"XeAnimation :: wrong init";c||(window.XeAnimationsRunning||(window.XeAnimationsRunning={count:0,draw_last:!1}),window.XeAnimationsRunning.count++,u=!1,r=(new Date).getTime(),e.getXeGsDevice().setContinuousAction(!0),i(),c=setInterval(i,l))},t.stop=function(e){c&&clearInterval(c),window.XeAnimationsRunning||(window.XeAnimationsRunning={count:0,draw_last:!1}),1===window.XeAnimationsRunning.count&&e.getXeGsDevice().setContinuousAction(!1),window.XeAnimationsRunning.count--,window.XeAnimationsRunning.count<=0&&(window.XeAnimationsRunning.count=0,u||(window.XeAnimationsRunning.draw_last=!0)),u=!(c=n=r=0)},function(){var e=0;0<o&&(e=((new Date).getTime()-r)/o),0<a&&(e=n/a,n++),1<=e&&(d?(r=(new Date).getTime(),n=0):t.stop(t.m_XeDocument),e=1),s(e,u)});var r=0,n=0,o=0,a=0,s=0,c=0,l=25,d=!(t.isDone=function(){return u}),u=!0}),XeGiSubEntityTraitsData=function(e,t){var i=this,r=(i.layer=function(){return r.m_layer},i.trueColor=function(){return r.m_cmColor},i.transparency=function(){return r.m_transparency},i.lineWeight=function(){return r.m_lineWeight},i.lineType=function(){return r.m_lineType},i.lineTypeScale=function(){return r.m_lineTypeScale},i.plineGen=function(){return r.m_bPlineGen},i.setByBlockColor=function(e){r.m_ByBlockColor=e},i.getByBlockColor=function(){return r.m_ByBlockColor},i.setByBlockLayer=function(e){r.m_ByBlockLayer=e},i.getByBlockLayer=function(){return r.m_ByBlockLayer},i.setByBlockLineWeight=function(e){r.m_ByBlockLineWeight=e},i.getByBlockLineWeight=function(){return r.m_ByBlockLineWeight},i.setByBlockTransparency=function(e){r.m_ByBlockTransparency=e},i.getByBlockTransparency=function(){return r.m_ByBlockTransparency},i.setByBlockLinetypeTableRecordName=function(e){r.m_ByBlockLinetypeTableRecordName=e},i.getByBlockLinetypeTableRecordName=function(){return r.m_ByBlockLinetypeTableRecordName},{m_layer:null,m_cmColor:null,m_transparency:null,m_lineWeight:null,m_lineType:null,m_lineTypeScale:null,m_bPlineGen:null,m_ByBlockColor:null,m_ByBlockLayer:null,m_ByBlockLineWeight:null,m_ByBlockTransparency:null,m_ByBlockLinetypeTableRecordName:null});(i.values=r).m_layer=e.getLayerObject(),r.m_lineWeight=XeGiSubEntityTraitsData.prototype.resolveLineweight(e,r.m_layer,t),r.m_cmColor=XeGiSubEntityTraitsData.prototype.resolveColor(e,r.m_layer,t),r.m_transparency=XeGiSubEntityTraitsData.prototype.resolveTransparency(e,r.m_layer,t),r.m_lineType=XeGiSubEntityTraitsData.prototype.resolveLinetype(e,r.m_layer,t),r.m_lineTypeScale=e.getLinetypeScale(),r.m_bPlineGen=e.getPlineGen(),t&&(this.setByBlockColor(t.getByBlockColor()),this.setByBlockLayer(t.getByBlockLayer()),this.setByBlockLineWeight(t.getByBlockLineWeight()),this.setByBlockTransparency(t.getByBlockTransparency()),this.setByBlockLinetypeTableRecordName(t.getByBlockLinetypeTableRecordName()))},XeGlGlobalUniformData=(XeGiSubEntityTraitsData.prototype.DrawFlags={kNoDrawFlags:0,kDrawBackfaces:1,kDrawHatchGroup:2,kDrawFrontfacesOnly:4,kDrawGradientFill:8,kDrawSolidFill:16,kDrawNoLineWeight:32,kDrawContourFill:32768,kDisableLayoutCache:65536,kDrawBoundaryForClipping:131072,kDrawBoundaryForClippingDrw:262144,kClipSetIsEmpty:524288,kInternalDrawFlags:589824,kTextProcessing:1048576},XeGiSubEntityTraitsData.prototype.ShadowFlags={kShadowsCastAndReceive:0,kShadowsDoesNotCast:1,kShadowsDoesNotReceive:2,kShadowsIgnore:3},XeGiSubEntityTraitsData.prototype.SelectionFlags={kNoSelectionFlags:0,kSelectionIgnore:1,kHighlightingGeometry:2,kHiddenInHighlight:4,kFxDrawWhenSelected:8,kFxSkipDrawWhenSelected:16},XeGiSubEntityTraitsData.prototype.SubEntityHints={kHint2DAttributes:1,kHint3DAttributes:2,kHintAllAttributes:3,kHintDefaultState:3},XeGiSubEntityTraitsData.prototype.resolveLineweight=function(e,t,i){var r=e.getXeGsDevice().getXeDocument().getXeDatabase();let n=e.getLineWeight();return t&&"0"===t.getName()&&i&&(t=i.getByBlockLayer()),n=(n=(n=(n=n===XeLineweightUtils.LineWeightEnum.kLnWtByBlock&&i?i.getByBlockLineWeight():n)===XeLineweightUtils.LineWeightEnum.kLnWtByLayer?t.getLineWeight():n)===XeLineweightUtils.LineWeightEnum.kLnWtByLwDefault?r.getLWDEFAULT():n)<0?r.getLWDEFAULT():n},XeGiSubEntityTraitsData.prototype.resolveColor=function(e,t,i){var r,n=e.getXeGsDevice().getXeDocument(),o=new OdCmEntityColor,a=(o.m_RGBM=e.getColor(),e.getXeGsDevice().getPalette().getPalette());OdCmEntityColor.prototype.ColorMethod;return t&&"0"===t.getName()&&i&&(t=i.getByBlockLayer()),(o=o.isByBlock()&&i?i.getByBlockColor()||o:o).isByLayer()?"string"==typeof(r=t.getColor())?o=[255*(r=(new THREE.Color).setStyle(r)).r&255,255*r.g&255,255*r.b&255]:r>=a.length?window._LOG_GLOBAL.SHOW("SHOW_ERRORS","ERROR ! chunk m_"+e.getId()+" --- >> wrong palette index !!!"):o=[255&(r=a[r]),r>>8&255,r>>16&255]:o=o.isByBlock()?[255&(r=(r=a[7])||0),r>>8&255,r>>16&255]:o.isByColor()?[o.red(),o.green(),o.blue()]:o.isByACI()?(i=o.colorIndex())>=a.length?(window._LOG_GLOBAL.SHOW("SHOW_ERRORS","ERROR ! chunk m_"+e.getId()+" --- >> wrong palette index !!!"),[0,0,0]):[255&(r=a[i]),r>>8&255,r>>16&255]:o.isForeground()?[255&(r=(r=a[7])||0),r>>8&255,r>>16&255]:(o.isNone()||window.XeLogger.error("resolveColor = 0"),[0,0,0]),o=[o[0]/255,o[1]/255,o[2]/255],!0===e.getXeGsDevice().getFadeMode()&&(i=1-n.getXeDatabase().getXFADECTL()/100,a=e.getXeGsDevice().getBackground(),r=(new THREE.Color).setHex(a),o[0]=o[0]*i+r.r*(1-i),o[1]=o[1]*i+r.g*(1-i),o[2]=o[2]*i+r.b*(1-i)),t&&!0===t.getLocked()&&(e=1-n.getXeDatabase().getLAYLOCKFADECTL()/100,a=n.getXeGsDevice().getBackground(),r=(new THREE.Color).setHex(a),o[0]=o[0]*e+r.r*(1-e),o[1]=o[1]*e+r.g*(1-e),o[2]=o[2]*e+r.b*(1-e)),o},XeGiSubEntityTraitsData.prototype.resolveTransparency=function(e,t,i){var r=new OdCmTransparency;return r.serializeIn(e.getTransparency()),t&&"0"===t.getName()&&i&&(t=i.getByBlockLayer()),(r=r.isByBlock()&&i?i.getByBlockTransparency():r).isByLayer()&&t&&r.serializeIn(t.getTransparency()),r=r.alpha()},XeGiSubEntityTraitsData.prototype.resolveLinetype=function(t,i,e){var r=t.getXeGsDevice().getXeDocument().getXeDatabase().getXeLinetypeTable();let n=t.getLinetypeTableRecordName();if(i&&"0"===i.getName()&&e&&(i=e.getByBlockLayer()),n=-2===n?e.getByBlockLinetypeTableRecordName():n){let e;if(-1===n)i&&(t=i.getLineStyle(),e=r.getByHandle(t));else for(var o in r){o=r.getByHandle(o);if(o){var a=o.getName();if(a===n){e=o;break}}}return e}},XeGiSubEntityTraitsData.prototype.TraitsFlags={kTrueColor:1,kColor:2,kPlotStyleName:4,kLayer:8,kLineType:16,kFillType:32,kLineWeight:64,kLineTypeScale:128,kThickness:256,kSelectionMarker:512,kMaterial:1024,kFillPlane:2048,kMapper:4096,kVisualStyle:8192,kTransparency:16384,kDrawFlags:32768,kSelectionGeom:65536,kShadowFlags:131072,kSectionable:262144,kSelectionFlags:524288},function(){let g=this;function y(){f.bEnableLinetype=0,f.xeLinetypeTableRecord=void 0,f.plinegen=0,f.patternArray=new Float32Array(24),f.patternArraySize=0,f.calculatedPatternLength=0,f.xeLTRecordPatternLength=0,f.isScaledToFit=0,f.ltRecordScale=0,f.bAlwaysShowLinetype=0,f.halfScaledPixelSize=1}g.GlobalGlTrackersDrawOrderDenominator=0,g.get=function(){return f},g.getChunkId=function(){return t},g.reset=function(){t=void 0,f={useTexture:0,uTexture:XeWebGlRenderer.prototype.common_data.null_texture,texture_link:null,order_nominator:1,order_denominator:1,order_base:0,useColorPickingColor:0,uniform_CPColor:new Float32Array(4),useVertexColor:0,color:[1,1,1],alpha:1,useNormal:0,uRenderMode:0,pointSize:1,isPointDraw:0,lwUnits:1,lwPixels:1,bEnableLinetype:0,xeLinetypeTableRecord:void 0,patternArray:new Float32Array(24),patternArraySize:0,calculatedPatternLength:0,xeLTRecordPatternLength:0,ltRecordScale:0,bAlwaysShowLinetype:0,isScaledToFit:0,arcCircleType:0,plinegen:0}},g.resolveTraits=(n,o,a,e,s,c)=>{var l=o.getXeGsDevice().getXeDocument(),l=(l.getXeDatabase(),l.getXeGsDevice(),t=o.getId(),o.getHasNormal()?1:0),d=o.getLayerObject();if(f.useNormal=l,f.useVertexColor=+c,f.color=XeGiSubEntityTraitsData.prototype.resolveColor(o,d,a||null),f.alpha=XeGiSubEntityTraitsData.prototype.resolveTransparency(o,d,a||null)/255,n.getSingleColorMode()&&-2!==o.getOwner()&&(l=n.getSingleColor(),f.color=[(255&l)/255,((65280&l)>>>8)/255,((16711680&l)>>>16)/255],f.alpha=1),s){c=n;d=o;l=o.getArcType();s=a;let e=d,t=d.getLayerObject(),i=e.getXeGsDevice().getXeDocument(),r=XeGiSubEntityTraitsData.prototype.resolveLinetype(e,t,s);if(r){s=e.getLinetypeScale();if(0==s)y();else{for(var u=r.getArrayPattern(),o=r.getIsScaledToFit(),p=new Float32Array(24),m=0,h=0;h<u.length;h++)m+=Math.abs(u[h]),p[h]=u[h];2<=u.length&&u.length<=e.iMAX_LINETYPE_ARRAY_COUNT()?(s=g.recalculatePatternScale(c,d,r,s),d=i.getXeDatabase().getCANNOSCALEVALUE(),f.bEnableLinetype=1,f.xeLinetypeTableRecord=r,f.plinegen=e.getPlineGen()?1:0,f.patternArray=p,f.patternArraySize=u.length,f.calculatedPatternLength=m,f.xeLTRecordPatternLength=r.getPatternLength(),f.isScaledToFit=o?1:0,f.ltRecordScale=s*(1/d),f.bAlwaysShowLinetype=g.IsAlwaysShowLinetype(i)?1:0,f.arcCircleType=l||0,f.halfScaledPixelSize=1.2*c.getPixelSize()/(s*m)):y()}}else y()}else y();a=n;a=a?a.getRenderMode():XeGsViewport.prototype.RenderModeEnum.k2DOptimized,f.uRenderMode=a},g.getLineweight=function(e,t,i){var r,n,o,a=e.getLineweightCache(),s=a.one_px_lw_unit;return e?(n=(r=t.getXeGsDevice().getXeDocument()).getXeDatabase(),t=XeGiSubEntityTraitsData.prototype.resolveLineweight(t,t.getLayerObject(),i),i=!1,o=a.lw_to_units[t],a.lw_to_pixels[t],a=!n.getLWDISPLAY()||window.XeLineweightUtils.isLineWeightTooSmall(e,t),null!=o&&(-1===o||a)&&(o=s,0<f.bEnableLinetype)&&f.xeLinetypeTableRecord.getHasDots()&&(o=1.5*s,i=!0),(o*=g.getLWDISPSCALE(r))<s&&0<o&&(o=s,i)?1.5*s:o):s};var f,t;new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);g.reset()});XeGlGlobalUniformData.prototype.getLights=function(e){if(!this.m_LightsArray){var t=new THREE.Vector3(-1,1,1).normalize(),i=new THREE.Vector3(2,-1,1).normalize(),r=[(new THREE.Matrix4).set(0,0,0,1,t.x,t.y,t.x,0,.6,.6,.6,1,1,1,1,1),(new THREE.Matrix4).set(0,0,0,1,i.x,i.y,i.x,0,.4,.4,.4,1,1,1,1,1)],n=new Float32Array(16*r.length);for(let e=0;e<r.length;e++){var o=r[e];o.transpose(),o.toArray(n,16*e)}this.m_LightsArray={uGlobalAmbient:[.6,.6,.6,0],uShininessCoeff:64,uSpecularMaterial:[1,1,1,1],array:n}}return this.m_LightsArray},XeGlGlobalUniformData.prototype.recalculatePatternScale=function(e,t,i,r){var t=t.getXeGsDevice(),n=t.getXeDocument().getXeDatabase(),o=1;return r*(o=t.getOverallViewport()&&!e.getOverall()&&n.getPSLTSCALE()?1/e.getCustomScale():o)},XeGlGlobalUniformData.prototype.getLWDISPSCALE=function(e){return e.getXeDatabase().getLWDISPSCALE()},XeGlGlobalUniformData.prototype.IsAlwaysShowLinetype=function(e){return!1},XeGlGlobalUniformData.prototype.matix4x4_float32_kIdentity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class XeGLCachedCircles{static numPoints=[16,32,64,128,256,512,1024];static screenCoefficients=[50,170,350,700,1400,2800,5600];m_Geometry=new Map;evalPoint(e){return new GeNeo.OdGePoint3d(+Math.sin(e),+Math.cos(e),0)}constructor(){for(let i=0;i<XeGLCachedCircles.numPoints.length;++i){var e=new XeGLDrawObjectGeometry,r=new XeTypedArray(Float32Array,3),n=new XeTypedArray(XeWebGlRenderer.prototype.getTypeOfIndexArray()),o=2*Math.PI/XeGLCachedCircles.numPoints[i];let t=0;for(let e=0;e<XeGLCachedCircles.numPoints[i];++e){var a=this.evalPoint(t);r.push(a.x),r.push(a.y),r.push(a.z),n.push(e+1),n.push((e<XeGLCachedCircles.numPoints[i]-1?e+1:0)+1),t+=o}var s=XeGLLinetypesGeometry.processChunk(r.fittedArray,n.fittedArray,void 0,void 0,void 0,!1,2),c=(e.addAttribute("index",new XeGeometryAttribute(s.newIndiciesArray)),e.addAttribute("position",new XeGeometryAttribute(s.newVerticesArray)),e.addAttribute("ltIndex",new XeGeometryAttribute(s.newIndiciesArray)),e.addAttribute("ltVertex",new XeGeometryAttribute(s.newVerticesArray)),e.addAttribute("fPatternCoord",new XeGeometryAttribute(s.newfPatternCoord)),e.addAttribute("fReverseCoord",new XeGeometryAttribute(s.newfReverseCoord)),new XeGLLineWeightGeometry),c=(c.addArray_divide(Float32Array,"p0","p1",s.newVerticesArray,3),c.addArray_pack(Float32Array,"fPatternCoords",s.newfPatternCoord,1),c.addArray_pack(Float32Array,"fReverseCoords",s.newfReverseCoord,1),c.addArray_pack(Float32Array,"fsemiScCoefs",s.newfsemiScCoef,1),c.processGeometry(s.newIndiciesArray)),s=(e.addAttribute("p0",new XeGeometryAttribute(c.p0)),e.addAttribute("p1",new XeGeometryAttribute(c.p1)),e.addAttribute("fPatternCoords",new XeGeometryAttribute(c.fPatternCoords)),e.addAttribute("fReverseCoords",new XeGeometryAttribute(c.fReverseCoords)),e.addAttribute("fsemiScCoefs",new XeGeometryAttribute(c.fsemiScCoefs)),e.fragment_count=c.fragment_count,e.points_count=XeGLCachedCircles.numPoints[i],new XeGLDrawObjectMaterial({shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,!1)}));s.side=THREE.DoubleSide,this.m_Geometry.set(XeGLCachedCircles.numPoints[i],new XeGLDrawObject(e,s,XeGLDrawObjectGlType.LINES,!0))}}_getCircle(e){return this.m_Geometry.get(e)}static caclScreenCoef(e,t,i){return 2*e*(2*Math.PI/Math.abs(t))/i}static get MaxScreenCoef(){return XeGLCachedCircles.screenCoefficients[XeGLCachedCircles.screenCoefficients.length-1]}getCircleByScreenCoeff(e){let t=0;for(var i=XeGLCachedCircles.screenCoefficients.length;t<i-1&&e>XeGLCachedCircles.screenCoefficients[t];)++t;var r=XeGLCachedCircles.numPoints[t];return this._getCircle(r)}getNextCircle(e){for(var t of this.m_Geometry)if(e<t[0])return this._getCircle(t[0]);return!1}dispose(){for(var[e,t]of this.m_Geometry)t.deallocate(void 0,!0);this.m_Geometry=new Map}}var XeGeometryAttribute=function(e){this.array=e,this.length=this.array.length,this.buffer=void 0,this.deleteArray=!1,this.needsUpdate=!0},XeGLDrawObjectGeometry=function(){this.attributes={}},XeGLDrawObjectMaterial=(XeGLDrawObjectGeometry.prototype.addAttribute=function(e,t){this.attributes[e]=t},XeGLDrawObjectGeometry.prototype.getAttribute=function(e){return this.attributes[e]},XeGLDrawObjectGeometry.prototype.dispose=function(e){var t=e||XeWebGlRenderer.prototype.global_gl_context;if(t&&this.attributes)for(var i in this.attributes)this.attributes.hasOwnProperty(i)&&this.attributes[i]&&t.deleteBuffer(this.attributes[i].buffer);delete this.attributes},function(e){this.uniforms=e.uniforms,this.shader=e.shader,this.id=++XeGLDrawObjectMaterial.prototype.count,this.side=void 0});XeGLDrawObjectMaterial.prototype.count=0,XeGLDrawObjectMaterial.prototype.dispose=function(e){var t=e||XeWebGlRenderer.prototype.global_gl_context;if(this.uniforms)for(var i in this.uniforms)this.uniforms.hasOwnProperty(i)&&this.uniforms[i]&&this.uniforms[i].dispose&&this.uniforms[i].dispose(t);delete this.uniforms,delete this.shader},Math.fmod=function(e,t){return Number((e-Math.floor(e/t)*t).toPrecision(8))};class XeTypedArray{constructor(e,t=0,i=1,r=2){this.arrayType=e,i=Math.max(t,i),this.underlyingArray=new e(i),this.growFactor=r,this.size=t,this.capacity=i}reserve(e){var t;e<this.capacity||((t=new this.arrayType(e)).set(this.underlyingArray),this.capacity=e,this.underlyingArray=t)}reservePlus(e){this.reserve(this.size+e)}push(e){return this.size+1>this.capacity&&this.reserve(this.capacity*this.growFactor),this.underlyingArray[this.size]=e,this.size++}pop(){return 0==this.size?0:this.size--}get array(){return this.underlyingArray}get fittedArray(){return this.underlyingArray.subarray(0,this.size)}get length(){return this.size}}class XeGLSimpleLinetypeGeometry{static align(e,t,i,r){e/=r,t/=r;var n=Math.fmod(t,1),i=.5*(i/r-(1-n<1e-5?0:n));return[e+=i,t=(t+=i)<1?0:t]}static processFragment(e,t,i){e*=3,e=new GeNeo.OdGePoint3d(i[e],i[1+e],i[2+e]),t*=3,i=new GeNeo.OdGePoint3d(i[t],i[1+t],i[2+t]).distanceTo(e),t=2/i;return{p0:{fPatternCoord:0,fReverseCoord:i,semiScCoef:t},p1:{fPatternCoord:i,fReverseCoord:0,semiScCoef:t}}}static copyBetweenArrays(t,i,e,r){var n=e*r,e=t.push(i[n])/r;for(let e=1;e<r;e++)t.push(i[n+e]);return e}static processVertices(e,t,i,r,n,o,a,s,c,l,d,u,p,m){var h=this.processFragment(e,t,i),g=this.copyBetweenArrays(a,i,e,3),a=this.copyBetweenArrays(a,i,t,3);r&&0<r.length&&(this.copyBetweenArrays(c,r,e,1),this.copyBetweenArrays(c,r,t,1)),n&&0<n.length&&(this.copyBetweenArrays(l,n,e,1),this.copyBetweenArrays(l,n,t,1)),o&&0<o.length&&(this.copyBetweenArrays(d,o,e,3),this.copyBetweenArrays(d,o,t,3)),u.push(h.p0.fPatternCoord),p.push(h.p0.fReverseCoord),u.push(h.p1.fPatternCoord),p.push(h.p1.fReverseCoord),m.push(h.p0.semiScCoef),m.push(h.p1.semiScCoef),s.push(g),s.push(a)}static createArrays(e,t,i,r,n){return{newVerticesArray:new XeTypedArray(Float32Array,3,e.length),newIndiciesArray:new XeTypedArray(XeWebGlRenderer.prototype.getTypeOfIndexArray(),0,t.length),newOrdersArray:i?new XeTypedArray(Float32Array,1,i.length):void 0,newVertexColorArray:r?new XeTypedArray(Int32Array,Math.min(r.length,1),r.length):void 0,newNormalsArray:n?new XeTypedArray(Float32Array,Math.min(n.length,3),n.length):void 0,newfPatternCoord:new XeTypedArray(Float32Array,1,e.length/3),newfReverseCoord:new XeTypedArray(Float32Array,1,e.length/3),newfsemiScCoef:new XeTypedArray(Float32Array,1,e.length/3)}}static processGeometry(t,i,r,n,o){var a=this.createArrays(t,i,r,n,o);for(let e=0;e<i.length;e+=2)this.processVertices(i[e],i[e+1],t,r,n,o,a.newVerticesArray,a.newIndiciesArray,a.newOrdersArray,a.newVertexColorArray,a.newNormalsArray,a.newfPatternCoord,a.newfReverseCoord,a.newfsemiScCoef);return{newVerticesArray:a.newVerticesArray.fittedArray,newIndiciesArray:a.newIndiciesArray.fittedArray,newOrdersArray:a.newOrdersArray?.fittedArray,newVertexColorArray:a.newVertexColorArray?.fittedArray,newNormalsArray:a.newNormalsArray?.fittedArray,newfPatternCoord:a.newfPatternCoord.fittedArray,newfReverseCoord:a.newfReverseCoord.fittedArray,newfsemiScCoef:a.newfsemiScCoef.fittedArray}}}class XeGLPLINEGENLinetypeGeometry extends XeGLSimpleLinetypeGeometry{static calculateFullLength(t,i){let r=0;for(let e=0;e<i.length;e+=2){var n=i[e],o=i[e+1],n=3*n,n=new GeNeo.OdGePoint3d(t[n],t[1+n],t[2+n]),o=3*o,o=new GeNeo.OdGePoint3d(t[o],t[1+o],t[2+o]);r+=o.distanceTo(n)}this.m_CurrentStartParam=0,this.m_CurrentEndParam=r}static processFragment(e,t,i){var e=3*e,e=new GeNeo.OdGePoint3d(i[e],i[1+e],i[2+e]),t=3*t,i=new GeNeo.OdGePoint3d(i[t],i[1+t],i[2+t]),t=this.m_CurrentStartParam,r=this.m_CurrentEndParam,i=i.distanceTo(e),e=i,i=2/i;return this.m_CurrentStartParam+=e,this.m_CurrentEndParam-=e,{p0:{fPatternCoord:t,fReverseCoord:r,semiScCoef:i},p1:{fPatternCoord:this.m_CurrentStartParam,fReverseCoord:this.m_CurrentEndParam,semiScCoef:i}}}static processGeometry(t,i,r,n,o){var a=this.createArrays(t,i,r,n,o);this.calculateFullLength(t,i);for(let e=0;e<i.length;e+=2)this.processVertices(i[e],i[e+1],t,r,n,o,a.newVerticesArray,a.newIndiciesArray,a.newOrdersArray,a.newVertexColorArray,a.newNormalsArray,a.newfPatternCoord,a.newfReverseCoord,a.newfsemiScCoef);return{newVerticesArray:a.newVerticesArray.fittedArray,newIndiciesArray:a.newIndiciesArray.fittedArray,newOrdersArray:a.newOrdersArray?.fittedArray,newVertexColorArray:a.newVertexColorArray?.fittedArray,newNormalsArray:a.newNormalsArray?.fittedArray,newfPatternCoord:a.newfPatternCoord.fittedArray,newfReverseCoord:a.newfReverseCoord.fittedArray,newfsemiScCoef:a.newfsemiScCoef.fittedArray}}}class XeGLLinetypesGeometry{static processChunk(e,t,i,r,n,o,a){return(o||0<a?XeGLPLINEGENLinetypeGeometry:XeGLSimpleLinetypeGeometry).processGeometry(e,t,i,r,n)}}class XeGLLineWeightGeometry{static divideFragment(t,i,r,n,o,a){for(let e=0;e<a;e++){var s=t*a+e,c=i*a+e;n.push(r[s]),o.push(r[c])}}static packFragment(i,r,n,o,a){for(let t=0;t<2;t++)for(let e=0;e<a;e++){var s=(0==t?i:r)*a+e;o.push(n[s])}}constructor(){this.m_arraysToPack=[],this.m_arraysToDivide=[]}addArray_pack(e,t,i,r){i&&0!=i.length&&this.m_arraysToPack.push({arrayType:e,arrayName:t,arraySrc:i,elementCount:r})}addArray_divide(e,t,i,r,n){r&&0!=r.length&&this.m_arraysToDivide.push({arrayType:e,p0ArrayName:t,p1ArrayName:i,arraySrc:r,elementCount:n})}createArrays(){for(var e of this.m_arraysToDivide)e.p0Array=new XeTypedArray(e.arrayType,0,e.arraySrc.length/2|0),e.p1Array=new XeTypedArray(e.arrayType,0,e.arraySrc.length/2|0);for(var t of this.m_arraysToPack)t.array=new XeTypedArray(t.arrayType,0,t.arraySrc.length)}processFragment(e,t){for(var i of this.m_arraysToDivide)XeGLLineWeightGeometry.divideFragment(e,t,i.arraySrc,i.p0Array,i.p1Array,i.elementCount);for(var r of this.m_arraysToPack)XeGLLineWeightGeometry.packFragment(e,t,r.arraySrc,r.array,r.elementCount)}processGeometry(t){this.createArrays();let i=0;for(let e=0;e<t.length;e+=2)this.processFragment(t[e],t[e+1]),i++;var e,r,n={};for(e of this.m_arraysToDivide)n[e.p0ArrayName]=e.p0Array.fittedArray,n[e.p1ArrayName]=e.p1Array.fittedArray;for(r of this.m_arraysToPack)n[r.arrayName]=r.array.fittedArray;return n.fragment_count=i,n}}var XeTexture=function(e,t,i,r,n,o,a,s,c){this.sourceFile="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==c?c:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!1,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},XeDataTexture=(XeTexture.prototype.dispose=function(e){e=e||XeWebGlRenderer.prototype.global_gl_context;e&&void 0!==this.__webglInit&&(e.deleteTexture(this.__webglTexture),delete this.__webglTexture,delete this.__webglInit)},XeTexture.prototype.downloadTexture=function(e){let t=this;var i=XeWebGlRenderer.prototype.common_data.textures[e];if(i&&i.uploaded)return XeWebGlRenderer.prototype.common_data.textures[e];XeWebGlRenderer.prototype.common_data.textures[e]={texture:null,uploaded:!1},i=XeWebGlRenderer.prototype.common_data.textures[e],t.start_loading_texture_img=function(){var e=document.createEvent("Event");e.initEvent("XeStartLoadingTextureImgEvent",!0,!0),e.timestamp=(new Date).getTime(),e.m_Item=t,document.dispatchEvent(e)},t.stop_loading_texture_img=function(){var e=document.createEvent("Event");e.initEvent("XeStopLoadingTextureImgEvent",!0,!0),e.timestamp=(new Date).getTime(),e.m_Item=t,document.dispatchEvent(e)},t.start_loading_texture_img();var r=new Image;return r.onload=function(){i.texture=new XeTexture(r,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat,THREE.UnsignedByteType,1),i.texture.generateMipmaps=!1,i.texture.needsUpdate=!0,i.uploaded=!0,i=null,t.stop_loading_texture_img()},r.onerror=function(){delete XeWebGlRenderer.prototype.common_data.textures[e],r=i=null,t.stop_loading_texture_img(),window.XeLogger.error("Error downloading image "+e)},r.src=e,null},function(e,t,i,r,n,o,a,s,c,l,d){XeTexture.call(this,null,o,a,s,c,l,r,n,d),this.image={data:e,width:t,height:i}}),XeCompressedTexture=(XeDataTexture.prototype=Object.create(XeTexture.prototype),XeDataTexture.prototype.constructor=XeDataTexture,function(e,t,i,r,n,o,a,s,c,l,d){XeTexture.call(this,null,o,a,s,c,l,r,n,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}),XeWebGLExtensions=(XeCompressedTexture.prototype=Object.create(XeTexture.prototype),XeCompressedTexture.prototype.constructor=XeCompressedTexture,function(i){var r={};this.get=function(e){if(void 0!==r[e])return r[e];var t;switch(e){case"EXT_texture_filter_anisotropic":t=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=i.getExtension(e)}return r[e]=t}}),THREE={REVISION:"custom-71",log:function(){window.XeLogger.log.apply(console,arguments)},warn:function(){window.XeLogger.warn.apply(console,arguments)},error:function(){window.XeLogger.error.apply(console,arguments)},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,NoShading:0,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,MultiplyOperation:0,MixOperation:1,AddOperation:2,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023},XeWebGlRenderer=(THREE.RGBEFormat=THREE.RGBAFormat,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.RGB_PVRTC_4BPPV1_Format=2100,THREE.RGB_PVRTC_2BPPV1_Format=2101,THREE.RGBA_PVRTC_4BPPV1_Format=2102,THREE.RGBA_PVRTC_2BPPV1_Format=2103,function(e){var l,a=this,t="LOG XeWebGlRenderer - init;\n",i="ERROR XeWebGlRenderer - init;\n",n=(e=e||{}).canvas||document.createElement("canvas"),r=void 0!==e.alpha&&e.alpha,L=void 0===e.depth||e.depth,R=void 0===e.stencil||e.stencil,o=void 0!==e.premultipliedAlpha&&e.premultipliedAlpha,N=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,e=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,s=new THREE.Color(0),c=0,d=(a.domElement=n,a.context=null,!(a.isWebGl2=function(){return d})),u=-1,p=-1,m=0,h=-1;a.resetCurrentValues=function(){p=u=-1,m=0};try{var g,y,f,_={alpha:r,depth:L,stencil:R,antialias:window.GetXeUseAntialias(),premultipliedAlpha:o,preserveDrawingBuffer:N},w=(window.XeUtils.WEB_RENDERER_PARAMS.isWebGl2&&XeWebDrawerEngine.prototype.bUseWebGl2&&"WebGL2RenderingContext"in window&&(t+='XeWebGlRenderer - trying to init "webgl2";\n',l=n.getContext("webgl2",_))&&l instanceof window.WebGL2RenderingContext&&(t+='XeWebGlRenderer - "webgl2";\n',d=!0,l._isWebGl2=!0),l||(t+='XeWebGlRenderer - "webgl2" is not supported;\nXeWebGlRenderer - trying to init "webgl1";\n',!(l=n.getContext("webgl",_))&&(t+='XeWebGlRenderer - "webgl1" is not supported;\nXeWebGlRenderer - trying to init "experimental-webgl";\n',l=n.getContext("experimental-webgl",_))&&(t+='XeWebGlRenderer - "experimental-webgl";\n')),l.drawElementsInstanced?t+='native instanced functions used";\n':(l._instancedArrays=l.getExtension("ANGLE_instanced_arrays"),l._instancedArrays.drawElementsInstancedANGLE?t+='ANGLE_instanced_arrays extension loaded";\n':t+='ANGLE_instanced_arrays extension failed to load";\n'),""),v=(l&&(g=l.getExtension("WEBGL_debug_renderer_info"))&&(t+="XeWebGlRenderer - GPU : "+(w=l.getParameter(g.UNMASKED_RENDERER_WEBGL))),window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("SHOW_XERENDERER_VER")&&window.XeLogger.log(t),!l&&window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("SHOW_ERRORS")&&window.XeLogger.error(i),"False"),C=(l&&(y=l.getParameter(l.ALIASED_LINE_WIDTH_RANGE))&&2==y.length&&1==y[0]&&1==y[1]&&(f=e=>0!==e&&0==(e&e-1),v="Win32"!==navigator.platform&&"Win64"!==navigator.platform||"Internet Explorer"===l.getParameter(l.RENDERER)||"Microsoft Edge"===l.getParameter(l.RENDERER)?"False":f(l.getParameter(l.MAX_VERTEX_UNIFORM_VECTORS))&&f(l.getParameter(l.MAX_FRAGMENT_UNIFORM_VECTORS))?"True, Direct3D 11":"True, Direct3D 9"),document.createEvent("Event"));if(C.initEvent("XeWebGlRendererInitEvent",!0,!0),C.timestamp=(new Date).getTime(),C.data={webgl:d?"webgl2":"webgl1",log:t,gpu:w,error:i,gl:l?{VERSION:l.getParameter(l.VERSION),SHADING_LANGUAGE_VERSION:l.getParameter(l.SHADING_LANGUAGE_VERSION),RENDERER:l.getParameter(l.RENDERER),ANGLE:v}:null,gl2:l&&d?{MAX_3D_TEXTURE_SIZE:l.getParameter(l.MAX_3D_TEXTURE_SIZE),MAX_ARRAY_TEXTURE_LAYERS:l.getParameter(l.MAX_ARRAY_TEXTURE_LAYERS),MAX_DRAW_BUFFERS:l.getParameter(l.MAX_DRAW_BUFFERS),MAX_VERTEX_UNIFORM_COMPONENTS:l.getParameter(l.MAX_VERTEX_UNIFORM_COMPONENTS),MAX_VERTEX_UNIFORM_BLOCKS:l.getParameter(l.MAX_VERTEX_UNIFORM_BLOCKS),MAX_COMBINED_UNIFORM_BLOCKS:l.getParameter(l.MAX_COMBINED_UNIFORM_BLOCKS),MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:l.getParameter(l.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS),MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:l.getParameter(l.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS)}:null},document.dispatchEvent(C),!l)throw"Error creating WebGL context.\n"}catch(e){}function T(e,t,i,r){!0===o&&(e*=r,t*=r,i*=r),l.clearColor(e,t,i,r)}var b,X,S=new XeWebGLState(l,E),P=(void 0===l.getShaderPrecisionFormat&&(l.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),new XeWebGLExtensions(l)),D=((a.extensions=P).get("OES_texture_float"),P.get("OES_texture_float_linear"),P.get("OES_texture_half_float"),P.get("OES_texture_half_float_linear"),P.get("OES_standard_derivatives"),a.domElement.addEventListener("webglcontextlost",function(){window.XeLogger.log("WebGL context lost"),window.getXeApplication().StopGLProcessing(),window.getXeApplication().dispatchRedrawEvent()},!1),e&&P.get("EXT_frag_depth"),a.resetGLState=function(){u=-1,S.reset()},l.clearColor(0,0,0,1),l.clearDepth(1),l.clearStencil(0),l.enable(l.DEPTH_TEST),l.depthFunc(l.LEQUAL),l.frontFace(l.CCW),l.cullFace(l.BACK),l.enable(l.CULL_FACE),l.enable(l.BLEND),l.blendEquation(l.FUNC_ADD),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),a.context=l,a.state=S,l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS)),r=l.getParameter(l.MAX_VERTEX_TEXTURE_IMAGE_UNITS),F=l.getParameter(l.MAX_TEXTURE_SIZE),x=(l.getParameter(l.MAX_CUBE_MAP_TEXTURE_SIZE),0<r),V=(x&&P.get("OES_texture_float"),l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.HIGH_FLOAT),l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.MEDIUM_FLOAT),l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.HIGH_FLOAT),l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.MEDIUM_FLOAT),function(){if(void 0===b&&(b=[],P.get("WEBGL_compressed_texture_pvrtc")||P.get("WEBGL_compressed_texture_s3tc")))for(var e=l.getParameter(l.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)b.push(e[t]);return b});function O(){return window.performance?window.performance.now():(new Date).getTime()}function G(e,t,i){i?(l.texParameteri(e,l.TEXTURE_WRAP_S,E(t.wrapS)),l.texParameteri(e,l.TEXTURE_WRAP_T,E(t.wrapT)),l.texParameteri(e,l.TEXTURE_MAG_FILTER,E(t.magFilter)),l.texParameteri(e,l.TEXTURE_MIN_FILTER,E(t.minFilter))):(l.texParameteri(e,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(e,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),t.wrapS===THREE.ClampToEdgeWrapping&&t.wrapT===THREE.ClampToEdgeWrapping||THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),l.texParameteri(e,l.TEXTURE_MAG_FILTER,B(t.magFilter)),l.texParameteri(e,l.TEXTURE_MIN_FILTER,B(t.minFilter)),t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter&&THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(i=P.get("EXT_texture_filter_anisotropic"))&&t.type!==THREE.FloatType&&t.type!==THREE.HalfFloatType&&(1<t.anisotropy||t.__currentAnisotropy)&&(l.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,a.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function B(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?l.NEAREST:l.LINEAR}function E(e){var t;if(e===THREE.RepeatWrapping)return l.REPEAT;if(e===THREE.ClampToEdgeWrapping)return l.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return l.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return l.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return l.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return l.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return l.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return l.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return l.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return l.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return l.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return l.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return l.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return l.BYTE;if(e===THREE.ShortType)return l.SHORT;if(e===THREE.UnsignedShortType)return l.UNSIGNED_SHORT;if(e===THREE.IntType)return l.INT;if(e===THREE.UnsignedIntType)return l.UNSIGNED_INT;if(e===THREE.FloatType)return l.FLOAT;if(null!==(t=P.get("OES_texture_half_float"))&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return l.ALPHA;if(e===THREE.RGBFormat)return l.RGB;if(e===THREE.RGBAFormat)return l.RGBA;if(e===THREE.LuminanceFormat)return l.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return l.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return l.FUNC_ADD;if(e===THREE.SubtractEquation)return l.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return l.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return l.ZERO;if(e===THREE.OneFactor)return l.ONE;if(e===THREE.SrcColorFactor)return l.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return l.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return l.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return l.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return l.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return l.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return l.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return l.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return l.SRC_ALPHA_SATURATE;if(null!==(t=P.get("WEBGL_compressed_texture_s3tc"))){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=P.get("WEBGL_compressed_texture_pvrtc"))){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=P.get("EXT_blend_minmax"))){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}a.getGl=function(){return l},a.getGlState=function(){return S},a.supportsVertexTextures=function(){return x},a.supportsFloatTextures=function(){return P.get("OES_texture_float")},a.supportsHalfFloatTextures=function(){return P.get("OES_texture_half_float")},a.supportsStandardDerivatives=function(){return P.get("OES_standard_derivatives")},a.supportsCompressedTextureS3TC=function(){return P.get("WEBGL_compressed_texture_s3tc")},a.supportsCompressedTexturePVRTC=function(){return P.get("WEBGL_compressed_texture_pvrtc")},a.supportsBlendMinMax=function(){return P.get("EXT_blend_minmax")},a.getMaxAnisotropy=function(){var e;return void 0===X&&(e=P.get("EXT_texture_filter_anisotropic"),X=null!==e?l.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0),X},a.setCanvasSize=function(e,t,i,r){n.width==i&&n.height==r||(n.width=i,n.height=r,n.style.width=e+"px",n.style.height=t+"px")},a.setRenderViewport=function(e,t,i,r){l.viewport(e,t,i,r),l.scissor(e,t,i,r)},a.setRenderViewportWithPixelRatio=function(e,t,i,r){var n=window.GetXeDevicePixelRatio(),e=Math.floor(e*n),t=Math.floor(t*n),i=Math.floor(i*n),r=Math.floor(r*n);l.viewport(e,t,i,r),l.scissor(e,t,i,r)},a.enableScissorTest=function(e){e?l.enable(l.SCISSOR_TEST):l.disable(l.SCISSOR_TEST)},a.getClearColor=function(){return s},a.setClearColor=function(e,t){s.set(e),c=void 0!==t?t:1,T(s.r,s.g,s.b,c)},a.getClearAlpha=function(){return c},a.setClearAlpha=function(e){c=e,T(s.r,s.g,s.b,c)},a.clearBuffers=function(e,t,i){var r=0;void 0!==e&&!e||(r|=l.COLOR_BUFFER_BIT),void 0!==t&&!t||(r|=l.DEPTH_BUFFER_BIT),void 0!==i&&!i||(r|=l.STENCIL_BUFFER_BIT),l.clear(r)},a.clearColor=function(){l.clear(l.COLOR_BUFFER_BIT)},a.clearDepth=function(){l.clear(l.DEPTH_BUFFER_BIT)},a.clearStencil=function(){l.clear(l.STENCIL_BUFFER_BIT)},a.setProgram=function(e){m=0,a.getGlState().initAttributes(),e.id!==u&&(u=e.id,l.useProgram(e.glprogram),e.activated)&&e.activated()},a.render=function(e,t){var i=[],r=[];a.fillRenderObjectsLists(e.getXeGsDevice().getXeDocument(),t.children,i,r),i.length&&a.renderObjects(e,i),r.length&&a.renderObjects(e,r)},a.setRegenAbortTiming=function(e){h=e},a.renderObjects=function(r,n){var e=h;let t=0;var i=O();for(let i=0;i<n.length;i++)if(!(-1<e&&t>e)){let e=null,t=null;2===n[i].length?(e=n[i][0],t=n[i][1]):e=n[i];e.draw_gl_object(a,r,t)}var o=O();t+=o-i},a.getTextureUnit=function(){var e=m;return D<=e&&THREE.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+D),m+=1,e},a.setFaceCulling=function(e,t){e===THREE.CullFaceNone?l.disable(l.CULL_FACE):(t===THREE.FrontFaceDirectionCW?l.frontFace(l.CW):l.frontFace(l.CCW),e===THREE.CullFaceBack?l.cullFace(l.BACK):e===THREE.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.FRONT_AND_BACK),l.enable(l.CULL_FACE))},a.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.__webglTexture=l.createTexture()),l.bindTexture(l.TEXTURE_2D,e.__webglTexture),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,e.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=((e,t)=>{var i;return e.width>t||e.height>t?(t=t/Math.max(e.width,e.height),(i=document.createElement("canvas")).width=Math.floor(e.width*t),i.height=Math.floor(e.height*t),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),THREE.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i):e})(e.image,F);var t=e.image,i=M.isPowerOfTwo(t.width)&&M.isPowerOfTwo(t.height),r=E(e.format),n=E(e.type);G(l.TEXTURE_2D,e,i);var o,a,s,c=e.mipmaps;if(e instanceof XeDataTexture)if(0<c.length&&i){for(a=0,s=c.length;a<s;a++)o=c[a],l.texImage2D(l.TEXTURE_2D,a,r,o.width,o.height,0,r,n,o.data);e.generateMipmaps=!1}else l.texImage2D(l.TEXTURE_2D,0,r,t.width,t.height,0,r,n,t.data);else if(e instanceof XeCompressedTexture)for(a=0,s=c.length;a<s;a++)o=c[a],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?-1<V().indexOf(r)?l.compressedTexImage2D(l.TEXTURE_2D,a,r,o.width,o.height,0,o.data):THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):l.texImage2D(l.TEXTURE_2D,a,r,o.width,o.height,0,r,n,o.data);else if(0<c.length&&i){for(a=0,s=c.length;a<s;a++)o=c[a],l.texImage2D(l.TEXTURE_2D,a,r,r,n,o);e.generateMipmaps=!1}else l.texImage2D(l.TEXTURE_2D,0,r,r,n,e.image);e.generateMipmaps&&i&&l.generateMipmap(l.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},a.setTexture=function(e,t){l.activeTexture(l.TEXTURE0+t),e.needsUpdate&&a.uploadTexture(e),l.bindTexture(l.TEXTURE_2D,e.__webglTexture)},a.setRenderTarget=function(e){var t,i,r,n;e&&void 0===e.__webglFramebuffer&&(void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglTexture=l.createTexture(),t=M.isPowerOfTwo(e.width)&&M.isPowerOfTwo(e.height),i=E(e.format),n=E(e.type),e.__webglFramebuffer=l.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=l.createRenderbuffer(),l.bindTexture(l.TEXTURE_2D,e.__webglTexture),G(l.TEXTURE_2D,e,t),l.texImage2D(l.TEXTURE_2D,0,i,e.width,e.height,0,i,n,null),i=e.__webglFramebuffer,n=e,r=l.TEXTURE_2D,l.bindFramebuffer(l.FRAMEBUFFER,i),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,r,n.__webglTexture,0),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,e.__webglRenderbuffer):(i=e.__webglRenderbuffer,r=e,l.bindRenderbuffer(l.RENDERBUFFER,i),r.depthBuffer&&!r.stencilBuffer?(l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,r.width,r.height),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,i)):r.depthBuffer&&r.stencilBuffer?(l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_STENCIL,r.width,r.height),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,i)):l.renderbufferStorage(l.RENDERBUFFER,l.RGBA4,r.width,r.height)),t&&l.generateMipmap(l.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null)),(n=e?e.__webglFramebuffer:null)!==p&&(l.bindFramebuffer(l.FRAMEBUFFER,n),p=n)};var A,U,I,k,M={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(U="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),I=new Array(36),k=0,function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?I[e]="-":14===e?I[e]="4":(k<=2&&(k=33554432+16777216*Math.random()|0),A=15&k,k>>=4,I[e]=U[19===e?3&A|8:A]);return I.join("")}),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*M.DEG2RAD},radToDeg:function(e){return e*M.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e=(e=(e=(e=(e|=e>>1)|e>>2)|e>>4)|e>>8)|e>>16,++e}}}),XeWebGLRenderTarget=(XeWebGlRenderer.prototype.global_gl_context=null,XeWebGlRenderer.prototype.fillRenderObjectsLists=function(e,t,i,r){for(var e=e.getXeDatabase(),n=0;n<t.length;n++){var o,a=t[n],a=a.hasOwnProperty("length")&&2==a.length?(o=a[0],a[1]):void(o=a);o.material.transparent?a?r.push([o,a]):r.push(o):a?i.push([o,a]):i.push(o),a=o=void 0}e.getDEVOPTIONS()&DEVOPTIONS.DEVOPTIONS_DISABLE_CLIENT_SIDE_REGEN||r.length&&r.sort(XeWebGlRenderer.prototype.drawOrderPredicate)},XeWebGlRenderer.prototype.get_order_value=function(e,t){var i,r,n,o,a,s,e=e.geometry.attributes,c=null,l=0;if(!e)return 0;if(e.hasOwnProperty("fOrderValue")&&e.fOrderValue)c=e.fOrderValue.array,i=0,r=1;else{if(!e.hasOwnProperty("pack_attr_2")||!e.pack_attr_2)return 0;c=e.pack_attr_2.array,i=0,r=3}if(t)for(var d=e.index.array,u=0;u<t.length;u++){for(s=(o=t[u].o)+(a=t[u].s),n=o;n<s;n++)l+=c[d[n]];l/=a}else{for(a=0,u=i;u<c.length;u+=r)l+=c[u],a++;l/=a}return l},XeWebGlRenderer.prototype.drawOrderPredicate=function(e,t){e.hasOwnProperty("length")&&2==e.length?(i=e[0],n=e[1]):i=e,t.hasOwnProperty("length")&&2==t.length?(r=t[0],o=t[1]):r=t,n&&n.offsets&&(a=n.offsets),o&&o.offsets&&(s=o.offsets);var i,r,n,o,a,s,e=XeWebGlRenderer.prototype.get_order_value(i,a),t=XeWebGlRenderer.prototype.get_order_value(r,s);return t<e?1:e<t?-1:0},XeWebGlRenderer.prototype.m_iNestedStencilCount=0,XeWebGlRenderer.prototype.setStencilTest=function(e,t,i,r,n,o,a){if(!e)throw"XeWebGlRenderer.prototype.setStencilTest: argument [0] invalid";i=void 0===i||i,a=void 0!==a&&a;var s=this.getStencilNestedCounter(),c=this,l=c.getGl(),d=c.getGlState(),u=e,u=u.clipMethod||TYPE_ClipMethod.outer,p=(0===s&&i&&(l.enable(l.STENCIL_TEST),l.stencilMask(255),l.clearStencil(0),l.clear(l.STENCIL_BUFFER_BIT)),d.setColorWrite(!1),d.setDepthTest(!1,l.LEQUAL),s+1);0===s?(u===TYPE_ClipMethod.outer?l.stencilFunc(l.ALWAYS,p,255):u===TYPE_ClipMethod.inner&&(i&&(l.enable(l.STENCIL_TEST),l.stencilMask(255),l.clearStencil(p),l.clear(l.STENCIL_BUFFER_BIT)),l.stencilFunc(l.ALWAYS,p-1,255)),l.stencilOp(l.REPLACE,l.REPLACE,l.REPLACE)):(l.stencilFunc(l.EQUAL,p-1,255),u===TYPE_ClipMethod.outer?l.stencilOp(l.KEEP,l.KEEP,l.INCR):u===TYPE_ClipMethod.inner&&l.stencilOp(l.INCR,l.KEEP,l.KEEP)),c.plusStencilNestedCounter();let m=0;for(m=0;m<e.children.length;m++)e.children[m].draw_gl_object_stencil(c,t,r,n,o);if(d.setDepthTest(!0,l.LEQUAL),d.setDepthWrite(!0),d.setColorWrite(!0),l.stencilFunc(l.EQUAL,p,p),l.stencilOp(l.KEEP,l.KEEP,l.KEEP),a)for(m=0;m<e.children.length;m++){var h=e.children[m],g={};g.m_xeGsChunk=r,g.m_xeGsChunkTraits=n,g.m_xeGsChunkDecoration=o,h.draw_gl_object(c,t,g)}return!0},XeWebGlRenderer.prototype.setStencilNestedCounter=function(e){if(this.m_iNestedStencilCount=e,this.m_iNestedStencilCount<0)throw"XeWebGlRenderer.prototype.setStencilNestedCounter : this.m_iNestedStencilCount < 0"},XeWebGlRenderer.prototype.getStencilNestedCounter=function(){return this.m_iNestedStencilCount},XeWebGlRenderer.prototype.plusStencilNestedCounter=function(){this.m_iNestedStencilCount++},XeWebGlRenderer.prototype.minusStencilNestedCounter=function(){if(this.m_iNestedStencilCount--,this.m_iNestedStencilCount<0)throw"XeWebGlRenderer.prototype.setStencilNestedCounter : this.m_iNestedStencilCount < 0";this.m_iNestedStencilCount},XeWebGlRenderer.prototype.clearStencilTest=function(){var e=this.getGl(),t=this.getStencilNestedCounter();if(1!==t)throw"XeWebGlRenderer.prototype.clearStencilTest: error, iNestedStencilCount == "+t;e.stencilMask(0),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT),e.disable(e.STENCIL_TEST),this.minusStencilNestedCounter()},XeWebGlRenderer.prototype.unsetStencilTest=function(e,t,i){if(!e)throw"XeWebGlRenderer.prototype.setStencilTest: argument [0] invalid";var r=this,n=r.getGl(),o=r.getGlState(),a=e.clipMethod||TYPE_ClipMethod.outer,s=r.getStencilNestedCounter();if(s<0)throw"DrawingEngine :: unsetStencilTestImpl iNestedStencilCount < 0";return 0!=s&&(1===s?(n.stencilMask(0),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.disable(n.STENCIL_TEST),r.minusStencilNestedCounter(),!0):1<s?(s=s-1,o.setColorWrite(!1),o.setDepthTest(!1,n.LEQUAL),n.stencilFunc(n.EQUAL,1+s,255),a===TYPE_ClipMethod.outer?n.stencilOp(n.KEEP,n.KEEP,n.DECR):a===TYPE_ClipMethod.inner&&n.stencilOp(n.DECR,n.KEEP,n.KEEP),r.render(t,e),n.stencilFunc(n.EQUAL,s,s),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),o.setColorWrite(!0),o.setDepthTest(!0,n.LEQUAL),r.minusStencilNestedCounter(),!0):void 0)},XeWebGlRenderer.prototype.common_data={null_texture:null,textures:{},m_CachedCircles:null,getXeGlCachedCircles:function(){return this.m_CachedCircles},init:function(){this.dispose(),this.null_texture=new XeDataTexture(new Uint8Array([0,0,0,0,0,0,0,0]),1,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,1),this.null_texture.premultiplyAlpha=!1,this.null_texture.flipY=!1,this.null_texture.generateMipmaps=!1,this.null_texture.needsUpdate=!0,this.m_CachedCircles=new XeGLCachedCircles},dispose:function(){for(var e in this.textures)this.textures.hasOwnProperty(e)&&this.textures[e]&&this.textures[e].texture&&this.textures[e].texture.dispose();this.textures={},this.null_texture&&this.null_texture.dispose(),this.null_texture=null,this.m_CachedCircles&&this.m_CachedCircles.dispose(),this.m_CachedCircles=void 0}},XeWebGlRenderer.prototype.getIndexArrayType=function(e){return new Uint16Array(e)},XeWebGlRenderer.prototype.getTypeOfIndexArray=function(e){return Uint16Array},XeWebGlRenderer.prototype.getDrawElementsType=function(e){return e.UNSIGNED_SHORT},XeWebGlRenderer.prototype.testWebGL2=function(){var e={alpha:!0,depth:!0,stencil:!0,antialias:window.GetXeUseAntialias(),premultipliedAlpha:!1,preserveDrawingBuffer:!0};try{var t=document.createElement("canvas").getContext("webgl2",e);if(t&&t instanceof window.WebGL2RenderingContext)return!0}catch(e){}return!1},window.m_xeDevicePixelCriteria=2,window.GetXeDevicePixelRatio=function(){let e=window.devicePixelRatio;return e=2<e?2:e},window.m_xeTextureAA=0,window.GetXeTextureAA=function(){return window.m_xeTextureAA},window.m_xeTextureScreenCache=!0,window.GetXeTextureScreenCache=function(){return window.m_xeTextureScreenCache},window.m_bUseAntialias=void 0,window.GetXeUseAntialias=function(){if(void 0===window.m_bUseAntialias){window.m_bUseAntialias=!0;var t=decodeURIComponent(window.location.search.substr(1)).split("&");for(let e=0;e<t.length;e++){var i=t[e].split("=");2===i.length&&"noantialiasing"===i[0]&&(window.m_bUseAntialias=!1)}}return this.m_bUseAntialias},function(e,t,i){var r=this;r.width=e,r.height=t,r.wrapS=void 0!==(i=i||{}).wrapS?i.wrapS:THREE.ClampToEdgeWrapping,r.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,r.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,r.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,r.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,r.offset=new THREE.Vector2(0,0),r.repeat=new THREE.Vector2(1,1),r.format=void 0!==i.format?i.format:THREE.RGBAFormat,r.type=void 0!==i.type?i.type:THREE.UnsignedByteType,r.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,r.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,r.generateMipmaps=!1,r.shareDepthFrom=void 0!==i.shareDepthFrom?i.shareDepthFrom:null}),XeWebGLState=(XeWebGLRenderTarget.prototype.setSize=function(e,t){this.width=e,this.height=t},XeWebGLRenderTarget.prototype.dispose=function(e){var t,e=e||XeWebGlRenderer.prototype.global_gl_context;e&&(t=this)&&t.__webglTexture&&(e.deleteTexture(t.__webglTexture),delete t.__webglTexture,e.deleteFramebuffer(t.__webglFramebuffer),e.deleteRenderbuffer(t.__webglRenderbuffer),delete t.__webglFramebuffer,delete t.__webglRenderbuffer)},function(s,e){var t=this,n=new Uint8Array(16),o=new Uint8Array(16),i=new Uint8Array(16),c={bEnable:null,glModeRGB:null,glModeAlpha:null,glSrcRGB:null,glDstRGB:null,glSrcAlpha:null,glDstAlpha:null},r=null,a=null,l=null,d=null,u=null,p=null,m=null,h=null,g=null,y=null;t.initAttributes=function(){for(var e=0,t=o.length;e<t;e++)1==o[e]&&(s.disableVertexAttribArray(e),o[e]=0);for(var i=0,r=n.length;i<r;i++)n[i]=0},t.enableAttribute=function(e){n[e]=1,0===o[e]&&(s.enableVertexAttribArray(e),o[e]=1)},t.enableDivisor=function(e,t){try{n[e]=1,0===o[e]&&(s.enableVertexAttribArray(e),o[e]=1),i[e]!==t&&(s.vertexAttribDivisor?s.vertexAttribDivisor(e,t):s._instancedArrays.vertexAttribDivisorANGLE(e,t),i[e]=t)}catch(e){window.XeLogger.warn("enableDivisor error: "+e)}},t.disableUnusedAttributes=function(){for(var e=0;e<o.length;e++)o[e]!==n[e]&&(s.disableVertexAttribArray(e),o[e]=0)},t.disableDivisors=function(){try{for(var e=0;e<i.length;e++)s.vertexAttribDivisor?s.vertexAttribDivisor(e,0):s._instancedArrays.vertexAttribDivisorANGLE(e,0),i[e]=0}catch(e){window.XeLogger.warn("disableDivisors error: "+e)}},t.setBlending=function(e,t,i,r,n,o,a){c.bEnable!==e&&(e?s.enable(s.BLEND):s.disable(s.BLEND),c.bEnable=e),c.bEnable&&(c.glModeRGB===t&&c.glModeAlpha===i||(s.blendEquationSeparate(t,i),c.glModeRGB=t,c.glModeAlpha=i),c.glSrcRGB===r&&c.glDstRGB===n&&c.glSrcAlpha===o&&c.glDstAlpha===a||(s.blendFuncSeparate(r,n,o,a),c.glSrcRGB=r,c.glDstRGB=n,c.glSrcAlpha=o,c.glDstAlpha=a))},t.setDepthTest=function(e,t){r!==e&&(e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),r=e),r&&(void 0===t&&(t=s.LESS),a!==t)&&(s.depthFunc(t),a=t)},t.setDepthWrite=function(e){l!==e&&(s.depthMask(e),l=e)},t.setColorWrite=function(e){d!==e&&(s.colorMask(e,e,e,e),d=e)},t.setDoubleSided=function(e){u!==e&&(e?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),u=e)},t.setFlipSided=function(e){p!==e&&(e?s.frontFace(s.CW):s.frontFace(s.CCW),p=e)},t.setLineWidth=function(e){e!==m&&(s.lineWidth(e),m=e)},t.setPolygonOffset=function(e,t,i){h!==e&&(e?s.enable(s.POLYGON_OFFSET_FILL):s.disable(s.POLYGON_OFFSET_FILL),h=e),!e||g===t&&y===i||(s.polygonOffset(t,i),g=t,y=i)},t.reset=function(){for(var e=0;e<o.length;e++)o[e]=0;c={bEnable:null,glModeRGB:null,glModeAlpha:null,glSrcRGB:null,glDstRGB:null,glSrcAlpha:null,glDstAlpha:null},p=u=d=l=a=r=null}}),XeChunkCache=(THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},Object.assign(THREE.Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,c=e.length;s<c;s+=3){var l=e[s],d=e[s+1],u=e[s+2];l<t&&(t=l),d<i&&(i=d),u<r&&(r=u),n<l&&(n=l),o<d&&(o=d),a<u&&(a=u)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,c=e.count;s<c;s++){var l=e.getX(s),d=e.getY(s),u=e.getZ(s);l<t&&(t=l),d<i&&(i=d),u<r&&(r=u),n<l&&(n=l),o<d&&(o=d),a<u&&(a=u)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){t=(new THREE.Vector3).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){e=e||new THREE.Vector3;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){e=e||new THREE.Vector3;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){var a=new THREE.Vector3,s=this;return e.updateMatrixWorld(!0),e.traverse(function(e){var t=e.geometry;if(void 0!==t)if(t.isGeometry)for(var i=t.vertices,r=0,n=i.length;r<n;r++)a.copy(i[r]),a.applyMatrix4(e.matrixWorld),s.expandByPoint(a);else if(t.isBufferGeometry){var o=t.attributes.position;if(void 0!==o)for(r=0,n=o.count;r<n;r++)a.fromBufferAttribute(o,r).applyMatrix4(e.matrixWorld),s.expandByPoint(a)}}),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new THREE.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){var t=new THREE.Vector3;return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,i=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x);return 0<e.normal.y?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return(new THREE.Vector3).copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){var t=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Color=function(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)},Object.assign(THREE.Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.b=(e>>16&255)/255,this.g=(e>>8&255)/255,this.r=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(l=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,r,n,o,a=l[1],s=l[2];switch(a){case"rgb":case"rgba":if(o=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,e(o[5]),this;if(o=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,e(o[5]),this;break;case"hsl":case"hsla":if(o=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return i=parseFloat(o[1])/360,r=parseInt(o[2],10)/100,n=parseInt(o[3],10)/100,e(o[5]),this.setHSL(i,r,n)}}else if(/^\#([A-Fa-f0-9]+)$/.exec(t)){var c,l=(c=/^\#([A-Fa-f0-9]+)$/.exec(t)[1]).length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&0<t.length&&(void 0!==(c=THREE.ColorKeywords[t])?this.setHex(c):console.warn("THREE.Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t=0<(t=void 0===t?2:t)?1/t:1;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,e=e||{h:0,s:0,l:0},i=this.r,r=this.g,n=this.b,o=Math.max(i,r,n),a=Math.min(i,r,n),s=(a+o)/2;if(a===o)l=t=0;else{var c=o-a,l=s<=.5?c/(o+a):c/(2-o-a);switch(o){case i:t=(r-n)/c+(r<n?6:0);break;case r:t=(n-i)/c+2;break;case n:t=(i-r)/c+4}t/=6}return e.h=t,e.s=l,e.l=s,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return this.r=e[t=void 0===t?0:t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),THREE.Matrix4=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&window.XeLogger.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},Object.assign(THREE.Matrix4.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g){var y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=r,y[1]=n,y[5]=o,y[9]=a,y[13]=s,y[2]=c,y[6]=l,y[10]=d,y[14]=u,y[3]=p,y[7]=m,y[11]=h,y[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(e){var t=new THREE.Vector3,i=this.elements,r=e.elements,n=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),t=1/t.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*t,i[9]=r[9]*t,i[10]=r[10]*t,this},makeRotationFromEuler:function(e){e&&e.isEuler||window.XeLogger.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t,i,r,n,o,a,s,c,l,d,u,p,m=this.elements,h=e.x,g=e.y,y=e.z,f=Math.cos(h),h=Math.sin(h),_=Math.cos(g),g=Math.sin(g),w=Math.cos(y),y=Math.sin(y);return"XYZ"===e.order?(t=f*w,i=f*y,r=h*w,n=h*y,m[0]=_*w,m[4]=-_*y,m[8]=g,m[1]=i+r*g,m[5]=t-n*g,m[9]=-h*_,m[2]=n-t*g,m[6]=r+i*g,m[10]=f*_):"YXZ"===e.order?(a=_*y,s=g*w,m[0]=(o=_*w)+(c=g*y)*h,m[4]=s*h-a,m[8]=f*g,m[1]=f*y,m[5]=f*w,m[9]=-h,m[2]=a*h-s,m[6]=c+o*h,m[10]=f*_):"ZXY"===e.order?(a=_*y,s=g*w,m[0]=(o=_*w)-(c=g*y)*h,m[4]=-f*y,m[8]=s+a*h,m[1]=a+s*h,m[5]=f*w,m[9]=c-o*h,m[2]=-f*g,m[6]=h,m[10]=f*_):"ZYX"===e.order?(t=f*w,i=f*y,r=h*w,n=h*y,m[0]=_*w,m[4]=r*g-i,m[8]=t*g+n,m[1]=_*y,m[5]=n*g+t,m[9]=i*g-r,m[2]=-g,m[6]=h*_,m[10]=f*_):"YZX"===e.order?(l=f*_,d=f*g,u=h*_,p=h*g,m[0]=_*w,m[4]=p-l*y,m[8]=u*y+d,m[1]=y,m[5]=f*w,m[9]=-h*w,m[2]=-g*w,m[6]=d*y+u,m[10]=l-p*y):"XZY"===e.order&&(l=f*_,d=f*g,u=h*_,p=h*g,m[0]=_*w,m[4]=-y,m[8]=g*w,m[1]=l*y+p,m[5]=f*w,m[9]=d*y-u,m[2]=u*y-d,m[6]=h*w,m[10]=p*y+l),m[3]=0,m[7]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,e=e._w,o=i+i,a=r+r,s=n+n,c=i*o,l=i*a,i=i*s,d=r*a,r=r*s,n=n*s,o=e*o,a=e*a,e=e*s;return t[0]=1-(d+n),t[4]=l-e,t[8]=i+a,t[1]=l+e,t[5]=1-(c+n),t[9]=r-o,t[2]=i-a,t[6]=r+o,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(e,t,i){var r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,a=this.elements;return o.subVectors(e,t),0===o.lengthSq()&&(o.z=1),o.normalize(),r.crossVectors(i,o),0===r.lengthSq()&&(1===Math.abs(i.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),r.crossVectors(i,o)),r.normalize(),n.crossVectors(o,r),a[0]=r.x,a[4]=n.x,a[8]=o.x,a[1]=r.y,a[5]=n.y,a[9]=o.y,a[2]=r.z,a[6]=n.z,a[10]=o.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var e=e.elements,t=t.elements,i=this.elements,r=e[0],n=e[4],o=e[8],a=e[12],s=e[1],c=e[5],l=e[9],d=e[13],u=e[2],p=e[6],m=e[10],h=e[14],g=e[3],y=e[7],f=e[11],e=e[15],_=t[0],w=t[4],v=t[8],C=t[12],T=t[1],b=t[5],X=t[9],S=t[13],P=t[2],D=t[6],x=t[10],O=t[14],G=t[3],E=t[7],A=t[11],t=t[15];return i[0]=r*_+n*T+o*P+a*G,i[4]=r*w+n*b+o*D+a*E,i[8]=r*v+n*X+o*x+a*A,i[12]=r*C+n*S+o*O+a*t,i[1]=s*_+c*T+l*P+d*G,i[5]=s*w+c*b+l*D+d*E,i[9]=s*v+c*X+l*x+d*A,i[13]=s*C+c*S+l*O+d*t,i[2]=u*_+p*T+m*P+h*G,i[6]=u*w+p*b+m*D+h*E,i[10]=u*v+p*X+m*x+h*A,i[14]=u*C+p*S+m*O+h*t,i[3]=g*_+y*T+f*P+e*G,i[7]=g*w+y*b+f*D+e*E,i[11]=g*v+y*X+f*x+e*A,i[15]=g*C+y*S+f*O+e*t,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=new THREE.Vector3,i=0,r=e.count;i<r;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],c=e[13],l=e[2],d=e[6],u=e[10],p=e[14];return e[3]*(n*s*d-r*c*d-n*a*u+i*c*u+r*a*p-i*s*p)+e[7]*(t*s*p-t*c*u+n*o*u-r*o*p+r*c*l-n*s*l)+e[11]*(t*c*d-t*a*p-n*o*d+i*o*p+n*a*l-i*c*l)+e[15]*(-r*a*l-t*s*d+t*a*u+r*o*d-i*o*u+i*s*l)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,e=e.elements,r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],d=e[7],u=e[8],p=e[9],m=e[10],h=e[11],g=e[12],y=e[13],f=e[14],e=e[15],_=p*f*d-y*m*d+y*l*h-c*f*h-p*l*e+c*m*e,w=g*m*d-u*f*d-g*l*h+s*f*h+u*l*e-s*m*e,v=u*y*d-g*p*d+g*c*h-s*y*h-u*c*e+s*p*e,C=g*p*l-u*y*l-g*c*m+s*y*m+u*c*f-s*p*f,T=r*_+n*w+o*v+a*C;if(0==T){var b="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(b);return console.warn(b),this.identity()}t=1/T;return i[0]=_*t,i[1]=(y*m*a-p*f*a-y*o*h+n*f*h+p*o*e-n*m*e)*t,i[2]=(c*f*a-y*l*a+y*o*d-n*f*d-c*o*e+n*l*e)*t,i[3]=(p*l*a-c*m*a-p*o*d+n*m*d+c*o*h-n*l*h)*t,i[4]=w*t,i[5]=(u*f*a-g*m*a+g*o*h-r*f*h-u*o*e+r*m*e)*t,i[6]=(g*l*a-s*f*a-g*o*d+r*f*d+s*o*e-r*l*e)*t,i[7]=(s*m*a-u*l*a+u*o*d-r*m*d-s*o*h+r*l*h)*t,i[8]=v*t,i[9]=(g*p*a-u*y*a-g*n*h+r*y*h+u*n*e-r*p*e)*t,i[10]=(s*y*a-g*c*a+g*n*d-r*y*d-s*n*e+r*c*e)*t,i[11]=(u*c*a-s*p*a-u*n*d+r*p*d+s*n*h-r*c*h)*t,i[12]=C*t,i[13]=(u*y*o-g*p*o+g*n*m-r*y*m-u*n*f+r*p*f)*t,i[14]=(g*c*o-s*y*o-g*n*l+r*y*l+s*n*f-r*c*f)*t,i[15]=(s*p*o-u*c*o+u*n*l-r*p*l-s*n*m+r*c*m)*t,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,e=e.z;return t[0]*=i,t[4]*=r,t[8]*=e,t[1]*=i,t[5]*=r,t[9]*=e,t[2]*=i,t[6]*=r,t[10]*=e,t[3]*=i,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(t,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),t=Math.sin(t),r=1-i,n=e.x,o=e.y,e=e.z,a=r*n,s=r*o;return this.set(a*n+i,a*o-t*e,a*e+t*o,0,a*o+t*e,s*o+i,s*e-t*n,0,a*e-t*o,s*e+t*n,r*e*e+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(e,t,i){var r=new THREE.Vector3,n=new THREE.Matrix4,o=this.elements,a=r.set(o[0],o[1],o[2]).length(),s=r.set(o[4],o[5],o[6]).length(),r=r.set(o[8],o[9],o[10]).length(),e=(this.determinant()<0&&(a=-a),e.x=o[12],e.y=o[13],e.z=o[14],n.copy(this),1/a),o=1/s,c=1/r;return n.elements[0]*=e,n.elements[1]*=e,n.elements[2]*=e,n.elements[4]*=o,n.elements[5]*=o,n.elements[6]*=o,n.elements[8]*=c,n.elements[9]*=c,n.elements[10]*=c,t.setFromRotationMatrix(n),i.x=a,i.y=s,i.z=r,this},makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*n/(i-r),c=(t+e)/(t-e),i=(i+r)/(i-r),r=-(o+n)/(o-n),o=-2*o*n/(o-n);return a[0]=2*n/(t-e),a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=s,a[9]=i,a[13]=0,a[2]=0,a[6]=0,a[10]=r,a[14]=o,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=1/(t-e),c=1/(i-r),l=1/(o-n),t=(t+e)*s,e=(i+r)*c,i=(o+n)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-t,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-e,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-i,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){var i=this.elements;return(e=void 0===e?[]:e)[t=void 0===t?0:t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),THREE.Quaternion=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1},Object.assign(THREE.Quaternion,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,o,a){var s,c,l,d=i[r+0],u=i[r+1],p=i[r+2],i=i[r+3],r=n[o+0],m=n[o+1],h=n[o+2],n=n[o+3];i===n&&d===r&&u===m&&p===h||(o=1-a,s=0<=(c=d*r+u*m+p*h+i*n)?1:-1,(l=1-c*c)>Number.EPSILON&&(l=Math.sqrt(l),c=Math.atan2(l,c*s),o=Math.sin(o*c)/l,a=Math.sin(a*c)/l),d=d*o+r*(c=a*s),u=u*o+m*c,p=p*o+h*c,i=i*o+n*c,o===1-a&&(d*=l=1/Math.sqrt(d*d+u*u+p*p+i*i),u*=l,p*=l,i*=l)),e[t]=d,e[t+1]=u,e[t+2]=p,e[t+3]=i}}),Object.defineProperties(THREE.Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(THREE.Quaternion.prototype,{set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){var i,r,n,o,a,s,c;if(e&&e.isEuler)return a=e._x,s=e._y,i=e._z,e=e.order,o=Math.cos,c=Math.sin,r=o(a/2),n=o(s/2),o=o(i/2),a=c(a/2),s=c(s/2),c=c(i/2),"XYZ"===e?(this._x=a*n*o+r*s*c,this._y=r*s*o-a*n*c,this._z=r*n*c+a*s*o,this._w=r*n*o-a*s*c):"YXZ"===e?(this._x=a*n*o+r*s*c,this._y=r*s*o-a*n*c,this._z=r*n*c-a*s*o,this._w=r*n*o+a*s*c):"ZXY"===e?(this._x=a*n*o-r*s*c,this._y=r*s*o+a*n*c,this._z=r*n*c+a*s*o,this._w=r*n*o-a*s*c):"ZYX"===e?(this._x=a*n*o-r*s*c,this._y=r*s*o+a*n*c,this._z=r*n*c-a*s*o,this._w=r*n*o+a*s*c):"YZX"===e?(this._x=a*n*o+r*s*c,this._y=r*s*o+a*n*c,this._z=r*n*c-a*s*o,this._w=r*n*o-a*s*c):"XZY"===e&&(this._x=a*n*o-r*s*c,this._y=r*s*o-a*n*c,this._z=r*n*c+a*s*o,this._w=r*n*o+a*s*c),!1!==t&&this.onChangeCallback(),this;throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")},setFromAxisAngle:function(e,t){var t=t/2,i=Math.sin(t);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(t),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,e=e.elements,i=e[0],r=e[4],n=e[8],o=e[1],a=e[5],s=e[9],c=e[2],l=e[6],e=e[10],d=i+a+e;return 0<d?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(l-s)*t,this._y=(n-c)*t,this._z=(o-r)*t):a<i&&e<i?(t=2*Math.sqrt(1+i-a-e),this._w=(l-s)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(n+c)/t):e<a?(t=2*Math.sqrt(1+a-i-e),this._w=(n-c)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(s+l)/t):(t=2*Math.sqrt(1+e-i-a),this._w=(o-r)/t,this._x=(n+c)/t,this._y=(s+l)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){var i,r=new THREE.Vector3;return void 0===r&&(r=new THREE.Vector3),(i=e.dot(t)+1)<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize()},inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,e=e._w,o=t._x,a=t._y,s=t._z,t=t._w;return this._x=i*t+e*o+r*s-n*a,this._y=r*t+e*a+n*o-i*s,this._z=n*t+e*s+i*a-r*o,this._w=e*t-i*o-r*a-n*s,this.onChangeCallback(),this},slerp:function(e,t){if(0!==t){if(1===t)return this.copy(e);var i,r=this._x,n=this._y,o=this._z,a=this._w,s=a*e._w+r*e._x+n*e._y+o*e._z;s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),1<=s?(this._w=a,this._x=r,this._y=n,this._z=o):(e=Math.sqrt(1-s*s),Math.abs(e)<.001?(this._w=.5*(a+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(o+this._z)):(s=Math.atan2(e,s),i=Math.sin((1-t)*s)/e,t=Math.sin(t*s)/e,this._w=a*i+this._w*t,this._x=r*i+this._x*t,this._y=n*i+this._y*t,this._z=o*i+this._z*t,this.onChangeCallback()))}return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return this._x=e[t=void 0===t?0:t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},Object.defineProperties(THREE.Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(THREE.Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){var i=new THREE.Vector2,r=new THREE.Vector2;return i.set(e,e),r.set(t,t),this.clamp(i,r)},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return this.x=e[t=void 0===t?0:t],this.y=e[t+1],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),t=Math.sin(t),r=this.x-e.x,n=this.y-e.y;return this.x=r*i-n*t+e.x,this.y=r*t+n*i+e.y,this}}),THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},Object.assign(THREE.Vector3.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyAxisAngle:(()=>{var i=new THREE.Quaternion;return function(e,t){return this.applyQuaternion(i.setFromAxisAngle(e,t))}})(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[3]*i+e[6]*r,this.y=e[1]*t+e[4]*i+e[7]*r,this.z=e[2]*t+e[5]*i+e[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,e=e.elements,n=1/(e[3]*t+e[7]*i+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*r+e[12])*n,this.y=(e[1]*t+e[5]*i+e[9]*r+e[13])*n,this.z=(e[2]*t+e[6]*i+e[10]*r+e[14])*n,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,e=e.w,s=e*t+o*r-a*i,c=e*i+a*t-n*r,l=e*r+n*i-o*t,t=-n*t-o*i-a*r;return this.x=s*e+t*-n+c*-a-l*-o,this.y=c*e+t*-o+l*-n-s*-a,this.z=l*e+t*-a+s*-o-c*-n,this},transformDirection:function(e){var t=this.x,i=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*r,this.y=e[1]*t+e[5]*i+e[9]*r,this.z=e[2]*t+e[6]*i+e[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:(()=>{var i=new THREE.Vector3,r=new THREE.Vector3;return function(e,t){return i.set(e,e,e),r.set(t,t,t),this.clamp(i,r)}})(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){var i,r;return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):(t=this.x,i=this.y,r=this.z,this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this)},crossVectors:function(e,t){var i=e.x,r=e.y,e=e.z,n=t.x,o=t.y,t=t.z;return this.x=r*t-e*o,this.y=e*n-i*t,this.z=i*o-r*n,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:(()=>{var t=new THREE.Vector3;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}})(),reflect:(()=>{var t=new THREE.Vector3;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}})(),angleTo:function(e){e=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return 1<e?e=1:e<-1&&(e=-1),Math.acos(e)},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,e=this.z-e.z;return t*t+i*i+e*e},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return this.x=e[t=void 0===t?0:t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),function(){var i=this;function r(e,t,i){e.index>n&&e.index--}i.getChunk=function(e){e=o.get(e);if(e&&0<=e.index)return i.array[e.index].chunk},i.add=function(e){var t;e&&(i.remove(e),t=e.getId(),i.array.push({key:t,chunk:e}),o.set(t,{index:i.array.length-1}))},i.remove=function(e){var t;e&&(e=e.getId(),t=o.get(e))&&0<=t.index&&(i.array.splice(t.index,1),n=t.index,o.delete(e),o.forEach(r),n=-1)},i.reset=function(){i.array=[],n=-1,o=new Map},i.array=[];var n=-1,o=new Map}),XeChunkPassOptions=function(){this.setIfNotPassArray=function(e){i=e},this.check=function(e){for(var t=0,t=0;t<i.length;t++)if(e[i[t]]())return!1;return!0};var i=[]},XeRedrawTiming=function(){var t=this,e=(t.start_gl_scene=function(){e.gl_scene=(new Date).getTime()},t.end_gl_scene=function(){e.gl_scene=(new Date).getTime()-e.gl_scene,i.gl_scene_summ+=e.gl_scene,i.gl_scene_count++},t.start_gl_trackers=function(){e.gl_trackers=(new Date).getTime()},t.end_gl_trackers=function(){e.gl_trackers=(new Date).getTime()-e.gl_trackers,i.gl_trackers_summ+=e.gl_trackers,i.gl_trackers_count++},t.start_gdi_trackers=function(){e.gdi_trackers=(new Date).getTime()},t.end_gdi_trackers=function(){e.gdi_trackers=(new Date).getTime()-e.gdi_trackers,i.gdi_trackers_summ+=e.gdi_trackers,i.gdi_trackers_count++},t.start_gdi_server_trackers=function(){e.gdi_server_trackers=(new Date).getTime()},t.end_gdi_server_trackers=function(){e.gdi_server_trackers=(new Date).getTime()-e.gdi_server_trackers,i.gdi_server_trackers_summ+=e.gdi_server_trackers,i.gdi_server_trackers_count++},t.emit=function(){var e=document.createEvent("Event");e.initEvent("XeRedrawTimingEvent",!0,!0),e.timestamp=(new Date).getTime(),e.data=t.getData(),document.dispatchEvent(e)},t.reset=function(){e={gl_scene:0,gl_trackers:0,gdi_trackers:0,gdi_server_trackers:0},i={gl_scene:0,gl_scene_summ:0,gl_scene_count:0,gl_trackers:0,gl_trackers_summ:0,gl_trackers_count:0,gdi_trackers:0,gdi_trackers_summ:0,gdi_trackers_count:0,gdi_server_trackers:0,gdi_server_trackers_summ:0,gdi_server_trackers_count:0},r={gl_scene:0,gl_trackers:0,gdi_trackers:0,gdi_server_trackers:0}},t.proc=function(){r.gl_scene<e.gl_scene&&(r.gl_scene=e.gl_scene,i.gl_scene_summ-=e.gl_scene,i.gl_scene_count--),r.gl_trackers<e.gl_trackers&&(r.gl_trackers=e.gl_trackers,i.gl_trackers_summ-=e.gl_trackers,i.gl_trackers_count--),r.gdi_trackers<e.gdi_trackers&&(r.gdi_trackers=e.gdi_trackers,i.gdi_trackers_summ-=e.gdi_trackers,i.gdi_trackers_count--),r.gdi_server_trackers<e.gdi_server_trackers&&(r.gdi_server_trackers=e.gdi_server_trackers,i.gdi_server_trackers_summ-=e.gdi_server_trackers,i.gdi_server_trackers_count--),i.gl_scene=i.gl_scene_summ/i.gl_scene_count,i.gl_trackers=i.gl_trackers_summ/i.gl_trackers_count,i.gdi_trackers=i.gdi_trackers_summ/i.gdi_trackers_count,i.gdi_server_trackers=i.gdi_server_trackers_summ/i.gdi_server_trackers_count},t.getData=function(){return{CurrentTimings:{gl_scene:e.gl_scene,gl_trackers:e.gl_trackers,gdi_trackers:e.gdi_trackers,gdi_server_trackers:e.gdi_server_trackers},AverageTimings:{gl_scene:i.gl_scene,gl_trackers:i.gl_trackers,gdi_trackers:i.gdi_trackers,gdi_server_trackers:i.gdi_server_trackers},MaxTimings:{gl_scene:r.gl_scene,gl_trackers:r.gl_trackers,gdi_trackers:r.gdi_trackers,gdi_server_trackers:r.gdi_server_trackers}}},{gl_scene:0,gl_trackers:0,gdi_trackers:0,gdi_server_trackers:0}),i={gl_scene:0,gl_scene_summ:0,gl_scene_count:0,gl_trackers:0,gl_trackers_summ:0,gl_trackers_count:0,gdi_trackers:0,gdi_trackers_summ:0,gdi_trackers_count:0,gdi_server_trackers:0,gdi_server_trackers_summ:0,gdi_server_trackers_count:0},r={gl_scene:0,gl_trackers:0,gdi_trackers:0,gdi_server_trackers:0}},XeDrawScene=function(){this.children=[],this.lights=[],this.autoUpdate=!1},XeTimerQueue=(XeDrawScene.prototype.copy=function(){var e=new XeDrawScene;return e.children=this.children.slice(),e.lights=this.lights.slice(),e.autoUpdate=!1,e},function(){function i(){r.length&&r.shift()[0](),n&&clearTimeout(n),r.length&&(n=setTimeout(i,r[0][1]))}this.clear=function(){n&&clearTimeout(n),r=[],n=0},this.push=function(e,t){r.push([e,t=t||o]),n&&clearTimeout(n),n=setTimeout(i,r[0][1])};var r=[],n=0,o=1e3}),XeWebDrawerEngine=function(){var i=this,e=(i.getImpl=function(){return e},i.isValid=function(){return i.getImpl().isValid()},i.StartGLProcessing=function(e){return(/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document||window.XeUtils.WEB_RENDERER_PARAMS.isMobile)&&(XeWebDrawerEngine.prototype.bDrawInstancedLineweight=!1),i.setXeEventHandler(),i.getImpl().StartGLProcessing(e),!!i.getImpl().isValid()&&(e=i.getXeRenderer().getGl(),XeWebGlRenderer.prototype.global_gl_context=e,window.xeGlGlobalUniformData.reset(),window.XeShaders.init(e),XeWebGlRenderer.prototype.common_data.init(),!0)},i.StopGLProcessing=function(){this.initXeTimerQueue(),this.getImpl().StopGLProcessing(),this.m_XeInitQueue.clear()},i.addGLDrawCallInfo=function(e,t){i.getImpl().addGLDrawCallInfo(e,t)},i.addGLInstancedDrawCallInfo=function(e,t){i.getImpl().addGLInstancedDrawCallInfo(e,t)},i.addGLMemoryInfo=function(e){i.getImpl().addGLMemoryInfo(e)},i.getIntersected=function(e){return i.getImpl().getIntersected(e)},i.getXeRenderer=function(){return i.getImpl().getXeRenderer()},i.getActualRenderMode=function(){return i.getXeRenderer().renderMode},i.getStats=function(){return t},i.isAnimationLoopActive=()=>0<i.setFrameLoop_counter,new XeWebDrawerEngineImpl(i)),t=new Stats;t.showPanel(0),t.dom.style.position="absolute",t.dom.style.display="none",new WT_Jquery_DraggableFix(t.dom,t.dom,!1),document.body.appendChild(t.dom),window.XeAnimationsRunning||(window.XeAnimationsRunning={count:0,draw_last:!1}),window.XeAnimationsRunning.count=0,window.XeAnimationsRunning.draw_last=!1},bEnableAllGlDebugLog=(XeWebDrawerEngine.prototype.bUseWebGl2=!0,XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled=!0,XeWebDrawerEngine.prototype.bDrawInstancedLineweight=!0,XeWebDrawerEngine.prototype.Trackers_Debug_Always_Render=!1,XeWebDrawerEngine.prototype.RENDERER_USER_VIEW=1,XeWebDrawerEngine.prototype.RENDERER_CP_VIEW=2,XeWebDrawerEngine.prototype.Performance_use_regenabort=!1,XeWebDrawerEngine.prototype.Performance_use_regenabort_timing=8,XeWebDrawerEngine.prototype.DrawObjectBypassDraw=!1,XeWebDrawerEngine.prototype.DrawObjectBypass_Debug_Extents=!1,XeWebDrawerEngine.prototype.FillViewportsCache_NonViewportDependent_Blocks=!0,XeWebDrawerEngine.prototype.emit_event=function(e,t){var i=document.createEvent("Event");if(i.initEvent(e,!0,!0),t)for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);document.dispatchEvent(i)},XeWebDrawerEngine.prototype.deallocateScene=function(e){for(var t=e.children.length,i=0;i<t;i++)XeGLDrawObject.prototype.deallocate(e.children[i]);e.children=[]},XeWebDrawerEngine.prototype.setXeEventHandler=function(){document.addEventListener("XeDocument_Activated",function(e){var t=(new Date).getTime();XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("XeDocument_Deactivated",function(e){var t=(new Date).getTime();XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("XeGsDevice_LastEntity",function(e){var t=(new Date).getTime();XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("XePerfEvent",function(e){var t,i;window._LOG_GLOBAL.GET("GSDATA_UPDATE_TIME")&&(t=(new Date).getTime(),i="",e.m_TimeSent&&e.m_TimeSent!=e.m_Time&&(i=" (+"+(e.m_TimeSent-e.m_Time)+")"),window.XeLogger.log("==PERFORMANCE REPORT==>Name:"+e.m_Name+", Server Time:"+e.m_Time+i+", Client Time:"+(t-window.m_iWtStartTime)))})},XeWebDrawerEngine.prototype.PaperBlankImage=new Image,XeWebDrawerEngine.prototype.PaperBlankImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACoSURBVGhD7dKxDQAgDMTA7L90GOIKFMn0foHN7PEzx++/PeB3wQpUAA30hVAg4xVghThQARTIeAVYIQ5UAAUyXgFWiAMVQIGMV4AV4kAFUCDjFWCFOFABFMh4BVghDlQABTJeAVaIAxVAgYxXgBXiQAVQIOMVYIU4UAEUyHgFWCEOVAAFMl4BVogDFUCBjFeAFeJABVAg4xVghThQARTIeAVYIQ6cL/AAylPSwuP+Jy4AAAAASUVORK5CYII=",XeWebDrawerEngine.prototype.calculatePaperNormalMatrix=function(e){let t=new GeNeo.OdGeMatrix3d;var i,r;return t=t.setToIdentity(),e&&(i=e.getPoints(),r=e.m_PaperWidthUnits,e=e.m_PaperHeightUnits,GeNeo.OdZero(r,1e-10)||t.setentry(0,0,1/r),GeNeo.OdZero(e,1e-10)||t.setentry(1,1,1/e),t.setentry(0,3,GeNeo.OdZero(r,1e-10)?-i[0][0]:-i[0][0]/r),t.setentry(1,3,GeNeo.OdZero(e,1e-10)?-i[0][1]:-i[0][1]/e)),t},XeWebDrawerEngine.prototype.getPaperNormalMatrix=function(){return this.m_PaperNormalMatrix},XeWebDrawerEngine.prototype.setPaperNormalMatrix=function(e){this.m_PaperNormalMatrix=e},XeWebDrawerEngine.prototype.Update_XeLayoutPaper_Handler=function(r,n){let o=n;if(o){o.getScene&&o.getScene()&&XeWebDrawerEngine.prototype.deallocateScene(o.getScene());var n=new XeTexture(XeWebDrawerEngine.prototype.PaperBlankImage,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat,THREE.UnsignedByteType,1),a=(n.generateMipmaps=!1,n.needsUpdate=!0,o.getPoints()),s=o.getMargins(),c=r.getXeGsDevice().getForeground(),r=r.getXeGsDevice().getBackground();let e,t,i;o.m_PaperWidthUnits=a[2][0]-a[0][0],o.m_PaperHeightUnits=a[1][1]-a[0][1];var l=this.calculatePaperNormalMatrix(o),d=l.inverse(),u=[0,0,0,1,1,1,1,0];if(o.getDispayPaperBackground()){var p=new XeGLDrawObjectGeometry,m=(p.addAttribute("index",new XeGeometryAttribute(XeWebGlRenderer.prototype.getIndexArrayType([0,2,1,0,3,2]),!0)),[]);for(let t=0;t<a.length;t++){let e=new GeNeo.OdGePoint3d(a[t][0],a[t][1],a[t][2]);e=e.transformBy(l),m.push(e.x,e.y,e.z)}p.addAttribute("position",new XeGeometryAttribute(new Float32Array(m),!0)),p.addAttribute("uv",new XeGeometryAttribute(new Float32Array(u),!0));var r=(new THREE.Color).setHex(r),r={color:[r.r,r.g,r.b],alpha:1,useTexture:0,uTexture:n,normlMatrix:d},r=new XeGLDrawObjectMaterial({attributes:{},uniforms:r,shader:window.XeShaders.container.PaperOptimized}),p=(e=new XeGLDrawObject(p,r,XeGLDrawObjectGlType.TRIANGLES),new XeGLDrawObjectGeometry),h=(p.addAttribute("index",new XeGeometryAttribute(XeWebGlRenderer.prototype.getIndexArrayType([0,1,1,2,2,3,3,0]),!0)),[]);for(let t=0;t<a.length;t++){let e=new GeNeo.OdGePoint3d(a[t][0],a[t][1],a[t][2]);e=e.transformBy(l),h.push(e.x,e.y,e.z)}p.addAttribute("position",new XeGeometryAttribute(new Float32Array(h),!0)),p.addAttribute("uv",new XeGeometryAttribute(new Float32Array(u),!0));r=(new THREE.Color).setHex(c),r={color:[r.r,r.g,r.b],alpha:1,useTexture:0,uTexture:n,normlMatrix:d},r=new XeGLDrawObjectMaterial({attributes:{},uniforms:r,shader:window.XeShaders.container.PaperOptimized});t=new XeGLDrawObject(p,r,XeGLDrawObjectGlType.LINES)}if(o.getDispayPrintableArea()){var p=new XeGLDrawObjectGeometry,g=[],y=[];for(let n=0;n<s.length;n+=2){let e=n,t=n+1,i=new GeNeo.OdGePoint3d(s[e][0],s[e][1],s[e][2]),r=(i=i.transformBy(l),new GeNeo.OdGePoint3d(s[t][0],s[t][1],s[t][2]));r=r.transformBy(l),g.push(i.x,i.y,i.z,r.x,r.y,r.z),y.push(e,t)}p.addAttribute("index",new XeGeometryAttribute(XeWebGlRenderer.prototype.getIndexArrayType(y),!0)),p.addAttribute("position",new XeGeometryAttribute(new Float32Array(g),!0)),p.addAttribute("uv",new XeGeometryAttribute(new Float32Array(u),!0));r=(new THREE.Color).setHex(c),u={color:[r.r,r.g,r.b],alpha:1,useTexture:0,uTexture:n,normlMatrix:d},c=new XeGLDrawObjectMaterial({attributes:{},uniforms:u,shader:window.XeShaders.container.PaperOptimized});i=new XeGLDrawObject(p,c,XeGLDrawObjectGlType.LINES)}o.getScene||(o.m_Scene||(o.m_Scene=new XeDrawScene),o.getScene=function(){return o.m_Scene}),e&&o.getScene().children.push(e),t&&o.getScene().children.push(t),i&&o.getScene().children.push(i)}},XeWebDrawerEngine.prototype.initXeTimerQueue=function(){this.m_XeInitQueue||(this.m_XeInitQueue=new XeTimerQueue)},XeWebDrawerEngine.prototype.Render=function(){this.getImpl().Render()},XeWebDrawerEngine.prototype.getCanvasImage=function(){return this.getImpl().getCanvasImage()},!1),DEBUGOPTIONS={DISABLE_SELECTION:1,DRAW_CURSOR_ONLY:2,PARTIAL_LOAD:4,INVERSE_PRINTORIENTATION:8,NO_TRAITS:16,DISABLE_LINETYPER:32,LOG_EXCEPTIONS:64,DRAW_EXTENTS:128,NO_METAFILES_FOR_TEXTS:256,DRAW_UNDER_PICKBOX:512,DISABLE_DRAWORDER_FIX:1024,DEBUGOPTIONS_FLAT_GS:2048,CONSTRAINT_SOLVER:4096,NEVER_USE_THIS_VALUE:8192,DISABLE_DRAW_TRACKERS:16384,DISABLE_FIBERS:32768,DISABLE_CLIPPING:65536,ENABLE_CUSTOMDRAW_LEADER:131072,ENABLE_CONSTRAINTS:262144,ENABLE_UNKNOWN1:524288,USE_OLD_TEXT_NODES:1048576,ENABLE_OPTIONS:2097152,ENABLE_HATCH:4194304,ENABLE_DYNBLOCKS:8388608,ENABLE_MLEDIT:16777216,ENABLE_MACPAGELAYOUT:33554432,ENABLE_ADVANCE_INPLACEEDITOR:67108864,ENABLE_QUICKGROUP:134217728,PERF_TESTS_OPTIMIZATION:268435456,ENABLE_EXPORT_COOKIE_TEST:536870912,ENABLE_RIBBON:1073741824,ENABLE_LAYER_STATE_NOT:2147483648},DEVOPTIONS={DEVOPTIONS_DISABLE_REDRAW:1,DEVOPTIONS_DISABLE_CURSOR:2,DEVOPTIONS_INTEL_FIX:8,DEVOPTIONS_DRAW_QPAINTER_POLYLINES_AS_LINES:16,DEVOPTIONS_DISABLE_NEW_TTF_FOR_HEBREW:32,DEVOPTIONS_DISABLE_REGENABORT:64,DEVOPTIONS_KEEP_VALID_ZORDER:128,DEVOPTIONS_BEDIT_COMMANDS:256,DEVOPTIONS_NOTE1:512,DEVOPTIONS_ENABLE_DGNIMPORT:1024,DEVOPTIONS_NOTE2:2048,DEVOPTIONS_NOTE3:4096,DEVOPTIONS_NOTRACKERABORT:8192,DEVOPTIONS_CLIENT_TRACKER_PAINTING:16384,DEVOPTIONS_DISABLE_INCREMENTAL_REGEN:32768,DEVOPTIONS_DISABLE_CLIENT_SIDE_REGEN:65536},XeWebDrawerEngineImpl=(THREE.log=function(){window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("SHOW_THREE_ERRORS")&&window.XeLogger.log.apply(console,arguments)},THREE.warn=function(){window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("SHOW_THREE_ERRORS")&&window.XeLogger.warn.apply(console,arguments)},THREE.error=function(){window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("SHOW_THREE_ERRORS")&&window.XeLogger.error.apply(console,arguments)},function(e){var b=this,r=(b.getBase=function(){return e},b.isValid=function(){return b.m_bIsValid},b.getCanvasImage=function(){if(b.isValid())return window.getXeApplication().redraw(),t.domElement.toDataURL();window.XeLogger.error("getCanvasImage::Web drawing engine is not initialized")},b.StartGLProcessing=function(e){if(!this.isValid()){window.XeLogger.log("StartGLProcessing"),b.m_glWidget=e;var t=null;try{t=document.getElementById(e)}catch(e){window._LOG_GLOBAL.GET("SHOW_ERRORS")&&window.XeLogger.error("XeDrawer : initImpl called with errors. ERROR : "+e),t=null}e=window.XeUtils.WEB_RENDERER_PARAMS;if(t&&e.isWebGl){for(;t.hasChildNodes();)t.removeChild(t.lastChild);var i;try{i=new XeWebGlRenderer({alpha:!0,premultipliedAlpha:!1,antialias:window.GetXeUseAntialias(),stencil:!0,preserveDrawingBuffer:!0,precision:"highp"}),b.setXeRenderer(i)}catch(e){return window.XeLogger.error("StartGLProcessing: exception on creation of XeWebGlRenderer"),b.setXeRenderer(void 0),void t.appendChild(r())}if(i.setClearColor(16777215,1),i.sortObjects=!1,i.enableScissorTest(!0),i.renderMode=XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,window.XeUtils.ConnectInputEvents(i.domElement),t.appendChild(i.domElement),!t.lastChild)return window.XeLogger.error("StartGLProcessing: lastChild"),!1;b.m_bIsValid=!0}else{if(t&&!e.isWebGl){for(;t.hasChildNodes();)t.removeChild(t.lastChild);t.appendChild(r())}window.XeLogger.error("StartGLProcessing::Web drawing engine is not initialized, container is null")}}function r(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",e.innerHTML='Your browser does not support <a href="http://get.webgl.org/" style="color:#000">WebGL</a>.<br />',e}},b.StopGLProcessing=function(){var e=b.getXeRenderer().getGl();if(b.isValid()){for(var t in window.XeLogger.log("StopGLProcessing"),clientSideTrackersHolder)clientSideTrackersHolder.hasOwnProperty(t)&&clientSideTrackersHolder[t]&&clientSideTrackersHolder[t].deallocate(e);r&&r.deallocate(e),b.m_SelectionFrameBuffer&&(b.m_SelectionFrameBuffer.dispose(e),b.m_SelectionFrameBuffer=void 0),XeDrawObjectUtils.prototype.lwInstancedDrawObject&&(XeDrawObjectUtils.prototype.lwInstancedDrawObject.deallocate(),XeDrawObjectUtils.prototype.lwInstancedDrawObject=null),window.xeGlGlobalUniformData.reset(),window.XeShaders.ClearGLCache(e),XeWebGlRenderer.prototype.common_data.dispose(),g.length&&(e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.deleteBuffer(g.buffer),g.buffer=null,g.size=0,g.deferred_timeout)&&clearTimeout(g.deferred_timeout),b.m_XeRenderer&&(b.m_XeRenderer.context=void 0,b.m_XeRenderer.domElement=void 0);try{for(var i=document.getElementById(b.m_glWidget);i.hasChildNodes();)i.removeChild(i.lastChild)}catch(e){window._LOG_GLOBAL.GET("SHOW_ERRORS")&&window.XeLogger.error("XeDrawer : deallocateImpl called, getGLWidget alredy dead; ERROR : "+e)}b.m_XeRenderer=void 0,XeWebGlRenderer.prototype.global_gl_context=null,b.m_bIsValid=!1}},b.Render=function(){if(b.isValid()){var r=b.getXeRenderer(),n=b.getXeRenderTarget(),o=r.getGl();if(!o)return;var a,s=bEnableAllGlDebugLog,c=(s&&(a=new XeConsoleDebugLogger),window.getXeActiveDocument().getXeGsDevice());if(c){s&&a.add_mesuarement("function redraw >> init done");var l,d,u,p=window.GetXeDevicePixelRatio(),m=c.getPixelWidth(),h=c.getPixelHeight(),g=Math.floor(m*p),y=Math.floor(h*p);r.setCanvasSize(m,h,g,y);let t=!1;n.check(g,y)||(n.isValid()&&n.deallocate(o),n.init(o,g,y),t=!0);let i;for(l in window.m_XeApplication.m_XeDocuments){var f=(i=window.m_XeApplication.m_XeDocuments[l]).getXeGsDevice();if(!(f.m_bSceneValid&&f.m_bClientTrackersValid&&f.m_bServerTrackersValid&&f.m_bClientTrackersGLValid)){i.getXeInputPointManager().GetApertureSelection(),r.setRenderTarget(void 0),f.AdjustViewports(m,h),s&&a.add_mesuarement("function redraw >> init done");let e=f.m_bSceneValid;if(f.__screenCacheTexture||(e=!1),f.ValidateChunks(),!e){s&&a.add_mesuarement("function redraw >> scene"),b.getRedrawTiming().start_gl_scene();var _=i.getXeDatabase().getXeLayout().getPaper(),w=(r.setRenderViewport(0,0,g,y),r.renderMode=XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,f.getOverallViewport()),w=(w?b.clearScreen(r,_.getPaperBackColor(),1):b.clearScreen(r,f.getBackground(),1),f.m_bSceneValid=!0,b.renderScene(i,r));if(w)return void window._LOG_GLOBAL.SHOW("SHOW_ERRORS","ERROR --\x3e scene rendering error "+w);b.getRedrawTiming().end_gl_scene(),t&&f.__screenCacheTexture&&(o.deleteTexture(f.__screenCacheTexture),delete f.__screenCacheTexture);_=void 0===f.__screenCacheTexture;void 0===f.__screenCacheTexture&&(f.__screenCacheTexture=o.createTexture()),o.bindTexture(o.TEXTURE_2D,f.__screenCacheTexture),_&&(o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_ALIGNMENT,4),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),w=new Uint8Array(4*g*y),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,g,y,0,o.RGBA,o.UNSIGNED_BYTE,w)),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,g,y,0)}}}s&&a.add_mesuarement("function redraw >> scene composition"),r.renderMode=XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,r.setRenderViewport(0,0,g,y);let e;for(d in window.m_XeApplication.m_XeDocuments){var v=(e=window.m_XeApplication.m_XeDocuments[d]).getXeGsDevice(),C=i.getXeDatabase().getXeLayout().getPaper();v.getOverallViewport()?b.clearScreen(r,C.getPaperBackColor(),1):b.clearScreen(r,c.getBackground(),1);break}for(u in window.m_XeApplication.m_XeDocuments){var T=(e=window.m_XeApplication.m_XeDocuments[u]).getXeGsDevice();b.draw_to_screen(r,g,y,T.__screenCacheTexture)}b.RenderTrackers(window.getXeApplication().getXeActiveDocument()),s&&a.add_mesuarement("function redraw >> end"),b.getRedrawTiming().proc(),b.getRedrawTiming().emit(),s&&a.log()}}},b.getHandlesInSelection=function(e,t,i,r,n){return y(e,t,i,r,n)},b.addGLDrawCallInfo=function(e,t){b.getXeGLDrawCountInfo().addGLDrawCallInfo(e,t)},b.addGLInstancedDrawCallInfo=function(e,t){b.getXeGLDrawCountInfo().addGLInstancedDrawCallInfo(e,t)},b.addGLMemoryInfo=function(e){b.getXeGLDrawCountInfo().addGLMemoryInfo(e)},b.getXeGLDrawCountInfo=function(){return n},b.getRedrawTiming=function(){return i},b.getXeRenderer=function(){return t},b.setXeRenderer=function(e){t=e},b.getXeRenderTarget=function(){return r},new XeRenderTarget),t=null,i=new XeRedrawTiming,h=new XeSelectionFunc,g={length:0,buffer:null};var n=new function(){var t=this,r=(t.reset=function(){r={},i=null},t.setGLViewport=function(e){e=e.getVpNum();r[e]||(r[e]={chunkdrawcalls:0,gldrawcalls:0,points:0,lines:0,triangles:0,instanced_points:0,instanced_lines:0,instanced_triangles:0,gl_attr_mem_used:0,gl_unif_mem_used:0}),i=r[e]},t.addGLDrawCallInfo=function(e,t){if(i)switch(e){case XeGLDrawObjectGlType.POINTS:i.gldrawcalls++,i.points+=t;break;case XeGLDrawObjectGlType.LINES:i.gldrawcalls++,i.lines+=t/2;break;case XeGLDrawObjectGlType.LINE_STRIP:i.gldrawcalls++,i.lines+=t-1;break;case XeGLDrawObjectGlType.LINE_LOOP:i.gldrawcalls++,i.lines+=t;break;case XeGLDrawObjectGlType.TRIANGLES:i.gldrawcalls++,i.triangles+=t/3;break;case XeGLDrawObjectGlType.TRIANGLE_STRIP:case XeGLDrawObjectGlType.TRIANGLE_FAN:i.gldrawcalls++,i.triangles+=t-2}},t.addGLInstancedDrawCallInfo=function(e,t){if(i)switch(e){case XeGLDrawObjectGlType.POINTS:i.gldrawcalls++,i.instanced_points+=t;break;case XeGLDrawObjectGlType.LINES:i.gldrawcalls++,i.instanced_lines+=t/2;break;case XeGLDrawObjectGlType.LINE_STRIP:i.gldrawcalls++,i.instanced_lines+=t-1;break;case XeGLDrawObjectGlType.LINE_LOOP:i.gldrawcalls++,i.instanced_lines+=t;break;case XeGLDrawObjectGlType.TRIANGLES:i.gldrawcalls++,i.instanced_triangles+=t/3;break;case XeGLDrawObjectGlType.TRIANGLE_STRIP:case XeGLDrawObjectGlType.TRIANGLE_FAN:i.gldrawcalls++,i.instanced_triangles+=t-2}},t.addGLMemoryInfo=function(e){i&&(i.gl_attr_mem_used+=e.gl_attr_mem_used,i.gl_unif_mem_used+=e.gl_unif_mem_used)},t.addGsChunkDrawCallInfo=function(e){i&&i.chunkdrawcalls++},t.emit=function(){var e=document.createEvent("Event");e.initEvent("XeGLDrawCountInfoEvent",!0,!0),e.timestamp=(new Date).getTime(),e.data=t.getData(),document.dispatchEvent(e)},t.getData=function(){var e,t,i={};for(e in r)r.hasOwnProperty(e)&&(t=r[e])&&(i[e]={chunkdrawcalls:t.chunkdrawcalls,gldrawcalls:t.gldrawcalls,points:t.points,lines:t.lines,triangles:t.triangles,instanced_points:t.instanced_points,instanced_lines:t.instanced_lines,instanced_triangles:t.instanced_triangles,gl_attr_mem_used:t.gl_attr_mem_used,gl_unif_mem_used:t.gl_unif_mem_used});return i},{}),i=null};function y(e,t,i,r,n){var o=new Promise((e,t)=>{e([])});if(!b.isValid())return o;y.hasOwnProperty("isFirefox")||(y.isFirefox=-1<navigator.userAgent.toLowerCase().indexOf("firefox"));y.isFirefox;var a=e.getXeGsDevice(),s=Math.floor(a.getPixelWidth()),c=Math.floor(a.getPixelHeight());if(s<1||c<1)return o;a.AdjustViewports(s,c);let l=null,d=null;o=new Promise((e,t)=>{l=e,d=t});return((e,t,i,r,n,o,a,s)=>{if(b.isValid()){var c=b.getXeRenderer(),l=c.getGl();if(!l)return;var d,u=window.GetXeDevicePixelRatio(),p=Math.floor(r.getPixelWidth()*u),m=Math.floor(r.getPixelHeight()*u);p<1||m<1||(y.isFirefox,r.m_bSelectionSceneValid||(!b.m_SelectionFrameBuffer||p==b.m_SelectionFrameBufferWidth&&m==b.m_SelectionFrameBufferHeight||(b.m_SelectionFrameBuffer.dispose(l),b.m_SelectionFrameBuffer=void 0),d={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping,format:THREE.RGBAFormat,depthBuffer:!0,stencilBuffer:!0,generateMipmaps:!1},b.m_SelectionFrameBuffer||(b.m_SelectionFrameBufferWidth=p,b.m_SelectionFrameBufferHeight=m,b.m_SelectionFrameBuffer=new XeWebGLRenderTarget(p,m,d)),c.setRenderTarget(b.m_SelectionFrameBuffer),c.setRenderViewport(0,0,p,m),b.clearScreen(c,0,1),r.ValidateChunks(),c.renderMode=XeWebDrawerEngine.prototype.RENDERER_CP_VIEW,(d=b.renderScene(e,c))&&window._LOG_GLOBAL.SHOW("SHOW_ERRORS","ERROR --\x3e scene rendering error "+d),d||((new Date).getTime(),(c=h.getXeSelectionBuffer()).checkBufferSize(p,m),p=c.getBuffer(),l.readPixels(0,0,c.getWidth(),c.getHeight(),l.RGBA,l.UNSIGNED_BYTE,p)),d?i():r.m_bSelectionSceneValid=!0),m=Math.floor(n*u),c=Math.floor(o*u),l=Math.floor(a*u),p=Math.floor(s*u),((e,t)=>{var i,r,n,o,a;b.isValid()&&(t[0],i=t[1],n=t[4],o=t[5],a=t[6],t=t[7],r=(new Date).getTime(),n=h.getColors(n,o,a,t),o=((e,t)=>{for(var i=[],r=0;r<t.length;r++){var n=e.getXeGsDevice().getXeColorPickingMap().getFullSubentPathByColor(t[r]);n&&i.push(n)}return i})(e,n.Colors),a=((e,t)=>{var i=[];return 0<t.length&&((t=t.slice()).sort(b.ssPredicate.bind(null,e)),i.push(t[0])),i})(e,o),XeWebDrawerEngineImpl.prototype.showReadPixelsDefferedTime&&window.XeLogger.log("ReadPixels deferred : "+((new Date).getTime()-r)+" ms; PBO size = "+g.length),i(a))})(e,[!1,t,i,r,m,c,l,p]))}})(e,l,d,a,t,i,r,n),o}});XeWebDrawerEngineImpl.prototype.showReadPixelsTime=!1,XeWebDrawerEngineImpl.prototype.showReadPixelsDefferedTime=!1,XeWebDrawerEngineImpl.prototype.ssPredicate=function(e,t,i){e=e.getXeDatabase().getXeEntities(),t=e.getByHandle(t),e=e.getByHandle(i);return t&&e?(i=t.getDrawOrder(),e.getDrawOrder()-i):0},XeWebDrawerEngineImpl.prototype.getIntersected=function(e){if(!window.__NoCursor){var t=window.getXeApplication().getDrawingEngine().getImpl();if(t&&(!window._LOG_GLOBAL||!window._LOG_GLOBAL.GET("DIS_CL_SIDE_SEL"))&&window.getXeApplication().IsEntitiesLoaded()){(new Date).getTime();var i=e.getXeDatabase().getPICKBOX(),r=ClientSideCursorTrackerBase.prototype.getCursorPositionData();if(r&&r.cursorPosition){var r=r.cursorPosition,n=[0,0],o=e.getXeGsDevice().getActiveViewport();if(o)return o.PointToSCSFast(n,r[0],r[1],r[2]),n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),t.getHandlesInSelection(e,n[0]-i-1,n[1]+i+1,2*i+1,2*i+1)}}}},XeWebDrawerEngineImpl.prototype.getPreserveDrawingBuffer=function(){return!0},XeWebDrawerEngineImpl.prototype.RenderTrackers=function(e){var t=this;if(t.isValid()){var i=t.getXeRenderer(),r=e.getXeGsDevice();if(t.getRedrawTiming().start_gl_trackers(),!e.getXeInputPointManager().getDrawTrackersOff()){t.m_bClientTrackersGLValid=!0;i=t.renderTrackersGl(e,i);if(i)return window._LOG_GLOBAL.SHOW("SHOW_ERRORS","ERROR --\x3e err_renderTrackersGl rendering error "+i),i}t.getRedrawTiming().end_gl_trackers(),r.m_bClientTrackersValid&&!XeWebDrawerEngine.prototype.Trackers_Debug_Always_Render||(r.m_bClientTrackersValid=!0,t.getRedrawTiming().start_gdi_trackers(),e.getXeInputPointManager().getInputPointManager().drawTrackers(),t.getRedrawTiming().end_gdi_trackers()),r.m_bServerTrackersValid||(r.m_bServerTrackersValid=!0)}},XeWebDrawerEngineImpl.prototype.clearScreen=function(e,t,i){e.setClearColor(t=t||0,i=null==i?1:i),e.clearBuffers(!0,!0,!0)},XeWebDrawerEngineImpl.prototype.renderPaper=function(e,t){if(!this.isValid())return"Drawing Engine Not Valid f:_renderPaper";var i=e.getXeGsDevice().getOverallViewport(),r=(e.getXeGsDevice(),e.getXeDatabase().getXeLayout().getPaper()),e=(r.getScene&&r.getScene()&&r.getScene().children.length||this.getBase().Update_XeLayoutPaper_Handler(e,r),t.getGl());t.getGlState().setDepthTest(!1,e.LEQUAL),t.render(i,r.getScene())},XeWebDrawerEngineImpl.prototype.renderScene=function(t,i){var r=this;if(!r.isValid())return"f::_render >> Drawing Engine Not Valid f:_render";if(!i)return"f::_render >> renderer is null";var n=i.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW;r.getXeGLDrawCountInfo().reset();var o,a,e=(new Date).getTime(),s=t.getXeGsDevice(),c=(s.getPixelWidth(),s.getPixelHeight(),s.getXeGsViewports()),l=s.getOverallViewport();let d=0;for(a in c)c.getByVpnum(a)&&d++;if(l){if(!n&&(o=this.renderPaper(t,i)))return o;let e=0;for(a in c){var u=c.getByVpnum(a);if(u&&l.getHandle()!==u.getHandle()&&(!n||u.getActive())){i.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW&&r.getXeGLDrawCountInfo().setGLViewport(u);var p=(new Date).getTime();if(u.m_vpTotalCount=d,u.m_vpDrawIndex=e,o=this.renderViewport(t,i,u))return o;e++,u.m_DrawTime=(new Date).getTime()-p}}if((!n||l.getActive())&&(i.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW&&r.getXeGLDrawCountInfo().setGLViewport(l),l.m_vpTotalCount=d,l.m_vpDrawIndex=e,o=this.renderViewport(t,i,l)))return o}else for(a in c){var m=c.getByVpnum(a);if(m&&(!n||m.getActive())&&(i.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW&&r.getXeGLDrawCountInfo().setGLViewport(m),m.m_vpTotalCount=d,m.m_vpDrawIndex=0,o=r.renderViewport(t,i,m)))return o}i.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW&&r.getXeGLDrawCountInfo().emit(),window._LOG_GLOBAL.SHOW("DRAWING_ENGINE_RENDER_TIME","DRAWING_ENGINE render in "+((new Date).getTime()-e)+" msec")},XeWebDrawerEngineImpl.prototype.correctByVisibleSceneExtents=function(e,t){var e=e.getXeGsDevice();let i=-1e7,r=1e7;t.getRenderMode()>=XeGsViewport.prototype.RenderModeEnum.kHiddenLine&&(i=-1e7,r=1e7,e)&&(e=e.getChunks().getPlanesZ(!t.getOverall(),t.viewingMatrix()),i=-e.far,r=-e.near),t.getRenderMode()===XeGsViewport.prototype.RenderModeEnum.k2DOptimized&&(i=-10,r=10),t.setNear(i),t.setFar(r)},XeWebDrawerEngineImpl.prototype.__fillSceneArrayRecursionCounter=0,XeWebDrawerEngineImpl.prototype.isViewportChanged=function(e,t){t.m_XeGsViewSnapshots||(t.m_XeGsViewSnapshots={});var i,r="m_"+e.getVpNum();return t.m_XeGsViewSnapshots[r]?((i=!t.m_XeGsViewSnapshots[r].compareTo(e))&&t.m_XeGsViewSnapshots[r].initFrom(e),i):(t.m_XeGsViewSnapshots[r]=new XeGsViewSnapshot,t.m_XeGsViewSnapshots[r].initFrom(e),!0)},XeWebDrawerEngineImpl.prototype.bRenderStencilMask=!1,XeWebDrawerEngineImpl.prototype.renderViewport_bDebugTimings=!1,XeWebDrawerEngineImpl.prototype.drawItemsPredicate=function(e,t){e=e.item.getOrder(),t=t.item.getOrder();return t<e?1:e<t?-1:0},XeWebDrawerEngineImpl.prototype.renderViewport=function(e,i,r){window.xeGlGlobalUniformData.GlobalGlTrackersDrawOrderDenominator=0,window.XeShaders.invalidate();var n,o=XeWebDrawerEngineImpl.prototype.renderViewport_bDebugTimings;if(o&&(n=new XeConsoleDebugLogger),!this.isValid())return"Drawing Engine Not Valid f:_renderViewport";r.calculateLineweightCache();var a=e.getXeGsDevice().getOverallViewport();if(!a||r.getOn()){var s=e.getXeDatabase(),c=e.getXeGsDevice();s.getXeLayers(),c.getPixelWidth(),c.getPixelHeight();let t=i.renderMode;var s=XeWebDrawerEngineImpl.prototype.bRenderStencilMask,l=(i.getGlState(),r.visibleScreenRect());if(l){var d,u,p,m,h,g,y=Math.floor(l.xmin),f=Math.floor(l.ymin),_=Math.floor(l.xmax)-Math.floor(l.xmin),l=Math.floor(l.ymax)-Math.floor(l.ymin),w=new XeDrawScene,v=(r.getOverall(),c.getChunks()),c=(XeWebDrawerEngineImpl.prototype.correctByVisibleSceneExtents(e,r),!1),e=null,C=(r.getStencilScene&&r.getStencilScene()&&(e=r.getStencilScene()),a&&!r.getOverall()&&e&&(u=e,g=(d=a).visibleScreenRect(),p=Math.floor(g.xmin),m=Math.floor(g.ymin),h=Math.floor(g.xmax)-Math.floor(g.xmin),g=Math.floor(g.ymax)-Math.floor(g.ymin),i.setRenderViewportWithPixelRatio(p,m,h,g),c=i.setStencilTest(u,d))&&s&&i.render(a,u),i.setRenderViewportWithPixelRatio(y,f,_,l),o&&n.add_mesuarement("function _renderViewport >> init stencil"),o&&n.add_mesuarement("function _renderViewport >> draw uncached"),i.render(r,w),[]),T=[];if(v)for(var b of v.getChunkIdList()){var X=v.getById(b);if(X)if(X.isImageChunk())for(let e=0;e<X.getItems().length;e++){var S=X.getItems()[e];S&&C.push({item:S,chunk:X,o:e})}else X.isTransparent()&&!X.isTracker()?T.push(X):X.isTracker()||X.drawChunk(i,t,r)}if(C.length){C.sort(XeWebDrawerEngineImpl.prototype.drawItemsPredicate);for(let e=0;e<C.length;e++){var P=C[e],D={order_base:0,xeGsOffsets:[{k:P.chunk.getId(),o:P.o,s:1}],transform_base:new GeNeo.OdGeMatrix3d};P.chunk.isTracker()||P.chunk.drawChunk(i,t,r,void 0,void 0,void 0,D)}}T.forEach(e=>e.drawChunk(i,t,r)),o&&n.add_mesuarement("function _renderViewport >> draw uncached finised"),c&&i.clearStencilTest(),c=!1,e=null,o&&(n.add_mesuarement("function _renderViewport >> unset stecil"),n.log())}}},XeWebDrawerEngineImpl.prototype.renderTrackersGl=function(t,i){var r=window.xeGlGlobalUniformData;r.GlobalGlTrackersDrawOrderDenominator=0;if(!this.isValid())return"f::drawTrackersGl - self is not valid";var e=t.getXeDatabase(),n=t.getXeGsDevice(),o=(n.getChunks(),e.getXeLayers(),n.getXeGsViewports()),a=n.getOverallViewport(),s=(n.getPixelWidth(),n.getPixelHeight(),t.getXeInputPointManager().getInputPointManager().getDrawOrderTrackersArray()),c=clientSideTrackersHolder;i.renderMode;if(c&&s&&o){for(var l in o){var d=o.getByVpnum(l);if(d&&(r.GlobalGlTrackersDrawOrderDenominator=0,window.XeShaders.invalidate(),d.calculateLineweightCache(),!a||d.getOn())){l=d.visibleScreenRect();if(l){var u,p,m,h,g,y,f=Math.floor(l.xmin),_=Math.floor(l.ymin),w=Math.floor(l.xmax-l.xmin),l=Math.floor(l.ymax-l.ymin),v=!1,C=null;d.getStencilScene&&d.getStencilScene()&&(C=d.getStencilScene()),a&&!d.getOverall()&&C&&(p=C,y=(u=a).visibleScreenRect(),m=Math.floor(y.xmin),h=Math.floor(y.ymin),g=Math.floor(y.xmax)-Math.floor(y.xmin),y=Math.floor(y.ymax)-Math.floor(y.ymin),i.setRenderViewportWithPixelRatio(m,h,g,y),v=i.setStencilTest(p,u)),e.getLWDISPLAY()&&XeWebDrawerEngine.prototype.RENDERER_USER_VIEW;if(i.setRenderViewportWithPixelRatio(f,_,w,l),d.getActive())for(var T=n.getChunkCache().trackers.array,b=0;b<T.length;b++){var X,S,P=T[b].chunk;P.isDrawAllowed(d)&&(X=c[P.getTrackerName()?P.getTrackerName():""],!(S=P.getLayerObject())||S.getOff()||S.getFrozen()||P.getSelectionGeom()||(X&&X.checkChunk&&!X.checkChunk(P)?0:P.drawChunk(i,XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,d),r.GlobalGlTrackersDrawOrderDenominator++))}for(let e=0;e<s.length;e++){var D=c[s[e].name];D&&D.isActiveOnPan(t)&&(D.isDrawnOnlyInActiveViewport()&&!d.getActive()||(D.drawTrackerGl(d,i),r.GlobalGlTrackersDrawOrderDenominator++))}var x,O=t.getXeInputPointManager().GetDragInfo();for(x in O.waitingPreviews)O.waitingPreviews[x]&&(O.waitingPreviews[x].draw_gl(i,d),r.GlobalGlTrackersDrawOrderDenominator++);O.actualPreview&&(O.actualPreview.draw_gl(i,d),r.GlobalGlTrackersDrawOrderDenominator++),v&&i.clearStencilTest(),v=!1,C=null}}}r.GlobalGlTrackersDrawOrderDenominator=0}},XeWebDrawerEngineImpl.prototype.renderXeDbBackground=function(e,t){if(this.isValid()&&t.m_RenderMode!==XeGsViewport.prototype.RenderModeEnum.k2DOptimized){var i=t.getBackground();if(i){var r=i.getType();if(r){t=t.visibleScreenRect();if(t){var n,o,a,s,c,l;Math.floor(t.xmin),Math.floor(t.ymin),Math.floor(t.xmax-t.xmin),Math.floor(t.ymax-t.ymin);if(1===r){var t=(new THREE.Color).setStyle(i.m_Color),d=0;d|=255*t.r<<16&16711680}else{if(2===r)return t=-i.m_Horizon/180*3.141592,(d=new GeNeo.OdGeMatrix3d).setToRotation(t,GeNeo.OdGeVector3d.kZAxis,GeNeo.OdGePoint3d.kOrigin),t=i.m_bIsThreeColorMode?(a=(new THREE.Color).setStyle(i.m_ColorBottom),t=(new THREE.Color).setStyle(i.m_ColorMiddle),s=(new THREE.Color).setStyle(i.m_ColorTop),c=XeWebGlRenderer.prototype.getIndexArrayType([0,2,1,0,3,2,1,5,4,1,2,5,6,8,7,6,9,8,10,12,11,10,13,12]),l=[-1.5,-1,0,-1.5,0,0,1.5,0,0,1.5,-1,0,-1.5,1,0,1.5,1,0,-1.5,1,0,-1.5,1.5,0,1.5,1.5,0,1.5,1,0,-1.5,-1,0,-1.5,-1.5,0,1.5,-1.5,0,1.5,-1,0],l=new Float32Array(l),new Float32Array([a.r,a.g,a.b,t.r,t.g,t.b,t.r,t.g,t.b,a.r,a.g,a.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,a.r,a.g,a.b,a.r,a.g,a.b,a.r,a.g,a.b,a.r,a.g,a.b])):(a=(new THREE.Color).setStyle(i.m_ColorBottom),s=(new THREE.Color).setStyle(i.m_ColorTop),c=XeWebGlRenderer.prototype.getIndexArrayType([0,2,1,0,3,2,4,6,5,4,7,6,8,10,9,8,11,10]),l=[-1.5,-1,0,-1.5,1,0,1.5,1,0,1.5,-1,0,-1.5,1,0,-1.5,1.5,0,1.5,1.5,0,1.5,1,0,-1.5,-1,0,-1.5,-1.5,0,1.5,-1.5,0,1.5,-1,0],l=new Float32Array(l),new Float32Array([a.r,a.g,a.b,s.r,s.g,s.b,s.r,s.g,s.b,a.r,a.g,a.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,a.r,a.g,a.b,a.r,a.g,a.b,a.r,a.g,a.b,a.r,a.g,a.b])),(s=new XeGLDrawObjectGeometry).addAttribute("index",new XeGeometryAttribute(c,!1)),s.addAttribute("position",new XeGeometryAttribute(l,!0)),s.addAttribute("vertex_color",new XeGeometryAttribute(t,!0)),(a=new XeGLDrawObjectMaterial({uniforms:{rotationMatrix:d},shader:window.XeShaders.container.XeDbBackgroundOptimized})).side=THREE.DoubleSide,a.transparent=!1,(n=new XeGLDrawObject(s,a,XeGLDrawObjectGlType.TRIANGLES)).visible=!0,(o=new XeDrawScene).children=[n],e.render(null,o),o.children=[],n.geometry.dispose(),n.material.dispose(),n.parent=void 0,!(n=void 0);if(3===r)return t=i.m_textureLink,!(!(d=XeTexture.prototype.downloadTexture(t))||!d.uploaded||(r=i.m_useTiling,t=i.m_fitToScreen,i.m_xOffset,i.m_yOffset,i.m_xScale,i.m_yScale,d.texture.image.width,d.texture.image.height,c=XeWebGlRenderer.prototype.getIndexArrayType([0,2,1,0,3,2]),l=new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0]),i=new Float32Array([0,0,0,1,1,1,0,0,1,0]),t?0:r?(0,0):0,s.addAttribute("index",new XeGeometryAttribute(c,!1)),s.addAttribute("position",new XeGeometryAttribute(l,!0)),s.addAttribute("uv",new XeGeometryAttribute(i,!0)),(a=new XeGLDrawObjectMaterial({uniforms:{uTexture:d.texture},shader:window.XeShaders.container.XeDbBackgroundImageOptimized})).side=THREE.DoubleSide,a.transparent=!0,(n=new XeGLDrawObject(s,a,XeGLDrawObjectGlType.TRIANGLES)).visible=!0,(o=new XeDrawScene).children=[n],e.render(null,o),o.children=[],n.geometry.dispose(),n.material.dispose(),void(n.parent=void 0)))}}}}}return!1},XeWebDrawerEngineImpl.prototype.draw_to_screen=function(e,t,i,r){var n=e.getGl(),o=e.getGlState(),a=(o.setDoubleSided(!0),o.setColorWrite(!0),o.setDepthTest(!1,n.LEQUAL),o.setBlending(!1),o.setLineWidth(1),window.XeShaders.container.SimpleFramebufferShader),e=(e.setProgram(a),a.getUniformLocations(n)),s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=(n.uniformMatrix4fv(e.projectionMatrix,!1,s),n.uniformMatrix4fv(e.viewingMatrix,!1,s),n.bindTexture(n.TEXTURE_2D,r),n.activeTexture(n.TEXTURE0),n.uniform1i(e.tTexture,0),n.uniform1f(e.tWidth,t),n.uniform1f(e.tHeight,i),n.uniform1i(e.tEnableAA,0),new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])),r=new Float32Array([0,0,0,1,1,1,1,0]),t=new XeGLDrawObjectGeometry,i=(t.addAttribute("index",new XeGeometryAttribute(XeWebGlRenderer.prototype.getIndexArrayType([0,2,1,0,3,2]),!1)),t.addAttribute("position",new XeGeometryAttribute(s,!1)),t.addAttribute("uv",new XeGeometryAttribute(r,!1)),t.attributes),e=(window.XeShaders.initAttribute(n,n.ELEMENT_ARRAY_BUFFER,i.index),window.XeShaders.initAttribute(n,n.ARRAY_BUFFER,i.position),window.XeShaders.initAttribute(n,n.ARRAY_BUFFER,i.uv),a.getAttributeLocations(n));n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.index.buffer),n.bindBuffer(n.ARRAY_BUFFER,i.position.buffer),o.enableAttribute(e.position),n.vertexAttribPointer(e.position,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,i.uv.buffer),o.enableAttribute(e.uv),n.vertexAttribPointer(e.uv,2,n.FLOAT,!1,0,0),n.drawElements(n.TRIANGLES,i.index.array.length,XeWebGlRenderer.prototype.getDrawElementsType(n),0),o.setBlending(!1)};let Mouse3dConnexionProxy=function(e,t){let l=this;var i;l.m_XeDocument=e;l.getXeDocument=function(){return l.m_XeDocument},l.getInputPointManager=function(){return e.getXeInputPointManager().getInputPointManager()},l.getViewport=function(){return l.getXeDocument().getXeGsDevice().getZoomPanViewport()},l.init3DMouse=function(e){return(i=e)?new Promise((e,t)=>{l._3Dconnexion=new _3Dconnexion(l),l.onConnect=function(){l._3Dconnexion.session?(l._3Dconnexion.create3dmouse(i,l.get3dMouseSettingsName()),$(window).on("focus",l._3Dconnexion.focus.bind(l._3Dconnexion)),$(window).on("blur",l._3Dconnexion.blur.bind(l._3Dconnexion))):(window.XeLogger.error("'Mouse3dConnexion onConnect failed : _3Dconnexion.session = undefined'"),t(l))},l.onDisconnect=function(e){t(l)},l.on3dmouseCreated=function(){window.focus&&window.focus(),i&&i.focus&&i.focus(),l.update3dcontroller(),l._3DconnexionVersion=l._3Dconnexion.version.split(".").map(e=>parseInt(e)),e(l)},l._3Dconnexion.connect()||t(l)}):(window.XeLogger.error("Mouse3dConnexion constructor failed : canvas = undefined"),!1)},l.delete3dmouse=function(){try{l._3Dconnexion&&(l._3Dconnexion.delete3dmouse(),$(window).off("focus"),$(window).off("blur"))}catch(e){return!1}return!0},l.__readyToUse=!1,l.__justUpdated=0,l._createUpdateObject=function(){return{focus:!0,"view.rotatable":!1,"view.affine":l.getViewMatrix(),"view.extents":l.getViewExtents(),frame:{timingSource:1}}},l.update3dcontroller=function(){return!!l._3Dconnexion&&(l._3Dconnexion.update3dcontroller(l._createUpdateObject()),l.__readyToUse=!0,l.__justUpdated=10,!0)},l.onStartMotion=function(){l.isInMotion=!0;var e=l.getXeDocument(),e=(e.getXeInputPointManager().getInputPointManager().Mouse3dConnexionHandler_onStartMotion(e),e.getXeGsDevice());e&&(e.invalidateScene(),e.setContinuousAction(!0))},l.onStopMotion=function(){l.isInMotion=!1;var e=l.getXeDocument(),t=e.getXeInputPointManager(),e=(t.getInputPointManager().Mouse3dConnexionHandler_onStopMotion(e),e.getXeGsDevice());e&&(e.invalidateScene(),e.invalidateSelectionScene(),t.InvalidateApertureSelection(),e.setContinuousAction(!1))},l.getCoordinateSystem=function(){return[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]},l.getConstructionPlane=function(){return[0,1,0,0]},l.getFov=function(){var e=l.getViewport();return e?e.getFov():0},l.getFrontView=function(){return[1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]},l.getLookAt=function(){return null},l.getModelExtents=function(){var r=l.getViewport();if(r){var n=r.getViewExtentsWCS(),o=new GeNeo.OdGePoint3d(n[0][0],n[0][1],n[0][2]);let t=new GeNeo.OdGePoint3d;for(let e=0;e<4;e++)(n[e][0]>t.x||0===e)&&(t.x=n[e][0]),(n[e][1]>t.y||0===e)&&(t.y=n[e][1]),(n[e][2]>t.z||0===e)&&(t.z=n[e][2]);var a=new GeNeo.OdGePoint3d(o.x+(t.x-o.x)/2,o.y+(t.y-o.y)/2,o.z+(t.z-o.z)/2),s=new GeNeo.OdGeVector3d(a.x,a.y,a.z);let e=new GeNeo.OdGeMatrix3d;var c=r.getViewDir(),r=r.getUpVector(),c=new GeNeo.OdGeVector3d(c[0],c[1],c[2]).normalize();let i=(r=new GeNeo.OdGeVector3d(r[0],r[1],r[2]).normalize()).crossProduct(c);i=i.normalize(),e.setCoordSystem(a,i,r,c),e=e.invert();a=XeGsViewport.transformExtents(o,t,e),o=a.minPoint(),c=(t=a.maxPoint(),[s.dotProduct(i),s.dotProduct(r)]);return o.x=1.02*(o.x+c[0]),o.y=1.02*(o.y+c[1]),o.z=0,t.x=1.02*(t.x+c[0]),t.y=1.02*(t.y+c[1]),t.z=0,[o.x,o.y,o.z,t.x,t.y,t.z]}return[0,0,0,1,1,1]},l.getPerspective=function(){var e=l.getViewport();return!!e&&e.getPerspective()},l.getPivotPosition=function(){var e=l.getViewport();return e?e.getPosition():[0,0,0]},l.getPointerPosition=function(){return[0,0,0]},l.getViewExtents=function(){var e,t=l.getViewport();return t?[-(e=t.getFieldWidth())/2,-(t=t.getFieldHeight())/2,-1e7,e/2,t/2,-1e7]:[]},l.getViewFrustum=function(){return[0,-0,0,-0,0,0]},l.getViewMatrix=function(){var e=l.getViewport();let t=null;return l._3DconnexionVersion&&0<=l._3DconnexionVersion[0]&&6<=l._3DconnexionVersion[1]?((t=e.viewingMatrix().toGLArray(!0).slice())[12]=-t[12],t[13]=-t[13]):((t=e.viewingMatrix().toArray().slice())[3]=-t[3],t[7]=-t[7]),t},l.getViewRotatable=function(){return!1},l.look={origin:new THREE.Vector3,direction:new THREE.Vector3,aperture:.01,selection:!1},l.setLookFrom=function(e){l.putLookFrom(e)},l.putLookFrom=function(e){l.look.origin.set(e[0],e[1],e[2])},l.setLookDirection=function(e){l.putLookDirection(e)},l.putLookDirection=function(e){l.look.direction.set(e[0],e[1],e[2])},l.setLookAperture=function(e){l.putLookAperture(e)},l.putLookAperture=function(e){l.look.aperture=e},l.setSelectionOnly=function(e){l.putSelectionOnly(e)},l.putSelectionOnly=function(e){l.look.selection=e},l.setViewExtents=function(e){l.putViewExtents(e)},l.putViewExtents=function(e){var t;l.__readyToUse&&(0<l.__justUpdated?l.__justUpdated--:(t=l.getInputPointManager())&&t.isValid()&&t.Mouse3dConnexionHandler_Data(e,void 0))},l.setViewMatrix=function(e){l.putViewMatrix._bUseNewSetCalls=!0,l.putViewMatrix(e),l.putViewMatrix._bUseNewSetCalls=!1},l.putViewMatrix=function(e){var t,i,r,n,o;l.__readyToUse&&(0<l.__justUpdated?l.__justUpdated--:(o=l.putViewMatrix._bUseNewSetCalls,t=l.putViewMatrix._cameraMatrix,i=l.putViewMatrix._position,r=l.putViewMatrix._quaternion,n=l.putViewMatrix._scale,o?t.fromArray(e):(t.fromArray(e),t.transpose()),t.decompose(i,r,n),(o=l.getInputPointManager())&&o.isValid()&&o.Mouse3dConnexionHandler_Data(null,i.toArray())))},l.putViewMatrix._bUseNewSetCalls=!1,l.putViewMatrix._cameraMatrix=new THREE.Matrix4,l.putViewMatrix._position=new THREE.Vector3(0,0,0),l.putViewMatrix._quaternion=new THREE.Quaternion,l.putViewMatrix._scale=new THREE.Vector3(0,0,0),l.setFov=function(e){l.putFov(e)},l.putFov=function(e){},l.setCommand=function(e){l.putCommand(e)},l.putCommand=function(e){},l.setTransaction=function(e){}};function _CFX_GDI(e){return e.getFxGDIDevice()}Mouse3dConnexionProxy.prototype.get3dMouseSettingsName=function(){return"Kudo"},window.XeDrawHelper={setGDIClipping:function(e,t,i){var r=t.getXeGsDevice(),n=r.getOverallViewport(),r=(r.getPixelWidth(),r.getPixelHeight());if(n){if(t.getOverall())return!0;var o=t.getViewportExternalRegionInOverallWCS();if(!o)return!1;if(2<o.length){d=e.globalAlpha,e.globalAlpha=0,e.beginPath();var a=[0,0];n.PointToSCSFast(a,o[0][0],o[0][1],o[0][2]),e.moveTo(Math.floor(a[0]),a[1]);for(var s=1;s<o.length;s++)n.PointToSCSFast(a,o[s][0],o[s][1],o[s][2]),e.lineTo(Math.floor(a[0]),a[1]);e.stroke(),e.fill(),e.clip(),e.globalAlpha=d}}else{t=t.visibleScreenRect();if(!t)return!1;var c=Math.floor(t.xmin)+1,r=r-Math.floor(t.ymin)-Math.floor(t.ymax-t.ymin)+1,l=Math.floor(t.xmax-t.xmin)-2,t=Math.floor(t.ymax-t.ymin)-2,d=e.globalAlpha;e.globalAlpha=0,e.beginPath(),e.rect(c,r,l,t),e.stroke(),e.clip(),e.globalAlpha=d}return!0}};var CFxGDIContext=function(e){var o=this,a=!1;o.m_XeDocument=e,o.canvas=void 0,o.ctx=void 0,o.painter=void 0,o.drawArray=[],o.type={point:0,polyline:1,polygon:2},o.fillPolygon=!1,o.isValid=function(){return a},o.getXeDocument=function(){return o.m_XeDocument},document.addEventListener("Update_XeGsDevice",function(e){var t,i,r,n;a&&(t=o.canvas,e=e.m_Item)&&e==o.getXeDocument().getXeGsDevice()&&(i=t.width,r=t.height,n=e.getPixelWidth(),e=e.getPixelHeight(),i!==n||r!==e)&&(t.width=n,t.height=e)}),o.initGDIContext=function(e){if(o.m_XeDocument=e,!a)try{var t=e.getServerTrackerWidget(),i=document.getElementById(t),r=(o.canvas=document.createElement("canvas"),window.XeUtils.ConnectInputEvents(o.canvas),i.appendChild(o.canvas),e.getXeGsDevice());o.canvas.width=r.getPixelWidth(),o.canvas.height=r.getPixelHeight(),o.ctx=o.canvas.getContext("2d"),a=!0}catch(e){return window.XeLogger.error("CFxGDIContext : init called with errors"),a=!1}return!0},o.ClearCache=function(){if(a){try{var e=o.m_XeDocument.getServerTrackerWidget(),t=document.getElementById(e);try{t&&"function"==typeof t.removeChild&&t.removeChild(o.canvas)}catch(e){}o.canvas=void 0,o.drawArray=[]}catch(e){}a=!1}return!0},o.drawArray=[],o.type={point:0,polyline:1,polygon:2}},CustomClipBoard=(CFxGDIContext.prototype=Object.create(CFxGDIContext.prototype),CFxGDIContext.prototype.constructor=CFxGDIContext,CFxGDIContext.prototype.clearViewport=function(){this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)},CFxGDIContext.prototype.clear=function(){this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight),this.drawArray=[]},CFxGDIContext.prototype.setViewport=function(e){e.save();var t=this.getXeDocument().getXeGsDevice().getActiveViewport();return window.XeDrawHelper.setGDIClipping(e,t)},CFxGDIContext.prototype.unsetViewport=function(e){e.restore()},CFxGDIContext.prototype.redraw=function(){var e;if(this.ctx&&this.canvas&&0!==this.drawArray.length){if(!this.setViewport(this.ctx))return this.unsetViewport(this.ctx),!1;for(e=0;e<this.drawArray.length;e++){var t=this.drawArray[e];switch(t.type){case this.type.point:this.drawPoint(t.vertex_arr,t.ctx);break;case this.type.polyline:this.drawPolyline(t.vertex_arr,t.ctx);break;case this.type.polygon:this.drawPolygon(t.vertex_arr,t.ctx)}}return this.unsetViewport(this.ctx),!0}},CFxGDIContext.prototype.setPainter=function(e){this.painter=e},CFxGDIContext.prototype.CFxDrawDecoration_ENUM={kNone:0,kHidden:1,kHighlight:2,kNegativeHighlight:4,kTrackHighlight:8,kDrawAttDefs:16,kDisableDepth:32,kRenderMode2D:64,kEnableDrawOrder:128,kXeDangling:256,kXeDragHighlight:512},CFxGDIContext.prototype.applyPainter=function(e,t){var i,r,n;e&&t&&(t.lineCap=e.lineCap,t.lineJoin="round",t.lineWidthMM=e.lineWidthMM,t.CFxDrawDecoration=e.CFxDrawDecoration,i=1,n=e.lineWidthMM,r=this.getXeDocument().getXeGsDevice().getActiveViewport(),n<0&&(n=0),!window.XeLineweightUtils.useModelSpaceLwAlways()&&this.getXeDocument().getXeGsDevice().getOverallViewport()?((i=window.XeLineweightUtils.GetLineWeightInPixels(r,n))<1&&(i=1),1<(i=Math.round(i))&&1==(1&i)&&i++):i=window.XeLineweightUtils.getStndLineWeightPxSize(n,!0),r=e.CFxDrawDecoration,n=this.getAdditionalLwPx(r),t.lineWidth=i+n,t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle)},CFxGDIContext.prototype.getAdditionalLwPx=function(e){var t=0;switch(e){case this.CFxDrawDecoration_ENUM.kNone:case this.CFxDrawDecoration_ENUM.kHidden:t=0;break;case this.CFxDrawDecoration_ENUM.kHighlight:case this.CFxDrawDecoration_ENUM.kNegativeHighlight:case this.CFxDrawDecoration_ENUM.kTrackHighlight:case this.CFxDrawDecoration_ENUM.kDrawAttDefs:case this.CFxDrawDecoration_ENUM.kDisableDepth:t=2;break;case this.CFxDrawDecoration_ENUM.kRenderMode2D:case this.CFxDrawDecoration_ENUM.kEnableDrawOrder:t=0;break;case this.CFxDrawDecoration_ENUM.kXeDangling:case this.CFxDrawDecoration_ENUM.kXeDragHighlight:t=2;break;default:t=0}return t},CFxGDIContext.prototype.addToDrawPointArrays=function(e){var t;this.painter&&(this.applyPainter(this.painter,t={}),this.drawArray.push({ctx:t,vertex_arr:e,type:this.type.point}))},CFxGDIContext.prototype.drawPoint=function(e,t){if(this.isValid()&&!(e&&e.length<1)){var i=this.painter;if(!e){if(0===this.drawArray.length)return;for(var r,n=this.drawArray.length-1;0<=n&&(r=this.drawArray[n]).type!==this.type.point;n--);if(r.type!==this.type.point)return;if(e=r.vertex_arr,i=r.ctx,!e||!i)return}t&&(i=t);var o,t=this.ctx;t&&i&&(o=this.getXeDocument().getXeGsDevice().getActiveViewport(),t.save(),this.applyPainter(i,t),o.PointToSCSFast(i=[0,0],e[0][0],e[0][1],e[0][2]),o=0<t.lineWidth?t.lineWidth:1,e=(t.lineWidth=1)<o/2-1?o/2-1:1,t.beginPath(),t.arc(i[0],i[1],e,0,2*Math.PI),t.fill(),t.stroke(),t.lineWidth=o,t.restore())}},CFxGDIContext.prototype.addToDrawPolylineArrays=function(e){var t;this.painter&&(this.applyPainter(this.painter,t={}),this.drawArray.push({ctx:t,vertex_arr:e,type:this.type.polyline}))},CFxGDIContext.prototype.drawPolyline=function(e,t){if(this.isValid()&&!(e&&e.length<1)){var i=this.painter;if(!e){if(0===this.drawArray.length)return;for(var r,n=this.drawArray.length-1;0<=n&&(r=this.drawArray[n]).type!==this.type.polyline;n--);if(r.type!==this.type.polyline)return;if(e=r.vertex_arr,i=r.ctx,!e||!i)return}this._drawVertexArray(e,i=t?t:i,!1)}},CFxGDIContext.prototype.addToDrawPolygonArrays=function(e){var t;this.painter&&(this.applyPainter(this.painter,t={}),this.drawArray.push({ctx:t,vertex_arr:e,type:this.type.polygon}))},CFxGDIContext.prototype.drawPolygon=function(e,t){if(this.isValid()&&!(e&&e.length<1)){var i=this.painter;if(!e){if(0===this.drawArray.length)return;for(var r,n=this.drawArray.length-1;0<=n&&(r=this.drawArray[n]).type!==this.type.polygon;n--);if(r.type!==this.type.polygon)return;if(e=r.vertex_arr,i=r.ctx,!e||!i)return}this._drawVertexArray(e,i=t?t:i,!0)}},CFxGDIContext.prototype._drawVertexArray=function(e,t,i){var r=this.ctx,n=0;if(r&&t&&e){var o=this.getXeDocument().getXeGsDevice().getActiveViewport(),a=(r.save(),this.applyPainter(t,r),[0,0]),t=[0,0],s=[0,0],c=!1;if(i&&(r.lineWidth=1,3===e.length)&&(r.beginPath(),o.PointToSCSFast(a,e[0][0],e[0][1],e[0][2]),o.PointToSCSFast(t,e[1][0],e[1][1],e[1][2]),o.PointToSCSFast(s,e[2][0],e[2][1],e[2][2]),r.moveTo(a[0],a[1]),r.lineTo(t[0],t[1]),r.lineTo(s[0],s[1]),r.lineTo(a[0],a[1]),r.fill(),r.stroke(),c=!0),!c){for(r.beginPath(),o.PointToSCSFast(a,e[0][0],e[0][1],e[0][2]),r.moveTo(a[0],a[1]),n=1;n<e.length;n++)o.PointToSCSFast(a,e[n][0],e[n][1],e[n][2]),r.lineTo(a[0],a[1]);i&&r.fill(),r.stroke()}r.restore()}},function(){var i={"text/plain":""};this.setData=function(e,t){i[e]=t},this.getData=function(e,t){return i[e]}}),customClipBoard=new CustomClipBoard,NoteEditorHandler=function(){var n,o,r,a=this,s=!1,c=!1,l="",d="this_is_crossbrowser_trick",u=(navigator.userAgent.toLowerCase().indexOf("firefox"),-1<navigator.platform.toLowerCase().indexOf("mac"));a.setDebugCopyPasteWindow=function(e){n&&(e?(n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex="100"):(n.style.position="absolute",n.style.top="-99999px",n.style.left="-99999px",n.style.zIndex="0"),n.style.userSelect="none")},a.pasteEventFunc=function(){},a.getSelectedText=function(){return l},a.setSelectedText=function(e){l=e},a.setNoteEditorActive=function(e,t){var i,r;c=e,o||(r=document.createElement("div"),(i=document.createElement("textarea")).id="_hidden_note_editor_textarea",i.maxLength="20000",i.cols="200",i.rows="100",document.addEventListener("copy",function(e){a.isNoteEditorActive()&&(stopBubbles(e),e.clipboardData.clearData("text/plain"),e.clipboardData.setData("text/plain",l),i.value="input.oncopy --\x3e "+e.clipboardData.getData("text/plain"),i.blur())}),i.addEventListener("copy",function(e){a.isNoteEditorActive()&&(stopBubbles(e),e.clipboardData.clearData("text/plain"),e.clipboardData.setData("text/plain",l),i.value="input.oncopy --\x3e "+e.clipboardData.getData("text/plain"),i.blur())}),i.addEventListener("cut",function(e){a.isNoteEditorActive()&&(stopBubbles(e),e.clipboardData.clearData("text/plain"),e.clipboardData.setData("text/plain",l),i.value="input.oncut --\x3e "+e.clipboardData.getData("text/plain"),i.blur())}),i.addEventListener("paste",function(e){a.isNoteEditorActive()&&(stopBubbles(e),i.value="input.onpaste --\x3e "+e.clipboardData.getData("text/plain"),customClipBoard.setData("text/plain",e.clipboardData.getData("text/plain")),i.blur(),a.pasteEventFunc())}),r.appendChild(i),o=i,n=r,a.setDebugCopyPasteWindow(s),document.body.appendChild(r)),o.value=d,e&&(r=document.getElementById(t))&&r.focus()},a.isNoteEditorActive=function(){return c},a.keydownHandler=function(e){if(a.isNoteEditorActive()&&o){var t=!u&&e.ctrlKey||e.metaKey,i=u?250:100;if(t){if(67===e.which)return void o.blur();o.value=l,o.focus(),o.select(),r&&clearTimeout(r),r=setTimeout(function(){o.blur()},i)}u&&e.ctrlKey&&(67!==e.which&&99!==e.which||(o.value="mac, ctrl+c --\x3e "+l,customClipBoard.setData("text/plain",l)),88!==e.which&&120!==e.which||(o.value="mac, ctrl+x --\x3e "+l,customClipBoard.setData("text/plain",l)),86!==e.which&&118!==e.which||(o.value="mac, ctrl+v --\x3e "+l,a.pasteEventFunc()))}},a.keypressedHandler=function(e){o.blur()},document.addEventListener("keydown",function(e){a.keydownHandler(e)}),document.addEventListener("keypressed",function(e){a.keypressedHandler(e)})},noteEditorHandler=new NoteEditorHandler,NoteIMEHandler=function(){function r(){var e;null==n?((e=document.createElement("div")).id="hidden_div_element",e.setAttribute("contentEditable",!0),e.style.position="absolute",e.style.outline="0px",e.style.top="-500px",e.style.left="-500px",e.style.border="none",e.style.color="transparent",e.style.textShadow="0 0 0 black",e.style.textAlign="center",e.style.lineHeight="73%",e.style.zIndex="0",e.style.caretColor="transparent",e.focus_base=e.focus.bind(e),e.focus=function(){e.focus_base()},document.body.appendChild(e),e.addEventListener("keydown",function(e){t.showDivElement(),l=!1,e.isComposing?e.stopPropagation():i=!1}),e.addEventListener("keypress",function(e){l=!0,e.isComposing||(t.hideDivElement(),i=!1,n.innerHTML="")}),e.addEventListener("keyup",function(e){0==i?e.isComposing||(t.hideDivElement(),i=!1,n.innerHTML=""):1!=i||1!=c||e.isComposing||(t.hideDivElement(),c=i=!1,n.innerHTML="")}),e.addEventListener("compositionupdate",function(e){m=!0}),e.addEventListener("compositionstart",function(e){m=!1,t.showDivElement(),i=!0}),e.addEventListener("compositionend",function(e){c=!0,t.hideDivElement(),i=!1,n.innerHTML="",t.sendInput(e),l=m=!1}),e.addEventListener("input",function(e){e.isComposing||0!=l||(t.hideDivElement(),i=!1,n.innerHTML="",l=!1)}),e.addEventListener("blur",function(e){null!=e.relatedTarget&&!1===u&&"xeMainFrame"===e.relatedTarget.id&&(n.focus(),e.preventDefault()),!0===p&&(t.hideDivElement(),n.innerHTML="",p=!1)}),n=e,t.hideDivElement()):n&&!document.body.contains(n)&&document.body.appendChild(n)}var n,o,a,s,t=this,i=!1,c=!1,l=!1,d=!1,u=(navigator.platform.toLowerCase().indexOf("mac"),!1),p=!1,m=!1;t.setFocus=function(e){null==n||e&&e.target&&e.target.dataset&&"heightComboBox"===e.target.dataset.objectName||n.focus()},t.sendInput=function(e){null!==e.data&&(customClipBoard.setData("text/plain",e.data.toString()),noteEditorHandler.pasteEventFunc(e.data.toString())),n.innerHTML=""},t.isKeyPress=function(e){return null!=e&&!e.isComposing||l},t.isEnabled=function(){return null!=d&&d},t.isIMEComposing=function(){return m},t.updateIME=function(){!0===d&&r()},t.startIME=function(){null==n&&this.updateIME();var e=null,e=(i=!1)===window.getXeActiveDocument().getModelLayoutActive()?window.getXeActiveDocument().getXeProfile().getGraphicsWinModelBackgrndColor():window.getXeActiveDocument().getXeProfile().getGraphicsWinLayoutBackgrndColor();null!=n&&(n.style.color=window.XeUtils.intRGBToHex(e))},t.enableIME=function(){d=!0},t.showDivElement=function(){n&&(n.style.top=o,n.style.left=a)},t.hideDivElement=function(){n&&(n.style.top="-500px",n.style.left="-500px")},t.disableIME=function(){!0===d&&(t.hideDivElement(),n)&&(n.remove(),n=null,i=!1)},t.factor=function(){return n&&n.innerText.length&&n.clientWidth,0},t.drawCursor=function(){return!0},t.setTopLeft=function(e,t,i){e=Math.floor(e)+"px",t=Math.floor(t)+"px",i=Math.min(72,Math.floor(i))+"px",d&&(r(),o=e,a=t,s=i,n)&&(n.style.fontSize=s,n.style.minHeight=s)},t.getTextOffset=function(){return void 0!==n?n.offsetWidth:0}},OdCmEntityColor=(document.noteImeHandler=new NoteIMEHandler,function(){this.m_RGBM=0}),OdCmTransparency=(OdCmEntityColor.prototype.Color={kRed:0,kGreen:1,kBlue:2},OdCmEntityColor.prototype.ColorMethod={kByLayer:192,kByBlock:193,kByColor:194,kByACI:195,kByPen:196,kForeground:197,kByDgnIndex:199,kNone:200},OdCmEntityColor.prototype.ACIcolorMethod={kACIbyBlock:0,kACIforeground:7,kACIbyLayer:256,kACIclear:0,kACIRed:1,kACIYellow:2,kACIGreen:3,kACICyan:4,kACIBlue:5,kACIMagenta:6,kACIWhite:7,kACIstandard:7,kACImaximum:255,kACInone:257,kACIminimum:-255},OdCmEntityColor.prototype.mLUT=[[0,0,0],[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,255,255],[128,128,128],[192,192,192],[255,0,0],[255,127,127],[204,0,0],[204,102,102],[153,0,0],[153,76,76],[127,0,0],[127,63,63],[76,0,0],[76,38,38],[255,63,0],[255,159,127],[204,51,0],[204,127,102],[153,38,0],[153,95,76],[127,31,0],[127,79,63],[76,19,0],[76,47,38],[255,127,0],[255,191,127],[204,102,0],[204,153,102],[153,76,0],[153,114,76],[127,63,0],[127,95,63],[76,38,0],[76,57,38],[255,191,0],[255,223,127],[204,153,0],[204,178,102],[153,114,0],[153,133,76],[127,95,0],[127,111,63],[76,57,0],[76,66,38],[255,255,0],[255,255,127],[204,204,0],[204,204,102],[153,153,0],[153,153,76],[127,127,0],[127,127,63],[76,76,0],[76,76,38],[191,255,0],[223,255,127],[153,204,0],[178,204,102],[114,153,0],[133,153,76],[95,127,0],[111,127,63],[57,76,0],[66,76,38],[127,255,0],[191,255,127],[102,204,0],[153,204,102],[76,153,0],[114,153,76],[63,127,0],[95,127,63],[38,76,0],[57,76,38],[63,255,0],[159,255,127],[51,204,0],[127,204,102],[38,153,0],[95,153,76],[31,127,0],[79,127,63],[19,76,0],[47,76,38],[0,255,0],[127,255,127],[0,204,0],[102,204,102],[0,153,0],[76,153,76],[0,127,0],[63,127,63],[0,76,0],[38,76,38],[0,255,63],[127,255,159],[0,204,51],[102,204,127],[0,153,38],[76,153,95],[0,127,31],[63,127,79],[0,76,19],[38,76,47],[0,255,127],[127,255,191],[0,204,102],[102,204,153],[0,153,76],[76,153,114],[0,127,63],[63,127,95],[0,76,38],[38,76,57],[0,255,191],[127,255,223],[0,204,153],[102,204,178],[0,153,114],[76,153,133],[0,127,95],[63,127,111],[0,76,57],[38,76,66],[0,255,255],[127,255,255],[0,204,204],[102,204,204],[0,153,153],[76,153,153],[0,127,127],[63,127,127],[0,76,76],[38,76,76],[0,191,255],[127,223,255],[0,153,204],[102,178,204],[0,114,153],[76,133,153],[0,95,127],[63,111,127],[0,57,76],[38,66,76],[0,127,255],[127,191,255],[0,102,204],[102,153,204],[0,76,153],[76,114,153],[0,63,127],[63,95,127],[0,38,76],[38,57,76],[0,63,255],[127,159,255],[0,51,204],[102,127,204],[0,38,153],[76,95,153],[0,31,127],[63,79,127],[0,19,76],[38,47,76],[0,0,255],[127,127,255],[0,0,204],[102,102,204],[0,0,153],[76,76,153],[0,0,127],[63,63,127],[0,0,76],[38,38,76],[63,0,255],[159,127,255],[51,0,204],[127,102,204],[38,0,153],[95,76,153],[31,0,127],[79,63,127],[19,0,76],[47,38,76],[127,0,255],[191,127,255],[102,0,204],[153,102,204],[76,0,153],[114,76,153],[63,0,127],[95,63,127],[38,0,76],[57,38,76],[191,0,255],[223,127,255],[153,0,204],[178,102,204],[114,0,153],[133,76,153],[95,0,127],[111,63,127],[57,0,76],[66,38,76],[255,0,255],[255,127,255],[204,0,204],[204,102,204],[153,0,153],[153,76,153],[127,0,127],[127,63,127],[76,0,76],[76,38,76],[255,0,191],[255,127,223],[204,0,153],[204,102,178],[153,0,114],[153,76,133],[127,0,95],[127,63,111],[76,0,57],[76,38,66],[255,0,127],[255,127,191],[204,0,102],[204,102,153],[153,0,76],[153,76,114],[127,0,63],[127,63,95],[76,0,38],[76,38,57],[255,0,63],[255,127,159],[204,0,51],[204,102,127],[153,0,38],[153,76,95],[127,0,31],[127,63,79],[76,0,19],[76,38,47],[51,51,51],[91,91,91],[132,132,132],[173,173,173],[214,214,214],[255,255,255]],OdCmEntityColor.prototype.setColorMethod=function(e){var t=OdCmEntityColor.prototype.ColorMethod;switch(e){case t.kByBlock:case t.kByLayer:case t.kByColor:case t.kNone:this.m_RGBM=e<<24;break;case t.kByACI:case t.kByPen:case t.kByDgnIndex:this.m_RGBM=65535&this.m_RGBM|e<<24;break;case t.kForeground:this.m_RGBM=t.kByACI<<24|7;break;default:throw"eInvalidInput"}},OdCmEntityColor.prototype.colorMethod=function(e){return(void 0!==e?e:this.m_RGBM)>>24&255},OdCmEntityColor.prototype.setColor=function(e){var t=OdCmEntityColor.prototype.colorMethod(e),i=(this.setColorMethod(t),OdCmEntityColor.prototype.ColorMethod);switch(t){case i.kByACI:case i.kByDgnIndex:this.setColorIndex(this.colorIndex(e));break;case i.kByColor:this.setRGB(this.red(e),this.green(e),this.blue(e));break;case i.kByPen:this.setIndirect(65535&e)}},OdCmEntityColor.prototype.color=function(){return this.m_RGBM},OdCmEntityColor.prototype.setColorIndex=function(e){var t=OdCmEntityColor.prototype.ColorMethod,i=OdCmEntityColor.prototype.ACIcolorMethod;if(e<i.kACIclear||e>i.kACInone)throw"eInvalidInput";switch(this.m_RGBM=0,e){case i.kACIbyBlock:this.setColorMethod(t.kByBlock);break;case i.kACIbyLayer:this.setColorMethod(t.kByLayer);break;case i.kACInone:this.setColorMethod(t.kNone);break;default:this.setColorMethod(t.kByACI),this.setIndirect(e)}},OdCmEntityColor.prototype.colorIndex=function(e){var t=void 0!==e?e:this.m_RGBM,e=OdCmEntityColor.prototype.ColorMethod,i=OdCmEntityColor.prototype.ACIcolorMethod;switch(this.colorMethod(t)){case e.kByLayer:return i.kACIbyLayer;case e.kByBlock:return i.kACIbyBlock;case e.kByColor:return this.lookUpACI(this.red(t),this.green(t),this.blue(t));case e.kByACI:case e.kByDgnIndex:return this.indirect(t);case e.kForeground:case e.kByPen:return i.kACIforeground;case e.kNone:return i.kACInone;default:throw"ODA_FAIL()"}return 0},OdCmEntityColor.prototype.setRGB=function(e,t,i){var r=OdCmEntityColor.prototype.ColorMethod;this.setColorMethod(r.kByColor),this.setRed(e),this.setGreen(t),this.setBlue(i)},OdCmEntityColor.prototype.setRed=function(e){var t=OdCmEntityColor.prototype.ColorMethod;if(this.colorMethod(this.m_RGBM)!==t.kByColor)throw"colorMethod(pRGBM) !== kByColor";this.m_RGBM&=4278255615,this.m_RGBM|=e<<16&16711680},OdCmEntityColor.prototype.setGreen=function(e){var t=OdCmEntityColor.prototype.ColorMethod;if(this.colorMethod(this.m_RGBM)!==t.kByColor)throw"colorMethod(pRGBM) != kByColor";this.m_RGBM&=4294902015,this.m_RGBM|=e<<8&65280},OdCmEntityColor.prototype.setBlue=function(e){var t=OdCmEntityColor.prototype.ColorMethod;if(this.colorMethod(this.m_RGBM)!==t.kByColor)throw"colorMethod(pRGBM) != kByColor";this.m_RGBM&=4294967040,this.m_RGBM|=255&e},OdCmEntityColor.prototype.red=function(e){return(void 0!==e?e:this.m_RGBM)>>16&255},OdCmEntityColor.prototype.green=function(e){return(void 0!==e?e:this.m_RGBM)>>8&255},OdCmEntityColor.prototype.blue=function(e){return 255&(void 0!==e?e:this.m_RGBM)},OdCmEntityColor.prototype.isByColor=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kByColor},OdCmEntityColor.prototype.isByLayer=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kByLayer},OdCmEntityColor.prototype.isByBlock=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kByBlock},OdCmEntityColor.prototype.isByACI=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kByACI},OdCmEntityColor.prototype.isForeground=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kForeground},OdCmEntityColor.prototype.isByDgnIndex=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kByDgnIndex},OdCmEntityColor.prototype.isNone=function(e){var e=void 0!==e?e:this.m_RGBM,t=OdCmEntityColor.prototype.ColorMethod;return this.colorMethod(e)===t.kNone},OdCmEntityColor.prototype.setTrueColor=function(){var e=OdCmEntityColor.prototype.ColorMethod;e.kByACI!==this.colorMethod(this.m_RGBM)&&e.kByDgnIndex!==this.colorMethod(this.m_RGBM)||(e=this.indirect(this.m_RGBM))<256&&this.setRGB(this.mLUT[e][0],this.mLUT[e][1],this.mLUT[e][2])},OdCmEntityColor.prototype.lookUpRGB=function(e){return(this.mLUT[e][0]<<16)+(this.mLUT[e][1]<<8)+this.mLUT[e][2]},OdCmEntityColor.prototype.lookUpACI=function(e,t,i){throw"not supported = > implement call => (OdUInt8)convPall.lookupIndex(ODRGB(red, green, blue)) = > int OdPalette::lookupIndex(ODCOLORREF rgb)"},OdCmEntityColor.prototype.indirect=function(e){var t=OdCmEntityColor.prototype.ColorMethod,e=void 0!==e?e:this.m_RGBM;if(this.colorMethod(e)===t.kByColor)throw"colorMethod(pRGBM) == kByColor";return 65535&e},OdCmEntityColor.prototype.setIndirect=function(e){var t=OdCmEntityColor.prototype.ColorMethod;if(this.colorMethod(this.m_RGBM)!==t.kByColor)throw"colorMethod(pRGBM) == kByColor";this.m_RGBM=4278190080&this.m_RGBM|65535&e},function(){this.m_AM=0,this.setMethod(OdCmTransparency.prototype.transparencyMethod.kByLayer)}),XeUniqueStatId=(OdCmTransparency.prototype.transparencyMethod={kByLayer:0,kByBlock:1,kByAlpha:2,kErrorValue:3},OdCmTransparency.prototype.setAlpha=function(e){var t=OdCmTransparency.prototype.transparencyMethod;this.m_AM=t.kByAlpha<<24|e},OdCmTransparency.prototype.alpha=function(){var e=OdCmTransparency.prototype.transparencyMethod;return this.method()!==e.kByAlpha?255:255&this.m_AM},OdCmTransparency.prototype.setAlphaPercent=function(e){e<0?this.setAlpha(0):1<e?this.setAlpha(255):this.setAlpha(255&255*e)},OdCmTransparency.prototype.alphaPercent=function(){return this.alpha()/255},OdCmTransparency.prototype.method=function(){return 255&this.m_AM>>24},OdCmTransparency.prototype.setMethod=function(e){this.m_AM=e<<24},OdCmTransparency.prototype.isByAlpha=function(){var e=OdCmTransparency.prototype.transparencyMethod;return this.method()===e.kByAlpha},OdCmTransparency.prototype.isByBlock=function(){var e=OdCmTransparency.prototype.transparencyMethod;return this.method()===e.kByBlock},OdCmTransparency.prototype.isByLayer=function(){var e=OdCmTransparency.prototype.transparencyMethod;return this.method()===e.kByLayer},OdCmTransparency.prototype.isClear=function(){var e=OdCmTransparency.prototype.transparencyMethod;return this.method()==e.kByAlpha&&0==this.alpha()},OdCmTransparency.prototype.isSolid=function(){var e=OdCmTransparency.prototype.transparencyMethod;return this.method()==e.kByAlpha&&255==this.alpha()},OdCmTransparency.prototype.serializeOut=function(){return this.m_AM},OdCmTransparency.prototype.serializeIn=function(e){this.m_AM=e},function(){var i=new Map,r=0;this.generate=function(e){1e3<r&&(r=0,i=new Map);var t=++r;return i.set(t,{ts:(new Date).getTime(),type:e.getEventType()}),t},this.get=function(e){return i.get(e)}}),XeUniqueStatId=new XeUniqueStatId,XeShiftPanAnimationHelper=function(e){var d=this,u=(d.m_XeDocument=e,{left:1,right:2,up:3,down:4});function t(e){e&&i.isDone()&&(p.selected_type=e,i.start(d.getXeDocument()))}d.getXeDocument=function(){return d.m_XeDocument},d.stop=function(){i.stop()},d.doLeft=function(){t(u.left)},d.doRight=function(){t(u.right)},d.doUp=function(){t(u.up)},d.doDown=function(){t(u.down)};var p={},i=new XeAnimation;i.setAnimationFrames(4),i.setLoop(!1),i.setAnimationSpeed(25),i.setAnimationFunc(function(e,t){var i=d.getXeDocument(),r=i.getXeGsDevice(),n=i.getXeGsDevice().getZoomPanViewport();if(n&&r){var o=[0,0];switch(p.selected_type){case u.left:o[0]=-1;break;case u.right:o[0]=1;break;case u.up:o[1]=-1;break;case u.down:o[1]=1}var a=n.getPosition(),s=n.getTarget(),c=n.PointToWCS(0,0,!0),l=[(l=n.PointToWCS(37.5*o[0],37.5*o[1],!0))[0]-c[0],l[1]-c[1],l[2]-c[2]],a=[a[0]-l[0],a[1]-l[1],a[2]-l[2]],s=[s[0]-l[0],s[1]-l[1],s[2]-l[2]];i.CommandStart("CLIENT_SETVIEW"),n.setTarget(s),n.setPosition(a),t&&(n.setUpVector(n.getUpVector()),n.setFieldWidth(n.getFieldWidth()),n.setFieldHeight(n.getFieldHeight())),i.CommandEnd("CLIENT_SETVIEW"),i.getXeGsDevice().invalidateViewports(),r.invalidateScene(),r.invalidateSelectionScene(),i.getXeInputPointManager().InvalidateApertureSelection()}})},XeMouseEventButtons=function(){this.bLeftButton=!1,this.bMiddleButton=!1,this.bRightButton=!1,this.compare=function(e){return this.bLeftButton===e.bLeftButton&&this.bMiddleButton===e.bMiddleButton&&this.bRightButton===e.bRightButton},this.clear=function(){this.bLeftButton=!1,this.bMiddleButton=!1,this.bRightButton=!1},this.copy_to=function(e){e.bLeftButton=this.bLeftButton,e.bMiddleButton=this.bMiddleButton,e.bRightButton=this.bRightButton}},XeKeyboardModifier=function(){this.bCtrlKey=!1,this.bShiftKey=!1,this.bAltKey=!1,this.bMetaKey=!1,this.compare=function(e){return this.bCtrlKey===e.bCtrlKey&&this.bShiftKey===e.bShiftKey&&this.bAltKey===e.bAltKey&&this.bMetaKey===e.bMetaKey},this.clear=function(){this.bCtrlKey=!1,this.bShiftKey=!1,this.bAltKey=!1,this.bMetaKey=!1},this.copy_to=function(e){e.bCtrlKey=this.bCtrlKey,e.bShiftKey=this.bShiftKey,e.bAltKey=this.bAltKey,e.bMetaKey=this.bMetaKey}},XeHitTestInfo=function(){var l=this;l.TYPE_ENUM_GestureState={NoGesture:0,GestureStarted:1,GestureUpdated:2,GestureFinished:3,GestureCanceled:4},l.InitFromEvent=function(e,t,i){var r=window.Wt.WT;if(!r||!t||!e)return!1;var n=t.getBoundingClientRect();if(!n)return!1;if(!i)return!1;d.m_Event=e,XeHitTestInfo.prototype.setMouseButtons(d.m_Event,d.m_MouseButton,d.m_Modifiers),l.IsMouseEvent()&&(a=r.pageCoordinates(e),r=r.widgetPageCoordinates(t),c=a.x-r.x,a=a.y-r.y,d.m_MousePosition.x=c,d.m_MousePosition.y=a,1==("mouseup"===d.m_Event.type&&(d.m_MouseButton.bMiddleButton||d.m_MouseButton.bRightButton)))&&t.classList.add("interactive_arrowpick");var o,a,s,c,r=!1,t=(l.IsTouchEvent()&&(e.touches?o=e.touches:e.changedTouches?o=e.changedTouches:e.targetTouches&&(o=e.targetTouches),!(l.IsTouchStarted()||l.IsTouchEnded()||l.IsTouchCancelled()||l.IsTouchLeft()))&&o&&o.length&&l.IsTouchMoved()?1!==o.length||d.m_bIsGesturePinch?2===o.length&&(d.m_bIsGesture=!0,d.m_bIsGesturePan=!0,d.m_bIsGesturePinch=!0,0<i.getXeGsDevice().getPixelHeight())?(c=o[0].clientX-n.left,a=o[0].clientY-n.top,t=o[1].clientX-n.left,s=o[1].clientY-n.top,d.m_MousePosition.x=(c+t)/2,d.m_MousePosition.y=(a+s)/2,c=Math.sqrt((c-t)*(c-t)+(a-s)*(a-s)),0<d.m_gesturePinchLastFactor&&20<c&&(d.m_gesturePinchScaleFactor=15*(c-d.m_gesturePinchLastFactor)/i.getXeGsDevice().getPixelHeight()),d.m_gesturePinchLastFactor=c):r=!0:(d.m_bIsGesture=!0,d.m_bIsGesturePan=!0,d.m_bIsGesturePinch=!1,d.m_MousePosition.x=o[0].clientX-n.left,d.m_MousePosition.y=o[0].clientY-n.top,d.m_gesturePinchLastFactor=-1):r=!0,r&&(d.m_bIsGesture=!1,d.m_bIsGesturePan=!1,d.m_bIsGesturePinch=!1,d.m_gesturePinchLastFactor=-1),d.m_dWheelDelta=0,d.m_dWheelOrientation=1,l.IsMouseWheel()&&(d.m_dWheelDelta=this.procWheelDelta(d.m_Event),d.m_dWheelOrientation=1===i.getXeGsDevice().getXeDocument().getXeDatabase().getZOOMWHEEL()?-1:1),i.PointToWCS(d.m_MousePosition.x,d.m_MousePosition.y,!0));if(d.m_CursorPosition=t,d.m_Shortcut="",l.IsKeyboardEvent()){if(("Ctrl"===e.key||"Meta"===e.key||"Alt"===e.key||"Shift"===e.key)&&!0===e.repeat&&d.m_Key===e.key&&d.m_Event.type===e.type)return!1;d.m_Key=e.key,l.IsCtrlPressed()&&(d.m_Shortcut+="Ctrl+"),l.IsMetaPressed()&&(d.m_Shortcut+="Meta+"),l.IsAltPressed()&&(d.m_Shortcut+="Alt+"),l.IsShiftPressed()&&(d.m_Shortcut+="Shift+"),d.m_Shortcut+=window.XeUtils.getXeCommonKeyboardString(e),d.m_Shortcut=d.m_Shortcut.toUpperCase()}return!0},l.UpdateCursorPosition=function(e){e&&(e=e.PointToWCS(d.m_MousePosition.x,d.m_MousePosition.y,!0),d.m_CursorPosition=e)},l.IsMouseEvent=function(){return!!(l.IsMouseDown()||l.IsMouseUp()||l.IsMouseMoved()||l.IsMouseWheel()||l.IsMouseClick()||l.IsMouseDoubleClick()||l.IsMouseOut()||l.IsMouseOver())},l.IsGesture=function(){return d.m_bIsGesture},l.IsGesturePan=function(){return d.m_bIsGesturePan},l.IsGesturePinch=function(){return d.m_bIsGesturePinch},l.IsDragEvent=function(){},l.IsLeftMouseButtonPressed=function(){return!l.IsMouseClick()&&!l.IsMouseDoubleClick()&&!l.IsMouseUp()&&d.m_MouseButton.bLeftButton},l.IsMiddleMouseButtonPressed=function(){return!l.IsMouseClick()&&!l.IsMouseDoubleClick()&&!l.IsMouseUp()&&d.m_MouseButton.bMiddleButton},l.IsRightMouseButtonPressed=function(){return!l.IsMouseClick()&&!l.IsMouseDoubleClick()&&!l.IsMouseUp()&&d.m_MouseButton.bRightButton},l.IsShiftPressed=function(){return d.m_Modifiers.bShiftKey},l.IsCtrlPressed=function(){return d.m_Modifiers.bCtrlKey},l.IsAltPressed=function(){return d.m_Modifiers.bAltKey},l.IsMetaPressed=function(){return d.m_Modifiers.bMetaKey},l.IsMouseOverActiveViewport=function(){},l.IsMouseOut=function(){return"mouseout"===d.m_Event.type},l.IsMouseOver=function(){return"mouseover"===d.m_Event.type},l.IsMouseWheel=function(){return"wheel"===d.m_Event.type||"mousewheel"===d.m_Event.type||"onmousewheel"===d.m_Event.type},l.IsMouseMoved=function(){return"mousemove"===d.m_Event.type},l.IsMouseDown=function(){return"mousedown"===d.m_Event.type},l.IsMouseUp=function(){return"mouseup"===d.m_Event.type},l.IsMouseClick=function(){return"click"===d.m_Event.type},l.IsMouseDoubleClick=function(){return"dblclick"===d.m_Event.type},l.IsLeftButtonDown=function(){return l.IsMouseDown()&&d.m_MouseButton.bLeftButton},l.IsLeftButtonUp=function(){return l.IsMouseUp()&&d.m_MouseButton.bLeftButton},l.IsMiddleButtonDown=function(){return l.IsMouseDown()&&d.m_MouseButton.bMiddleButton},l.IsMiddleButtonUp=function(){return l.IsMouseUp()&&d.m_MouseButton.bMiddleButton},l.IsRightButtonDown=function(){return l.IsMouseDown()&&d.m_MouseButton.bRightButton},l.IsRightButtonUp=function(){return l.IsMouseUp()&&d.m_MouseButton.bRightButton},l.IsLeftButtonTrippleClick=function(){},l.IsMiddleButtonTrippleClick=function(){},l.IsRightButtonTrippleClick=function(){},l.IsLeftButtonDoubleClick=function(){return l.IsMouseDoubleClick()&&d.m_MouseButton.bLeftButton},l.IsMiddleButtonDoubleClick=function(){return l.IsMouseDoubleClick()&&d.m_MouseButton.bMiddleButton},l.IsRightButtonDoubleClick=function(){return l.IsMouseDoubleClick()&&d.m_MouseButton.bRightButton},l.IsRightButtonClick=function(){},l.IsMiddleButtonClick=function(){},l.IsLeftButtonClick=function(){},l.IsKeyboardEvent=function(){return"keydown"===d.m_Event.type||"keyup"===d.m_Event.type||"keypress"===d.m_Event.type||"key_escape"===d.m_Event.type||"key_enter"===d.m_Event.type},l.IsKeyDown=function(){return"keydown"===d.m_Event.type},l.IsKeyPress=function(){return"keypress"===d.m_Event.type},l.IsKeyUp=function(){return"keyup"===d.m_Event.type},l.IsKeyEscape=function(){return"key_escape"===d.m_Event.type},l.IsKeyEnter=function(){return"key_enter"===d.m_Event.type},l.IsCancelPressed=function(){},l.IsSpacePressed=function(){},l.IsArrowUpPressed=function(){},l.IsArrowDownPressed=function(){},l.IsContinuousEvent=function(){},l.IsDragMoveEvent=function(){},l.IsInsideDragSequence=function(){},l.IsTouchEvent=function(){return"touchstart"===d.m_Event.type||"touchend"===d.m_Event.type||"touchmove"===d.m_Event.type||"touchcancel"===d.m_Event.type||"touchleave"===d.m_Event.type},l.IsTouchStarted=function(){return"touchstart"===d.m_Event.type},l.IsTouchEnded=function(){return"touchend"===d.m_Event.type},l.IsTouchMoved=function(){return"touchmove"===d.m_Event.type},l.IsTouchCancelled=function(){return"touchcancel"===d.m_Event.type},l.IsTouchLeft=function(){return"touchleave"===d.m_Event.type},l.GetGestureState=function(){},l.GetKey=function(){return d.m_Key},l.GetKeyText=function(){return d.m_KeyText},l.GetShortcut=function(){return d.m_Shortcut},l.IsFxEvent=function(){},l.GetFxEventType=function(){},l.IsInsideCommand=function(){},l.IsInsideLISP=function(){},l.IsInsideSelect=function(){},l.GetWheelDelta=function(){return d.m_dWheelDelta},l.GetWheelOrientation=function(){return d.m_dWheelOrientation},l.GetMousePosition=function(){return d.m_MousePosition},l.GetCursorPosition=function(){return d.m_CursorPosition},l.GetGesturePanOffset=function(){},l.GetGesturePinchCenterPoint=function(){},l.GetGesturePinchScaleFactor=function(){return d.m_gesturePinchScaleFactor},l.GetGesturePinchRollAngle=function(){},l.GetGestureSwipeAngle=function(){},l.EnableSystemCursorGraphics=function(){},l.DisableSystemCursorGraphics=function(){},l.SystemCursorDisableCount=function(){},l.ClearCursorDisableCount=function(){},l.getEventType=function(){return l.IsMouseMoved()?"mousemove":l.IsMouseDown()?"mousedown":l.IsMouseUp()?"mouseup":l.IsMouseClick()?"click":l.IsMouseDoubleClick()?"dblclick":l.IsMouseOut()?"mouseout":l.IsMouseOver()?"mouseover":l.IsMouseWheel()?"mousewheel":l.IsKeyDown()?"keydown":l.IsKeyPress()?"keypress":l.IsKeyUp()?"keyup":l.IsKeyEscape()?"key_escape":l.IsKeyEnter()?"key_enter":l.IsTouchEnded()?"mousedown":void 0},l.CreateJSON=function(){let e=d.m_Event.xeCustomEvent&&d.m_Event.xeWidgetId;var t={id:(e=(e=(e=e||d.m_Event.target&&d.m_Event.target.id)||d.m_Event.target&&d.m_Event.target.tagName)||d.m_Event.xeWidgetId)||"",type:l.getEventType(),mouse_button:{lmb:d.m_MouseButton.bLeftButton,mmb:d.m_MouseButton.bMiddleButton,rmb:d.m_MouseButton.bRightButton},modifiers:{shift:d.m_Modifiers.bShiftKey,ctrl:d.m_Modifiers.bCtrlKey,alt:d.m_Modifiers.bAltKey,meta:d.m_Modifiers.bMetaKey},mouse_position:{x:Math.floor(d.m_MousePosition.x),y:Math.floor(d.m_MousePosition.y)},cursor_position:{x:d.m_CursorPosition[0],y:d.m_CursorPosition[1],z:d.m_CursorPosition[2]},wheel_delta:d.m_dWheelDelta,key:{key:d.m_Event.key||"",keyCode:d.m_Event.keyCode||0,charCode:d.m_Event.charCode||0,code:d.m_Event.code||"",repeat:d.m_Event.repeat}};return window.__IsDebugMode&&(t.unique_stat_id=XeUniqueStatId.generate(l)),t};let r=0;document.addEventListener("touchstart",e=>{var t,i=(new Date).getTime();i-r<325&&(t=new KeyboardEvent("keydown",{key:"Escape",keyCode:27,code:"Escape",bubbles:!0}),document.dispatchEvent(t)),r=i});var d={m_MouseButton:new XeMouseEventButtons,m_Modifiers:new XeKeyboardModifier,m_Key:0,m_KeyText:0,m_dWheelDelta:0,m_dWheelOrientation:0,m_MousePosition:new GeNeo.OdGePoint2d,m_CursorPosition:new GeNeo.OdGePoint3d,m_iCursorCounter:0,m_bMouseInActiveViewport:0,m_FxEventType:0,m_pActiveView:0,m_ContEvFlags:0,m_ContEvPoint:0,m_bActiveViewChanged:0,m_bIsGesture:!1,m_bIsGesturePan:!1,m_bIsGesturePinch:!1,m_GestureType:0,m_gesturePanOffset:0,m_gesturePinchScaleFactor:0,m_gesturePinchLastFactor:0,m_gesturePinchCenterPoint:0,m_gesturePinchRollAngle:0,m_gestureSwipeAngle:0,m_gestureState:0,m_iModifierKeyClicked:0,m_Shortcut:"",m_Event:0};l.values=d},XeDoubleClickWatcher=(XeHitTestInfo.prototype.setMouseButtons=function(e,t,i){var r="click"===e.type,n="dblclick"===e.type,o="mouseup"===e.type,a=!1,s=!1,c=!1;e&&("buttons"in e&&!r&&!n&&!o?(a=1==(1&e.buttons),s=4==(4&e.buttons),c=2==(2&e.buttons)):"which"in e&&(a=1===e.which,s=2===e.which,c=3==e.which)),o&&(a=!(!t.bLeftButton&&!a),s=!(!t.bMiddleButton&&!s),c=!(!t.bRightButton&&!c)),t.bLeftButton=a,t.bMiddleButton=s,t.bRightButton=c,i.bCtrlKey=!!e.ctrlKey,i.bShiftKey=!!e.shiftKey,i.bAltKey=!!e.altKey,i.bMetaKey=!!e.metaKey},function(e){let t=this;function i(){o()}function o(){a=!1,s&&(clearTimeout(s),s=0),c.clear(),l={clientX:-1,clientY:-1}}t.onEvent=function(r){if("mouseup"===r.type){var e=new XeMouseEventButtons,n=new XeKeyboardModifier;if(XeHitTestInfo.prototype.setMouseButtons(r,e,n),a){if(e.compare(c)&&Math.abs(l.clientX-r.clientX)<4&&Math.abs(l.clientY-r.clientY)<4){n=r;let e=n,t=new MouseEvent("dblclick",{target:e.target,type:"dblclick",bubbles:e.bubbles,cancelable:e.cancelable,cancelBubble:e.cancelBubble,view:e.view,detail:e.detail,currentTarget:e.currentTarget,relatedTarget:e.relatedTarget,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,button:e.button,buttons:e.buttons,mozPressure:e.mozPressure,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,which:e.which}),i=(t.xeCustomEvent=!0,n.currentTarget);setTimeout(function(){i.dispatchEvent(t)},0)}o()}else a=!0,e.copy_to(c),l.clientX=r.clientX,l.clientY=r.clientY,s=setTimeout(i,t.getTimeoutTime())}};let a=!(t.getTimeoutTime=function(){return XeDoubleClickWatcher.prototype.DblTimeoutTime}),s=0,c=new XeMouseEventButtons;new XeKeyboardModifier;let l={clientX:-1,clientY:-1};o()}),InputPointManager=(XeDoubleClickWatcher.prototype.DblTimeoutTime=325,XeHitTestInfo.prototype.procWheelDelta=function(e){var t=e,i=0;return i="Mac OS X"===window.XeUtils.UserAgentDetector.os?this.procWheelDeltaMac(e):(0===t.deltaMode?i=1.3*-t.deltaY:-1<navigator.userAgent.toLowerCase().indexOf("firefox")?2===t.axis&&t.detail?i=26*-t.detail:t.deltaY&&(i=29*-t.deltaY):t.deltaY?i=1.3*-t.deltaY:t.wheelDelta&&(i=.85*t.wheelDelta),Number.isNaN(i)?0:.0145*i)},XeHitTestInfo.prototype.procWheelDeltaMac=function(e){var t,i={wheelDelta:0,wheelDeltaX:0,wheelDeltaY:0,axis:0,detail:0};for(t in-1<navigator.userAgent.toLowerCase().indexOf("firefox")?(r=(r=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./))?parseInt(r[1]):0,2===e.axis&&e.detail?(i.detail=e.detail,i.axis=e.axis):e.deltaY&&(i.wheelDelta=-e.deltaY*(r=r<88?30:1.5),i.wheelDeltaX=-e.deltaX*r,i.wheelDeltaY=-e.deltaY*r)):e.wheelDelta?(i.wheelDelta=e.wheelDelta,i.wheelDeltaX=e.wheelDeltaX,i.wheelDeltaY=e.wheelDeltaY):e.deltaY&&(i.wheelDelta=1.2*-e.deltaY,i.wheelDeltaX=1.2*-e.deltaX,i.wheelDeltaY=1.2*-e.deltaY),i)i.hasOwnProperty(t)&&(i[t]=isNaN(i[t])?0:i[t]);var r={utilities:{isPlatformWindows:function(){return-1<navigator.platform.toLowerCase().indexOf("win")}}},e=0,n=.5;if("mousewheel"==={type:"mousewheel"}.type){if(0===i.wheelDelta||i.wheelDeltaX&&Math.abs(i.wheelDeltaX)>Math.abs(i.wheelDeltaY))return 0;n/=120,r.utilities.isPlatformWindows()&&(n*=3),e=n*i.wheelDelta}else{if(0===i.detail||1===i.axis)return 0;e=-n*i.detail}return e},function(r){var n,m=this,h=(m.m_XeDocument=r,!1),i=new XeCursorDrawer,t=!1,o=!1,e={isFirefox:-1<navigator.userAgent.toLowerCase().indexOf("firefox"),isMacOs:-1<navigator.platform.toLowerCase().indexOf("mac")},a=(m.getNavigator=function(){return e},new XeShiftPanAnimationHelper(r)),s=(m.getXeDocument=function(){return m.m_XeDocument},m.getXeShiftPanAnimationHelper=function(){return a},m.setMouseDownDCPoint=function(e,t){c.x=Math.floor(e),c.y=Math.floor(t)},m.getMouseDownDCPoint=function(){return c},m.setTouchBasedZoomDistance=function(e){s=e},m.getTouchBasedZoomDistance=function(e){return s},m.getMouse3dConnexion=function(){return n},-1),c={x:0,y:0},l=[],g={x:0,y:0,ctx:null,canvas:void 0,m_XeViewport:null};function y(){}function d(){t=!0,m.m_bypassOnMouseWheelTimeout&&clearTimeout(m.m_bypassOnMouseWheelTimeout),m.m_bypassOnMouseWheelTimeout=setTimeout(function(){t=!1},150)}document.addEventListener("XeDocument_Activated",function(e){e.m_Item===m.getXeDocument()&&m.StartProcessing()}),document.addEventListener("XeDocument_Deactivated",function(e){e.m_Item===m.getXeDocument()&&m.StopProcessing()}),document.addEventListener("Update_XeInputPointManager",function(e){e.m_Item.getXeDocument()===m.getXeDocument()&&m.Update_XeInputPointManager_Handler(e.m_Item.getXeDocument(),e)}),document.addEventListener("Update_XeCommandProcessor",function(e){m.resetCursorDrawPath()}),document.addEventListener("XeGsDevice_LastChunk",function(e){m.resetCursorDrawPath()}),document.addEventListener("paste",function(e){if("paste"===e.type){var t=((e,t)=>{for(var i=e;i;){if(i.dataset&&i.dataset.objectName===t)return i;i=i.parentElement}return null})(e.target,"tvComment");if(t){var i,r=e.clipboardData.getData("text/html");if(!window.IsOsVersion()){var n=e.clipboardData.getData("text/plain").length,o=document.createElement("div");if(o.innerHTML=r,2e3<(o.textContent||o.innerText||"").length||2e3<n)return void e.preventDefault()}if(""!==r?(o=(new DOMParser).parseFromString(r,"text/html").body.textContent,n=document.createTextNode(o),t.appendChild(n),e.preventDefault(),r=t,document.createRange&&((o=document.createRange()).selectNodeContents(r),o.collapse(!1),(r=window.getSelection()).removeAllRanges(),r.addRange(o))):i=t.value||t.innerText||t.textContent,e.clipboardData){var a=e.clipboardData.items;if(a)for(var s=0;s<a.length;s++)-1!==a[s].type.indexOf("image")&&e.preventDefault()}"Enter"===e.key&&""!==i.trim()&&e.preventDefault()}}}),document.addEventListener("copy",function(e){" Wt-layout Wt-ltr"==e.target.className&&(e.clipboardData.setData("text/plain",""),e.preventDefault())}),document.addEventListener("Update_XeGsDevice",function(e){var t,i,e=e.m_Item;e&&e.getXeDocument()===m.getXeDocument()&&(m.resetCursorDrawPath(),h)&&(i=m.getXeDocument(),t=e.getPixelWidth(),e=e.getPixelHeight(),i.getUSE3DMOUSE()&&0!==t&&0!==e&&!n&&m.init3dMouse(i),(i=g.canvas).width===t&&i.height===e||(i.width=t,i.height=e))}),m.connectWPopupMenuEvents(),m.isValid=function(){return h},m.getCanvas=function(){return g.canvas},m.getOptions=function(){return g},m.Update_XeInputPointManager_Handler=function(e,t){t=t.m_Item;t&&t.getPENDING()&&m.updateCoords(e)},m.init3dMouse=function(e){m.init3dMouse.promise||(m.delete3dMouse(),m.delete3dMouse=function(){},window._3DCONNEXION_DEBUG=!1,n=new Mouse3dConnexionProxy(e),m.init3dMouse.promise=n.init3DMouse(m.getCanvas()).then(e=>{m.delete3dMouse=function(){n.delete3dmouse(),n=void 0,m.delete3dMouse=function(){}},m.init3dMouse.promise=null}).catch(e=>{n.delete3dmouse(),n=void 0,m.delete3dMouse=function(){},m.init3dMouse.promise=null}))},m.delete3dMouse=function(){},m.initInputPointManager=function(e){m.m_MyWidget=e.getClientTrackerWidget(),m.m_XeDocument=e,m.StartProcessing()},m.StartProcessing=function(){if(!h)try{var e=m.m_XeDocument.getXeGsDevice(),t=document.getElementById(m.m_MyWidget),i=(g.canvas=document.createElement("canvas"),g.canvas);i.width=e.getPixelWidth(),i.height=e.getPixelHeight(),m.connectEvents(i),t.appendChild(g.canvas),h=!0,r.getUSE3DMOUSE()&&m.init3dMouse(m.m_XeDocument)}catch(e){return window.XeLogger.error("InputPointManager : init called with errors"),h=!1}return g.canvas.focus(),!0},m.StopProcessing=function(){var e,t;return h&&(m.delete3dMouse(),(e=g.canvas)&&(m.disconnectEvents(e),t=document.getElementById(m.m_MyWidget))&&"function"==typeof t.removeChild&&t.removeChild(e),g.canvas=void 0,h=!1),!0},m.connectEvents=function(e){window.XeUtils.ConnectInputEvents(e,m.onMouseMove,m.DoubleClickWatcher.onEvent,m.DoubleClickWatcher.onEvent,m.DoubleClickWatcher.onEvent,m.DoubleClickWatcher.onEvent,m.onMouseWheel,m.onMouseOut,m.onMouseOver,m.onTouchStarted,m.onTouchMoved,m.onTouchEnded,!0),window.addEventListener("keydown",m.onKeyDown),window.addEventListener("keypress",m.onKeyPress),window.addEventListener("keyup",m.onKeyUp),window.addEventListener("key_escape",m.onSpecialKey),window.addEventListener("key_enter",m.onSpecialKey)},m.DoubleClickWatcher={onEvent:function(e){var t=m.DoubleClickWatcher;if("dblclick"===e.type){if(!e.xeCustomEvent)return;t.timeoutHandler&&clearTimeout(t.timeoutHandler),t.eventQueue=[],t.timeoutHandler=0,m.onDoubleClick(e)}var i;switch(e.type){case"mousedown":i=m.onMouseDown;break;case"mouseup":i=m.onMouseUp;break;case"click":i=m.onClick;break;default:return}t.watcher.onEvent(e),i(e)},watcher:new XeDoubleClickWatcher},m.disconnectEvents=function(e){window.XeUtils.ConnectInputEvents(e),window.removeEventListener("keyup",m.onKeyUp),window.removeEventListener("keypress",m.onKeyPress),window.removeEventListener("keydown",m.onKeyDown),window.removeEventListener("key_escape",m.onSpecialKey),window.removeEventListener("key_enter",m.onSpecialKey)},m.setDrawOrderTrackersArray=function(){l=[];var e,t=0;for(e in clientSideTrackersHolder)if(clientSideTrackersHolder.hasOwnProperty(e)){var i=clientSideTrackersHolder[e];if(i.drawTracker)if(0===l.length)l.push({name:e,order:i.drawOrder});else if(i.drawOrder){for(var r=!1,t=0;t<l.length;t++)if(l[t].order>i.drawOrder||!l[t].order){l.splice(t,0,{name:e,order:i.drawOrder}),r=!0;break}!1===r&&l.push({name:e,order:i.drawOrder})}else l.push({name:e,order:i.drawOrder});else window.XeLogger.error("Tracker "+e+"does not have a drawTracker member!")}},m.getDrawOrderTrackersArray=function(){return l},m.setDrawOrderTrackersArray(),m.forceGDICursorRedrawImpl=function(e,t){window.__NoCursor||(g.m_XeMyDocument=t,i.draw(g,e))},m.drawTrackers=function(){if(window.getXeActiveDocument()&&h&&!window.__NoCursor){var e=m.getXeDocument();if(e){var t=e.getXeGsDevice();if(t){var i=t.getXeGsViewports();t.getPixelWidth(),t.getPixelHeight();if(e.getXeInputPointManager().getCursorPosition()){var t=e.getXeGsDevice().getActiveViewport(),r=e.getXeGsDevice().getOverallViewport();if(t){var n=new XeTimer("INPUT_POINT_MNG_DRAW_TIME");(new Date).getTime();if(g.canvas&&g.canvas.getContext){if(g.ctx||(g.ctx=g.canvas.getContext("2d")),!g.ctx)return;if(g.ctx.clearRect(0,0,g.canvas.offsetWidth,g.canvas.offsetHeight),!g.ctx)return;if(g.ctx.setLineDash||(g.ctx.setLineDash=y),!e.getXeInputPointManager().getDrawTrackersOff())for(var o in i){o=i.getByVpnum(o);if(o){g.m_OverallXeViewport=r,g.m_XeViewport=o,g.m_XeMyDocument=e,p=u=d=l=c=o=s=a=void 0;var a=g,s=a.m_XeMyDocument,o=s.getXeGsDevice(),c=(o.getPixelWidth(),o.getPixelHeight(),a.m_XeViewport),l=clientSideTrackersHolder;if(l){var d=m.getDrawOrderTrackersArray();if(d){if(a.ctx.save(),window.XeDrawHelper.setGDIClipping(a.ctx,c))for(var u=0;u<d.length;u++){var p=d[u].name,p=l[p];if(p&&p.isActiveOnPan(s)&&(!p.isDrawnOnlyInActiveViewport()||c.getActive())){a.ctx.save();try{p.drawTracker(a)}catch(e){window.XeLogger.error("Exception inside drawTracker: "+e)}a.ctx.restore()}}a.ctx.restore()}}}}g.m_OverallXeViewport=r,g.m_XeViewport=t,g.ctx.save(),window.XeDrawHelper.setGDIClipping(g.ctx,t)&&e.getXeInputPointManager().drawRubberLine(g.ctx),g.ctx.restore(),g.ctx.save(),!t.getOverall()&&clientSideTrackersHolder.CFxViewportBorderLineTracker&&clientSideTrackersHolder.CFxViewportBorderLineTracker.drawTracker(g),g.ctx.restore(),e.getXeInputPointManager().getHitTestInfo().IsMouseWheel()||m.forceGDICursorRedrawImpl(!0,e),g.ctx=null,g.m_XeViewport=null,g.m_OverallXeViewport=null}n.report()}}}}}},m.isMouseOut=function(){return o},m.onMouseUp=function(e){d(),m.updateInput(e),m.getXeDocument().getXeInputPointManager().getHitTestInfo().values.m_MouseButton.bLeftButton&&m.getXeDocument().getXeInputPointManager().ProcessMouseUp()},m.onMouseDown=function(e){d(),m.updateInput(e),m.getXeDocument().getXeInputPointManager().getHitTestInfo().values.m_MouseButton.bLeftButton&&m.getXeDocument().getXeInputPointManager().ProcessLeftMouseDown()},m.onClick=function(e){m.updateInput(e)},m.onDoubleClick=function(e){e.xeCustomEvent&&(m.updateInput(e),m.getXeDocument().getXeInputPointManager().getHitTestInfo().values.m_MouseButton.bLeftButton)&&m.getXeDocument().getXeInputPointManager().ProcessLeftMouseDoubleClick()};var u={screenX:-1,screenY:-1};m.onMouseMove=function(e){var t=m.getXeDocument().getXeInputPointManager();!t||u.screenX===e.screenX&&u.screenY===e.screenY||(u.screenX=e.screenX,u.screenY=e.screenY,o)||(m.updateInput(e),t.getHitTestInfo().values.m_MouseButton.bLeftButton&&t.ProcessMouseMove(),t.PrepareTooltip())},m.onMouseOut=function(e){o=!0,m.updateInput(e)},m.onMouseOver=function(e){o&&(o=!1,m.updateInput(e))},m.onTouchEnded=function(e){m.updateInput(e)},m.onTouchStarted=function(e){m.updateInput(e)},m.onTouchMoved=function(e){m.updateInput(e)},m.onMouseWheel=function(e){t||m.updateInput(e)};function p(e,t,i,r,n){var o=2===n.getXeDatabase().getCOORDS(),a=t;(o&=i)&&r?a=[t[0]-r[0],t[1]-r[1],t[2]-r[2]]:o=!1,a={x:a[0],y:a[1],z:a[2]},m.m_CurrentMouseCoordinate=a;i=(new UnitsFormatter).PointToString(n,a,o,-1,-1,void 0,!0,n);e.text(i)}m.onKeyUp=function(e){e.target&&e.target.onkeyup||document.noteImeHandler.isEnabled()&&document.noteImeHandler.isIMEComposing()||m.updateInput(e)},m.onKeyPress=function(e){e.target&&e.target.onkeypress||document.noteImeHandler.isEnabled()&&(document.noteImeHandler.setFocus(e),!document.noteImeHandler.isKeyPress(e))||m.updateInput(e)},m.onKeyDown=function(e){var t;window.__IsDebugMode&&!0===e.shiftKey&&!0===e.ctrlKey&&(t=null,t=56===(e.keyCode||e.charCode)?new XeDebugWidget:t)&&(t.IsVisible()?t.hide():t.show()),document.noteImeHandler.isEnabled()&&document.noteImeHandler.isIMEComposing()||m.updateInput(e)},m.onSpecialKey=function(e){m.updateInput(e)},m.updateCoords=function(e){var t,i;(m.updateCoords.status_bar||(m.updateCoords.status_bar=jQuery("[data-object-name=coordinates_label] span:first-child"),m.updateCoords.status_bar))&&(t=e.getXeGsDevice().getActiveViewport())&&(i=e.getXeInputPointManager().getSpecificRubberPoint())&&(t=t.PointToUCS(i),0===(i=m.getXeDocument().getXeDatabase().getCOORDS())?e.getXeInputPointManager().getHitTestInfo().IsLeftMouseButtonPressed()&&p(m.updateCoords.status_bar,t,e.getXeInputPointManager().getInsideCommand(),void 0,e):1===i?p(m.updateCoords.status_bar,t,e.getXeInputPointManager().getInsideCommand(),void 0,e):2===i&&p(m.updateCoords.status_bar,t,e.getXeInputPointManager().getInsideCommand(),e.getXeInputPointManager().getBASEPOINT(),e))},m.updateInput=function(t){var i=m.getXeDocument(),r=(this.GetApertureSelectionTimeout&&(clearTimeout(this.GetApertureSelectionTimeout),this.GetApertureSelectionTimeout=0),i.getXeGsDevice().getActiveViewport()),n=i.getXeInputPointManager().getHitTestInfo();if(!n.InitFromEvent(t,m.getCanvas(),r))return!1;let o=!1;for(let e=this.eventLoopHandlers.length-1;0<=e;e--){var a=this.eventLoopHandlers[e];if(o=a.updateInput(this))break}if(!o){this.getOptions();let e=i.getXeInputPointManager();n.IsKeyboardEvent()?n.IsKeyDown()?o=this.onKeyDownHandler(this,t):n.IsKeyPress()?o=this.onKeyPressHandler(this,t):n.IsKeyUp()&&(o=this.onKeyUpHandler(this,t)):(this.updateCoords(i),n.IsMouseOver()&&this.resetCursorDrawPath(),n.IsMouseOut()?e.SetApertureSelection([]):(n.IsMouseMoved()||n.IsMouseDown())&&e.InvalidateApertureSelection(),(n.IsMouseDown()||n.IsMouseUp()||n.IsTouchStarted()||n.IsTouchEnded()||n.IsTouchCancelled()||n.IsTouchLeft())&&(this.setTouchBasedZoomDistance(-1),this.setMouseDownDCPoint(n.GetMousePosition().x,n.GetMousePosition().y)),this.mobileGestureProc(this,n),this.mouseInputProc(this,n),this.updateTrackers(i),n.IsMouseOut()&&this.resetCursorDrawPath()),o||n.IsMouseOut()||this.sendXeInput(i,n);r=i.getXeGsDevice(),t=(r&&(n.IsMouseOut()&&r.setPan(!1),n.IsMouseWheel()||(r.invalidateClientTrackers(),r.invalidateClientTrackersGL())),e.getInsideCommand()),i=(e.getInsideNEntsel(),e.getInsideSelect(),e.IsClientPending());t||i||r.getPan()||r.getZoom()||r.getOrbit()||(n=InputPointManager.prototype.ApertureSelectionTimeoutTime,this.GetApertureSelectionTimeout=setTimeout(()=>e.GetApertureSelection,n))}},m.setZoomImpl=function(e){var t=m.getXeDocument();t.getXeInputPointManager();t.getXeGsDevice().setZoom(e)}}),UnitsFormatter=(InputPointManager.prototype.IgnoreMouseDownOnDoubleClick=!1,InputPointManager.prototype.PointToWCS=function(e,t){var i=new GeNeo.OdGePoint3d(e.getPosition()[0],e.getPosition()[1],e.getPosition()[2]),r=(e.getPerspective()&&(i=new GeNeo.OdGePoint3d(0,0,0)).transformBy(e.getEyeToWorldTransform()),e.getViewDir()),r=new GeNeo.OdGeVector3d(r[0],r[1],r[2]),n=e.getUpVector(),n=new GeNeo.OdGeVector3d(n[0],n[1],n[2]),r=r.crossProduct(n),i=new GeNeo.OdGePlane(i,r,n),r=e.PointToWCSWithPlane(t[0],t[1],i);return new GeNeo.OdGePoint3d(r[0],r[1],r[2])},InputPointManager.prototype.eventLoopHandlers=[],InputPointManager.prototype.pushToEventLoop=function(e){this.eventLoopHandlers.push(e)},InputPointManager.prototype.removeFromEventLoop=function(t){this.eventLoopHandlers=this.eventLoopHandlers.filter(e=>e!==t)},InputPointManager.prototype.resetCursorDrawPath=function(){var e=this.getOptions();e&&(e.currentCursorDrawPath="",e.previousCursorDrawPath=-1)},InputPointManager.prototype.ApertureSelectionTimeoutTime=10,InputPointManager.prototype.sendXeInput=function(e,t){var i,r=!1;t.IsMouseEvent()?r=!!this.getXeDocument().getXeInputPointManager().getPENDING()||!t.IsMouseWheel()&&(t.IsMouseMoved(),!0):t.IsKeyboardEvent()?(i=(i=window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker"))&&i.active,!(window.noteEditorHandler&&window.noteEditorHandler.isNoteEditorActive())&&i&&t.IsKeyPress()||(r=!0)):t.IsTouchEnded()&&(r=!0),r&&(i=t.CreateJSON(),window.getXeApplication().SendUserInput(i))},InputPointManager.prototype.forceGDIRedraw=function(e){this.forceGDICursorRedrawImpl(!1,e)},InputPointManager.prototype.updateTrackers=function(e){if(clientSideTrackersHolder)for(var t in clientSideTrackersHolder){var i;clientSideTrackersHolder.hasOwnProperty(t)&&clientSideTrackersHolder[t]&&((i=this.getOptions()).m_XeMyDocument=e,clientSideTrackersHolder[t].update(i,e.getXeInputPointManager().getHitTestInfo()))}},InputPointManager.prototype.mobileGestureProc=function(e,t){t.IsTouchEvent()&&(t.IsGesturePinch()&&this.doZoom(e,t.GetGesturePinchScaleFactor()),e.getXeDocument().getXeGsDevice().setPan(t.IsGesturePan()))},InputPointManager.prototype.CFxUI_ButtonType_Enum={eClick:0,eShiftClick:1,eCtrlClick:2,eCtrlShiftClick:3},InputPointManager.prototype.getPanMouseWCSPoint=function(e,t){var i,r;return!!(t=t||e.getXeGsDevice().getZoomPanViewport())&&(i=[0,0],(i=(r=e.getXeInputPointManager())?[r.getHitTestInfo().GetMousePosition().x,r.getHitTestInfo().GetMousePosition().y]:i)[1]=e.getXeGsDevice().getPixelHeight()-i[1],i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),r.getInputPointManager().PointToWCS(t,i))},InputPointManager.prototype.mouseInputProc=function(r,e){var t,i,n,o,a,s,c=e;c.IsMouseEvent()&&(s=(t=r.getXeDocument()).getXeDatabase(),i=t.getXeGsDevice(),r.mouseInputProc.actions||(r.mouseInputProc.actions={},r.mouseInputProc.actions.timeouts={},r.mouseInputProc.actions.removeActions=function(){for(var e in r.mouseInputProc.actions.removeActions.cache)r.mouseInputProc.actions.removeActions.cache[e]&&window.XeActiveTrackers.RemoveActiveTracker(e);r.mouseInputProc.actions.removeActions.cache={}},r.mouseInputProc.actions.removeActions.cache={},r.mouseInputProc.actions.lmb={},r.mouseInputProc.actions.mmb={},r.mouseInputProc.actions.rmb={position:{x:0,y:0},bIgnoreRightButtonUp:!1,bIgnoreRightButtonUpTimeout:0},r.mouseInputProc.actions.setPan=function(e,t){r.mouseInputProc.actions.setPan._pan||(r.mouseInputProc.actions.setPan._pan=e=>{window.XeActiveTrackers.SetActiveTracker("CFxPanZoomTracker",{active:!0,trackertype:0,zoomwindow:0}),r.mouseInputProc.actions.removeActions.cache.CFxPanZoomTracker=!0,r.getXeDocument().getXeGsDevice().setPan(!0,e)});var i=r.mouseInputProc.actions.setPan._pan;r.mouseInputProc.actions.removeActions(),r.mouseInputProc.actions.setPan.clearTimeout(),e?i():r.mouseInputProc.actions.timeouts.pan=setTimeout(i,XeDoubleClickWatcher.prototype.DblTimeoutTime,t)},r.mouseInputProc.actions.setPan.clearTimeout=function(){r.getXeDocument().getXeGsDevice().setPan(!1,!0),clearTimeout(r.mouseInputProc.actions.timeouts.pan),r.mouseInputProc.actions.timeouts.pan=0}),n=window.getXeApplication().getXeUI(),a=o=!1,(s=s.getCMDNAMES()||[]).length&&(o=-1<s[s.length-1].indexOf("_PAN")),e.IsMouseWheel()?this.doZoom(r,e.GetWheelOrientation()*e.GetWheelDelta()):e.IsLeftMouseButtonPressed()?(i.setPan(o),!o&&s.length&&-1<s[s.length-1].indexOf("_ZOOM")&&(s=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker"))&&s.trackertype===PanZoomTracker.prototype.TrackerType.eZoom&&(a=r.doDynamicZoom(r,e))):e.IsLeftButtonUp()?o&&i.setPan(!1):e.IsMiddleButtonDown()?c.IsShiftPressed()&c.IsCtrlPressed()?n.ProcessMouseClick(3,r.CFxUI_ButtonType_Enum.eCtrlShiftClick):c.IsShiftPressed()?n.ProcessMouseClick(3,r.CFxUI_ButtonType_Enum.eShiftClick):c.IsCtrlPressed()?n.ProcessMouseClick(3,r.CFxUI_ButtonType_Enum.eCtrlClick):r.mouseInputProc.actions.setPan(!1,r.getPanMouseWCSPoint(t)):c.IsMouseMoved()?(!c.IsMiddleMouseButtonPressed()||c.IsShiftPressed()||i.getPan()||r.mouseInputProc.actions.setPan(!0),i.getPan()||r.mouseInputProc.actions.removeActions()):e.IsMiddleButtonUp()?(r.mouseInputProc.actions.removeActions(),r.mouseInputProc.actions.setPan.clearTimeout()):e.IsRightButtonDown()?(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp=!1,r.mouseInputProc.actions.rmb.position.x=e.GetMousePosition().x,r.mouseInputProc.actions.rmb.position.y=e.GetMousePosition().y,e.IsShiftPressed()&e.IsCtrlPressed()?(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp=!0,n.ProcessMouseClick(2,r.CFxUI_ButtonType_Enum.eCtrlShiftClick)):e.IsShiftPressed()?(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp=!0,n.ProcessMouseClick(2,r.CFxUI_ButtonType_Enum.eShiftClick)):e.IsCtrlPressed()&&(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp=!0,n.ProcessMouseClick(2,r.CFxUI_ButtonType_Enum.eCtrlClick)),r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp||(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout&&clearTimeout(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout),r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout=setTimeout(function(){r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp=!0,r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout=0,r.mouseInputProc.actions.setPan(!0)},XeDoubleClickWatcher.prototype.DblTimeoutTime))):e.IsRightButtonUp()?(r.mouseInputProc.actions.removeActions(),r.mouseInputProc.actions.setPan.clearTimeout(),r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout&&clearTimeout(r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout),r.mouseInputProc.actions.rmb.bIgnoreRightButtonUpTimeout=0,!r.mouseInputProc.actions.rmb.bIgnoreRightButtonUp&&Math.abs(r.mouseInputProc.actions.rmb.position.x-e.GetMousePosition().x)<5&&Math.abs(r.mouseInputProc.actions.rmb.position.y-e.GetMousePosition().y)<5&&(window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker")?0:n.ShowRmbGAMenu({x:Math.floor(e.GetMousePosition().x),y:Math.floor(e.GetMousePosition().y)}))):e.IsMiddleButtonDoubleClick()&&(r.mouseInputProc.actions.removeActions(),r.mouseInputProc.actions.setPan.clearTimeout(),t.RunCmd("'._ZOOM\n_FIT\n")),r.m_bDynamicZoomDone!==a)&&(r.m_bDynamicZoomDone=a,t.getXeInputPointManager().sendViewStateToServer(t))},InputPointManager.prototype.doDynamicZoom=function(e,t){var i=e.getXeDocument().getXeGsDevice().getPixelHeight();return 0<i&&(this.doZoom(e,this.getDynamicZoomFactor()*(this.getMouseDownDCPoint().y-t.GetMousePosition().y)/i,!0),this.setMouseDownDCPoint(t.GetMousePosition().x,t.GetMousePosition().y),!0)},InputPointManager.prototype.getXenonZoomScaleFactor=function(){return 300},InputPointManager.prototype.getDynamicZoomFactor=function(){return 5},InputPointManager.prototype.calculateZoomFactor=function(e,t){return"Mac OS X"===window.XeUtils.UserAgentDetector.os?Math.pow(2,t/6):(e=Math.abs(t)*(e.getXeDatabase().getZOOMFACTOR()/InputPointManager.prototype.getXenonZoomScaleFactor()),0<t?1/(1-e):1-e)},InputPointManager.prototype.checkForZoomConstraint=function(e){return!0},InputPointManager.prototype.resetZoomStateTimeout=100,InputPointManager.prototype.doZoom=function(e,t,i){var r,n,o,a,s=e.getXeDocument(),c=s.getXeInputPointManager(),l=s.getXeGsDevice(),d=l.getZoomPanViewport();t&&e&&d&&(InputPointManager.prototype.resetZoomStateTimer&&clearTimeout(InputPointManager.prototype.resetZoomStateTimer),l.setZoom(!0),l.invalidateScene(),l.invalidateClientTrackers(),l.invalidateClientTrackersGL(),l.invalidateSelectionScene(),e.getXeShiftPanAnimationHelper().stop(),(c=[c.getHitTestInfo().GetMousePosition().x,c.getHitTestInfo().GetMousePosition().y])[1]=l.getPixelHeight()-c[1],r=e.PointToWCS(d,c),s=Math.abs(e.calculateZoomFactor(s,t)),d.preventServerNotify(!0),t=d.getFieldWidth(),n=d.getFieldHeight(),o=d.getPosition().slice(),a=d.getTarget().slice(),d.zoom(s),l.invalidateViewports(),e.checkForZoomConstraint(d)?i||((s=e.PointToWCS(d,c).sub(r)).transformBy(d.viewingMatrix()),s=s.negate(),d.dolly(s)):(d.setFieldWidth(t),d.setFieldHeight(n),d.setTarget(a),d.setPosition(o)),d.preventServerNotify(!1),InputPointManager.prototype.resetZoomStateTimer&&clearTimeout(InputPointManager.prototype.resetZoomStateTimer),InputPointManager.prototype.resetZoomStateTimer=setTimeout(e.setZoomImpl,InputPointManager.prototype.resetZoomStateTimeout,!1),l.invalidateViewports())},InputPointManager.prototype.dropDown_scroller=!1,InputPointManager.prototype.Mouse3dConnexionHandler_onStartMotion=function(e){e.getXeInputPointManager().sendViewStateToServer(e),e.getXeInputPointManager().setDrawTrackersOff(!0)},InputPointManager.prototype.Mouse3dConnexionHandler_onStopMotion=function(e){e.getXeInputPointManager().sendViewStateToServer(e),e.getXeInputPointManager().setDrawTrackersOff(!1)},InputPointManager.prototype.Mouse3dConnexionHandler_Data=function(t,i){var r,n,o=this.getXeDocument().getXeGsDevice(),a=o.getZoomPanViewport();if(a){a.preventServerNotify(!0),this.getXeShiftPanAnimationHelper().stop();let e=!1;t&&(r=a.getFieldWidth(),n=a.getFieldHeight(),a.setFieldWidth(t[3]-t[0]),a.setFieldHeight(t[4]-t[1]),o.invalidateViewports(),this.checkForZoomConstraint(a)||(a.setFieldWidth(r),a.setFieldHeight(n)),e=!0),i&&(a.setTarget([i[0],i[1],i[2]-1]),a.setPosition(i),e=!0),e&&(o.invalidateViewports(),o.invalidateScene()),a.preventServerNotify(!1)}},InputPointManager.prototype.onKeyUpHandler=function(e,t){var i=window.XeActiveTrackers.TrackerData("CFxOrbitTracker"),i=(i&&i.isTransparent&&clientSideTrackersHolder.CFxOrbitTracker.cancelCmd(),e.getXeDocument().getXeInputPointManager());null!=i&&null!=i.ProcessKeyUp&&i.ProcessKeyUp(t)},InputPointManager.prototype.onKeyPressHandler=function(e,t){},InputPointManager.prototype.onKeyDownHandlerBase=function(e,t){var i,r,n,o,a,s,c;return!!e&&(e.getXeDocument(),c=!0,38!=(i=t.keyCode||t.charCode)&&40!=i||(r=document.getElementsByClassName("font-combobox-menu")[0])&&(n=r.firstChild.offsetHeight,o=r.firstChild.classList.contains("active"),r.children[3].classList.contains("active")&&(this.dropDown_scroller=!0),o&&(this.dropDown_scroller=!1),40==i&&this.dropDown_scroller&&(r.scrollTop+=n),38==i)&&(r.scrollTop-=n),27===i&&(e.getXeDocument().getXeInputPointManager().CancelCurrentCommand(),(o=document.getElementById("pop-up-menu-ga-blocker"))&&o.parentNode.removeChild(o),0<document.getElementsByClassName("autocomplete").length)&&document.getElementsByClassName("autocomplete")[0].remove(),!("Enter"!==t.key||!XeCommonData.GripManager().HandleEnterKey(t))||(!0===(!(-1<navigator.platform.toLowerCase().indexOf("mac"))&&t.ctrlKey||t.metaKey)&&(/INPUT|SELECT|TEXTAREA/i.test(t.target.tagName)||window.CFxUI.css_helper.hasStyleClass(t.target,"XeRichTextEdit")&&"true"===t.target.contentEditable?90!==i&&89!==i||(c=!1):(90!==i&&89!==i||t.preventDefault(),c=!0)),!t.shiftKey||"F3"!==t.key&&"F7"!==t.key&&"F8"!==t.key&&"F10"!==t.key&&"F11"!==t.key||(t.preventDefault(),c=!0),r=noteEditorHandler&&noteEditorHandler.isNoteEditorActive(),n=window.getXeApplication().getXeUI().FocusInGraphicsArea(),o=e.getXeDocument().getXeInputPointManager().getInsideCommand(),a=window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker"),s=e.getXeDocument().getViewMode(),!n||46!==i&&8!==i||(c=!!r||(a||o||s||window.CFxUI.getCXeShortcutsManager().isDeleteShortcut(window.XeUtils.getXeCommonKeyboardString(t))&&0<e.getXeDocument().getXeMainSelectionSet().getHandles().length&&e.getXeDocument().cmdERASE(),!1)),(t.ctrlKey||t.metaKey)&&t.shiftKey&&67===t.keyCode&&t.preventDefault(),!c))},InputPointManager.prototype.onKeyDownHandler=function(e,t){return this.onKeyDownHandlerBase(e,t)},InputPointManager.prototype.connectWPopupMenuEvents=function(){let a=this;document.addEventListener("on::WPopupMenu::show",function(e){try{var i=a.getXeDocument();let t=i.getXeInputPointManager();var r=XeCommonData.GripManager().MenuManager(),n=XeGripMenu.MenuTypes;if((!r.IsOpened()||r.MenuType()!==n.Hover)&&(!document.getElementById("pop-up-menu-ga-blocker")&&!t.getInsideCommand())){let e=document.createElement("canvas");var o=document.getElementById(i.getGLWidget());e.id="pop-up-menu-ga-blocker",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.onclick=()=>{e.parentNode.removeChild(e)},e.oncontextmenu=e=>{!1===t.getHitTestInfo().IsShiftPressed()&&XeCommonData.XeUI().ShowRmbGAMenu({x:Math.floor(e.pageX),y:Math.floor(e.pageY)})},o.parentElement.appendChild(e)}}catch(e){window.XeLogger.error(e)}});function e(e){try{var t;document.getElementById("pop-up-menu-ga-blocker")&&(t=document.getElementById("pop-up-menu-ga-blocker")).parentNode.removeChild(t)}catch(e){window.XeLogger.error(e)}}document.addEventListener("XeGripMenu.Hide",e),document.addEventListener("on::WPopupMenu::hide",e)},(e=>{function t(e){null==l&&(l=new Array(2*b)),h=!(m=-1),g=y=p=u=d=0,f=null,C=new DataView(e,0),T=0;var t,i,r=new Array(5e5);let n=void 0,o=0;for(;0<(t=((e,t,i)=>{for(var r,n=0;n<i;){if(h&&-1==m)return n;if(0<g){if(m!=X)for(;0<g&&n<i;)g--,y&=b-1,d&=b-1,e[t+n++]=l[d++]=l[y++];else{for(;0<g&&n<i;)g--,d&=b-1,L(8),e[t+n++]=l[d++]=R(8),N(8);0==g&&(m=-1)}if(n==i)return n}if(-1==m){if(h)break;L(1),0!=R(1)&&(h=!0),N(1),L(2),m=R(2),N(2),f=null,g=0}switch(m){case 0:r=V(e,t+n,i-n);break;case 1:r=(null!=f?F:B)(e,t+n,i-n);break;case 2:r=(null!=f?F:U)(e,t+n,i-n);break;default:r=-1}if(-1==r)return h?0:-1;n+=r}return n})(r,0,r.length));){var a=new ArrayBuffer(o+t),s=new Uint8Array(n),c=new Uint8Array(a);for(c.set(s,0),i=0;i<t;i++)c[o+i]=r[i];n=a,o+=t}return C=null,n}var l,d,a,s,c,u,p,m,h,g,y,f,_,w,v,C,T,b=32768,X=0,S=9,P=6,D=null,i=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),x=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),O=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),G=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),E=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),A=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),I=function(){this.next=null,this.list=null},k=function(){this.e=0,this.b=0,this.n=0,this.t=null},M=function(e,t,i,r,n,o){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;for(var a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C=new Array(this.BMAX+1),T=new Array(this.BMAX+1),b=new k,X=new Array(this.BMAX),S=new Array(this.N_MAX),P=new Array(this.BMAX+1),D=this.root=null,x=0;x<C.length;x++)C[x]=0;for(x=0;x<T.length;x++)T[x]=0;for(x=0;x<X.length;x++)X[x]=null;for(x=0;x<S.length;x++)S[x]=0;for(x=0;x<P.length;x++)P[x]=0;for(s=256<t?e[256]:this.BMAX,m=e,h=0,x=t;C[m[h]]++,h++,0<--x;);if(C[0]==t)this.root=null,this.m=0,this.status=0;else{for(u=1;u<=this.BMAX&&0==C[u];u++);for(o<(p=u)&&(o=u),x=this.BMAX;0!=x&&0==C[x];x--);for((l=x)<o&&(o=x),_=1<<u;u<x;u++,_<<=1)if((_-=C[u])<0)return this.status=2,void(this.m=o);if((_-=C[x])<0)this.status=2,this.m=o;else{for(C[x]+=_,P[1]=u=0,m=C,h=1,f=2;0<--x;)P[f++]=u+=m[h++];for(m=e,x=h=0;0!=(u=m[h++])&&(S[P[u]++]=x),++x<t;);for(t=P[l],m=S,d=-1,g=null,w=y=T[h=P[0]=x=0]=0;p<=l;p++)for(a=C[p];0<a--;){for(;p>y+T[1+d];){if(y+=T[1+d],d++,w=(w=l-y)>o?o:w,(c=1<<(u=p-y))>a+1)for(c-=a+1,f=p;++u<w&&!((c<<=1)<=C[++f]);)c-=C[f];for(w=1<<(u=s<y+u&&y<s?s-y:u),T[1+d]=u,g=new Array(w),v=0;v<w;v++)g[v]=new k;(D=null==D?this.root=new I:D.next=new I).next=null,D.list=g,X[d]=g,0<d&&(P[d]=x,b.b=T[d],b.e=16+u,b.t=g,u=(x&(1<<y)-1)>>y-T[d],X[d-1][u].e=b.e,X[d-1][u].b=b.b,X[d-1][u].n=b.n,X[d-1][u].t=b.t)}for(b.b=p-y,t<=h?b.e=99:m[h]<i?(b.e=m[h]<256?16:15,b.n=m[h++]):(b.e=n[m[h]-i],b.n=r[m[h++]-i]),c=1<<p-y,u=x>>y;u<w;u+=c)g[u].e=b.e,g[u].b=b.b,g[u].n=b.n,g[u].t=b.t;for(u=1<<p-1;0!=(x&u);u>>=1)x^=u;for(x^=u;(x&(1<<y)-1)!=P[d];)y-=T[d],d--}this.m=T[1],this.status=0!=_&&1!=l?1:0}}},r=function(){return C.byteLength==T?-1:255&C.getUint8(T++)},L=function(e){for(;p<e;)u|=r()<<p,p+=8},R=function(e){return u&i[e]},N=function(e){u>>=e,p-=e},F=function(e,t,i){var r,n,o;if(0==i)return 0;for(o=0;;){for(L(w),r=(n=f.list[R(w)]).e;16<r;){if(99==r)return-1;N(n.b),L(r-=16),r=(n=n.t[R(r)]).e}if(N(n.b),16==r){if(d&=b-1,e[t+o++]=l[d++]=n.n,o==i)return i}else{if(15==r)break;for(L(r),g=n.n+R(r),N(r),L(v),r=(n=_.list[R(v)]).e;16<r;){if(99==r)return-1;N(n.b),L(r-=16),r=(n=n.t[R(r)]).e}for(N(n.b),L(r),y=d-n.n-R(r),N(r);0<g&&o<i;)g--,y&=b-1,d&=b-1,e[t+o++]=l[d++]=l[y++];if(o==i)return i}}return m=-1,o},V=function(e,t,i){var r=7&p;if(N(r),L(16),r=R(16),N(16),L(16),r!=(65535&~u))return-1;for(N(16),g=r,r=0;0<g&&r<i;)g--,d&=b-1,L(8),e[t+r++]=l[d++]=R(8),N(8);return 0==g&&(m=-1),r},B=function(e,t,i){if(null==D){for(var r,n=new Array(288),o=0;o<144;o++)n[o]=8;for(;o<256;o++)n[o]=9;for(;o<280;o++)n[o]=7;for(;o<288;o++)n[o]=8;if(0!=(r=new M(n,288,257,x,O,s=7)).status)return window.alert("HufBuild error: "+r.status),-1;for(D=r.root,s=r.m,o=0;o<30;o++)n[o]=5;if(1<(r=new M(n,30,0,G,E,c=5)).status)return D=null,window.alert("HufBuild error: "+r.status),-1;a=r.root,c=r.m}return f=D,_=a,w=s,v=c,F(e,t,i)},U=function(e,t,i){for(var r,n,o,a,s,c,l,d,u=new Array(316),p=0;p<u.length;p++)u[p]=0;if(L(5),c=257+R(5),N(5),L(5),l=1+R(5),N(5),L(4),s=4+R(4),N(4),286<c||30<l)return-1;for(r=0;r<s;r++)L(3),u[A[r]]=R(3),N(3);for(;r<19;r++)u[A[r]]=0;if(0!=(d=new M(u,19,19,null,null,w=7)).status)return-1;for(f=d.root,w=d.m,o=c+l,p=n=0;p<o;)if(L(w),r=(a=f.list[R(w)]).b,N(r),(r=a.n)<16)u[p++]=n=r;else if(16==r){if(L(2),r=3+R(2),N(2),o<p+r)return-1;for(;0<r--;)u[p++]=n}else{if(17==r){if(L(3),r=3+R(3),N(3),o<p+r)return-1}else if(L(7),r=11+R(7),N(7),o<p+r)return-1;for(;0<r--;)u[p++]=0;n=0}if(d=new M(u,c,257,x,O,w=S),0==w&&(d.status=1),0!=d.status&&1==d.status)return-1;for(f=d.root,w=d.m,p=0;p<l;p++)u[p]=u[p+c];return d=new M(u,l,0,G,E,v=P),_=d.root,0==(v=d.m)&&257<c||0!=d.status?-1:F(e,t,i)};e&&(e.JSDeflate||(e.JSDeflate={}),e.JSDeflate.unzip=t)})(this),(e=>{function t(e){null==a&&(a=new Array(2*b)),h=!(m=-1),g=y=p=u=s=0,f=null,C=e,T=0;for(var t,i=new Array(1024),r=[];0<(t=((e,t,i)=>{for(var r,n=0;n<i;){if(h&&-1==m)return n;if(0<g){if(m!=X)for(;0<g&&n<i;)g--,y&=b-1,s&=b-1,e[t+n++]=a[s++]=a[y++];else{for(;0<g&&n<i;)g--,s&=b-1,L(8),e[t+n++]=a[s++]=R(8),N(8);0==g&&(m=-1)}if(n==i)return n}if(-1==m){if(h)break;L(1),0!=R(1)&&(h=!0),N(1),L(2),m=R(2),N(2),f=null,g=0}switch(m){case 0:r=V(e,t+n,i-n);break;case 1:r=(null!=f?F:B)(e,t+n,i-n);break;case 2:r=(null!=f?F:U)(e,t+n,i-n);break;default:r=-1}if(-1==r)return h?0:-1;n+=r}return n})(i,0,i.length));){for(var n=new Array(t),o=0;o<t;o++)n[o]=String.fromCharCode(i[o]);r[r.length]=n.join("")}return C=null,r.join("")}var a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b=32768,X=0,S=9,P=6,D=null,i=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),x=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),O=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),G=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),E=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),A=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),I=function(){this.next=null,this.list=null},k=function(){this.e=0,this.b=0,this.n=0,this.t=null},M=function(e,t,i,r,n,o){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;for(var a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C=new Array(this.BMAX+1),T=new Array(this.BMAX+1),b=new k,X=new Array(this.BMAX),S=new Array(this.N_MAX),P=new Array(this.BMAX+1),D=this.root=null,x=0;x<C.length;x++)C[x]=0;for(x=0;x<T.length;x++)T[x]=0;for(x=0;x<X.length;x++)X[x]=null;for(x=0;x<S.length;x++)S[x]=0;for(x=0;x<P.length;x++)P[x]=0;for(s=256<t?e[256]:this.BMAX,m=e,h=0,x=t;C[m[h]]++,h++,0<--x;);if(C[0]==t)this.root=null,this.m=0,this.status=0;else{for(u=1;u<=this.BMAX&&0==C[u];u++);for(o<(p=u)&&(o=u),x=this.BMAX;0!=x&&0==C[x];x--);for((l=x)<o&&(o=x),_=1<<u;u<x;u++,_<<=1)if((_-=C[u])<0)return this.status=2,void(this.m=o);if((_-=C[x])<0)this.status=2,this.m=o;else{for(C[x]+=_,P[1]=u=0,m=C,h=1,f=2;0<--x;)P[f++]=u+=m[h++];for(m=e,x=h=0;0!=(u=m[h++])&&(S[P[u]++]=x),++x<t;);for(t=P[l],m=S,d=-1,g=null,w=y=T[h=P[0]=x=0]=0;p<=l;p++)for(a=C[p];0<a--;){for(;p>y+T[1+d];){if(y+=T[1+d],d++,w=(w=l-y)>o?o:w,(c=1<<(u=p-y))>a+1)for(c-=a+1,f=p;++u<w&&!((c<<=1)<=C[++f]);)c-=C[f];for(w=1<<(u=s<y+u&&y<s?s-y:u),T[1+d]=u,g=new Array(w),v=0;v<w;v++)g[v]=new k;(D=null==D?this.root=new I:D.next=new I).next=null,D.list=g,X[d]=g,0<d&&(P[d]=x,b.b=T[d],b.e=16+u,b.t=g,u=(x&(1<<y)-1)>>y-T[d],X[d-1][u].e=b.e,X[d-1][u].b=b.b,X[d-1][u].n=b.n,X[d-1][u].t=b.t)}for(b.b=p-y,t<=h?b.e=99:m[h]<i?(b.e=m[h]<256?16:15,b.n=m[h++]):(b.e=n[m[h]-i],b.n=r[m[h++]-i]),c=1<<p-y,u=x>>y;u<w;u+=c)g[u].e=b.e,g[u].b=b.b,g[u].n=b.n,g[u].t=b.t;for(u=1<<p-1;0!=(x&u);u>>=1)x^=u;for(x^=u;(x&(1<<y)-1)!=P[d];)y-=T[d],d--}this.m=T[1],this.status=0!=_&&1!=l?1:0}}},r=function(){return C.length==T?-1:255&C.charCodeAt(T++)},L=function(e){for(;p<e;)u|=r()<<p,p+=8},R=function(e){return u&i[e]},N=function(e){u>>=e,p-=e},F=function(e,t,i){var r,n,o;if(0==i)return 0;for(o=0;;){for(L(w),r=(n=f.list[R(w)]).e;16<r;){if(99==r)return-1;N(n.b),L(r-=16),r=(n=n.t[R(r)]).e}if(N(n.b),16==r){if(s&=b-1,e[t+o++]=a[s++]=n.n,o==i)return i}else{if(15==r)break;for(L(r),g=n.n+R(r),N(r),L(v),r=(n=_.list[R(v)]).e;16<r;){if(99==r)return-1;N(n.b),L(r-=16),r=(n=n.t[R(r)]).e}for(N(n.b),L(r),y=s-n.n-R(r),N(r);0<g&&o<i;)g--,y&=b-1,s&=b-1,e[t+o++]=a[s++]=a[y++];if(o==i)return i}}return m=-1,o},V=function(e,t,i){var r=7&p;if(N(r),L(16),r=R(16),N(16),L(16),r!=(65535&~u))return-1;for(N(16),g=r,r=0;0<g&&r<i;)g--,s&=b-1,L(8),e[t+r++]=a[s++]=R(8),N(8);return 0==g&&(m=-1),r},B=function(e,t,i){if(null==D){for(var r,n=new Array(288),o=0;o<144;o++)n[o]=8;for(;o<256;o++)n[o]=9;for(;o<280;o++)n[o]=7;for(;o<288;o++)n[o]=8;if(0!=(r=new M(n,288,257,x,O,l=7)).status)return window.alert("HufBuild error: "+r.status),-1;for(D=r.root,l=r.m,o=0;o<30;o++)n[o]=5;if(1<(r=new M(n,30,0,G,E,d=5)).status)return D=null,window.alert("HufBuild error: "+r.status),-1;c=r.root,d=r.m}return f=D,_=c,w=l,v=d,F(e,t,i)},U=function(e,t,i){for(var r,n,o,a,s,c,l,d,u=new Array(316),p=0;p<u.length;p++)u[p]=0;if(L(5),c=257+R(5),N(5),L(5),l=1+R(5),N(5),L(4),s=4+R(4),N(4),286<c||30<l)return-1;for(r=0;r<s;r++)L(3),u[A[r]]=R(3),N(3);for(;r<19;r++)u[A[r]]=0;if(0!=(d=new M(u,19,19,null,null,w=7)).status)return-1;for(f=d.root,w=d.m,o=c+l,p=n=0;p<o;)if(L(w),r=(a=f.list[R(w)]).b,N(r),(r=a.n)<16)u[p++]=n=r;else if(16==r){if(L(2),r=3+R(2),N(2),o<p+r)return-1;for(;0<r--;)u[p++]=n}else{if(17==r){if(L(3),r=3+R(3),N(3),o<p+r)return-1}else if(L(7),r=11+R(7),N(7),o<p+r)return-1;for(;0<r--;)u[p++]=0;n=0}if(d=new M(u,c,257,x,O,w=S),0==w&&(d.status=1),0!=d.status&&1==d.status)return-1;for(f=d.root,w=d.m,p=0;p<l;p++)u[p]=u[p+c];return d=new M(u,l,0,G,E,v=P),_=d.root,0==(v=d.m)&&257<c||0!=d.status?-1:F(e,t,i)};e&&(e.JSDeflate||(e.JSDeflate={}),e.JSDeflate.inflate=t)})(this),function(){String.prototype.format||(String.prototype.format=function(){var i=arguments;return this.replace(/\{(\d+)\}/g,function(e,t){return void 0!==i[t]?i[t]:e})});function l(e){this.m_str=e,this.increment=function(){this.m_str=this.m_str.substr(1)}}var d={kDegrees:0,kDegMinSec:1,kGrads:2,kRadians:3,kSurveyors:4},m=1,h=2,g=3,y=4,f=5,_={kSuppressesZeroFeetAndPreciselyZeroInches:0,kIncludesZeroFeetAndPreciselyZeroInches:1,kIncludesZeroFeetAndSuppressesZeroInches:2,kIncludesZeroInchesAndSuppressesZeroFeet:3,kSuppressesLeadingZeros:4,kSuppressesTrailingZeros:8,kSuppressesBothLeadingAndTrailingZeros:12},w={RTERROR:"undefined",RTNORM:"ok"};Number.prototype.toFixedNumber=function(e,t){t=Math.pow(t||10,e);return Math.round(this*t)/t};var a=3.141592653589793,u=a+a;function p(e){return e/a*180}function v(e,t,i){switch(t){case"E":case"e":return e.toExponential(i);case"f":return e.toFixedNumber(i);case"G":case"g":return void window.XeLogger.error("odFltToG: called")}return 0}function C(e,t,i,r){0<=t&&(n=Math.pow(.1,t),c=Math.pow(.1,Math.max(9,t+1)),c=(e+c)/n,o=Math.floor(c),e=(.5<=c-o?o+1:o)*n);var n,o,a=v(Math.abs(e),"f",t),s=a.length,c=0;if(i&_.kSuppressesTrailingZeros&&0<t){for(;"0"===a[s-1];)--s;"."===a[s-1]&&--s}return i&_.kSuppressesLeadingZeros&&e<1&&1<s&&"0"===a[c]&&(++c,--s),s!==a.length&&(a=a.substr(c,s)),r&&"."!==r&&a.replace(".",r),a=e<0?"-"+a:a}function T(e){return(e%=u)<0&&(e+=u),e}function s(e,t,i,r,n,o){var a,s,c="",l="",d=!0,u=0;switch(e<0&&(c+="-",e=-e),t){case m:break;case h:9999999999999998<e&&(t=m);break;case y:25769803776-1/(1<<i)<e&&(t=m);break;case g:25769803775<e&&(t=m);break;case f:2147483647<e&&(t=m);break;default:t=9999999999999998<e?m:h}switch(t){case m:"0"===(c+=v(e,"E",i))[c.length-3]&&c.deleteChars(c.getLength()-3);break;case h:c+=C(e,i,r,o);break;case y:var p=1<<i;e=~~(e*p+.5)/p;case g:var p=r===_.kIncludesZeroFeetAndPreciselyZeroInches||r===_.kIncludesZeroFeetAndSuppressesZeroInches;e-=12*(u=~~(e/12)),(0<u||p)&&(c+=l="{0}'".format(u),u=1,d=r===_.kIncludesZeroFeetAndPreciselyZeroInches||r===_.kIncludesZeroInchesAndSuppressesZeroFeet);case f:t===y||t===f?(a=(p=((e,t)=>{for(var i=1<<t,r=~~(((e=~~(e*i+.5)/i)-(t=~~Math.floor(e)))*i);r%2==0&&0!==r;)r/=2,i/=2;return[t,r,i]})(e,i))[0],s=p[1],p=p[2],(a||s||d)&&(!n&&u&&(c+="-"),c+=l=a.toString(),s&&(c=(c+=n?"-":" ")+(l="{0}/{1}".format(s,p))),t===y)&&(c+='"')):(!n&&u&&(c+="-"),c+=l=C(e,i,r,o),l.length&&(c+='"'))}return c}this.getOda2PIinRad=function(){return u};var b=function(e){return"+"===e.m_str[0]&&e.increment(),"-"===e.m_str[0]&&(e.increment(),!0)},X=function(e){return"0"<=e&&e<="9"},S=function(e){var t=0;if(!X(e.m_str[0]))return w.RTERROR;for(;X(e.m_str[0]);)t=10*t+(e.m_str[0]-"0"),e.increment();return t},P=function(e){var t=0;if("."!=e.m_str[0]&&(t=S(e))===w.RTERROR)return w.RTERROR;if("."===e.m_str[0]){e.increment();for(var i=10;X(e.m_str[0]);)t+=(e.m_str[0]-"0")/i,i*=10,e.increment()}if("e"===e.m_str[0]||"E"===e.m_str[0]){e.increment();var r=b(e);if(e.m_str[0]&&X(e.m_str[0])){var n=S(e);if(n===w.RTERROR)return w.RTERROR;t*=Math.pow(10,(r?-1:1)*n)}}return t};function c(e){var t=P(e);if(t==w.RTERROR)return w.RTERROR;if(("d"===e.m_str[0]||"D"===e.m_str[0])&&(e.increment(),e.m_str[0])){var i=P(e);if(i==w.RTERROR)return t;if("'"===e.m_str[0]){if(e.increment(),t+=i/60,e.m_str[0]&&"E"!=e.m_str[0]){var r=P(e);if(r===w.RTERROR)return w.RTERROR;if(t+=r/3600,'"'!=e.m_str[0])return w.RTERROR;e.increment()}}else'"'===e.m_str[0]&&(e.increment(),t+=i/3600)}return t}function D(e,t){for(var i,r,n=new l(e);" "===n.m_str[0];)n.increment();e=n.m_str[0];if("+"!==e&&"-"!==e||n.increment(),(i=P(n))===w.RTERROR)return w.RTERROR;if(n.m_str[0]){if(!t)return-1;if('"'===n.m_str[0])n.increment();else{var t=0,o=0,a=0,s=0;if("'"===n.m_str[0]){if(n.increment(),n.m_str[0]){" "!==n.m_str[0]&&"-"!==n.m_str[0]||n.increment();var c=((e,t,i)=>{var r=0;if("."!=e.m_str[0]&&(r=S(e))==w.RTERROR)return w.RTERROR;if("."===e.m_str[0]){e.increment();for(var t=t&&!0,n=10;X(e.m_str[0]);)r+=(e.m_str[0]-"0")/n,n*=10,e.increment()}if("e"===e.m_str[0]||"E"===e.m_str[0]){e.increment();var o,i=i&&!0,a=b(e);if(e.m_str[0]&&X(e.m_str[0])){if((o=S(e))==w.RTERROR)return o;r*=Math.pow(10,(a?-1:1)*o)}}return[r,t,i]})(n,!1,!1),o=c[0],c=c[1]||c[2];if("/"===n.m_str[0]){if(n.increment(),c)return-1;if(a=o,o=0,(r=S(n))===w.RTERROR)return w.RTERROR;if(s=r,GeNeo.OdZero(s,1e-10)||s<0||s<=a||a<0)return-1}else if(" "===n.m_str[0]||"-"===n.m_str[0]){if(n.increment(),a=S(n),"/"!=n.m_str[0])return-1;if(n.increment(),s=r=S(n),GeNeo.OdZero(s,1e-10)||s<0||s<=a||a<0||c)return-1}if(12<=o)return-1;'"'===n.m_str[0]&&n.increment()}if(!(GeNeo.OdZero((i%1).toFixedNumber(6),1e-10)||GeNeo.OdZero(o,1e-10)&&GeNeo.OdZero(a,1e-10)&&GeNeo.OdZero(s,1e-10)))return-1;t=12*i}else if("/"===n.m_str[0]){if(n.increment(),(a=i)<0||!GeNeo.OdZero((a%1).toFixedNumber(6),1e-10))return-1;if(s=r=S(n),GeNeo.OdZero(s,1e-10)||s<0)return-1;'"'===n.m_str[0]&&n.increment()}else if(" "===n.m_str[0]||"-"===n.m_str[0]){if(n.increment(),o=i,a=S(n),"/"!=n.m_str[0])return-1;if(n.increment(),s=r=S(n),GeNeo.OdZero(s,1e-10)||s<0||s<=a||a<0)return-1;'"'===n.m_str[0]&&n.increment()}i=t+o,GeNeo.OdZero(s,1e-10)||(i+=a/s)}}return"-"===e&&(i=-i),0!=n.m_str.length||"NaN"===Number(i)||i===1/0||1e100<=Math.abs(i)?-1:i}function x(e){for(var t=new l(e),i=!1;;t.increment()){switch(t.m_str[0]){case"-":i=!i;continue;case"+":case" ":continue}break}var r,n,o=0;switch(t.m_str[0]){case"e":case"E":if(r=0,t.increment(),t.m_str[0])return w.RTERROR;break;case"n":case"N":if(r=90,t.increment(),0!==t.m_str[0]&&void 0!==t.m_str[0]){if(" "===t.m_str[0]&&t.increment(),(n=c(t))===w.RTERROR)return w.RTERROR;switch(o+=n," "===t.m_str[0]&&t.increment(),t.m_str[0]){case"e":case"E":t.increment(),r-=o;break;case"w":case"W":t.increment(),r+=o;break;default:return w.RTERROR}}break;case"w":case"W":if(r=180,t.increment(),t.m_str[0])return w.RTERROR;break;case"s":case"S":if(r=270,t.increment(),0!=t.m_str[0]){if(" "===t.m_str[0]&&t.increment(),(n=c(t))==w.RTERROR)return w.RTERROR;switch(o+=n," "===t.m_str[0]&&t.increment(),t.m_str[0]){case"e":case"E":t.increment(),r+=o;break;case"w":case"W":t.increment(),r-=o;break;default:return w.RTERROR}}break;default:if((r=c(t))===w.RTERROR)return w.RTERROR}switch(" "===t.m_str[0]&&t.increment(),t.m_str[0]){case void 0:case"d":case"D":r=r/180*a;break;case"g":case"G":r=r/200*a;break;case"r":case"R":break;default:return w.RTERROR}return r=r/u%1*u,r=i?u-r:r}this.RealToString=function(e,t,i,r,n){n=void 0!==n?n:-1;var o=e.getXeDatabase().getLUNITS(),a=e.getXeDatabase().getLUPREC(),n=-1!==n?n:e.getXeDatabase().getDIMZIN(),e=e.getXeDatabase().getUNITMODE(),i=0<i?i:o,o=0<=r?r:a;return s(t=t<0&&(r=Math.log(Math.abs(t))/Math.LN10)<0&&Math.abs(r)>o+1?Math.abs(t):t,i,o,n,e)},this.additionalRealFormatting=function(e){var t=e;return"."===e.charAt(0)?t="0"+e:"-."===e.substr(0,2)&&(t="-0."+e.substr(2,e.length()-2)),t},this.StringToReal=function(e,t,i,r){r=void 0===r||r;t=this.additionalRealFormatting(t);if(i){for(var i=t,n=0,o=new l(i);" "===o.m_str[0];)o.increment();if("+"!==(i=o.m_str[0])&&"-"!==i||o.increment(),(n=P(o))===w.RTERROR)return w.RTERROR;if(o.m_str[0]){if("'"===o.m_str[0]||'"'===o.m_str[0])return w.RTERROR;if(" "!==o.m_str[0]&&"-"!==o.m_str[0]||o.increment(),"/"===o.m_str[0]){o.increment();var a=S(o);if(a===w.RTERROR)return w.RTERROR;if(GeNeo.OdZero(a,1e-10)||a<0)return w.RTERROR;n/=a}else if(o.m_str[0]){var s,a=0,c=n;if((c=P(o))===w.RTERROR)return w.RTERROR;if((" "===o.m_str[0]||"-"===o.m_str[0])&&(o.increment(),a=c,(c=P(o))===w.RTERROR))return w.RTERROR;if("/"===o.m_str[0]){if(o.increment(),(s=S(o))===w.RTERROR)return w.RTERROR;if(GeNeo.OdZero(s,1e-10)||s<0)return w.RTERROR;a+=c/s}else a=c;if(n+=a,o.m_str[0])return w.RTERROR}}return n="-"==i?-n:n}return D(t,r)},this.StringToAngle=function(e,t,i,r,n){var o=0,a=0,s=0;try{o=-1!=i?i:e.getXeDatabase().getAUNITS(),a=n?0:e.getXeDatabase().getANGDIR(),s=n?0:e.getXeDatabase().getANGBASE()}catch(e){return w.RTERROR}var c=this.additionalRealFormatting(t);if(-1!=o&&-1==t.search(/[dDgGrRNSEW]/))switch(o){case 0:-1==t.search(/[dD]/)&&(c+="d");break;case 1:break;case 2:-1==t.search(/[gG]/)&&(c+="g");break;case 3:-1==t.search(/[rR]/)&&(c+="r");break;case 4:break;default:return w.RTERROR}i=x(c);return i!==w.RTERROR?(n=i,e=s,T(a?u-n+e:n+e)):i},this.PointToString=function(e,t,i,r,n,o,a){var s,c,l;return void 0===o&&(o=","),void 0===a&&(a=!1),i?(i=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),c=Math.atan2(t.y,t.x),l=e.getXeDatabase().getANGDIR(),s=Math.abs(p(e.getXeDatabase().getANGBASE())),0===l?c+=this.OdaPI:1===l&&(c=-c+this.OdaPI),360<=(c=p(c))?c-=360:c<0&&(c+=360),0===l?c<s?c=360-s+c:c-=s:360-s<c?c=s-(360-c):c+=s,360<=c?c-=360:c<0&&(c+=360),l=this.RealToString(e,i,r,n),s=this.RealToString(e,c,r,n),(a?"{0}< {1}":"({0}< {1})").format(l,s)):(i=this.RealToString(e,t.x,r,n,0),c=this.RealToString(e,t.y,r,n,0),l=this.RealToString(e,t.z,r,n,0),(a?"{0}{1}{2}{3}{4}":"({0}{1}{2}{3}{4})").format(i,o,c,o,l))},this.IntToString=function(e,t){return t.toString()},this.StringToInt=function(e,t){var i=0,i=2<t.length&&"0"===t.charAt(0)&&("X"===t.charAt(1)||"x"===t.charAt(1))?parseInt(t,16):parseInt(t,10);return isNaN(i.toString())?"":i},this.AngleToString=function(e,t,i,r,n,o){var a,s,c,l,d,u,p=[],e=e.getXeDatabase();try{a=o?0:e.getANGBASE(),s=o?0:e.getANGDIR(),c=0<=i?i:e.getAUNITS(),l=0<=r?r:e.getAUPREC(),d=-1!=n?n:e.getDIMZIN(),u=e.getUNITMODE()}catch(e){return w.RTERROR}o=t,i=a,t=T(s?i-o:o-i);try{p=DbWasm.OdDbUnitsFormatter.formatA(t,c,l,d,u,0)}catch(e){return w.RTERROR}return p},this.OrientToString=function(e,t,i,r,n){var o,a,s,c,l,d,u=[],e=e.getXeDatabase();try{o=e.getANGBASE(),a=e.getANGDIR(),s=0<i?i:e.getAUNITS(),c=0<=r?r:e.getAUPREC(),l=-1!=n?n:e.getDIMZIN(),d=e.getUNITMODE()}catch(e){return w.RTERROR}i=t,r=o,t=T(a?r-i:i-r);try{u=DbWasm.OdDbUnitsFormatter.formatA(t,s,c,l,d,0)}catch(e){return w.RTERROR}return u[0].m_pData},this.StringToOrient=function(e,t,i){var r=0,n=0,o=0,e=e.getXeDatabase();try{r=-1!=i?i:e.getAUNITS(),n=e.getANGDIR(),o=e.getANGBASE()}catch(e){return w.RTERROR}var a=t;if(-1!=r)switch(r){case 0:-1==t.search(/dD/)&&(a+="d");break;case 1:break;case 2:-1==t.search(/gG/)&&(a+="g");break;case 3:-1==t.search(/rR/)&&(a+="r");break;case 4:break;default:return w.RTERROR}i=x(a);if(i!==w.RTERROR)return e=i,T(o+(n?-e:e))},this.formatAngle=function(e,t,i,r,n,o){var a,s=GeNeo.OdEqual(Math.abs(i),u,1e-10),c=GeNeo.OdNegative(i,1e-10);if(s)switch(t){case d.kDegrees:a="360";break;case d.kDegMinSec:a="360d";break;case d.kGrads:a="400g";break;case d.kRadians:a=v(u,"f",e.getXeDatabase().getAUPREC()),a+="r";break;case d.kSurveyors:a="N 90d E";break;default:a=""}else i=Math.abs(i),a=this.AngleToString(e,i,t,r,n,o);return a=c?"-"+a:a}}),webGLTest=new function(){var y=this,f=(y.state={isTestStarted:!1,isTestPassed:!1,avgTime:0,fullTime:0,description:null},null),_=null,w=null,v=null,C=null,T=null;y.runTest=function(){function t(){y.state.isTestStarted=!1,y.state.isTestPassed=!1,y.state.avgTime=-1,i()}function e(){f.uniformMatrix4fv(_.pMatrixUniform,!1,T),f.uniformMatrix4fv(_.mvMatrixUniform,!1,C)}function i(){window.XeLogger.info("webGL test results",y.state),window.getXeActiveDocument().NotifyServer("RequestWebGlResultInfo",JSON.stringify({WebGlTestResult:y.state.isTestPassed}))}try{y.state.isTestStarted=!0;var r=window.glMatrixLib.mat4,n=(C=r.create(),T=r.create(),document.createElement("canvas")),o=(n.width=2e3,n.height=2e3,n.style.display="none",document.body.appendChild(n),n);try{(f=o.getContext("experimental-webgl")).viewportWidth=o.width,f.viewportHeight=o.height}catch(e){window.alert("Cannot initialize WebGL")}f||window.alert("Cannot initialize WebGL"),!0===y.state.isTestStarted&&(g=f.createShader(f.VERTEX_SHADER),f.shaderSource(g,"attribute vec3 aVertexPosition;void main(void) {  gl_Position = vec4(aVertexPosition, 1.0);}"),f.compileShader(g),f.getShaderParameter(g,f.COMPILE_STATUS)?(h=f.createShader(f.FRAGMENT_SHADER),f.shaderSource(h,"void main(void) {  gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);}"),f.compileShader(h),f.getShaderParameter(h,f.COMPILE_STATUS)?(_=f.createProgram(),f.attachShader(_,g),f.attachShader(_,h),f.linkProgram(_),f.getProgramParameter(_,f.LINK_STATUS)||t(),f.useProgram(_),_.vertexPositionAttribute=f.getAttribLocation(_,"aVertexPosition"),f.enableVertexAttribArray(_.vertexPositionAttribute),_.pMatrixUniform=f.getUniformLocation(_,"uPMatrix"),_.mvMatrixUniform=f.getUniformLocation(_,"uMVMatrix")):window.alert(f.getShaderInfoLog(h))):window.alert(f.getShaderInfoLog(g))),!0===y.state.isTestStarted&&(w=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,w),m=[0,1,0,-1,-1,0,1,-1,0],f.bufferData(f.ARRAY_BUFFER,new Float32Array(m),f.STATIC_DRAW),w.itemSize=3,w.numItems=3,v=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,v),f.bufferData(f.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),f.STATIC_DRAW),v.itemSize=3,v.numItems=4),f.clearColor(0,0,0,1),f.enable(f.DEPTH_TEST),!0===y.state.isTestStarted&&(f.viewport(0,0,f.viewportWidth,f.viewportHeight),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),(p=window.glMatrixLib.mat4).perspective(45,f.viewportWidth/f.viewportHeight,.1,100,T),p.identity(C),p.translate(C,[-1.5,0,-7]),f.bindBuffer(f.ARRAY_BUFFER,w),f.vertexAttribPointer(_.vertexPositionAttribute,w.itemSize,f.FLOAT,!1,0,0),e(),f.drawArrays(f.TRIANGLES,0,w.numItems),p.translate(C,[3,0,0]),f.bindBuffer(f.ARRAY_BUFFER,v),f.vertexAttribPointer(_.vertexPositionAttribute,v.itemSize,f.FLOAT,!1,0,0),e(),f.drawArrays(f.TRIANGLE_STRIP,0,v.numItems));for(var a=0,s=new Uint8Array(16e6),c=Date.now(),l=0;l<100;l++){var d=Date.now(),u=(f.readPixels(0,0,2e3,2e3,f.RGBA,f.UNSIGNED_BYTE,s),Date.now());if(a+=u-d,15e3<u-c){y.state.description="Timeout",y.state.isTestPassed=!1,y.state.fullTime=u-c,y.state.avgTime=y.state.fullTime/l;break}}y.state.description="Finished",y.state.fullTime=a,y.state.avgTime=a/100,y.state.isTestPassed=y.state.avgTime<=150,f.getExtension("WEBGL_lose_context")&&f.getExtension("WEBGL_lose_context").loseContext(),T=C=v=w=_=f=null,document.body.removeChild(n)}catch(e){t(e.message)}var p,m,h,g;i()}},XeActiveTrackers=function(){this.SetActiveTracker=function(e,t){window.getXeActiveDocument().getXeTrackers().A_XeTracker(e,t)},this.RemoveActiveTracker=function(e){window.getXeActiveDocument().getXeTrackers().R_T(e)},this.IsTrackerActive=function(e){return window.getXeActiveDocument().getXeTrackers().isTrackerActive(e)},this.TrackerData=function(e){if(window.getXeActiveDocument()&&window.getXeActiveDocument().getXeTrackers())return window.getXeActiveDocument().getXeTrackers().getTrackerData(e)}},XeClientMessageProxy=function(){var i=this;i.call=function(e,t){i.hasOwnProperty(e)&&i[e]?i[e](t):window.XeLogger.info("XeClientMessageProxy "+e+" message not implemented")},i.init()},XeSpinnerWaiter=(XeClientMessageProxy.prototype.init=function(){},function(e){var t=e,i=this;i.reasonsCount=0,i.isWaiting=function(){return 0!==i.reasonsCount},i.startWaiting=function(e){i.isWaiting()||(e&&e(),i.timer)||(i.timer=new XeTimer(t)),i.reasonsCount++},i.stopWaiting=function(e){i.reasonsCount--,i.isWaiting()||(e&&e(),i.timer&&(i.timer.report(),i.timer=null)),i.reasonsCount<0&&window.XeLogger.info("Spinner counter less zero")}}),XeClipper=function(){this.checkPoints=function(e,t,i,r){var n=[],t=(t&&n.push({p:t,side:-1}),i&&n.push({p:i,side:-1}),r&&n.push({p:r,side:-1}),e.visibleScreenRect());if(!t)return!1;var o=Math.floor(t.xmin),a=Math.floor(t.ymin),s=Math.floor(t.xmax),c=Math.floor(t.ymax);let l=4369;for(let e=0;e<n.length;e++){var d=n[e].p;if(o<d[0]&&s>d[0]&&a<d[1]&&c>d[1]?n[e].side=0:o>d[0]&&a<d[1]&&c>d[1]?n[e].side=1:o>d[0]&&a>d[1]?n[e].side=17:o<d[0]&&s>d[0]&&a>d[1]?n[e].side=16:s<d[0]&&a>d[1]?n[e].side=272:s<d[0]&&a<d[1]&&c>d[1]?n[e].side=256:s<d[0]&&c<d[1]?n[e].side=4352:o<d[0]&&s>d[0]&&c<d[1]?n[e].side=4096:o>d[0]&&c<d[1]&&(n[e].side=4097),0===n[e].side||-1===n[e].side)return!0;l&=n[e].side}return 0===l}};let TYPE_ClipMethod={outer:0,inner:1};var XeGsColorPickingArray=function(e){var i=this,r=(i.getArray=function(){return n},i.invalidate=function(){t=!1},i.isValid=function(){return t},i.setValid=function(){t=!0},i.resize=function(){if(n.length!==r.getColorPickingArraySize()&&i.invalidate(),n.length<r.getColorPickingArraySize()){for(var e=new Int32Array(r.getColorPickingArraySize()),t=0;t<n.length;t++)e[t]=n[t];n=e}},e),n=new Int32Array(r.getColorPickingArraySize()),t=!1},XeColorPickingMap=function(){this.m_bValid=!1,this.m_ColorPickingMap={},this.m_ColorPickingMapInverse={},this.m_CurrentKey=0,this.isValid=()=>this.m_bValid,this.invalidate=()=>{this.m_bValid=!1},this.reset=()=>{this.resetImpl()},this.deleteKey=e=>{this.deleteKeyImpl(e),this.invalidate()},this.addKey=e=>{this.addKeyImpl(e),this.invalidate()},this.getFullSubentPathByColor=e=>this.getFullSubentPathByColorImpl(e),this.updateChunks=e=>this.updateChunksImpl(e),this.resetImpl=()=>{this.m_bValid=!1,this.m_ColorPickingMap={},this.m_ColorPickingMapInverse={}},this.deleteKeyImpl=e=>{delete this.m_ColorPickingMap[e],delete this.m_ColorPickingMapInverse[e]},this.addKeyImpl=e=>{this.m_ColorPickingMap[e]=++this.m_CurrentKey,this.m_ColorPickingMapInverse[this.m_CurrentKey]=e},this.getFullSubentPathByColorImpl=e=>this.m_ColorPickingMapInverse[e],this.updateChunksImpl=e=>{if(!this.m_bValid){var t,i,r=e.getXeGsDevice().getChunks(),n={};for(t in this.m_ColorPickingMap){var o=this.m_ColorPickingMap[t];o&&((e,t,i,r)=>{var n=(o=e.getXeGsDevice()).getChunks(),o=e.getXeDatabase().getXeEntities();if(!n||!o)return;if(e=o.getByHandle(t)){var a,s=e.getCachedXeGsOffsets();for(a in s){var c=s[a],l=n[a];if(c&&(l&&l.getColorPickingArray()))for(let e=0;e<c.length;e++){var d=c[e];if(0!==d.s){for(var u=d.o+d.s,p=l.getColorPickingArray().getArray(),m=d.o;m<u&&!(p.length-1<m);m++)p[m]=i;l.getColorPickingArray().invalidate(),r[a]=!0}}}}else window._LOG_GLOBAL.SHOW("SHOW_ERRORS","XeColorPickingMap::updateXeGsChunksImpl : ERROR --\x3e entity -- "+t+" is null!")})(e,t,o,n)}for(i in n){var a=r[i];a&&a.updateColorPickingColors(!0)}return this.m_bValid=!0,this.m_bValid}},this.resetImpl()},XeConsoleDebugLogger=function(){this.add_mesuarement=function(e){var t=(new Date).getTime();r.push({name:e,time:t-i}),i=t},this.log=function(){for(var e=0;e<r.length;e++)console.log("#"+e+" "+r[e].name+" : "+r[e].time+"ms\n")},this.reset=function(){i=(new Date).getTime(),r=[]};var i=(new Date).getTime(),r=[]},XeDrawDecoration=function(){var e=this,t=(e.setType=function(e){i=e},e.getType=function(){return i},e.setColor=function(e){e?((n=[])[0]=e[0],n[1]=e[1],n[2]=e[2]):n=null},e.getColor=function(){return n},e.setAlpha=function(e){o=e},e.getAlpha=function(){return o},e.setLWThick=function(e){t=e},e.getLWThick=function(){return t},e.setLineCap=function(e){r=e},e.getLineCap=function(){return r},0),i=0,r="round",n=null,o=null},XeDrawMode=(XeDrawDecoration.prototype.TYPE_ENUM={NoDecoration:0,Highlight:1,SelectionSet:2},{kNormal:0,kHidden:1}),XeGLDrawObjectGlType={POINTS:0,LINES:1,LINE_STRIP:2,LINE_LOOP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},XeGLDrawObject=function(e,t,i,r=!1){this.geometry=e,this.material=t,this.xegltype=i,this.shared=r},XeDrawObjectUtils=(XeGLDrawObject.prototype.setClippingAreasScence=function(e){this.m_ClippingArearsScene=e},XeGLDrawObject.prototype.getClippingAreasScence=function(){return this.m_ClippingArearsScene},XeGLDrawObject.prototype.deallocate=function(e,t=!1){var i;if((e=e||this)&&((t||!e.shared)&&(e.parent&&(e.parent.remove(e),e.parent=void 0),e.material&&e.material.dispose&&e.material.dispose(),e.geometry&&e.geometry.dispose&&e.geometry.dispose(),e.removeFromBuffer&&e.removeFromBuffer(),e.getClippingAreasScence())))for(i of e.getClippingAreasScence())XeWebDrawerEngine.prototype.deallocateScene(i)},XeGLDrawObject.prototype.draw_gl_set_clipping=function(n,o,a,s,c,l,e){if(e.clippingAreas&&e.clippingAreas.length){let t=this.getClippingAreasScence();if(!t){t=[];var d=e.clippingAreas;for(let e=0;e<d.length;e++){var u=d[e];if(!u||!u.length)throw"XeGLDrawObject.prototype.draw_gl :: clipping_area is null or clipping_area.length is 0;";var p=this.createStencilScene(u);p.clipMethod=u.clipMethod||TYPE_ClipMethod.outer,t.push(p)}this.setClippingAreasScence(t)}let i=!0;var m=n.getStencilNestedCounter();0<m&&0;let r=!1;for(let e=0;e<t.length;e++){var h=t[e];if(!n.setStencilTest(h,o,i,a,s,c,l))throw"in_XeRenderer.setStencilTest failed";r=!0,i=!1,n.setStencilNestedCounter(m)}r&&n.setStencilNestedCounter(m+1)}},XeGLDrawObject.prototype.draw_gl_unset_clipping=function(i,r,n){if(this.getClippingAreasScence()&&0<this.getClippingAreasScence().length){var o=this.getClippingAreasScence(),a=i.getStencilNestedCounter();1<a&&0;let t=!1;for(let e=o.length-1;0<=e;e--){var s=o[e],s=i.unsetStencilTest(s,r,n);if(i.setStencilNestedCounter(a),!s)throw"XeGLDrawObject.prototype.draw_gl_unset_clipping : unset failed 1";t=!0}if(t&&i.setStencilNestedCounter(a-1),i.getStencilNestedCounter()<0)throw"XeGLDrawObject.prototype.draw_gl_unset_clipping : unset failed 2"}},XeGLDrawObject.prototype.draw_gl_update_InstancedDrawObject=function(t,e,i,r){let n=!0;var o=XeDrawObjectUtils.prototype.lwInstancedDrawObject,a=t.attributes.index=o.geometry.attributes.index,s=(t.attributes.pointIndex=o.geometry.attributes.pointIndex,e.shader=window.XeShaders.container.DrawObjectLineWeight_instanced,t.attributes.drawMode);let c,l,d;t.attributes.drawMode.savedOffsets||(t.attributes.drawMode.savedOffsets={});t.attributes.drawMode.savedOffsets[5]||(t.attributes.drawMode.savedOffsets[5]=[]),t.attributes.drawMode.savedOffsets[0]||(t.attributes.drawMode.savedOffsets[0]=[]);let u=null,p=!1,m=!1;if(i.length){t.attributes.drawMode.savedOffsets[5].length!=i.length&&(t.attributes.drawMode.savedOffsets[5]=[]);for(let e=0;e<i.length;e++)c=i[e],u=t.attributes.drawMode.savedOffsets[5][e],(p=!u||u.s!=c.s||u.o!=c.o)&&0<c.s&&(m||(t.attributes.drawMode.array.fill(0),m=!0),l=c.o/2,d=c.o/2+c.s/2,s.array.fill(5,l,d),s.needsUpdate=!0,t.attributes.drawMode.savedOffsets[5][e]={s:c.s,o:c.o})}else s.needsUpdate=s.needsUpdate||0<t.attributes.drawMode.savedOffsets[5].length,s.needsUpdate&&t.attributes.drawMode.array.fill(0),t.attributes.drawMode.savedOffsets[5]=[],n=!1;if(r.length){t.attributes.drawMode.savedOffsets[0].length!=r.length&&(t.attributes.drawMode.savedOffsets[0]=[]);for(let e=0;e<r.length;e++)c=r[e],u=t.attributes.drawMode.savedOffsets[0][e],p=!u||u.s!=c.s||u.o!=c.o,(p=s.needsUpdate||p)&&0<c.s&&(l=c.o/2,d=c.o/2+c.s/2,s.array.fill(0,l,d),s.needsUpdate=!0,t.attributes.drawMode.savedOffsets[0][e]={s:c.s,o:c.o})}else s.needsUpdate=s.needsUpdate||0<t.attributes.drawMode.savedOffsets[0].length,t.attributes.drawMode.savedOffsets[0]=[];return{index:a,bRenderInstanced:n}},XeGLDrawObject.prototype.draw_gl_setup_gl=function(e,t,i,r,n,o,a,s,c,l){l=l||{gl_attr_mem_used:0,gl_unif_mem_used:0},c.shader.updateAttributes(e,s),e.setProgram(c.shader);var d=void 0!==s.getAttribute("vertexColor");c.shader.updateUniforms(e,t,i,r,n,o,c,d,l,this),c.shader.setupAttributes(e,s,o)},XeGLDrawObject.prototype.draw_gl_draw_instaced_indexed=function(e,t,i,r){this.drawElementsInstanced(e,e.TRIANGLES,t.array.length,XeWebGlRenderer.prototype.getDrawElementsType(e),0,i)},XeGLDrawObject.prototype.draw_gl_draw_non_instaced_indexed=function(i,e,r,n,o,a,s){for(let t=0;t<r.length;t++)if(0<r[t].s&&(this.drawElements(i,o,r[t].s,n,r[t].o*a),o===i.LINES&&this.drawElements(i,i.POINTS,r[t].s,n,r[t].o*a),o===i.TRIANGLES)&&s)for(let e=0;e<r[t].s/3;e++)this.drawElements(i,i.LINE_STRIP,3,n,(3*e+r[t].o)*a)},XeGLDrawObject.prototype.draw_gl_draw_non_instaced_non_indexed=function(e,t,i,r){e.drawArrays(e.POINTS,0,t),e.drawArrays(i,0,t)},XeWebDrawerEngine.prototype.DrawObject_SimpleDraw=!1,XeGLDrawObject.prototype.draw_gl_object_stencil=function(i,r,n,o,a){var s=i.getGlState(),c=i.getGl(),l=this.material,d=this.geometry,u=d.attributes;if(l&&l.shader&&u){let e=null,t=!1;u={gl_attr_mem_used:0,gl_unif_mem_used:0};switch(this.xegltype){case XeGLDrawObjectGlType.POINTS:e=c.POINTS;break;case XeGLDrawObjectGlType.LINES:e=c.LINES;break;case XeGLDrawObjectGlType.LINE_STRIP:e=c.LINE_STRIP;break;case XeGLDrawObjectGlType.LINE_LOOP:e=c.LINE_LOOP;break;case XeGLDrawObjectGlType.TRIANGLES:e=c.TRIANGLES,t=!0;break;case XeGLDrawObjectGlType.TRIANGLE_STRIP:e=c.TRIANGLE_STRIP,t=!0;break;case XeGLDrawObjectGlType.TRIANGLE_FAN:e=c.TRIANGLE_FAN,t=!0;break;default:e=-1}-1!==e&&(l.shader,d.attributes.index,this.setRenderMode(i,r,l,s),s.setLineWidth(1),l.shader.updateAttributes(i,d),i.setProgram(l.shader),l.shader.updateUniforms(i,r,n,o,a,void 0,l,!1,u,this),l.shader.setupAttributes(i,d,void 0),s=d.attributes.position.length/3,this.draw_gl_draw_non_instaced_non_indexed(c,s,e,!1))}},XeGLDrawObject.prototype.draw_gl_object=function(c,l,d){if(!XeWebDrawerEngine.prototype.DrawObjectBypassDraw){var u=this,p=(!window.IsOsVersion()||window.getXeApplication().GetCapability("new_lwlt_shader_draw"))&&!window.forceOldLWLTShader(),m=(!window.IsOsVersion()||window.getXeApplication().GetCapability("draw_force_outlines"))&&window.forceOutlines(),h=c.getGlState(),g=c.getGl();let n=null;var y=bEnableAllGlDebugLog,f=(y&&(n=new XeConsoleDebugLogger),u.material),_=u.geometry,w=d?d.m_xeGsChunk:void 0,v=c.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,C=d?d.m_xeGsChunkDecoration:void 0,T=d?d.m_xeGsChunkTraits:void 0,b=_.attributes,X=_.attributes.index;let e=!1,o=!1,a,s=(p&&w&&(P=window.XeShaders.GetRightShader(u.xegltype,w,T,C,d,c),f.shader=P.shader,o=P.instanced,e=P.type==XeShaderTypes.Linetype,o)&&(a=P.instanceType),_.attributes.index);p&&e&&(s=_.attributes.ltIndex);var t=u.getDrawModes()[XeDrawMode.kHidden],S=d?.offsets?.length?d.offsets.slice():[{o:0,s:s?s.length:0}];for(let e=0;e<t.length;e++)XeGsOffsetsHelper.IntersectXeGsOffsets(S,t[e].o,t[e].s,XeGsOffsetsHelper.XeGsOffsetsIntersectMethod.kRemoveFrom);if(0!=S.length&&f&&b){var P=f.shader,b=(y&&n.add_mesuarement("apply uniforms"),y&&n.add_mesuarement("apply in_XeGlCustomUniformData"),d&&d.alpha?d.alpha:1);let i=f.transparent||b<1;w&&!i&&(i=w.isTransparent()),y&&n.add_mesuarement("calc matrixes");var b=XeDrawObjectUtils.prototype.bApplyClippingAreas,D=XeDrawObjectUtils.prototype.bDebugClippingAreas;b&&w&&u.draw_gl_set_clipping(c,l,w,T,C,D,d);let r=null,e=!1;switch(u.xegltype){case XeGLDrawObjectGlType.POINTS:r=g.POINTS;break;case XeGLDrawObjectGlType.LINES:r=g.LINES;break;case XeGLDrawObjectGlType.LINE_STRIP:r=g.LINE_STRIP;break;case XeGLDrawObjectGlType.LINE_LOOP:r=g.LINE_LOOP;break;case XeGLDrawObjectGlType.TRIANGLES:r=g.TRIANGLES,e=!0;break;case XeGLDrawObjectGlType.TRIANGLE_STRIP:r=g.TRIANGLE_STRIP,e=!0;break;case XeGLDrawObjectGlType.TRIANGLE_FAN:r=g.TRIANGLE_FAN,e=!0;break;default:r=-1}if(-1!==r){var x,O={gl_attr_mem_used:0,gl_unif_mem_used:0},G=XeWebGlRenderer.prototype.getDrawElementsType(g);let e=0,t=(G===g.UNSIGNED_SHORT?e=2:G===g.UNSIGNED_INT?e=4:window.XeLogger.warn("unknown draw elements type"),p||(o=d&&XeWebDrawerEngine.prototype.bDrawInstancedLineweight&&d.bDrawLineweightLine),h.setDepthTest(!0,g.LEQUAL),this.setRenderMode(c,l,f,h),i&&v?(h.setDepthWrite(!0),h.setBlending(!0,g.FUNC_ADD,g.FUNC_ADD,g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA)):(h.setDepthWrite(!0),h.setBlending(!1)),h.setLineWidth(1),p||o&&(v=this.draw_gl_update_InstancedDrawObject(_,f,S,[]),o=v.bRenderInstanced)&&(s=v.index),C?C.bDrawOutline:m);if(w&&w.isFromText()&&(t=!1),w&&w.isImageChunk()&&(t=!1),!l||l.getRenderMode()!=XeGsViewport.prototype.RenderModeEnum.kFlatShaded&&l.getRenderMode()!=XeGsViewport.prototype.RenderModeEnum.kFlatShadedWithWireframe||(t=!1),i&&(t=!1),o){if(_.instanceOffset=0,u.draw_gl_setup_gl(c,l,w,T,C,d,h,_,f,O),p)for(let e=0;e<S.length;e++)0<S[e].s&&(_.instanceOffset=S[e].o/2,x=S[e].s/2,f.shader.setupAttributes(c,_,d),a===XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]?u.drawInstanced_8TRIANGLE_STRIPS(g,x,t):u.draw_gl_draw_instaced_indexed(g,s,_.segment_count,t));else u.draw_gl_draw_instaced_indexed(g,s,_.segment_count,t);h.disableDivisors()}else s?(u.draw_gl_setup_gl(c,l,w,T,C,d,h,_,f,O),u.draw_gl_draw_non_instaced_indexed(g,s,S,G,r,e,t)):(u.draw_gl_setup_gl(c,l,w,T,C,d,h,_,f,O),v=_.attributes.position.length/3,u.draw_gl_draw_non_instaced_non_indexed(g,v,r,t));return o&&(f.shader=P,p||(_.attributes.index=X,_.attributes.pointIndex=null)),y&&n.add_mesuarement("draw gl"),b&&w&&u.draw_gl_unset_clipping(c,l,D),h.setDepthTest(!0,g.LEQUAL),h.setDepthWrite(!0),h.setColorWrite(!0),y&&n.add_mesuarement("end - return values back"),n}}}},XeGLDrawObject.prototype.fixHilghlightMode=!0,XeGLDrawObject.prototype.drawElementsInstanced=function(e,t,i,r,n,o){try{e.drawElementsInstanced?e.drawElementsInstanced(t,i,r,n,o):e._instancedArrays.drawElementsInstancedANGLE(t,i,r,n,o)}catch(e){window.XeLogger.error("drawElementsInstanced error: "+e)}},XeGLDrawObject.prototype.drawArraysInstanced=function(e,t,i,r,n,o){try{e.drawArraysInstanced?(e.drawArraysInstanced(t,i,r,n),o&&e.drawArraysInstanced(e.LINE_STRIP,r+1,2,n)):(e._instancedArrays.drawArraysInstancedANGLE(t,i,r,n),o&&e._instancedArrays.drawArraysInstancedANGLE(e.LINE_STRIP,r+1,2,n))}catch(e){window.XeLogger.error("drawArraysInstanced error: "+e)}},XeGLDrawObject.prototype.drawInstanced_8TRIANGLE_STRIPS=function(e,t,i){this.drawArraysInstanced(e,e.TRIANGLE_STRIP,0,8,t,i)},XeGLDrawObject.prototype.drawElements=function(e,t,i,r,n){e.drawElements(t,i,r,n)},XeGLDrawObject.prototype.setRenderMode=function(e,t,i,r){t=t?t.getRenderMode():XeGsViewport.prototype.RenderModeEnum.k2DOptimized;e.renderMode!==XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&i.side!==THREE.DoubleSide&&t>XeGsViewport.prototype.RenderModeEnum.kHiddenLine?(r.setDoubleSided(!1),r.setFlipSided(!0)):r.setDoubleSided(!0)},XeGLDrawObject.prototype.createStencilScene=function(t){var e,i,r=new XeDrawScene,n=[];for(let e=0;e<t.length;e++){var o=t[e];if(!(o.length<3))for(let e=1;e<o.length-1;e++)n.push(o[0][0],o[0][1],o[0][2]||0),n.push(o[e][0],o[e][1],o[e][2]||0),n.push(o[e+1][0],o[e+1][1],o[e+1][2]||0)}return 3<=n.length?(e=new Float32Array(n),(i=new XeGLDrawObjectGeometry).addAttribute("position",new XeGeometryAttribute(e,!0)),e={color:[Math.random(),Math.random(),Math.random()],alpha:1},(e=new XeGLDrawObjectMaterial({uniforms:e,shader:window.XeShaders.container.SimpleShader})).side=THREE.DoubleSide,i=new XeGLDrawObject(i,e,XeGLDrawObjectGlType.TRIANGLES),r.children.push(i),r):null},XeGLDrawObject.prototype.resetDrawModes=function(){this.m_XeDrawModes={1:[],2:[],4:[],8:[],16:[]}},XeGLDrawObject.prototype.getDrawModes=function(){return this.m_XeDrawModes||this.resetDrawModes(),this.m_XeDrawModes},XeGLDrawObject.prototype.setDrawMode=function(e,t,i){var r,n,o=this.getDrawModes();for(r in o)o.hasOwnProperty(r)&&(n=parseInt(r),e!==XeDrawMode.kNormal&&n===e||o[r].length&&XeGsOffsetsHelper.IntersectXeGsOffsets(o[r],t,i,XeGsOffsetsHelper.XeGsOffsetsIntersectMethod.kRemoveFrom));e!==XeDrawMode.kNormal&&XeGsOffsetsHelper.IntersectXeGsOffsets(o[e],t,i,XeGsOffsetsHelper.XeGsOffsetsIntersectMethod.kAddTo)},function(){if(this.createDrawObjects=function(e){return this.createChunkGeometry(e.getType(),e.getArcType(),e.getLinetypeTableRecord(),e.getPlineGen(),e.getIndexes(),e.getVertexes(),e.getOrder(),e.getColors(),e.getNormals())},!XeDrawObjectUtils.prototype.lwInstancedDrawObject&&XeWebDrawerEngine.prototype.bDrawInstancedLineweight){var t=new XeGLDrawObjectGeometry;t.addAttribute("index",new XeGeometryAttribute(XeWebGlRenderer.prototype.getIndexArrayType([0,2,1,0,3,2]),!1)),t.addAttribute("pointIndex",new XeGeometryAttribute(new Float32Array([1,2,3,4]),!1));let e=window.XeShaders.container.DrawObjectLineWeight_instanced;window.__newlwshader&&(e=window.XeShaders.container.LineWeight_shader);var i=new XeGLDrawObjectMaterial({shader:e});i.side=THREE.DoubleSide,XeDrawObjectUtils.prototype.lwInstancedDrawObject=new XeGLDrawObject(t,i,XeGLDrawObjectGlType.TRIANGLES)}function M(e){for(var t=new Float32Array(3*e.length),i=0;i<e.length;i++){var r=e[i];t[3*i]=(255&r)/255,t[3*i+1]=(r>>8&255)/255,t[3*i+2]=(r>>16&255)/255}return t}this.createChunkGeometry=function(i,r,n,o,a,s,c,l,d){var u=2,p=!1,m=0,h=a,g=s,y=c,a=l,s=d,c=r;switch(i){case"LS":u=2;break;case"LSN":u=2,m=0;break;case"LSNC":u=2,p=!(m=0);break;case"TS":u=3,m=2;break;case"TSN":u=3,m=1;break;case"TSC":u=3,m=2,p=!0;break;case"TSNC":u=3,p=!0,m=1;break;default:return void window.XeLogger.warn("unknown geom type",arguments)}for(var f,l=new XeGLDrawObjectGeometry,e=-1,t=0,t=0;t<h.length;t++)if(0!=h[t]){e=h[t];break}if(-1!==e){g[0]=-1e8,g[1]=-1e8;let e=!(g[2]=-1e8);if(n&&n.getIsSimple()&&2===u){d=XeGLLinetypesGeometry.processChunk(g,h,y,a,s,o,c);if(d){if(l.addAttribute("ltIndex",new XeGeometryAttribute(d.newIndiciesArray,!1)),l.addAttribute("ltVertex",new XeGeometryAttribute(d.newVerticesArray,!1)),l.addAttribute("ltOrder",new XeGeometryAttribute(d.newOrdersArray,!1)),l.addAttribute("ltColorPickingColor",new XeGeometryAttribute(new Float32Array(4*d.newVerticesArray.length/3),!1)),p){let e=M(d.newVertexColorArray);l.addAttribute("ltColors",new XeGeometryAttribute(e,!1))}if(1===m&&l.addAttribute("ltNormals",new XeGeometryAttribute(d.newNormalsArray,!1)),l.addAttribute("fPatternCoord",new XeGeometryAttribute(d.newfPatternCoord,!1)),l.addAttribute("fReverseCoord",new XeGeometryAttribute(d.newfReverseCoord,!1)),XeWebDrawerEngine.prototype.bDrawInstancedLineweight){r=new XeGLLineWeightGeometry;if(r.addArray_divide(Float32Array,"p0","p1",d.newVerticesArray,3),r.addArray_pack(Float32Array,"fOrderValues",d.newOrdersArray,1),p){let e=M(d.newVertexColorArray);r.addArray_divide(Float32Array,"p0_vertexColor","p1_vertexColor",e,3)}1===m&&r.addArray_divide(Float32Array,"p0_vertexNormal","p1_vertexNormal",d.newNormalsArray,3),r.addArray_pack(Float32Array,"fPatternCoords",d.newfPatternCoord,1),r.addArray_pack(Float32Array,"fReverseCoords",d.newfReverseCoord,1),r.addArray_pack(Float32Array,"fsemiScCoefs",d.newfsemiScCoef,1);i=r.processGeometry(d.newIndiciesArray);l.addAttribute("p0",new XeGeometryAttribute(i.p0,!1)),l.addAttribute("p1",new XeGeometryAttribute(i.p1,!1)),l.addAttribute("fOrderValues",new XeGeometryAttribute(i.fOrderValues,!1)),i.p0_vertexColor&&i.p0_vertexColor.length&&l.addAttribute("p0_vertexColor",new XeGeometryAttribute(i.p0_vertexColor,!1)),i.p1_vertexColor&&i.p1_vertexColor.length&&l.addAttribute("p1_vertexColor",new XeGeometryAttribute(i.p1_vertexColor,!1)),i.p0_vertexNormal&&i.p0_vertexNormal.length&&l.addAttribute("p0_vertexNormal",new XeGeometryAttribute(i.p0_vertexNormal,!1)),i.p1_vertexNormal&&i.p1_vertexNormal.length&&l.addAttribute("p1_vertexNormal",new XeGeometryAttribute(i.p1_vertexNormal,!1)),l.addAttribute("fPatternCoords",new XeGeometryAttribute(i.fPatternCoords,!1)),l.addAttribute("fReverseCoords",new XeGeometryAttribute(i.fReverseCoords,!1)),l.addAttribute("fsemiScCoefs",new XeGeometryAttribute(i.fsemiScCoefs,!1)),l.fragment_count=i.fragment_count,e=!0}}}if(l.addAttribute("index",new XeGeometryAttribute(h,!1)),XeWebDrawerEngine.prototype.bDrawInstancedLineweight&&2===u){if(!e){n=new XeGLLineWeightGeometry;if(n.addArray_divide(Float32Array,"p0","p1",g,3),n.addArray_pack(Float32Array,"fOrderValues",y,1),p){let e=M(a);n.addArray_divide(Float32Array,"p0_vertexColor","p1_vertexColor",e,3)}1===m&&n.addArray_divide(Float32Array,"p0_vertexNormal","p1_vertexNormal",s,3);o=n.processGeometry(h);l.addAttribute("p0",new XeGeometryAttribute(o.p0,!1)),l.addAttribute("p1",new XeGeometryAttribute(o.p1,!1)),o.fOrderValues&&o.fOrderValues.length&&l.addAttribute("fOrderValues",new XeGeometryAttribute(o.fOrderValues,!1)),o.p0_vertexColor&&o.p0_vertexColor.length&&l.addAttribute("p0_vertexColor",new XeGeometryAttribute(o.p0_vertexColor,!1)),o.p1_vertexColor&&o.p1_vertexColor.length&&l.addAttribute("p1_vertexColor",new XeGeometryAttribute(o.p1_vertexColor,!1)),o.p0_vertexNormal&&o.p0_vertexNormal.length&&l.addAttribute("p0_vertexNormal",new XeGeometryAttribute(o.p0_vertexNormal,!1)),o.p1_vertexNormal&&o.p1_vertexNormal.length&&l.addAttribute("p1_vertexNormal",new XeGeometryAttribute(o.p1_vertexNormal,!1)),l.fragment_count=o.fragment_count}for(var _=0,w=0,c=h.length/2,v=new Float32Array(c),C=new Float32Array(c),T=new Float32Array(c),b=0,r=new Float32Array(c),X=new Float32Array(3*c),S=new Float32Array(3*c),P=new Float32Array(c),D=new GeNeo.OdGePoint3d,x=new GeNeo.OdGePoint3d,O=0,G=0,E=0;E<h.length;E+=2){D.set(g[3*h[E]+0],g[3*h[E]+1],g[3*h[E]+2]),x.set(g[3*h[E+1]+0],g[3*h[E+1]+1],g[3*h[E+1]+2]),X[w+0]=x.x-D.x,X[w+1]=x.y-D.y,X[w+2]=x.z-D.z,S[w+0]=D.x,S[w+1]=D.y,S[w+2]=D.z,P[_]=y[h[E]],0!==E&&h[E-1]===h[E]||(T.fill(G,b,_),b=_,G=O=0);var A=D.distanceTo(x),I=O,k=O+=A;v[_]=I,C[_]=k,G+=A,_+=1,w+=3}T.fill(G,b,_),l.addAttribute("firstLengthCoord",new XeGeometryAttribute(v,!1)),l.addAttribute("lastLengthCoord",new XeGeometryAttribute(C,!1)),l.addAttribute("fullLengthCoord",new XeGeometryAttribute(T,!1)),l.addAttribute("lineVector",new XeGeometryAttribute(X,!1)),l.addAttribute("firstPoint",new XeGeometryAttribute(S,!1)),l.addAttribute("drawMode",new XeGeometryAttribute(r,!1)),l.addAttribute("fOrderValueInstanced",new XeGeometryAttribute(P,!1)),l.segment_count=c}l.addAttribute("position",new XeGeometryAttribute(g,!1)),l.addAttribute("fOrderValue",new XeGeometryAttribute(y,!1)),l.addAttribute("colorPickingColor",new XeGeometryAttribute(new Float32Array(4*g.length/3),!1)),1===m&&l.addAttribute("normal",new XeGeometryAttribute(s,!0)),p&&(f=M(a),l.addAttribute("vertexColor",new XeGeometryAttribute(f,!1)));let t;t=XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,!1),window.__SimpleDraw&&(t=window.XeShaders.container.SimpleDraw);d=new XeGLDrawObjectMaterial({shader:t}),i=(d.side=THREE.DoubleSide,null),n=(2===u?i=XeGLDrawObjectGlType.LINES:3===u&&(i=XeGLDrawObjectGlType.TRIANGLES),new XeGLDrawObject(l,d,i));return n.__SimpleDraw=window.__SimpleDraw,n.xeMapper=null,n}}}),XePreviewObject=(XeDrawObjectUtils.prototype.bApplyClippingAreas=!0,XeDrawObjectUtils.prototype.bDebugClippingAreas=!1,XeDrawObjectUtils.prototype.lwInstancedDrawObject=null,function(e,t,i,r){this.getXeEntity=function(){return n.m_XeDrawPreviewObjectCollection.GetXeEntity(n.m_XeEntityKey)},this.getStoredChunk=function(){return n.m_XeDrawPreviewObjectCollection.GetXeGsIndexedChunk(n.m_XeGsIndexedChunkKey)},this.getOffsetData=function(){return n.m_OffsetData};var n={m_XeDrawPreviewObjectCollection:e,m_XeEntityKey:t,m_XeGsIndexedChunkKey:i,m_OffsetData:r,m_DrawOrder:0};Object.defineProperty(this,"debug",{get:function(){if(window.__IsDebugMode)return n}})}),XeDrawPreviewObjectCollection=function(){var a=this;a.Add=function(e,t,i,r){var n,o;t=t,i=i,r=r,(e=e).IsHidden()||(n=t.getId(),o="m_"+n,s.m_XeGsIndexedChunks.hasOwnProperty(o)||(s.m_XeGsIndexedChunks[o]=r?[t.copy(),!0]:[t,!1]),t="m_"+e.getHandle(),s.m_XeEntities.hasOwnProperty(t)||(s.m_XeEntities[t]=r?e.copy():e),s.m_XePreviewObjects.push(new XePreviewObject(a,t,o,{k:n,o:i.o,s:i.s})))},a.Get=function(e){return s.m_XePreviewObjects[e]},a.Size=function(){return s.m_XePreviewObjects.length},a.Sort=function(e){s.m_XePreviewObjects.sort(e)},a.Deallocate=function(){for(var e in s.m_XeGsIndexedChunks)s.m_XeGsIndexedChunks.hasOwnProperty(e)&&s.m_XeGsIndexedChunks[e][1]&&s.m_XeGsIndexedChunks[e][0].FinalRelease()},a.RecreateByChunkOffsets=function(){var e=s.m_XePreviewObjects;if(e&&1<e.length){e.sort(t);var i=(t=>{var i=[];if(t.length)if(1<t.length){i.push([t[0]]);var r=t[0].getStoredChunk().getId();for(let e=1;e<t.length;e++){var n=t[e].getStoredChunk().getId();n===r?i[i.length-1].push(t[e]):i.push([t[e]]),r=n}}else i.push([t[0]]);return i})(e),r=[];for(let e=0;e<i.length;e++){let t=i[e];1<t.length&&(t.sort(n),t=(e=>{let n=[],o=e;if(o.length){n.push(o[0]);let t=n[0],i=t.getOffsetData().o,r=t.getOffsetData().s;for(let e=1;e<o.length;e++){var a=o[e],s=a.getOffsetData().o,c=a.getOffsetData().s;i<=s&&i+r>=s?(s=Math.max(i+r,s+c),c=s-i,t.getOffsetData().o=i,t.getOffsetData().s=c):(n.push(a),t=a),i=t.getOffsetData().o,r=t.getOffsetData().s}}return n})(t));for(let e=0;e<t.length;e++)r.push(t[e])}s.m_XePreviewObjects=r}},a.GetXeGsIndexedChunk=function(e){return s.m_XeGsIndexedChunks.hasOwnProperty(e)?s.m_XeGsIndexedChunks[e][0]:void 0},a.GetXeEntity=function(e){return s.m_XeEntities.hasOwnProperty(e)?s.m_XeEntities[e]:void 0};let s={m_XeGsIndexedChunks:{},m_XeEntities:{},m_XePreviewObjects:[]};function t(e,t){e=e.getStoredChunk().getId(),t=t.getStoredChunk().getId();return e===t?0:t<e?1:-1}function n(e,t){return e.getStoredChunk().getId()===t.getStoredChunk().getId()?(e=e.getOffsetData(),t=t.getOffsetData(),e.o>t.o?1:e.o<t.o?-1:0):0}Object.defineProperty(a,"debug",{get:function(){if(window.__IsDebugMode)return s}})},XeEntityPreview=function(){var i=this;i.deallocate=function(){p.m_XeDrawPreviewObjectCollection.Deallocate()},i.draw_gl=function(e,t){!p.m_sorted_by_chunk_offsets&&p.m_allow_sorting_by_chunk_offsets&&(p.m_XeDrawPreviewObjectCollection.RecreateByChunkOffsets(),p.m_sorted_by_chunk_offsets=!0),i.drawXeDrawPreviewObjectCollectionGl(e,t,p.m_XeDrawPreviewObjectCollection)},i.addXeEntity=function(e,t,i){var r=t,n=i;if(e){var o=e.getXeDatabase().getXeDocument().getXeGsDevice().getChunks();if(o){var a,s=e,c=(p.m_handles.push(s.getHandle()),s.getCachedXeGsOffsets());for(a in c)if(c.hasOwnProperty(a)){var l=o[a];if(l&&(!n||n(s,l))){var d=c[a];for(let e=0;e<d.length;e++){var u=d[e];p.m_XeDrawPreviewObjectCollection.Add(s,l,u,r)}p.m_sorted_by_draw_order=!1,p.m_sorted_by_chunk_offsets=!1}}}}},i.setTransform=function(e){p.m_mTransform=new GeNeo.OdGeMatrix3d(e)},i.getTransform=function(){return p.m_mTransform},i.getXeDrawDecoration=function(){return p.m_XeDrawDecoration},i.setSortingByDrawOrder=function(e){p.m_allow_sorting_by_draw_order=e},i.setSortingByChunkOffsets=function(e){p.m_allow_sorting_by_chunk_offsets=e};let p={m_sorted_by_draw_order:!(i.getHandles=function(){return p.m_handles}),m_allow_sorting_by_draw_order:!1,m_sorted_by_chunk_offsets:!1,m_allow_sorting_by_chunk_offsets:!0,m_clipping:!1,m_mTransform:new GeNeo.OdGeMatrix3d,m_XeDrawDecoration:new XeDrawDecoration,m_XeDrawPreviewObjectCollection:new XeDrawPreviewObjectCollection,m_handles:[]};Object.defineProperty(i,"debug",{get:function(){if(window.__IsDebugMode)return p}})},XeEnumFactory=(XeEntityPreview.prototype.drawXeDrawPreviewObjectCollectionGl=function(e,t,i){if(t){t.getXeGsDevice().getXeGsViewports();for(var r=this.getXeDrawDecoration(),n=r.TYPE_ENUM,o=r.getType(),a=i.Size(),s=0,s=0;s<a;s++){var c,l,d,u,p,m,h=i.Get(s),g=h.getStoredChunk();g&&0!==(h=h.getOffsetData()).s&&(c=r.getLWThick(),m=!1,null!==r.getColor()?l=r.getColor():m=!0,d=null!==r.getAlpha()?r.getAlpha():1,u=!1,p=new XeChunkPassOptions,o===n.Highlight?(u=!g.getSelectionGeom()&&!g.getHighlightIgnore(),p.setIfNotPassArray(["getSelectionGeom","getHighlightIgnore"])):o===n.SelectionSet?(u=!g.getSelectionGeom()&&!g.getSkipDrawOnSelection(),p.setIfNotPassArray(["getSelectionGeom","getSkipDrawOnSelection"])):(u=!g.getSelectionGeom()&&!g.getHighlightGeom()&&!g.getDrawOnSelection(),p.setIfNotPassArray(["getSelectionGeom","getHighlightGeom","getDrawOnSelection"])),m&&(u=!g.getSelectionGeom()&&!g.getHighlightGeom()&&!g.getDrawOnSelection(),p.setIfNotPassArray(["getSelectionGeom","getHighlightGeom","getDrawOnSelection"])),u)&&(m={order_base:.5,transform_base:this.getTransform(),xeGsOffsets:[h],colorArray:l,alpha:d,lwPx:c,bAddLw:!0,bDrawOutline:!0},g.drawChunk(e,XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,t,p,void 0,XeEntityPreview.prototype.on_draw_gl_callback,m))}}},XeEntityPreview.prototype.on_draw_gl_callback=function(e,t,i,r,n,o,a,s,c,l){},function(){let e=null;return e=e||this}),XeGripState=(XeEnumFactory.MakeEnum=function(e,t){let i=Object.values(e),r=Object.entries(e);if(i.includes(t))return n.Default=t,Object.assign(n,Object.freeze(e)),n.prototype.Get=function(){return this.m_Value},n.prototype.Is=function(e){return this.m_Value===e},n.prototype.Set=function(e){this.m_Value=e},n;throw new Error("Invalid enum's default value: "+t);function n(e){if(!i.includes(e)){if(void 0!==e)throw new Error("Invalid enum's value: "+e);e=t}this.m_EnumObj=r,this.m_Value=XeUtility.ValueOr(e,t);for(let i=0;i<r.length;++i){let[e,t]=r[i];this["Is"+e]=function(){return this.Is(t)},this["Get"+e]=function(){return t},this["Set"+e]=function(){this.Set(t)}}}},XeEnumFactory.MakeEnum(Object.freeze({Warm:1,Hover:2,Hot:3,Dragged:4}),1)),XeGiCircleArcSimplifier=function(e,t,i,r){var d=.3102637180713,u=.6897362819287,n=(this.vectorLength=function(e){var t=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return 0===t?0:Math.sqrt(Math.pow(e.x/t,2)+Math.pow(e.y/t,2)+Math.pow(e.z/t,2))*t},this.normalizeVector=function(e){var t=this.vectorLength(e);return{x:e.x/t,y:e.y/t,z:e.z/t}},this.perpVector=function(e){return e.x<.015625&&e.y<.015625?{x:e.z,y:0,z:-e.x}:{x:-e.y,y:e.x,z:0}},this.evalPoint=function(e){var t=Math.cos(e)*s,e=Math.sin(e)*s;return{x:n.x+a.x*t+(o.y*a.z-o.z*a.y)*e,y:n.y+a.y*t+(o.z*a.x-o.x*a.z)*e,z:n.z+a.z*t+(o.x*a.y-o.y*a.x)*e}},this.isEqual=function(e,t,i){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)<=Math.pow(i,2)},this.tesselate=function(e,t,i,r,n){if(!(20<n)){var o=this.evalPoint(e),a=this.evalPoint(t),s=.5*(e+t),c=this.evalPoint(s);if(this.isEqual(c,{x:.5*(o.x+a.x),y:.5*(o.y+a.y),z:.5*(o.z+a.z)},i)){var l=this.evalPoint(e*d+t*u);if(this.isEqual(l,{x:o.x*d+a.x*u,y:o.y*d+a.y*u,z:o.z*d+a.z*u},i)){l=this.evalPoint(e*u+t*d);if(this.isEqual(l,{x:o.x*u+a.x*d,y:o.y*u+a.y*d,z:o.z*u+a.z*d},i))return}}this.tesselate(e,s,i,r,n+1),r.push(c),this.tesselate(s,t,i,r,n+1)}},this.getSamplePoints=function(e,t,i,r){r.push(this.evalPoint(e)),this.tesselate(e,t,i,r,0),r.push(this.evalPoint(t))},e),o=this.normalizeVector(t),a=i?this.normalizeVector(i):this.normalizeVector(this.perpVector(t)),s=r},XeGiSimplifier=function(e){this.getXeViewport=function(){return e}},XeGrip=(XeGiSimplifier.prototype.debug=!1,XeGiSimplifier.prototype.bProcByGeWasm="true"!==getURLQueryParams("new-arc-circle"),XeGiSimplifier.prototype.maxLineCount=256,XeGiSimplifier.prototype.minLineCount=16,XeGiSimplifier.prototype.AVG_DIVIDER=4.4,XeGiSimplifier.prototype.TWOPI=6.283185307179586,XeGiSimplifier.prototype.getViewportMatrixFactor=function(e){if(window.fixAttribSegCalc()&&e.getChunk()){var e=e.getXeGsDevice().getOverallViewport(),t=this.getXeViewport();if(e&&t)if(e.m_VpNum!=t.m_VpNum)return t.worldToDeviceMatrix().scale()/e.worldToDeviceMatrix().scale()}return 1},XeGiSimplifier.prototype.process_arc=function(e,i,r){var n,o=e,a=o.getCenter(),s=o.getNormal(),c=o.getStartVector(),l=null,d=null,u=null,p=null;if(XeGiSimplifier.prototype.bProcByGeWasm){l=new GeNeo.OdGePoint3d(a[0],a[1],a[2]),d=new GeNeo.OdGeVector3d(s[0],s[1],s[2]),u=new GeNeo.OdGeVector3d(c[0],c[1],c[2]),p=o.getRadius(),n=o.getSweepAngle();let t;i?"MAX"===i?t=XeGiSimplifier.prototype.maxLineCount:"AVG"===i?(t=Math.floor(XeGiSimplifier.prototype.maxLineCount/XeGiSimplifier.prototype.AVG_DIVIDER))<XeGiSimplifier.prototype.minLineCount&&(t=XeGiSimplifier.prototype.minLineCount,XeGiSimplifier.prototype.debug)&&console.log("XeGiSimplifier.prototype.process_arc - min"):"MIN"===i?t=XeGiSimplifier.prototype.minLineCount:(y=XeGiSimplifier.prototype.TWOPI,(t=Math.ceil(y/GeNeo.maxArcStepAngle(i/(p*this.getViewportMatrixFactor(e)))))>XeGiSimplifier.prototype.maxLineCount?(t=XeGiSimplifier.prototype.maxLineCount,XeGiSimplifier.prototype.debug&&console.log("XeGiSimplifier.prototype.process_arc - max")):t<XeGiSimplifier.prototype.minLineCount&&(t=XeGiSimplifier.prototype.minLineCount,XeGiSimplifier.prototype.debug)&&console.log("XeGiSimplifier.prototype.process_arc - min")):t=XeGiSimplifier.prototype.minLineCount;var m=[],h=new GeWasm.OdGeCircArc3d(l,d,u,p,0,n);for(let e=0;e<t-1;e++){var g=+n/(t-1)*e,g=h.evalPoint(g);m.push(g)}var y=h.evalPoint(n),i=(m.push(y),h.delete(),XeGiSimplifier.prototype.bProcByGeWasm);XeGiSimplifier.prototype.bProcByGeWasm=!0,this.appendPoints(o,m,r),XeGiSimplifier.prototype.bProcByGeWasm=i}else{y=e.getXeGsDevice(),i=this.getXeViewport()?this.getXeViewport().getVpNum():0,e=y.getDeviation(i,o.getChunk()),l={x:a[0],y:a[1],z:a[2]},d={x:s[0],y:s[1],z:s[2]},u={x:c[0],y:c[1],z:c[2]},p=o.getRadius(),y=[];new XeGiCircleArcSimplifier(l,d,u,o.getRadius()).getSamplePoints(0,o.getSweepAngle(),e,y),this.appendPoints(o,y,r)}},XeGiSimplifier.prototype.process_ellipse=function(e,t,i){for(var r,n=e,o=n.getCenter(),a=n.getxDir(),s=n.getyDir(),c=n.getMajorRadius(),l=n.getMinorRadius(),d=n.getStartAng(),u=n.getEndAng(),o=new GeNeo.OdGePoint3d(o[0],o[1],o[2]),a=new GeNeo.OdGeVector3d(a[0],a[1],a[2]),s=new GeNeo.OdGeVector3d(s[0],s[1],s[2]),p=XeGiSimplifier.prototype.TWOPI,m=(t?"MAX"===t?r=XeGiSimplifier.prototype.maxLineCount:"AVG"===t?(r=Math.floor(XeGiSimplifier.prototype.maxLineCount/XeGiSimplifier.prototype.AVG_DIVIDER))<XeGiSimplifier.prototype.minLineCount&&(r=XeGiSimplifier.prototype.minLineCount,XeGiSimplifier.prototype.debug)&&console.log("XeGiSimplifier.prototype.process_ellipse - min"):"MIN"===t?r=XeGiSimplifier.prototype.minLineCount:(r=Math.ceil(p/GeNeo.maxArcStepAngle(t/(c*this.getViewportMatrixFactor(e)))))>XeGiSimplifier.prototype.maxLineCount?(r=XeGiSimplifier.prototype.maxLineCount,XeGiSimplifier.prototype.debug&&console.log("XeGiSimplifier.prototype.process_ellipse - max")):r<XeGiSimplifier.prototype.minLineCount&&(r=XeGiSimplifier.prototype.minLineCount,XeGiSimplifier.prototype.debug)&&console.log("XeGiSimplifier.prototype.process_ellipse - min"):r=XeGiSimplifier.prototype.minLineCount,[]),h=new GeWasm.OdGeEllipArc3d(o,a,s,c,l,d,u),g=0;g<r-1;g++){var y=h.evalPoint(d+(u-d)/(r-1)*g);m.push(y)}p=h.evalPoint(u),m.push(p),h.delete(),t=XeGiSimplifier.prototype.bProcByGeWasm;XeGiSimplifier.prototype.bProcByGeWasm=!0,this.appendPoints(n,m,i),XeGiSimplifier.prototype.bProcByGeWasm=t},XeGiSimplifier.prototype.process_circle=function(e,i,r){var n=e,o=n.getCenter(),a=n.getNormal();if(XeGiSimplifier.prototype.bProcByGeWasm){var s=new GeNeo.OdGePoint3d(o[0],o[1],o[2]),c=new GeNeo.OdGeVector3d(a[0],a[1],a[2]),l=n.getRadius(),d=XeGiSimplifier.prototype.TWOPI,u=d;let t;i?"MAX"===i?t=XeGiSimplifier.prototype.maxLineCount:"AVG"===i?(t=Math.floor(XeGiSimplifier.prototype.maxLineCount/XeGiSimplifier.prototype.AVG_DIVIDER))<XeGiSimplifier.prototype.minLineCount&&(t=XeGiSimplifier.prototype.minLineCount,XeGiSimplifier.prototype.debug)&&console.log("XeGiSimplifier.prototype.process_circle - min"):"MIN"===i?t=XeGiSimplifier.prototype.minLineCount:(t=Math.ceil(d/GeNeo.maxArcStepAngle(i/(l*this.getViewportMatrixFactor(e)))))>XeGiSimplifier.prototype.maxLineCount?(t=XeGiSimplifier.prototype.maxLineCount,XeGiSimplifier.prototype.debug&&console.log("XeGiSimplifier.prototype.process_circle - max")):t<XeGiSimplifier.prototype.minLineCount&&(t=XeGiSimplifier.prototype.minLineCount,XeGiSimplifier.prototype.debug)&&console.log("XeGiSimplifier.prototype.process_circle - min"):t=XeGiSimplifier.prototype.minLineCount;var p=[],m=new GeWasm.OdGeCircArc3d(s,c,l);for(let e=0;e<t-1;e++){var h=+u/(t-1)*e,h=m.evalPoint(h);p.push(h)}d=m.evalPoint(u),i=(p.push(d),m.delete(),XeGiSimplifier.prototype.bProcByGeWasm);XeGiSimplifier.prototype.bProcByGeWasm=!0,this.appendPoints(n,p,r),XeGiSimplifier.prototype.bProcByGeWasm=i}else{s=e.getXeGsDevice(),c=this.getXeViewport()?this.getXeViewport().getVpNum():0,l=s.getDeviation(c,n.getChunk()),d={x:o[0],y:o[1],z:o[2]},i={x:a[0],y:a[1],z:a[2]},e=n.getRadius(),s=[];new XeGiCircleArcSimplifier(d,i,null,e).getSamplePoints(0,2*Math.PI,l,s),this.appendPoints(n,s,r)}},XeGiSimplifier.prototype.process_spline=function(e,t,i){var r=e.getDegree(),n=e.getPeriodic(),o=e.getControlPoints(),a=e.getKnots(),s=e.getTolerance(),r=GeWasm.OdGeNurbCurve3d.create(r,a,s,o,n);r&&(a=r.getSamplePoints(t),s=XeGiSimplifier.prototype.bProcByGeWasm,XeGiSimplifier.prototype.bProcByGeWasm=!0,this.appendPoints(e,a,i),XeGiSimplifier.prototype.bProcByGeWasm=s,r.delete())},XeGiSimplifier.prototype.appendPoints=function(e,t,i){var r=t instanceof Array,n=r?t.length:t.Count,o=i.getLineStripsStorage(t.length),a=o.storage.indices.length;if(0<n){var s=n,c=e.getOrder(),l=r?t[0]:t.get_Item(0);o.storage.vertices.push(l.x),o.storage.vertices.push(l.y),o.storage.vertices.push(l.z),o.storage.orders.push(c);for(let e=1;e<s;e++){var l=r?t[e]:t.get_Item(j),d=o.storage.vertices.length/3;o.storage.vertices.push(l.x),o.storage.vertices.push(l.y),o.storage.vertices.push(l.z),o.storage.orders.push(c),o.storage.indices.push(d-1),o.storage.indices.push(d)}}n=o.storage.indices.length;o.mapper.map(i.itemIndex,a,n-a)},function(e,t,i){this.m_GripPoint=e,this.m_Index=t,this.m_EntityId=i,this.m_State=new XeGripState,this.m_IsHidden=!1,this.m_IsShared=!1}),XeCustomGrip=(XeGrip.prototype.ClassName=function(){return this.constructor.name},XeGrip.prototype.GripPoint=function(){return this.m_GripPoint},XeGrip.prototype.DragPoint=function(){return this.m_GripPoint},XeGrip.prototype.Index=function(){return this.m_Index},XeGrip.prototype.EntityId=function(){return this.m_EntityId},XeGrip.prototype.State=function(){return this.m_State},XeGrip.prototype.IsHidden=function(){return this.m_IsHidden},XeGrip.prototype.SetHidden=function(e){this.m_IsHidden=Boolean(e)},XeGrip.prototype.IsShared=function(){return this.m_IsShared},XeGrip.prototype.IsSharedWith=function(e){var t;return!!e&&(t=new GeNeo.OdGePoint3d(this.GripPoint()),e=new GeNeo.OdGePoint3d(e.GripPoint()),t.isEqualTo(e,.1))},XeGrip.prototype.SetShared=function(e){this.m_IsShared=Boolean(e)},XeGrip.prototype.HasEditCommand=function(){return!0},XeGrip.prototype.HasHotStateHandler=function(){return!1},XeGrip.prototype.ResetState=function(){this.m_State.SetWarm()},XeGrip.prototype.IsCustomGrip=function(){return!1},XeGrip.prototype.IsTriggerGrip=function(){return!1},XeGrip.prototype.GetEntity=function(){return XeCommonData.FindEntityById(this.m_EntityId)},XeGrip.prototype.GripPointGe3d=function(){return new GeNeo.OdGePoint3d(this.m_GripPoint)},XeGrip.prototype.GripPointSCS=function(e){return(e||=XeCommonData.ActiveViewport()).PointToSCS(this.GripPoint())},XeGrip.prototype.IsMouseOver=function(e,t){var i;return XeUtility.IsNullish(e)&&(e=[(i=XeCommonData.MousePosition()).x,i.y],t=!0),(!t||!this.IsHidden())&&(i=XeCommonData.Database().getGRIPSIZE(),t=this.GripPointSCS(),window.XeUtils.SquaredDistance(e,t)<=Math.pow(i,2))},XeGrip.prototype.Shape=function(){return XeBlockCustomGrip.ShapeEnum.Square},XeGrip.prototype.SizeInPixels=function(){return XeCommonData.Database().getGRIPSIZE()},XeGrip.prototype.GripSize=function(e){return e||=XeCommonData.ActiveViewport(),this.SizeInPixels()*(1/e.numPixelsUnitSquare())},XeGrip.prototype.GripColor=function(){var e=XeGripState,t=XeCommonData.Database();switch(this.State().Get()){case e.Hot:case e.Dragged:return t.getGRIPHOT();case e.Hover:return t.getGRIPHOVER();default:return t.getGRIPCOLOR()}},XeGrip.prototype.GripAlpha=function(){return XeCommonData.XeProfile().getGripAlpha()},XeGrip.prototype.EnableBorder=function(e){this.m_Border=e},XeGrip.prototype.UpdateDrawContext=function(e){var t=this.GripColor(),i=this.GripAlpha(),[r,n,o]=this.m_Border?[255,255,0]:[127,127,127],t=window.XeUtils.intRGBAToHex(t,i),i=window.XeUtils.rgbaToHex(r,n,o,255);e.fillStyle=t,e.strokeStyle=i},XeGrip.prototype.DrawGrip=function(e){var t,i,r;this.IsHidden()||([t,i]=this.GripPointSCS(e.m_XeViewport),r=this.SizeInPixels(),(e=e.ctx).save(),this.UpdateDrawContext(e),e.beginPath(),e.rect(t-r,i-r,2*r,2*r),e.fill(),e.stroke(),e.restore())},function(e,t,i,r,n){Object.assign(this,r),Object.assign(this,n),XeGrip.call(this,e,t,i)}),XePolylineGrip=(XeCustomGrip.prototype=Object.create(XeGrip.prototype),XeCustomGrip.prototype.constructor=XeCustomGrip,XeCustomGrip.prototype.IsCustomGrip=function(){return!0},XeCustomGrip.prototype.IsTriggerGrip=function(){return this.m_IsTriggerGrip},XeCustomGrip.prototype.MenuType=function(){return XeGripMenu.MenuTypes.None},XeCustomGrip.prototype.HasHotFunc=function(){return this.m_HasHotFunc},XeCustomGrip.prototype.HasMenuFunc=function(){return this.m_HasMenuFunc},XeCustomGrip.prototype.HasHotStateHandler=function(){return this.HasHotFunc()||this.HasMenuFunc()},function(e,t,i,r,n){XeCustomGrip.call(this,e,t,i,r,n)}),XeBlockCustomGrip=(XePolylineGrip.prototype=Object.create(XeCustomGrip.prototype),XePolylineGrip.prototype.constructor=XePolylineGrip,XePolylineGrip.TypeEnum=Object.freeze({Normal:0,Round:1}),XePolylineGrip.prototype.GripType=function(){return this.m_GripType},XePolylineGrip.prototype.Shape=function(){var e=XeBlockCustomGrip.ShapeEnum;return this.IsSegmentGrip()?e.Round:e.Square},XePolylineGrip.prototype.IsEndGrip=function(){var e=XePolylineGrip.TypeEnum;return this.GripType()===e.Normal},XePolylineGrip.prototype.IsSegmentGrip=function(){return!1===this.IsEndGrip()},XePolylineGrip.prototype.MenuType=function(){return XeGripMenu.MenuTypes.Hover},XePolylineGrip.prototype.GripColor=function(){var e=XeGrip.prototype.GripColor.call(this),t=XeCommonData.Database().getGRIPDYNCOLOR();return this.State().IsWarm()&&this.IsSegmentGrip()?t:e},XePolylineGrip.prototype.DrawGrip=function(e){if(!this.IsHidden()){var[t,i]=this.GripPointSCS(e.m_XeViewport),r=this.SizeInPixels(),n=e.ctx,e=(n.save(),this.UpdateDrawContext(n),XePolylineGrip.TypeEnum);switch(n.beginPath(),this.GripType()){case e.Normal:n.rect(t-r,i-r,2*r,2*r);break;case e.Round:n.arc(t,i,r,0,2*Math.PI,!1);break;default:return}n.fill(),n.stroke(),n.restore()}},function(e,t,i,r,n,o){XeCustomGrip.call(this,e,t,i,r,n),o&&(o.m_BlockType=this.m_BlockType,this.m_MarkerDrawer=XeBlockMarkerDrawer.MakeDrawer(o))}),XeBlockMarkerDrawer=(XeBlockCustomGrip.prototype=Object.create(XeCustomGrip.prototype),XeBlockCustomGrip.prototype.constructor=XeBlockCustomGrip,XeBlockCustomGrip.ShapeEnum=Object.freeze({Square:0,Round:1,Triangle:2,Arrow:3,CenteredArrow:4,StripeTriangle:5,WedgeArrow:6,CenteredWedgeArrow:7}),XeBlockCustomGrip.BlockTypeEnum=Object.freeze({Default:1,Dynamic:2,Custom:3}),XeBlockCustomGrip.prototype.BlockType=function(){return this.m_BlockType},XeBlockCustomGrip.prototype.Direction=function(){return this.m_Direction},XeBlockCustomGrip.prototype.Normal=function(){return this.m_Normal},XeBlockCustomGrip.prototype.Shape=function(){return this.m_Shape},XeBlockCustomGrip.prototype.ToolTipText=function(){return this.m_ToolTip},XeBlockCustomGrip.prototype.DragPoint=function(){return this.m_AltBasePoint||this.m_GripPoint},XeBlockCustomGrip.prototype.HasEditCommand=function(){var e=XeBlockCustomGrip.ShapeEnum;return this.Shape()!==e.StripeTriangle},XeBlockCustomGrip.prototype.MenuType=function(){var e=XeBlockCustomGrip.ShapeEnum,t=XeGripMenu.MenuTypes;return this.Shape()!==e.StripeTriangle?t.None:t.Click},XeBlockCustomGrip.prototype.IsDefaultGrip=function(){return this.m_IsDefault},XeBlockCustomGrip.prototype.GripColor=function(){var e=XeGrip.prototype.GripColor.call(this),t=XeCommonData.Database().getGRIPDYNCOLOR();return this.State().IsWarm()&&!this.IsDefaultGrip()?t:e},XeBlockCustomGrip.prototype.DrawGrip=function(i){if(clearTimeout(this.m_TimeoutId),!this.IsHidden()){let r=i.ctx,n=(r.save(),this.UpdateDrawContext(r),this.GripSize()),e=this.SizeInPixels(),o=i.m_XeViewport,a=this.GripPointGe3d(),t=this.GripPointSCS(o),s=new GeNeo.OdGeVector3d(this.Normal()),c=new GeNeo.OdGeVector3d(this.Direction()),l=XeBlockCustomGrip.ShapeEnum;var m=XeBlockCustomGrip.BlockTypeEnum;let d=this.Shape();var h,g,y,f,_=this.State();let u=this.BlockType()===m.Custom,p=u?.7:1;switch(d){case l.Square:var[w,v]=t,C=e;r.beginPath(),r.rect(w-C,v-C,2*C,2*C),r.fill(),r.stroke();break;case l.Round:var[w,v]=t,C=e;r.beginPath(),r.arc(w,v,C,0,2*Math.PI,!1),r.fill(),r.stroke();break;case l.Triangle:h=1.2*n,s.isCodirectionalTo(c)&&(c=s.perpVector()).normalize(),g=new GeNeo.OdGeVector3d(c),y=g.crossProduct(s).negate(),(f=new Array(4))[0]=a.add(g.mult(2*h)),f[1]=a.sub(g.sub(y).mult(h)),f[2]=a.sub(g.add(y).mult(h)),f[3]=f[0].getCopy(),X(f);break;case l.StripeTriangle:{let e=2*n*p,{x:t,y:i}=a,r=new Array(5);r[0]=new GeNeo.OdGePoint2d(t-e,i+e-e/6),r[1]=new GeNeo.OdGePoint2d(t-e,i+e+e/6),r[2]=new GeNeo.OdGePoint2d(t+e,i+e+e/6),r[3]=new GeNeo.OdGePoint2d(t+e,i+e-e/6),r[4]=r[0].getCopy(),X(r),(r=new Array(4))[0]=new GeNeo.OdGePoint2d(t-e,i+e-3*e/6),r[1]=new GeNeo.OdGePoint2d(t+e,i+e-3*e/6),r[2]=new GeNeo.OdGePoint2d(t,i-2*e+e),r[3]=r[0].getCopy(),X(r)}break;case l.Arrow:case l.CenteredArrow:{let e=2*n*p,t=c.mult(e),i=new GeNeo.OdGeVector3d(t),r=(i.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),i.multAssign(.75),new Array(8));r[0]=a.add(i.mult(.5)),r[1]=a.add(i),r[2]=a.add(t),r[3]=a.sub(i),r[4]=a.sub(i.mult(.5)),r[5]=a.sub(t.mult(.75).add(i.mult(.5))),r[6]=a.sub(t.mult(.75).sub(i.mult(.5))),r[7]=r[0].getCopy(),X(r)}break;case l.WedgeArrow:case l.CenteredWedgeArrow:{let i=2*n*p,e=new Array(6);if(u){let t=new GeNeo.OdGeVector3d(c);var T=t.crossProduct(s).negate().mult(.75),b=t.uminus();e[0]=a.add(b.add(t.mult(.25)).add(T).mult(i)),e[1]=a.add(b.add(t).mult(i)),e[2]=a.add(b.add(t.mult(.25)).sub(T).mult(i)),e[3]=a.add(b.sub(t.mult(.5)).sub(T).mult(i)),e[4]=a.add(b.sub(t.mult(.5)).add(T).mult(i)),e[5]=e[0].getCopy(),d===l.CenteredWedgeArrow&&e.forEach(e=>e.addAssign(t.mult(i)))}else{b=c.mult(i),T=new GeNeo.OdGeVector3d(b);T.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),e[0]=a.add(b.mult(.5)).add(T.mult(.5)),e[1]=e[0].sub(T),e[2]=e[1].sub(b),e[3]=a.sub(b.mult(.5)).add(T.mult(.5)),e[4]=a.add(T),e[5]=e[0].getCopy()}X(e)}}function X(t){r.beginPath();var e=o.PointToSCS(t[0].x,t[0].y);r.moveTo(e[0],e[1]);for(let e=1;e<t.length;++e){var i=o.PointToSCS(t[e].x,t[e].y);r.lineTo(i[0],i[1])}r.closePath(),r.fill(),r.stroke()}_.IsDragged()&&this.m_MarkerDrawer&&this.m_MarkerDrawer.Draw(i),r.restore(),_.IsHover()&&(this.m_TimeoutId=setTimeout(()=>{this.DrawToolTip(i)},250))}},XeBlockCustomGrip.prototype.DrawToolTip=function(e){var t,i,r,n,o,a;this.m_ToolTip&&this.State().IsHover()&&!(t=XeCommonData.GripManager()).IsBusy()&&!t.IsMenuOpened()&&(t=e.ctx,e=e.m_XeViewport,t.save(),t.font="13px Arial",t.strokeStyle="#ffffff",t.fillStyle="#000000",t.lineWidth=1,i=this.ToolTipText(),[e,r]=this.GripPointSCS(e),n=e+14-4,o=r+14-4,a=t.measureText(i).width+8,t.fillRect(n,o,a,24),t.strokeRect(n,o,a,24),t.fillStyle="#ffffff",t.fillText(i,n=e+14,o=r+13+14),t.restore())},function(e){this.m_MarkersData=e});XeBlockMarkerDrawer.MarkerTypeEnum=Object.freeze({Rotation:1,Linear:2,XY:3,Invalid:4}),XeBlockMarkerDrawer.prototype.Draw=function(e){},XeBlockMarkerDrawer.MakeDrawer=function(e){if(!e)return null;var t=XeBlockCustomGrip.BlockTypeEnum;switch(e.m_BlockType){case t.Custom:return new XeCustomBlockMarkerDrawer(e);case t.Dynamic:return new XeDynBlockMarkerDrawer(e);default:return null}},XeBlockMarkerDrawer.GetScale=function(e,t){return XeCommonData.Database().getGRIPSIZE()*(t||1)*(1/e.numPixelsUnitSquare())},XeBlockMarkerDrawer.GetColor=function(){return window.XeUtils.rgbToHex(127,127,127)},XeBlockMarkerDrawer.DrawMarker=function(e,t){var i,r;XeUtility.IsNonEmptyArray(t,2)&&(i=(r=e.m_XeViewport).PointToSCS(t[0].x,t[0].y),r=r.PointToSCS(t[1].x,t[1].y),(t=e.ctx).moveTo(i[0],i[1]),t.lineTo(r[0],r[1]),t.stroke())};class XeCustomBlockMarkerDrawer extends XeBlockMarkerDrawer{constructor(e){super(e)}Draw(t){var i=this.m_MarkersData;if(XeUtility.IsNonEmptyArray(i)){var e=t.m_XeViewport,r=XeBlockMarkerDrawer.GetScale(e);for(let e=0;e<i.length;++e){var{m_Point:n,m_Vector:o}=i[e],n=new GeNeo.OdGePoint3d(n),o=new GeNeo.OdGeVector3d(o).mult(r),a=[];a.push(n.sub(o)),a.push(n.add(o)),XeBlockMarkerDrawer.DrawMarker(t,a)}}}}var XeDynBlockMarkerDrawer=(()=>{function e(e){XeBlockMarkerDrawer.call(this,e)}(e.prototype=Object.create(XeBlockMarkerDrawer.prototype)).constructor=e;var t=XeBlockMarkerDrawer.MarkerTypeEnum;let r=new Map([[t.Rotation,function(e,t){if(e){var i=e.m_Radius,r=e.m_Angles||[],n=new GeNeo.OdGePoint3d(e.m_BasePoint);for(let e=0;e<r.length;++e){var o=r[e],o=new GeNeo.OdGeVector3d(Math.cos(o),Math.sin(o),0),a=n.add(o.mult(i));_(t,a,o)}}}],[t.Linear,n],[t.XY,function(e,t){var i;e&&(i=e.m_DataX,e=e.m_DataY,i)&&e&&(n(i,t),n(e,t))}]]),f=Object.freeze({Start:0,Mid:1});function n(e,n){if(e){var o=new GeNeo.OdGePoint3d(e.m_BasePoint),a=new GeNeo.OdGePoint3d(e.m_EndPoint),s=new GeNeo.OdGeVector3d(e.m_Direction),c=new GeNeo.OdGeVector3d(e.m_MarkDirection),i=e.m_Values,l=e.m_BaseLocation,d=new GeNeo.OdGeMatrix3d(e.m_BlockTransform);if(XeUtility.IsNonEmptyArray(i)){var u=e.m_DefinitionData;if(u){for(let t=0;t<i.length;++t){var r=i[t];let e=new GeNeo.OdGePoint3d;switch(l){case f.Start:e=o.add(s.mult(r));break;case f.Mid:(e=o.add(a.sub(o).mult(.5))).addAssign(s.mult(.5*r))}_(n,e.transformBy(d),c)}if(0<i.length){var p=new GeNeo.OdGePoint3d(u.m_BasePoint),m=new GeNeo.OdGePoint3d(u.m_EndPoint),u=new GeNeo.OdGeVector3d(u.m_Direction);let e=m.sub(p).dotProduct(u);e=Math.abs(e),l===f.Mid&&(e*=1.5);m=o.add(s.mult(e));m.transformBy(d),_(n,m,c)}}}else{p=e.m_IncrementData;if(p){let t=p.m_Increment,i=p.m_Minimum,r=p.m_Maximum;var u=n.m_XeViewport,[m,e]=(XeUtility.IsNullish(r)&&(m=u.getFieldWidth(),e=u.getFieldHeight(),p=Math.sqrt(m*m+e*e),r=p),l===f.Mid&&(t/=2,r/=2,i/=2,o.addAssign(a.sub(o).mult(.5))),u.numPixelsUnitSquareXY()),p=d.multToVector(s).mult(t),u=1/Math.min(m,e);if(!(u>p.length()))for(var h of[-1,1]){let e=0<h?0:1;for(;;){var g=a.add(s.mult(h*e*t)),y=g.sub(o).dotProduct(s);if(h<0&&GeNeo.OdLess(y,i))break;if(GeNeo.OdLess(r,y))break;_(n,g.transformBy(d),c),++e}}}}}}function _(e,t,i){var r=e.ctx,r=(r.strokeStyle=XeBlockMarkerDrawer.GetColor(),r.beginPath(),e.m_XeViewport),r=XeBlockMarkerDrawer.GetScale(r),i=i.mult(r),r=[];r.push(t.add(i)),r.push(t.sub(i)),XeBlockMarkerDrawer.DrawMarker(e,r)}return e.prototype.Draw=function(e){var t,i=this.m_MarkersData;i&&(t=i.m_MarkerType)&&r.get(t)(i,e)},e})(),XeGripManager=(()=>{let e=null,n=null,o=[],a=new Set,s=null,c=!1,l=0;function t(){return e||(document.addEventListener("XeCommandProcessor",function(e){!1===e.m_Started&&(c=!1,s.Reset())}),document.addEventListener("XeGripMenu.Hide",function(e){p()||i(),s.Reset()}),document.addEventListener("XeGripMenu.CommandStarted",function(e){d(XeGripState.Dragged),s.Reset()}),document.addEventListener("Update_XeSelectionSet",function(e){e=e.m_Item;e.getXeDocument().getXeInputPointManager().getHitTestInfo().IsKeyEscape()&&u(),e.IsMainSelectionSet()&&0===e.m_Handles.length&&u()}),s=new XeGripMenuManager,e=this),e}return t.prototype={Update:function(){if(!c&&!(0<l||XeCommonData.IsInsideCommand()||p()||s.IsOpened())){let t=XeCommonData.MousePosition(),i=[];var e=function(e){i.push(...e.FindGripsAt(t))};if(XeCommonData.MainSelectionSetEntities().forEach(e),0===i.length)r(null);else{let t=i.shift();o=[];e=function(e){t.IsSharedWith(e)&&(e.SetShared(!0),e.SetHidden(!0),o.push(e))};i.forEach(e),0<o.length&&t.SetShared(!0),r(t)}}},Activate:function(e){var t,i,r;c||e&&(s.Reset(),t=XeCommonData.ActiveDoc(),i=XeCommonData.XeInputManager(),XeCommonData.HitTestInfo().IsShiftPressed()?((r=e).HasHotStateHandler()||r.IsTriggerGrip()||(r.State().IsHot()?(a.delete(r),r.ResetState()):(r.State().SetHot(),a.add(r))),i.SetClientPending(!1)):(n=e).IsCustomGrip()&&e.HasMenuFunc()?(d(XeGripState.Hot),s.SetGrip(e)&&s.Start()):(l++,r=(()=>{var e=(e=new Set([n,...o])).union(a);return e={Grips:e=Array.from(e,e=>h(e)),TargetGrip:h(n)}})(),i=t.MakeCustomRequest(r,"RequestGripEdit"),a.has(e)||d(XeGripState.Dragged),i.then(function(e){l--,e||(c=!1)})))},IsMenuOpened:function(){return s.IsOpened()},IsCommandRunning:m,IsBusy:function(){return!!c||0<l},HandleEnterKey:function(e){return XeGripMenu.HandleEnterKeyDown(e)},MenuManager:function(){return s}},t;function d(e){var t=n;!t||(t=t.State()).Is(e)||(t.Set(e),c=t.IsDragged())}function r(e){e?a.has(e)||(e!==n&&(i(),n=e),d(XeGripState.Hover),XeCommonData.HitTestInfo().IsShiftPressed())||s.SetGrip(e)&&s.Start():(i(),o=[])}function i(){var e=n;e&&!a.has(e)&&(e.ResetState(),s.Reset(),n=null)}function u(){for(var e of a)e.ResetState();a.clear()}function p(){return n&&n.IsMouseOver()}function m(){return c}function h(e){return{EntityId:e.EntityId(),Index:e.Index(),HasHotState:e.State().IsHot()}}})(),XeGripMenuManager=(()=>{let e=null,t=null;function i(){return e=e||this}return i.prototype={SetGrip:function(e){e.State().IsHover()&&(t=new XeHoverGripMenu(e));e.State().IsHot()&&(t=new XeClickGripMenu(e));return XeUtility.IsNotNullish(t)},Start:function(){t&&t.ShowMenu()},Reset:function(){t&&(t.Reset(),t=null)},IsOpened:function(){return!!t&&t.IsOpened()},MenuType:function(){return t?t.MenuType():XeGripMenu.MenuTypes.None}},i})();class XeGripMenu{static get MenuTypes(){return Object.freeze({None:1,Click:2,Hover:3})}static IsValidGrip(e,t){return!(!e||!e.IsCustomGrip()||e.IsShared()||e.IsHidden()||e.MenuType()!==t)}static RequestMenu(e){e={EntityId:e.EntityId(),Index:e.Index(),MenuType:e.MenuType()};return XeCommonData.ActiveDoc().MakeCustomRequest(e,"RequestGripMenu")}static HandleEnterKeyDown(e){var t,i;return"Enter"===e.key&&!XeCommonData.XeInputManager().getInsideCommand()&&(t=document.querySelector(".XeGripMenuOpen li.active a"),!XeUtility.IsNullish(t))&&(i=t.querySelector("input.Wt-chkbox"),e.preventDefault(),(XeUtility.IsNullish(i)?t:i).click(),!0)}}var XeClickGripMenu=(()=>{let t=null,i=!1,r=null,n=!1,o=XeGripMenu.MenuTypes.Click;function e(e){return XeGripMenu.IsValidGrip(e,o)?(t||(document.addEventListener("click",function(e){n&&(e.stopImmediatePropagation(),n=!1)}),document.addEventListener("XeGripMenu.Hide",function(e){a()}),t=this),a(),r=e,t):(a(),null)}return e.prototype={Reset:a,ShowMenu:function(){var e;s()&&(i=!0,n=!0,null!==(e=XeGripMenu.RequestMenu(r)))&&e.then(function(e){e||a()})},IsValid:s,IsOpened:function(){return i},MenuType:function(){return o}},e;function a(){r=null,i=!1,n=!1}function s(){return!XeCommonData.GripManager().IsBusy()&&!!XeGripMenu.IsValidGrip(r,o)&&XeCommonData.HitTestInfo().IsMouseDown()}})();let XeHoverGripMenu=(()=>{let t=null,o=null,i=!1,r=null,a=null,n=XeGripMenu.MenuTypes.Hover;function e(e){return XeGripMenu.IsValidGrip(e,n)?(t=t||this,s(),o=e,t):(s(),null)}return e.prototype={Reset:s,ShowMenu:function(){if(i||!c())return!1;i=!0;var e=function(){var e=XeGripMenu.RequestMenu(o);null!==e&&(e.then(function(e){if(e){let r=document.querySelector(".XeGripMenuOpen");if(!XeUtility.IsNullish(r)&&o){var e=r.getBoundingClientRect(),[t,n]=[...o.GripPointSCS()];a={X:t-5,Y:n-5,X2:t+10+e.width,Y2:n+10+e.height},document.addEventListener("mousemove",l),r.addEventListener("mouseenter",function(){a=null,document.removeEventListener("mousemove",l)});let i=document.getElementById("pop-up-menu-ga-blocker");XeUtility.IsNullish(i)||(i.onmousedown=function(e){i.parentNode.removeChild(i);var t=o,e=[e.clientX,e.clientY];Wt.emit(r,"XeGripMenu.MouseLeaveSignal"),t.IsMouseOver(e,!0)&&XeCommonData.XeInputManager().ProcessLeftMouseDown()})}}else s()}),clearTimeout(r),r=null)};return r=setTimeout(e,300),!0},IsValid:c,IsOpened:function(){return i},MenuType:function(){return n}},e;function s(){o=null,i=!1,a=null,clearTimeout(r),r=null}function c(){return!XeCommonData.GripManager().IsBusy()&&!!XeGripMenu.IsValidGrip(o,n)&&o.IsMouseOver()}function l(e){var t,i=document.querySelector(".XeGripMenuOpen");XeUtility.IsNullish(i)||XeUtility.IsNullish(a)||(t=(e=e).clientX,e=e.clientY-XeCommonData.GetRibbonHeight(),!(t<a.X||e<a.Y)&&t<=a.X2&&e<=a.Y2)||(a=null,document.removeEventListener("mousemove",l),Wt.emit(i,"XeGripMenu.MouseLeaveSignal"))}})();var XeGsOffsetsHelper={XeGsOffsetsIntersectMethod:{kAddTo:0,kRemoveFrom:1},IntersectXeGsOffsets:function(e,t,i,r){for(var n=(r=r||this.XeGsOffsetsIntersectMethod.kAddTo)===this.XeGsOffsetsIntersectMethod.kAddTo,o=r===this.XeGsOffsetsIntersectMethod.kRemoveFrom,a=t,s=t+i,c=!1,l=0;l<e.length;l++){var d=e[l],u=d.o,p=d.o+d.s;if(s<=u){if(n){s<u?e.unshift({o:t,s:i}):s===u&&(d.o=t,d.s=d.s+i),c=!0;break}}else if(a<u&&p<s){if(n){d.o=t,d.s=i,c=!0;break}o&&(e.splice(l,1),l--)}else{if(a<=u&&u<s&&s<=p){if(n)d.o=a,d.s=s-a+(p-s);else if(o){if(s===p){e.splice(l,1),l--;continue}d.o=s,d.s=p-s}c=!0;break}if(u<a&&s<p){o&&(e.splice(l,1,{o:u,s:a-u}),e.splice(l+1,0,{o:s,s:p-s})),c=!0;break}if(u<=a&&a<p&&p<=s){if(n)d.o=u,d.s=d.s+(s-p);else if(o){if(u==a){e.splice(l,1),l--;continue}d.o=u,d.s=a-u}c=!0;break}}}!c&&n&&e.push({o:t,s:i})}};function XeImage(e){var r=this;r.imageLoaded=!1,r.path=e,r.img=new Image,r.img.crossOrigin="anonymous",r.img.addEventListener("load",function(){r.imageLoaded=!0,r.onload(r)},!1),document.addEventListener("Update_XeGsDevice",function(e){var t=r.img.src,i=window.getXeApplication().getBaseUrl()+r.path;t.indexOf(i)<0&&(r.imageLoaded=!1,r.img.src=i)}),r.onload=function(e){},r.load=function(){try{var e=window.getXeApplication().getBaseUrl()+r.path;r.imageLoaded=!1,r.img.src=e}catch(e){}}}var XeIndexMapper=function(){this.m_Map=new Map,this.m_bBypass=!1},XeLineweightUtils=(XeIndexMapper.prototype.getByXeOffsets=function(e){if(this.m_bBypass)return e;var t=[],i=this.m_Map;if(!this.isMapped())return[];for(var r=0;r<e.length;r++)for(var n=e[r],o=n.o;o<n.o+n.s;o++)i.has(o)&&(0<t.length&&t[t.length-1].o+t[t.length-1].s===i.get(o).o?t[t.length-1].s+=i.get(o).s:t.push({o:i.get(o).o,s:i.get(o).s}));return t=this.next&&this.next instanceof XeIndexMapper?this.next.getByXeOffsets(t):t},XeIndexMapper.prototype.map=function(e,t,i){this.m_bBypass||this.m_Map.set(e,{o:t,s:i})},XeIndexMapper.prototype.remove=function(e){return this.m_Map.delete(e)},XeIndexMapper.prototype.get=function(e){return this.m_Map.get(e)},XeIndexMapper.prototype.isMapped=function(){return 0<this.m_Map.size},XeIndexMapper.prototype.clear=function(){this.m_Map.clear()},XeIndexMapper.prototype.setBypass=function(e){this.m_bBypass=e},function(){var n=this;function o(e,t){var i,r=-1;return!n.useModelSpaceLwAlways()&&e.getXeGsDevice().getOverallViewport()?-1!==(i=(e=>{var t=e.getXeGsDevice();if(!e)return-1;var t=t.getUnitsPerMM(),i=-1;if(e.getOverall())i=t;else{var r=e.getXeGsDevice().getOverallViewport();if(!r)return-1;var n=r.screenRect(),o=e.screenRect(),a=1/r.getFieldWidth()*Math.floor(n.xmax-n.xmin),r=1/r.getFieldHeight()*Math.floor(n.ymax-n.ymin),n=1/e.getFieldWidth()*Math.floor(o.xmax-o.xmin),e=1/e.getFieldHeight()*Math.floor(o.ymax-o.ymin);i=(a/n*t+r/e*t)/2}return i})(e))&&(r=.01*t/2*i):1<(i=n.getStndLineWeightPxSize(t,!0))&&(r=n.GetLineWeightInUnitsFromPixels(e,i)),r}n.IndexedBuilder=function(){this.proc=function(e,t,i,r,n){n&&((n=new GeNeo.OdGeMatrix3d(n)).setentry(0,3,0),n.setentry(1,3,0),n.setentry(2,3,0));for(var o=0,a=0,s=0,s=0;s<e.length;s+=2)0===e[s]&&0===e[s+1]||(o+=6,a+=4);var c,l=XeWebGlRenderer.prototype.getIndexArrayType(o),d=0,u=new Float32Array(3*a),p=0,m=r,h=0,g=0,y=0,f=new Float32Array(3*a),_=0,w=new Float32Array(3*a),v=0,C=new Float32Array(3*a),T=0,b=new Float32Array(3*a),X=0,S=new GeNeo.OdGePoint3d,P=new GeNeo.OdGePoint3d;for(s=0;s<e.length;s+=2)if(0!==e[s]||0!==e[s+1]){if(0===s||e[s-1]!==e[s]){for(c=X/4;c<y;c++)b[3*X]=g,b[3*++X]=g,b[3*++X]=g,b[3*++X]=g,X++;g=h=0}m.map(s,d,6),l[d++]=4*y+0,l[d++]=4*y+3,l[d++]=4*y+1,l[d++]=4*y+0,l[d++]=4*y+2,l[d++]=4*y+3,y++;var D=3*e[s],x=3*e[s+1],D=(S.set(t[0+D],t[1+D],t[2+D]),P.set(t[0+x],t[1+x],t[2+x]),u[p++]=S.x,u[p++]=S.y,u[p++]=S.z,u[p++]=S.x,u[p++]=S.y,u[p++]=S.z,u[p++]=P.x,u[p++]=P.y,u[p++]=P.z,u[p++]=P.x,u[p++]=P.y,u[p++]=P.z,[P.x-S.x,P.y-S.y,P.z-S.z]),x=(f[_++]=D[0],f[_++]=D[1],f[_++]=D[2],f[_++]=D[0],f[_++]=D[1],f[_++]=D[2],f[_++]=D[0],f[_++]=D[1],f[_++]=D[2],f[_++]=D[0],f[_++]=D[1],f[_++]=D[2],w[3*v+0]=i[e[s]],w[3*v+1]=-1,w[3*v+2]=-1,w[3*++v+0]=i[e[s]],w[3*v+1]=1,w[3*v+2]=-1,w[3*++v+0]=i[e[s+1]],w[3*v+1]=-1,w[3*v+2]=1,w[3*++v+0]=i[e[s+1]],w[3*v+1]=1,w[3*v+2]=1,v++,n&&(S.transformBy(n),P.transformBy(n)),S.distanceTo(P)),D=h,O=h+=x;C[3*T+0]=D,C[3*T+1]=D,C[3*T+2]=O,C[3*++T+0]=D,C[3*T+1]=D,C[3*T+2]=O,C[3*++T+0]=O,C[3*T+1]=D,C[3*T+2]=O,C[3*++T+0]=O,C[3*T+1]=D,C[3*T+2]=O,T++,g+=x}for(c=X/4;c<y;c++)b[3*X]=g,b[3*++X]=g,b[3*++X]=g,b[3*++X]=g,X++;r=0;return{indexs:l,positions:u,pack_attr_1:f,pack_attr_2:w,pack_attr_3:C,pack_attr_4:b,mapper:m,byte_size:(r+=2*l.length)+4*u.length+4*f.length+4*w.length+4*C.length+4*b.length}}},n.GetLineWeightInPixels=function(e,t){var i=0;if(!n.useModelSpaceLwAlways()&&e.getXeGsDevice().getOverallViewport()){var r=o(e,t);if(r<=0)return i;i=e.NumToSCS(2*r)}else i=n.getStndLineWeightPxSize(t,!0);return i},n.GetLineWeightInUnits=o,n.GetLineWeightInUnitsFromPixels=function(e,t){return t?(e=e.NumToSCS(1),t=e<GeNeo.equalVector()?1:t/e/2):null}}),XeLogger=(XeLineweightUtils.prototype.useModelSpaceLwAlways=function(){return!1},XeLineweightUtils.prototype.getOdDb_kLnWt_Array=function(){return[0,5,9,13,15,18,20,25,30,35,40,50,53,60,70,80,90,100,106,120,140,158,200,211]},XeLineweightUtils.prototype.LineWeightEnum={kLnWt000:0,kLnWt005:5,kLnWt009:9,kLnWt013:13,kLnWt015:15,kLnWt018:18,kLnWt020:20,kLnWt025:25,kLnWt030:30,kLnWt035:35,kLnWt040:40,kLnWt050:50,kLnWt053:53,kLnWt060:60,kLnWt070:70,kLnWt080:80,kLnWt090:90,kLnWt100:100,kLnWt106:106,kLnWt120:120,kLnWt140:140,kLnWt158:158,kLnWt200:200,kLnWt211:211,kLnWtByLayer:-1,kLnWtByBlock:-2,kLnWtByLwDefault:-3},XeLineweightUtils.prototype.getStndLineWeightPxSize=function(e,t){return 0===e||5===e||9===e||13===e||15===e||18===e||20===e||25===e?2:30===e||35===e?6:40===e?8:50===e||53===e?10:60===e?12:70===e?14:80===e?16:90===e?18:100===e||106===e?20:120===e?24:140===e?26:158===e||200===e||211===e?30:-1},XeLineweightUtils.prototype.isLineWeightTooSmall=function(e,t){t=null==t?0:t;if(0<t&&1<window.XeLineweightUtils.GetLineWeightInPixels(e,t).toFixed(1))return!1;return!0},function(){var i=this;i.error=function(e){var t=(new Error).stack;i.send("error",e+" in "+t)},i.info=function(e){i.log(e)},i.warn=function(e){i.send("warn",e)},i.log=function(e){i.send("info",e)},i.debug=function(e){i.send("debug",e)}}),XeObject=(XeLogger.prototype.send=function(e,t){window.XeClientMessageProxy.sendLogMessage(e,t)},window.onerror=function(e,t,i,r,n){let o="Unhandled error occured - "+e;return t&&(o=o+" in "+t),i&&(o=o+" line: "+i),r&&(o=o+" column: "+r),n&&(o=(o+=" stack: ")+n.stack),window.XeLogger.send("error",o),!0},window.XeLogger=new XeLogger,function(e){Object.call(this,e);this.m_MyParent=e,this.m_ClassName="XeObject",this.m_ClassName="XeObject",this.DXEO=function(e){e&&e.FinalRelease&&e.FinalRelease()},this.preventServerNotify=function(e){this.m_bPreventServerNotify=e},this.copy=function(){var e=new XeObject(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e}}),XeCollectionItem=(XeObject.prototype=Object.create(Object.prototype),XeObject.prototype.constructor=Object,function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeCollectionItem",this.copy=function(){var e=new XeCollectionItem(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeCollection=(XeCollectionItem.prototype=Object.create(XeObject.prototype),XeCollectionItem.prototype.constructor=XeObject,function(e,t){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeCollection",this.m_Items=t,this.copy=function(){var e=new XeCollection(this.m_MyParent);return e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDrawable=(XeCollection.prototype=Object.create(XeObject.prototype),XeCollection.prototype.constructor=XeObject,XeCollection.prototype.getItems=function(){return this.m_Items},function(e,t){XeCollectionItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDrawable",this.m_XeGsOffsets=t,this.copy=function(){var e=new XeDrawable(this.m_MyParent);return e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsChunk=(XeDrawable.prototype=Object.create(XeCollectionItem.prototype),XeDrawable.prototype.constructor=XeCollectionItem,XeDrawable.prototype.getXeGsOffsets=function(){return this.m_XeGsOffsets},XeDrawable.prototype.setXeGsOffsets=function(e){this.m_XeGsOffsets=e,this.m_bPreventServerNotify||this.NotifyServer("m_XeGsOffsets",e)},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b){XeCollection.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsChunk",this.m_Id=i,this.m_Type=r,this.m_VpNum=n,this.m_Layer=o,this.m_LinetypeScale=a,this.m_LinetypeTableRecordName=s,this.m_LineWeight=c,this.m_Color=l,this.m_Denominator=d,this.m_SelectionFlags=u,this.m_SelectionGeom=p,this.m_PlineGen=m,this.m_TrackerName=h,this.m_GeometryToModelMatrix=g,this.m_Transparency=y,this.m_RenderMode=f,this.m_Owner=_,this.m_DrawFlags=w,this.m_Flags=v,this.m_TextFlags=C,this.m_ExtentsMin=T,this.m_ExtentsMax=b,this.m_Items=t,this.copy=function(){var e=new XeGsChunk(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Type=copyXeObjectMember(this.m_Type),e.m_VpNum=copyXeObjectMember(this.m_VpNum),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_LinetypeScale=copyXeObjectMember(this.m_LinetypeScale),e.m_LinetypeTableRecordName=copyXeObjectMember(this.m_LinetypeTableRecordName),e.m_LineWeight=copyXeObjectMember(this.m_LineWeight),e.m_Color=copyXeObjectMember(this.m_Color),e.m_Denominator=copyXeObjectMember(this.m_Denominator),e.m_SelectionFlags=copyXeObjectMember(this.m_SelectionFlags),e.m_SelectionGeom=copyXeObjectMember(this.m_SelectionGeom),e.m_PlineGen=copyXeObjectMember(this.m_PlineGen),e.m_TrackerName=copyXeObjectMember(this.m_TrackerName),e.m_GeometryToModelMatrix=copyXeObjectMember(this.m_GeometryToModelMatrix),e.m_Transparency=copyXeObjectMember(this.m_Transparency),e.m_RenderMode=copyXeObjectMember(this.m_RenderMode),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_DrawFlags=copyXeObjectMember(this.m_DrawFlags),e.m_Flags=copyXeObjectMember(this.m_Flags),e.m_TextFlags=copyXeObjectMember(this.m_TextFlags),e.m_ExtentsMin=copyXeObjectMember(this.m_ExtentsMin),e.m_ExtentsMax=copyXeObjectMember(this.m_ExtentsMax),e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsSimpleItem=(XeGsChunk.prototype=Object.create(XeCollection.prototype),XeGsChunk.prototype.constructor=XeCollection,XeGsChunk.prototype.getId=function(){return this.m_Id},XeGsChunk.prototype.getType=function(){return this.m_Type},XeGsChunk.prototype.getVpNum=function(){return this.m_VpNum},XeGsChunk.prototype.getLayer=function(){return this.m_Layer},XeGsChunk.prototype.getLinetypeScale=function(){return this.m_LinetypeScale},XeGsChunk.prototype.getLinetypeTableRecordName=function(){return this.m_LinetypeTableRecordName},XeGsChunk.prototype.getLineWeight=function(){return this.m_LineWeight},XeGsChunk.prototype.getColor=function(){return this.m_Color},XeGsChunk.prototype.getDenominator=function(){return this.m_Denominator},XeGsChunk.prototype.getSelectionFlags=function(){return this.m_SelectionFlags},XeGsChunk.prototype.getSelectionGeom=function(){return this.m_SelectionGeom},XeGsChunk.prototype.getPlineGen=function(){return this.m_PlineGen},XeGsChunk.prototype.getTrackerName=function(){return this.m_TrackerName},XeGsChunk.prototype.getGeometryToModelMatrix=function(){return this.m_GeometryToModelMatrix},XeGsChunk.prototype.getTransparency=function(){return this.m_Transparency},XeGsChunk.prototype.getRenderMode=function(){return this.m_RenderMode},XeGsChunk.prototype.getOwner=function(){return this.m_Owner},XeGsChunk.prototype.getDrawFlags=function(){return this.m_DrawFlags},XeGsChunk.prototype.getFlags=function(){return this.m_Flags},XeGsChunk.prototype.getTextFlags=function(){return this.m_TextFlags},XeGsChunk.prototype.getExtentsMin=function(){return this.m_ExtentsMin},XeGsChunk.prototype.getExtentsMax=function(){return this.m_ExtentsMax},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsSimpleItem",this.copy=function(){var e=new XeGsSimpleItem(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeCustomGrips=(XeGsSimpleItem.prototype=Object.create(XeObject.prototype),XeGsSimpleItem.prototype.constructor=XeObject,function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeCustomGrips",this.copy=function(){var e=new XeCustomGrips(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeEntity=(XeCustomGrips.prototype=Object.create(XeObject.prototype),XeCustomGrips.prototype.constructor=XeObject,function(e,t,i,r,n,o,a,s,c,l,d,u){XeDrawable.call(this,e);this.m_MyParent=e,this.m_ClassName="XeEntity",this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeEntity(this.m_MyParent);return e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLine=(XeEntity.prototype=Object.create(XeDrawable.prototype),XeEntity.prototype.constructor=XeDrawable,XeEntity.prototype.getOwner=function(){return this.m_Owner},XeEntity.prototype.getPath=function(){return this.m_Path},XeEntity.prototype.getDrawOrder=function(){return this.m_DrawOrder},XeEntity.prototype.getLayer=function(){return this.m_Layer},XeEntity.prototype.getAssoc=function(){return this.m_Assoc},XeEntity.prototype.getClass=function(){return this.m_Class},XeEntity.prototype.getXeDrawMode=function(){return this.m_XeDrawMode},XeEntity.prototype.getGrips=function(){return this.m_Grips},XeEntity.prototype.getReactorId=function(){return this.m_ReactorId},XeEntity.prototype.getCustomGrips=function(){return this.m_CustomGrips},function(e,t,i,r,n,o,a,s,c,l,d,u){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLine",this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeLine(this.m_MyParent);return e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeCircle=(XeLine.prototype=Object.create(XeEntity.prototype),XeLine.prototype.constructor=XeEntity,function(e,t,i,r,n,o,a,s,c,l,d,u){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeCircle",this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeCircle(this.m_MyParent);return e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeEllipArc=(XeCircle.prototype=Object.create(XeEntity.prototype),XeCircle.prototype.constructor=XeEntity,function(e,t,i,r,n,o,a,s,c,l,d,u){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeEllipArc",this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeEllipArc(this.m_MyParent);return e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeSpline=(XeEllipArc.prototype=Object.create(XeEntity.prototype),XeEllipArc.prototype.constructor=XeEntity,function(e,t,i,r,n,o,a,s,c,l,d,u,p){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeSpline",this.m_SplineType=p,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeSpline(this.m_MyParent);return e.m_SplineType=copyXeObjectMember(this.m_SplineType),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDimension=(XeSpline.prototype=Object.create(XeEntity.prototype),XeSpline.prototype.constructor=XeEntity,XeSpline.prototype.getSplineType=function(){return this.m_SplineType},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDimension",this.m_ParentId=p,this.m_OrdinateParentId=m,this.m_ChildHandles=h,this.m_TextPosState=g,this.m_CustomWallThicknessDim=y,this.m_IsForeshortenDim=f,this.m_ForeshortenType=_,this.m_CustomAngularDim=w,this.m_EntityData=v,this.m_IsConstraintsDim=C,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeDimension(this.m_MyParent);return e.m_ParentId=copyXeObjectMember(this.m_ParentId),e.m_OrdinateParentId=copyXeObjectMember(this.m_OrdinateParentId),e.m_ChildHandles=copyXeObjectMember(this.m_ChildHandles),e.m_TextPosState=copyXeObjectMember(this.m_TextPosState),e.m_CustomWallThicknessDim=copyXeObjectMember(this.m_CustomWallThicknessDim),e.m_IsForeshortenDim=copyXeObjectMember(this.m_IsForeshortenDim),e.m_ForeshortenType=copyXeObjectMember(this.m_ForeshortenType),e.m_CustomAngularDim=copyXeObjectMember(this.m_CustomAngularDim),e.m_EntityData=copyXeObjectMember(this.m_EntityData),e.m_IsConstraintsDim=copyXeObjectMember(this.m_IsConstraintsDim),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTable=(XeDimension.prototype=Object.create(XeEntity.prototype),XeDimension.prototype.constructor=XeEntity,XeDimension.prototype.getParentId=function(){return this.m_ParentId},XeDimension.prototype.setParentId=function(e){this.m_ParentId=e,this.m_bPreventServerNotify||this.NotifyServer("m_ParentId",e)},XeDimension.prototype.getOrdinateParentId=function(){return this.m_OrdinateParentId},XeDimension.prototype.setOrdinateParentId=function(e){this.m_OrdinateParentId=e,this.m_bPreventServerNotify||this.NotifyServer("m_OrdinateParentId",e)},XeDimension.prototype.getChildHandles=function(){return this.m_ChildHandles},XeDimension.prototype.getTextPosState=function(){return this.m_TextPosState},XeDimension.prototype.getCustomWallThicknessDim=function(){return this.m_CustomWallThicknessDim},XeDimension.prototype.getIsForeshortenDim=function(){return this.m_IsForeshortenDim},XeDimension.prototype.getForeshortenType=function(){return this.m_ForeshortenType},XeDimension.prototype.getCustomAngularDim=function(){return this.m_CustomAngularDim},XeDimension.prototype.getEntityData=function(){return this.m_EntityData},XeDimension.prototype.getIsConstraintsDim=function(){return this.m_IsConstraintsDim},function(e,t,i,r,n,o,a,s,c,l,d,u,p){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTable",this.m_EntityData=p,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeTable(this.m_MyParent);return e.m_EntityData=copyXeObjectMember(this.m_EntityData),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XePolyline=(XeTable.prototype=Object.create(XeEntity.prototype),XeTable.prototype.constructor=XeEntity,XeTable.prototype.getEntityData=function(){return this.m_EntityData},XeTable.prototype.setEntityData=function(e){this.m_EntityData=e,this.m_bPreventServerNotify||this.NotifyServer("m_EntityData",e)},function(e,t,i,r,n,o,a,s,c,l,d,u){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XePolyline",this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XePolyline(this.m_MyParent);return e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeText=(XePolyline.prototype=Object.create(XeEntity.prototype),XePolyline.prototype.constructor=XeEntity,function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeText",this.m_IsGroupWithView=p,this.m_TextStyle=m,this.m_HyperLink=h,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeText(this.m_MyParent);return e.m_IsGroupWithView=copyXeObjectMember(this.m_IsGroupWithView),e.m_TextStyle=copyXeObjectMember(this.m_TextStyle),e.m_HyperLink=copyXeObjectMember(this.m_HyperLink),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeCentermark=(XeText.prototype=Object.create(XeEntity.prototype),XeText.prototype.constructor=XeEntity,XeText.prototype.getIsGroupWithView=function(){return this.m_IsGroupWithView},XeText.prototype.getTextStyle=function(){return this.m_TextStyle},XeText.prototype.getHyperLink=function(){return this.m_HyperLink},function(e,t,i,r,n,o,a,s,c,l,d,u,p){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeCentermark",this.m_AutoCenterMark=p,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeCentermark(this.m_MyParent);return e.m_AutoCenterMark=copyXeObjectMember(this.m_AutoCenterMark),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDatum=(XeCentermark.prototype=Object.create(XeEntity.prototype),XeCentermark.prototype.constructor=XeEntity,XeCentermark.prototype.getAutoCenterMark=function(){return this.m_AutoCenterMark},function(e,t,i,r,n,o,a,s,c,l,d,u,p){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDatum",this.m_EntityData=p,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeDatum(this.m_MyParent);return e.m_EntityData=copyXeObjectMember(this.m_EntityData),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeBlockReference=(XeDatum.prototype=Object.create(XeEntity.prototype),XeDatum.prototype.constructor=XeEntity,XeDatum.prototype.getEntityData=function(){return this.m_EntityData},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g){XeEntity.call(this,e);this.m_MyParent=e,this.m_ClassName="XeBlockReference",this.m_MTextId=p,this.m_IsVisible=m,this.m_BlockId=h,this.m_Transform=g,this.m_Owner=i,this.m_Path=r,this.m_DrawOrder=n,this.m_Layer=o,this.m_Assoc=a,this.m_Class=s,this.m_XeDrawMode=c,this.m_Grips=l,this.m_ReactorId=d,this.m_CustomGrips=u,this.m_XeGsOffsets=t,this.copy=function(){var e=new XeBlockReference(this.m_MyParent);return e.m_MTextId=copyXeObjectMember(this.m_MTextId),e.m_IsVisible=copyXeObjectMember(this.m_IsVisible),e.m_BlockId=copyXeObjectMember(this.m_BlockId),e.m_Transform=copyXeObjectMember(this.m_Transform),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_Path=copyXeObjectMember(this.m_Path),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_Assoc=copyXeObjectMember(this.m_Assoc),e.m_Class=copyXeObjectMember(this.m_Class),e.m_XeDrawMode=copyXeObjectMember(this.m_XeDrawMode),e.m_Grips=copyXeObjectMember(this.m_Grips),e.m_ReactorId=copyXeObjectMember(this.m_ReactorId),e.m_CustomGrips=copyXeObjectMember(this.m_CustomGrips),e.m_XeGsOffsets=copyXeObjectMember(this.m_XeGsOffsets),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeEntities=(XeBlockReference.prototype=Object.create(XeEntity.prototype),XeBlockReference.prototype.constructor=XeEntity,XeBlockReference.prototype.getMTextId=function(){return this.m_MTextId},XeBlockReference.prototype.getIsVisible=function(){return this.m_IsVisible},XeBlockReference.prototype.getBlockId=function(){return this.m_BlockId},XeBlockReference.prototype.setBlockId=function(e){this.m_BlockId=e,this.m_bPreventServerNotify||this.NotifyServer("m_BlockId",e)},XeBlockReference.prototype.getTransform=function(){return this.m_Transform},XeBlockReference.prototype.setTransform=function(e){this.m_Transform=e,this.m_bPreventServerNotify||this.NotifyServer("m_Transform",e)},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeEntities",this.copy=function(){var e=new XeEntities(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsIndexedChunk=(XeEntities.prototype=Object.create(XeObject.prototype),XeEntities.prototype.constructor=XeObject,function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b,X,S,P,D,x){XeGsChunk.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsIndexedChunk",this.m_Vertexes=X,this.m_Normals=S,this.m_Colors=P,this.m_Order=D,this.m_Indexes=x,this.m_Id=i,this.m_Type=r,this.m_VpNum=n,this.m_Layer=o,this.m_LinetypeScale=a,this.m_LinetypeTableRecordName=s,this.m_LineWeight=c,this.m_Color=l,this.m_Denominator=d,this.m_SelectionFlags=u,this.m_SelectionGeom=p,this.m_PlineGen=m,this.m_TrackerName=h,this.m_GeometryToModelMatrix=g,this.m_Transparency=y,this.m_RenderMode=f,this.m_Owner=_,this.m_DrawFlags=w,this.m_Flags=v,this.m_TextFlags=C,this.m_ExtentsMin=T,this.m_ExtentsMax=b,this.m_Items=t,this.copy=function(){var e=new XeGsIndexedChunk(this.m_MyParent);return e.m_Vertexes=copyXeObjectMember(this.m_Vertexes),e.m_Normals=copyXeObjectMember(this.m_Normals),e.m_Colors=copyXeObjectMember(this.m_Colors),e.m_Order=copyXeObjectMember(this.m_Order),e.m_Indexes=copyXeObjectMember(this.m_Indexes),e.m_Id=copyXeObjectMember(this.m_Id),e.m_Type=copyXeObjectMember(this.m_Type),e.m_VpNum=copyXeObjectMember(this.m_VpNum),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_LinetypeScale=copyXeObjectMember(this.m_LinetypeScale),e.m_LinetypeTableRecordName=copyXeObjectMember(this.m_LinetypeTableRecordName),e.m_LineWeight=copyXeObjectMember(this.m_LineWeight),e.m_Color=copyXeObjectMember(this.m_Color),e.m_Denominator=copyXeObjectMember(this.m_Denominator),e.m_SelectionFlags=copyXeObjectMember(this.m_SelectionFlags),e.m_SelectionGeom=copyXeObjectMember(this.m_SelectionGeom),e.m_PlineGen=copyXeObjectMember(this.m_PlineGen),e.m_TrackerName=copyXeObjectMember(this.m_TrackerName),e.m_GeometryToModelMatrix=copyXeObjectMember(this.m_GeometryToModelMatrix),e.m_Transparency=copyXeObjectMember(this.m_Transparency),e.m_RenderMode=copyXeObjectMember(this.m_RenderMode),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_DrawFlags=copyXeObjectMember(this.m_DrawFlags),e.m_Flags=copyXeObjectMember(this.m_Flags),e.m_TextFlags=copyXeObjectMember(this.m_TextFlags),e.m_ExtentsMin=copyXeObjectMember(this.m_ExtentsMin),e.m_ExtentsMax=copyXeObjectMember(this.m_ExtentsMax),e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLayer=(XeGsIndexedChunk.prototype=Object.create(XeGsChunk.prototype),XeGsIndexedChunk.prototype.constructor=XeGsChunk,XeGsIndexedChunk.prototype.getVertexes=function(){return this.m_Vertexes},XeGsIndexedChunk.prototype.getNormals=function(){return this.m_Normals},XeGsIndexedChunk.prototype.getColors=function(){return this.m_Colors},XeGsIndexedChunk.prototype.getOrder=function(){return this.m_Order},XeGsIndexedChunk.prototype.getIndexes=function(){return this.m_Indexes},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLayer",this.m_Name=t,this.m_Handle=i,this.m_Off=r,this.m_OnIcon=n,this.m_OffIcon=o,this.m_LockIcon=a,this.m_UnLockIcon=s,this.m_frozenIcon=c,this.m_UnfrozenIcon=l,this.m_InUse=d,this.m_Frozen=u,this.m_Locked=p,this.m_Color=m,this.m_LayerColor=h,this.m_LineStyle=g,this.m_LineWeight=y,this.m_Transparency=f,this.m_Anonymous=_,this.copy=function(){var e=new XeLayer(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_Off=copyXeObjectMember(this.m_Off),e.m_OnIcon=copyXeObjectMember(this.m_OnIcon),e.m_OffIcon=copyXeObjectMember(this.m_OffIcon),e.m_LockIcon=copyXeObjectMember(this.m_LockIcon),e.m_UnLockIcon=copyXeObjectMember(this.m_UnLockIcon),e.m_frozenIcon=copyXeObjectMember(this.m_frozenIcon),e.m_UnfrozenIcon=copyXeObjectMember(this.m_UnfrozenIcon),e.m_InUse=copyXeObjectMember(this.m_InUse),e.m_Frozen=copyXeObjectMember(this.m_Frozen),e.m_Locked=copyXeObjectMember(this.m_Locked),e.m_Color=copyXeObjectMember(this.m_Color),e.m_LayerColor=copyXeObjectMember(this.m_LayerColor),e.m_LineStyle=copyXeObjectMember(this.m_LineStyle),e.m_LineWeight=copyXeObjectMember(this.m_LineWeight),e.m_Transparency=copyXeObjectMember(this.m_Transparency),e.m_Anonymous=copyXeObjectMember(this.m_Anonymous),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLayerStateTableRecord=(XeLayer.prototype=Object.create(XeObject.prototype),XeLayer.prototype.constructor=XeObject,XeLayer.prototype.getName=function(){return this.m_Name},XeLayer.prototype.setName=function(e){this.m_Name=e,this.m_bPreventServerNotify||this.NotifyServer("m_Name",e)},XeLayer.prototype.getHandle=function(){return this.m_Handle},XeLayer.prototype.getOff=function(){return this.m_Off},XeLayer.prototype.setOff=function(e){this.m_Off=e,this.m_bPreventServerNotify||this.NotifyServer("m_Off",e)},XeLayer.prototype.getOnIcon=function(){return this.m_OnIcon},XeLayer.prototype.getOffIcon=function(){return this.m_OffIcon},XeLayer.prototype.getLockIcon=function(){return this.m_LockIcon},XeLayer.prototype.getUnLockIcon=function(){return this.m_UnLockIcon},XeLayer.prototype.getfrozenIcon=function(){return this.m_frozenIcon},XeLayer.prototype.getUnfrozenIcon=function(){return this.m_UnfrozenIcon},XeLayer.prototype.getInUse=function(){return this.m_InUse},XeLayer.prototype.getFrozen=function(){return this.m_Frozen},XeLayer.prototype.setFrozen=function(e){this.m_Frozen=e,this.m_bPreventServerNotify||this.NotifyServer("m_Frozen",e)},XeLayer.prototype.getLocked=function(){return this.m_Locked},XeLayer.prototype.setLocked=function(e){this.m_Locked=e,this.m_bPreventServerNotify||this.NotifyServer("m_Locked",e)},XeLayer.prototype.getColor=function(){return this.m_Color},XeLayer.prototype.setColor=function(e){this.m_Color=e,this.m_bPreventServerNotify||this.NotifyServer("m_Color",e)},XeLayer.prototype.getLayerColor=function(){return this.m_LayerColor},XeLayer.prototype.getLineStyle=function(){return this.m_LineStyle},XeLayer.prototype.setLineStyle=function(e){this.m_LineStyle=e,this.m_bPreventServerNotify||this.NotifyServer("m_LineStyle",e)},XeLayer.prototype.getLineWeight=function(){return this.m_LineWeight},XeLayer.prototype.setLineWeight=function(e){this.m_LineWeight=e,this.m_bPreventServerNotify||this.NotifyServer("m_LineWeight",e)},XeLayer.prototype.getTransparency=function(){return this.m_Transparency},XeLayer.prototype.setTransparency=function(e){this.m_Transparency=e,this.m_bPreventServerNotify||this.NotifyServer("m_Transparency",e)},XeLayer.prototype.getAnonymous=function(){return this.m_Anonymous},function(e,t,i){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLayerStateTableRecord",this.m_Name=t,this.m_Handle=i,this.copy=function(){var e=new XeLayerStateTableRecord(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLayerStateTable=(XeLayerStateTableRecord.prototype=Object.create(XeObject.prototype),XeLayerStateTableRecord.prototype.constructor=XeObject,XeLayerStateTableRecord.prototype.getName=function(){return this.m_Name},XeLayerStateTableRecord.prototype.getHandle=function(){return this.m_Handle},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLayerStateTable",this.copy=function(){var e=new XeLayerStateTable(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLayers=(XeLayerStateTable.prototype=Object.create(XeObject.prototype),XeLayerStateTable.prototype.constructor=XeObject,function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLayers",this.copy=function(){var e=new XeLayers(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeBlock=(XeLayers.prototype=Object.create(XeObject.prototype),XeLayers.prototype.constructor=XeObject,function(e,t,i,r,n,o){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeBlock",this.m_Name=t,this.m_Handle=i,this.m_Handles=r,this.m_Anonimous=n,this.m_XRef=o,this.copy=function(){var e=new XeBlock(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_Handles=copyXeObjectMember(this.m_Handles),e.m_Anonimous=copyXeObjectMember(this.m_Anonimous),e.m_XRef=copyXeObjectMember(this.m_XRef),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeBlocks=(XeBlock.prototype=Object.create(XeObject.prototype),XeBlock.prototype.constructor=XeObject,XeBlock.prototype.getName=function(){return this.m_Name},XeBlock.prototype.setName=function(e){this.m_Name=e,this.m_bPreventServerNotify||this.NotifyServer("m_Name",e)},XeBlock.prototype.getHandle=function(){return this.m_Handle},XeBlock.prototype.getHandles=function(){return this.m_Handles},XeBlock.prototype.getAnonimous=function(){return this.m_Anonimous},XeBlock.prototype.getXRef=function(){return this.m_XRef},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeBlocks",this.copy=function(){var e=new XeBlocks(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsSimpleChunk=(XeBlocks.prototype=Object.create(XeObject.prototype),XeBlocks.prototype.constructor=XeObject,function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b){XeGsChunk.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsSimpleChunk",this.m_Id=i,this.m_Type=r,this.m_VpNum=n,this.m_Layer=o,this.m_LinetypeScale=a,this.m_LinetypeTableRecordName=s,this.m_LineWeight=c,this.m_Color=l,this.m_Denominator=d,this.m_SelectionFlags=u,this.m_SelectionGeom=p,this.m_PlineGen=m,this.m_TrackerName=h,this.m_GeometryToModelMatrix=g,this.m_Transparency=y,this.m_RenderMode=f,this.m_Owner=_,this.m_DrawFlags=w,this.m_Flags=v,this.m_TextFlags=C,this.m_ExtentsMin=T,this.m_ExtentsMax=b,this.m_Items=t,this.copy=function(){var e=new XeGsSimpleChunk(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Type=copyXeObjectMember(this.m_Type),e.m_VpNum=copyXeObjectMember(this.m_VpNum),e.m_Layer=copyXeObjectMember(this.m_Layer),e.m_LinetypeScale=copyXeObjectMember(this.m_LinetypeScale),e.m_LinetypeTableRecordName=copyXeObjectMember(this.m_LinetypeTableRecordName),e.m_LineWeight=copyXeObjectMember(this.m_LineWeight),e.m_Color=copyXeObjectMember(this.m_Color),e.m_Denominator=copyXeObjectMember(this.m_Denominator),e.m_SelectionFlags=copyXeObjectMember(this.m_SelectionFlags),e.m_SelectionGeom=copyXeObjectMember(this.m_SelectionGeom),e.m_PlineGen=copyXeObjectMember(this.m_PlineGen),e.m_TrackerName=copyXeObjectMember(this.m_TrackerName),e.m_GeometryToModelMatrix=copyXeObjectMember(this.m_GeometryToModelMatrix),e.m_Transparency=copyXeObjectMember(this.m_Transparency),e.m_RenderMode=copyXeObjectMember(this.m_RenderMode),e.m_Owner=copyXeObjectMember(this.m_Owner),e.m_DrawFlags=copyXeObjectMember(this.m_DrawFlags),e.m_Flags=copyXeObjectMember(this.m_Flags),e.m_TextFlags=copyXeObjectMember(this.m_TextFlags),e.m_ExtentsMin=copyXeObjectMember(this.m_ExtentsMin),e.m_ExtentsMax=copyXeObjectMember(this.m_ExtentsMax),e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsArcItem=(XeGsSimpleChunk.prototype=Object.create(XeGsChunk.prototype),XeGsSimpleChunk.prototype.constructor=XeGsChunk,function(e,t){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsArcItem",this.m_d=t,this.copy=function(){var e=new XeGsArcItem(this.m_MyParent);return e.m_d=copyXeObjectMember(this.m_d),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsCircleItem=(XeGsArcItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsArcItem.prototype.constructor=XeGsSimpleItem,XeGsArcItem.prototype.getd=function(){return this.m_d},XeGsArcItem.prototype.setd=function(e){this.m_d=e,this.m_bPreventServerNotify||this.NotifyServer("m_d",e)},function(e,t){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsCircleItem",this.m_d=t,this.copy=function(){var e=new XeGsCircleItem(this.m_MyParent);return e.m_d=copyXeObjectMember(this.m_d),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsEllipArcItem=(XeGsCircleItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsCircleItem.prototype.constructor=XeGsSimpleItem,XeGsCircleItem.prototype.getd=function(){return this.m_d},XeGsCircleItem.prototype.setd=function(e){this.m_d=e,this.m_bPreventServerNotify||this.NotifyServer("m_d",e)},function(e,t){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsEllipArcItem",this.m_d=t,this.copy=function(){var e=new XeGsEllipArcItem(this.m_MyParent);return e.m_d=copyXeObjectMember(this.m_d),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsSplineItem=(XeGsEllipArcItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsEllipArcItem.prototype.constructor=XeGsSimpleItem,XeGsEllipArcItem.prototype.getd=function(){return this.m_d},XeGsEllipArcItem.prototype.setd=function(e){this.m_d=e,this.m_bPreventServerNotify||this.NotifyServer("m_d",e)},function(e,t,i,r,n,o,a){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsSplineItem",this.m_Degree=t,this.m_Periodic=i,this.m_ControlPoints=r,this.m_Knots=n,this.m_Tolerance=o,this.m_d=a,this.copy=function(){var e=new XeGsSplineItem(this.m_MyParent);return e.m_Degree=copyXeObjectMember(this.m_Degree),e.m_Periodic=copyXeObjectMember(this.m_Periodic),e.m_ControlPoints=copyXeObjectMember(this.m_ControlPoints),e.m_Knots=copyXeObjectMember(this.m_Knots),e.m_Tolerance=copyXeObjectMember(this.m_Tolerance),e.m_d=copyXeObjectMember(this.m_d),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsTextItem=(XeGsSplineItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsSplineItem.prototype.constructor=XeGsSimpleItem,XeGsSplineItem.prototype.getDegree=function(){return this.m_Degree},XeGsSplineItem.prototype.setDegree=function(e){this.m_Degree=e,this.m_bPreventServerNotify||this.NotifyServer("m_Degree",e)},XeGsSplineItem.prototype.getPeriodic=function(){return this.m_Periodic},XeGsSplineItem.prototype.setPeriodic=function(e){this.m_Periodic=e,this.m_bPreventServerNotify||this.NotifyServer("m_Periodic",e)},XeGsSplineItem.prototype.getControlPoints=function(){return this.m_ControlPoints},XeGsSplineItem.prototype.setControlPoints=function(e){this.m_ControlPoints=e,this.m_bPreventServerNotify||this.NotifyServer("m_ControlPoints",e)},XeGsSplineItem.prototype.getKnots=function(){return this.m_Knots},XeGsSplineItem.prototype.setKnots=function(e){this.m_Knots=e,this.m_bPreventServerNotify||this.NotifyServer("m_Knots",e)},XeGsSplineItem.prototype.getTolerance=function(){return this.m_Tolerance},XeGsSplineItem.prototype.setTolerance=function(e){this.m_Tolerance=e,this.m_bPreventServerNotify||this.NotifyServer("m_Tolerance",e)},XeGsSplineItem.prototype.getd=function(){return this.m_d},XeGsSplineItem.prototype.setd=function(e){this.m_d=e,this.m_bPreventServerNotify||this.NotifyServer("m_d",e)},function(e,t,i,r,n,o,a){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsTextItem",this.m_Order=t,this.m_Origin=i,this.m_vX=r,this.m_vY=n,this.m_Glyphs=o,this.m_GTrans=a,this.copy=function(){var e=new XeGsTextItem(this.m_MyParent);return e.m_Order=copyXeObjectMember(this.m_Order),e.m_Origin=copyXeObjectMember(this.m_Origin),e.m_vX=copyXeObjectMember(this.m_vX),e.m_vY=copyXeObjectMember(this.m_vY),e.m_Glyphs=copyXeObjectMember(this.m_Glyphs),e.m_GTrans=copyXeObjectMember(this.m_GTrans),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsChildItem=(XeGsTextItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsTextItem.prototype.constructor=XeGsSimpleItem,XeGsTextItem.prototype.getOrder=function(){return this.m_Order},XeGsTextItem.prototype.getOrigin=function(){return this.m_Origin},XeGsTextItem.prototype.getvX=function(){return this.m_vX},XeGsTextItem.prototype.getvY=function(){return this.m_vY},XeGsTextItem.prototype.getGlyphs=function(){return this.m_Glyphs},XeGsTextItem.prototype.getGTrans=function(){return this.m_GTrans},function(e,t,i,r){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsChildItem",this.m_Chunks=t,this.m_Transform=i,this.m_DrawOrder=r,this.copy=function(){var e=new XeGsChildItem(this.m_MyParent);return e.m_Chunks=copyXeObjectMember(this.m_Chunks),e.m_Transform=copyXeObjectMember(this.m_Transform),e.m_DrawOrder=copyXeObjectMember(this.m_DrawOrder),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsInfiniteItem=(XeGsChildItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsChildItem.prototype.constructor=XeGsSimpleItem,XeGsChildItem.prototype.getChunks=function(){return this.m_Chunks},XeGsChildItem.prototype.getTransform=function(){return this.m_Transform},XeGsChildItem.prototype.getDrawOrder=function(){return this.m_DrawOrder},function(e,t,i,r,n){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsInfiniteItem",this.m_FirstPoint=t,this.m_SecondPoint=i,this.m_XLine=r,this.m_Order=n,this.copy=function(){var e=new XeGsInfiniteItem(this.m_MyParent);return e.m_FirstPoint=copyXeObjectMember(this.m_FirstPoint),e.m_SecondPoint=copyXeObjectMember(this.m_SecondPoint),e.m_XLine=copyXeObjectMember(this.m_XLine),e.m_Order=copyXeObjectMember(this.m_Order),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsImageItem=(XeGsInfiniteItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsInfiniteItem.prototype.constructor=XeGsSimpleItem,XeGsInfiniteItem.prototype.getFirstPoint=function(){return this.m_FirstPoint},XeGsInfiniteItem.prototype.getSecondPoint=function(){return this.m_SecondPoint},XeGsInfiniteItem.prototype.getXLine=function(){return this.m_XLine},XeGsInfiniteItem.prototype.getOrder=function(){return this.m_Order},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsImageItem",this.m_Order=t,this.m_Origin=i,this.m_U=r,this.m_V=n,this.m_NumPoints=o,this.m_Boundary=a,this.m_Transparency=s,this.m_Brightness=c,this.m_Contrast=l,this.m_Fade=d,this.m_URL=u,this.m_PixelWidth=p,this.m_PixelHeight=m,this.copy=function(){var e=new XeGsImageItem(this.m_MyParent);return e.m_Order=copyXeObjectMember(this.m_Order),e.m_Origin=copyXeObjectMember(this.m_Origin),e.m_U=copyXeObjectMember(this.m_U),e.m_V=copyXeObjectMember(this.m_V),e.m_NumPoints=copyXeObjectMember(this.m_NumPoints),e.m_Boundary=copyXeObjectMember(this.m_Boundary),e.m_Transparency=copyXeObjectMember(this.m_Transparency),e.m_Brightness=copyXeObjectMember(this.m_Brightness),e.m_Contrast=copyXeObjectMember(this.m_Contrast),e.m_Fade=copyXeObjectMember(this.m_Fade),e.m_URL=copyXeObjectMember(this.m_URL),e.m_PixelWidth=copyXeObjectMember(this.m_PixelWidth),e.m_PixelHeight=copyXeObjectMember(this.m_PixelHeight),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsOLEItem=(XeGsImageItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsImageItem.prototype.constructor=XeGsSimpleItem,XeGsImageItem.prototype.getOrder=function(){return this.m_Order},XeGsImageItem.prototype.getOrigin=function(){return this.m_Origin},XeGsImageItem.prototype.getU=function(){return this.m_U},XeGsImageItem.prototype.getV=function(){return this.m_V},XeGsImageItem.prototype.getNumPoints=function(){return this.m_NumPoints},XeGsImageItem.prototype.getBoundary=function(){return this.m_Boundary},XeGsImageItem.prototype.getTransparency=function(){return this.m_Transparency},XeGsImageItem.prototype.getBrightness=function(){return this.m_Brightness},XeGsImageItem.prototype.getContrast=function(){return this.m_Contrast},XeGsImageItem.prototype.getFade=function(){return this.m_Fade},XeGsImageItem.prototype.getURL=function(){return this.m_URL},XeGsImageItem.prototype.getPixelWidth=function(){return this.m_PixelWidth},XeGsImageItem.prototype.getPixelHeight=function(){return this.m_PixelHeight},function(e,t,i,r,n,o){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsOLEItem",this.m_Origin=t,this.m_U=i,this.m_V=r,this.m_URL=n,this.m_Order=o,this.copy=function(){var e=new XeGsOLEItem(this.m_MyParent);return e.m_Origin=copyXeObjectMember(this.m_Origin),e.m_U=copyXeObjectMember(this.m_U),e.m_V=copyXeObjectMember(this.m_V),e.m_URL=copyXeObjectMember(this.m_URL),e.m_Order=copyXeObjectMember(this.m_Order),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsHatchItem=(XeGsOLEItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsOLEItem.prototype.constructor=XeGsSimpleItem,XeGsOLEItem.prototype.getOrigin=function(){return this.m_Origin},XeGsOLEItem.prototype.getU=function(){return this.m_U},XeGsOLEItem.prototype.getV=function(){return this.m_V},XeGsOLEItem.prototype.getURL=function(){return this.m_URL},XeGsOLEItem.prototype.getOrder=function(){return this.m_Order},function(e,t,i,r,n,o,a,s,c,l,d,u){XeGsSimpleItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsHatchItem",this.m_Order=t,this.m_Min=i,this.m_Max=r,this.m_Center=n,this.m_SolidVertices=o,this.m_SolidIndexes=a,this.m_GradientVertices=s,this.m_GradientIndexes=c,this.m_GradientColors=l,this.m_PatternSize=d,this.m_PatternDashes=u,this.copy=function(){var e=new XeGsHatchItem(this.m_MyParent);return e.m_Order=copyXeObjectMember(this.m_Order),e.m_Min=copyXeObjectMember(this.m_Min),e.m_Max=copyXeObjectMember(this.m_Max),e.m_Center=copyXeObjectMember(this.m_Center),e.m_SolidVertices=copyXeObjectMember(this.m_SolidVertices),e.m_SolidIndexes=copyXeObjectMember(this.m_SolidIndexes),e.m_GradientVertices=copyXeObjectMember(this.m_GradientVertices),e.m_GradientIndexes=copyXeObjectMember(this.m_GradientIndexes),e.m_GradientColors=copyXeObjectMember(this.m_GradientColors),e.m_PatternSize=copyXeObjectMember(this.m_PatternSize),e.m_PatternDashes=copyXeObjectMember(this.m_PatternDashes),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsGeometryChunks=(XeGsHatchItem.prototype=Object.create(XeGsSimpleItem.prototype),XeGsHatchItem.prototype.constructor=XeGsSimpleItem,XeGsHatchItem.prototype.getOrder=function(){return this.m_Order},XeGsHatchItem.prototype.getMin=function(){return this.m_Min},XeGsHatchItem.prototype.getMax=function(){return this.m_Max},XeGsHatchItem.prototype.getCenter=function(){return this.m_Center},XeGsHatchItem.prototype.getSolidVertices=function(){return this.m_SolidVertices},XeGsHatchItem.prototype.getSolidIndexes=function(){return this.m_SolidIndexes},XeGsHatchItem.prototype.getGradientVertices=function(){return this.m_GradientVertices},XeGsHatchItem.prototype.getGradientIndexes=function(){return this.m_GradientIndexes},XeGsHatchItem.prototype.getGradientColors=function(){return this.m_GradientColors},XeGsHatchItem.prototype.getPatternSize=function(){return this.m_PatternSize},XeGsHatchItem.prototype.getPatternDashes=function(){return this.m_PatternDashes},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsGeometryChunks",this.copy=function(){var e=new XeGsGeometryChunks(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDbBackground=(XeGsGeometryChunks.prototype=Object.create(XeObject.prototype),XeGsGeometryChunks.prototype.constructor=XeObject,function(e,t){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDbBackground",this.m_Type=t,this.copy=function(){var e=new XeDbBackground(this.m_MyParent);return e.m_Type=copyXeObjectMember(this.m_Type),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsViewport=(XeDbBackground.prototype=Object.create(XeObject.prototype),XeDbBackground.prototype.constructor=XeObject,XeDbBackground.prototype.getType=function(){return this.m_Type},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b,X,S,P,D,x,O,G,E,A,I,k,M,L,R,N,F,V,B,U,W,H,j,z,Y,q,K,Z){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsViewport",this.m_Handle=t,this.m_VpNum=i,this.m_Overall=r,this.m_UpVector=n,this.m_Target=o,this.m_Position=a,this.m_FieldWidth=s,this.m_FieldHeight=c,this.m_Center=l,this.m_Width=d,this.m_Height=u,this.m_Perspective=p,this.m_LensLength=m,this.m_Active=h,this.m_FrozenLayers=g,this.m_bSortedFrozenLayerList=y,this.m_VisibleScreenRect_m_min_x=f,this.m_VisibleScreenRect_m_min_y=_,this.m_VisibleScreenRect_m_max_x=w,this.m_VisibleScreenRect_m_max_y=v,this.m_VisiblePxWidth=C,this.m_VisiblePxHeight=T,this.m_IsFrontClipped=b,this.m_IsBackClipped=X,this.m_FrontClipped=S,this.m_BackClipped=P,this.m_ViewportExternalRegion=D,this.m_ViewportExternalRegionTriangleFan=x,this.m_ViewExtentsWCS=O,this.m_UCSIconVisible=G,this.m_UCSIconAtOrigin=E,this.m_UCSOriginVisible=A,this.m_UCSOrigin=I,this.m_UCSxDir=k,this.m_UCSyDir=M,this.m_UCSElevation=L,this.m_UCSMatrix=R,this.m_ViewPlaneOrigin=N,this.m_ViewPlanexDir=F,this.m_ViewPlaneyDir=V,this.m_ScreenRectLLC=B,this.m_ScreenRectURC=U,this.m_Foreground=W,this.m_Background=H,this.m_Locked=j,this.m_On=z,this.m_RenderMode=Y,this.m_DoSetView=q,this.m_SingleColorMode=K,this.m_SingleColor=Z,this.copy=function(){var e=new XeGsViewport(this.m_MyParent);return e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_VpNum=copyXeObjectMember(this.m_VpNum),e.m_Overall=copyXeObjectMember(this.m_Overall),e.m_UpVector=copyXeObjectMember(this.m_UpVector),e.m_Target=copyXeObjectMember(this.m_Target),e.m_Position=copyXeObjectMember(this.m_Position),e.m_FieldWidth=copyXeObjectMember(this.m_FieldWidth),e.m_FieldHeight=copyXeObjectMember(this.m_FieldHeight),e.m_Center=copyXeObjectMember(this.m_Center),e.m_Width=copyXeObjectMember(this.m_Width),e.m_Height=copyXeObjectMember(this.m_Height),e.m_Perspective=copyXeObjectMember(this.m_Perspective),e.m_LensLength=copyXeObjectMember(this.m_LensLength),e.m_Active=copyXeObjectMember(this.m_Active),e.m_FrozenLayers=copyXeObjectMember(this.m_FrozenLayers),e.m_bSortedFrozenLayerList=copyXeObjectMember(this.m_bSortedFrozenLayerList),e.m_VisibleScreenRect_m_min_x=copyXeObjectMember(this.m_VisibleScreenRect_m_min_x),e.m_VisibleScreenRect_m_min_y=copyXeObjectMember(this.m_VisibleScreenRect_m_min_y),e.m_VisibleScreenRect_m_max_x=copyXeObjectMember(this.m_VisibleScreenRect_m_max_x),e.m_VisibleScreenRect_m_max_y=copyXeObjectMember(this.m_VisibleScreenRect_m_max_y),e.m_VisiblePxWidth=copyXeObjectMember(this.m_VisiblePxWidth),e.m_VisiblePxHeight=copyXeObjectMember(this.m_VisiblePxHeight),e.m_IsFrontClipped=copyXeObjectMember(this.m_IsFrontClipped),e.m_IsBackClipped=copyXeObjectMember(this.m_IsBackClipped),e.m_FrontClipped=copyXeObjectMember(this.m_FrontClipped),e.m_BackClipped=copyXeObjectMember(this.m_BackClipped),e.m_ViewportExternalRegion=copyXeObjectMember(this.m_ViewportExternalRegion),e.m_ViewportExternalRegionTriangleFan=copyXeObjectMember(this.m_ViewportExternalRegionTriangleFan),e.m_ViewExtentsWCS=copyXeObjectMember(this.m_ViewExtentsWCS),e.m_UCSIconVisible=copyXeObjectMember(this.m_UCSIconVisible),e.m_UCSIconAtOrigin=copyXeObjectMember(this.m_UCSIconAtOrigin),e.m_UCSOriginVisible=copyXeObjectMember(this.m_UCSOriginVisible),e.m_UCSOrigin=copyXeObjectMember(this.m_UCSOrigin),e.m_UCSxDir=copyXeObjectMember(this.m_UCSxDir),e.m_UCSyDir=copyXeObjectMember(this.m_UCSyDir),e.m_UCSElevation=copyXeObjectMember(this.m_UCSElevation),e.m_UCSMatrix=copyXeObjectMember(this.m_UCSMatrix),e.m_ViewPlaneOrigin=copyXeObjectMember(this.m_ViewPlaneOrigin),e.m_ViewPlanexDir=copyXeObjectMember(this.m_ViewPlanexDir),e.m_ViewPlaneyDir=copyXeObjectMember(this.m_ViewPlaneyDir),e.m_ScreenRectLLC=copyXeObjectMember(this.m_ScreenRectLLC),e.m_ScreenRectURC=copyXeObjectMember(this.m_ScreenRectURC),e.m_Foreground=copyXeObjectMember(this.m_Foreground),e.m_Background=copyXeObjectMember(this.m_Background),e.m_Locked=copyXeObjectMember(this.m_Locked),e.m_On=copyXeObjectMember(this.m_On),e.m_RenderMode=copyXeObjectMember(this.m_RenderMode),e.m_DoSetView=copyXeObjectMember(this.m_DoSetView),e.m_SingleColorMode=copyXeObjectMember(this.m_SingleColorMode),e.m_SingleColor=copyXeObjectMember(this.m_SingleColor),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsViewports=(XeGsViewport.prototype=Object.create(XeObject.prototype),XeGsViewport.prototype.constructor=XeObject,XeGsViewport.prototype.getHandle=function(){return this.m_Handle},XeGsViewport.prototype.getVpNum=function(){return this.m_VpNum},XeGsViewport.prototype.getOverall=function(){return this.m_Overall},XeGsViewport.prototype.getUpVector=function(){return this.m_UpVector},XeGsViewport.prototype.setUpVector=function(e){this.m_UpVector=e,this.m_bPreventServerNotify||this.NotifyServer("m_UpVector",e)},XeGsViewport.prototype.getTarget=function(){return this.m_Target},XeGsViewport.prototype.setTarget=function(e){this.m_Target=e,this.m_bPreventServerNotify||this.NotifyServer("m_Target",e)},XeGsViewport.prototype.getPosition=function(){return this.m_Position},XeGsViewport.prototype.setPosition=function(e){this.m_Position=e,this.m_bPreventServerNotify||this.NotifyServer("m_Position",e)},XeGsViewport.prototype.getFieldWidth=function(){return this.m_FieldWidth},XeGsViewport.prototype.setFieldWidth=function(e){this.m_FieldWidth=e,this.m_bPreventServerNotify||this.NotifyServer("m_FieldWidth",e)},XeGsViewport.prototype.getFieldHeight=function(){return this.m_FieldHeight},XeGsViewport.prototype.setFieldHeight=function(e){this.m_FieldHeight=e,this.m_bPreventServerNotify||this.NotifyServer("m_FieldHeight",e)},XeGsViewport.prototype.getCenter=function(){return this.m_Center},XeGsViewport.prototype.setCenter=function(e){this.m_Center=e,this.m_bPreventServerNotify||this.NotifyServer("m_Center",e)},XeGsViewport.prototype.getWidth=function(){return this.m_Width},XeGsViewport.prototype.setWidth=function(e){this.m_Width=e,this.m_bPreventServerNotify||this.NotifyServer("m_Width",e)},XeGsViewport.prototype.getHeight=function(){return this.m_Height},XeGsViewport.prototype.setHeight=function(e){this.m_Height=e,this.m_bPreventServerNotify||this.NotifyServer("m_Height",e)},XeGsViewport.prototype.getPerspective=function(){return this.m_Perspective},XeGsViewport.prototype.setPerspective=function(e){this.m_Perspective=e,this.m_bPreventServerNotify||this.NotifyServer("m_Perspective",e)},XeGsViewport.prototype.getLensLength=function(){return this.m_LensLength},XeGsViewport.prototype.setLensLength=function(e){this.m_LensLength=e,this.m_bPreventServerNotify||this.NotifyServer("m_LensLength",e)},XeGsViewport.prototype.getActive=function(){return this.m_Active},XeGsViewport.prototype.setActive=function(e){this.m_Active=e,this.m_bPreventServerNotify||this.NotifyServer("m_Active",e)},XeGsViewport.prototype.getFrozenLayers=function(){return this.m_FrozenLayers},XeGsViewport.prototype.setFrozenLayers=function(e){this.m_FrozenLayers=e,this.m_bPreventServerNotify||this.NotifyServer("m_FrozenLayers",e)},XeGsViewport.prototype.getbSortedFrozenLayerList=function(){return this.m_bSortedFrozenLayerList},XeGsViewport.prototype.setbSortedFrozenLayerList=function(e){this.m_bSortedFrozenLayerList=e,this.m_bPreventServerNotify||this.NotifyServer("m_bSortedFrozenLayerList",e)},XeGsViewport.prototype.getVisibleScreenRect_m_min_x=function(){return this.m_VisibleScreenRect_m_min_x},XeGsViewport.prototype.getVisibleScreenRect_m_min_y=function(){return this.m_VisibleScreenRect_m_min_y},XeGsViewport.prototype.getVisibleScreenRect_m_max_x=function(){return this.m_VisibleScreenRect_m_max_x},XeGsViewport.prototype.getVisibleScreenRect_m_max_y=function(){return this.m_VisibleScreenRect_m_max_y},XeGsViewport.prototype.getVisiblePxWidth=function(){return this.m_VisiblePxWidth},XeGsViewport.prototype.getVisiblePxHeight=function(){return this.m_VisiblePxHeight},XeGsViewport.prototype.getIsFrontClipped=function(){return this.m_IsFrontClipped},XeGsViewport.prototype.getIsBackClipped=function(){return this.m_IsBackClipped},XeGsViewport.prototype.getFrontClipped=function(){return this.m_FrontClipped},XeGsViewport.prototype.getBackClipped=function(){return this.m_BackClipped},XeGsViewport.prototype.getViewportExternalRegion=function(){return this.m_ViewportExternalRegion},XeGsViewport.prototype.getViewportExternalRegionTriangleFan=function(){return this.m_ViewportExternalRegionTriangleFan},XeGsViewport.prototype.getViewExtentsWCS=function(){return this.m_ViewExtentsWCS},XeGsViewport.prototype.getUCSIconVisible=function(){return this.m_UCSIconVisible},XeGsViewport.prototype.getUCSIconAtOrigin=function(){return this.m_UCSIconAtOrigin},XeGsViewport.prototype.getUCSOriginVisible=function(){return this.m_UCSOriginVisible},XeGsViewport.prototype.getUCSOrigin=function(){return this.m_UCSOrigin},XeGsViewport.prototype.getUCSxDir=function(){return this.m_UCSxDir},XeGsViewport.prototype.getUCSyDir=function(){return this.m_UCSyDir},XeGsViewport.prototype.getUCSElevation=function(){return this.m_UCSElevation},XeGsViewport.prototype.getUCSMatrix=function(){return this.m_UCSMatrix},XeGsViewport.prototype.getViewPlaneOrigin=function(){return this.m_ViewPlaneOrigin},XeGsViewport.prototype.getViewPlanexDir=function(){return this.m_ViewPlanexDir},XeGsViewport.prototype.getViewPlaneyDir=function(){return this.m_ViewPlaneyDir},XeGsViewport.prototype.getScreenRectLLC=function(){return this.m_ScreenRectLLC},XeGsViewport.prototype.getScreenRectURC=function(){return this.m_ScreenRectURC},XeGsViewport.prototype.getForeground=function(){return this.m_Foreground},XeGsViewport.prototype.getBackground=function(){return this.m_Background},XeGsViewport.prototype.getLocked=function(){return this.m_Locked},XeGsViewport.prototype.getOn=function(){return this.m_On},XeGsViewport.prototype.getRenderMode=function(){return this.m_RenderMode},XeGsViewport.prototype.DoSetView=function(e){return this.CallMethod("m_DoSetView",e)},XeGsViewport.prototype.getSingleColorMode=function(){return this.m_SingleColorMode},XeGsViewport.prototype.getSingleColor=function(){return this.m_SingleColor},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsViewports",this.copy=function(){var e=new XeGsViewports(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsPalette=(XeGsViewports.prototype=Object.create(XeObject.prototype),XeGsViewports.prototype.constructor=XeObject,function(e,t){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsPalette",this.m_Palette=t,this.copy=function(){var e=new XeGsPalette(this.m_MyParent);return e.m_Palette=copyXeObjectMember(this.m_Palette),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLayoutPaper=(XeGsPalette.prototype=Object.create(XeObject.prototype),XeGsPalette.prototype.constructor=XeObject,XeGsPalette.prototype.getPalette=function(){return this.m_Palette},function(e,t,i,r,n,o,a,s,c){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLayoutPaper",this.m_Points=t,this.m_Margins=i,this.m_DispayPrintableArea=r,this.m_DispayPaperBackground=n,this.m_PaperBackColor=o,this.m_PlotWidth=a,this.m_PlotHeight=s,this.m_PlotPaperUnits=c,this.copy=function(){var e=new XeLayoutPaper(this.m_MyParent);return e.m_Points=copyXeObjectMember(this.m_Points),e.m_Margins=copyXeObjectMember(this.m_Margins),e.m_DispayPrintableArea=copyXeObjectMember(this.m_DispayPrintableArea),e.m_DispayPaperBackground=copyXeObjectMember(this.m_DispayPaperBackground),e.m_PaperBackColor=copyXeObjectMember(this.m_PaperBackColor),e.m_PlotWidth=copyXeObjectMember(this.m_PlotWidth),e.m_PlotHeight=copyXeObjectMember(this.m_PlotHeight),e.m_PlotPaperUnits=copyXeObjectMember(this.m_PlotPaperUnits),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLayout=(XeLayoutPaper.prototype=Object.create(XeObject.prototype),XeLayoutPaper.prototype.constructor=XeObject,XeLayoutPaper.prototype.getPoints=function(){return this.m_Points},XeLayoutPaper.prototype.getMargins=function(){return this.m_Margins},XeLayoutPaper.prototype.getDispayPrintableArea=function(){return this.m_DispayPrintableArea},XeLayoutPaper.prototype.getDispayPaperBackground=function(){return this.m_DispayPaperBackground},XeLayoutPaper.prototype.getPaperBackColor=function(){return this.m_PaperBackColor},XeLayoutPaper.prototype.getPlotWidth=function(){return this.m_PlotWidth},XeLayoutPaper.prototype.getPlotHeight=function(){return this.m_PlotHeight},XeLayoutPaper.prototype.getPlotPaperUnits=function(){return this.m_PlotPaperUnits},function(e,t){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLayout",this.m_Paper=t,this.copy=function(){var e=new XeLayout(this.m_MyParent);return e.m_Paper=copyXeObjectMember(this.m_Paper),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDbGroup=(XeLayout.prototype=Object.create(XeObject.prototype),XeLayout.prototype.constructor=XeObject,XeLayout.prototype.getPaper=function(){return this.m_Paper},function(e,t,i,r,n,o,a){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDbGroup",this.m_Name=t,this.m_Handle=i,this.m_AllEntityIds=r,this.m_GroupGrip=n,this.m_ExtentsPoints=o,this.m_IsSelectable=a,this.copy=function(){var e=new XeDbGroup(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_AllEntityIds=copyXeObjectMember(this.m_AllEntityIds),e.m_GroupGrip=copyXeObjectMember(this.m_GroupGrip),e.m_ExtentsPoints=copyXeObjectMember(this.m_ExtentsPoints),e.m_IsSelectable=copyXeObjectMember(this.m_IsSelectable),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGroupDictionary=(XeDbGroup.prototype=Object.create(XeObject.prototype),XeDbGroup.prototype.constructor=XeObject,XeDbGroup.prototype.getName=function(){return this.m_Name},XeDbGroup.prototype.getHandle=function(){return this.m_Handle},XeDbGroup.prototype.getAllEntityIds=function(){return this.m_AllEntityIds},XeDbGroup.prototype.getGroupGrip=function(){return this.m_GroupGrip},XeDbGroup.prototype.getExtentsPoints=function(){return this.m_ExtentsPoints},XeDbGroup.prototype.getIsSelectable=function(){return this.m_IsSelectable},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGroupDictionary",this.copy=function(){var e=new XeGroupDictionary(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLinetypeTableRecord=(XeGroupDictionary.prototype=Object.create(XeObject.prototype),XeGroupDictionary.prototype.constructor=XeObject,function(e,t,i,r,n,o,a,s,c,l){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLinetypeTableRecord",this.m_Name=t,this.m_Handle=i,this.m_IsSimple=r,this.m_HasDots=n,this.m_IsScaledToFit=o,this.m_NumDashes=a,this.m_PatternLength=s,this.m_Comments=c,this.m_ArrayPattern=l,this.copy=function(){var e=new XeLinetypeTableRecord(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_IsSimple=copyXeObjectMember(this.m_IsSimple),e.m_HasDots=copyXeObjectMember(this.m_HasDots),e.m_IsScaledToFit=copyXeObjectMember(this.m_IsScaledToFit),e.m_NumDashes=copyXeObjectMember(this.m_NumDashes),e.m_PatternLength=copyXeObjectMember(this.m_PatternLength),e.m_Comments=copyXeObjectMember(this.m_Comments),e.m_ArrayPattern=copyXeObjectMember(this.m_ArrayPattern),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeLinetypeTable=(XeLinetypeTableRecord.prototype=Object.create(XeObject.prototype),XeLinetypeTableRecord.prototype.constructor=XeObject,XeLinetypeTableRecord.prototype.getName=function(){return this.m_Name},XeLinetypeTableRecord.prototype.getHandle=function(){return this.m_Handle},XeLinetypeTableRecord.prototype.getIsSimple=function(){return this.m_IsSimple},XeLinetypeTableRecord.prototype.getHasDots=function(){return this.m_HasDots},XeLinetypeTableRecord.prototype.getIsScaledToFit=function(){return this.m_IsScaledToFit},XeLinetypeTableRecord.prototype.getNumDashes=function(){return this.m_NumDashes},XeLinetypeTableRecord.prototype.getPatternLength=function(){return this.m_PatternLength},XeLinetypeTableRecord.prototype.getComments=function(){return this.m_Comments},XeLinetypeTableRecord.prototype.getArrayPattern=function(){return this.m_ArrayPattern},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeLinetypeTable",this.copy=function(){var e=new XeLinetypeTable(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTextStyleTableRecord=(XeLinetypeTable.prototype=Object.create(XeObject.prototype),XeLinetypeTable.prototype.constructor=XeObject,function(e,t,i,r){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTextStyleTableRecord",this.m_Name=t,this.m_Handle=i,this.m_Icon=r,this.copy=function(){var e=new XeTextStyleTableRecord(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_Icon=copyXeObjectMember(this.m_Icon),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTextStyleTable=(XeTextStyleTableRecord.prototype=Object.create(XeObject.prototype),XeTextStyleTableRecord.prototype.constructor=XeObject,XeTextStyleTableRecord.prototype.getName=function(){return this.m_Name},XeTextStyleTableRecord.prototype.getHandle=function(){return this.m_Handle},XeTextStyleTableRecord.prototype.getIcon=function(){return this.m_Icon},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTextStyleTable",this.copy=function(){var e=new XeTextStyleTable(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDimensionStyleTableRecord=(XeTextStyleTable.prototype=Object.create(XeObject.prototype),XeTextStyleTable.prototype.constructor=XeObject,function(e,t,i,r){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDimensionStyleTableRecord",this.m_Name=t,this.m_Handle=i,this.m_Icon=r,this.copy=function(){var e=new XeDimensionStyleTableRecord(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_Icon=copyXeObjectMember(this.m_Icon),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDimensionStyleTable=(XeDimensionStyleTableRecord.prototype=Object.create(XeObject.prototype),XeDimensionStyleTableRecord.prototype.constructor=XeObject,XeDimensionStyleTableRecord.prototype.getName=function(){return this.m_Name},XeDimensionStyleTableRecord.prototype.getHandle=function(){return this.m_Handle},XeDimensionStyleTableRecord.prototype.getIcon=function(){return this.m_Icon},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDimensionStyleTable",this.copy=function(){var e=new XeDimensionStyleTable(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeMLeaderStyleTableRecord=(XeDimensionStyleTable.prototype=Object.create(XeObject.prototype),XeDimensionStyleTable.prototype.constructor=XeObject,function(e,t,i,r){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeMLeaderStyleTableRecord",this.m_Name=t,this.m_Handle=i,this.m_Icon=r,this.copy=function(){var e=new XeMLeaderStyleTableRecord(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),e.m_Icon=copyXeObjectMember(this.m_Icon),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeMleaderStyleTable=(XeMLeaderStyleTableRecord.prototype=Object.create(XeObject.prototype),XeMLeaderStyleTableRecord.prototype.constructor=XeObject,XeMLeaderStyleTableRecord.prototype.getName=function(){return this.m_Name},XeMLeaderStyleTableRecord.prototype.getHandle=function(){return this.m_Handle},XeMLeaderStyleTableRecord.prototype.getIcon=function(){return this.m_Icon},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeMleaderStyleTable",this.copy=function(){var e=new XeMleaderStyleTable(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTableStyleTableRecord=(XeMleaderStyleTable.prototype=Object.create(XeObject.prototype),XeMleaderStyleTable.prototype.constructor=XeObject,function(e,t,i){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTableStyleTableRecord",this.m_Name=t,this.m_Handle=i,this.copy=function(){var e=new XeTableStyleTableRecord(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Handle=copyXeObjectMember(this.m_Handle),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTableStyleTable=(XeTableStyleTableRecord.prototype=Object.create(XeObject.prototype),XeTableStyleTableRecord.prototype.constructor=XeObject,XeTableStyleTableRecord.prototype.getName=function(){return this.m_Name},XeTableStyleTableRecord.prototype.getHandle=function(){return this.m_Handle},function(e){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTableStyleTable",this.copy=function(){var e=new XeTableStyleTable(this.m_MyParent);return this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTracker=(XeTableStyleTable.prototype=Object.create(XeObject.prototype),XeTableStyleTable.prototype.constructor=XeObject,function(e,t,i){XeCollectionItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTracker",this.m_Name=t,this.m_Data=i,this.copy=function(){var e=new XeTracker(this.m_MyParent);return e.m_Name=copyXeObjectMember(this.m_Name),e.m_Data=copyXeObjectMember(this.m_Data),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeTrackers=(XeTracker.prototype=Object.create(XeCollectionItem.prototype),XeTracker.prototype.constructor=XeCollectionItem,XeTracker.prototype.getName=function(){return this.m_Name},XeTracker.prototype.getData=function(){return this.m_Data},function(e,t){XeCollection.call(this,e);this.m_MyParent=e,this.m_ClassName="XeTrackers",this.m_Items=t,this.copy=function(){var e=new XeTrackers(this.m_MyParent);return e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGsDevice=(XeTrackers.prototype=Object.create(XeCollection.prototype),XeTrackers.prototype.constructor=XeCollection,function(e,t,i,r,n,o,a,s,c,l,d,u){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGsDevice",this.m_XeGsViewports=t,this.m_Chunks=i,this.m_Palette=r,this.m_Foreground=n,this.m_Background=o,this.m_PixelWidth=a,this.m_PixelHeight=s,this.m_UnitsPerMM=c,this.m_PSDenominator=l,this.m_MSDenominator=d,this.m_FadeMode=u,this.copy=function(){var e=new XeGsDevice(this.m_MyParent);return e.m_XeGsViewports=copyXeObjectMember(this.m_XeGsViewports),e.m_Chunks=copyXeObjectMember(this.m_Chunks),e.m_Palette=copyXeObjectMember(this.m_Palette),e.m_Foreground=copyXeObjectMember(this.m_Foreground),e.m_Background=copyXeObjectMember(this.m_Background),e.m_PixelWidth=copyXeObjectMember(this.m_PixelWidth),e.m_PixelHeight=copyXeObjectMember(this.m_PixelHeight),e.m_UnitsPerMM=copyXeObjectMember(this.m_UnitsPerMM),e.m_PSDenominator=copyXeObjectMember(this.m_PSDenominator),e.m_MSDenominator=copyXeObjectMember(this.m_MSDenominator),e.m_FadeMode=copyXeObjectMember(this.m_FadeMode),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeInputPointManager=(XeGsDevice.prototype=Object.create(XeObject.prototype),XeGsDevice.prototype.constructor=XeObject,XeGsDevice.prototype.getXeGsViewports=function(){return this.m_XeGsViewports},XeGsDevice.prototype.getChunks=function(){return this.m_Chunks},XeGsDevice.prototype.getPalette=function(){return this.m_Palette},XeGsDevice.prototype.getForeground=function(){return this.m_Foreground},XeGsDevice.prototype.getBackground=function(){return this.m_Background},XeGsDevice.prototype.setBackground=function(e){this.m_Background=e,this.m_bPreventServerNotify||this.NotifyServer("m_Background",e)},XeGsDevice.prototype.getPixelWidth=function(){return this.m_PixelWidth},XeGsDevice.prototype.getPixelHeight=function(){return this.m_PixelHeight},XeGsDevice.prototype.getUnitsPerMM=function(){return this.m_UnitsPerMM},XeGsDevice.prototype.getPSDenominator=function(){return this.m_PSDenominator},XeGsDevice.prototype.getMSDenominator=function(){return this.m_MSDenominator},XeGsDevice.prototype.getFadeMode=function(){return this.m_FadeMode},function(e,t,i,r,n,o,a,s,c,l,d,u){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeInputPointManager",this.m_InsideCommand=t,this.m_InsideLISP=i,this.m_OsnapCalculationEnabled=r,this.m_InsideSelect=n,this.m_InsideNEntsel=o,this.m_PENDING=a,this.m_RUBBERPOINT=s,this.m_CURSORPOINT=c,this.m_BASEPOINT=l,this.m_DrawRubberLine=d,this.m_DashedRubberLine=u,this.copy=function(){var e=new XeInputPointManager(this.m_MyParent);return e.m_InsideCommand=copyXeObjectMember(this.m_InsideCommand),e.m_InsideLISP=copyXeObjectMember(this.m_InsideLISP),e.m_OsnapCalculationEnabled=copyXeObjectMember(this.m_OsnapCalculationEnabled),e.m_InsideSelect=copyXeObjectMember(this.m_InsideSelect),e.m_InsideNEntsel=copyXeObjectMember(this.m_InsideNEntsel),e.m_PENDING=copyXeObjectMember(this.m_PENDING),e.m_RUBBERPOINT=copyXeObjectMember(this.m_RUBBERPOINT),e.m_CURSORPOINT=copyXeObjectMember(this.m_CURSORPOINT),e.m_BASEPOINT=copyXeObjectMember(this.m_BASEPOINT),e.m_DrawRubberLine=copyXeObjectMember(this.m_DrawRubberLine),e.m_DashedRubberLine=copyXeObjectMember(this.m_DashedRubberLine),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeCommandProcessor=(XeInputPointManager.prototype=Object.create(XeObject.prototype),XeInputPointManager.prototype.constructor=XeObject,XeInputPointManager.prototype.getInsideCommand=function(){return this.m_InsideCommand},XeInputPointManager.prototype.getInsideLISP=function(){return this.m_InsideLISP},XeInputPointManager.prototype.getOsnapCalculationEnabled=function(){return this.m_OsnapCalculationEnabled},XeInputPointManager.prototype.getInsideSelect=function(){return this.m_InsideSelect},XeInputPointManager.prototype.getInsideNEntsel=function(){return this.m_InsideNEntsel},XeInputPointManager.prototype.getPENDING=function(){return this.m_PENDING},XeInputPointManager.prototype.getRUBBERPOINT=function(){return this.m_RUBBERPOINT},XeInputPointManager.prototype.getCURSORPOINT=function(){return this.m_CURSORPOINT},XeInputPointManager.prototype.getBASEPOINT=function(){return this.m_BASEPOINT},XeInputPointManager.prototype.getDrawRubberLine=function(){return this.m_DrawRubberLine},XeInputPointManager.prototype.getDashedRubberLine=function(){return this.m_DashedRubberLine},function(e,t,i,r,n){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeCommandProcessor",this.m_CommandStarted=t,this.m_CommandCounter=i,this.m_Flags=r,this.m_CommandGlobalName=n,this.copy=function(){var e=new XeCommandProcessor(this.m_MyParent);return e.m_CommandStarted=copyXeObjectMember(this.m_CommandStarted),e.m_CommandCounter=copyXeObjectMember(this.m_CommandCounter),e.m_Flags=copyXeObjectMember(this.m_Flags),e.m_CommandGlobalName=copyXeObjectMember(this.m_CommandGlobalName),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDatabase=(XeCommandProcessor.prototype=Object.create(XeObject.prototype),XeCommandProcessor.prototype.constructor=XeObject,XeCommandProcessor.prototype.getCommandStarted=function(){return this.m_CommandStarted},XeCommandProcessor.prototype.getCommandCounter=function(){return this.m_CommandCounter},XeCommandProcessor.prototype.getFlags=function(){return this.m_Flags},XeCommandProcessor.prototype.getCommandGlobalName=function(){return this.m_CommandGlobalName},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b,X,S,P,D,x,O,G,E,A,I,k,M,L,R,N,F,V,B,U,W,H,j,z,Y,q,K,Z,J,Q,$,ee,te,ie,re,ne,oe,ae,se,ce,le,de,ue,pe,me,he,ge,ye,fe,_e,we,ve,Ce,Te,be,Xe,Se,Pe,De,xe,Oe,Ge,Ee,Ae,Ie,ke,Me,Le,Re,Ne,Fe,Ve){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDatabase",this.m_XeLayout=t,this.m_XeEntities=i,this.m_XeBlocks=r,this.m_XeLayers=n,this.m_XeLayerStateTable=o,this.m_XeLinetypeTable=a,this.m_XeTextStyleTable=s,this.m_XeDimensionStyleTable=c,this.m_XeMleaderStyleTable=l,this.m_XeTableStyleTable=d,this.m_XeGroupDictionary=u,this.m_CURSORSIZE=p,this.m_CURSORMODE=m,this.m_APERTURE=h,this.m_APBOX=g,this.m_PICKBOX=y,this.m_SELECTBOX=f,this.m_OSMODE=_,this.m_ORTHOMODE=w,this.m_SNAPSTYL=v,this.m_SNAPANG=C,this.m_LUNITS=T,this.m_LUPREC=b,this.m_AUNITS=X,this.m_AUPREC=S,this.m_UNITMODE=P,this.m_DIMZIN=D,this.m_ANGDIR=x,this.m_ANGBASE=O,this.m_COORDS=G,this.m_DYNASNAPSIZE=E,this.m_ZOOMFACTOR=A,this.m_ZOOMWHEEL=I,this.m_TEXTSIZE=k,this.m_MODELLAYOUTACTIVE=M,this.m_TOGGLEPALETTESTATE=L,this.m_TEXTSTYLE=R,this.m_DIMSTYLE=N,this.m_MLEADERSTYLE=F,this.m_TABLESTYLE=V,this.m_REFEDITNAME=B,this.m_BEDITNAME=U,this.m_GRIPCOLOR=W,this.m_GRIPDYNCOLOR=H,this.m_GRIPHOVER=j,this.m_GRIPHOT=z,this.m_GRIPSIZE=Y,this.m_BLIPMODE=q,this.m_GRIDDISPLAY=K,this.m_GRIDMODE=Z,this.m_SNAPMODE=J,this.m_LWDISPLAY=Q,this.m_LWDEFAULT=$,this.m_LWDISPSCALE=ee,this.m_GRIDUNIT=te,this.m_SNAPBASE=ie,this.m_LIMMIN=re,this.m_LIMMAX=ne,this.m_PLIMMIN=oe,this.m_PLIMMAX=ae,this.m_CMDNAMES=se,this.m_PREVCMD=ce,this.m_PlotPaperUnits=le,this.m_MEASUREMENT=de,this.m_DEBUGMODE=ue,this.m_DEBUGMODE2=pe,this.m_DEVOPTIONS=me,this.m_GRIPOBJLIMIT=he,this.m_GRIPS=ge,this.m_GROUPDISPLAYMODE=ye,this.m_PSLTSCALE=fe,this.m_LTSCALE=_e,this.m_CELWEIGHT=we,this.m_CELWEIGHTVALUE=ve,this.m_CELWEIGHTLIST=Ce,this.m_ACTIVESHADEMODE=Te,this.m_ORTHOVIEW=be,this.m_FRAME=Xe,this.m_CELTSCALE=Se,this.m_CECOLOR=Pe,this.m_COLORLIST=De,this.m_ACTIVELAYERSTATE=xe,this.m_CETRANSPARENCY=Oe,this.m_CELTYPE=Ge,this.m_CLAYER=Ee,this.m_XFADECTL=Ae,this.m_LAYLOCKFADECTL=Ie,this.m_CVPORT=ke,this.m_CANNOSCALEVALUE=Me,this.m_DoErase=Le,this.m_Entget=Re,this.m_Entmod=Ne,this.m_Entnext=Fe,this.m_Entlast=Ve,this.copy=function(){var e=new XeDatabase(this.m_MyParent);return e.m_XeLayout=copyXeObjectMember(this.m_XeLayout),e.m_XeEntities=copyXeObjectMember(this.m_XeEntities),e.m_XeBlocks=copyXeObjectMember(this.m_XeBlocks),e.m_XeLayers=copyXeObjectMember(this.m_XeLayers),e.m_XeLayerStateTable=copyXeObjectMember(this.m_XeLayerStateTable),e.m_XeLinetypeTable=copyXeObjectMember(this.m_XeLinetypeTable),e.m_XeTextStyleTable=copyXeObjectMember(this.m_XeTextStyleTable),e.m_XeDimensionStyleTable=copyXeObjectMember(this.m_XeDimensionStyleTable),e.m_XeMleaderStyleTable=copyXeObjectMember(this.m_XeMleaderStyleTable),e.m_XeTableStyleTable=copyXeObjectMember(this.m_XeTableStyleTable),e.m_XeGroupDictionary=copyXeObjectMember(this.m_XeGroupDictionary),e.m_CURSORSIZE=copyXeObjectMember(this.m_CURSORSIZE),e.m_CURSORMODE=copyXeObjectMember(this.m_CURSORMODE),e.m_APERTURE=copyXeObjectMember(this.m_APERTURE),e.m_APBOX=copyXeObjectMember(this.m_APBOX),e.m_PICKBOX=copyXeObjectMember(this.m_PICKBOX),e.m_SELECTBOX=copyXeObjectMember(this.m_SELECTBOX),e.m_OSMODE=copyXeObjectMember(this.m_OSMODE),e.m_ORTHOMODE=copyXeObjectMember(this.m_ORTHOMODE),e.m_SNAPSTYL=copyXeObjectMember(this.m_SNAPSTYL),e.m_SNAPANG=copyXeObjectMember(this.m_SNAPANG),e.m_LUNITS=copyXeObjectMember(this.m_LUNITS),e.m_LUPREC=copyXeObjectMember(this.m_LUPREC),e.m_AUNITS=copyXeObjectMember(this.m_AUNITS),e.m_AUPREC=copyXeObjectMember(this.m_AUPREC),e.m_UNITMODE=copyXeObjectMember(this.m_UNITMODE),e.m_DIMZIN=copyXeObjectMember(this.m_DIMZIN),e.m_ANGDIR=copyXeObjectMember(this.m_ANGDIR),e.m_ANGBASE=copyXeObjectMember(this.m_ANGBASE),e.m_COORDS=copyXeObjectMember(this.m_COORDS),e.m_DYNASNAPSIZE=copyXeObjectMember(this.m_DYNASNAPSIZE),e.m_ZOOMFACTOR=copyXeObjectMember(this.m_ZOOMFACTOR),e.m_ZOOMWHEEL=copyXeObjectMember(this.m_ZOOMWHEEL),e.m_TEXTSIZE=copyXeObjectMember(this.m_TEXTSIZE),e.m_MODELLAYOUTACTIVE=copyXeObjectMember(this.m_MODELLAYOUTACTIVE),e.m_TOGGLEPALETTESTATE=copyXeObjectMember(this.m_TOGGLEPALETTESTATE),e.m_TEXTSTYLE=copyXeObjectMember(this.m_TEXTSTYLE),e.m_DIMSTYLE=copyXeObjectMember(this.m_DIMSTYLE),e.m_MLEADERSTYLE=copyXeObjectMember(this.m_MLEADERSTYLE),e.m_TABLESTYLE=copyXeObjectMember(this.m_TABLESTYLE),e.m_REFEDITNAME=copyXeObjectMember(this.m_REFEDITNAME),e.m_BEDITNAME=copyXeObjectMember(this.m_BEDITNAME),e.m_GRIPCOLOR=copyXeObjectMember(this.m_GRIPCOLOR),e.m_GRIPDYNCOLOR=copyXeObjectMember(this.m_GRIPDYNCOLOR),e.m_GRIPHOVER=copyXeObjectMember(this.m_GRIPHOVER),e.m_GRIPHOT=copyXeObjectMember(this.m_GRIPHOT),e.m_GRIPSIZE=copyXeObjectMember(this.m_GRIPSIZE),e.m_BLIPMODE=copyXeObjectMember(this.m_BLIPMODE),e.m_GRIDDISPLAY=copyXeObjectMember(this.m_GRIDDISPLAY),e.m_GRIDMODE=copyXeObjectMember(this.m_GRIDMODE),e.m_SNAPMODE=copyXeObjectMember(this.m_SNAPMODE),e.m_LWDISPLAY=copyXeObjectMember(this.m_LWDISPLAY),e.m_LWDEFAULT=copyXeObjectMember(this.m_LWDEFAULT),e.m_LWDISPSCALE=copyXeObjectMember(this.m_LWDISPSCALE),e.m_GRIDUNIT=copyXeObjectMember(this.m_GRIDUNIT),e.m_SNAPBASE=copyXeObjectMember(this.m_SNAPBASE),e.m_LIMMIN=copyXeObjectMember(this.m_LIMMIN),e.m_LIMMAX=copyXeObjectMember(this.m_LIMMAX),e.m_PLIMMIN=copyXeObjectMember(this.m_PLIMMIN),e.m_PLIMMAX=copyXeObjectMember(this.m_PLIMMAX),e.m_CMDNAMES=copyXeObjectMember(this.m_CMDNAMES),e.m_PREVCMD=copyXeObjectMember(this.m_PREVCMD),e.m_PlotPaperUnits=copyXeObjectMember(this.m_PlotPaperUnits),e.m_MEASUREMENT=copyXeObjectMember(this.m_MEASUREMENT),e.m_DEBUGMODE=copyXeObjectMember(this.m_DEBUGMODE),e.m_DEBUGMODE2=copyXeObjectMember(this.m_DEBUGMODE2),e.m_DEVOPTIONS=copyXeObjectMember(this.m_DEVOPTIONS),e.m_GRIPOBJLIMIT=copyXeObjectMember(this.m_GRIPOBJLIMIT),e.m_GRIPS=copyXeObjectMember(this.m_GRIPS),e.m_GROUPDISPLAYMODE=copyXeObjectMember(this.m_GROUPDISPLAYMODE),e.m_PSLTSCALE=copyXeObjectMember(this.m_PSLTSCALE),e.m_LTSCALE=copyXeObjectMember(this.m_LTSCALE),e.m_CELWEIGHT=copyXeObjectMember(this.m_CELWEIGHT),e.m_CELWEIGHTVALUE=copyXeObjectMember(this.m_CELWEIGHTVALUE),e.m_CELWEIGHTLIST=copyXeObjectMember(this.m_CELWEIGHTLIST),e.m_ACTIVESHADEMODE=copyXeObjectMember(this.m_ACTIVESHADEMODE),e.m_ORTHOVIEW=copyXeObjectMember(this.m_ORTHOVIEW),e.m_FRAME=copyXeObjectMember(this.m_FRAME),e.m_CELTSCALE=copyXeObjectMember(this.m_CELTSCALE),e.m_CECOLOR=copyXeObjectMember(this.m_CECOLOR),e.m_COLORLIST=copyXeObjectMember(this.m_COLORLIST),e.m_ACTIVELAYERSTATE=copyXeObjectMember(this.m_ACTIVELAYERSTATE),e.m_CETRANSPARENCY=copyXeObjectMember(this.m_CETRANSPARENCY),e.m_CELTYPE=copyXeObjectMember(this.m_CELTYPE),e.m_CLAYER=copyXeObjectMember(this.m_CLAYER),e.m_XFADECTL=copyXeObjectMember(this.m_XFADECTL),e.m_LAYLOCKFADECTL=copyXeObjectMember(this.m_LAYLOCKFADECTL),e.m_CVPORT=copyXeObjectMember(this.m_CVPORT),e.m_CANNOSCALEVALUE=copyXeObjectMember(this.m_CANNOSCALEVALUE),e.m_DoErase=copyXeObjectMember(this.m_DoErase),e.m_Entget=copyXeObjectMember(this.m_Entget),e.m_Entmod=copyXeObjectMember(this.m_Entmod),e.m_Entnext=copyXeObjectMember(this.m_Entnext),e.m_Entlast=copyXeObjectMember(this.m_Entlast),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUICommandLine=(XeDatabase.prototype=Object.create(XeObject.prototype),XeDatabase.prototype.constructor=XeObject,XeDatabase.prototype.getXeLayout=function(){return this.m_XeLayout},XeDatabase.prototype.getXeEntities=function(){return this.m_XeEntities},XeDatabase.prototype.getXeBlocks=function(){return this.m_XeBlocks},XeDatabase.prototype.getXeLayers=function(){return this.m_XeLayers},XeDatabase.prototype.getXeLayerStateTable=function(){return this.m_XeLayerStateTable},XeDatabase.prototype.getXeLinetypeTable=function(){return this.m_XeLinetypeTable},XeDatabase.prototype.getXeTextStyleTable=function(){return this.m_XeTextStyleTable},XeDatabase.prototype.getXeDimensionStyleTable=function(){return this.m_XeDimensionStyleTable},XeDatabase.prototype.getXeMleaderStyleTable=function(){return this.m_XeMleaderStyleTable},XeDatabase.prototype.getXeTableStyleTable=function(){return this.m_XeTableStyleTable},XeDatabase.prototype.getXeGroupDictionary=function(){return this.m_XeGroupDictionary},XeDatabase.prototype.getCURSORSIZE=function(){return this.m_CURSORSIZE},XeDatabase.prototype.getCURSORMODE=function(){return this.m_CURSORMODE},XeDatabase.prototype.setCURSORMODE=function(e){this.m_CURSORMODE=e,this.m_bPreventServerNotify||this.NotifyServer("m_CURSORMODE",e)},XeDatabase.prototype.getAPERTURE=function(){return this.m_APERTURE},XeDatabase.prototype.setAPERTURE=function(e){this.m_APERTURE=e,this.m_bPreventServerNotify||this.NotifyServer("m_APERTURE",e)},XeDatabase.prototype.getAPBOX=function(){return this.m_APBOX},XeDatabase.prototype.setAPBOX=function(e){this.m_APBOX=e,this.m_bPreventServerNotify||this.NotifyServer("m_APBOX",e)},XeDatabase.prototype.getPICKBOX=function(){return this.m_PICKBOX},XeDatabase.prototype.setPICKBOX=function(e){this.m_PICKBOX=e,this.m_bPreventServerNotify||this.NotifyServer("m_PICKBOX",e)},XeDatabase.prototype.getSELECTBOX=function(){return this.m_SELECTBOX},XeDatabase.prototype.getOSMODE=function(){return this.m_OSMODE},XeDatabase.prototype.setOSMODE=function(e){this.m_OSMODE=e,this.m_bPreventServerNotify||this.NotifyServer("m_OSMODE",e)},XeDatabase.prototype.getORTHOMODE=function(){return this.m_ORTHOMODE},XeDatabase.prototype.getSNAPSTYL=function(){return this.m_SNAPSTYL},XeDatabase.prototype.getSNAPANG=function(){return this.m_SNAPANG},XeDatabase.prototype.getLUNITS=function(){return this.m_LUNITS},XeDatabase.prototype.getLUPREC=function(){return this.m_LUPREC},XeDatabase.prototype.getAUNITS=function(){return this.m_AUNITS},XeDatabase.prototype.getAUPREC=function(){return this.m_AUPREC},XeDatabase.prototype.getUNITMODE=function(){return this.m_UNITMODE},XeDatabase.prototype.getDIMZIN=function(){return this.m_DIMZIN},XeDatabase.prototype.getANGDIR=function(){return this.m_ANGDIR},XeDatabase.prototype.getANGBASE=function(){return this.m_ANGBASE},XeDatabase.prototype.getCOORDS=function(){return this.m_COORDS},XeDatabase.prototype.getDYNASNAPSIZE=function(){return this.m_DYNASNAPSIZE},XeDatabase.prototype.getZOOMFACTOR=function(){return this.m_ZOOMFACTOR},XeDatabase.prototype.getZOOMWHEEL=function(){return this.m_ZOOMWHEEL},XeDatabase.prototype.getTEXTSIZE=function(){return this.m_TEXTSIZE},XeDatabase.prototype.getMODELLAYOUTACTIVE=function(){return this.m_MODELLAYOUTACTIVE},XeDatabase.prototype.getTOGGLEPALETTESTATE=function(){return this.m_TOGGLEPALETTESTATE},XeDatabase.prototype.getTEXTSTYLE=function(){return this.m_TEXTSTYLE},XeDatabase.prototype.getDIMSTYLE=function(){return this.m_DIMSTYLE},XeDatabase.prototype.getMLEADERSTYLE=function(){return this.m_MLEADERSTYLE},XeDatabase.prototype.getTABLESTYLE=function(){return this.m_TABLESTYLE},XeDatabase.prototype.getREFEDITNAME=function(){return this.m_REFEDITNAME},XeDatabase.prototype.getBEDITNAME=function(){return this.m_BEDITNAME},XeDatabase.prototype.getGRIPCOLOR=function(){return this.m_GRIPCOLOR},XeDatabase.prototype.getGRIPDYNCOLOR=function(){return this.m_GRIPDYNCOLOR},XeDatabase.prototype.getGRIPHOVER=function(){return this.m_GRIPHOVER},XeDatabase.prototype.getGRIPHOT=function(){return this.m_GRIPHOT},XeDatabase.prototype.getGRIPSIZE=function(){return this.m_GRIPSIZE},XeDatabase.prototype.getBLIPMODE=function(){return this.m_BLIPMODE},XeDatabase.prototype.getGRIDDISPLAY=function(){return this.m_GRIDDISPLAY},XeDatabase.prototype.getGRIDMODE=function(){return this.m_GRIDMODE},XeDatabase.prototype.getSNAPMODE=function(){return this.m_SNAPMODE},XeDatabase.prototype.getLWDISPLAY=function(){return this.m_LWDISPLAY},XeDatabase.prototype.getLWDEFAULT=function(){return this.m_LWDEFAULT},XeDatabase.prototype.getLWDISPSCALE=function(){return this.m_LWDISPSCALE},XeDatabase.prototype.getGRIDUNIT=function(){return this.m_GRIDUNIT},XeDatabase.prototype.getSNAPBASE=function(){return this.m_SNAPBASE},XeDatabase.prototype.getLIMMIN=function(){return this.m_LIMMIN},XeDatabase.prototype.getLIMMAX=function(){return this.m_LIMMAX},XeDatabase.prototype.getPLIMMIN=function(){return this.m_PLIMMIN},XeDatabase.prototype.getPLIMMAX=function(){return this.m_PLIMMAX},XeDatabase.prototype.getCMDNAMES=function(){return this.m_CMDNAMES},XeDatabase.prototype.getPREVCMD=function(){return this.m_PREVCMD},XeDatabase.prototype.getPlotPaperUnits=function(){return this.m_PlotPaperUnits},XeDatabase.prototype.getMEASUREMENT=function(){return this.m_MEASUREMENT},XeDatabase.prototype.getDEBUGMODE=function(){return this.m_DEBUGMODE},XeDatabase.prototype.getDEBUGMODE2=function(){return this.m_DEBUGMODE2},XeDatabase.prototype.getDEVOPTIONS=function(){return this.m_DEVOPTIONS},XeDatabase.prototype.getGRIPOBJLIMIT=function(){return this.m_GRIPOBJLIMIT},XeDatabase.prototype.getGRIPS=function(){return this.m_GRIPS},XeDatabase.prototype.getGROUPDISPLAYMODE=function(){return this.m_GROUPDISPLAYMODE},XeDatabase.prototype.setGROUPDISPLAYMODE=function(e){this.m_GROUPDISPLAYMODE=e,this.m_bPreventServerNotify||this.NotifyServer("m_GROUPDISPLAYMODE",e)},XeDatabase.prototype.getPSLTSCALE=function(){return this.m_PSLTSCALE},XeDatabase.prototype.getLTSCALE=function(){return this.m_LTSCALE},XeDatabase.prototype.getCELWEIGHT=function(){return this.m_CELWEIGHT},XeDatabase.prototype.getCELWEIGHTVALUE=function(){return this.m_CELWEIGHTVALUE},XeDatabase.prototype.getCELWEIGHTLIST=function(){return this.m_CELWEIGHTLIST},XeDatabase.prototype.getACTIVESHADEMODE=function(){return this.m_ACTIVESHADEMODE},XeDatabase.prototype.getORTHOVIEW=function(){return this.m_ORTHOVIEW},XeDatabase.prototype.getFRAME=function(){return this.m_FRAME},XeDatabase.prototype.getCELTSCALE=function(){return this.m_CELTSCALE},XeDatabase.prototype.getCECOLOR=function(){return this.m_CECOLOR},XeDatabase.prototype.getCOLORLIST=function(){return this.m_COLORLIST},XeDatabase.prototype.getACTIVELAYERSTATE=function(){return this.m_ACTIVELAYERSTATE},XeDatabase.prototype.getCETRANSPARENCY=function(){return this.m_CETRANSPARENCY},XeDatabase.prototype.getCELTYPE=function(){return this.m_CELTYPE},XeDatabase.prototype.getCLAYER=function(){return this.m_CLAYER},XeDatabase.prototype.getXFADECTL=function(){return this.m_XFADECTL},XeDatabase.prototype.getLAYLOCKFADECTL=function(){return this.m_LAYLOCKFADECTL},XeDatabase.prototype.getCVPORT=function(){return this.m_CVPORT},XeDatabase.prototype.setCVPORT=function(e){this.m_CVPORT=e,this.m_bPreventServerNotify||this.NotifyServer("m_CVPORT",e)},XeDatabase.prototype.getCANNOSCALEVALUE=function(){return this.m_CANNOSCALEVALUE},XeDatabase.prototype.DoErase=function(e){return this.CallMethod("m_DoErase",e)},XeDatabase.prototype.Entget=function(e){return this.CallMethod("m_Entget",e)},XeDatabase.prototype.Entmod=function(e){return this.CallMethod("m_Entmod",e)},XeDatabase.prototype.Entnext=function(e){return this.CallMethod("m_Entnext",e)},XeDatabase.prototype.Entlast=function(){return this.CallMethod("m_Entlast")},function(e,t,i){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUICommandLine",this.m_Id=t,this.m_Visible=i,this.copy=function(){var e=new XeUICommandLine(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Visible=copyXeObjectMember(this.m_Visible),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUILayerPanel=(XeUICommandLine.prototype=Object.create(XeObject.prototype),XeUICommandLine.prototype.constructor=XeObject,XeUICommandLine.prototype.getId=function(){return this.m_Id},XeUICommandLine.prototype.getVisible=function(){return this.m_Visible},XeUICommandLine.prototype.setVisible=function(e){this.m_Visible=e,this.m_bPreventServerNotify||this.NotifyServer("m_Visible",e)},function(e,t,i,r){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUILayerPanel",this.m_Id=t,this.m_Visible=i,this.m_Height=r,this.copy=function(){var e=new XeUILayerPanel(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Visible=copyXeObjectMember(this.m_Visible),e.m_Height=copyXeObjectMember(this.m_Height),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUIProperties=(XeUILayerPanel.prototype=Object.create(XeObject.prototype),XeUILayerPanel.prototype.constructor=XeObject,XeUILayerPanel.prototype.getId=function(){return this.m_Id},XeUILayerPanel.prototype.getVisible=function(){return this.m_Visible},XeUILayerPanel.prototype.setVisible=function(e){this.m_Visible=e,this.m_bPreventServerNotify||this.NotifyServer("m_Visible",e)},XeUILayerPanel.prototype.getHeight=function(){return this.m_Height},XeUILayerPanel.prototype.setHeight=function(e){this.m_Height=e,this.m_bPreventServerNotify||this.NotifyServer("m_Height",e)},function(e,t,i,r){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUIProperties",this.m_Id=t,this.m_Visible=i,this.m_Height=r,this.copy=function(){var e=new XeUIProperties(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Visible=copyXeObjectMember(this.m_Visible),e.m_Height=copyXeObjectMember(this.m_Height),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUIStatusBar=(XeUIProperties.prototype=Object.create(XeObject.prototype),XeUIProperties.prototype.constructor=XeObject,XeUIProperties.prototype.getId=function(){return this.m_Id},XeUIProperties.prototype.getVisible=function(){return this.m_Visible},XeUIProperties.prototype.setVisible=function(e){this.m_Visible=e,this.m_bPreventServerNotify||this.NotifyServer("m_Visible",e)},XeUIProperties.prototype.getHeight=function(){return this.m_Height},XeUIProperties.prototype.setHeight=function(e){this.m_Height=e,this.m_bPreventServerNotify||this.NotifyServer("m_Height",e)},function(e,t,i,r){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUIStatusBar",this.m_Id=t,this.m_Visible=i,this.m_Coordinates=r,this.copy=function(){var e=new XeUIStatusBar(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Visible=copyXeObjectMember(this.m_Visible),e.m_Coordinates=copyXeObjectMember(this.m_Coordinates),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUINavigationToolbar=(XeUIStatusBar.prototype=Object.create(XeObject.prototype),XeUIStatusBar.prototype.constructor=XeObject,XeUIStatusBar.prototype.getId=function(){return this.m_Id},XeUIStatusBar.prototype.getVisible=function(){return this.m_Visible},XeUIStatusBar.prototype.setVisible=function(e){this.m_Visible=e,this.m_bPreventServerNotify||this.NotifyServer("m_Visible",e)},XeUIStatusBar.prototype.getCoordinates=function(){return this.m_Coordinates},function(e,t){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUINavigationToolbar",this.m_Id=t,this.copy=function(){var e=new XeUINavigationToolbar(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUIToolbarCollection=(XeUINavigationToolbar.prototype=Object.create(XeObject.prototype),XeUINavigationToolbar.prototype.constructor=XeObject,XeUINavigationToolbar.prototype.getId=function(){return this.m_Id},function(e,t,i){XeCollection.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUIToolbarCollection",this.m_DeleteItem=i,this.m_Items=t,this.copy=function(){var e=new XeUIToolbarCollection(this.m_MyParent);return e.m_DeleteItem=copyXeObjectMember(this.m_DeleteItem),e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUIToolbarItem=(XeUIToolbarCollection.prototype=Object.create(XeCollection.prototype),XeUIToolbarCollection.prototype.constructor=XeCollection,XeUIToolbarCollection.prototype.DeleteItem=function(e){return this.CallMethod("m_DeleteItem",e)},function(e,t,i,r,n,o){XeCollectionItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUIToolbarItem",this.m_UID=t,this.m_Name=i,this.m_Type=r,this.m_Visible=n,this.m_DeleteChild=o,this.copy=function(){var e=new XeUIToolbarItem(this.m_MyParent);return e.m_UID=copyXeObjectMember(this.m_UID),e.m_Name=copyXeObjectMember(this.m_Name),e.m_Type=copyXeObjectMember(this.m_Type),e.m_Visible=copyXeObjectMember(this.m_Visible),e.m_DeleteChild=copyXeObjectMember(this.m_DeleteChild),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeUI=(XeUIToolbarItem.prototype=Object.create(XeCollectionItem.prototype),XeUIToolbarItem.prototype.constructor=XeCollectionItem,XeUIToolbarItem.prototype.getUID=function(){return this.m_UID},XeUIToolbarItem.prototype.getName=function(){return this.m_Name},XeUIToolbarItem.prototype.setName=function(e){this.m_Name=e,this.m_bPreventServerNotify||this.NotifyServer("m_Name",e)},XeUIToolbarItem.prototype.getType=function(){return this.m_Type},XeUIToolbarItem.prototype.getVisible=function(){return this.m_Visible},XeUIToolbarItem.prototype.setVisible=function(e){this.m_Visible=e,this.m_bPreventServerNotify||this.NotifyServer("m_Visible",e)},XeUIToolbarItem.prototype.DeleteChild=function(e){return this.CallMethod("m_DeleteChild",e)},function(e,t,i,r,n,o,a,s,c,l,d,u,p){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeUI",this.m_SetActiveToolbarItem=t,this.m_ShowRmbGAMenu=i,this.m_ProcessMouseClick=r,this.m_HideDimPallete=n,this.m_StatusBar=o,this.m_Properties=a,this.m_CommandLine=s,this.m_LayerPanel=c,this.m_NavigationToolbar=l,this.m_NavigationToolbars=d,this.m_RibbonConfigURL=u,this.m_RibbonHeight=p,this.copy=function(){var e=new XeUI(this.m_MyParent);return e.m_SetActiveToolbarItem=copyXeObjectMember(this.m_SetActiveToolbarItem),e.m_ShowRmbGAMenu=copyXeObjectMember(this.m_ShowRmbGAMenu),e.m_ProcessMouseClick=copyXeObjectMember(this.m_ProcessMouseClick),e.m_HideDimPallete=copyXeObjectMember(this.m_HideDimPallete),e.m_StatusBar=copyXeObjectMember(this.m_StatusBar),e.m_Properties=copyXeObjectMember(this.m_Properties),e.m_CommandLine=copyXeObjectMember(this.m_CommandLine),e.m_LayerPanel=copyXeObjectMember(this.m_LayerPanel),e.m_NavigationToolbar=copyXeObjectMember(this.m_NavigationToolbar),e.m_NavigationToolbars=copyXeObjectMember(this.m_NavigationToolbars),e.m_RibbonConfigURL=copyXeObjectMember(this.m_RibbonConfigURL),e.m_RibbonHeight=copyXeObjectMember(this.m_RibbonHeight),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeEntPath=(XeUI.prototype=Object.create(XeObject.prototype),XeUI.prototype.constructor=XeObject,XeUI.prototype.SetActiveToolbarItem=function(e){return this.CallMethod("m_SetActiveToolbarItem",e)},XeUI.prototype.ShowRmbGAMenu=function(e){return this.CallMethod("m_ShowRmbGAMenu",e)},XeUI.prototype.ProcessMouseClick=function(e){return this.CallMethod("m_ProcessMouseClick",e)},XeUI.prototype.HideDimPallete=function(e){return this.CallMethod("m_HideDimPallete",e)},XeUI.prototype.getStatusBar=function(){return this.m_StatusBar},XeUI.prototype.getProperties=function(){return this.m_Properties},XeUI.prototype.getCommandLine=function(){return this.m_CommandLine},XeUI.prototype.getLayerPanel=function(){return this.m_LayerPanel},XeUI.prototype.getNavigationToolbar=function(){return this.m_NavigationToolbar},XeUI.prototype.getNavigationToolbars=function(){return this.m_NavigationToolbars},XeUI.prototype.getRibbonConfigURL=function(){return this.m_RibbonConfigURL},XeUI.prototype.getRibbonHeight=function(){return this.m_RibbonHeight},function(e,t,i){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeEntPath",this.m_Handles=t,this.m_Marker=i,this.copy=function(){var e=new XeEntPath(this.m_MyParent);return e.m_Handles=copyXeObjectMember(this.m_Handles),e.m_Marker=copyXeObjectMember(this.m_Marker),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeSelectionSet=(XeEntPath.prototype=Object.create(XeObject.prototype),XeEntPath.prototype.constructor=XeObject,XeEntPath.prototype.getHandles=function(){return this.m_Handles},XeEntPath.prototype.getMarker=function(){return this.m_Marker},function(e,t,i,r,n,o,a,s,c,l,d,u){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeSelectionSet",this.m_Id=t,this.m_Handles=i,this.m_Color=r,this.m_Alpha=n,this.m_DynamicColor=o,this.m_Thickness=a,this.m_Type=s,this.m_GripsEnabled=c,this.m_Append=l,this.m_Remove=d,this.m_Clear=u,this.copy=function(){var e=new XeSelectionSet(this.m_MyParent);return e.m_Id=copyXeObjectMember(this.m_Id),e.m_Handles=copyXeObjectMember(this.m_Handles),e.m_Color=copyXeObjectMember(this.m_Color),e.m_Alpha=copyXeObjectMember(this.m_Alpha),e.m_DynamicColor=copyXeObjectMember(this.m_DynamicColor),e.m_Thickness=copyXeObjectMember(this.m_Thickness),e.m_Type=copyXeObjectMember(this.m_Type),e.m_GripsEnabled=copyXeObjectMember(this.m_GripsEnabled),e.m_Append=copyXeObjectMember(this.m_Append),e.m_Remove=copyXeObjectMember(this.m_Remove),e.m_Clear=copyXeObjectMember(this.m_Clear),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeSelectionSets=(XeSelectionSet.prototype=Object.create(XeObject.prototype),XeSelectionSet.prototype.constructor=XeObject,XeSelectionSet.prototype.getId=function(){return this.m_Id},XeSelectionSet.prototype.setId=function(e){this.m_Id=e,this.m_bPreventServerNotify||this.NotifyServer("m_Id",e)},XeSelectionSet.prototype.getHandles=function(){return this.m_Handles},XeSelectionSet.prototype.setHandles=function(e){this.m_Handles=e,this.m_bPreventServerNotify||this.NotifyServer("m_Handles",e)},XeSelectionSet.prototype.getColor=function(){return this.m_Color},XeSelectionSet.prototype.setColor=function(e){this.m_Color=e,this.m_bPreventServerNotify||this.NotifyServer("m_Color",e)},XeSelectionSet.prototype.getAlpha=function(){return this.m_Alpha},XeSelectionSet.prototype.setAlpha=function(e){this.m_Alpha=e,this.m_bPreventServerNotify||this.NotifyServer("m_Alpha",e)},XeSelectionSet.prototype.getDynamicColor=function(){return this.m_DynamicColor},XeSelectionSet.prototype.setDynamicColor=function(e){this.m_DynamicColor=e,this.m_bPreventServerNotify||this.NotifyServer("m_DynamicColor",e)},XeSelectionSet.prototype.getThickness=function(){return this.m_Thickness},XeSelectionSet.prototype.setThickness=function(e){this.m_Thickness=e,this.m_bPreventServerNotify||this.NotifyServer("m_Thickness",e)},XeSelectionSet.prototype.getType=function(){return this.m_Type},XeSelectionSet.prototype.setType=function(e){this.m_Type=e,this.m_bPreventServerNotify||this.NotifyServer("m_Type",e)},XeSelectionSet.prototype.getGripsEnabled=function(){return this.m_GripsEnabled},XeSelectionSet.prototype.setGripsEnabled=function(e){this.m_GripsEnabled=e,this.m_bPreventServerNotify||this.NotifyServer("m_GripsEnabled",e)},XeSelectionSet.prototype.Append=function(e){return this.CallMethod("m_Append",e)},XeSelectionSet.prototype.Remove=function(e){return this.CallMethod("m_Remove",e)},XeSelectionSet.prototype.Clear=function(e){return this.CallMethod("m_Clear",e)},function(e,t){XeCollection.call(this,e);this.m_MyParent=e,this.m_ClassName="XeSelectionSets",this.m_Items=t,this.copy=function(){var e=new XeSelectionSets(this.m_MyParent);return e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeProfile=(XeSelectionSets.prototype=Object.create(XeCollection.prototype),XeSelectionSets.prototype.constructor=XeCollection,function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeProfile",this.m_LayoutDisplayMargins=t,this.m_LayoutDisplayPaper=i,this.m_ModelCrosshairColor=r,this.m_LayoutCrosshairColor=n,this.m_GraphicsWinModelBackgrndColor=o,this.m_GraphicsWinLayoutBackgrndColor=a,this.m_CrosshairXAxisColor=s,this.m_CrosshairYAxisColor=c,this.m_CrosshairZAxisColor=l,this.m_CrosshairTintMode=d,this.m_AutoTrackingVecColor=u,this.m_LayoutAutoTrackingVecColor=p,this.m_GripAlpha=m,this.m_DynaSnapMarkerColor=h,this.m_DynaSnapMarkerSize=g,this.copy=function(){var e=new XeProfile(this.m_MyParent);return e.m_LayoutDisplayMargins=copyXeObjectMember(this.m_LayoutDisplayMargins),e.m_LayoutDisplayPaper=copyXeObjectMember(this.m_LayoutDisplayPaper),e.m_ModelCrosshairColor=copyXeObjectMember(this.m_ModelCrosshairColor),e.m_LayoutCrosshairColor=copyXeObjectMember(this.m_LayoutCrosshairColor),e.m_GraphicsWinModelBackgrndColor=copyXeObjectMember(this.m_GraphicsWinModelBackgrndColor),e.m_GraphicsWinLayoutBackgrndColor=copyXeObjectMember(this.m_GraphicsWinLayoutBackgrndColor),e.m_CrosshairXAxisColor=copyXeObjectMember(this.m_CrosshairXAxisColor),e.m_CrosshairYAxisColor=copyXeObjectMember(this.m_CrosshairYAxisColor),e.m_CrosshairZAxisColor=copyXeObjectMember(this.m_CrosshairZAxisColor),e.m_CrosshairTintMode=copyXeObjectMember(this.m_CrosshairTintMode),e.m_AutoTrackingVecColor=copyXeObjectMember(this.m_AutoTrackingVecColor),e.m_LayoutAutoTrackingVecColor=copyXeObjectMember(this.m_LayoutAutoTrackingVecColor),e.m_GripAlpha=copyXeObjectMember(this.m_GripAlpha),e.m_DynaSnapMarkerColor=copyXeObjectMember(this.m_DynaSnapMarkerColor),e.m_DynaSnapMarkerSize=copyXeObjectMember(this.m_DynaSnapMarkerSize),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGlyphItem=(XeProfile.prototype=Object.create(XeObject.prototype),XeProfile.prototype.constructor=XeObject,XeProfile.prototype.getLayoutDisplayMargins=function(){return this.m_LayoutDisplayMargins},XeProfile.prototype.getLayoutDisplayPaper=function(){return this.m_LayoutDisplayPaper},XeProfile.prototype.getModelCrosshairColor=function(){return this.m_ModelCrosshairColor},XeProfile.prototype.getLayoutCrosshairColor=function(){return this.m_LayoutCrosshairColor},XeProfile.prototype.getGraphicsWinModelBackgrndColor=function(){return this.m_GraphicsWinModelBackgrndColor},XeProfile.prototype.getGraphicsWinLayoutBackgrndColor=function(){return this.m_GraphicsWinLayoutBackgrndColor},XeProfile.prototype.getCrosshairXAxisColor=function(){return this.m_CrosshairXAxisColor},XeProfile.prototype.getCrosshairYAxisColor=function(){return this.m_CrosshairYAxisColor},XeProfile.prototype.getCrosshairZAxisColor=function(){return this.m_CrosshairZAxisColor},XeProfile.prototype.getCrosshairTintMode=function(){return this.m_CrosshairTintMode},XeProfile.prototype.getAutoTrackingVecColor=function(){return this.m_AutoTrackingVecColor},XeProfile.prototype.getLayoutAutoTrackingVecColor=function(){return this.m_LayoutAutoTrackingVecColor},XeProfile.prototype.getGripAlpha=function(){return this.m_GripAlpha},XeProfile.prototype.getDynaSnapMarkerColor=function(){return this.m_DynaSnapMarkerColor},XeProfile.prototype.getDynaSnapMarkerSize=function(){return this.m_DynaSnapMarkerSize},function(e,t,i,r,n,o){XeCollectionItem.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGlyphItem",this.m_Key=t,this.m_Char=i,this.m_Type=r,this.m_Verts2d=n,this.m_Indexes=o,this.copy=function(){var e=new XeGlyphItem(this.m_MyParent);return e.m_Key=copyXeObjectMember(this.m_Key),e.m_Char=copyXeObjectMember(this.m_Char),e.m_Type=copyXeObjectMember(this.m_Type),e.m_Verts2d=copyXeObjectMember(this.m_Verts2d),e.m_Indexes=copyXeObjectMember(this.m_Indexes),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeGlyphStorage=(XeGlyphItem.prototype=Object.create(XeCollectionItem.prototype),XeGlyphItem.prototype.constructor=XeCollectionItem,XeGlyphItem.prototype.getKey=function(){return this.m_Key},XeGlyphItem.prototype.getChar=function(){return this.m_Char},XeGlyphItem.prototype.getType=function(){return this.m_Type},XeGlyphItem.prototype.getVerts2d=function(){return this.m_Verts2d},XeGlyphItem.prototype.getIndexes=function(){return this.m_Indexes},function(e,t){XeCollection.call(this,e);this.m_MyParent=e,this.m_ClassName="XeGlyphStorage",this.m_Items=t,this.copy=function(){var e=new XeGlyphStorage(this.m_MyParent);return e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),OsConstraintDataItem=(XeGlyphStorage.prototype=Object.create(XeCollection.prototype),XeGlyphStorage.prototype.constructor=XeCollection,function(e,t,i,r,n,o){XeCollectionItem.call(this,e);this.m_MyParent=e,this.m_ClassName="OsConstraintDataItem",this.m_ConstraintGroupId=t,this.m_ConstraintGroupNodeId=i,this.m_ConstraintType=r,this.m_SubEntPathArray=n,this.m_NodeStatus=o,this.copy=function(){var e=new OsConstraintDataItem(this.m_MyParent);return e.m_ConstraintGroupId=copyXeObjectMember(this.m_ConstraintGroupId),e.m_ConstraintGroupNodeId=copyXeObjectMember(this.m_ConstraintGroupNodeId),e.m_ConstraintType=copyXeObjectMember(this.m_ConstraintType),e.m_SubEntPathArray=copyXeObjectMember(this.m_SubEntPathArray),e.m_NodeStatus=copyXeObjectMember(this.m_NodeStatus),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),OsConstraintDataCollection=(OsConstraintDataItem.prototype=Object.create(XeCollectionItem.prototype),OsConstraintDataItem.prototype.constructor=XeCollectionItem,OsConstraintDataItem.prototype.getConstraintGroupId=function(){return this.m_ConstraintGroupId},OsConstraintDataItem.prototype.getConstraintGroupNodeId=function(){return this.m_ConstraintGroupNodeId},OsConstraintDataItem.prototype.getConstraintType=function(){return this.m_ConstraintType},OsConstraintDataItem.prototype.getSubEntPathArray=function(){return this.m_SubEntPathArray},OsConstraintDataItem.prototype.getNodeStatus=function(){return this.m_NodeStatus},function(e,t){XeCollection.call(this,e);this.m_MyParent=e,this.m_ClassName="OsConstraintDataCollection",this.m_Items=t,this.copy=function(){var e=new OsConstraintDataCollection(this.m_MyParent);return e.m_Items=copyXeObjectMember(this.m_Items),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),OsConstraintManager=(OsConstraintDataCollection.prototype=Object.create(XeCollection.prototype),OsConstraintDataCollection.prototype.constructor=XeCollection,function(e,t,i){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="OsConstraintManager",this.m_ShowCGroups=t,this.m_ConstraintData=i,this.copy=function(){var e=new OsConstraintManager(this.m_MyParent);return e.m_ShowCGroups=copyXeObjectMember(this.m_ShowCGroups),e.m_ConstraintData=copyXeObjectMember(this.m_ConstraintData),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeConstraintManager=(OsConstraintManager.prototype=Object.create(XeObject.prototype),OsConstraintManager.prototype.constructor=XeObject,OsConstraintManager.prototype.getShowCGroups=function(){return this.m_ShowCGroups},OsConstraintManager.prototype.getConstraintData=function(){return this.m_ConstraintData},function(e,t,i,r,n,o,a,s,c){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeConstraintManager",this.m_ConstraintType=t,this.m_IconUri=i,this.m_SubEntPathArray=r,this.m_Pos3d=n,this.m_ConstraintGroupId=o,this.m_ConstraintGroupNodeId=a,this.m_NodeStatuses=s,this.m_OsConstraintManager=c,this.copy=function(){var e=new XeConstraintManager(this.m_MyParent);return e.m_ConstraintType=copyXeObjectMember(this.m_ConstraintType),e.m_IconUri=copyXeObjectMember(this.m_IconUri),e.m_SubEntPathArray=copyXeObjectMember(this.m_SubEntPathArray),e.m_Pos3d=copyXeObjectMember(this.m_Pos3d),e.m_ConstraintGroupId=copyXeObjectMember(this.m_ConstraintGroupId),e.m_ConstraintGroupNodeId=copyXeObjectMember(this.m_ConstraintGroupNodeId),e.m_NodeStatuses=copyXeObjectMember(this.m_NodeStatuses),e.m_OsConstraintManager=copyXeObjectMember(this.m_OsConstraintManager),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeDocument=(XeConstraintManager.prototype=Object.create(XeObject.prototype),XeConstraintManager.prototype.constructor=XeObject,XeConstraintManager.prototype.getConstraintType=function(){return this.m_ConstraintType},XeConstraintManager.prototype.getIconUri=function(){return this.m_IconUri},XeConstraintManager.prototype.getSubEntPathArray=function(){return this.m_SubEntPathArray},XeConstraintManager.prototype.getPos3d=function(){return this.m_Pos3d},XeConstraintManager.prototype.getConstraintGroupId=function(){return this.m_ConstraintGroupId},XeConstraintManager.prototype.getConstraintGroupNodeId=function(){return this.m_ConstraintGroupNodeId},XeConstraintManager.prototype.getNodeStatuses=function(){return this.m_NodeStatuses},XeConstraintManager.prototype.getOsConstraintManager=function(){return this.m_OsConstraintManager},function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b,X){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeDocument",this.m_FxNumber=t,this.m_ViewMode=i,this.m_MobileMode=r,this.m_ModelLayoutActive=n,this.m_DRAWSYSTEMCURSOR=o,this.m_USE3DMOUSE=a,this.m_XeProfile=s,this.m_XeInputPointManager=c,this.m_XeCommandProcessor=l,this.m_XeTrackers=d,this.m_XeSelectionSets=u,this.m_XeGlyphStorage=p,this.m_XeConstraintManager=m,this.m_XeGsDevice=h,this.m_XeDatabase=g,this.m_RunLISP=y,this.m_RunCmd=f,this.m_RunCheckedCmd=_,this.m_CommandStart=w,this.m_CommandEnd=v,this.m_ExecuteImmediately=C,this.m_GLWidget=T,this.m_ClientTrackerWidget=b,this.m_ServerTrackerWidget=X,this.copy=function(){var e=new XeDocument(this.m_MyParent);return e.m_FxNumber=copyXeObjectMember(this.m_FxNumber),e.m_ViewMode=copyXeObjectMember(this.m_ViewMode),e.m_MobileMode=copyXeObjectMember(this.m_MobileMode),e.m_ModelLayoutActive=copyXeObjectMember(this.m_ModelLayoutActive),e.m_DRAWSYSTEMCURSOR=copyXeObjectMember(this.m_DRAWSYSTEMCURSOR),e.m_USE3DMOUSE=copyXeObjectMember(this.m_USE3DMOUSE),e.m_XeProfile=copyXeObjectMember(this.m_XeProfile),e.m_XeInputPointManager=copyXeObjectMember(this.m_XeInputPointManager),e.m_XeCommandProcessor=copyXeObjectMember(this.m_XeCommandProcessor),e.m_XeTrackers=copyXeObjectMember(this.m_XeTrackers),e.m_XeSelectionSets=copyXeObjectMember(this.m_XeSelectionSets),e.m_XeGlyphStorage=copyXeObjectMember(this.m_XeGlyphStorage),e.m_XeConstraintManager=copyXeObjectMember(this.m_XeConstraintManager),e.m_XeGsDevice=copyXeObjectMember(this.m_XeGsDevice),e.m_XeDatabase=copyXeObjectMember(this.m_XeDatabase),e.m_RunLISP=copyXeObjectMember(this.m_RunLISP),e.m_RunCmd=copyXeObjectMember(this.m_RunCmd),e.m_RunCheckedCmd=copyXeObjectMember(this.m_RunCheckedCmd),e.m_CommandStart=copyXeObjectMember(this.m_CommandStart),e.m_CommandEnd=copyXeObjectMember(this.m_CommandEnd),e.m_ExecuteImmediately=copyXeObjectMember(this.m_ExecuteImmediately),e.m_GLWidget=copyXeObjectMember(this.m_GLWidget),e.m_ClientTrackerWidget=copyXeObjectMember(this.m_ClientTrackerWidget),e.m_ServerTrackerWidget=copyXeObjectMember(this.m_ServerTrackerWidget),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeApplication=(XeDocument.prototype=Object.create(XeObject.prototype),XeDocument.prototype.constructor=XeObject,XeDocument.prototype.getFxNumber=function(){return this.m_FxNumber},XeDocument.prototype.getViewMode=function(){return this.m_ViewMode},XeDocument.prototype.getMobileMode=function(){return this.m_MobileMode},XeDocument.prototype.getModelLayoutActive=function(){return this.m_ModelLayoutActive},XeDocument.prototype.getDRAWSYSTEMCURSOR=function(){return this.m_DRAWSYSTEMCURSOR},XeDocument.prototype.getUSE3DMOUSE=function(){return this.m_USE3DMOUSE},XeDocument.prototype.getXeProfile=function(){return this.m_XeProfile},XeDocument.prototype.getXeInputPointManager=function(){return this.m_XeInputPointManager},XeDocument.prototype.getXeCommandProcessor=function(){return this.m_XeCommandProcessor},XeDocument.prototype.getXeTrackers=function(){return this.m_XeTrackers},XeDocument.prototype.getXeSelectionSets=function(){return this.m_XeSelectionSets},XeDocument.prototype.getXeGlyphStorage=function(){return this.m_XeGlyphStorage},XeDocument.prototype.getXeConstraintManager=function(){return this.m_XeConstraintManager},XeDocument.prototype.getXeGsDevice=function(){return this.m_XeGsDevice},XeDocument.prototype.getXeDatabase=function(){return this.m_XeDatabase},XeDocument.prototype.RunLISP=function(e){return this.CallMethod("m_RunLISP",e)},XeDocument.prototype.RunCmd=function(e){return this.CallMethod("m_RunCmd",e)},XeDocument.prototype.RunCheckedCmd=function(e){return this.CallMethod("m_RunCheckedCmd",e)},XeDocument.prototype.CommandStart=function(e){return this.CallMethod("m_CommandStart",e)},XeDocument.prototype.CommandEnd=function(e){return this.CallMethod("m_CommandEnd",e)},XeDocument.prototype.getExecuteImmediately=function(){return this.m_ExecuteImmediately},XeDocument.prototype.getGLWidget=function(){return this.m_GLWidget},XeDocument.prototype.getClientTrackerWidget=function(){return this.m_ClientTrackerWidget},XeDocument.prototype.getServerTrackerWidget=function(){return this.m_ServerTrackerWidget},function(e,t,i,r,n,o,a,s,c,l,d){XeObject.call(this,e);this.m_MyParent=e,this.m_ClassName="XeApplication",this.m_PerfId=t,this.m_UserId=i,this.m_FileId=r,this.m_FileSessionId=n,this.m_BaseUrl=o,this.m_XRay=a,this.m_PerfLog=s,this.m_JsMessageProxy=c,this.m_TestSetName=l,this.m_XeUI=d,this.copy=function(){var e=new XeApplication(this.m_MyParent);return e.m_PerfId=copyXeObjectMember(this.m_PerfId),e.m_UserId=copyXeObjectMember(this.m_UserId),e.m_FileId=copyXeObjectMember(this.m_FileId),e.m_FileSessionId=copyXeObjectMember(this.m_FileSessionId),e.m_BaseUrl=copyXeObjectMember(this.m_BaseUrl),e.m_XRay=copyXeObjectMember(this.m_XRay),e.m_PerfLog=copyXeObjectMember(this.m_PerfLog),e.m_JsMessageProxy=copyXeObjectMember(this.m_JsMessageProxy),e.m_TestSetName=copyXeObjectMember(this.m_TestSetName),e.m_XeUI=copyXeObjectMember(this.m_XeUI),this.copy_ext&&this.copy_ext(e),e},this.FinalConstruct&&this.FinalConstruct()}),XeRenderTarget=(XeApplication.prototype=Object.create(XeObject.prototype),XeApplication.prototype.constructor=XeObject,XeApplication.prototype.getPerfId=function(){return this.m_PerfId},XeApplication.prototype.getUserId=function(){return this.m_UserId},XeApplication.prototype.getFileId=function(){return this.m_FileId},XeApplication.prototype.getFileSessionId=function(){return this.m_FileSessionId},XeApplication.prototype.getBaseUrl=function(){return this.m_BaseUrl},XeApplication.prototype.getXRay=function(){return this.m_XRay},XeApplication.prototype.PerfLog=function(e){return this.CallMethod("m_PerfLog",e)},XeApplication.prototype.JsMessageProxy=function(e){return this.CallMethod("m_JsMessageProxy",e)},XeApplication.prototype.getTestSetName=function(){return this.m_TestSetName},XeApplication.prototype.getXeUI=function(){return this.m_XeUI},window.B64F64=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),i=new DataView(e),r=0;r<t.length;r++)i.setInt8(r,t.charCodeAt(r));return new Float64Array(e)},function(){var r,n,i=this,o=!1;i.isValid=function(){return o},i.check=function(e,t){return!!i.isValid()&&r===e&&n===t},i.deallocate=function(e){n=r=null,o=!1},i.init=function(e,t,i){r=t,n=i,o=!0}}),XeSelectionFunc=function(){var m=new XeSelectionUint8Buffer,d=[];this.getXeSelectionBuffer=function(){return m},this.getColors=function(e,t,i,r){for(var n,o,a=((e,t,i,r)=>{t=m.getHeight()-t;var n=new Uint32Array(i*r);if(m.isValid())for(var o=m.getBuffer(),a=4*m.getWidth(),s=4*(e+i),c=t+r,l=0,d=[0,0,0,0],u=t;u<c;u++)for(var p=4*e;p<s&&!(a*u+p>o.length);p+=4)d[0]=o[a*u+p+0],d[1]=o[a*u+p+1],d[2]=o[a*u+p+2],d[3]=o[a*u+p+3],n[l++]=d[3]<<24&4278190080|d[0]<<16&16711680|d[1]<<8&65280|255&d[2];return n})(e,t,i,r),s=[],c=0;c<a.length;c++){for(o=!1,n=0;n<s.length;n++)if(s[n]===a[c]){o=!0;break}o||0===a[c]||s.push(a[c])}var l=!1;if(s.length!==d.length)l=!0;else for(c=0;c<s.length;c++){for(o=!1,n=0;n<d.length;n++)if(d[n]===s[c]){o=!0;break}if(!o){l=!0;break}}return{ColorsChanged:l,Colors:(d=s.slice()).slice()}}},XeSelectionUint8Buffer=function(){this.isValid=function(){return i},this.invalidate=function(){i=!1},this.checkBufferSize=function(e,t){i&&r===e&&n===t||(4*(r=e)*(n=t)!==o.length&&(o=new Uint8Array(4*e*t)),i=!0)},this.getBuffer=function(){return o},this.apply=function(e){if(!i||e.length!==o.length)throw"XeSelectionUint8Buffer::apply worng buffer size";for(var t=0;t<e.length;t++)o[t]=e[t]},this.getWidth=function(){return r};var i=!(this.getHeight=function(){return n}),r=-1,n=-1,o=new Uint8Array},XeShaders=function(){this.checkSelf("vert","shader string"),this.checkSelf("frag","shader string"),this.checkSelf("getUniformLocations","method"),this.checkSelf("getAttributeLocations","method"),this.checkSelf("updateUniforms","method"),this.checkSelf("updateAttributes","method"),this.checkSelf("setupAttributes","method")},ajaxAppender=(XeShaders.prototype.container={},XeShaders.prototype.container.DrawObjectCommon_2d={},XeShaders.prototype.container.DrawObjectCommon_2d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform sampler2D uTexture;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","//------------------------------------------------------------------------","VARYING vec2  v_uv;","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","void main()","{","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    if (CHECK_BIT(flags, kUseTexture))","    {","        frag_color = TEXTURE2D( uTexture, v_uv ); ","    }","    else","    {","        frag_color = v_color;","    }","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectCommon_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectCommon_2d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform vec4  uniform_CPColor;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform sampler2D uTexture;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float order_nominator;","uniform float order_denominator;","uniform float order_base;","// ATTRIBUTES","//------------------------------------------------------------------------","ATTRIBUTE vec3 position;","ATTRIBUTE vec2 uv;","ATTRIBUTE vec4  colorPickingColor;","ATTRIBUTE vec3  vertexColor;","ATTRIBUTE float fOrderValue;","fx_ray_draw_define","#ifndef FX_CODE_RAY_DRAW",'#include "common_position.incl.glsl"','#include "common_draw_order.incl.glsl"',"#else",'#include "ray_position.incl.glsl"','#include "ray_draw_order.incl.glsl"',"#endif","//VARYING","//------------------------------------------------------------------------","VARYING vec2  v_uv;","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","//------------------------------------------------------------------------","void main()","{","    v_mPosition = calculatedStackMatrix * vec4( getPosition(), 1.0 );  ","    v_uv = vec2(0.0,0.0);","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    ","    if (CHECK_BIT(flags, kUseColorPickingColor_CP_COLOR))","    {","        v_color = vec4(colorPickingColor);","    }","    else if (CHECK_BIT(flags, kUseColorPickingColor_U_CP_COLOR))","    {","        v_color = vec4(uniform_CPColor);","    }","    else if (CHECK_BIT(flags, kUseTexture))","    {","        v_uv = uv;","    }","    else","    {","        if(CHECK_BIT(flags, kUseVertexColor))","        {","            v_color = vec4(vertexColor, alpha);","        }","        else","        {","            v_color = vec4(color, alpha);","        }","    }","    vec4 rPosition = calculatedFullStackMatrix * vec4( getPosition(), 1.0 );",`	rPosition.z = order_base - (getOrder() / order_denominator) * order_nominator;`,"    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectCommon_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectCommon_3d={},XeShaders.prototype.container.DrawObjectCommon_3d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","uniform sampler2D uTexture;","uniform float alpha;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","//------------------------------------------------------------------------","VARYING vec2  v_uv;","VARYING vec4  v_color;","fx_lighting_shademode_normal","VARYING vec4 v_mPosition;","//------------------------------------------------------------------------",'#include "light_common.incl.glsl"','#include "light_vert.incl.glsl"','#include "light_frag.incl.glsl"',"void main()","{","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    if (CHECK_BIT(flags, kUseTexture))","    {","        frag_color = TEXTURE2D( uTexture, v_uv ); ","    }","    else","    {","        frag_color = v_color;","    }","    fx_additional_code_lighting","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectCommon_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectCommon_3d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform vec4  uniform_CPColor;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform sampler2D uTexture;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","// ATTRIBUTES","//------------------------------------------------------------------------","ATTRIBUTE vec3 position;","ATTRIBUTE vec2 uv;","ATTRIBUTE vec4  colorPickingColor;","ATTRIBUTE vec3  vertexColor;","ATTRIBUTE vec3 normal;","fx_ray_draw_define","#ifndef FX_CODE_RAY_DRAW",'#include "common_position.incl.glsl"',"#else",'#include "ray_position.incl.glsl"',"#endif","//VARYING","//------------------------------------------------------------------------","VARYING vec2  v_uv;","VARYING vec4  v_color;","fx_lighting_shademode_normal","VARYING vec4 v_mPosition;","//------------------------------------------------------------------------","void main()","{","    v_mPosition = calculatedStackMatrix * vec4( getPosition(), 1.0 );  ","    v_uv = vec2(0.0,0.0);","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    ","    if (CHECK_BIT(flags, kUseColorPickingColor_CP_COLOR))","    {","        v_color = vec4(colorPickingColor);","    }","    else if (CHECK_BIT(flags, kUseColorPickingColor_U_CP_COLOR))","    {","        v_color = vec4(uniform_CPColor);","    }","    else if (CHECK_BIT(flags, kUseTexture))","    {","        v_uv = uv;","    }","    else","    {","        if(CHECK_BIT(flags, kUseVertexColor))","        {","            v_color = vec4(vertexColor, alpha);","        }","        else","        {","            v_color = vec4(color, alpha);","        }","    }","    fx_additional_code_lighting_vert","    vec4 rPosition = calculatedFullStackMatrix * vec4( getPosition(), 1.0 );","    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectCommon_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLinetype_2d={},XeShaders.prototype.container.DrawObjectLinetype_2d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float halfScaledPixelSize;","fx_code_additional_dyn_lt_uniforms","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","fx_code_additional_dyn_lt_align","int calculateLinetypeFragment()","{","    fx_code_additional_dyn_lt_clt_body","    float v = mod(patternCoord, 1.0);","    float d = halfScaledPixelSize;","    float res = 0.0;","    fx_code_additional_main_body","    int isDiscard = 0;","    if ( ( res < 0.2 ) && ( patternCoord >= 0.0 ) && ( reversePatternCoord >= 0.0)  )","        isDiscard = 1;","    return isDiscard;","}","void main()","{","    int discardFragment = calculateLinetypeFragment();","    if(discardFragment == 1)","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    frag_color = v_color;","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLinetype_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLinetype_2d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform vec4  uniform_CPColor;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float order_nominator;","uniform float order_denominator;","uniform float order_base;","uniform float halfScaledPixelSize;","fx_code_additional_dyn_lt_uniforms","// ATTRIBUTES","//------------------------------------------------------------------------","ATTRIBUTE vec3 position;","ATTRIBUTE vec4  colorPickingColor;","ATTRIBUTE vec3  vertexColor;","ATTRIBUTE float fOrderValue;","ATTRIBUTE float  fPatternCoord;","ATTRIBUTE float  fReverseCoord;",'#include "common_position.incl.glsl"','#include "common_draw_order.incl.glsl"','#include "common_lt.incl.glsl"',"//VARYING","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","//------------------------------------------------------------------------","void main()","{","    v_mPosition = calculatedStackMatrix * vec4( getPosition(), 1.0 );  ","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    v_fPatternCoord = getPatternCoord() * itemMatrixScale;","    v_fReverseCoord = getReverseCoord() * itemMatrixScale;","    ","    if (CHECK_BIT(flags, kUseColorPickingColor_CP_COLOR))","    {","        v_color = vec4(colorPickingColor);","    }","    else if (CHECK_BIT(flags, kUseColorPickingColor_U_CP_COLOR))","    {","        v_color = vec4(uniform_CPColor);","    }","    else","    {","        if(CHECK_BIT(flags, kUseVertexColor))","        {","            v_color = vec4(vertexColor, alpha);","        }","        else","        {","            v_color = vec4(color, alpha);","        }","    }","    vec4 rPosition = calculatedFullStackMatrix * vec4( getPosition(), 1.0 );",`	rPosition.z = order_base - (getOrder() / order_denominator) * order_nominator;`,"    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLinetype_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLinetype_3d={},XeShaders.prototype.container.DrawObjectLinetype_3d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform float alpha;","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float halfScaledPixelSize;","fx_code_additional_dyn_lt_uniforms","//------------------------------------------------------------------------","VARYING vec4  v_color;","fx_lighting_shademode_normal","VARYING vec4 v_mPosition;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","//------------------------------------------------------------------------","fx_code_additional_dyn_lt_align","int calculateLinetypeFragment()","{","    fx_code_additional_dyn_lt_clt_body","    float v = mod(patternCoord, 1.0);","    float d = halfScaledPixelSize;","    float res = 0.0;","    fx_code_additional_main_body","    int isDiscard = 0;","    if ( ( res < 0.2 ) && ( patternCoord >= 0.0 ) && ( reversePatternCoord >= 0.0)  )","        isDiscard = 1;","    return isDiscard;","}",'#include "light_common.incl.glsl"','#include "light_vert.incl.glsl"','#include "light_frag.incl.glsl"',"void main()","{","    int discardFragment = calculateLinetypeFragment();","    if(discardFragment == 1)","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    ","    frag_color = v_color;","    ","    fx_additional_code_lighting","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLinetype_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLinetype_3d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform vec4  uniform_CPColor;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float halfScaledPixelSize;","fx_code_additional_dyn_lt_uniforms","// ATTRIBUTES","//------------------------------------------------------------------------","ATTRIBUTE vec3 position;","ATTRIBUTE vec4  colorPickingColor;","ATTRIBUTE vec3  vertexColor;","ATTRIBUTE vec3 normal;","ATTRIBUTE float  fPatternCoord;","ATTRIBUTE float  fReverseCoord;",'#include "common_position.incl.glsl"','#include "common_lt.incl.glsl"',"//VARYING","//------------------------------------------------------------------------","VARYING vec4  v_color;","fx_lighting_shademode_normal","VARYING vec4 v_mPosition;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","//------------------------------------------------------------------------","void main()","{","    v_mPosition = calculatedStackMatrix * vec4( getPosition(), 1.0 );  ","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    v_fPatternCoord = getPatternCoord() * itemMatrixScale;","    v_fReverseCoord = getReverseCoord() * itemMatrixScale;","    ","    if (CHECK_BIT(flags, kUseColorPickingColor_CP_COLOR))","    {","        v_color = vec4(colorPickingColor);","    }","    else if (CHECK_BIT(flags, kUseColorPickingColor_U_CP_COLOR))","    {","        v_color = vec4(uniform_CPColor);","    }","    else","    {","        if(CHECK_BIT(flags, kUseVertexColor))","        {","            v_color = vec4(vertexColor, alpha);","        }","        else","        {","            v_color = vec4(color, alpha);","        }","    }","    fx_additional_code_lighting_vert","    vec4 rPosition = calculatedFullStackMatrix * vec4( getPosition(), 1.0 );","    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLinetype_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineTypeWeight_2d={},XeShaders.prototype.container.DrawObjectLineTypeWeight_2d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","fx_code_additional_dyn_lt_uniforms","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","VARYING float v_fscCoef;","fx_code_additional_dyn_lt_align","float dist( float a, float b )","{","    float ix = min(a, b);","    float ax = max(a, b);","    float d = ax - ix;","    return min( d, 1.0 - d );","}","int calculateLinetypeFragment()","{","    fx_code_additional_dyn_lt_clt_body","    float patternCoeff = v_fscCoef;","    fx_code_additional_dyn_lt_lw_semicoef_mult","    vec2 roundParam = v_roundParam;","    float v = mod(patternCoord, 1.0);","    float res = 0.0;","    fx_code_additional_main_body","    int isDiscard = 0;","    if ( ( res < 0.2 ) && ( patternCoord >= 0.0 ) && ( reversePatternCoord >= 0.0)  )","        isDiscard = 1;","    return isDiscard;","}","void main()","{","    if( dot( v_roundParam, v_roundParam ) > 1.0001 ) discard; //lw endcaps","    ","    int discardFragment = calculateLinetypeFragment();","    if(discardFragment == 1)","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    frag_color = v_color;","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineTypeWeight_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineTypeWeight_2d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float order_nominator;","uniform float order_denominator;","uniform float order_base;","//in units WCS ","uniform float lineWidth;","uniform mat4 ndcToPixelMatrix;","uniform mat4 inverseNdcToPixelMatrix;","uniform float itemMatrixScale;","// INSTANCED ATTRIBUTES","// One attribute per a line segment","//------------------------------------------------------------------------","ATTRIBUTE vec3 p0;","ATTRIBUTE vec3 p1;","ATTRIBUTE vec3  p0_vertexColor;","ATTRIBUTE vec3  p1_vertexColor;","//[p0, p1]","ATTRIBUTE vec2 fOrderValues;","ATTRIBUTE vec2 fPatternCoords;","ATTRIBUTE vec2 fReverseCoords;","//x and y comp are exactly the same","ATTRIBUTE vec2 fsemiScCoefs;","fx_ray_draw_define","#ifndef FX_CODE_RAY_DRAW",'#include "common_lw_position.incl.glsl"','#include "common_lt_lw.incl.glsl"','#include "common_lw_draw_order.incl.glsl"',"#else",'#include "ray_lw_position.incl.glsl"','#include "ray_lt_lw.incl.glsl"','#include "ray_lw_draw_order.incl.glsl"',"#endif","//VARYING","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","VARYING float v_fscCoef;","//------------------------------------------------------------------------","struct LineWeightFragment","{","    vec4 position;","    vec2 roundParam;","    vec3 vertexColor;","    float fOrderValue;","    float fPatternCoord;","    float fReverseCoord;","    float scCoef;","    vec4 originPos;","};","LineWeightFragment outVertex(bool isP0, vec4 pos, vec2 round, float scCoef)","{","    if(isP0)","        return LineWeightFragment(pos, round, p0_vertexColor, getOrders().x, getPatternCoords().x, getReverseCoords().x, scCoef, vec4(getP0(), 1.0));","    else","        return LineWeightFragment( pos, round, p1_vertexColor, getOrders().y, getPatternCoords().y, getReverseCoords().y, scCoef, vec4(getP1(), 1.0));","}","/**","We draw a line segment as a triangle_strip with 8 vertices","Inner 4 vertices (2345) are the line segment itself","Outer 4 vertices (0167) are the endcaps","---","And then 2 vertices as original begin & end of segment to draw outline","**/","LineWeightFragment calculateLineweight()","{    ","    vec4 _p0 = calculatedFullStackMatrix * vec4(getP0(), 1.0);","    vec4 _p1 = calculatedFullStackMatrix * vec4(getP1(), 1.0);","    vec2 direction = (ndcToPixelMatrix * (_p1 - _p0)).xy;","    if(length(direction) < 1e-10)","    {","        direction = vec2(1.0, 1.0);","    }","    vec2 frontDirection = normalize(direction);","    /*","    In case of PLINEGEN or any arcs we dont need to add endcaps to a segment ending","    But we need to make sure that a line has no gaps on the curvature, so we add small caps","    plineGenMultiplier is making endcaps smaller so it cover gaps on the curvature but dont embrace ","    any new artefacts","    */","    fx_code_additional_plingen_mult","    vec2 frontShift = (inverseNdcToPixelMatrix * (vec4(frontDirection , 0.0, 0.0)* lineWidth * plineGenMultiplier)).xy;","    vec2 sideShift = (inverseNdcToPixelMatrix * (vec4( -frontDirection.y, frontDirection.x, 0.0, 0.0 )* lineWidth)).xy;","    float semiScCoef = distance(ndcToPixelMatrix *_p0, ndcToPixelMatrix* _p1) / (lineWidth * 2.0);","    float scCoef = semiScCoef * getSemiScCoefs().x;"," ","    switch(gl_VertexID)","    {","        case 0: return outVertex(true, _p0 + vec4(sideShift - frontShift, 0.0, 0.0), vec2(1, 1),scCoef);","        case 1: return outVertex(true, _p0 + vec4(- sideShift - frontShift, 0.0, 0.0), vec2(1, -1),scCoef);","        case 2: return outVertex(true, _p0 + vec4(sideShift, 0.0, 0.0), vec2(0, 1),scCoef);","        case 3: return outVertex(true, _p0 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1),scCoef);","        //-----------------------------------------------------------------------------------","        case 4: return outVertex(false, _p1 + vec4(sideShift, 0.0, 0.0), vec2(0, 1),scCoef);","        case 5: return outVertex(false, _p1 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1),scCoef);","        case 6: return outVertex(false, _p1 + vec4(sideShift + frontShift, 0.0, 0.0), vec2(1, 1),scCoef);","        case 7: return outVertex(false, _p1 + vec4( - sideShift + frontShift, 0.0, 0.0), vec2(1, -1),scCoef);","        //-----------------------------------------------------------------------------------","        case 8: return outVertex(true, _p0, vec2(0, 0),scCoef);","        case 9: return outVertex(false, _p1, vec2(0, 0),scCoef);","    }","    return outVertex(true, vec4(0,0,0,0), vec2(0, 0), 0.0);","}","void main()","{","    LineWeightFragment fragment = calculateLineweight();","    vec4 position = fragment.position;","    vec3 vertexColor = fragment.vertexColor;","    float fOrderValue = fragment.fOrderValue;","    v_mPosition = calculatedStackMatrix * fragment.originPos;  ","    v_roundParam = fragment.roundParam;","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    v_fPatternCoord = fragment.fPatternCoord * itemMatrixScale;","    v_fReverseCoord = fragment.fReverseCoord * itemMatrixScale;","    v_fscCoef = fragment.scCoef / itemMatrixScale;","    if(CHECK_BIT(flags, kUseVertexColor))","    {","        v_color = vec4(vertexColor, alpha);","    }","    else","    {","        v_color = vec4(color, alpha);","    }","    vec4 rPosition = position;",`	rPosition.z = order_base - (fOrderValue / order_denominator) * order_nominator;`,"    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineTypeWeight_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineTypeWeight_3d={},XeShaders.prototype.container.DrawObjectLineTypeWeight_3d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float alpha;","fx_code_additional_dyn_lt_uniforms","//------------------------------------------------------------------------","VARYING vec4  v_color;","fx_lighting_shademode_normal","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","VARYING float v_fscCoef;","fx_code_additional_dyn_lt_align","float dist( float a, float b )","{","    float ix = min(a, b);","    float ax = max(a, b);","    float d = ax - ix;","    return min( d, 1.0 - d );","}","int calculateLinetypeFragment()","{","    fx_code_additional_dyn_lt_clt_body","    float patternCoeff = v_fscCoef;","    fx_code_additional_dyn_lt_lw_semicoef_mult","    vec2 roundParam = v_roundParam;","    float v = mod(patternCoord, 1.0);","    float res = 0.0;","    fx_code_additional_main_body","    int isDiscard = 0;","    if ( ( res < 0.2 ) && ( patternCoord >= 0.0 ) && ( reversePatternCoord >= 0.0)  )","        isDiscard = 1;","    return isDiscard;","}","void main()","{","    if( dot( v_roundParam, v_roundParam ) > 1.0001 ) discard; //lw endcaps","    ","    int discardFragment = calculateLinetypeFragment();","    if(discardFragment == 1)","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    frag_color = v_color;","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineTypeWeight_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineTypeWeight_3d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","//in units WCS ","uniform float lineWidth;","uniform mat4 ndcToPixelMatrix;","uniform mat4 inverseNdcToPixelMatrix;","uniform float itemMatrixScale;","// INSTANCED ATTRIBUTES","// One attribute per a line segment","//------------------------------------------------------------------------","ATTRIBUTE vec3 p0;","ATTRIBUTE vec3 p1;","ATTRIBUTE vec3  p0_vertexColor;","ATTRIBUTE vec3  p1_vertexColor;","ATTRIBUTE vec2 fPatternCoords;","ATTRIBUTE vec2 fReverseCoords;","//x and y comp are exactly the same","ATTRIBUTE vec2 fsemiScCoefs;","fx_ray_draw_define","#ifndef FX_CODE_RAY_DRAW",'#include "common_lw_position.incl.glsl"','#include "common_lt_lw.incl.glsl"',"#else",'#include "ray_lw_position.incl.glsl"','#include "ray_lt_lw.incl.glsl"',"#endif","//VARYING","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","VARYING float v_fPatternCoord;","VARYING float v_fReverseCoord;","VARYING float v_fscCoef;","//------------------------------------------------------------------------","struct LineWeightFragment","{","    vec4 position;","    vec2 roundParam;","    vec3 vertexColor;","    float fPatternCoord;","    float fReverseCoord;","    float scCoef;","    vec4 originPos;","};","LineWeightFragment outVertex(bool isP0, vec4 pos, vec2 round, float scCoef)","{","    if(isP0)","        return LineWeightFragment(pos, round, p0_vertexColor, getPatternCoords().x, getReverseCoords().x, scCoef, vec4(getP0(), 1.0));","    else","        return LineWeightFragment( pos, round, p1_vertexColor, getPatternCoords().y, getReverseCoords().y, scCoef, vec4(getP1(), 1.0));","}","/**","We draw a line segment as a triangle_strip with 8 vertices","Inner 4 vertices (2345) are the line segment itself","Outer 4 vertices (0167) are the endcaps","---","And then 2 vertices as original begin & end of segment to draw outline","**/","LineWeightFragment calculateLineweight()","{    ","    vec4 _p0 = calculatedFullStackMatrix * vec4(getP0(), 1.0);","    vec4 _p1 = calculatedFullStackMatrix * vec4(getP1(), 1.0);","    vec2 direction = (ndcToPixelMatrix * (_p1 - _p0)).xy;","    if(length(direction) < 1e-10)","    {","        direction = vec2(1.0, 1.0);","    }","    vec2 frontDirection = normalize(direction);","    /*","    In case of PLINEGEN or any arcs we dont need to add endcaps to a segment ending","    But we need to make sure that a line has no gaps on the curvature, so we add small caps","    plineGenMultiplier is making endcaps smaller so it cover gaps on the curvature but dont embrace ","    any new artefacts","    */","    fx_code_additional_plingen_mult","    vec2 frontShift = (inverseNdcToPixelMatrix * (vec4(frontDirection , 0.0, 0.0)* lineWidth * plineGenMultiplier)).xy;","    vec2 sideShift = (inverseNdcToPixelMatrix * (vec4( -frontDirection.y, frontDirection.x, 0.0, 0.0 )* lineWidth)).xy;","    float semiScCoef = distance(ndcToPixelMatrix *_p0, ndcToPixelMatrix* _p1) / (lineWidth * 2.0);","    float scCoef = semiScCoef * getSemiScCoefs().x;","    switch(gl_VertexID)","    {","        case 0: return outVertex(true, _p0 + vec4(sideShift - frontShift, 0.0, 0.0), vec2(1, 1),scCoef);","        case 1: return outVertex(true, _p0 + vec4(- sideShift - frontShift, 0.0, 0.0), vec2(1, -1),scCoef);","        case 2: return outVertex(true, _p0 + vec4(sideShift, 0.0, 0.0), vec2(0, 1),scCoef);","        case 3: return outVertex(true, _p0 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1),scCoef);","        //-----------------------------------------------------------------------------------","        case 4: return outVertex(false, _p1 + vec4(sideShift, 0.0, 0.0), vec2(0, 1),scCoef);","        case 5: return outVertex(false, _p1 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1),scCoef);","        case 6: return outVertex(false, _p1 + vec4(sideShift + frontShift, 0.0, 0.0), vec2(1, 1),scCoef);","        case 7: return outVertex(false, _p1 + vec4( - sideShift + frontShift, 0.0, 0.0), vec2(1, -1),scCoef);","        //-----------------------------------------------------------------------------------","        case 8: return outVertex(true, _p0, vec2(0, 0),scCoef);","        case 9: return outVertex(false, _p1, vec2(0, 0),scCoef);","    }","    return outVertex(true, vec4(0,0,0,0), vec2(0, 0), 0.0);","}","void main()","{","    LineWeightFragment fragment = calculateLineweight();","    vec4 position = fragment.position;","    vec3 vertexColor = fragment.vertexColor;","    v_mPosition = calculatedStackMatrix * fragment.originPos;  ","    v_roundParam = fragment.roundParam;","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    v_fPatternCoord = fragment.fPatternCoord * itemMatrixScale;","    v_fReverseCoord = fragment.fReverseCoord * itemMatrixScale;","    v_fscCoef = fragment.scCoef / itemMatrixScale;","    if(CHECK_BIT(flags, kUseVertexColor))","    {","        v_color = vec4(vertexColor, alpha);","    }","    else","    {","        v_color = vec4(color, alpha);","    }","    vec4 rPosition = position;","    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineTypeWeight_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineWeight_2d={},XeShaders.prototype.container.DrawObjectLineWeight_2d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","void main()","{","    if( dot( v_roundParam, v_roundParam ) > 1.0001 ) discard; //lw endcaps","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    frag_color = v_color;","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineWeight_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineWeight_2d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float order_nominator;","uniform float order_denominator;","uniform float order_base;","//in units WCS ","uniform float lineWidth;","uniform mat4 ndcToPixelMatrix;","uniform mat4 inverseNdcToPixelMatrix;","// INSTANCED ATTRIBUTES","// One attribute per a line segment","//------------------------------------------------------------------------","ATTRIBUTE vec3 p0;","ATTRIBUTE vec3 p1;","ATTRIBUTE vec3  p0_vertexColor;","ATTRIBUTE vec3  p1_vertexColor;","//[p0, p1]","ATTRIBUTE vec2 fOrderValues;","fx_ray_draw_define","#ifndef FX_CODE_RAY_DRAW",'#include "common_lw_position.incl.glsl"','#include "common_lw_draw_order.incl.glsl"',"#else",'#include "ray_lw_position.incl.glsl"','#include "ray_lw_draw_order.incl.glsl"',"#endif","//VARYING","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","//------------------------------------------------------------------------","struct LineWeightFragment","{","    vec4 position;","    vec2 roundParam;","    vec3 vertexColor;","    float fOrderValue;","    vec4 originPos;","};","LineWeightFragment outVertex(bool isP0, vec4 _pos, vec2 round)","{","    if(isP0)","        return LineWeightFragment(_pos, round, p0_vertexColor, getOrders().x, vec4(getP0(), 1.0));","    else","        return LineWeightFragment( _pos, round, p1_vertexColor, getOrders().y, vec4(getP1(), 1.0));","}","/**","We draw a line segment as a triangle_strip with 8 vertices","Inner 4 vertices (2345) are the line segment itself","Outer 4 vertices (0167) are the endcaps","---","And then 2 vertices as original begin & end of segment to draw outline","**/","LineWeightFragment calculateLineweight()","{","    vec4 _p0 = calculatedFullStackMatrix * vec4(getP0(), 1.0);","    vec4 _p1 = calculatedFullStackMatrix * vec4(getP1(), 1.0);","    vec2 direction = (ndcToPixelMatrix * (_p1 - _p0)).xy;","    if(length(direction) < 1e-10)","    {","        direction = vec2(1.0, 1.0);","    }","    vec2 frontDirection = normalize(direction);","    vec2 frontShift = (inverseNdcToPixelMatrix * (vec4(frontDirection , 0.0, 0.0)* lineWidth)).xy;","    vec2 sideShift = (inverseNdcToPixelMatrix * (vec4( -frontDirection.y, frontDirection.x, 0.0, 0.0 )* lineWidth)).xy;","    switch(gl_VertexID)","    {","        case 0: return outVertex(true, _p0 + vec4(sideShift - frontShift, 0.0, 0.0), vec2(1, 1));","        case 1: return outVertex(true, _p0 + vec4(- sideShift - frontShift, 0.0, 0.0), vec2(1, -1));","        case 2: return outVertex(true, _p0 + vec4(sideShift, 0.0, 0.0), vec2(0, 1));","        case 3: return outVertex(true, _p0 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1));","        //-----------------------------------------------------------------------------------","        case 4: return outVertex(false, _p1 + vec4(sideShift, 0.0, 0.0), vec2(0, 1));","        case 5: return outVertex(false, _p1 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1));","        case 6: return outVertex(false, _p1 + vec4(sideShift + frontShift, 0.0, 0.0), vec2(1, 1));","        case 7: return outVertex(false, _p1 + vec4( - sideShift + frontShift, 0.0, 0.0), vec2(1, -1));","        //-----------------------------------------------------------------------------------","        case 8: return outVertex(true, _p0, vec2(0, 0));","        case 9: return outVertex(false, _p1, vec2(0, 0));","    }","    return outVertex(true, vec4(0,0,0,0), vec2(0, 0));","}","void main()","{","    LineWeightFragment fragment = calculateLineweight();","    vec4 position = fragment.position;","    vec3 vertexColor = fragment.vertexColor;","    float fOrderValue = fragment.fOrderValue;","    v_mPosition = calculatedStackMatrix * fragment.originPos;  ","    v_roundParam = fragment.roundParam;","    v_color = vec4(0.0, 0.0, 0.0, 0.0);","    ","    if(CHECK_BIT(flags, kUseVertexColor))","    {","        v_color = vec4(vertexColor, alpha);","    }","    else","    {","        v_color = vec4(color, alpha);","    }","    vec4 rPosition = position;",`	rPosition.z = order_base - (fOrderValue / order_denominator) * order_nominator;`,"    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineWeight_2d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineWeight_3d={},XeShaders.prototype.container.DrawObjectLineWeight_3d.frag=["// shadertype=<glsl>","// DrawObjectCommon.frag","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_frag.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","//it contains all settings of a shader. see Flags section above","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform float alpha;","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","void main()","{","    if( dot( v_roundParam, v_roundParam ) > 1.0001 ) discard; //lw endcaps","    if (CHECK_BIT(flags, kIsFrontClipped) &&  ( dot( v_mPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (CHECK_BIT(flags, kIsBackClipped)  && ( dot( v_mPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    frag_color = v_color;","    #ifdef WEBGL2_300","        _OutputColor = frag_color;","    #else","       gl_FragColor = frag_color;","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineWeight_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineWeight_3d.vert=["// shadertype=<glsl>","// DrawObjectCommon.vert","//XE_PLACEHOLDER_SHADER",'#include "webgl1adapt_vert.incl.glsl"','#include "flags.incl.glsl"',"//UNIFORMS","//------------------------------------------------------------------------","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform vec3  color;","uniform float alpha;","uniform float pointSize;","//it contains all settings of a shader. see Flags section above","uniform int flags;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","//in units WCS ","uniform float lineWidth;","uniform mat4 ndcToPixelMatrix;","uniform mat4 inverseNdcToPixelMatrix;","// INSTANCED ATTRIBUTES","// One attribute per a line segment","//------------------------------------------------------------------------","ATTRIBUTE vec3 p0;","ATTRIBUTE vec3 p1;","ATTRIBUTE vec3  p0_vertexColor;","ATTRIBUTE vec3  p1_vertexColor;","fx_ray_draw_define","#ifndef FX_CODE_RAY_DRAW",'#include "common_lw_position.incl.glsl"',"#else",'#include "ray_lw_position.incl.glsl"',"#endif","//VARYING","//------------------------------------------------------------------------","VARYING vec4  v_color;","VARYING vec4 v_mPosition;","VARYING vec2 v_roundParam;","//------------------------------------------------------------------------","struct LineWeightFragment","{","    vec4 position;","    vec2 roundParam;","    vec3 vertexColor;","    vec4 originPos;","};","LineWeightFragment outVertex(bool isP0, vec4 pos, vec2 round)","{","    if(isP0)","        return LineWeightFragment(pos, round, p0_vertexColor, vec4(getP0(), 1.0));","    else","        return LineWeightFragment( pos, round, p1_vertexColor, vec4(getP1(), 1.0));","}","/**","We draw a line segment as a triangle_strip with 8 vertices","Inner 4 vertices (2345) are the line segment itself","Outer 4 vertices (0167) are the endcaps","---","And then 2 vertices as original begin & end of segment to draw outline","**/","LineWeightFragment calculateLineweight()","{","    vec4 _p0 = calculatedFullStackMatrix * vec4(getP0(), 1.0);","    vec4 _p1 = calculatedFullStackMatrix * vec4(getP1(), 1.0);","    vec2 direction = (ndcToPixelMatrix * (_p1 - _p0)).xy;","    if(length(direction) < 1e-10)","    {","        direction = vec2(1.0, 1.0);","    }","    vec2 frontDirection = normalize(direction);","    vec2 frontShift = (inverseNdcToPixelMatrix * (vec4(frontDirection , 0.0, 0.0)* lineWidth)).xy;","    vec2 sideShift = (inverseNdcToPixelMatrix * (vec4( -frontDirection.y, frontDirection.x, 0.0, 0.0 )* lineWidth)).xy;","    switch(gl_VertexID)","    {","        case 0: return outVertex(true, _p0 + vec4(sideShift - frontShift, 0.0, 0.0), vec2(1, 1));","        case 1: return outVertex(true, _p0 + vec4(- sideShift - frontShift, 0.0, 0.0), vec2(1, -1));","        case 2: return outVertex(true, _p0 + vec4(sideShift, 0.0, 0.0), vec2(0, 1));","        case 3: return outVertex(true, _p0 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1));","        //-----------------------------------------------------------------------------------","        case 4: return outVertex(false, _p1 + vec4(sideShift, 0.0, 0.0), vec2(0, 1));","        case 5: return outVertex(false, _p1 + vec4( - sideShift, 0.0, 0.0), vec2(0, -1));","        case 6: return outVertex(false, _p1 + vec4(sideShift + frontShift, 0.0, 0.0), vec2(1, 1));","        case 7: return outVertex(false, _p1 + vec4( - sideShift + frontShift, 0.0, 0.0), vec2(1, -1));","        //-----------------------------------------------------------------------------------","        case 8: return outVertex(true, _p0, vec2(0, 0));","        case 9: return outVertex(false, _p1, vec2(0, 0));","    }","    return outVertex(true, vec4(0,0,0,0), vec2(0, 0));","}","void main()","{","    LineWeightFragment fragment = calculateLineweight();","    vec4 position = fragment.position;","    vec3 vertexColor = fragment.vertexColor;","    v_mPosition = calculatedStackMatrix * fragment.originPos;  ","    v_roundParam = fragment.roundParam;","    v_color = vec4(0.0, 0.0, 0.0, 0.0);    ","    if(CHECK_BIT(flags, kUseVertexColor))","    {","        v_color = vec4(vertexColor, alpha);","    }","    else","    {","        v_color = vec4(color, alpha);","    }","    vec4 rPosition = position;","    gl_Position = rPosition;","    gl_PointSize = pointSize;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineWeight_3d.isPlaceholderShader=!0,XeShaders.prototype.container.DrawObjectLineWeight_instanced={},XeShaders.prototype.container.DrawObjectLineWeight_instanced.frag=["// shadertype=<glsl>","// DrawObjectLineWeight_instanced.frag","#ifndef WEBGL2_300","    #ifdef OES_standard_derivatives_supported","        #extension GL_OES_standard_derivatives : enable ","        //flat shader commented, not supported by some older systems and webgl2","    #endif","#endif","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","#ifndef iMAX_LINETYPE_ARRAY_COUNT // iMAX_LINETYPE_ARRAY_COUNT added to shader code in js code createLineWeightObjectsImpl","#define iMAX_LINETYPE_ARRAY_COUNT 24","#endif","#define fEPS 0.0000001 //","// make version 100 / 300 es support","#define VARYING varying","#define TEXTURE2D texture2D","#ifdef WEBGL2_300","    #undef VARYING","    #define VARYING in","    #undef TEXTURE2D","    #define TEXTURE2D texture  ","    #ifndef OES_standard_derivatives_supported","        #define OES_standard_derivatives_supported","    #endif","    out vec4 _OutputColor;","#endif","//UNIFORMS","//------------------------------------------------------------------------","// begin common values","//uniform   int  isPerspective;","//uniform   vec2 screenResolution;","uniform   vec3  viewDirVector;","uniform   vec3  viewUpVector;","// clip planes","uniform int isFrontClipped;","uniform int isBackClipped;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","uniform   float order_denominator;","uniform   float order_base;","uniform int uRenderMode; // flat, shaded, etc..","//uniform int useNormal;","uniform   vec3  color;","uniform   float alpha;","// Lineweight values","uniform  float lwUnits;","// Linetype values","uniform int   bEnableLinetype;","uniform int   isScaledToFit;","uniform int   plinegen;","uniform int   arcCircleType; // XeBufferedCacheEnum","uniform float patternArray[iMAX_LINETYPE_ARRAY_COUNT];","uniform int   patternArraySize;","uniform float ltRecordScale;","uniform int   bAlwaysShowLinetype;","uniform float calculatedPatternLength;","uniform float xeLTRecordPatternLength;","//------------------------------------------------------------------------","// varying","VARYING vec4   v_mvPosition;","VARYING vec4   v0;  // v_drawMode,             lwUnits ,                    f_patternCoord              , line length   ( from first point + line vector )","VARYING vec4   v1;  // actualLengthCoordinate, actualFirstLengthCoordinate, actualLastLengthCoordinate, normalCoordinate","VARYING vec4   v2;  // fullLengthCoordinate,   lengthCoordinate,            firstLengthCoordinate,      lastLengthCoordinate","struct FragValuesStruct","{","    float actualLengthCoordinate;","    float actualFirstLengthCoordinate;","    float actualLastLengthCoordinate;","    float normalCoordinate;","    float fullLengthCoordinate;","    float firstDashLength;","    float numPatts;","    float effectiveScale;","    float lengthCoordinate;","    float firstLengthCoordinate;","    float lastLengthCoordinate;","    float lwUnits;","    bool  bLinetypeApplyed;","};","FragValuesStruct _copy(const in FragValuesStruct varying_values)","{","    FragValuesStruct r = FragValuesStruct( ","        varying_values.actualLengthCoordinate, varying_values.actualFirstLengthCoordinate,","        varying_values.actualLastLengthCoordinate, varying_values.normalCoordinate,","        varying_values.fullLengthCoordinate, varying_values.firstDashLength,","        varying_values.numPatts, varying_values.effectiveScale,","        varying_values.lengthCoordinate, varying_values.firstLengthCoordinate,","        varying_values.lastLengthCoordinate, varying_values.lwUnits, varying_values.bLinetypeApplyed","    );","    return r;","}","struct CurveStruct","{","    bool  bApplyLinetype;","    bool  bIsScaledToFit;","    bool  bIsCircleArc;","    bool bIsClosedCurve;","    bool bPlinegen;","    bool bGetFullLineLength;","};","CurveStruct createCurveStruct()","{","    bool  bApplyLinetype = bEnableLinetype > 0;","    bool  bIsScaledToFit = isScaledToFit > 0;","    bool  bIsCircleArc = arcCircleType > 0; // check XeBufferedCacheEnum","    //    none: 0,","    //    arc: 1,","    //    circle : 2","    bool  bIsClosedCurve = arcCircleType == 2;","    bool  bPlinegen = plinegen > 0;","    // check","    // OdGiLinetypeApplier::enums kAlign, kIfCurveIsClosed, kScaleToFit","    //","    //   kAlign - always to polylines","    //   kScaleToFit - alway for circle and lines, check how FxGiLinetyper.h => m_polylineAlignType used","    //   kIfCurveIsClosed - for closed entities, TODO !","    if (bIsScaledToFit && !bIsCircleArc)","        bPlinegen = true;","    if (!bIsCircleArc)","        bIsScaledToFit = false;","    bool bGetFullLineLength = bPlinegen || bIsCircleArc || bIsScaledToFit;","    CurveStruct bCurveStruct = CurveStruct(","        bApplyLinetype,","        bIsScaledToFit,","        bIsCircleArc,","        bIsClosedCurve,","        bPlinegen,","        bGetFullLineLength","    );","    return bCurveStruct;","}","CurveStruct _copy(const in CurveStruct bCurveStruct)","{","    CurveStruct r = CurveStruct( ","        bCurveStruct.bApplyLinetype,","        bCurveStruct.bIsScaledToFit,","        bCurveStruct.bIsCircleArc,","        bCurveStruct.bIsClosedCurve,","        bCurveStruct.bPlinegen,","        bCurveStruct.bGetFullLineLength","    );","    return r;","}","// -------------","bool isStartPart( const in FragValuesStruct vv_struct)","{","    return (vv_struct.actualLengthCoordinate <= vv_struct.actualFirstLengthCoordinate);","}","bool isFinishPart( const in FragValuesStruct vv_struct)","{","    return (vv_struct.actualLengthCoordinate >= vv_struct.actualLastLengthCoordinate);","}","bool isPointInCircleImpl( const in float lc, const in float nc, const in float circle_center_coord, float lwUnits)","{","    float _lc = (lc - circle_center_coord);","    return (_lc * _lc + nc * nc) <= ( lwUnits * lwUnits) ;","}","bool isPointInCircle( const in FragValuesStruct vv_struc, const in float circle_center_coord)","{","    float lc = vv_struc.actualLengthCoordinate;","    float nc = vv_struc.normalCoordinate;","    return isPointInCircleImpl(lc, nc, circle_center_coord, vv_struc.lwUnits );","}","bool isInsideFirstDash(in FragValuesStruct vv_struct, const in CurveStruct bCurveStruct)","{","    bool bRet = false;","    float lc = vv_struct.actualLengthCoordinate;","    vv_struct.actualLengthCoordinate = vv_struct.lengthCoordinate;","    bRet = isPointInCircle( vv_struct, 0.0);","    vv_struct.actualLengthCoordinate = lc;","    if (!bRet){","        float firstDashLengthCoord = vv_struct.firstDashLength;","        if (vv_struct.actualFirstLengthCoordinate <= lc && lc <= firstDashLengthCoord)","            bRet = true;","        if (!bRet && lc >= firstDashLengthCoord )","        {","            bRet = isPointInCircle( vv_struct, firstDashLengthCoord);","        }","    }","    return bRet;","}","bool isInsideLastDash(in FragValuesStruct vv_struct, const in CurveStruct bCurveStruct)","{","    bool bRet = false;","    float lc = vv_struct.actualLengthCoordinate;","    float curve_length = (bCurveStruct.bGetFullLineLength) ? vv_struct.fullLengthCoordinate : vv_struct.actualLastLengthCoordinate - vv_struct.actualFirstLengthCoordinate;","    float lastDashStartLengthCoord = curve_length - vv_struct.firstDashLength;","    float lastLengthCoord = vv_struct.actualLastLengthCoordinate;","    if (!bCurveStruct.bPlinegen)","    {","        bRet = isPointInCircle( vv_struct, lastDashStartLengthCoord);","        if (!bRet && lastDashStartLengthCoord <= lc && lc <= lastLengthCoord)","            bRet = true;","        if (!bRet && lc >= lastLengthCoord && lc >= lastDashStartLengthCoord)","        {","            vv_struct.actualLengthCoordinate = vv_struct.lengthCoordinate;","            bRet = isPointInCircle( vv_struct, vv_struct.lastLengthCoordinate);","            vv_struct.actualLengthCoordinate = lc;","        }","    }","    return bRet;","}","bool isInsidePatternDash(const in FragValuesStruct varying_values, const in CurveStruct bCurveStruct ) // , out vec3 draw_color)","{","    if ( ( patternArraySize < 2) || ( patternArraySize >= iMAX_LINETYPE_ARRAY_COUNT) )","        return true;","    int numPatts = int(varying_values.numPatts);","    ","    if (numPatts == 0)","        return true;","    bool bIsScaledToFit = bCurveStruct.bIsScaledToFit;","    bool bIsCircleArc = bCurveStruct.bIsCircleArc;","    bool bIsClosedCurve = bCurveStruct.bIsClosedCurve;","    float effectiveScale = varying_values.effectiveScale;","    float lc = varying_values.actualLengthCoordinate;","    float fullLength = varying_values.fullLengthCoordinate;","    float pattLen = calculatedPatternLength * effectiveScale;","    float shift = 0.0;","    if ( !bIsClosedCurve ) // line arc","    {","        float firstLineDash = varying_values.firstDashLength;","        bool bNotADot = (firstLineDash > fEPS || firstLineDash < -fEPS);","        if (bNotADot)","            shift = firstLineDash - abs(patternArray[0]) * effectiveScale;","    }","    else  // circle, future : rect, ellipse","    {","        if (fullLength < pattLen)","            return true;","        float denom = fullLength / pattLen;","        denom = ( fract(denom) > 0.5 )? ceil(denom) : floor(denom);","        float new_patt_length = fullLength / denom;","        effectiveScale = effectiveScale * ( new_patt_length  / pattLen);","        pattLen = new_patt_length;","    }","    float patt_denom = floor( (lc - shift) / pattLen); ","    ","    if( int(patt_denom) >= ( numPatts  + (bIsClosedCurve? 1:0)) )","    {","        if (bIsClosedCurve)","            return false;","    }","    ","    float _prev_lc = lc;","    if ( patt_denom >= 1.0 )","    {","        lc = abs( pattLen * patt_denom - lc);","    }","    FragValuesStruct vv_struct = _copy( varying_values );","    vv_struct.actualLengthCoordinate = lc;","    // Do not use 'break;' in loops ! unsupported","    // get last dash","    float _last_dash = 0.0;","    for ( int i = 0; i < iMAX_LINETYPE_ARRAY_COUNT; i++) // you can't get it antother way, because => array [ const index ]","    {","        if (i == (patternArraySize - 1))","        {","            _last_dash = patternArray[i];","        }","    }","    // pattern draw","    float prev_ = shift;","    float next_ = shift;","    bool bBreak = false;","    bool bDoDraw = false;","    bool bInsideDash = false;","    float lwUnits = vv_struct.lwUnits;","    for ( int i = 0; i < iMAX_LINETYPE_ARRAY_COUNT; i++)","    {","        if ( bBreak == false && i < patternArraySize) // do not use break in loops - on some devices it does not work","        {","            bool  bIsGap = (patternArray[i] + fEPS) < 0.0;","            next_ += abs( patternArray[i] * effectiveScale );","            if (!bDoDraw)","            {","                if ( ( lc < prev_ + lwUnits ) && ( lc > prev_ - lwUnits ) )","                {","                    bDoDraw = isPointInCircle( vv_struct, prev_);","                }","                if ( !bDoDraw && ( lc < next_ + lwUnits) && ( lc > next_ - lwUnits) )","                {","                    bDoDraw = isPointInCircle( vv_struct, next_);","                }","            }","            if (!bDoDraw)","            {","                // check for dash","                if ( ( lc >= prev_ ) && ( lc <= next_ ) )","                {","                    bInsideDash = true;","                }","                else","                {","                    if (( lc > next_ ) && ((i + 1) == patternArraySize))","                    {","                        bIsGap = (patternArray[0] + fEPS) < 0.0;","                        float tmp_next = next_ + abs( patternArray[0] * effectiveScale );","                        if ( lc <= tmp_next )","                        {","                            bInsideDash = true;","                        }","                    }","                    else if ( ( lc < prev_ ) && (i == 0) )","                    {","                        bIsGap = (_last_dash + fEPS) < 0.0;","                        float tmp_prev = prev_ - abs( _last_dash * effectiveScale );","                        if ( lc >= tmp_prev )","                        {","                            bInsideDash = true;","                        }","                    }","                }","            }","            if (bInsideDash)","            {","                bDoDraw = true;","                // draw_color.x = 1.0; draw_color.y = 0.0; draw_color.z = 0.0;","                if ( bIsGap )","                {","                    bDoDraw = false;","                    // draw_color.x = 0.0; draw_color.y = 1.0; draw_color.z = 0.0;","                }","                if ( bDoDraw && bCurveStruct.bPlinegen && ( fullLength <= _prev_lc ) )","                {","                    vv_struct.actualLengthCoordinate = _prev_lc;","                    bDoDraw = isPointInCircle( vv_struct, fullLength);","                    vv_struct.actualLengthCoordinate = lc;","                }","                bBreak = true;","            }","            prev_ = next_;","        }","    }","    return bDoDraw;","}","FragValuesStruct align( const in FragValuesStruct in_varying_values, const in CurveStruct bCurveStruct)","{","    FragValuesStruct vv_struct = _copy(in_varying_values);","    bool bRetVal = false;","    vv_struct.bLinetypeApplyed = bRetVal;","    bool  bPatternApplyed = bCurveStruct.bApplyLinetype && ( patternArraySize >= 2) && ( patternArraySize < iMAX_LINETYPE_ARRAY_COUNT);","    if (!bPatternApplyed)","        return vv_struct;","    float pattLen = calculatedPatternLength;","    // #Incorrect draw of polyline with scaled linetype anf non-default patternLength","    if ( abs(calculatedPatternLength - xeLTRecordPatternLength) > fEPS && xeLTRecordPatternLength > fEPS)","    {","        pattLen = xeLTRecordPatternLength;","    }","    float m_effectiveScale = ltRecordScale; // uniform","    float curveLen = (bCurveStruct.bGetFullLineLength) ? vv_struct.fullLengthCoordinate : vv_struct.actualLastLengthCoordinate - vv_struct.actualFirstLengthCoordinate;","    float numPatts = 0.0;","    // ----------------------------------------------------------------------------","    if (bAlwaysShowLinetype > 0) // 1. for the cases when m_effectiveScale is too big and changes depending of zoom - show 1 pattern","    {","        if(bCurveStruct.bIsScaledToFit && !bCurveStruct.bIsCircleArc) // ODA code there","        {","            numPatts = curveLen / (pattLen * m_effectiveScale) + 0.5;","            if ( floor(numPatts) <= 1.0)","            {","                numPatts = 1.5;","                m_effectiveScale = curveLen / ( ( numPatts - 0.5) * pattLen );","            }","        }","        else","        {","            numPatts = curveLen / (pattLen * m_effectiveScale) + fEPS;","            float num_of_patts_limit = 1.0;","            if (bCurveStruct.bIsCircleArc)","                num_of_patts_limit = 4.0;  // XENON-21910","            if ( floor(numPatts) <= num_of_patts_limit)","            {","                if (bCurveStruct.bIsCircleArc)","                    numPatts = 4.5;  // XENON-21910","                else","                    numPatts = 1.5;","                m_effectiveScale = curveLen / ( ( numPatts - fEPS) * pattLen );","            }","        }","    }","    // -------------------------------------------------------------------------------","    pattLen = pattLen * m_effectiveScale;","    numPatts = 0.0;","    float m_dFirstLastDashLength = 0.0;","    if ( pattLen <= curveLen )","    {","        if(bCurveStruct.bIsScaledToFit && !bCurveStruct.bIsCircleArc) // ODA code there","        {","            numPatts = floor(curveLen / pattLen + 0.5);","            // if (numPatts > 10000.0)","            // {","            //    numPatts = 0.0;","            //    bRetVal = false;","            // }","            // else","            {","                if (arcCircleType != 2)","                    m_effectiveScale = m_effectiveScale * (curveLen / (pattLen * numPatts));","            ","                m_dFirstLastDashLength = 0.0; // not actual here","                bRetVal = true;","            }","        }","        else","        {","            //// 23.12.2004 GU maybe tolerance must be dependent on stroke size","            numPatts = floor(curveLen / pattLen + fEPS);","            // if (numPatts > 10000.0)","            // {","            //    numPatts = 0.0;","            //    bRetVal = false;","            // }","            // else","            {","                float firstDashLength = patternArray[0] * m_effectiveScale;","        ","                //// 20.12.2005 GU, cr3335",`                //// "|| firstDashLength < 0.0" doesn't seem to be reasonable, but ADAC does so...`,"                if(firstDashLength > 0.0) // if(firstDashLength > 0.0 || firstDashLength < 0.0)","                {","                    m_dFirstLastDashLength = (curveLen - (pattLen * numPatts - firstDashLength)) / 2.0;","                    //ODA_ASSERT_ONCE(m_dFirstLastDashLength >= 0.0);","                }","                //#Incorrect draw of line  with negative 1st dash value of linetype","                //(look axes of small circles in attachment of old bag 3335 in ADAC 2010)","                else if (firstDashLength < 0.0)","                {","                    // should be // m_dFirstLastDashLength = - (curveLen - (pattLen * numPatts + firstDashLength)) / 2.0;","                    // but looks like ADAC does the next","                    m_dFirstLastDashLength = (curveLen - (pattLen * numPatts - firstDashLength)) / 2.0;","                    if (m_dFirstLastDashLength < 0.0)","                        m_dFirstLastDashLength += firstDashLength;","                 }","                 else if ( patternArray[0] != 0.0 )// firstDashLength == 0.0","                 {","                    float secDashLength = patternArray[1] * m_effectiveScale;","                    if (secDashLength < 0.0)","                        secDashLength = -secDashLength;","                    m_dFirstLastDashLength = -(curveLen - (pattLen * numPatts - 2.0 * secDashLength)) / 2.0;","                }","                bRetVal = true;","            }","        }","    }","    if ( bCurveStruct.bIsClosedCurve)// || bCurveStruct.bIsScaledToFit )","    {","        m_dFirstLastDashLength = 0.0;","    }","    vv_struct.numPatts = floor(numPatts);","    vv_struct.effectiveScale = m_effectiveScale;","    vv_struct.firstDashLength = m_dFirstLastDashLength;","    vv_struct.bLinetypeApplyed = bRetVal;","    return vv_struct;","}","bool drawLinetype( in FragValuesStruct varying_values, const in CurveStruct bCurveStruct ) // , out vec3 draw_color)","{","    bool bDebugColors = false;","    bool bOutOfFirstDash = false;","    bool bNotInLastDash = false;","    if ( varying_values.firstDashLength > 0.0 || patternArray[0] == 0.0)","    {","        bOutOfFirstDash = !isInsideFirstDash( varying_values, bCurveStruct);","        if (bOutOfFirstDash)","        {","            bNotInLastDash = !isInsideLastDash( varying_values, bCurveStruct);","        }","     }","     else","     {","        bOutOfFirstDash = true;","        bNotInLastDash = true;","     }","     if ( (bCurveStruct.bIsClosedCurve || bCurveStruct.bIsScaledToFit) && varying_values.lengthCoordinate < 0.0)","     {","        float lc = varying_values.actualLengthCoordinate;","        varying_values.actualLengthCoordinate = varying_values.lengthCoordinate;","        bool bIsInCricle = isPointInCircle( varying_values , 0.0);","        varying_values.actualLengthCoordinate = lc;","        if (!bIsInCricle)","        {","            return false;","        }","    }","    if (bOutOfFirstDash && bNotInLastDash && varying_values.lengthCoordinate >= 0.0)","    {","        bool bIsInsidePatternDash = isInsidePatternDash( varying_values, bCurveStruct); // , draw_color);","        if( !bIsInsidePatternDash )","        {","            // draw_color.z = 1.0;","            return false;","        }","    }","    if ( !(bCurveStruct.bIsClosedCurve || bCurveStruct.bIsScaledToFit) && bOutOfFirstDash && varying_values.lengthCoordinate < 0.0)","    {","        return false;","    }","    return true;","}","bool checkPatternRoundCaps( const in FragValuesStruct varying_values, const in CurveStruct bCurveStruct)","{","    float lineLength = v0.w;","    float lc = v0.z;     // patternCoordinate","    float nc = varying_values.normalCoordinate;","    if( lc <= 0.0 ) // isStartPart","    {","        float circle_center_coord = 0.0;","        if( ! isPointInCircleImpl(lc, nc, circle_center_coord, varying_values.lwUnits ) )","        {","            return false;","        }","    }","    else if( lc >= lineLength ) // isFinishPart","    {","        float circle_center_coord = lineLength;","        if( ! isPointInCircleImpl(lc, nc, circle_center_coord, varying_values.lwUnits ) )","        {","            return false;","        }","    }","    return true;","}","bool drawContinuous( const in FragValuesStruct varying_values, const in CurveStruct bCurveStruct)","{","    if( isStartPart( varying_values) )","    {","        if( !isPointInCircle( varying_values , varying_values.actualFirstLengthCoordinate ) )","        {","            return false;","        }","    }","    else if( isFinishPart( varying_values) )","    {","        if( !isPointInCircle( varying_values , varying_values.actualLastLengthCoordinate) )","        {","            return false;","        }","    }","    return true;","}","void main()","{","    float drawMode = v0.x;","    vec3 draw_color = color;","    // check clip planes","    if (isFrontClipped > 0 &&  ( dot( v_mvPosition, frontClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    if (isBackClipped > 0 && ( dot( v_mvPosition, backClipPlane) < 0.0 ) )","    {","        discard;","        return;","    }","    //----------","    FragValuesStruct varying_values = FragValuesStruct( ","        v1.x, v1.y,","        v1.z, v1.w ,","        v2.x, 0.0,","        0.0,  0.0,","        v2.y, v2.z,","        v2.w, v0.y,","        false );","    CurveStruct bCurveStruct = createCurveStruct();","    FragValuesStruct varying_values_new = align( varying_values, bCurveStruct);","    bool bLinetypeApplyed = varying_values_new.bLinetypeApplyed;","    if (!bLinetypeApplyed)","    {","        if (!drawContinuous(varying_values_new, bCurveStruct))","        {","            discard;","            return;","        }","    }","    else","    {","        if (!drawLinetype(varying_values_new, bCurveStruct))","        {","            discard;","            return;","        }","    }","    // Check the patternline itself","    if (!checkPatternRoundCaps(varying_values_new, bCurveStruct))","    {","       discard;","       return;","    }","    #ifdef WEBGL2_300","        _OutputColor =  vec4( draw_color, alpha );","    #else","       gl_FragColor =  vec4( draw_color, alpha );","    #endif","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineWeight_instanced.isPlaceholderShader=!1,XeShaders.prototype.container.DrawObjectLineWeight_instanced.vert=["// shadertype=<glsl>","// DrawObjectLineWeight_instanced.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","#define haveNormal 1","#define generateNormal 2","#define kBoundingBox -1","#define k2DOptimized 0","#define kWireframe 1","#define kHiddenLine 2","#define kFlatShaded 3","#define kGouraudShaded 4","#define kFlatShadedWithWireframe 5","#define kGouraudShadedWithWireframe 6","#define fEPS 0.0000001 //","#ifndef iMAX_LINETYPE_ARRAY_COUNT // iMAX_LINETYPE_ARRAY_COUNT added to shader code in js code createLineWeightObjectsImpl","#define iMAX_LINETYPE_ARRAY_COUNT 24","#endif","// make version 100 / 300 es support","#define VARYING varying","#define ATTRIBUTE attribute","#ifdef WEBGL2_300","    #undef VARYING","    #define VARYING out","    #undef ATTRIBUTE","    #define ATTRIBUTE in","#endif","//UNIFORMS","//------------------------------------------------------------------------","// begin common values","//uniform   int  isPerspective;","//uniform   vec2 screenResolution;","uniform   vec3  viewDirVector;","uniform   vec3  viewUpVector;","// clip planes","uniform int isFrontClipped;","uniform int isBackClipped;","uniform vec4 frontClipPlane;","uniform vec4 backClipPlane;","uniform   mat4 calculatedStackMatrix; //  matrix stack o cpu","uniform   mat4 calculatedFullStackMatrix; //  matrix stack o cpu + projection","// end common values","// ---------","uniform   float order_nominator;","uniform   float order_denominator;","uniform   float order_base;","uniform int uRenderMode; // flat, shaded, etc..","//uniform int useNormal;","uniform   vec3  color;","uniform   float alpha;","// Lineweight values","uniform  float lwUnits;","// Linetype values","uniform int   bEnableLinetype;","uniform int   isScaledToFit;","uniform int   plinegen;","uniform int   arcCircleType; // XeBufferedCacheEnum","uniform float patternArray[iMAX_LINETYPE_ARRAY_COUNT];","uniform int   patternArraySize;","uniform float ltRecordScale;","uniform int   bAlwaysShowLinetype;","uniform float calculatedPatternLength;","uniform float xeLTRecordPatternLength;","//ATTRIBUTES","//------------------------------------------------------------------------","ATTRIBUTE float  pointIndex;","// instanced attributes","ATTRIBUTE float  firstLengthCoord;","ATTRIBUTE float  lastLengthCoord;","ATTRIBUTE float  fullLengthCoord;","ATTRIBUTE vec3   firstPoint;","ATTRIBUTE vec3   lineVector;","ATTRIBUTE float  drawMode;","ATTRIBUTE float  fOrderValueInstanced;","// varying","VARYING vec4   v_mvPosition;","VARYING vec4   v0;  // v_drawMode,             lwUnits ,                    f_patternCoord              , line length   ( from first point + line vector )","VARYING vec4   v1;  // actualLengthCoordinate, actualFirstLengthCoordinate, actualLastLengthCoordinate, normalCoordinate","VARYING vec4   v2;  // fullLengthCoordinate,   lengthCoordinate,            firstLengthCoordinate,      lastLengthCoordinate","// same function in .frag !","struct CurveStruct","{","    bool  bApplyLinetype;","    bool  bIsScaledToFit;","    bool  bIsCircleArc;","    bool bIsClosedCurve;","    bool bPlinegen;","    bool bGetFullLineLength;","};","CurveStruct createCurveStruct()","{","    bool  bApplyLinetype = bEnableLinetype > 0;","    bool  bIsScaledToFit = isScaledToFit > 0;","    bool  bIsCircleArc = arcCircleType > 0; // check XeBufferedCacheEnum","    //    none: 0,","    //    arc: 1,","    //    circle : 2","    bool  bIsClosedCurve = arcCircleType == 2;","    bool  bPlinegen = plinegen > 0;","    // check","    // OdGiLinetypeApplier::enums kAlign, kIfCurveIsClosed, kScaleToFit","    //","    //   kAlign - always to polylines","    //   kScaleToFit - alway for circle and lines, check how FxGiLinetyper.h => m_polylineAlignType used","    //   kIfCurveIsClosed - for closed entities, TODO !","    if (bIsScaledToFit && !bIsCircleArc)","        bPlinegen = true;","    if (!bIsCircleArc)","        bIsScaledToFit = false;","    bool bGetFullLineLength = bPlinegen || bIsCircleArc || bIsScaledToFit;","    CurveStruct bCurveStruct = CurveStruct(","        bApplyLinetype,","        bIsScaledToFit,","        bIsCircleArc,","        bIsClosedCurve,","        bPlinegen,","        bGetFullLineLength","    );","    return bCurveStruct;","}","void main()","{","    v_mvPosition = vec4(0.0, 0.0, 0.0, 0.0);","    v0 = vec4(0.0, 0.0, 0.0, 0.0);","    v1 = vec4(0.0, 0.0, 0.0, 0.0);","    v2 = vec4(0.0, 0.0, 0.0, 0.0);","    vec4 rPosition = vec4(1.0, 1.0, 1.0, 1.0);","    vec3 lineVectorTemp = lineVector;","    if (length(lineVector) < fEPS)","    {","        lineVectorTemp = vec3( fEPS, 0.0, 0.0 );","    }","    if (drawMode > 0.0)","    {","        float lwUnitsCalculated = lwUnits;","        float normalCoef = 0.0;","        float directionCoef = 0.0;","        int pI = int(floor(pointIndex));","        vec3 pos = vec3( 1.0, 1.0, 1.0 );","        float f_actualLengthCoord = 0.0;","        float f_firstLengthCoord = firstLengthCoord;","        float f_lastLengthCoord = lastLengthCoord;","        float f_fullLengthCoord = fullLengthCoord;","        float f_patternCoord = 0.0;","        if ( pI == 1)","        {","            f_patternCoord = -lwUnitsCalculated;","            f_actualLengthCoord = f_firstLengthCoord - lwUnitsCalculated;","            normalCoef = -1.0;","            directionCoef = -1.0;","            pos = firstPoint;","        }","        else if ( pI == 2)","        {","            f_patternCoord = -lwUnitsCalculated;","            f_actualLengthCoord = f_firstLengthCoord - lwUnitsCalculated;","            normalCoef = 1.0;","            directionCoef = -1.0;","            pos = firstPoint;","        }","        else if ( pI == 3)","        {","            f_patternCoord = lastLengthCoord - firstLengthCoord + lwUnitsCalculated;","            f_actualLengthCoord = f_lastLengthCoord + lwUnitsCalculated;","            normalCoef = 1.0;","            directionCoef = 1.0;","            pos = firstPoint + lineVectorTemp;","        }","        else if ( pI == 4)","        {","            f_patternCoord = lastLengthCoord - firstLengthCoord + lwUnitsCalculated;","            f_actualLengthCoord = f_lastLengthCoord + lwUnitsCalculated;","            normalCoef = -1.0;","            directionCoef = 1.0;","            pos = firstPoint + lineVectorTemp;","        }","        // 1. set bool flags from unifors","        CurveStruct bCurveStruct = createCurveStruct();","        // 2. Set linetype fragmet values","        float actualLengthCoordinate = f_actualLengthCoord; // lengthCoordinate + lwUnits * sign(directionCoef);","        float actualFirstLengthCoordinate = firstLengthCoord;","        float actualLastLengthCoordinate = lastLengthCoord;","        float normalCoordinate = lwUnitsCalculated * normalCoef;","        if( !bCurveStruct.bGetFullLineLength )","        {","            actualLengthCoordinate      = actualLengthCoordinate - firstLengthCoord;","            actualFirstLengthCoordinate = 0.0;","            actualLastLengthCoordinate  = lastLengthCoord - firstLengthCoord;","        }","        // 3. pack varyings","        v0.x = drawMode;                    v0.y = lwUnitsCalculated;","        v0.z = f_patternCoord;              v0.w = lastLengthCoord - firstLengthCoord;//length(lineVector);","        v1.x = actualLengthCoordinate;      v1.y = actualFirstLengthCoordinate;","        v1.z = actualLastLengthCoordinate;  v1.w = normalCoordinate;","        v2.x = fullLengthCoord;             v2.y = f_actualLengthCoord; //lengthCoordinate + lwUnits * sign(directionCoef);  ","        v2.z = firstLengthCoord;            v2.w = lastLengthCoord;","        // Set position","        vec3 lineVectorNormalized = normalize(lineVectorTemp);","        ","        // 'cross normal' in coord sys of position && linevec","        vec3 cross_normal = cross( ","            normalize( viewDirVector.xyz),","            lineVectorNormalized ","        );","        if (length(cross_normal) < fEPS)","        {","            cross_normal = viewUpVector.xyz;","            lineVectorNormalized = normalize(cross( viewDirVector, viewUpVector) );","        }","        cross_normal = normalize(cross_normal);","        if (isFrontClipped > 0 || isBackClipped > 0) // set mvPosition for clipPlanes","        {","            v_mvPosition = calculatedStackMatrix * vec4( pos, 1.0 ); ","        }","        rPosition = calculatedFullStackMatrix * vec4( pos + lwUnitsCalculated * ( normalCoef * cross_normal + directionCoef * lineVectorNormalized ), 1.0);",`		if(uRenderMode == k2DOptimized)`,`		{`,`			rPosition.z = order_base - (fOrderValueInstanced / order_denominator) * order_nominator;`,`		}`,`	}`,"    gl_Position = rPosition;","    gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.DrawObjectLineWeight_instanced.isPlaceholderShader=!1,XeShaders.prototype.container.PaperOptimized={},XeShaders.prototype.container.PaperOptimized.frag=["// shadertype=<glsl>","// PaperOptimized.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform vec3  color;","uniform float alpha;","uniform int useTexture;","uniform sampler2D uTexture;","varying vec2  v_uv;","void main()","{","    vec4 frag_color = vec4(0.0, 0.0, 0.0, 0.0);","    if (useTexture > 0)","    {","        frag_color = texture2D( uTexture, v_uv );","        frag_color.r *= color.r;","        frag_color.g *= color.g;","        frag_color.b *= color.b;","        frag_color.a *= alpha;","    }","    else ","    {","        frag_color = vec4(color,alpha);","    }","    gl_FragColor = frag_color;","}"].join("\n"),XeShaders.prototype.container.PaperOptimized.isPlaceholderShader=!1,XeShaders.prototype.container.PaperOptimized.vert=["// shadertype=<glsl>","// PaperOptimized.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform mat4 projectionMatrix;","uniform mat4 viewingMatrix;","uniform float order;","uniform vec3  color;","uniform float alpha;","attribute vec3  position;","attribute vec2  uv;","varying vec2  v_uv;","void main()","{","    v_uv = uv;","   vec4 rPosition = projectionMatrix  * viewingMatrix * vec4( position, 1.0 );","   rPosition.z = order; // https://belmonttechinc.atlassian.net/browse/BEL-134656","   gl_Position = rPosition;","   gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.PaperOptimized.isPlaceholderShader=!1,XeShaders.prototype.container.SimpleDraw={},XeShaders.prototype.container.SimpleDraw.frag=["// shadertype=<glsl>","// SimpleDraw.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","varying vec4  v_color;","void main()","{","    gl_FragColor = v_color;","}"].join("\n"),XeShaders.prototype.container.SimpleDraw.isPlaceholderShader=!1,XeShaders.prototype.container.SimpleDraw.vert=["// shadertype=<glsl>","// SimpleDraw.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","// uniforms","uniform   mat4   transformMatrix; //  matrix stack","uniform   mat4   transformMatrix2; //  matrix stack","uniform   float  order_nominator;","uniform   float  order_denominator;","uniform   float  order_base;","// attribute","attribute vec3  position;","attribute float fOrderValue;","attribute vec3  vertexColor;","// attribute mat4  transformMatrix3;","varying vec4  v_color;","void main()","{","    // calculate color","    vec4 rPosition = transformMatrix * transformMatrix2 * vec4( position, 1.0 );","    v_color = vec4(vertexColor, 1.0);","    //    v_color = vec4(127.0, 0.0, 127.0, 1.0);","    ","    rPosition.z = order_base - (fOrderValue / order_denominator) * order_nominator;","//    rPosition.z = order_base + ((order_denominator - fOrderValue) / order_denominator);","    gl_Position =  rPosition;","    gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.SimpleDraw.isPlaceholderShader=!1,XeShaders.prototype.container.SimpleFramebufferShader={},XeShaders.prototype.container.SimpleFramebufferShader.frag=["// shadertype=<glsl>","// SimpleFramebufferShader.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform sampler2D tTexture;","uniform float tWidth;","uniform float tHeight;","uniform int tEnableAA;","varying vec2 vUv;","void main()","{","    if( tEnableAA == 0 )",`	{`,`	    gl_FragColor = texture2D( tTexture, vUv );`,`	}`,`	else`,`	{`,`		gl_FragColor = texture2D( tTexture, vUv );`,`		if( gl_FragColor.r + gl_FragColor.g + gl_FragColor.b > 1.5)`,`		{`,`			gl_FragColor = 0.8* gl_FragColor;`,`			vec2 uv;`,`			uv = vUv + vec2(1,0)/tWidth + vec2(0,0)/tHeight;`,`			gl_FragColor += 0.05*texture2D( tTexture, uv );`,`			uv = vUv + vec2(2,0)/tWidth + vec2(0,0)/tHeight;`,`			gl_FragColor += 0.01*texture2D( tTexture, uv );`,`			uv = vUv + vec2(0,0)/tWidth + vec2(0,1)/tHeight;`,`			gl_FragColor += 0.05*texture2D( tTexture, uv );`,`			uv = vUv + vec2(1,0)/tWidth + vec2(0,1)/tHeight;`,`			gl_FragColor += 0.05*texture2D( tTexture, uv );`,`			uv = vUv + vec2(2,0)/tWidth + vec2(0,1)/tHeight;`,`			gl_FragColor += 0.01*texture2D( tTexture, uv );`,`			uv = vUv + vec2(0,0)/tWidth + vec2(0,2)/tHeight;`,`			gl_FragColor += 0.01*texture2D( tTexture, uv );`,`			uv = vUv + vec2(1,0)/tWidth + vec2(0,2)/tHeight;`,`			gl_FragColor += 0.01*texture2D( tTexture, uv );`,`			uv = vUv + vec2(2,0)/tWidth + vec2(0,2)/tHeight;`,`			gl_FragColor += 0.01*texture2D( tTexture, uv );`,`		}`,`	}`,"}"].join("\n"),XeShaders.prototype.container.SimpleFramebufferShader.isPlaceholderShader=!1,XeShaders.prototype.container.SimpleFramebufferShader.vert=["// shadertype=<glsl>","// SimpleFramebufferShader.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform mat4 projectionMatrix;","uniform mat4 viewingMatrix;","uniform sampler2D tTexture;","uniform float tWidth;","uniform float tHeight;","uniform int tEnableAA;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUv;","void main()","{","   vUv = uv;","   gl_Position = projectionMatrix  * viewingMatrix * vec4( position, 1.0 );","   gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.SimpleFramebufferShader.isPlaceholderShader=!1,XeShaders.prototype.container.SimpleShader={},XeShaders.prototype.container.SimpleShader.frag=["// shadertype=<glsl>","// SimpleShader.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform vec3  color;","uniform float alpha;","void main()","{","    gl_FragColor = vec4(color,alpha);","}"].join("\n"),XeShaders.prototype.container.SimpleShader.isPlaceholderShader=!1,XeShaders.prototype.container.SimpleShader.vert=["// shadertype=<glsl>","// SimpleShader.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform mat4 calculatedFullStackMatrix;","uniform vec3  color;","uniform float alpha;","attribute vec3 position;","void main()","{","   vec4 rPosition = calculatedFullStackMatrix * vec4( position, 1.0 );","   rPosition.z = 0.0;//this shader used only for stencil clipping","   gl_Position = rPosition;","   gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.SimpleShader.isPlaceholderShader=!1,XeShaders.prototype.container.SmallRectShader={},XeShaders.prototype.container.SmallRectShader.frag=["// shadertype=<glsl>","// SmallRectShader.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform vec3  color;","uniform float alpha;","void main()","{","    gl_FragColor = vec4(color,alpha);","}"].join("\n"),XeShaders.prototype.container.SmallRectShader.isPlaceholderShader=!1,XeShaders.prototype.container.SmallRectShader.vert=["// shadertype=<glsl>","// SmallRectShader.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform mat4 projectionMatrix;","uniform mat4 viewingMatrix;","uniform vec3  color;","uniform float alpha;","attribute vec3 position;","void main()","{","   vec3 p = vec3(position);","   gl_Position = projectionMatrix  * viewingMatrix * vec4( p, 1.0 );","   gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.SmallRectShader.isPlaceholderShader=!1,XeShaders.prototype.container.XeDbBackgroundImageOptimized={},XeShaders.prototype.container.XeDbBackgroundImageOptimized.frag=["// shadertype=<glsl>","// XeDbBackgroundOptimized.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform sampler2D uTexture;","varying vec2      v_uv;","void main()","{","    vec4 frag_color = texture2D( uTexture, v_uv );","    gl_FragColor = frag_color;","}"].join("\n"),XeShaders.prototype.container.XeDbBackgroundImageOptimized.isPlaceholderShader=!1,XeShaders.prototype.container.XeDbBackgroundImageOptimized.vert=["// shadertype=<glsl>","// XeDbBackgroundOptimized.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform sampler2D uTexture;","attribute vec3  position;","attribute vec2  uv;","varying vec2 v_uv;","void main()","{","    vec4 rPosition =  vec4( position, 1.0 );","    v_uv = uv;","    gl_Position = rPosition;","    gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.XeDbBackgroundImageOptimized.isPlaceholderShader=!1,XeShaders.prototype.container.XeDbBackgroundOptimized={},XeShaders.prototype.container.XeDbBackgroundOptimized.frag=["// shadertype=<glsl>","// XeDbBackgroundOptimized.frag","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","varying vec3 vcolor;","void main()","{","    gl_FragColor = vec4( vcolor, 1.0);","}"].join("\n"),XeShaders.prototype.container.XeDbBackgroundOptimized.isPlaceholderShader=!1,XeShaders.prototype.container.XeDbBackgroundOptimized.vert=["// shadertype=<glsl>","// XeDbBackgroundOptimized.vert","#ifdef USE_mediump","precision mediump float;","precision mediump int;","#else","precision highp float;","precision highp int;","#endif","uniform mat4 rotationMatrix;","attribute vec3  position;","attribute vec3  vertex_color;","varying vec3 vcolor;","void main()","{","    vec4 rPosition =  rotationMatrix * vec4( position, 1.0 );","    vcolor = vertex_color;","    gl_Position = rPosition;","    gl_PointSize = 1.0;","}"].join("\n"),XeShaders.prototype.container.XeDbBackgroundOptimized.isPlaceholderShader=!1,XeShaders.prototype.applyDefines=function(){throw"XeShaders.prototype.applyDefines must be overriden!"},XeShaders.prototype.checkSelf=function(e,t){var i,r,n=this.container;for(i in n)!n.hasOwnProperty(i)||(r=this.container[i])[e]||r.isPlaceholderShader||console.error("XeShaders.container."+i+" -> "+e+" "+t+" missing !")},XeShaders.prototype.XeIncludes={},XeShaders.prototype.XeIncludes.common_draw_order=`float getOrder()
{
    return fOrderValue;
}`,XeShaders.prototype.XeIncludes.common_lt_lw=`vec2 getPatternCoords()
{
    return fPatternCoords;
}
vec2 getReverseCoords()
{
    return fReverseCoords;
}
vec2 getSemiScCoefs()
{
    return fsemiScCoefs;
}`,XeShaders.prototype.XeIncludes.common_lt=`float getPatternCoord()
{
    return fPatternCoord;
}
float getReverseCoord()
{
    return fReverseCoord;
}`,XeShaders.prototype.XeIncludes.common_lw_draw_order=`vec2 getOrders()
{
    return fOrderValues;
}`,XeShaders.prototype.XeIncludes.common_lw_position=`vec3 getP0()
{
    return p0;
}
vec3 getP1()
{
    return p1;
}`,XeShaders.prototype.XeIncludes.common_position=`vec3 getPosition()
{
    return position;
}`,XeShaders.prototype.XeIncludes.flags=`//==============Flags=========================
//Each value means the position of a flag's bit
#define CHECK_BIT(flags, flag) ((((flags) >> (flag)) & 0x1) == 1)
#define kUseTexture 0
#define kUseColorPickingColor_CP_COLOR 2 //use CpColor
#define kUseColorPickingColor_U_CP_COLOR 3 //use Uniform CpColor
#define kUseVertexColor 4
#define kIsFrontClipped 5
#define kIsBackClipped 6
//Lighting
#define kHaveNormal 7
#define kGenerateNormal 8
//ShadeModes
#define kFlatShaded 9
#define kGouraudShaded 10
#define kFlatShadedWithWireframe 11
#define kGouraudShadedWithWireframe 12
//==============Flags=========================`,XeShaders.prototype.XeIncludes.light_common=`//==============CONSTANTS==========================
#define MAX_LIGHTS 6
#define AMBIENT 0
#define DIRECTION 1
#define DIFFUSE 2
#define SPECULAR 3
//==============CONSTANTS==========================

uniform vec4  uGlobalAmbient;
uniform vec4  uSpecularMaterial;
uniform float uShininessCoeff;
uniform int   numLights;
uniform mat4  lights[MAX_LIGHTS];

struct Light
{
    vec4 ambient, diffuse, specular;
    vec3 direction, halfDir;
};

vec4 LightIt( in vec3 aNormal, in vec4 vColor, in Light light)
{
    vec4 aColor = vColor;
    vec4 dColor = vColor;
    vec4 sColor = uSpecularMaterial;
    
    float diffuseCoeff = max( 0.0, dot( aNormal, light.direction ) );
    float specularCoeff = step( 0.0, diffuseCoeff ) * max( 0.0, dot( light.halfDir, aNormal ) );
    
    specularCoeff = pow( specularCoeff, uShininessCoeff );
    
    vec4 color =  
        (aColor * light.ambient) + 
        (dColor * light.diffuse * diffuseCoeff) + 
        (sColor * light.specular * specularCoeff);
    
    return color;
}

vec4 Base_Lighting( in vec3 frontNormal, in vec4 vColor )
{
    vec4 frontColor = vColor * uGlobalAmbient;
    
    for ( int i = 0; i < numLights; ++i )
    {
        mat4 uDirectionLight = lights[i];
    
        Light light;
        light.direction = uDirectionLight[DIRECTION].xyz;
        light.ambient = uDirectionLight[AMBIENT];
        light.diffuse = uDirectionLight[DIFFUSE];
        light.specular = uDirectionLight[SPECULAR];
    
        // from CFxGLLightShader::SetLights
        vec4 halfDir = uDirectionLight[DIRECTION];
        halfDir += vec4( 0.0, 0.0, 1.0, 0.0 );
        halfDir.w = 0.0;
        halfDir = normalize( halfDir );
        light.halfDir = halfDir.xyz;
    
        frontColor += LightIt( frontNormal, vColor, light );
    }
    
    frontColor = clamp( frontColor, vec4(0.0), vec4(1.0) );
    frontColor.a = alpha;
    
    return frontColor;  
}`,XeShaders.prototype.XeIncludes.light_frag=`#ifndef WEBGL2_300
    #ifdef OES_standard_derivatives_supported
        #extension GL_OES_standard_derivatives : enable 
        //flat shader commented, not supported by some older systems and webgl2
    #endif
#endif

vec4 FlatOrAny_Lighting(in vec4 mvPosition, in vec4 vColor)
{
#if defined(OES_standard_derivatives_supported) || defined(WEBGL2_300)
    vec3 fdx = dFdx( mvPosition.xyz );
    vec3 fdy = dFdy( mvPosition.xyz );
    vec3 faceNormal = normalize(cross( fdx, fdy ));
    return Base_Lighting(faceNormal, vColor);
#else
    return vColor;
#endif
}
`,XeShaders.prototype.XeIncludes.light_vert=`vec4 Gouraud_Lighting(in vec3 aNormal, in vec4 vColor)
{
    vec3 frontNormal = normalize( aNormal );
    return Base_Lighting(frontNormal, vColor);
}`,XeShaders.prototype.XeIncludes.ray_draw_order=`float getOrder()
{
    return fOrderValue;
}`,XeShaders.prototype.XeIncludes.ray_lt_lw=`vec2 getPatternCoords()
{//TODO
    return vec2(0.0, 0.0);
}
vec2 getReverseCoords()
{
   //TODO
    return vec2(0.0, 0.0);
}
vec2 getSemiScCoefs()
{
    //TODO
    return vec2(0.0, 0.0);
}`,XeShaders.prototype.XeIncludes.ray_lt=`float getPatternCoord()
{
    if(isStart())
        return 0.0;
    else
        return distance(getInfiniteLinePoints().start, getInfiniteLinePoints().stop);
}
float getReverseCoord()
{
     if(isStart())
        return distance(getInfiniteLinePoints().start, getInfiniteLinePoints().stop);
    else
        return 0.0;
}`,XeShaders.prototype.XeIncludes.ray_lw_draw_order=`vec2 getOrders()
{
    return vec2(fOrderValue, fOrderValue);
}`,XeShaders.prototype.XeIncludes.ray_lw_position=`//INSTANCED ATTRIBUTES (1 per segment)
ATTRIBUTE vec3 rayStartPoint;
ATTRIBUTE vec3 rayDirection;
ATTRIBUTE float rayPropertiesArray;
ATTRIBUTE float fOrderValue;

uniform mat4 inversecalculatedFullStackMatrix;

bool isStart()
{
     return gl_VertexID % 2 != 0;
}

struct ISPoints {
     vec3 start;
     vec3 stop;
};

ISPoints getInfiniteLinePoints()
{
     vec4 start = vec4(rayStartPoint, 0.0);
     vec4 stop = vec4(rayDirection, 0.0);

     vec4 farAway = inversecalculatedFullStackMatrix * vec4(20.0, 20.0, 20.0, 0.0);

     vec4 dir = normalize(stop - start);
     float dist = distance(start, farAway);

     if(rayPropertiesArray != 0.0)
          start = start - dist * dir;
     stop = stop + dist * dir;

     return ISPoints(start.xyz, stop.xyz);
}

vec3 getP0()
{
    return getInfiniteLinePoints().start;
}
vec3 getP1()
{
    return getInfiniteLinePoints().stop;
}
`,XeShaders.prototype.XeIncludes.ray_position=`ATTRIBUTE vec3 rayStartPoint;
ATTRIBUTE vec3 rayDirection;
ATTRIBUTE float rayPropertiesArray;

uniform mat4 inversecalculatedFullStackMatrix;

bool isStart()
{
     return gl_VertexID % 2 != 0;
}

struct ISPoints {
     vec3 start;
     vec3 stop;
};

ISPoints getInfiniteLinePoints()
{
     vec4 start = vec4(rayStartPoint, 0.0);
     vec4 stop = vec4(rayDirection, 0.0);

     vec4 farAway = inversecalculatedFullStackMatrix * vec4(20.0, 20.0, 20.0, 0.0);

     vec4 dir = normalize(stop - start);
     float dist = distance(start, farAway);

     if(rayPropertiesArray != 0.0)
          start = start - dist * dir;
     stop = stop + dist * dir;

     return ISPoints(start.xyz, stop.xyz);
}

vec3 getPosition()
{
   if(isStart())
   {
        return getInfiniteLinePoints().start;
   }
   if(!isStart())
   {
        return getInfiniteLinePoints().stop;
   }
}
`,XeShaders.prototype.XeIncludes.webgl1adapt_frag=`#ifdef USE_mediump
precision mediump float;
precision mediump int;
#else
precision highp float;
precision highp int;
#endif

// make version 100 / 300 es support
#define VARYING varying
#define TEXTURE2D texture2D
#ifdef WEBGL2_300
    #undef VARYING
    #define VARYING in
    #undef TEXTURE2D
    #define TEXTURE2D texture
    out vec4 _OutputColor;
#endif`,XeShaders.prototype.XeIncludes.webgl1adapt_vert=`#ifdef USE_mediump
precision mediump float;
precision mediump int;
#else
precision highp float;
precision highp int;
#endif

// make version 100 / 300 es support
#define VARYING varying
#define ATTRIBUTE attribute
#ifdef WEBGL2_300
    #undef VARYING
    #define VARYING out
    #undef ATTRIBUTE
    #define ATTRIBUTE in
#endif`,window.timerLog=log4javascript.getDefaultLogger(),new log4javascript.AjaxAppender("/log")),jsonLayout=new log4javascript.JsonLayout(!1,!1),XeTimer=(ajaxAppender.setLayout(jsonLayout),ajaxAppender.setTimerInterval(3e3),ajaxAppender.setTimed(!0),ajaxAppender.setBatchSize(10),ajaxAppender.addHeader("Content-Type","application/json"),window.timerLog.addAppender(ajaxAppender),function(e){this.message=e,this.start=new Date});XeTimer.prototype.report=function(){function e(e){return t(e.getFullYear(),4)+"-"+t(e.getMonth()+1,2)+"-"+t(e.getDate(),2)+" "+t(e.getHours(),2)+":"+t(e.getMinutes(),2)+":"+t(e.getSeconds(),2)+","+t(e.getMilliseconds(),3)}var t=function(e,t){for(var i=""+e;i.length<t;)i="0"+i;return i},i=new Date,i=this.message+" "+(i-this.start)+" "+e(this.start)+" "+e(i);window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("XETIMER_LOG")&&window.timerLog.debug(i)},XeTimer.prototype.elapsedMillis=function(){return new Date-this.start};class XeCommonData{static ActiveDoc(){return window.getXeActiveDocument()}static Database(){return this.ActiveDoc().getXeDatabase()}static XeProfile(){return this.ActiveDoc().getXeProfile()}static XeUI(){return window.getXeApplication().getXeUI()}static XeInputManager(){return this.ActiveDoc().getXeInputPointManager()}static IsInsideCommand(){return this.XeInputManager().getInsideCommand()}static HitTestInfo(){return this.XeInputManager().getHitTestInfo()}static MousePosition(){return this.HitTestInfo().GetMousePosition()}static GripManager(){return this.XeInputManager().GripManager()}static ActiveViewport(){return this.ActiveDoc().getXeGsDevice().getActiveViewport()}static Entities(){return this.Database().getXeEntities()}static FindEntityById(e){return this.Entities().getByHandle(e)}static MainSelectionSetHandles(){return this.ActiveDoc().getXeMainSelectionSet().getHandles()}static MainSelectionSetEntities(){return this.MainSelectionSetHandles().map(e=>this.FindEntityById(e))}static FindGrip(e,t){e=this.FindEntityById(e);return e&&e.GetGripDataAt(t)||null}static GetRibbonHeight(){var e=this.XeUI();return void 0===e.getRibbonHeight?0:e.getRibbonHeight()}}class XeUtility{static IsNullish(e){return null==e}static IsNotNullish(e){return null!=e}static IsNonEmptyArray(e,t=1){return Array.isArray(e)&&e.length>=t}static ValueOr(e,t){return this.IsNullish(e)?t:e}static IsEnumValue(e,t){return!(!t||t.constructor!==Object)&&Object.values(t).includes(e)}}var XeUtils=function(){var e,t,i,r,n,o=this;o.UserAgentDetector=new JavaScriptClientDetection(window),o.WEB_RENDERER_PARAMS={isWebGl:!1,isAndroid:!1,isVMWare:!1,OES_standard_derivatives:!1,isAASupported:!1,isMediump:!1,isMobile:o.UserAgentDetector.mobile},(e=document.createElement("canvas")).width=100,e.height=100,n={antialias:window.GetXeUseAntialias()},"WebGL2RenderingContext"in window&&(t=XeWebDrawerEngine.prototype.bUseWebGl2&&e.getContext("webgl2",n))&&t instanceof window.WebGL2RenderingContext&&(o.WEB_RENDERER_PARAMS.isWebGl2=!0),(t=(t=t||e.getContext("webgl",n))||e.getContext("experimental-webgl",n))?(o.WEB_RENDERER_PARAMS.isWebGl=!0,(e=t.getExtension("WEBGL_debug_renderer_info"))&&(n=t.getParameter(e.UNMASKED_VENDOR_WEBGL),o.WEB_RENDERER_PARAMS.isVMWare=-1!==n.search("VMware")),e=getAndroidVersion(),o.WEB_RENDERER_PARAMS.isAndroid=e||!1,o.WEB_RENDERER_PARAMS.OES_standard_derivatives=!!t.getExtension("OES_standard_derivatives"),n={isWebGl:!0,isMediump:!1},i=(e=t).getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),r=e.getError(),i&&r===e.NO_ERROR||(i=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),r=e.getError(),i&&r===e.NO_ERROR?n.isMediump=!0:n.isWebGl=!1),n.isWebGl&&(i=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),r=e.getError(),i&&r===e.NO_ERROR||(i=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),r=e.getError(),i&&r===e.NO_ERROR?n.isMediump=n.isMediump||!0:n.glSupported=!1)),i=n,o.WEB_RENDERER_PARAMS.isWebGl=i.isWebGl,o.WEB_RENDERER_PARAMS.isMediump=i.isMediump):o.WEB_RENDERER_PARAMS.isWebGl=!1,o.getGPU_UNMASKED_RENDERER_WEBGL=function(){let e="";var t,i=document.createElement("canvas").getContext("webgl");return e=i&&(t=i.getExtension("WEBGL_debug_renderer_info"))?i.getParameter(t.UNMASKED_RENDERER_WEBGL):e},o.BaseUrl=function(){return window.getXeApplication().getBaseUrl()},o.DisableBroswerShortCutKeys=function(e){var t;!0!==e.ctrlKey&&!0!==e.metaKey||null===e.delegateTarget||null===e.delegateTarget.activeElement||"text"===(t=e.delegateTarget.activeElement.type)||"textarea"===t||window.CFxUI.css_helper.hasStyleClass(e.delegateTarget.activeElement,"XeRichTextEdit")&&"true"===e.delegateTarget.activeElement.contentEditable||65===e.which&&e.preventDefault()},o.changePalleteTop=function(t){document.querySelectorAll(".CollapseRibbon, .ExpandRibbon, .divmoveCollapseRibbon, .divmoveExpandRibbon").forEach(function(e){t?(e.classList.remove("divmoveExpandRibbon"),e.classList.remove("divmoveCollapseRibbon"),e.classList.remove("CollapseRibbon"),e.classList.add("ExpandRibbon")):(e.classList.remove("divmoveExpandRibbon"),e.classList.remove("divmoveCollapseRibbon"),e.classList.remove("ExpandRibbon"),e.classList.add("CollapseRibbon"))})},o.ConnectInputEvents=function(e,t,i,r,n,o,a,s,c,l,d,u,p){function m(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function h(e){a&&a(e),p&&m(e)}void 0!==p&&(p=!0),e.onmousemove=function(e){t&&t(e),p&&m(e)},e.onmouseup=function(e){i&&i(e),p&&m(e)},e.onmousedown=function(e){r&&r(e),p&&m(e)},e.onclick=function(e){n&&n(e),p&&m(e)},e.ondblclick=function(e){o&&o(e),p&&m(e)},"onwheel"in document?e.onwheel=h:"onmousewheel"in document&&(e.onmousewheel=h),e.onmouseout=function(e){s&&s(e),p&&m(e)},e.onmouseover=function(e){c&&c(e),p&&m(e)},e.addEventListener("touchstart",function(e){l&&l(e),p&&m(e)}),e.addEventListener("touchmove",function(e){d&&d(e),p&&m(e)}),e.addEventListener("touchend",function(e){u&&u(e),p&&m(e)})};var a=new RegExp("^(_OSNOTE|_NOTE|_SIMPLENOTE|_-SIMPLENOTE|_EDITANNOTATION|_EDITNOTE|_OSEDITNOTE_INTERNAL|_QUICKLEADER|_OSLEADER|_OSTABLE|_TABLE|_EDITTABLE|_LEADER|_OSBALLOON|_OSFLAGNOTES|_OSEDITDC)$"),s=(o.IsNoteCommand=function(e){var t=!1;if(e&&e.getXeDatabase&&e.getXeDatabase()&&e.getXeDatabase().getCMDNAMES()){var i=e.getXeDatabase().getCMDNAMES();if(i){if(window.noteEditorHandler&&window.noteEditorHandler.isNoteEditorActive())return!0;for(var r=0;r<i.length;r++){var n=i[r];if(a.test(n)){t=!0;break}}}}return t},o.hexToRgbArray=function(e){e=e.replace("#","");e=parseInt(e,16);return[e>>16&255,e>>8&255,255&e]},o.rgbToHex=function(e,t,i){return"#"+((1<<24)+(e<<16)+(t<<8)+i).toString(16).slice(1)},o.rgbaToHex=function(e,t,i,r){return"rgba("+[e,t,i,r].join(",")+")"},o.intRGBToHex=function(e){return"#"+((1<<24)+((255&(e>>>=0))<<16)+((65280&e)>>>8<<8)+((16711680&e)>>>16)).toString(16).slice(1)},o.intRGBAToHex=function(e,t){return"rgba("+[255&(e>>>=0),(65280&e)>>>8,(16711680&e)>>>16,t].join(",")+")"},o.GetRValue=function(e){return 255&e},o.GetGValue=function(e){return 255&e>>8},o.GetBValue=function(e){return 255&e>>16},o.GetAValue=function(e){return(255&e>>24)/255},o.MFFA=function(e){return(new GeNeo.OdGeMatrix3d).fromFlatArray(e)},o.RGBtoRGBA=function(e,t,i){null==t&&"string"==typeof e&&(r=e=3==(e=e.replace(/^\s*#|\s*$/g,"")).length?e.replace(/(.)/g,"$1$1"):e,e=parseInt(r.substr(0,2),16),t=parseInt(r.substr(2,2),16),i=parseInt(r.substr(4,2),16));var r,n=(255-(r=Math.min(e,t,i)))/255;return{r:e=0|(e-r)/n,g:t=0|(t-r)/n,b:i=0|(i-r)/n,a:n=(0|1e3*n)/1e3,rgba:"rgba("+e+", "+t+", "+i+", "+n+")"}},o.SquaredDistance=function(e,t){var e=new GeNeo.OdGePoint2d(e),t=new GeNeo.OdGePoint2d(t),i=e.x-t.x,e=e.y-t.y;return i*i+e*e},{kOsModeStart:-2,kOsModeUndefined:-1,kOsModeNone:0,kOsModeFirst:1,kOsModeEnd:1,kOsModeMid:2,kOsModeCen:3,kOsModeNode:4,kOsModeQuad:5,kOsModeIntersec:6,kOsModeIns:7,kOsModePerp:8,kOsModeTan:9,kOsModeNear:10,kOsModeGeoCen:11,kOsModeApint:12,kOsModeExt:13,kOsModePar:14,kOsModeDisabled:15,kOsModeCustom:16,kOsModeLast:16});function c(e){return e===s.kOsModeUndefined?0:1<<e-1}o.HasAnyModeEnabled=function(e,t){return!(t&&e&c(s.kOsModeDisabled))&&e&~c(s.kOsModeDisabled)},o.getXeCommonKeyboardString=function(e){e=e.keyCode;return l.fromKeyCode(e)};var l=new function(){this.fromKeyCode=function(e){var t="";return t=i.hasOwnProperty(e)?i[e]:t};var i={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"LeftWindowKey",92:"RightWindowKey",93:"SelectKey",96:"Num0",97:"Num1",98:"Num2",99:"Num3",100:"Num4",101:"Num5",102:"Num6",103:"Num7",104:"Num8",105:"Num9",106:"Multiply",107:"Add",109:"Subtract",110:"DecimalPoint",111:"Divide",187:"EqualSign",188:"Comma",189:"Dash",190:"Period",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"NumLock",145:"ScrollLock",186:",",191:"/",192:"`",219:"{",220:"\\",221:"}",222:"'"}}};class XeBitSet{constructor(){this.bitSet=new Uint32Array(1),this.bitSet[0]=0}setBitValue(e,t){this.bitSet[0]=this.bitSet[0]&~(1<<e)|t<<e}setBit(e){this.setBitValue(e,1)}clearBit(e){this.setBitValue(e,0)}getNumber(){return this.bitSet[0]}}Mouse3dConnexionProxy.prototype.get3dMouseSettingsName=function(){return"Onshape Drawings"},XeHitTestInfo.prototype.procWheelDelta=function(e){var t,i={wheelDelta:0,wheelDeltaX:0,wheelDeltaY:0,axis:0,detail:0};for(t in-1<navigator.userAgent.toLowerCase().indexOf("firefox")?(r=(r=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./))?parseInt(r[1]):0,2===e.axis&&e.detail?(i.detail=e.detail,i.axis=e.axis):e.deltaY&&(i.wheelDelta=-e.deltaY*(r=r<88?30:1.5),i.wheelDeltaX=-e.deltaX*r,i.wheelDeltaY=-e.deltaY*r)):e.wheelDelta?(i.wheelDelta=e.wheelDelta,i.wheelDeltaX=e.wheelDeltaX,i.wheelDeltaY=e.wheelDeltaY):e.deltaY&&(i.wheelDelta=1.2*-e.deltaY,i.wheelDeltaX=1.2*-e.deltaX,i.wheelDeltaY=1.2*-e.deltaY),i)i.hasOwnProperty(t)&&(i[t]=isNaN(i[t])?0:i[t]);var r={utilities:{isPlatformWindows:function(){return-1<navigator.platform.toLowerCase().indexOf("win")}}},e=0,n=.5;if("mousewheel"==={type:"mousewheel"}.type){if(0===i.wheelDelta||i.wheelDeltaX&&Math.abs(i.wheelDeltaX)>Math.abs(i.wheelDeltaY))return 0;n/=120,r.utilities.isPlatformWindows()&&(n*=3),e=n*i.wheelDelta}else{if(0===i.detail||1===i.axis)return 0;e=-n*i.detail}return e},InputPointManager.prototype.IgnoreMouseDownOnDoubleClick=!0,InputPointManager.prototype.calculateZoomFactor=function(e,t){return Math.pow(2,t/6)},InputPointManager.prototype.getDynamicZoomFactor=function(){return 1===this.getXeDocument().getXeDatabase().getZOOMWHEEL()?-70:70},InputPointManager.prototype.forceGDIRedraw=function(e){e=e.getXeGsDevice();if(!(e.getPan()||e.getOrbit()||e.getZoom())){var t=e.getChunks(),i=!1;if(t)for(var r of t.getChunkIdList()){r=t.getById(r);if(r&&r.isTracker()){i=!0;break}}i?(e.invalidateClientTrackers(),e.invalidateClientTrackersGL()):this.drawTrackers()}},InputPointManager.prototype.CheckForScrollWheelZoomByOS2DMapping=function(e,t){if(!t)return!1;for(var i,r=!1,n=0,o=0,n=0;n<t.length;n++){for(i=(t[n].keys.length>t[n].mouseButtons.length?t[n].keys:t[n].mouseButtons).length,o=0;o<i;o++){var a=null;if(r="SCROLLWHEEL"===(a=o<t[n].mouseButtons.length?t[n].mouseButtons[o]:a)&&e.IsMouseWheel())break}if(r)break}return r},InputPointManager.prototype.CheckForPanOrDynamicZoomByOS2DMapping=function(e,t){if(!t)return!1;for(var i,r,n,o=!1,a=0,s=0,c="NONE",l=(e.IsShiftPressed()?c="SHIFT":e.IsCtrlPressed()?c="CTRL":e.IsAltPressed()&&(c="ALT"),"NONE"),d=(e.IsLeftMouseButtonPressed()?l="LMB":e.IsMiddleMouseButtonPressed()?l="MMB":e.IsRightMouseButtonPressed()&&(l="RMB"),c+"+"+l),a=0;a<t.length;a++){for(i=(t[a].keys.length>t[a].mouseButtons.length?t[a].keys:t[a].mouseButtons).length,s=0;s<i&&(n=r="NONE",!(o=(r=s<t[a].keys.length?t[a].keys[s].toUpperCase():r)+"+"+(n=s<t[a].mouseButtons.length?t[a].mouseButtons[s].toUpperCase():n)==d));s++);if(o)break}return o},InputPointManager.prototype.m_RightButtonDownPosition={x:0,y:0},InputPointManager.prototype.mouseInputProc=function(e,t){if(t.IsMouseEvent()){var i=this.getXeDocument(),r=i.getXeDatabase().getXeEntities(),n=i.getXeInputPointManager().GetApertureSelection(),o=window.getXeApplication().getXeUI(),a=window.OsUserSettings,s=(s=a.pan2DMapping)||[{keys:[],mouseButtons:["RMB"]},{keys:[],mouseButtons:["MMB"]},{keys:["CTRL"],mouseButtons:["RMB"]}],a=(a=a.zoom2DMapping)||[{keys:[],mouseButtons:["SCROLLWHEEL"]}],c=!1,l=!1;if(t.IsMouseWheel()){if(!e.CheckForScrollWheelZoomByOS2DMapping(t,a))return;e.doZoom(e,t.GetWheelOrientation()*t.GetWheelDelta(),!1)}else t.IsMiddleButtonDoubleClick()?i.RunCmd("'._ZOOM_F\n"):t.IsMouseMoved()?(c=e.CheckForPanOrDynamicZoomByOS2DMapping(t,s),l=e.CheckForPanOrDynamicZoomByOS2DMapping(t,a)):t.IsMiddleButtonDown()?t.IsShiftPressed()&t.IsCtrlPressed()?o.ProcessMouseClick(3,e.CFxUI_ButtonType_Enum.eCtrlShiftClick):t.IsShiftPressed()?o.ProcessMouseClick(3,e.CFxUI_ButtonType_Enum.eShiftClick):t.IsCtrlPressed()?o.ProcessMouseClick(3,e.CFxUI_ButtonType_Enum.eCtrlClick):0:t.IsRightButtonDown()?(e.m_bIgnoreRightButtonUp=!1,e.m_RightButtonDownPosition.x=t.GetMousePosition().x,e.m_RightButtonDownPosition.y=t.GetMousePosition().y,t.IsShiftPressed()&t.IsCtrlPressed()?(e.m_bIgnoreRightButtonUp=!0,o.ProcessMouseClick(2,e.CFxUI_ButtonType_Enum.eCtrlShiftClick)):t.IsShiftPressed()?(e.m_bIgnoreRightButtonUp=!0,o.ProcessMouseClick(2,e.CFxUI_ButtonType_Enum.eShiftClick)):t.IsCtrlPressed()&&(e.m_bIgnoreRightButtonUp=!0,o.ProcessMouseClick(2,e.CFxUI_ButtonType_Enum.eCtrlClick)),e.m_bIgnoreRightButtonUp||(e.m_bIgnoreRightButtonUpTimeout&&clearTimeout(e.m_bIgnoreRightButtonUpTimeout),e.m_bIgnoreRightButtonUpTimeout=setTimeout(function(){e.m_bIgnoreRightButtonUp=!0,e.m_bIgnoreRightButtonUpTimeout=0},325))):t.IsRightButtonUp()&&!e.m_bIgnoreRightButtonUp&&Math.abs(e.m_RightButtonDownPosition.x-t.GetMousePosition().x)<5&&Math.abs(e.m_RightButtonDownPosition.y-t.GetMousePosition().y)<5&&(s=!1,n.length&&(o=(a=r.getByHandle(n[0])).getLayerObject(),a)&&"AcDbTable"===a.getClass()&&(o.getOff()||o.getLocked()||o.getFrozen()?0:(r=window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker"),XeInputPointManager.prototype.getIsTableEditorCommandManagment()&&!window.noteActive&&r&&r.tableHandler&&r.rangeState&&(i.getViewMode()||i.RunCmd("^C^C_OSTABLE_ACTION _SHOW_CONTEXT_MENU "+r.tableHandler+" "+r.rangeState.minRow+" "+r.rangeState.minColumn+" "+r.rangeState.maxRow+" "+r.rangeState.maxColumn+" "+t.GetMousePosition().x+","+t.GetMousePosition().y+",0.0\n"),s=!0))),s||window.getXeApplication().getXeUI().ShowRmbGAMenu({x:Math.floor(t.GetMousePosition().x),y:Math.floor(t.GetMousePosition().y)}));n=i.getXeGsDevice();l?(n.setPan(!1),n.setDynamicZoom(!0),e.doDynamicZoom(e,t)):c?(n.setDynamicZoom(!1),n.setPan(!0)):(n.setDynamicZoom(!1),n.setPan(!1))}},InputPointManager.prototype.doDynamicZoom=function(e,t){var i=e.getXeDocument().getXeGsDevice().getPixelHeight();return 0<i&&(this.doZoom(e,this.getDynamicZoomFactor()*(this.getMouseDownDCPoint().y-t.GetMousePosition().y)/i,!0),this.setMouseDownDCPoint(t.GetMousePosition().x,t.GetMousePosition().y),!0)},InputPointManager.prototype.checkForZoomConstraint=function(){var e=this.getXeDocument(),t=e.getXeGsDevice(),e=e.getXeDatabase().getXeLayout(),i=t.getOverallViewport(),r=t.getZoomPanViewport();return!!r&&(i?!!(i=e.getPaper())&&(i=(e=i.getPoints())[2][0]-e[0][0],e=t.getPixelWidth(),.035<(t=i*r.projectionMatrix().get(0,0)*e)/e)&&1e-4<e/t:(i=r.getFieldWidth(),e=r.getFieldHeight(),i<1e8&&e<1e8&&1e-6<i&&1e-6<e))},InputPointManager.prototype.onKeyDownHandler=function(e,t){var i,r,n,o,a;return window.getXeApplication().getXeUI().HideTooltip(),!!this.onKeyDownHandlerBase(e,t)||(i=e.getXeShiftPanAnimationHelper(),!(!e||!i)&&(r=!1,n=t.keyCode||t.charCode,o=noteEditorHandler&&noteEditorHandler.isNoteEditorActive(),a=window.getXeApplication().getXeUI().FocusInGraphicsArea(),e.getXeDocument().getXeInputPointManager().getInsideCommand(),e=window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker"),o||!a||e||(!0===t.shiftKey&&(37===n?(i.doLeft(),r=!0):38===n?(i.doUp(),r=!0):39===n?(i.doRight(),r=!0):40===n&&(i.doDown(),r=!0)),r&&t.stopPropagation()),!window.getXeApplication().GetCapability("drawings_custom_shortcut_keys")&&window.osc&&t.ctrlKey&&"KeyU"===t.code&&window.osc._usrsnp(),r))},InputPointManager.prototype.connectWPopupMenuEvents=function(){},XeDrawDecoration.prototype.TYPE_ENUM={NoDecoration:0,Highlight:1,SelectionSet:2,Dangling:3,Transform:4,GroupSet:5,SpecialSelectionSet:6},XeWebDrawerEngine.prototype.DrawObject_SimpleDraw=!1,XeEntityPreview.prototype.on_draw_gl_callback=function(e,t,i,r,n,o,a,s,c,l){var d;if(e.getSelectionIgnore())return d=e.getLayerObject(),{in_XeGsViewport:t,in_XeGsOffsets_OR_NULL:i,in_ColorArray_OR_NULL:XeGiSubEntityTraitsData.prototype.resolveColor(e,d,l),in_Alpha_OR_NULL:1,in_LwPx_OR_NULL:0,in_bAddLw:a,in_XeColorPickerParams_OR_Undef:s,in_XeChunkPassOptions_OR_Undef:c,in_XeGiSubEntityTraitsData_OR_Undef:l}},XeEntityPreview.prototype.drawXeDrawPreviewObjectCollectionGl=function(t,i,e){if(i){i.getXeGsDevice().getXeGsViewports();for(var r=this.getXeDrawDecoration(),n=r.TYPE_ENUM,o=r.getType(),a=e.Size(),s=0;s<a;s++){var c=e.Get(s),l=c.getStoredChunk();if(l){var d=c.getOffsetData();if(0!==d.s){var u,p,m=r.getLWThick(),h=!1;null!==r.getColor()?u=r.getColor():h=!0,p=null!==r.getAlpha()?r.getAlpha():1,l.getSelectionFlags();XeGiSubEntityTraitsData.prototype.SelectionFlags.kHighlightingGeometry,XeGiSubEntityTraitsData.prototype.SelectionFlags.kHiddenInHighlight,XeGiSubEntityTraitsData.prototype.SelectionFlags.kFxDrawWhenSelected,XeGiSubEntityTraitsData.prototype.SelectionFlags.kFxSkipDrawWhenSelected;let e=1;var g,y,f,_=!1,w=new XeChunkPassOptions;o===n.Highlight?(_=!l.getSelectionGeom()&&!l.getHighlightIgnore(),w.setIfNotPassArray(["getSelectionGeom","getHighlightIgnore"]),e=10):o===n.SelectionSet?((_=!l.getSelectionGeom()&&!l.getSkipDrawOnSelection())&&l.getLayerObject()&&"HIDDEN_BASE_VIEW"===l.getLayerObject().getName()&&(g=c.getXeEntity())&&(_="OnshapeViewObject"!==g.getClass()),w.setIfNotPassArray(["getSelectionGeom","getSkipDrawOnSelection"]),e=.5):o===n.SpecialSelectionSet?(_=!l.getSelectionGeom()&&!l.getSkipDrawOnSelection(),g=c.getXeEntity(),_&&l.getLayerObject()&&"HIDDEN_BASE_VIEW"===l.getLayerObject().getName()&&g&&(_="OnshapeViewObject"!==g.getClass()),!(y=c.getXeEntity())||"OnshapeViewObject"!==y.getClass()||"Detail"!==(y=y.getViewType())&&"Section"!==y&&"Jogged"!==y&&"Auxiliary"!==y||v(l)&&(_=!1),w.setIfNotPassArray(["getSelectionGeom","getSkipDrawOnSelection"]),e=.5):o===n.GroupSet?(_=!l.getSelectionGeom()&&!l.getSkipDrawOnSelection(),y=c.getXeEntity(),_&&l.getLayerObject()&&"HIDDEN_BASE_VIEW"===l.getLayerObject().getName()&&y&&(_="OnshapeViewObject"!==y.getClass()),y&&"OnshapeViewObject"===y.getClass()&&v(l)&&(_=!1),w.setIfNotPassArray(["getSelectionGeom","getSkipDrawOnSelection"]),e=.5):o===n.Dangling?(e=.1,_=!l.getSelectionGeom()&&!l.getHighlightGeom()&&!l.getDrawOnSelection(),w.setIfNotPassArray(["getSelectionGeom","getHighlightGeom","getDrawOnSelection"])):o===n.Transform?((_=!l.getSelectionGeom())&&l.getLayerObject()&&"HIDDEN_BASE_VIEW"===l.getLayerObject().getName()&&(c=c.getXeEntity())&&(_="OnshapeViewObject"!==c.getClass()),w.setIfNotPassArray(["getSelectionGeom"])):(_=!l.getSelectionGeom()&&!l.getHighlightGeom()&&!l.getDrawOnSelection(),w.setIfNotPassArray(["getSelectionGeom","getHighlightGeom","getDrawOnSelection"])),h&&(_=!l.getSelectionGeom()&&!l.getHighlightGeom()&&!l.getDrawOnSelection(),w.setIfNotPassArray(["getSelectionGeom","getHighlightGeom","getDrawOnSelection"])),_&&(o!==n.Dangling&&(f=XeEntityPreview.prototype.on_draw_gl_callback),c={order_base:e,transform_base:this.getTransform(),xeGsOffsets:[d],colorArray:u,alpha:p,lwPx:m,bAddLw:!0,bDrawOutline:!0},l.drawChunk(t,XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,i,w,void 0,f,c))}}}}function v(e){return"Visible"===e.m_LayerObject.m_Name||"DETAIL_VIEW_BORDER"===e.m_LayerObject.m_Name||"VIEW_HATCHES"===e.m_LayerObject.m_Name||"SURFACE_THREAD_SYMBOLS_ON_AXIS"===e.m_LayerObject.m_Name||"SURFACE_THREAD_SYMBOLS_HIDDEN"===e.m_LayerObject.m_Name||"Hidden"===e.m_LayerObject.m_Name||"TANGENT_HIDDEN"===e.m_LayerObject.m_Name||"BLIND_THREAD_SYMBOLS"===e.m_LayerObject.m_Name||"BLIND_THREAD_SYMBOLS_HIDDEN"===e.m_LayerObject.m_Name||"SIDE_THREAD_SYMBOLS"===e.m_LayerObject.m_Name||"SIDE_THREAD_SYMBOLS_HIDDEN"===e.m_LayerObject.m_Name||"SURFACE_THREAD_SYMBOLS"===e.m_LayerObject.m_Name||"EXPLODE_LINES"===e.m_LayerObject.m_Name||"ModelSketch_Visible"===e.m_LayerObject.m_Name||"ModelSketch_Point"===e.m_LayerObject.m_Name||"ModelSketch_Construction"===e.m_LayerObject.m_Name||"TANGENT_LINES"===e.m_LayerObject.m_Name||"SHEETMETAL_BEND_LINES_UP"===e.m_LayerObject.m_Name||"SHEETMETAL_BEND_LINES_DOWN"===e.m_LayerObject.m_Name||"SHEETMETAL_BEND_TANGENT_LINES"===e.m_LayerObject.m_Name||"SECTION_JOG_LINES"===e.m_LayerObject.m_Name||"CENTERLINES"===e.m_LayerObject.m_Name}},XeLineweightUtils.prototype.useModelSpaceLwAlways=function(){return!0},XeLineweightUtils.prototype.isLineWeightTooSmall=function(e,t){t=null==t?0:t;if(0<t){var i=e.getXeGsDevice(),r=i.getXeDocument().getXeDatabase().getXeLayout(),n=e.getOverall()?e:i.getOverallViewport(),o=null;if(n){r=r.getPaper();if(r){r=r.getPoints(),r=r[2][0]-r[0][0],i=i.getPixelWidth(),r=r*n.projectionMatrix().get(0,0)*i;if((o=window.XeLineweightUtils.GetLineWeightInPixels(e,t))<2.5&&r/i<.78)return!0}}if(1<(o=null===o?window.XeLineweightUtils.GetLineWeightInPixels(e,t):o).toFixed(1))return!1}return!0},XeLineweightUtils.prototype.getStndLineWeightPxSize=function(e,t){return 0===e||5===e||9===e||13===e||15===e||18===e||20===e||25===e||30===e?1:35===e||40===e||50===e||53===e?2:60===e||70===e?3:80===e||90===e?4:100===e||106===e?5:120===e?6:140===e?7:158===e?8:200===e?10:211===e?11:-1};class XeLightingModule{static getMaxLights(){return 6}static getNormalsModes=()=>({kNoNormal:0,kHaveNormal:1,kGenerateNormal:2});static getShadeModes=()=>({k2DOptimized:0,kWireframe:1,kHiddenLine:2,kFlatShaded:3,kGouraudShaded:4,kFlatShadedWithWireframe:5,kGouraudShadedWithWireframe:6});static getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6,kHaveNormal:7,kGenerateNormal:8,kFlatShaded:9,kGouraudShaded:10,kFlatShadedWithWireframe:11,kGouraudShadedWithWireframe:12});static updateUniforms(e,t,i,r,n,o){switch(r.uRenderMode){case this.getShadeModes().kFlatShaded:n.setBit(this.getFlagsPos().kFlatShaded);break;case this.getShadeModes().kFlatShadedWithWireframe:n.setBit(this.getFlagsPos().kFlatShadedWithWireframe);break;case this.getShadeModes().kGouraudShaded:n.setBit(this.getFlagsPos().kGouraudShaded);break;case this.getShadeModes().kGouraudShadedWithWireframe:n.setBit(this.getFlagsPos().kGouraudShadedWithWireframe)}return r.useNormal===this.getNormalsModes().kHaveNormal&&n.setBit(this.getFlagsPos().kHaveNormal),r.useNormal===this.getNormalsModes().kGenerateNormal&&n.setBit(this.getFlagsPos().kGenerateNormal),o||(o=(r=XeGlGlobalUniformData.prototype.getLights(i)).array.length/16,t.numLights&&(e.uniform1i(t.numLights,o),i=new Float32Array(16*this.getMaxLights()),0<o&&i.set(r.array),e.uniformMatrix4fv(t.lights,!1,i),e.uniform4fv(t.uGlobalAmbient,r.uGlobalAmbient),e.uniform4fv(t.uSpecularMaterial,r.uSpecularMaterial),e.uniform1f(t.uShininessCoeff,r.uShininessCoeff))),!0}}class XeLineWeightModule{static getHalfLwPixelWidth(t,i,r){if(!t)return.5;if(!i)return.5;var n=i.getXeGsDevice(),e=n.getXeDocument().getXeDatabase();if(!e.getLWDISPLAY())return.51;i=XeGiSubEntityTraitsData.prototype.resolveLineweight(i,i.getLayerObject(),r);let o=1;if(t.getXeGsDevice().getOverallViewport()){r=n.getUnitsPerMM();let e=t.getCustomScale();n=t.getPixelSize();t.m_Overall&&(e=1),o=i/100*r/e/n}else-1==(o=window.XeLineweightUtils.getStndLineWeightPxSize(i)*e.getLWDISPSCALE())&&(o=1);let a=o/2;return a=a<.5?.51:a}static updateUniforms(e,t,i,r,n,o,a,s){let c=this.getHalfLwPixelWidth(r,n,o);0<s.lwPx&&(c+=s.lwPx),e.uniform1f(t.lineWidth,c);n=r.NDCToPixelsMatrix(),o=n.inverse();e.uniformMatrix4fv(t.ndcToPixelMatrix,!1,n.toGLArray()),e.uniformMatrix4fv(t.inverseNdcToPixelMatrix,!1,o.toGLArray())}static updateAttributes(e,t){window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.p0),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.p1),t.p0_vertexColor&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.p0_vertexColor),t.p1_vertexColor&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.p1_vertexColor)}static setupAttributes(e,t,i,r){void 0!==t.instanceOffset&&null!=t.instanceOffset&&(-1!=r.p0&&(t.attributes.p0?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.p0.buffer),i.enableDivisor(r.p0,1),e.vertexAttribPointer(r.p0,3,e.FLOAT,!1,0,3*t.instanceOffset*4)):e.vertexAttrib3fv(r.p0,new Float32Array(36))),-1!=r.p1&&(t.attributes.p1?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.p1.buffer),i.enableDivisor(r.p1,1),e.vertexAttribPointer(r.p1,3,e.FLOAT,!1,0,3*t.instanceOffset*4)):e.vertexAttrib3fv(r.p1,new Float32Array(36))),t.attributes.p0_vertexColor?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.p0_vertexColor.buffer),i.enableDivisor(r.p0_vertexColor,1),e.vertexAttribPointer(r.p0_vertexColor,3,e.FLOAT,!1,0,3*t.instanceOffset*4)):e.vertexAttrib3fv(r.p0_vertexColor,new Float32Array(36)),t.attributes.p1_vertexColor?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.p1_vertexColor.buffer),i.enableDivisor(r.p1_vertexColor,1),e.vertexAttribPointer(r.p1_vertexColor,3,e.FLOAT,!1,0,3*t.instanceOffset*4)):e.vertexAttrib3fv(r.p1_vertexColor,new Float32Array(36)))}}class XeLineWeight2dModule{static updateAttributes(e,t){window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fOrderValues)}static setupAttributes(e,t,i,r,n){-1!=r.fOrderValues&&(t.attributes.fOrderValues?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.fOrderValues.buffer),i.enableDivisor(r.fOrderValues,1),e.vertexAttribPointer(r.fOrderValues,2,e.FLOAT,!1,0,2*t.instanceOffset*4)):n?.fOrderValues?e.vertexAttrib2fv(r.fOrderValues,n.fOrderValues):e.vertexAttrib2fv(r.fOrderValues,new Float32Array(9)))}}class XeLineWeight3dModule{static updateAttributes(e,t){}static setupAttributes(e,t,i,r){}}class XeLineWeightTypeModule{static updateUniforms(e,t,i,r,n){t.patternScaleMultiplier&&(e.uniform1f(t.patternScaleMultiplier,i.ltRecordScale),e.uniform1f(t.firstDashLen,Math.abs(i.patternArray[0])),e.uniform1f(t.patternLength,i.xeLTRecordPatternLength),e.uniform1i(t.arcCircleType,i.arcCircleType),void 0!==n?.fEndOverride?e.uniform1f(t.fEndOverride,n.fEndOverride):e.uniform1f(t.fEndOverride,-1))}static updateAttributes(e,t){window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fPatternCoords),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fReverseCoords),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fsemiScCoefs)}static setupAttributes(e,t,i,r){void 0!==t.instanceOffset&&null!=t.instanceOffset&&(-1!=r.fPatternCoords&&(t.attributes.fPatternCoords?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.fPatternCoords.buffer),i.enableDivisor(r.fPatternCoords,1),e.vertexAttribPointer(r.fPatternCoords,2,e.FLOAT,!1,0,2*t.instanceOffset*4)):e.vertexAttrib2fv(r.fPatternCoords,new Float32Array(9))),-1!=r.fReverseCoords&&(t.attributes.fReverseCoords?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.fReverseCoords.buffer),i.enableDivisor(r.fReverseCoords,1),e.vertexAttribPointer(r.fReverseCoords,2,e.FLOAT,!1,0,2*t.instanceOffset*4)):e.vertexAttrib2fv(r.fReverseCoords,new Float32Array(9))),-1!=r.fsemiScCoefs)&&(t.attributes.fsemiScCoefs?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.fsemiScCoefs.buffer),i.enableDivisor(r.fsemiScCoefs,1),e.vertexAttribPointer(r.fsemiScCoefs,2,e.FLOAT,!1,0,2*t.instanceOffset*4)):e.vertexAttrib2fv(r.fsemiScCoefs,new Float32Array(9)))}}class XeRayLWModule{static updateAttributes(e,t){window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayStartArrayLW),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayDirectionArrayLW),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayPropertiesArrayLW),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayOrdersArrayLW)}static setupAttributes(e,t,i,r){-1!=r.rayStartPoint&&(t.attributes.rayStartArrayLW?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayStartArrayLW.buffer),i.enableDivisor(r.rayStartPoint,1),e.vertexAttribPointer(r.rayStartPoint,3,e.FLOAT,!1,0,3*t.instanceOffset*4)):e.vertexAttrib3fv(r.rayStartPoint,new Float32Array(9))),-1!=r.rayDirection&&(t.attributes.rayDirectionArrayLW?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayDirectionArrayLW.buffer),i.enableDivisor(r.rayDirection,1),e.vertexAttribPointer(r.rayDirection,3,e.FLOAT,!1,0,3*t.instanceOffset*4)):e.vertexAttrib3fv(r.rayDirection,new Float32Array(9))),-1!=r.rayPropertiesArray&&(t.attributes.rayPropertiesArrayLW?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayPropertiesArrayLW.buffer),i.enableDivisor(r.rayPropertiesArray,1),e.vertexAttribPointer(r.rayPropertiesArray,1,e.FLOAT,!1,0,4*+t.instanceOffset)):e.vertexAttrib3fv(r.rayPropertiesArray,new Int32Array(9))),-1!=r.fOrderValue&&(t.attributes.rayOrdersArrayLW?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayOrdersArrayLW.buffer),i.enableDivisor(r.fOrderValue,1),e.vertexAttribPointer(r.fOrderValue,1,e.FLOAT,!1,0,4*+t.instanceOffset)):e.vertexAttrib1f(r.fOrderValue,0))}}class XeRayModule{static updateAttributes(e,t){window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayStartPoint),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayDirection),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.rayPropertiesArray)}static setupAttributes(e,t,i,r){-1!=r.rayStartPoint&&(t.attributes.rayStartPoint?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayStartPoint.buffer),i.enableAttribute(r.rayStartPoint),e.vertexAttribPointer(r.rayStartPoint,3,e.FLOAT,!1,0,0)):e.vertexAttrib3fv(r.rayStartPoint,new Float32Array(9))),-1!=r.rayDirection&&(t.attributes.rayDirection?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayDirection.buffer),i.enableAttribute(r.rayDirection),e.vertexAttribPointer(r.rayDirection,3,e.FLOAT,!1,0,0)):e.vertexAttrib3fv(r.rayDirection,new Float32Array(9))),-1!=r.rayPropertiesArray&&(t.attributes.rayPropertiesArray?(e.bindBuffer(e.ARRAY_BUFFER,t.attributes.rayPropertiesArray.buffer),i.enableAttribute(r.rayPropertiesArray),e.vertexAttribPointer(r.rayPropertiesArray,1,e.FLOAT,!1,0,0)):e.vertexAttrib3fv(r.rayPropertiesArray,new Int32Array(9)))}}class XeShaderDrawObjectLineTypeWeight2d{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}get uniformIdentifiers(){return["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","pointSize","flags","order_nominator","order_denominator","order_base","frontClipPlane","backClipPlane","lineWidth","ndcToPixelMatrix","inverseNdcToPixelMatrix","patternScaleMultiplier","firstDashLen","patternLength","arcCircleType","fEndOverride","itemMatrixScale"]}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,this.uniformIdentifiers)),this.m_uniform_locations}get attributeIdentifiers(){return["p0","p1","p0_vertexColor","p1_vertexColor","fOrderValues","fPatternCoords","fReverseCoords","fsemiScCoefs","rayStartPoint","rayDirection","rayPropertiesArray","fOrderValue"]}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,this.attributeIdentifiers)),this.m_attribute_locations}invalidate(){this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6,kHaveNormal:7,kGenerateNormal:8,kFlatShaded:9,kGouraudShaded:10,kFlatShadedWithWireframe:11,kGouraudShadedWithWireframe:12});updateUniforms(e,t,i,r,n,o,a,s,c){var l=i.getXeGsDevice(),d=new XeBitSet,u=window.xeGlGlobalUniformData,p=(u.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),p=(u.resolveTraits(t,i,r,n,p,s),u.get()),s=(o.color&&(p.color=o.color,p.useVertexColor=0),d.setBitValue(this.getFlagsPos().kUseVertexColor,p.useVertexColor),void 0!==o.alpha&&(p.alpha=o.alpha),d.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),d.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),e=this.getUniformLocations(s);window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,c,o),XeShaderDrawOrderModule.updateUniforms(s,e,p,l,t,i,n),s.uniform3f(e.color,p.color[0],p.color[1],p.color[2]),s.uniform1f(e.alpha,p.alpha),s.uniform1f(e.pointSize,p.pointSize),XeLineWeightModule.updateUniforms(s,e,u,t,i,r,n,o),XeLineWeightTypeModule.updateUniforms(s,e,p,t,o),s.uniform1i(e.flags,d.getNumber())}updateAttributes(e,t){e=e.getGl(),t=t.attributes;XeLineWeightModule.updateAttributes(e,t),XeLineWeightTypeModule.updateAttributes(e,t),XeLineWeight2dModule.updateAttributes(e,t)}setupAttributes(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);XeLineWeightModule.setupAttributes(i,t,e,r),XeLineWeightTypeModule.setupAttributes(i,t,e,r),XeLineWeight2dModule.setupAttributes(i,t,e,r),e.disableUnusedAttributes()}}class XeShaderDrawObjectLineTypeWeight3d{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}get uniformIdentifiers(){return["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","pointSize","flags","frontClipPlane","backClipPlane","lineWidth","ndcToPixelMatrix","inverseNdcToPixelMatrix","patternScaleMultiplier","firstDashLen","patternLength","arcCircleType","fEndOverride","itemMatrixScale","uGlobalAmbient","uSpecularMaterial","uShininessCoeff","numLights","lights"]}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,this.uniformIdentifiers)),this.m_uniform_locations}get attributeIdentifiers(){return["p0","p1","p0_vertexColor","p1_vertexColor","fPatternCoords","fReverseCoords","fsemiScCoefs","rayStartPoint","rayDirection","rayPropertiesArray","fOrderValue"]}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,this.attributeIdentifiers)),this.m_attribute_locations}invalidateLights(){this.m_LightsValid=!1}invalidate(){this.invalidateLights(),this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6,kHaveNormal:7,kGenerateNormal:8,kFlatShaded:9,kGouraudShaded:10,kFlatShadedWithWireframe:11,kGouraudShadedWithWireframe:12});updateUniforms(e,t,i,r,n,o,a,s,c){i.getXeGsDevice();var l=new XeBitSet,d=window.xeGlGlobalUniformData,u=(d.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),u=(d.resolveTraits(t,i,r,n,u,s),d.get()),s=(o.color&&(u.color=o.color,u.useVertexColor=0),l.setBitValue(this.getFlagsPos().kUseVertexColor,u.useVertexColor),void 0!==o.alpha&&(u.alpha=o.alpha),l.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),l.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),e=this.getUniformLocations(s);window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,c,o),s.uniform3f(e.color,u.color[0],u.color[1],u.color[2]),s.uniform1f(e.alpha,u.alpha),s.uniform1f(e.pointSize,u.pointSize),XeLineWeightModule.updateUniforms(s,e,d,t,i,r,n,o),XeLineWeightTypeModule.updateUniforms(s,e,u,t,o),this.m_LightsValid=!0,s.uniform1i(e.flags,l.getNumber())}updateAttributes(e,t){e=e.getGl(),t=t.attributes;XeLineWeightModule.updateAttributes(e,t),XeLineWeightTypeModule.updateAttributes(e,t),XeLineWeight3dModule.updateAttributes(e,t)}setupAttributes(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);XeLineWeightModule.setupAttributes(i,t,e,r),XeLineWeightTypeModule.setupAttributes(i,t,e,r),XeLineWeight3dModule.setupAttributes(i,t,e,r),e.disableUnusedAttributes()}}let XeShaderDrawOrderConfig={entitiesBase:1,trackersBase:.5};class XeShaderDrawOrderModule{static updateUniforms(e,t,i,r,n,o,a){var s=o.getOwner();let c=1;c=o.getDenominator(),0===s?c=o.getDenominator():1===s?c=r.getMSDenominator():2===s&&(c=r.getPSDenominator()),c=2*((c=a&&a.order_base_denominator?a.order_base_denominator:c)+10),i.order_denominator=c,i.order_base=XeShaderDrawOrderConfig.entitiesBase,o?.isTracker()&&(i.order_base=XeShaderDrawOrderConfig.trackersBase),a&&(i.order_base=i.order_base-a.order_base/c);s=1/n.m_vpTotalCount,r=s*n.m_vpDrawIndex;i.order_base-=r/=2,e.uniform1f(t.order_denominator,i.order_denominator),e.uniform1f(t.order_base,i.order_base),e.uniform1f(t.order_nominator,s)}}let XeGLLinetypesProgram_DynLt_ShaderPredefines={fx_code_additional_dyn_lt_uniforms:`uniform float patternScaleMultiplier;
        uniform float firstDashLen;
        uniform float patternLength;
        uniform int arcCircleType;
        uniform float fEndOverride;
        uniform float itemMatrixScale;
        `,fx_code_additional_dyn_lt_align:`float align(float fStart, float fEnd, float alignPatternLength, float alignfirstDashLen)
    {
        fStart /= alignPatternLength;
        fEnd /= alignPatternLength;
        float diff = mod(fEnd, 1.0);
        diff = ( ( 1.0 - diff ) < 0.00001 ) ? 0.0 : diff;
        return ( (alignfirstDashLen / alignPatternLength) - diff ) * 0.5;
    }`,fx_code_additional_dyn_lt_clt_body:`float alignPatternLength = patternLength * patternScaleMultiplier;
    float alignfirstDashLen = firstDashLen * patternScaleMultiplier;
    float correctPatternLength = patternLength;
    float fShift = 0.0;

    float fStart = 0.0;
    float fEnd = 0.0;
    if(fEndOverride > 0.0)
        fEnd = fEndOverride * itemMatrixScale;
    else
        fEnd =  v_fPatternCoord  + v_fReverseCoord;

    if(arcCircleType < 2) //lines + opened curves
    {
        fShift = align(fStart, fEnd, alignPatternLength, alignfirstDashLen);    
    } else if(arcCircleType == 2) { //closed curves
        float times = round(fEnd/ alignPatternLength);
        alignPatternLength = fEnd / times;
        correctPatternLength = alignPatternLength / patternScaleMultiplier;
        alignfirstDashLen = alignPatternLength * (firstDashLen / patternLength);
    }
    
    float patternCoord = v_fPatternCoord / alignPatternLength + fShift;
    float reversePatternCoord = v_fReverseCoord/ alignPatternLength + fShift;`,fx_code_additional_dyn_lt_lw_semicoef_mult:"patternCoeff *= patternScaleMultiplier * correctPatternLength;"},XeGLLinetypesProgram_noDynLt_ShaderPredefines={fx_code_additional_dyn_lt_uniforms:"",fx_code_additional_dyn_lt_align:"",fx_code_additional_dyn_lt_clt_body:`float patternCoord = v_fPatternCoord;
    float reversePatternCoord = v_fReverseCoord;
    `,fx_code_additional_dyn_lt_lw_semicoef_mult:""},XeGLLinetypesProgram_LW_ClosedCurve_ShaderPredefines={fx_code_additional_plingen_mult:"const float plineGenMultiplier = 0.2;"},XeGLLinetypesProgram_LW_noClosedCurve_ShaderPredefines={fx_code_additional_plingen_mult:"const float plineGenMultiplier = 1.0;"};class XeGLLinetypesProgram{static get placeholder_2d(){return"DrawObjectLinetype_2d"}static get placeholder_3d(){return"DrawObjectLinetype_3d"}static get placeholder_LW_2d(){return"DrawObjectLineTypeWeight_2d"}static get placeholder_LW_3d(){return"DrawObjectLineTypeWeight_3d"}static get placeholder_class_2d(){return XeDrawObjectLinetype2DShader}static get placeholder_class_3d(){return XeDrawObjectLinetype3DShader}static get placeholder_class_LW_2d(){return XeShaderDrawObjectLineTypeWeight2d}static get placeholder_class_LW_3d(){return XeShaderDrawObjectLineTypeWeight3d}static generateShaderName(e,t){return`LinetypeShader_handle_${e}_mode_`+t.mode+(t.isDynamicLinetype?"_dyn":"")+(t.isLw?"_lw":"")+(2==t.arcCircleType?"_cc":"")+("3d"==t.mode?"_"+t.renderModeKey:"")+(t.isRay?"_ray":"")}static curValue(e,t){return e/t.getPatternLength()}static AddBody(e,t,i,r,n){var o;return GeNeo.OdEqual(t,0,1e-10)?e+="    res += step("+(o=this.curValue(n,i).toFixed(6))+" - d, v) * step(v, "+o+" + d);\n":0<t&&(e+="    res += step( "+this.curValue(n,i).toFixed(6)+" - dDash, v) * step(v, "+this.curValue(r,i).toFixed(6)+" + dDash );\n"),e}static AddLWBody(e,t,i,r,n){return GeNeo.OdEqual(t,0,1e-10)?e=e+("    tmp = vec2( dist(v, "+this.curValue(n,i).toFixed(6))+") * patternCoeff, roundParam.y);\n    res += step( dot(tmp, tmp), 1.0001 );\n":0<t&&(e=(e=(e+="    tmp = vec2( dist(v, "+(t=this.curValue(n,i).toFixed(6))+") * patternCoeff, roundParam.y);\n")+"    res += step( dot(tmp, tmp), 1.0001 );\n    tmp = vec2( dist(v, "+(n=this.curValue(r,i).toFixed(6))+") * patternCoeff, roundParam.y);\n")+"    res += step( dot(tmp, tmp), 1.0001 );\n    res += step( "+t+", v) * step(v, "+n+");\n"),e}static GetCode(t,i,r){var n=t.getNumDashes();let o=0,a=0;for(let e=0;e<n;e++){var s=t.getArrayPattern()[e];i=r(i,s,t,o+=Math.abs(s),a),a=o}return i}static createProgram_noLW(e,t,i,r){var t=this.GetCode(t,"float dDash = 0.0;\n",this.AddBody.bind(this)),n=new Map;return n.set("fx_code_additional_main_body",t),XeShaderCompiler.ObjToMap(r.isDynamicLinetype?XeGLLinetypesProgram_DynLt_ShaderPredefines:XeGLLinetypesProgram_noDynLt_ShaderPredefines,n),"3d"==r.mode&&(t=XeShader3dPrograms.GetCode(r.renderModeKey),XeShaderCompiler.ObjToMap(t,n)),r.isRay&&n.set("fx_ray_draw_define","#define FX_CODE_RAY_DRAW"),window.XeShaders.createShaderFromPlaceholder(e,"2d"==r.mode?this.placeholder_class_2d:this.placeholder_class_3d,"2d"==r.mode?this.placeholder_2d:this.placeholder_3d,i,n),window.XeShaders.container[i]}static createProgram_LW(e,t,i,r){var t=this.GetCode(t,"vec2 tmp;\n",this.AddLWBody.bind(this)),n=new Map;return n.set("fx_code_additional_main_body",t),XeShaderCompiler.ObjToMap(r.isDynamicLinetype?XeGLLinetypesProgram_DynLt_ShaderPredefines:XeGLLinetypesProgram_noDynLt_ShaderPredefines,n),XeShaderCompiler.ObjToMap(2==r.arcCircleType?XeGLLinetypesProgram_LW_ClosedCurve_ShaderPredefines:XeGLLinetypesProgram_LW_noClosedCurve_ShaderPredefines,n),"3d"==r.mode&&(t=XeShader3dPrograms.GetCode(r.renderModeKey),XeShaderCompiler.ObjToMap(t,n)),r.isRay&&n.set("fx_ray_draw_define","#define FX_CODE_RAY_DRAW"),window.XeShaders.createShaderFromPlaceholder(e,"2d"==r.mode?this.placeholder_class_LW_2d:this.placeholder_class_LW_3d,"2d"==r.mode?this.placeholder_LW_2d:this.placeholder_LW_3d,i,n),window.XeShaders.container[i]}static createProgram(e,t,i,r){return r.isLw?this.createProgram_LW(e,t,i,r):this.createProgram_noLW(e,t,i,r)}static getProgram(e,t,i){var r=this.generateShaderName(t.getHandle(),i);return window.XeShaders.container[r]||this.createProgram(e,t,r,i)}}class XeShader2dPrograms{static generateShaderName(e,t){return"XeDrawObjectCommon2d"+(e?"_lw":"")+(t?"_ray":"")}static createProgram(e,t,i,r){var n=new Map;return r&&n.set("fx_ray_draw_define","#define FX_CODE_RAY_DRAW"),i?window.XeShaders.createShaderFromPlaceholder(e,XeDrawObjectLineWeight2d,"DrawObjectLineWeight_2d",t,n):window.XeShaders.createShaderFromPlaceholder(e,XeDrawObjectCommon2d,"DrawObjectCommon_2d",t,n),window.XeShaders.container[t]}static getProgram(e,t,i){var r=this.generateShaderName(t,i);return window.XeShaders.container[r]||this.createProgram(e,r,t,i)}}let XeShader3dProgram_Gouraud_ShaderDefines={fx_lighting_shademode_normal:"VARYING vec3 v_normal;",fx_additional_code_lighting_vert:"v_normal = normal;",fx_additional_code_lighting:"frag_color = Gouraud_Lighting(v_normal, frag_color);"},XeShader3dProgram_Flat_ShaderDefines={fx_lighting_shademode_normal:"flat VARYING vec3 v_normal;",fx_additional_code_lighting_vert:"v_normal = normal;",fx_additional_code_lighting:"frag_color = Gouraud_Lighting(v_normal, frag_color);"},XeShader3dProgram_NoNormals_ShaderDefines={fx_lighting_shademode_normal:"",fx_additional_code_lighting_vert:"",fx_additional_code_lighting:"frag_color = FlatOrAny_Lighting(v_mPosition, frag_color);"},XeShader3dProgram_CP_ShaderDefines={fx_lighting_shademode_normal:"",fx_additional_code_lighting_vert:"",fx_additional_code_lighting:""},XeShader3dProgramsModes={gouraud:0,flat:1,no_normals:2,no_lighting:3};class XeShader3dPrograms{static generateShaderName(e,t,i){return"XeDrawObjectCommon3d_mode_"+e+(t?"_lw":"")+(i?"_ray":"")}static GetCode(e){switch(e){case XeShader3dProgramsModes.gouraud:return XeShader3dProgram_Gouraud_ShaderDefines;case XeShader3dProgramsModes.flat:return XeShader3dProgram_Flat_ShaderDefines;case XeShader3dProgramsModes.no_normals:return XeShader3dProgram_NoNormals_ShaderDefines;case XeShader3dProgramsModes.no_lighting:return XeShader3dProgram_CP_ShaderDefines}}static createProgram(e,t,i,r,n){var t=this.GetCode(t),o=new Map;return XeShaderCompiler.ObjToMap(t,o),n&&o.set("fx_ray_draw_define","#define FX_CODE_RAY_DRAW"),r?window.XeShaders.createShaderFromPlaceholder(e,XeDrawObjectLineWeight3d,"DrawObjectLineWeight_3d",i,o):window.XeShaders.createShaderFromPlaceholder(e,XeDrawObjectCommon3d,"DrawObjectCommon_3d",i,o),window.XeShaders.container[i]}static getProgram(e,t,i,r){var n=this.generateShaderName(t,i,r);return window.XeShaders.container[n]||this.createProgram(e,t,n,i,r)}static getRenderModeKey(e,t,i){let r;if(i)r=XeShader3dProgramsModes.no_lighting;else if(t)switch(e){case XeGsViewport.prototype.RenderModeEnum.kFlatShaded:case XeGsViewport.prototype.RenderModeEnum.kFlatShadedWithWireframe:r=XeShader3dProgramsModes.flat;break;case XeGsViewport.prototype.RenderModeEnum.kGouraudShaded:case XeGsViewport.prototype.RenderModeEnum.kGouraudShadedWithWireframe:r=XeShader3dProgramsModes.gouraud;break;default:r=XeShader3dProgramsModes.no_lighting,window.XeLogger.warn("no such shademode",e,XeGsViewport.prototype.RenderModeEnum)}else r=XeShader3dProgramsModes.no_lighting;return r}}class XeShaderCommonProgram{static CreateProgram(e,t,i,r){void 0===this.count&&(this.count=0),void 0===r&&(r=new Map),XeShaderCompiler.ObjToMap(XeShaderCommonShaderDefines,r),t.id=++this.count,t.shaderName=i;var n=e.createProgram();let o;"getGlVersion"in t&&(o=t.getGlVersion(window.XeUtils.WEB_RENDERER_PARAMS));var[a,s]=XeShaderCompiler.Compile(e,e.VERTEX_SHADER,t.vert,o,r,t.vertPreprocessed,i),[r,c]=XeShaderCompiler.Compile(e,e.FRAGMENT_SHADER,t.frag,o,r,t.fragPreprocessed,i),s=(t.vert=s,t.vertPreprocessed=!0,t.frag=c,t.fragPreprocessed=!0,e.attachShader(n,a),e.attachShader(n,r),e.linkProgram(n),e.getProgramInfoLog(n));if(!1===e.getProgramParameter(n,e.LINK_STATUS))throw window.XeLogger.error("Shader name:"+i+" XeShaders.prototype.init: shader error: "+e.getError(),"gl.VALIDATE_STATUS",e.getProgramParameter(n,e.VALIDATE_STATUS),"gl.getPRogramInfoLog",s),e.deleteShader(a),e.deleteShader(r),new XeShaderCompilerError("Unable to link shader "+i,i,a,0);return""!==s&&window.XeLogger.warn("Shader name:"+i+" XeShaders.prototype.init: gl.getProgramInfoLog()"+s),e.deleteShader(a),e.deleteShader(r),t.glprogram=n,t}}let XeShaderCommonShaderDefines={fx_ray_draw_define:""};class XeShaderCompiler{static addLineNumbers(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}static ObjToMap(e,t){Object.entries(e).forEach(e=>{t.has(e[0])||t.set(e[0],e[1])})}static get iMAX_LINETYPE_ARRAY_COUNT(){return 24}static PreProcessCodeBlock(e,t){let i=0;for(var[r,n]of t){r=new RegExp(r,"g");i+=r.test(e)?1:0,e=e.replace(r,`
${n}
`)}return[e,i]}static PreProcessDefines(e,t){var i=window.XeUtils.WEB_RENDERER_PARAMS;let r="";return t?r+=t:(i.isAndroid||i.isVMWare)&&(r+="#version 100\n"),(i.isMediump||i.isAndroid||i.isVMWare)&&(r+="#define USE_mediump\n"),i.isAndroid&&(r+="#define USE_uniform_lwUnits\n"),i.OES_standard_derivatives&&(r+="#define OES_standard_derivatives_supported\n"),i.isWebGl2&&(r+="#define WEBGL2\n"),(r+="#define iMAX_LINETYPE_ARRAY_COUNT "+this.iMAX_LINETYPE_ARRAY_COUNT+"\n")+e}static PreProcessIncludes(e){let c=0;return[e=e.replace(/^ *(#include)( *["'](.+)["']) *$/gm,(e,t,i,r,n,o,a)=>{c++;var s=window.XeShaders.getInclude(r);return s||(window.XeLogger.warn("failed include",e,t,i,r),"")}),c]}static PreProcess(e,t,i){e=this.PreProcessDefines(e,t);let r;do{r=0;var n=this.PreProcessIncludes(e);e=n[0],r+=n[1],i&&(e=(n=this.PreProcessCodeBlock(e,i))[0],r+=n[1])}while(0!=r);return e}static Compile(e,t,i,r,n,o,a){var s=e.createShader(t);if(o||(i=this.PreProcess(i,r,n)),e.shaderSource(s,i),e.compileShader(s),!1===e.getShaderParameter(s,e.COMPILE_STATUS))throw window.XeLogger.error("XeShaders.prototype.init: Shader couldn't compile."),new XeShaderCompilerError("Unable to compile shader "+a,a,i,t);o=e.getShaderInfoLog(s);return""!==o&&-1===o.indexOf("GL_ARB_gpu_shader5")&&window.XeLogger.warn("Shader name:"+name+" XeShaders.prototype.init: gl.getShaderInfoLog()",e.getShaderInfoLog(s),this.addLineNumbers(i)),[s,i]}}class XeShaderCompilerError extends Error{constructor(e,t,i,r){super(e),this.shaderName=t,this.shaderText=i,this.shaderType=r==WebGL2RenderingContext.VERTEX_SHADER?"VERTEX":"FRAGMENT"}}class XeDrawObjectCommon2d{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","uniform_CPColor","pointSize","flags","order_nominator","order_denominator","order_base","uTexture","frontClipPlane","backClipPlane"])),this.m_uniform_locations}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","uv","fOrderValue","colorPickingColor","vertexColor","rayStartPoint","rayDirection","rayPropertiesArray"])),this.m_attribute_locations}invalidate(){this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6});updateUniforms(e,t,i,r,n,o,a,s,c){var l=i.getXeGsDevice(),d=new XeBitSet,u=window.xeGlGlobalUniformData,p=(u.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),p=(u.resolveTraits(t,i,r,n,p,s),u.get()),s=(o.color&&(p.color=o.color,p.useVertexColor=0),d.setBitValue(this.getFlagsPos().kUseVertexColor,p.useVertexColor),void 0!==o.alpha&&(p.alpha=o.alpha),XeWebGlRenderer.prototype.common_data.null_texture),u=o?o.texture_link:void 0,u=(u&&XeWebGlRenderer.prototype.common_data.textures[u]?XeWebGlRenderer.prototype.common_data.textures[u].uploaded?(p.useTexture=1,p.uTexture=XeWebGlRenderer.prototype.common_data.textures[u].texture):(p.useTexture=1,p.uTexture=s):(p.useTexture=0,p.uTexture=s),d.setBitValue(this.getFlagsPos().kUseTexture,p.useTexture),p.useColorPickingColor=e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW?1:0,d.setBitValue(this.getFlagsPos().kUseColorPickingColor_CP_COLOR,p.useColorPickingColor),p.useColorPickingColor&&d.clearBit(this.getFlagsPos().kUseTexture),o.uniform_CPColor&&(e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&(p.useColorPickingColor=2,d.clearBit(this.getFlagsPos().kUseColorPickingColor_CP_COLOR),d.setBit(this.getFlagsPos().kUseColorPickingColor_U_CP_COLOR)),p.uniform_CPColor=o.uniform_CPColor),d.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),d.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),s=this.getUniformLocations(u),r=(window.XeShaders.updateCommonMatrixUniforms.call(this,u,t,i,r,n,c,o),XeShaderDrawOrderModule.updateUniforms(u,s,p,l,t,i,n),u.uniform3f(s.color,p.color[0],p.color[1],p.color[2]),u.uniform1f(s.alpha,p.alpha),u.uniform1f(s.pointSize,p.pointSize),u.uniform4f(s.uniform_CPColor,p.uniform_CPColor[0],p.uniform_CPColor[1],p.uniform_CPColor[2],p.uniform_CPColor[3]),u.uniform1i(s.flags,d.getNumber()),e.getTextureUnit());u.uniform1i(s.uTexture,r),e.setTexture(p.uTexture,r)}updateAttributes(e,t){e=e.getGl(),t=t.attributes;window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.uv),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fOrderValue),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.colorPickingColor),t.vertexColor&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.vertexColor),XeRayModule.updateAttributes(e,t)}setupAttributes(e,t,i){var r=e.getGl(),e=e.getGlState(),n=this.getAttributeLocations(r);-1!=n.position&&(t.attributes.position?(r.bindBuffer(r.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(n.position),r.vertexAttribPointer(n.position,3,r.FLOAT,!1,0,0)):r.vertexAttrib3fv(n.position,new Float32Array(9))),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.attributes.uv?(e.enableAttribute(n.uv),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.uv.buffer),r.vertexAttribPointer(n.uv,2,r.FLOAT,!1,0,0)):r.vertexAttrib2fv(n.uv,new Float32Array(9)),t.attributes.fOrderValue?(e.enableAttribute(n.fOrderValue),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.fOrderValue.buffer),r.vertexAttribPointer(n.fOrderValue,1,r.FLOAT,!1,0,0)):i?.fOrderValue?r.vertexAttrib1f(n.fOrderValue,i.fOrderValue):r.vertexAttrib1f(n.fOrderValue,0),t.attributes.colorPickingColor?(e.enableAttribute(n.colorPickingColor),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.colorPickingColor.buffer),r.vertexAttribPointer(n.colorPickingColor,4,r.FLOAT,!1,0,0)):r.vertexAttrib4fv(n.colorPickingColor,new Float32Array(9)),t.attributes.vertexColor?(e.enableAttribute(n.vertexColor),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.vertexColor.buffer),r.vertexAttribPointer(n.vertexColor,3,r.FLOAT,!1,0,0)):r.vertexAttrib3fv(n.vertexColor,new Float32Array(36)),XeRayModule.setupAttributes(r,t,e,n),e.disableUnusedAttributes()}}class XeDrawObjectCommon3d{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","uniform_CPColor","pointSize","flags","uTexture","frontClipPlane","backClipPlane","uGlobalAmbient","uSpecularMaterial","uShininessCoeff","numLights","lights"])),this.m_uniform_locations}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","normal","uv","colorPickingColor","vertexColor","rayStartPoint","rayDirection","rayPropertiesArray"])),this.m_attribute_locations}invalidate(){this.invalidateLights(),this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}invalidateLights(){this.m_LightsValid=!1}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6,kHaveNormal:7,kGenerateNormal:8,kFlatShaded:9,kGouraudShaded:10,kFlatShadedWithWireframe:11,kGouraudShadedWithWireframe:12});updateUniforms(e,t,i,r,n,o,a,s,c){var l=new XeBitSet,d=window.xeGlGlobalUniformData,u=(d.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),u=(d.resolveTraits(t,i,r,n,u,s),d.get()),s=(o.color&&(u.color=o.color,u.useVertexColor=0),l.setBitValue(this.getFlagsPos().kUseVertexColor,u.useVertexColor),void 0!==o.alpha&&(u.alpha=o.alpha),XeWebGlRenderer.prototype.common_data.null_texture),d=o?o.texture_link:void 0,d=(d&&XeWebGlRenderer.prototype.common_data.textures[d]?XeWebGlRenderer.prototype.common_data.textures[d].uploaded?(u.useTexture=1,u.uTexture=XeWebGlRenderer.prototype.common_data.textures[d].texture):(u.useTexture=1,u.uTexture=s):(u.useTexture=0,u.uTexture=s),l.setBitValue(this.getFlagsPos().kUseTexture,u.useTexture),u.useColorPickingColor=e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW?1:0,l.setBitValue(this.getFlagsPos().kUseColorPickingColor_CP_COLOR,u.useColorPickingColor),u.useColorPickingColor&&l.clearBit(this.getFlagsPos().kUseTexture),o.uniform_CPColor&&(e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&(u.useColorPickingColor=2,l.clearBit(this.getFlagsPos().kUseColorPickingColor_CP_COLOR),l.setBit(this.getFlagsPos().kUseColorPickingColor_U_CP_COLOR)),u.uniform_CPColor=o.uniform_CPColor),l.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),l.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),s=this.getUniformLocations(d),i=(window.XeShaders.updateCommonMatrixUniforms.call(this,d,t,i,r,n,c,o),d.uniform3f(s.color,u.color[0],u.color[1],u.color[2]),d.uniform1f(s.alpha,u.alpha),d.uniform1f(s.pointSize,u.pointSize),d.uniform4f(s.uniform_CPColor,u.uniform_CPColor[0],u.uniform_CPColor[1],u.uniform_CPColor[2],u.uniform_CPColor[3]),this.m_LightsValid=XeLightingModule.updateUniforms(d,s,t,u,l,this.m_LightsValid),d.uniform1i(s.flags,l.getNumber()),e.getTextureUnit());d.uniform1i(s.uTexture,i),e.setTexture(u.uTexture,i)}updateAttributes(e,t){e=e.getGl(),t=t.attributes;window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.normal),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.uv),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.colorPickingColor),t.vertexColor&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.vertexColor),XeRayModule.updateAttributes(e,t)}setupAttributes(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);-1!=r.position&&(t.attributes.position?(i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.position,new Float32Array(9))),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),-1!=r.normal&&(t.attributes.normal?(e.enableAttribute(r.normal),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.normal.buffer),i.vertexAttribPointer(r.normal,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.normal,new Float32Array(9))),t.attributes.uv?(e.enableAttribute(r.uv),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.uv.buffer),i.vertexAttribPointer(r.uv,2,i.FLOAT,!1,0,0)):i.vertexAttrib2fv(r.uv,new Float32Array(9)),t.attributes.colorPickingColor?(e.enableAttribute(r.colorPickingColor),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.colorPickingColor.buffer),i.vertexAttribPointer(r.colorPickingColor,4,i.FLOAT,!1,0,0)):i.vertexAttrib4fv(r.colorPickingColor,new Float32Array(9)),t.attributes.vertexColor?(e.enableAttribute(r.vertexColor),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.vertexColor.buffer),i.vertexAttribPointer(r.vertexColor,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.vertexColor,new Float32Array(36)),XeRayModule.setupAttributes(i,t,e,r),e.disableUnusedAttributes()}}class XeDrawObjectLinetype2DShader{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","uniform_CPColor","pointSize","flags","order_nominator","order_denominator","order_base","frontClipPlane","backClipPlane","halfScaledPixelSize","patternScaleMultiplier","firstDashLen","patternLength","arcCircleType","fEndOverride","itemMatrixScale"])),this.m_uniform_locations}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","fOrderValue","colorPickingColor","vertexColor","fPatternCoord","fReverseCoord","rayStartPoint","rayDirection","rayPropertiesArray"])),this.m_attribute_locations}invalidate(){this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6});updateUniforms(e,t,i,r,n,o,a,s,c){var l=i.getXeGsDevice(),d=new XeBitSet,u=window.xeGlGlobalUniformData,p=(u.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),p=(u.resolveTraits(t,i,r,n,p,s),u.get()),s=(o.color&&(p.color=o.color,p.useVertexColor=0),d.setBitValue(this.getFlagsPos().kUseVertexColor,p.useVertexColor),void 0!==o.alpha&&(p.alpha=o.alpha),p.useColorPickingColor=e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW?1:0,d.setBitValue(this.getFlagsPos().kUseColorPickingColor_CP_COLOR,p.useColorPickingColor),p.useColorPickingColor&&d.clearBit(this.getFlagsPos().kUseTexture),o.uniform_CPColor&&(e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&(p.useColorPickingColor=2,d.clearBit(this.getFlagsPos().kUseColorPickingColor_CP_COLOR),d.setBit(this.getFlagsPos().kUseColorPickingColor_U_CP_COLOR)),p.uniform_CPColor=o.uniform_CPColor),d.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),d.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),u=this.getUniformLocations(s);window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,c,o),XeShaderDrawOrderModule.updateUniforms(s,u,p,l,t,i,n),s.uniform3f(u.color,p.color[0],p.color[1],p.color[2]),s.uniform1f(u.alpha,p.alpha),s.uniform1f(u.pointSize,p.pointSize),s.uniform4f(u.uniform_CPColor,p.uniform_CPColor[0],p.uniform_CPColor[1],p.uniform_CPColor[2],p.uniform_CPColor[3]),s.uniform1i(u.flags,d.getNumber()),u.halfScaledPixelSize&&s.uniform1f(u.halfScaledPixelSize,p.halfScaledPixelSize),u.patternScaleMultiplier&&(s.uniform1f(u.patternScaleMultiplier,p.ltRecordScale),s.uniform1f(u.firstDashLen,Math.abs(p.patternArray[0])),s.uniform1f(u.patternLength,p.xeLTRecordPatternLength),s.uniform1i(u.arcCircleType,p.arcCircleType),void 0!==o?.fEndOverride?s.uniform1f(u.fEndOverride,o.fEndOverride):s.uniform1f(u.fEndOverride,-1))}updateAttributes(e,t){e=e.getGl(),t=t.attributes;window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.ltIndex),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltVertex),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltOrder),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltColorPickingColor),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fPatternCoord),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fReverseCoord),t.ltColors&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltColors)}setupAttributes(e,t,i){var r=e.getGl(),e=e.getGlState(),n=this.getAttributeLocations(r);-1!=n.position&&(t.attributes.ltVertex?(r.bindBuffer(r.ARRAY_BUFFER,t.attributes.ltVertex.buffer),e.enableAttribute(n.position),r.vertexAttribPointer(n.position,3,r.FLOAT,!1,0,0)):r.vertexAttrib3fv(n.position,new Float32Array(9))),t.attributes.ltIndex?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.attributes.ltIndex.buffer):r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.attributes.ltOrder?(e.enableAttribute(n.fOrderValue),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.ltOrder.buffer),r.vertexAttribPointer(n.fOrderValue,1,r.FLOAT,!1,0,0)):i?.fOrderValue?r.vertexAttrib1f(n.fOrderValue,i.fOrderValue):r.vertexAttrib1f(n.fOrderValue,0),t.attributes.ltColorPickingColor?(e.enableAttribute(n.colorPickingColor),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.ltColorPickingColor.buffer),r.vertexAttribPointer(n.colorPickingColor,4,r.FLOAT,!1,0,0)):r.vertexAttrib4fv(n.colorPickingColor,new Float32Array(9)),t.attributes.ltColors?(e.enableAttribute(n.vertexColor),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.ltColors.buffer),r.vertexAttribPointer(n.vertexColor,3,r.FLOAT,!1,0,0)):r.vertexAttrib3fv(n.vertexColor,new Float32Array(36)),-1!=n.fPatternCoord&&(t.attributes.fPatternCoord?(e.enableAttribute(n.fPatternCoord),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.fPatternCoord.buffer),r.vertexAttribPointer(n.fPatternCoord,1,r.FLOAT,!1,0,0)):r.vertexAttrib1f(n.fPatternCoord,0)),-1!=n.fReverseCoord&&(t.attributes.fReverseCoord?(e.enableAttribute(n.fReverseCoord),r.bindBuffer(r.ARRAY_BUFFER,t.attributes.fReverseCoord.buffer),r.vertexAttribPointer(n.fReverseCoord,1,r.FLOAT,!1,0,0)):r.vertexAttrib1f(n.fReverseCoord,0)),e.disableUnusedAttributes()}}class XeDrawObjectLinetype3DShader{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","uniform_CPColor","pointSize","flags","frontClipPlane","backClipPlane","uGlobalAmbient","uSpecularMaterial","uShininessCoeff","numLights","lights","halfScaledPixelSize","patternScaleMultiplier","firstDashLen","patternLength","arcCircleType","fEndOverride","itemMatrixScale"])),this.m_uniform_locations}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","normal","colorPickingColor","vertexColor","fPatternCoord","fReverseCoord","rayStartPoint","rayDirection","rayPropertiesArray"])),this.m_attribute_locations}invalidate(){this.invalidateLights(),this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated=function(){this.invalidate()};invalidateLights(){this.m_LightsValid=!1}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6,kHaveNormal:7,kGenerateNormal:8,kFlatShaded:9,kGouraudShaded:10,kFlatShadedWithWireframe:11,kGouraudShadedWithWireframe:12});getNormalsModes=()=>({kNoNormal:0,kHaveNormal:1,kGenerateNormal:2});getShadeModes=()=>({k2DOptimized:0,kWireframe:1,kHiddenLine:2,kFlatShaded:3,kGouraudShaded:4,kFlatShadedWithWireframe:5,kGouraudShadedWithWireframe:6});updateUniforms(e,t,i,r,n,o,a,s,c){var l=new XeBitSet,d=window.xeGlGlobalUniformData,u=(d.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),u=(d.resolveTraits(t,i,r,n,u,s),d.get()),s=(o.color&&(u.color=o.color,u.useVertexColor=0),l.setBitValue(this.getFlagsPos().kUseVertexColor,u.useVertexColor),void 0!==o.alpha&&(u.alpha=o.alpha),u.useColorPickingColor=e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW?1:0,l.setBitValue(this.getFlagsPos().kUseColorPickingColor_CP_COLOR,u.useColorPickingColor),u.useColorPickingColor&&l.clearBit(this.getFlagsPos().kUseTexture),o.uniform_CPColor&&(e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&(u.useColorPickingColor=2,l.clearBit(this.getFlagsPos().kUseColorPickingColor_CP_COLOR),l.setBit(this.getFlagsPos().kUseColorPickingColor_U_CP_COLOR)),u.uniform_CPColor=o.uniform_CPColor),l.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),l.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),d=this.getUniformLocations(s);window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,c,o),s.uniform3f(d.color,u.color[0],u.color[1],u.color[2]),s.uniform1f(d.alpha,u.alpha),s.uniform1f(d.pointSize,u.pointSize),s.uniform4f(d.uniform_CPColor,u.uniform_CPColor[0],u.uniform_CPColor[1],u.uniform_CPColor[2],u.uniform_CPColor[3]),this.m_LightsValid=XeLightingModule.updateUniforms(s,d,t,u,l,this.m_LightsValid),s.uniform1i(d.flags,l.getNumber()),d.halfScaledPixelSize&&s.uniform1f(d.halfScaledPixelSize,u.halfScaledPixelSize),d.patternScaleMultiplier&&(s.uniform1f(d.patternScaleMultiplier,u.ltRecordScale),s.uniform1f(d.firstDashLen,Math.abs(u.patternArray[0])),s.uniform1f(d.patternLength,u.xeLTRecordPatternLength),s.uniform1i(d.arcCircleType,u.arcCircleType),void 0!==o?.fEndOverride?s.uniform1f(d.fEndOverride,o.fEndOverride):s.uniform1f(d.fEndOverride,-1))}updateAttributes(e,t){e=e.getGl(),t=t.attributes;window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.ltIndex),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltVertex),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltNormals),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltColorPickingColor),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fPatternCoord),window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fReverseCoord),t.ltColors&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.ltColors)}setupAttributes(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);-1!=r.position&&(t.attributes.ltVertex?(i.bindBuffer(i.ARRAY_BUFFER,t.attributes.ltVertex.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.position,new Float32Array(9))),t.attributes.ltIndex?i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.attributes.ltIndex.buffer):i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),-1!=r.normal&&(t.attributes.ltNormals?(e.enableAttribute(r.normal),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.ltNormals.buffer),i.vertexAttribPointer(r.normal,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.normal,new Float32Array(9))),t.attributes.ltColorPickingColor?(e.enableAttribute(r.colorPickingColor),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.ltColorPickingColor.buffer),i.vertexAttribPointer(r.colorPickingColor,4,i.FLOAT,!1,0,0)):i.vertexAttrib4fv(r.colorPickingColor,new Float32Array(9)),t.attributes.ltColors?(e.enableAttribute(r.vertexColor),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.ltColors.buffer),i.vertexAttribPointer(r.vertexColor,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.vertexColor,new Float32Array(36)),-1!=r.fPatternCoord&&(t.attributes.fPatternCoord?(e.enableAttribute(r.fPatternCoord),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.fPatternCoord.buffer),i.vertexAttribPointer(r.fPatternCoord,1,i.FLOAT,!1,0,0)):i.vertexAttrib1f(r.fPatternCoord,0)),-1!=r.fReverseCoord&&(t.attributes.fReverseCoord?(e.enableAttribute(r.fReverseCoord),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.fReverseCoord.buffer),i.vertexAttribPointer(r.fReverseCoord,1,i.FLOAT,!1,0,0)):i.vertexAttrib1f(r.fReverseCoord,0)),e.disableUnusedAttributes()}}class XeDrawObjectLineWeight2d{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","uniform_CPColor","pointSize","flags","order_nominator","order_denominator","order_base","frontClipPlane","backClipPlane","lineWidth","ndcToPixelMatrix","inverseNdcToPixelMatrix"])),this.m_uniform_locations}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["p0","p1","p0_vertexColor","p1_vertexColor","fOrderValues","rayStartPoint","rayDirection","rayPropertiesArray","fOrderValue"])),this.m_attribute_locations}invalidate(){this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6});updateUniforms(e,t,i,r,n,o,a,s,c){var l=i.getXeGsDevice(),d=new XeBitSet,u=window.xeGlGlobalUniformData,p=(u.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),p=(u.resolveTraits(t,i,r,n,p,s),u.get()),s=(o.color&&(p.color=o.color,p.useVertexColor=0),d.setBitValue(this.getFlagsPos().kUseVertexColor,p.useVertexColor),void 0!==o.alpha&&(p.alpha=o.alpha),d.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),d.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),e=this.getUniformLocations(s);window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,c,o),XeShaderDrawOrderModule.updateUniforms(s,e,p,l,t,i,n),s.uniform3f(e.color,p.color[0],p.color[1],p.color[2]),s.uniform1f(e.alpha,p.alpha),s.uniform1f(e.pointSize,p.pointSize),s.uniform1i(e.flags,d.getNumber()),XeLineWeightModule.updateUniforms(s,e,u,t,i,r,n,o)}updateAttributes(e,t){e=e.getGl(),t=t.attributes;XeLineWeightModule.updateAttributes(e,t),XeLineWeight2dModule.updateAttributes(e,t),XeRayLWModule.updateAttributes(e,t)}setupAttributes(e,t,i){var r=e.getGl(),e=e.getGlState(),n=this.getAttributeLocations(r);XeLineWeightModule.setupAttributes(r,t,e,n),XeLineWeight2dModule.setupAttributes(r,t,e,n,i),XeRayLWModule.setupAttributes(r,t,e,n),e.disableUnusedAttributes()}}class XeDrawObjectLineWeight3d{constructor(e,t){this.vert=e,this.frag=t,this.glprogram=void 0,this.m_attribute_locations=void 0,this.m_uniform_locations=void 0}getGlVersion(e){return e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""}getUniformLocations(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedStackMatrix","calculatedFullStackMatrix","inversecalculatedFullStackMatrix","color","alpha","uniform_CPColor","pointSize","flags","order_nominator","order_denominator","order_base","frontClipPlane","backClipPlane","lineWidth","ndcToPixelMatrix","inverseNdcToPixelMatrix","uGlobalAmbient","uSpecularMaterial","uShininessCoeff","numLights","lights"])),this.m_uniform_locations}getAttributeLocations(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["p0","p1","p0_vertexColor","p1_vertexColor","rayStartPoint","rayDirection","rayPropertiesArray","fOrderValue"])),this.m_attribute_locations}invalidate(){this.invalidateLights(),this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d}activated(){this.invalidate()}invalidateLights(){this.m_LightsValid=!1}getFlagsPos=()=>({kUseTexture:0,kUseColorPickingColor_CP_COLOR:2,kUseColorPickingColor_U_CP_COLOR:3,kUseVertexColor:4,kIsFrontClipped:5,kIsBackClipped:6,kHaveNormal:7,kGenerateNormal:8,kFlatShaded:9,kGouraudShaded:10,kFlatShadedWithWireframe:11,kGouraudShadedWithWireframe:12});updateUniforms(e,t,i,r,n,o,a,s,c){i.getXeGsDevice();var l=new XeBitSet,d=window.xeGlGlobalUniformData,u=(d.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),u=(d.resolveTraits(t,i,r,n,u,s),d.get()),s=(o.color&&(u.color=o.color,u.useVertexColor=0),l.setBitValue(this.getFlagsPos().kUseVertexColor,u.useVertexColor),void 0!==o.alpha&&(u.alpha=o.alpha),l.setBitValue(this.getFlagsPos().kIsFrontClipped,t.getIsFrontClipped()?1:0),l.setBitValue(this.getFlagsPos().kIsBackClipped,t.getIsBackClipped()?1:0),e.getGl()),e=this.getUniformLocations(s);window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,c,o),s.uniform3f(e.color,u.color[0],u.color[1],u.color[2]),s.uniform1f(e.alpha,u.alpha),s.uniform1f(e.pointSize,u.pointSize),XeLineWeightModule.updateUniforms(s,e,d,t,i,r,n,o),this.m_LightsValid=!0,s.uniform1i(e.flags,l.getNumber())}updateAttributes(e,t){e=e.getGl(),t=t.attributes;XeLineWeightModule.updateAttributes(e,t),XeLineWeight3dModule.updateAttributes(e,t),XeRayLWModule.updateAttributes(e,t)}setupAttributes(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);XeLineWeightModule.setupAttributes(i,t,e,r),XeLineWeight3dModule.setupAttributes(i,t,e,r),XeRayLWModule.setupAttributes(i,t,e,r),e.disableUnusedAttributes()}}function wrapShaderCreation(e,t){try{return e()}catch(e){try{var i={shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,!1),type:XeShaderTypes.Common,instanced:!1};return window.XeLogger.error(t+" is unable to be compiled. It is replaced with XeDrawObjectCommon2d, apperance may change"),i}catch(e){throw window.XeLogger.error("Fatal error. Unable to compile XeDrawObjectCommon2d"),e}}}XeShaders.prototype.container.DrawObjectLineWeight_instanced.getGlVersion=function(e){return e.isAndroid||e.isVMWare?"#version 100\n":e.isWebGl2?"#version 300 es\n#define WEBGL2_300\n":""},XeShaders.prototype.container.DrawObjectLineWeight_instanced.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["viewDirVector","viewUpVector","isFrontClipped","isBackClipped","frontClipPlane","backClipPlane","calculatedStackMatrix","calculatedFullStackMatrix","order_nominator","order_denominator","order_base","uRenderMode","color","alpha","lwUnits","bEnableLinetype","isScaledToFit","plinegen","arcCircleType","patternArray","patternArraySize","ltRecordScale","bAlwaysShowLinetype","calculatedPatternLength","xeLTRecordPatternLength"])),this.m_uniform_locations},XeShaders.prototype.container.DrawObjectLineWeight_instanced.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["pointIndex","firstLengthCoord","lastLengthCoord","fullLengthCoord","lineVector","firstPoint","drawMode","fOrderValueInstanced"])),this.m_attribute_locations},XeShaders.prototype.container.DrawObjectLineWeight_instanced.invalidate=function(){this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d},XeShaders.prototype.container.DrawObjectLineWeight_instanced.activated=function(){this.invalidate(),this.m_bViewportValid=!1,this.m_bLinetypeValid=!1},XeShaders.prototype.container.DrawObjectLineWeight_instanced.updateUniforms=function(e,t,i,r,n,o,a,s,c){var l=i.getXeGsDevice(),d=window.xeGlGlobalUniformData,u=(d.reset(),e.renderMode===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW),u=(d.resolveTraits(t,i,r,n,u,s),d.get());o.color&&(u.color=o.color,u.useVertexColor=0),null!=o.alpha&&(u.alpha=o.alpha);let p=d.getLineweight(t,i,r),m,h;0<o.lwPx&&t&&(p+=window.XeLineweightUtils.GetLineWeightInUnitsFromPixels(t,o.lwPx)),n&&n.transform_base&&(m=n.transform_base.scale(),p/=m),i&&(h=i.getGeometryToModelMatrix().scale(),p/=h),u.useColorPickingColor=e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW?1:0,o.uniform_CPColor&&(e.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&(u.useColorPickingColor=2),u.uniform_CPColor=o.uniform_CPColor);s=e.getGl(),d=this.getUniformLocations(s);if(window.XeShaders.updateCommonMatrixUniforms.call(this,s,t,i,r,n,void 0,c,o),XeShaderDrawOrderModule.updateUniforms(s,d,u,l,t,i,n),s.uniform1i(d.uRenderMode,u.uRenderMode),s.uniform3f(d.color,u.color[0],u.color[1],u.color[2]),s.uniform1f(d.alpha,u.alpha),s.uniform1f(d.lwUnits,p),s.uniform1i(d.bEnableLinetype,u.bEnableLinetype),0<u.bEnableLinetype)s.uniform1i(d.isScaledToFit,u.isScaledToFit),s.uniform1i(d.plinegen,u.plinegen),s.uniform1i(d.arcCircleType,u.arcCircleType),s.uniform1fv(d.patternArray,u.patternArray),s.uniform1i(d.patternArraySize,u.patternArraySize),s.uniform1f(d.ltRecordScale,u.ltRecordScale),s.uniform1i(d.bAlwaysShowLinetype,u.bAlwaysShowLinetype),s.uniform1f(d.calculatedPatternLength,u.calculatedPatternLength),s.uniform1f(d.xeLTRecordPatternLength,u.xeLTRecordPatternLength);else{if(s.uniform1i(d.isScaledToFit,0),s.uniform1i(d.plinegen,9),s.uniform1i(d.arcCircleType,0),!this.m_fakePatternArray){this.m_fakePatternArray=new Float32Array(1e3);for(let e=0;e<1e3;e++)this.m_fakePatternArray[e]=1}s.uniform1fv(d.patternArray,this.m_fakePatternArray),s.uniform1i(d.patternArraySize,0),s.uniform1f(d.ltRecordScale,1),s.uniform1i(d.bAlwaysShowLinetype,0),s.uniform1f(d.calculatedPatternLength,1),s.uniform1f(d.xeLTRecordPatternLength,1)}},XeShaders.prototype.container.DrawObjectLineWeight_instanced.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.pointIndex&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.pointIndex),t.firstLengthCoord&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.firstLengthCoord),t.lastLengthCoord&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.lastLengthCoord),t.fullLengthCoord&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fullLengthCoord),t.lineVector&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.lineVector),t.firstPoint&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.firstPoint),t.drawMode&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.drawMode),t.fOrderValueInstanced&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fOrderValueInstanced)},XeShaders.prototype.container.DrawObjectLineWeight_instanced.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i),t=t.attributes;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.index.buffer),t.pointIndex?(i.bindBuffer(i.ARRAY_BUFFER,t.pointIndex.buffer),e.enableAttribute(r.pointIndex),i.vertexAttribPointer(r.pointIndex,1,i.FLOAT,!1,0,0)):i.vertexAttribf(r.pointIndex,0),t.firstLengthCoord?(i.bindBuffer(i.ARRAY_BUFFER,t.firstLengthCoord.buffer),e.enableDivisor(r.firstLengthCoord,1),i.vertexAttribPointer(r.firstLengthCoord,1,i.FLOAT,!1,0,0)):i.vertexAttribf(r.firstLengthCoord,0),t.lastLengthCoord?(i.bindBuffer(i.ARRAY_BUFFER,t.lastLengthCoord.buffer),e.enableDivisor(r.lastLengthCoord,1),i.vertexAttribPointer(r.lastLengthCoord,1,i.FLOAT,!1,0,0)):i.vertexAttribf(r.lastLengthCoord,0),t.fullLengthCoord?(i.bindBuffer(i.ARRAY_BUFFER,t.fullLengthCoord.buffer),e.enableDivisor(r.fullLengthCoord,1),i.vertexAttribPointer(r.fullLengthCoord,1,i.FLOAT,!1,0,0)):i.vertexAttribf(r.fullLengthCoord,0),t.lineVector?(i.bindBuffer(i.ARRAY_BUFFER,t.lineVector.buffer),e.enableDivisor(r.lineVector,1),i.vertexAttribPointer(r.lineVector,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.lineVector,new Float32Array(12)),t.firstPoint?(i.bindBuffer(i.ARRAY_BUFFER,t.firstPoint.buffer),e.enableDivisor(r.firstPoint,1),i.vertexAttribPointer(r.firstPoint,3,i.FLOAT,!1,0,0)):i.vertexAttrib3fv(r.firstPoint,new Float32Array(12)),t.drawMode?(i.bindBuffer(i.ARRAY_BUFFER,t.drawMode.buffer),e.enableDivisor(r.drawMode,1),i.vertexAttribPointer(r.drawMode,1,i.FLOAT,!1,0,0)):i.vertexAttribf(r.drawMode,0),t.fOrderValueInstanced?(i.bindBuffer(i.ARRAY_BUFFER,t.fOrderValueInstanced.buffer),e.enableDivisor(r.fOrderValueInstanced,1),i.vertexAttribPointer(r.fOrderValueInstanced,1,i.FLOAT,!1,0,0)):i.vertexAttribf(r.fOrderValueInstanced,0),e.disableUnusedAttributes()},XeShaders.prototype.container.PaperOptimized.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["projectionMatrix","viewingMatrix","order","color","alpha","useTexture","uTexture"])),this.m_uniform_locations},XeShaders.prototype.container.PaperOptimized.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","uv"])),this.m_attribute_locations},XeShaders.prototype.container.PaperOptimized.updateUniforms=function(e,t,i,r,n,o,a,s,c){var a=a.uniforms,l=e.getGl(),d=this.getUniformLocations(l);let u=t.viewingMatrix();u=u.mult(a.normlMatrix),l.uniformMatrix4fv(d.projectionMatrix,!1,t.worldToGLNormClippedProjMatrix().toGLArray()),l.uniformMatrix4fv(d.viewingMatrix,!1,u.toGLArray()),l.uniform3fv(d.color,a.color),l.uniform1f(d.alpha,a.alpha),l.uniform1f(d.order,1),l.uniform1i(d.useTexture,a.useTexture);t=e.getTextureUnit();l.uniform1i(d.uTexture,t),e.setTexture(a.uTexture,t)},XeShaders.prototype.container.PaperOptimized.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),t.uv&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.uv)},XeShaders.prototype.container.PaperOptimized.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.attributes.index.buffer),t.attributes.position&&(i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0)),t.attributes.uv&&(i.bindBuffer(i.ARRAY_BUFFER,t.attributes.uv.buffer),e.enableAttribute(r.uv),i.vertexAttribPointer(r.uv,2,i.FLOAT,!1,0,0)),e.disableUnusedAttributes()},XeShaders.prototype.container.SimpleDraw.activated=function(){},XeShaders.prototype.container.SimpleDraw.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["transformMatrix","transformMatrix2","order_nominator","order_denominator","order_base"])),this.m_uniform_locations},XeShaders.prototype.container.SimpleDraw.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","fOrderValue","vertexColor"])),this.m_attribute_locations},XeShaders.prototype.container.SimpleDraw.invalidate=function(){},XeShaders.prototype.container.SimpleDraw.updateUniforms=function(e,t,i,r,n,o,a,s,c){},XeShaders.prototype.container.SimpleDraw.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),t.fOrderValue&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.fOrderValue),t.vertexColor&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.vertexColor)},XeShaders.prototype.container.SimpleDraw.setupAttributes=function(e,t){},XeShaders.prototype.container.SimpleFramebufferShader.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["projectionMatrix","viewingMatrix","tTexture","tWidth","tHeight","tEnableAA"])),this.m_uniform_locations},XeShaders.prototype.container.SimpleFramebufferShader.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","uv"])),this.m_attribute_locations},XeShaders.prototype.container.SimpleFramebufferShader.updateUniforms=function(e,t,i,r,n,o,a,s,c){var a=a.uniforms,l=e.getGl(),d=this.getUniformLocations(l),t=(t?(l.uniformMatrix4fv(d.projectionMatrix,!1,t.worldToGLNormClippedProjMatrix().toGLArray()),l.uniformMatrix4fv(d.viewingMatrix,!1,t.viewingMatrix().toGLArray())):(l.uniformMatrix4fv(d.projectionMatrix,!(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),t),l.uniformMatrix4fv(d.viewingMatrix,!1,t)),e.getTextureUnit());l.uniform1i(d.tTexture,t),e.setTexture(a.tTexture,t),l.uniform1f(d.tWidth,a.tWidth),l.uniform1f(d.tHeight,a.tHeight),l.uniform1i(d.tEnableAA,window.GetXeTextureAA())},XeShaders.prototype.container.SimpleFramebufferShader.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),t.uv&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.uv)},XeShaders.prototype.container.SimpleFramebufferShader.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.uv.buffer),e.enableAttribute(r.uv),i.vertexAttribPointer(r.uv,2,i.FLOAT,!1,0,0),e.disableUnusedAttributes()},XeShaders.prototype.container.SimpleShader.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["calculatedFullStackMatrix","color","alpha"])),this.m_uniform_locations},XeShaders.prototype.container.SimpleShader.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position"])),this.m_attribute_locations},XeShaders.prototype.container.SimpleShader.invalidate=function(){this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d},XeShaders.prototype.container.SimpleShader.updateUniforms=function(e,t,i,r,n,o,a,s,c){var a=a.uniforms,e=e.getGl(),l=this.getUniformLocations(e);window.XeShaders.updateCommonMatrixUniforms.call(this,e,t,i,r,n),e.uniform3fv(l.color,a.color),e.uniform1f(l.alpha,a.alpha)},XeShaders.prototype.container.SimpleShader.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position)},XeShaders.prototype.container.SimpleShader.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0),e.disableUnusedAttributes()},XeShaders.prototype.container.SmallRectShader.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["projectionMatrix","viewingMatrix","color","alpha"])),this.m_uniform_locations},XeShaders.prototype.container.SmallRectShader.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position"])),this.m_attribute_locations},XeShaders.prototype.container.SmallRectShader.updateUniforms=function(e,t,i,r,n,o,a,s,c){var a=a.uniforms,e=e.getGl(),l=this.getUniformLocations(e);e.uniformMatrix4fv(l.projectionMatrix,!1,t.worldToGLNormClippedProjMatrix().toGLArray()),e.uniformMatrix4fv(l.viewingMatrix,!1,t.viewingMatrix().toGLArray()),e.uniform3fv(l.color,a.color),e.uniform1f(l.alpha,a.alpha)},XeShaders.prototype.container.SmallRectShader.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position)},XeShaders.prototype.container.SmallRectShader.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0),e.disableUnusedAttributes()},XeShaders.prototype.container.XeDbBackgroundImageOptimized.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["uTexture"])),this.m_uniform_locations},XeShaders.prototype.container.XeDbBackgroundImageOptimized.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","uv"])),this.m_attribute_locations},XeShaders.prototype.container.XeDbBackgroundImageOptimized.updateUniforms=function(e,t,i,r,n,o,a,s,c){var a=a.uniforms,l=e.getGl(),d=this.getUniformLocations(l),u=e.getTextureUnit();l.uniform1i(d.uTexture,u),e.setTexture(a.uTexture,u)},XeShaders.prototype.container.XeDbBackgroundImageOptimized.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),t.vertex_color&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.vertex_color)},XeShaders.prototype.container.XeDbBackgroundImageOptimized.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.uv.buffer),e.enableAttribute(r.uv),i.vertexAttribPointer(r.uv,2,i.FLOAT,!1,0,0),e.disableUnusedAttributes()},XeShaders.prototype.container.XeDbBackgroundOptimized.getUniformLocations=function(e){return this.m_uniform_locations||(this.m_uniform_locations=window.XeShaders.cacheUniformLocations(e,this.glprogram,["rotationMatrix"])),this.m_uniform_locations},XeShaders.prototype.container.XeDbBackgroundOptimized.getAttributeLocations=function(e){return this.m_attribute_locations||(this.m_attribute_locations=window.XeShaders.cacheAttributeLocations(e,this.glprogram,["position","vertex_color"])),this.m_attribute_locations},XeShaders.prototype.container.XeDbBackgroundOptimized.updateUniforms=function(e,t,i,r,n,o,a,s,c){var a=a.uniforms,e=e.getGl(),l=this.getUniformLocations(e);e.uniformMatrix4fv(l.rotationMatrix,!1,a.rotationMatrix.toGLArray())},XeShaders.prototype.container.XeDbBackgroundOptimized.updateAttributes=function(e,t){e=e.getGl(),t=t.attributes;t.index&&window.XeShaders.initAttribute(e,e.ELEMENT_ARRAY_BUFFER,t.index),t.position&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.position),t.vertex_color&&window.XeShaders.initAttribute(e,e.ARRAY_BUFFER,t.vertex_color)},XeShaders.prototype.container.XeDbBackgroundOptimized.setupAttributes=function(e,t){var i=e.getGl(),e=e.getGlState(),r=this.getAttributeLocations(i);i.bindBuffer(i.ARRAY_BUFFER,t.attributes.position.buffer),e.enableAttribute(r.position),i.vertexAttribPointer(r.position,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t.attributes.vertex_color.buffer),e.enableAttribute(r.vertex_color),i.vertexAttribPointer(r.vertex_color,3,i.FLOAT,!1,0,0),e.disableUnusedAttributes()},XeShaders.prototype.count=0,XeShaders.prototype.applyDefines=function(){var t,i=window.XeUtils.WEB_RENDERER_PARAMS,r=this.container;for(t in r)if(r.hasOwnProperty(t)){var n=r[t];n.id=++this.count;let e="";n.getGlVersion?e+=n.getGlVersion(window.XeUtils.WEB_RENDERER_PARAMS):(i.isAndroid||i.isVMWare)&&(e+="#version 100\n"),(i.isMediump||i.isAndroid||i.isVMWare)&&(e+="#define USE_mediump\n"),i.isAndroid&&(e+="#define USE_uniform_lwUnits\n"),i.OES_standard_derivatives&&(e+="#define OES_standard_derivatives_supported\n"),i.isWebGl2&&(e+="#define WEBGL2\n"),e+="#define iMAX_LINETYPE_ARRAY_COUNT "+this.iMAX_LINETYPE_ARRAY_COUNT()+"\n",n.vert=e+n.vert,n.frag=e+n.frag}},XeShaders.prototype.iMAX_LINETYPE_ARRAY_COUNT=function(){return 24},XeShaders.prototype.cacheUniformLocations=function(t,i,r){var n={};for(let e=0;e<r.length;e++){var o=r[e];n[o]=t.getUniformLocation(i,o)}return n},XeShaders.prototype.cacheAttributeLocations=function(t,i,r){var n={};for(let e=0;e<r.length;e++){var o=r[e];n[o]=t.getAttribLocation(i,o)}return n},XeShaders.prototype.init=function(e){var t,i=this.container;for(t in i)if(i.hasOwnProperty(t)&&!i[t].isPlaceholderShader)try{i[t]=XeShaderCommonProgram.CreateProgram(e,i[t],t,void 0)}catch(e){try{i[t]=XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,!1),window.XeLogger.error(t+" is unable to be compiled. It is replaced with XeDrawObjectCommon2d, apperance may change")}catch(e){window.XeLogger.error("Fatal error. Unable to compile XeDrawObjectCommon2d")}}},XeShaders.prototype.ClearGLCache=function(e){var t,i,r=e||XeWebGlRenderer.prototype.global_gl_context,n=this.container;for(t in n)n.hasOwnProperty(t)&&((i=n[t]).glprogram&&(r.deleteProgram(i.glprogram),delete i.glprogram),delete i.m_uniform_locations,delete i.m_attribute_locations)},XeShaders.prototype.initAttribute=function(e,t,i){i&&i.array&&(i.buffer?i.needsUpdate&&!i.deleteArray&&(e.bindBuffer(t,i.buffer),e.bufferSubData(t,0,i.array),i.needsUpdate=!1):(i.buffer=e.createBuffer(),e.bindBuffer(t,i.buffer),e.bufferData(t,i.array,e.STATIC_DRAW),i.needsUpdate=!1),i.deleteArray)&&i.array&&delete i.array},XeShaders.prototype.isMatrixEqualToMatrix=function(e,t,i){var r=i;let n;for(var o=0;o<4;o+=1)for(var a=0;a<4;a+=1)if(Math.abs(t.entry[o][a]-e.entry[o][a])>r)return n=!1;return n=!0},XeShaders.prototype.updateCommonMatrixUniforms=function(e,t,i,r,n,o,a){let s=this.getUniformLocations(e),c=0,l=[1,1],d=[0,0,1],u=[0,1,0],p=0,m=0,h=[0,0,0,0],g=[0,0,0,0];t&&(c=t.getPerspective()?1:0,d=t.getViewDir(),u=t.getUpVector(),w=t.visibleScreenRect())&&(Math.floor(w.xmin),Math.floor(w.ymin),v=Math.floor(w.xmax)-Math.floor(w.xmin),w=Math.floor(w.ymax)-Math.floor(w.ymin),l=[v,w]);let y,f,_;i&&(_=i.getGeometryToModelMatrix()),t&&(y=t.worldToGLNormClippedProjMatrix(),f=t.viewingMatrix(),v=new GeNeo.OdGeVector3d,t.getIsFrontClipped()&&(w=t.getFrontClipped(),p=1,v.x=-d[0],v.y=-d[1],v.z=-d[2],v.transformBy(f),(h=[])[0]=v.x,h[1]=v.y,h[2]=v.z,h[3]=w),t.getIsBackClipped())&&(i=t.getBackClipped(),m=1,v.x=d[0],v.y=d[1],v.z=d[2],v.transformBy(f),(g=[])[0]=v.x,g[1]=v.y,g[2]=v.z,g[3]=-i),y=y||new GeNeo.OdGeMatrix3d,f=f||new GeNeo.OdGeMatrix3d,_=_||new GeNeo.OdGeMatrix3d;var w=new GeNeo.OdGeMatrix3d,v=(a&&a.itemTransformationMatrix?(w.setToProduct(a.itemTransformationMatrix,w),s.itemMatrixScale&&e.uniform1f(s.itemMatrixScale,a.itemTransformationMatrix.scale())):s.itemMatrixScale&&e.uniform1f(s.itemMatrixScale,1),w.setToProduct(_,w),n&&(t=n.transform_base,w.setToProduct(t,w)),w.setToProduct(f,w),new GeNeo.OdGeMatrix3d);v.setToProduct(y,w),this.m_old_calculatedFullStackMatrix||(this.m_old_calculatedFullStackMatrix=new GeNeo.OdGeMatrix3d),window.XeShaders.isMatrixEqualToMatrix(v,this.m_old_calculatedFullStackMatrix,GeNeo.equalVector())||(this.m_old_calculatedFullStackMatrix=v,s.projectionMatrix&&e.uniformMatrix4fv(s.projectionMatrix,!1,y.toGLArray()),s.viewingMatrix&&e.uniformMatrix4fv(s.viewingMatrix,!1,f.toGLArray()),s.calculatedStackMatrix&&e.uniformMatrix4fv(s.calculatedStackMatrix,!1,w.toGLArray()),s.calculatedFullStackMatrix&&e.uniformMatrix4fv(s.calculatedFullStackMatrix,!1,v.toGLArray()),s.inversecalculatedFullStackMatrix&&(i=v.inverse(),e.uniformMatrix4fv(s.inversecalculatedFullStackMatrix,!1,i.toGLArray())),s.isPerspective&&e.uniform1i(s.isPerspective,c),s.screenResolution&&e.uniform2fv(s.screenResolution,l),s.isFrontClipped&&e.uniform1i(s.isFrontClipped,p),s.isBackClipped&&e.uniform1i(s.isBackClipped,m),s.frontClipPlane&&e.uniform4f(s.frontClipPlane,h[0],h[1],h[2],h[3]),s.backClipPlane&&e.uniform4f(s.backClipPlane,g[0],g[1],g[2],g[3]),s.viewDirVector&&e.uniform3f(s.viewDirVector,d[0],d[1],d[2]),s.viewUpVector&&e.uniform3f(s.viewUpVector,u[0],u[1],u[2])),s.projectionMatrix&&(o.gl_unif_mem_used+=64),s.viewingMatrix&&(o.gl_unif_mem_used+=64)},XeShaders.prototype.createShaderFromPlaceholder=function(e,t,i,r,n){if(this.container[i]&&this.container[i].isPlaceholderShader)return i=new t((t=this.container[i]).vert,t.frag),this.container[r]=XeShaderCommonProgram.CreateProgram(e,i,r,n),this.container[r];throw new Error("No such shader is presented")},XeShaders.prototype.invalidate=function(){for(var e in this.container)"invalidate"in this.container[e]&&this.container[e].invalidate()},XeShaders.prototype.GetRightShader=function(e,t,i,r,n,o){switch(e){case WebGLRenderingContext.LINES:case WebGLRenderingContext.LINE_STRIP:case WebGLRenderingContext.LINE_LOOP:return this.GetRightShaderForLines(t,i,r,n,o);default:return this.GetRightShaderForTriangles(t,i,r,n,o)}},XeShaders.prototype.shaderMap=new Map,XeShaders.prototype.GetRightShaderForTriangles=function(t,e,i,r,n){var o=t.getRenderMode(),a=t.getHasNormal(),n=n.renderMode==XeWebDrawerEngine.prototype.RENDERER_CP_VIEW;let s="IS"==t.getType(),c=XeShader3dPrograms.getRenderModeKey(o,a,n);a=XeShaderTraits.instance,a.addByteTraits(o),a.addByteTraits(c),a.addFlagTraits(s),n=a.key;if(t.getShaderKey()===n)return t.getShader();if(this.shaderMap.has(n))return t.setShaderKey(n),t.setShader(this.shaderMap.get(n)),t.getShader();{let e;return e=o==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?{shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,s),type:XeShaderTypes.Common,instanced:!1}:wrapShaderCreation(()=>({shader:XeShader3dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,c,!1,s),type:XeShaderTypes.Common,instanced:!1}),"XeShader3dPrograms"),t.setShaderKey(n),t.setShader(e),this.shaderMap.set(n,e),e}},XeShaders.prototype.GetRightShaderForLines=function(e,r,n,t,o){let a="IS"==e.getType();if(a)return this.GetRightShaderForRays(e,r,n,t,o);var r=e.getRenderMode(),n=e.hasLinetype(),s=e.getLinetypeTableRecordHandle(),c=e.getPlineGen(),l=e.getArcType();let d=XeWebDrawerEngine.prototype.bDrawInstancedLineweight&&!!t&&t.bDrawLineweightLine;t=e.getHasNormal(),o=o.renderMode==XeWebDrawerEngine.prototype.RENDERER_CP_VIEW;let u=t?XeShader3dPrograms.getRenderModeKey(r,t,o):XeShader3dProgramsModes.no_lighting;t=XeShaderTraits.instance,t.addByteTraits(r),t.addByteTraits(u),t.addFlagTraits(a),t.addFlagTraits(d),t.addFlagTraits(n),t.addFlagTraits(!0),t.addFlagTraits(c),t.addByteTraits(l),o=t.key;if(e.getShaderKey()===o){if(!n)return e.getShader();if(e.getLTShaderKey()===s)return e.getShader()}if(this.shaderMap.has(o)){if(!n)return e.setShaderKey(o),e.setShader(this.shaderMap.get(o)),e.getShader();t=this.shaderMap.get(o);if(t&&t.has(s))return e.setShaderKey(o),e.setLTShaderKey(s),e.setShader(t.get(s)),e.getShader()}{let t;n&&(t=e.getLinetypeTableRecord());let i;if(d||n||(i=r==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?{shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,d,a),type:XeShaderTypes.Common,instanced:!1}:wrapShaderCreation(()=>({shader:XeShader3dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,u,d,a),type:XeShaderTypes.Common,instanced:!1}),"XeShader3dPrograms")),!d&&n){let e={mode:"2d",isLw:!1,isDynamicLinetype:!0,arcCircleType:l,isPLINEGEN:c,renderModeKey:u,isRay:a};i=r==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?wrapShaderCreation(()=>({shader:XeGLLinetypesProgram.getProgram(XeWebGlRenderer.prototype.global_gl_context,t,e),type:XeShaderTypes.Linetype,instanced:!1}),"XeGLLinetypesProgram 2d"):(e.mode="3d",wrapShaderCreation(()=>({shader:XeGLLinetypesProgram.getProgram(XeWebGlRenderer.prototype.global_gl_context,t,e),type:XeShaderTypes.Linetype,instanced:!1}),"XeGLLinetypesProgram 3d"))}if(d&&!n&&(i=r==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?wrapShaderCreation(()=>({shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,d,a),type:XeShaderTypes.LineWeight,instanced:!0,instanceType:XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]}),"XeShader2dPrograms 2d LW"):wrapShaderCreation(()=>({shader:XeShader3dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,u,!0,a),type:XeShaderTypes.LineWeight,instanced:!0,instanceType:XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]}),"XeShader2dPrograms 3d LW")),d&&n){let e={mode:"2d",isLw:!0,isDynamicLinetype:!0,arcCircleType:l,isPLINEGEN:c,renderModeKey:u,isRay:a};i=r==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?wrapShaderCreation(()=>({shader:XeGLLinetypesProgram.getProgram(XeWebGlRenderer.prototype.global_gl_context,t,e),type:XeShaderTypes.LineTypeWeight,instanced:!0,instanceType:XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]}),"XeGLLinetypesProgram 2d LW"):(e.mode="3d",wrapShaderCreation(()=>({shader:XeGLLinetypesProgram.getProgram(XeWebGlRenderer.prototype.global_gl_context,t,e),type:XeShaderTypes.LineTypeWeight,instanced:!0,instanceType:XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]}),"XeGLLinetypesProgram 3d LW"))}return n?(e.setShaderKey(o),e.setLTShaderKey(s),this.shaderMap.has(o)||this.shaderMap.set(o,new Map),this.shaderMap.get(o).set(s,i)):(e.setShaderKey(o),this.shaderMap.set(o,i)),e.setShader(i),i}},XeShaders.prototype.GetRightShaderForRays=function(t,e,i,r,n){var o=t.getRenderMode();n.renderMode,XeWebDrawerEngine.prototype.RENDERER_CP_VIEW;let a=XeWebDrawerEngine.prototype.bDrawInstancedLineweight&&!!r&&r.bDrawLineweightLine,s=XeShader3dProgramsModes.no_lighting;n=XeShaderTraits.instance,n.addByteTraits(o),n.addByteTraits(s),n.addFlagTraits(!0),n.addFlagTraits(a),r=n.key;if(t.getShaderKey()===r)return t.getShader();if(this.shaderMap.has(r))return t.setShaderKey(r),t.setShader(this.shaderMap.get(r)),t.getShader();{let e;return e=a?o==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?wrapShaderCreation(()=>({shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,a,!0),type:XeShaderTypes.LineWeight,instanced:!0,instanceType:XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]}),"XeShader2dPrograms 2d LW  Ray"):wrapShaderCreation(()=>({shader:XeShader3dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,s,!0,!0),type:XeShaderTypes.LineWeight,instanced:!0,instanceType:XeShaderInstanceTypes["8_TRIANGLE_STRIPS"]}),"XeShader3dPrograms 3d LW Ray"):o==XeGsViewport.prototype.RenderModeEnum.k2DOptimized?{shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,a,!0),type:XeShaderTypes.Common,instanced:!1}:wrapShaderCreation(()=>({shader:XeShader3dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,s,a,!0),type:XeShaderTypes.Common,instanced:!1}),"XeShader3dPrograms 3d Ray"),t.setShaderKey(r),t.setShader(e),this.shaderMap.set(r,e),e}},XeShaders.prototype.getInclude=function(e){e=e.replace(".incl.glsl","");return this.XeIncludes[e]};class XeShaderTraitsImpl{constructor(){this.mapKey=new Uint32Array(1),this.reset()}reset(){this.mapKey[0]=0,this.pos=32}addFlagTraits(e){this.pos--,console.assert(-1<this.pos,"traits overflow"),this.mapKey[0]=this.mapKey[0]|(e?1:0)<<this.pos}addByteTraits(e){this.pos-=8,console.assert(-1<this.pos,"traits overflow"),console.assert(e<256,"byte overflow"),this.mapKey[0]=this.mapKey[0]|(255&e)<<this.pos}get key(){return this.mapKey[0]}}class XeShaderTraits{static m_TraitsStorage=new XeShaderTraitsImpl;static get instance(){return this.m_TraitsStorage.reset(),this.m_TraitsStorage}}let XeShaderTypes={Common:0,Linetype:1,LineWeight:2,LineTypeWeight:3},XeShaderInstanceTypes={"8_TRIANGLE_STRIPS":0};(X=>{X.isPointInside=function(e,i){var r=e[0],n=e[1];let o=!1;for(let e=0,t=i.length-1;e<i.length;t=e++){var a=i[e][0],s=i[e][1],c=i[t][0],l=i[t][1];n<s!=n<l&&r<(c-a)*(n-s)/(l-s)+a&&(o=!o)}return o},X.isCircleLineIntersection=function(e,t){var i,r,n,o,a,s,c;return e={p1:{x:e.x1,y:e.y1},p2:{x:e.x2,y:e.y2}},t={center:{x:t.x,y:t.y},radius:t.r},c={},(s={}).x=e.p2.x-e.p1.x,s.y=e.p2.y-e.p1.y,c.x=e.p1.x-t.center.x,c.y=e.p1.y-t.center.y,r=s.x*c.x+s.y*c.y,i=2*(s.x*s.x+s.y*s.y),r*=-2,c=Math.sqrt(r*r-2*i*(c.x*c.x+c.y*c.y-t.radius*t.radius)),isNaN(c)?[]:(t=(r+c)/i,o={},a={},n=[],(r=(r-c)/i)<=1&&0<=r&&(o.x=e.p1.x+s.x*r,o.y=e.p1.y+s.y*r,n[0]=o),t<=1&&0<=t&&(a.x=e.p1.x+s.x*t,a.y=e.p1.y+s.y*t,n[n.length]=a),n)},X.getPen=function(e){let t;if(X.__decorator&&X.__decorator.color)return t=X.__decorator.color;var i=window.getXeActiveDocument().getXeGsDevice(),r=i.getPalette().getPalette(),n=new OdCmEntityColor;n.m_RGBM=e;let o;return n.isByLayer()||n.isByBlock()?o=i.getForeground():n.isByColor()?o=n.red()+(n.green()<<8)+(n.blue()<<16):n.isByACI()?(e=n.colorIndex(),o=e>=r.length?(window._LOG_GLOBAL.SHOW("SHOW_ERRORS","ERROR ! --- >> wrong palette index !!!"),0):r[e]):n.isForeground()?(o=r[7],n||(o=0)):o=(n.isNone()||console.error("ODA_ASSERT(0);"),0),t=window.IsOsVersion()?window.XeUtils.intRGBToHex(o):X.__drawCtx.strokeStyle},X.DrawPoint=function(e,t){var i=X.__drawCtx,r=X.__XeViewport;i&&r&&(t=X.getPen(t),r=r.PointToSCS(e[0],e[1],e[2]),i.setLineDash([]),i.strokeStyle=t,i.fillRect(r[0],r[1],1,1))},X.DrawLine=function(e,t,i,r){var n,o=X.__drawCtx;o&&(n=X.__XeViewport)&&(r=X.getPen(r),window.IsOsVersion()?o.lineWidth=X._getLwPx(n,i):o.lineWidth=X.__decorator.dimvars.LineWeight,i=n.PointToSCS(e[0],e[1],e[2]),e=n.PointToSCS(t[0],t[1],t[2]),o.setLineDash([]),o.strokeStyle=r,o.beginPath(),o.moveTo(i[0],i[1]),o.lineTo(e[0],e[1]),o.stroke())},X.DrawArc=function(t,i,r,n,o,a){var s=X.__drawCtx,c=X.__XeViewport;if(s&&c){var s=X.getPen(a),a=new GeNeo.OdGePoint3d,l=new GeNeo.OdGeVector3d,d=new GeNeo.OdGeVector3d,c=(window.getXeActiveDocument().getXeInputPointManager().GetWorkingPlaneCoordSystem(c,a,l,d),t),a=i,i=r,r=n,n=o,o=l.crossProduct(d).normalize();let e=r-i;d=2*Math.PI,r=(e<0?e+=d:e>d&&(e=d),l.rotateBy(i,o),t=[c.x,c.y,c.z],[o.x,o.y,o.z]),d=[l.x,l.y,l.z];X.ADD_ARC_impl(t,r,d,e,a,n,s)}},X.DrawArcVec=function(e,t,i,r,n,o,a){X.__drawCtx&&X.__XeViewport&&(a=X.getPen(a),X.ADD_ARC_impl(e,i,r,n,t,o,a))},X.DrawCircle=function(e,t,i,r,n){X.__drawCtx&&X.__XeViewport&&(n=X.getPen(n),X.ADD_CIRCLE_impl(e,i,t,r,n))},X.DrawSolid=function(t,e){var i=X.__drawCtx,r=X.__XeViewport;if(i&&r){var e=this.getPen(e),n=(i.setLineDash([]),i.strokeStyle=e,i.fillStyle=e,i.beginPath(),t[0]),o=r.PointToSCS(n.x,n.y,n.z);i.moveTo(o[0],o[1]);for(let e=1;e<t.length;e++)n=t[e],o=r.PointToSCS(n.x,n.y,n.z),i.lineTo(o[0],o[1]),i.stroke();i.closePath(),i.fill()}},X.DrawTextBox=function(t,e,i,r){if(void 0===X.bADD_BOUNDARY_BOX&&(X.bADD_BOUNDARY_BOX=!0),X.bADD_BOUNDARY_BOX||e){var n=X.__drawCtx,o=X.__XeViewport;if(n&&o){var e=this.getPen(r),a=(n.setLineDash([]),n.strokeStyle=e,n.fillStyle=e,n.lineWidth=X._getLwPx(o,i),n.beginPath(),t[0]),s=o.PointToSCS(a.x,a.y,a.z);n.moveTo(s[0],s[1]);for(let e=1;e<t.length;e++)a=t[e],s=o.PointToSCS(a.x,a.y,a.z),n.lineTo(s[0],s[1]);n.closePath(),n.stroke()}}},X.DrawText=function(e,i,r){var n=X.__actual_dim_tracker,o=X.__actual_dim_tracker_name;if(n&&o){X.bADD_BOUNDARY_BOX=!0;var a=window.getXeActiveDocument().getXeGsDevice(),s=(a.getChunks(),X.__drawCtx),c=X.__XeViewport;let t=this.getPen(r);var r=n.dim,l=r.m_dimlwd,d=e,u=i,p=a.getChunkCache().trackers.array,m=DimensionTracker.prototype._drawXeGlDrawObjectMap[o]=[];for(let e=0;e<p.length;e++){var h=p[e].chunk;if(h.isDrawAllowed(c)){var g=h.getTrackerName()?h.getTrackerName():"";if(g.length&&g===o){let e=new GeNeo.OdGeMatrix3d;e.setTranslation(d.asVector()),e=e.mult(h.getGeometryToModelMatrix());g=new GeNeo.OdGeMatrix3d,g=(g.setToRotation(GeNeo.OdGeVector3d.kXAxis.angleTo(u,GeNeo.OdGeVector3d.kZAxis),GeNeo.OdGeVector3d.kZAxis,d),e=g.mult(e),h.getLayerObject());if(g&&!g.getOff()&&!g.getFrozen()){var y=h.getItems();if(y&&y.length){var f,_,w=new XeGsIntermediateSimplificationContainer;for(let e=0;e<y.length;e++){var v,C=y[e];C&&(v=a.getDeviation(c.getVpNum()),C.process_points(v,w))}for([f,_]of w.assembleDrawObjects(h))m.push({buffer:f,matrix:e,pen:t})}else{g=h.getGLDrawObject();g&&m.push({buffer:g,matrix:e,pen:t})}}}}}if(m.length)for(let t=0;t<m.length;t++){var T=m[t].buffer,b=m[t].matrix;let e=m[t].pen;T&&b&&X._drawXeGlObject(s,c,b,T,l,e)&&(X.bADD_BOUNDARY_BOX=!1)}window.IsOsVersion()||(s.fillStyle=t)}},X.ADD_ARC_impl=function(e,t,i,r,n,o,a){var s,c,l=X.__drawCtx,d=X.__XeViewport;l&&d&&(s=window.getXeActiveDocument().getXeGsDevice(),(c=new XeGsArcItem).m_d=[null,0,e[0],e[1],e[2],t[0],t[1],t[2],i[0],i[1],i[2],n,r],e=new XeGiSimplifier(d),t=new XeGsIntermediateSimplificationContainer,i=s.getDeviation(d.getVpNum()),e.process_arc(c,i,t),n={geometry:{attributes:{index:{array:t.linesArray[0].storage.indices.fittedArray},position:{array:t.linesArray[0].storage.vertices.fittedArray}}}},X._drawLSXeGlObject(l,d,null,n,o,a))},X.ADD_CIRCLE_impl=function(e,t,i,r,n){var o,a,s=X.__drawCtx,c=X.__XeViewport;s&&c&&(a=window.getXeActiveDocument().getXeGsDevice(),(o=new XeGsCircleItem).m_d=[null,0,e[0],e[1],e[2],i,0,0,0,i,0],e=new XeGiSimplifier(c),i=new XeGsIntermediateSimplificationContainer,a=a.getDeviation(c.getVpNum()),e.process_circle(o,a,i),e={geometry:{attributes:{index:{array:i.linesArray[0].storage.indices.fittedArray},position:{array:i.linesArray[0].storage.vertices.fittedArray}}}},X._drawLSXeGlObject(s,c,null,e,r,n))},X._getLwPx=function(i,r){if(window.IsOsVersion()){var n=r,o=i;let e=0;return o&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&window.getXeActiveDocument().getXeGsDevice().getOverallViewport()?((e=window.XeLineweightUtils.GetLineWeightInPixels(o,n))<1&&(e=1),1<(e=Math.round(e))&&1==(1&e)&&e++):e=window.XeLineweightUtils.getStndLineWeightPxSize(n,!0),X.__decorator)&&(e+=X.__decorator.additionalLwPx||0),e}{o=r;let t=1;if(i&&o){n=i.getXeGsDevice();if(n){r=n.getXeDocument()?.getXeDatabase();if(r&&r.getLWDISPLAY()){if(n.getOverallViewport()){n=n.getUnitsPerMM();let e=i.getCustomScale();var a=i.getPixelSize();i.m_Overall&&(e=1),t=o/100*n/e/a}else-1==(t=window.XeLineweightUtils.getStndLineWeightPxSize(o)*r.getLWDISPSCALE())&&(t=1);X.__decorator&&(t+=X.__decorator.additionalLwPx||0)}}}return t}},X._drawXeGlObject=function(e,t,i,r,n,o){return r.xegltype==XeGLDrawObjectGlType.LINES?(X._drawLSXeGlObject(e,t,i,r,n,o),!0):r.xegltype==XeGLDrawObjectGlType.TRIANGLES&&(X._drawTSXeGlObject(e,t,i,r,o),!0)},X._drawLSXeGlObject=function(e,t,i,r,n,o){var a=e,s=t,e=r;if(a&&s&&e){var c=[0,0],l=[0,0],d=new GeNeo.OdGePoint3d,u=new GeNeo.OdGePoint3d,p=e.geometry.attributes.index.array,m=e.geometry.attributes.position.array,t=o||window.XeUtils.intRGBToHex(window.getXeActiveDocument().getXeGsDevice().getForeground());a.setLineDash([]),a.strokeStyle=t,a.fillStyle=t,a.lineWidth=X._getLwPx(s,n),a.lineJoin="round",a.lineCap="round",a.beginPath();for(let e=0;e<p.length&&!(e>p.length-1||e+1>p.length-1);e+=2){var h=p[e];h<=0||(d.set(m[3*h],m[3*h+1],m[3*h+2]),(h=p[e+1])<=0)||(u.set(m[3*h],m[3*h+1],m[3*h+2]),h=d.isEqualTo(u),i&&(d.transformBy(i),u.transformBy(i)),s.PointToSCSFast(c,d.x,d.y,d.z),s.PointToSCSFast(l,u.x,u.y,u.z),h&&(l[0]+=1,l[1]+=1),a.moveTo(c[0],c[1]),a.lineTo(l[0],l[1]))}a.stroke()}},X._drawTSXeGlObject=function(e,t,i,r,n){var o=e,a=t,e=r;if(o&&a&&e){var s=[0,0],c=[0,0],l=[0,0],d=new GeNeo.OdGePoint3d,u=new GeNeo.OdGePoint3d,p=new GeNeo.OdGePoint3d,m=e.geometry.attributes.index.array,h=e.geometry.attributes.position.array,t=n||window.XeUtils.intRGBToHex(window.getXeActiveDocument().getXeGsDevice().getForeground());o.setLineDash([]),o.strokeStyle=t,o.fillStyle=t,o.lineWidth=1,o.lineJoin="round";for(let e=0;e<m.length&&!(e>m.length-1||e+1>m.length-1||e+2>m.length-1);e+=3){var g=m[e];g<=0||(d.set(h[3*g],h[3*g+1],h[3*g+2]),(g=m[e+1])<=0)||(u.set(h[3*g],h[3*g+1],h[3*g+2]),(g=m[e+2])<=0)||(p.set(h[3*g],h[3*g+1],h[3*g+2]),i&&(d.transformBy(i),u.transformBy(i),p.transformBy(i)),a.PointToSCSFast(s,d.x,d.y,d.z),a.PointToSCSFast(c,u.x,u.y,u.z),a.PointToSCSFast(l,p.x,p.y,p.z),d.isEqualTo(u)&&(c[0]+=1,c[1]+=1),u.isEqualTo(p)&&(--c[0],c[1]+=1),d.isEqualTo(p)&&(c[0]+=1,--c[1]),o.beginPath(),o.moveTo(s[0],s[1]),o.lineTo(c[0],c[1]),o.lineTo(l[0],l[1]),o.lineTo(s[0],s[1]),o.closePath(),o.fill(),o.stroke())}}},X.SET_DRAWCONTEXT=function(e,t,i){X.__drawCtx=e,X.__XeViewport=t,X.__decorator=i},X.SET_ACTUAL_DIMTRACKER=function(e,t){X.__actual_dim_tracker=t,X.__actual_dim_tracker_name=e},X.SET_TEXT_WH=function(e,t){X.__textWidth=e,X.__textHeight=t},X.MTEXT_WIDTH=function(){return X.__textWidth},X.MTEXT_HEIGHT=function(){return X.__textHeight},X.GET_DEVIATION=function(){var e=window.getXeActiveDocument().getXeGsDevice(),t=X.__XeViewport;return e.getDeviation(t.getVpNum())}})(window.RecomputeDimBlock||(window.RecomputeDimBlock={})),XeBlockReference.prototype.getClass=function(){return"AcDbBlockReference"},XeBlockReference.prototype.getGrips=function(){if(!this.HasCustomGrips())return XeEntity.prototype.getGrips.call(this);var e,t=[];for(e of this.GetCustomGrips())t.push(e.GripPoint());return t},XeBlocks.prototype.getByHandle=function(e){return this["m_"+e]},XeCentermark.prototype.getClass=function(){return"OnshapeCenterMark"},XeCircle.prototype.getGrips=function(){if(!(this.m_Grips&&0<this.m_Grips.length)){var e,t=this.getXeDocument().getXeGsDevice(),i=(t.getXeGsViewports(),t.getChunks()),r=(this.m_Grips=[],this.getXeGsOffsets());for(e in r){var n=i[e],o=r[e];if(n)for(let e=0;e<o.length;e++){var a=o[e].o;n instanceof XeGsSimpleChunk&&(a=n.m_Items[a])&&(this.m_Grips=this.m_Grips.concat(a.getGrips()))}}}return this.m_Grips},XeCircle.prototype.getClass=function(){return"AcDbCircle"},XeCommandProcessor.prototype.Flags={kModal:0,kTransparent:1,kUsePickset:2,kRedraw:4,kNoPerspective:8,kNoMultiple:16,kNoTilemode:32,kNoPaperspace:64,kPlotOnly:128,kNoOEM:256,kUndefined:512,kInProgress:1024,kDefun:2048,kNoNewStack:65536,kNoInternalLock:131072,kDocReadLock:524288,kDocExclusiveLock:1048576,kSession:2097152,kInterruptible:4194304,kNoHistory:8388608,kNoUndoMarker:16777216,kNoBedit:33554432,kNoSelectionSetModifications:67108864,kViewOperation:134217728,kHidden:268435456,kDisabledInRefedit:536870912,kApplicationContext:1073741824,kExecuteStartup:2147483648,kHiddenHistory:262144,kDisabledInActionRecording:4096,kNoPromptWidget:8192,kNoCommandOutput:16384,kUseHoverSelection:32768},XeCommandProcessor.prototype.getXeDocument=function(){return this.m_MyParent},XeDatabase.prototype.getXeDocument=function(){return this.m_MyParent},XeDatabase.prototype.getXeDatabase=function(){return this},XeDatabase.prototype.MyAddress=function(){return this.getXeDocument().MyAddress()+".m_XeDatabase"},XeDatabase.prototype.setCURSORMODE=function(e){this.m_CURSORMODE=e},XeDatabase.prototype.FinalConstruct=function(){null==this.m_XeEntities&&(this.m_XeEntities=new XeEntities(this))},XeDatabase.prototype.EmitSysVarChanged=function(e){var t=document.createEvent("Event");t.initEvent("SysVarChanged",!0,!0),t.m_Item=this,t.m_Data=e,document.dispatchEvent(t)},window.addEventListener("unload",function(){window.XeLogger.log("Unload"),window.getXeApplication().StopGLProcessing()},!1),document.addEventListener("PreUpdate_XeGsGeometryChunks",function(e){e.m_Item.getXeDocument().m_bWaitUntilLastChunk=!0}),document.addEventListener("Update_XeGsGeometryChunks",function(e){e.m_Item.getXeDocument().m_bWaitUntilLastChunk=!0}),document.addEventListener("PreUpdate_XeEntities",function(e){e.m_Item.getXeDocument().m_bWaitUntilLastEntity=!0}),document.addEventListener("Update_XeEntities",function(e){e.m_Item.getXeDocument().m_bWaitUntilLastEntity=!0}),document.addEventListener("XeWidget_Create",function(e){e.m_id===window.getXeApplication().getXeUI().getProperties().getId()&&window.getXeApplication().getXeUI().OnPropertiesWidgetCreated()}),document.addEventListener("XeWidget_Destroy",function(e){e.m_id===window.getXeApplication().getXeUI().getProperties().getId()&&window.getXeApplication().getXeUI().OnPropertiesWidgetDestroyed()}),document.addEventListener("XeWidget_Update",function(e){e.m_id===window.getXeApplication().getXeUI().getProperties().getId()&&window.getXeApplication().getXeUI().OnPropertiesWidgetUpdated()}),document.addEventListener("XeCommandProcessor",function(e){window.getXeActiveDocument()&&window.getXeActiveDocument().setLastCommand(e.m_Item)}),document.addEventListener("XeDocument_Activated",function(e){}),document.addEventListener("XeDocument_Deactivated",function(e){var t=window.getXeApplication().getGLContext();e.m_Item.ClearGLCache(t)}),XeDocument.prototype.Fire_ClientStateUpdated=function(e,t){var i=document.createEvent("Event");i.initEvent("XeClientStateUpdated",!0,!0),i.m_Item=this,i.m_remainingChunks=e,i.m_remainingEntities=t,document.dispatchEvent(i),!0===this.m_bWaitUntilLastChunk&&0===e&&(this.m_bWaitUntilLastChunk=!1,this.getXeGsDevice().FireLastChunkSent()),!0===this.m_bWaitUntilLastEntity&&0===t&&(this.m_bWaitUntilLastEntity=!1,this.getXeGsDevice().FireLastEntitySent())},XeDocument.prototype.FinalConstruct=function(){this.m_XeTrackers||(this.m_XeTrackers=new XeTrackers(this)),this.m_XeGsDevice||(this.m_XeGsDevice=new XeGsDevice(this))},XeDocument.prototype.MyAddress=function(){return"m_XeDocument"+this.getFxNumber()},XeDocument.prototype.cmdERASE=function(){var e=this.getXeMainSelectionSet().getHandles(),t=this.getXeDatabase().getXeEntities();if(0<e.length){var i=[];this.CommandStart("CLIENT_ERASE");for(var r=0;r<e.length;r++){var n=e[r],o=t.getByHandle(n);o&&!0!==o.getLayerObject().getLocked()&&(i.push(n),o.Erase())}for(var a=0;a<i.length;a++)this.getXeMainSelectionSet().Remove(i[a]);this.CommandEnd("CLIENT_ERASE")}},XeDocument.prototype.MakeCustomRequest=function(e,t){return XeRequest.prototype.Promise(this,e,t)},XeDocument.prototype.getXeMainSelectionSet=function(){return this.m_XeSelectionSets.GetXeMainSelectionSet()},XeDocument.prototype.getXeWorkingSelectionSet=function(){return this.m_XeSelectionSets.GetXeWorkingSelectionSet()},XeDocument.prototype.getLastCommand=function(){return this.m_LastCommand},XeDocument.prototype.setLastCommand=function(e){this.m_LastCommand=e},XeDocument.prototype.StartGLProcessing=function(e){this.m_bGLInitialized||(this.getXeGsDevice().StartGLProcessing(e),this.getXeGlyphStorage()?.Fire(!0,!1,!1),this.m_bGLInitialized=!0)},XeDocument.prototype.StopGLProcessing=function(e){this.getXeGsDevice()&&this.getXeGsDevice().StopGLProcessing(e),this.getXeGlyphStorage().ClearGLCache(e),this.m_bGLInitialized=!1},XeApplication.prototype.FinalConstruct=function(){let t=this;t.redrawImpl=function(){return t.redraw()},t.dispatchRedrawEventImpl=function(e){e=null==e?1:e;t.m_RedrawEvent_timeout||(t.m_RedrawEvent_timeout=setTimeout(t.redrawImpl,e))},this.SetTabActive(!1)},XeApplication.prototype.MyAddress=function(){return"XeApplication"},XeApplication.prototype.getXeActiveDocument=function(){if(void 0!==this.m_XeActiveDocNumber)return this.m_XeDocuments[this.m_XeActiveDocNumber]},XeApplication.prototype.setXeActiveDocument=function(e,t){var i=!this.m_XeActiveDocNumber,r=(this.m_XeActiveDocNumber=e,document.createEvent("Event"));r.initEvent("XeDocument_Activated",!0,!0),r.m_Item=window.getXeApplication().getDocumentByFxNumber(e),r.m_Item.m_UserId=window.getXeApplication().getUserId(),r.m_Item.m_FileId=window.getXeApplication().getFileId(),r.m_Item.m_FileSessionId=window.getXeApplication().getFileSessionId(),r.m_FxNumber=e,document.dispatchEvent(r),i&&(this.getXeUI().FireWidget_Create(this.getXeUI().getProperties()),0<t.length)&&(this.m_GsSocket=new WebSocket(t),this.m_GsSocket.binaryType="arraybuffer",this.m_GsSocket.onopen=()=>{window.XeLogger.info("GS Socket opened"),this.m_GsSocket.send(11)},this.m_GsSocket.onclose=()=>{window.XeLogger.info("GS Socket closed")},this.m_GsSocket.onerror=e=>{window.XeLogger.error("GS Socket error: "+e)},this.m_GsSocket.onmessage=e=>{e.data.length,e.data.byteLength,e.data.size;e=e.data;this.m_GsUpdates||(this.m_GsUpdates=[]),this.m_GsUpdates.push(e),this.m_GsSocket.send(11),this.dispatchGsUpdates()}),this.SetTabActive(!0)},XeApplication.prototype.dispatchGsUpdates=function(){this.m_GsUpdates_timeout||(this.m_GsUpdates_timeout=setTimeout(this.ApplyGsUpdates,5,this))},XeApplication.prototype.ApplyGsUpdates=function(e){e.ApplyGsUpdatesImpl()},XeApplication.prototype.ApplyGsUpdatesImpl=function(){if(this.m_GsUpdates_timeout&&clearTimeout(this.m_GsUpdates_timeout),this.m_GsUpdates){this.m_bApplyingUpdates=!0;let e;var t=this.m_GsUpdates.length;for(e=0;e<t;e++){var i=this.m_GsUpdates[e];if(i){try{XeObjectModelDeserializer.DeserializeXeObject(i,0)}catch(e){window.XeLogger.error("Exception inside ApplyGsUpdates")}this.m_GsUpdates[e]=void 0}}t===this.m_GsUpdates.length&&(this.m_GsUpdates=[]),this.m_bApplyingUpdates=!1}this.m_GsUpdates_timeout=0,this.dispatchRedrawEvent()},XeApplication.prototype.IsEntitiesLoaded=function(){var e;return!this.m_GsSocket||!!(e=window.getXeActiveDocument())&&!!e.getXeGsDevice()&&0===e.getXeDatabase().getXeEntities().m_EntitiesLeft},XeApplication.prototype.IsApplyingGsUpdates=function(){var e,t;return!(!this.m_GsSocket||!this.m_bApplyingUpdates&&this.m_GsUpdates&&0==this.m_GsUpdates.length&&(e=window.getXeActiveDocument())&&(t=e.getXeGsDevice())&&0===t.getChunks().m_ChunksLeft&&0===e.getXeDatabase().getXeEntities().m_EntitiesLeft)},XeApplication.prototype.CallServer=function(e,t,i,r,n,o,a){void 0===this.m_UQ&&(this.m_UQ=[]),o=o||new XeRequest;var s=this.getHashId(),o=(o&&(this.m_ResultRequests||(this.m_ResultRequests={}),o.m_Hash=s,(this.m_ResultRequests[o.getHash()]=o).m_inProgress=!0,o.m_startTime=(new Date).getTime(),o.m_Name=t,o.m_Val=i),{}),o=(o.m_HashId=s,o.m_creationTime=(new Date).getTime(),o.m_Val=i,o.m_Const=a,this.m_EventData||(this.m_EventData={}),this.m_EventData[s]=o,e.MyAddress()+"."+t);return void 0===i?this.m_UQ.push({name:o,val:null,hashId:s,cnst:a}):this.m_UQ.push({name:o,val:i,hashId:s,cnst:a}),this.FireServerUpdate(!1),s},XeApplication.prototype.getHashId=function(){return this.m_iHashId||(this.m_iHashId=0),this.m_iHashId++},XeApplication.prototype.getXeTests=function(){return this.m_Tests||(this.m_Tests=new XeTests),this.m_Tests},XeApplication.prototype.SendUserInput=function(e){var t,i;0!=window.__XeData?this.m_UQ&&(t=this.getHashId(),(i={}).m_HashId=t,i.m_creationTime=(new Date).getTime(),i.m_Val=e,i.m_Const=!1,this.m_EventData||(this.m_EventData={}),this.m_EventData[t]=i,this.m_UQ.push({name:"Event",val:e,hashId:t,cnst:!1}),this.FireServerUpdate(!0)):this.CallServer(window.getXeActiveDocument(),window.getXeActiveDocument().getXeInputPointManager().MyAddress(),{XeHitTestInfo:e},!0,!0,void 0,!1)},XeApplication.prototype.FindRequest=function(e){if(this.m_ResultRequests)return this.m_ResultRequests[e]},XeApplication.prototype.SRR=function(e,t,i){var r,n,o,a,s,c;"STARTUP"===e&&(this.m_bStartupAlmostDone=!0,this.m_ServerStartupDuration=t),this.m_ResultRequests&&((r=this.m_ResultRequests[e])&&(a=r.m_startTime,s=(new Date).getTime(),this.m_ResultRequestsDone||(this.m_ResultRequestsDone=[]),n=r.m_Name,o=r.m_Val,r.Done(i),delete this.m_ResultRequests[e],a=(c=(new Date).getTime())-a,this.getXRay())&&this.m_ResultRequestsDone.push([e,r.m_startTime,s,c]),!0===window.__LogRequests&&(s=1e3<a?"====>LONG ":"",r?s+="XeRequest "+e+","+n+" done in "+a+" ms(server "+t+" ms), result = "+JSON.stringify(i)+", val = "+JSON.stringify(o):console.log("XeRequest "+e+" done (server "+t+" ms)"),console.log(s)),(c=document.createEvent("Event")).initEvent("XeDocument_SSR_Updated",!0,!0),c.m_Item=this,c.m_Key=e,document.dispatchEvent(c))},XeApplication.prototype.createXeDocument=function(e){var t=new XeDocument;this.m_XeDocuments||(this.m_XeDocuments={}),this.m_XeDocuments[e]=t},XeApplication.prototype.destroyXeDocument=function(e){var t=document.createEvent("Event");t.initEvent("XeDocument_Deactivated",!0,!0),t.m_Item=this.getDocumentByFxNumber(e),t.m_FxNumber=e,document.dispatchEvent(t),this.m_XeDocuments[e]=void 0,delete this.m_XeDocuments[e]},XeApplication.prototype.getDocumentByFxNumber=function(e){return this.m_XeDocuments||(this.m_XeDocuments={}),this.m_XeDocuments[e]},XeApplication.prototype.UpdateClientState=function(e,i,r){this.m_bInsideUpdate=!0,this.m_Events=[],this.m_UpdatedEntities=[],this.m_ErasedEntities=[],this.m_AppendedEntities=[],this.BH&&(this.BH(!1),this.BH(!0)),this.UCS&&this.UCS(),this.BH=void 0,this.UCS=void 0;try{let e=new XeTimer("Update client state (by web socket)"),t;for(var n in this.m_XeDocuments)(t=this.m_XeDocuments[n]).BH&&(t.BH(!1),t.BH(!0)),t.UCS&&t.UCS(),t.BH=void 0,t.UCS=void 0;for(var o in this.PostUpdate(i,r),this.m_XeDocuments)(t=this.m_XeDocuments[o]).Fire_ClientStateUpdated(i,r);e.report()}catch(e){window.XeLogger.error("Update client state ERROR CATCHED!"+e)}this.dispatchRedrawEvent(),this.m_bInsideUpdate=!1},XeApplication.prototype.FireServerUpdate=function(e){var t=20;100<this.m_UQ.length&&(t=0),!0===e&&(t=0),this.FireServerUpdate_timeout&&clearTimeout(this.FireServerUpdate_timeout),0===t?this.SendDataToServer():this.FireServerUpdate_timeout=setTimeout(this.SendDataToServer.bind(this),t)},XeApplication.prototype.SendDataToServer=function(e){for(var t={requests:[]},i=0;i<this.m_UQ.length;i++){var r=this.m_UQ[i].name.split("."),r=this.ObjectFromAddress(r,0,this.m_UQ[i].val,this.m_UQ[i].hashId,this.m_UQ[i].cnst);t.requests.push(r)}this.m_UQ=[];var n,o=jQuery("#xeMainFrame")[0];void 0!==t&&o&&(Wt.emit(o,"XeData",JSON.stringify(t)),window.__Counter||(window.__Counter=0),window.__Counter++),this.m_ResultRequestsDone&&0<this.m_ResultRequestsDone.length&&o&&(n=this.m_ResultRequestsDone.splice(0,100),Wt.emit(o,"XeRequests",JSON.stringify({requests:n})))},XeApplication.prototype.ObjectFromAddress=function(e,t,i,r,n){r={hashId:r,cnst:n};return t<e.length-1?r[e[t]]=this.ObjectFromAddress(e,t+1,i):r[e[t]]=i,r},XeApplication.prototype.PostUpdate=function(e,t){for(var i=0;i<this.m_Events.length;i++){var r=this.m_Events[i];"XeEntities"===r.m_Item.m_ClassName&&(r.m_Item,r.m_UpdatedEntities=this.m_UpdatedEntities,r.m_ErasedEntities=this.m_ErasedEntities,r.m_AppendedEntities=this.m_AppendedEntities),document.dispatchEvent(r)}this.m_Events=[],this.m_UpdatedEntities=[],this.m_ErasedEntities=[],this.m_AppendedEntities=[]},XeApplication.prototype.Emit_BeginCommand=function(e){var t=document.createEvent("Event");t.initEvent("XeCommandProcessor",!0,!0),t.timestamp=(new Date).getTime(),t.m_Started=!0,t.m_Item=e,document.dispatchEvent(t),window.XeClientMessageProxy&&window.XeClientMessageProxy.call("commandStarted",[e])},XeApplication.prototype.Emit_EndCommand=function(e){var t=document.createEvent("Event");t.initEvent("XeCommandProcessor",!0,!0),t.timestamp=(new Date).getTime(),t.m_Started=!1,t.m_Item=e,document.dispatchEvent(t),window.XeClientMessageProxy&&window.XeClientMessageProxy.call("commandEnded",[e])},XeApplication.prototype.GetCapability=function(e){return!1},XeApplication.prototype.dispatchRedrawEvent=function(e){this.dispatchRedrawEventImpl(e)},XeApplication.prototype.redraw=function(){var e;this.m_RedrawEvent_timeout&&clearTimeout(this.m_RedrawEvent_timeout),this.m_RedrawEvent_timeout=0,!this.IsTabActive()||!(e=window.getXeActiveDocument())||!e.getXeGsDevice()||!e.getXeGsDevice().getPixelWidth()||e.getXeGsDevice().getPixelWidth()<10||!e.getXeGsDevice().getPixelHeight()||e.getXeGsDevice().getPixelHeight()<10||(this.StartGLProcessing(e.getGLWidget()),this.m_XeWebDrawerEngine&&this.m_XeWebDrawerEngine.Render())},XeApplication.prototype.StartGLProcessing=function(e){for(var t in this.m_XeWebDrawerEngine||(this.m_XeWebDrawerEngine=new XeWebDrawerEngine,this.m_XeWebDrawerEngine.StartGLProcessing(e)),this.m_XeDocuments)this.m_XeDocuments[t].StartGLProcessing(e)},XeApplication.prototype.getGLContext=function(){let e,t;return e=this.m_XeWebDrawerEngine&&(t=this.m_XeWebDrawerEngine.getXeRenderer())?t.getGl():e},XeApplication.prototype.StopGLProcessing=function(){var e,t=this.getGLContext();for(e in this.m_XeDocuments)this.m_XeDocuments[e].StopGLProcessing(t);this.m_XeWebDrawerEngine&&(this.m_XeWebDrawerEngine.StopGLProcessing(),this.m_XeWebDrawerEngine=void 0)},XeApplication.prototype.getDrawingEngine=function(){return this.m_XeWebDrawerEngine},XeApplication.prototype.RequestCommandList=function(){return this.commandList=this.commandList||XeRequest.prototype.Promise(this,"","RequestCmdList"),this.commandList},XeApplication.prototype.RequestSysVarList=function(){return this.sysVarList=this.sysVarList||XeRequest.prototype.Promise(this,"","RequestSysVarList"),this.sysVarList},XeApplication.prototype.RequestAliasesList=function(){return this.aliasesList=this.aliasesList||XeRequest.prototype.Promise(this,"","RequestAliasesList"),this.aliasesList},XeApplication.prototype.IsTabActive=function(){return this.m_bTabActive},XeApplication.prototype.SetTabActive=function(e){this.m_bTabActive=e,this.m_bTabActive&&this.dispatchRedrawEvent()},XeApplication.prototype.GetLocalizedStringMap=function(){return this.localizedStringMapResponce||{}},XeApplication.prototype.RequestLocalizedStringMap=function(){let t=this;return t.localizedStringMap=t.localizedStringMap||XeRequest.prototype.Promise(this,"","RequestLocalizedStringMap"),t.localizedStringMapResponce||(t.localizedStringMapResponce={},t.localizedStringMap.then(e=>{t.localizedStringMapResponce=e})),this.localizedStringMap},XeApplication.prototype.getXeSpinner=function(){return window.IsOsVersion()?window.osws:window.workingSpinner},XeApplication.prototype.IsDebugGS=function(){return window.__IsDebugMode&&window.IsOsVersion()},XeApplication.prototype.CheckStartupDone=function(){var e,t;this.m_GsSocket?this.m_bStartupDone||!this.m_bStartupAlmostDone||this.IsApplyingGsUpdates()||(t=window.getXeActiveDocument())&&0===t.getXeGsDevice().getChunks().m_ChunksLeft&&0===t.getXeDatabase().getXeEntities().m_EntitiesLeft&&(this.m_bStartupDone=!0,t=(new Date).getTime()-window.m_iWtStartTime,window.__IsDebugMode&&window.XeLogger.log("******STARTUP******* done in "+t+" (server "+this.m_ServerStartupDuration+" ms)"),window.XeClientMessageProxy&&window.XeClientMessageProxy.drawingLoaded&&window.XeClientMessageProxy.drawingLoaded(),window.getXeApplication().getXeSpinner()&&window.getXeApplication().getXeSpinner().stopWait(),3e4<t&&(e="LONG STARTUP. Full_time:"+t+" (server "+this.m_ServerStartupDuration+" ms)",window.XeLogger.warn(e)),this.m_STARTUP_TIME=t,window.parent!==window)&&window.parent.postMessage({messageName:"stopProgressor",messageParam:""},"*"):!this.m_bStartupDone&&this.m_bStartupAlmostDone&&(this.m_bStartupDone=!0,e=(new Date).getTime()-window.m_iWtStartTime,window.__IsDebugMode&&window.XeLogger.log("******STARTUP******* done in "+e+" (server "+this.m_ServerStartupDuration+" ms)"),window.XeClientMessageProxy&&window.XeClientMessageProxy.drawingLoaded&&window.XeClientMessageProxy.drawingLoaded(),window.getXeApplication().getXeSpinner()&&window.getXeApplication().getXeSpinner().stopWait(),3e4<e&&(t="LONG STARTUP. Full_time:"+e+" (server "+this.m_ServerStartupDuration+" ms)",window.XeLogger.warn(t)),this.m_STARTUP_TIME=e,window.parent!==window)&&window.parent.postMessage({messageName:"stopProgressor",messageParam:""},"*")},XeEntities.prototype.getXeDocument=function(){return this.getXeDatabase().getXeDocument()},XeEntities.prototype.getXeDatabase=function(){return this.m_MyParent.getXeDatabase()},XeEntities.prototype.getByHandle=function(e){if("m_MyParent"!==e){var t=(t=this[e])||this["m_"+e];if(t&&t.IsXeCollectionMember)return t}},XeEntities.prototype.getByStringGiPath=function(e){let t=this.getXeDatabase().getXeEntities();for(var i=null,r=e.split("$"),n=0;n<r.length;n++){var o=r[n];if(0<n){if(!i)return null;var a=i.m_XeEntities,a=(t=a?a:t).getByHandle(o);if(a&&(i=a),void 0===a&&"OnshapeSubView"!==i.getClass())return null}else i=t.getByHandle(o)}return i},XeEntities.prototype.getByGiPath=function(e){for(var t,i=this.getXeDatabase().getXeEntities(),r=0;r<e.length;r++){if(void 0===i){t=void 0;break}if(void 0===(t=i.getByHandle(e[r])))break;i=t.m_XeEntities}return t},XeEntities.prototype.getXeEntitiesByGiPath=function(e){for(var t,i=this.getXeDatabase().getXeEntities(),r=0;r<e.length-1;r++){if(void 0===i){t=void 0;break}if(void 0===(t=i.getByHandle(e[r])))break;i=t.m_XeEntities}return i},XeEntities.prototype.createByGiPath=function(e,t){var i=this.getXeDatabase().getXeEntities();if(void 0!==i){for(var r,n,o=0;o<e.length-1;o++){if(void 0===(n=i.getByHandle(e[o])))return r="ERROR --\x3e missing parent "+e[o]+" for "+e,void window._LOG_GLOBAL.SHOW("SHOW_ERRORS",r);void 0===n.m_XeEntities&&(n.m_XeEntities=new XeEntities),i=n.m_XeEntities}var a=e[e.length-1],s=i.getByHandle(a);return null!=s&&(s.RemoveFromAncestors(),delete s.m_XeGsOffsetsWithNested),void 0===n?this["m_"+a]=t:(void 0===n.m_XeEntities&&(n.m_XeEntities=new XeEntities),(n.m_XeEntities["m_"+a]=t).m_Parent=n),t}},XeEntities.prototype.ProcessOrphanes=function(){var e=this.getXeDatabase().getXeEntities();if(e.g_Orphanes)for(var t in this)if("m"==t.charAt(0)){var i=this[t],r=e.g_Orphanes[t];if(void 0!==r){for(var n in void 0===i.m_XeEntities&&(i.m_XeEntities=new XeEntities),r)"m"==n.charAt(0)&&(n=r[n],(i.m_XeEntities["m_"+n.m_Handle]=n).m_Parent=i);e.g_Orphanes[t]=void 0}void 0!==i.m_XeEntities&&i.m_XeEntities.ProcessOrphanes()}},XeEntities.prototype.InvalidateLayerObjects=function(){for(var e in this){e=this.getByHandle(e);e&&(e.m_LayerObject=void 0)}},XeEntities.prototype.AddEntity=function(e,t){this.createByGiPath(e,t),t.getOwnerEntity().FireUpdate()},XeEntities.prototype.A_XEI=function(e,t,i){t&&this.createByGiPath(t.getPath(),t);for(let e=0;e<i.length;e++){var r=i[e];r&&this.createByGiPath(r.getPath(),r)}t&&t.FireUpdate()},XeEntities.prototype.U_XEI=function(e,t){e=this.getXeDatabase().getXeEntities().getByHandle(e);if(e){if(e.RemoveFromAncestors(),e.FirePreupdate(!1),t.length)for(let e=0;e<t.length;e++)this.createByGiPath(t[e].getPath(),t[e]);else e.m_XeGsOffsets=t.m_XeGsOffsets,e.m_Grips=t.m_Grips;e.FireUpdate(),e.AddToAncestors()}},XeEntities.prototype.R_XEI=function(e){this.R_E(e)},XeEntities.prototype.A_XeEntity=function(e,t,i,r,n,o,a,s,c){e=new XeEntity(this,e,t,i,r,n,o,a,s,c);this.AddEntity(i,e)},XeEntities.prototype.A_XeLine=function(e,t,i,r,n,o,a,s){e=new XeLine(this,e,t,i,r,n,o,a,s);this.AddEntity(i,e)},XeEntities.prototype.A_XeCircle=function(e,t,i,r,n,o,a,s){e=new XeCircle(this,e,t,i,r,n,o,a,s);this.AddEntity(i,e)},XeEntities.prototype.A_XeDatum=function(e,t,i,r,n,o,a,s){e=new XeDatum(this,e,t,i,r,n,o,a,s);this.AddEntity(i,e)},XeEntities.prototype.A_XeDimension=function(e,t,i,r,n,o,a,s,c,l,d,u){e=new XeDimension(this,e,t,i,r,n,o,a,s,void 0,void 0,void 0,l,d,u);this.AddEntity(i,e)},XeEntities.prototype.A_XePolyline=function(e,t,i,r,n,o,a,s){e=new XePolyline(this,e,t,i,r,n,o,a,s);this.AddEntity(i,e)},XeEntities.prototype.A_XeText=function(e,t,i,r,n,o,a,s){e=new XeText(this,e,t,i,r,n,o,a,s);this.AddEntity(i,e)},XeEntities.prototype.A_XeCentermark=function(e,t,i,r,n,o,a,s,c){e=new XeCentermark(e,t,i,r,n,o,a,s,c);this.AddEntity(i,e)},XeEntities.prototype.A_XeBlockReference=function(e,t,i,r,n,o,a,s,c,l){e=new XeBlockReference(this,e,t,i,r,n,o,a,s,void 0,void 0,c,(new GeNeo.OdGeMatrix3d).fromFlatArray(l));this.AddEntity(i,e)},XeEntities.prototype.A_XeTable=function(e,t,i,r,n,o,a,s,c){e=new XeTable(this,e,t,i,r,n,o,a,s,c);this.AddEntity(i,e)},XeEntities.prototype.A_XeLight=function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w){e=new XeEntity(this,e,t,i,r,n,o,a,s);e.m_d={m_LightType:c,m_IsOn:l,m_IsPlottable:d,m_LightColor:u,m_Intensity:p,m_ShadowParameters:{m_ShadowType:m.ShadowType,m_ShadowsOn:m.ShadowsOn,m_ShadowMapSize:m.ShadowMapSize,m_ShadowMapSoftness:m.ShadowMapSoftness},m_LightAttenuation:{m_AttenuationType:h.AttenuationType,m_UseLimits:h.UseLimits,m_StartLimit:h.StartLimit,m_EndLimit:h.EndLimit},m_Position:g,m_TargetLocation:y,m_HotspotAngle:f,m_FalloffAngle:_,m_LightDirection:w},this.AddEntity(i,e)},XeEntities.prototype.U_E=function(e,t,i,r,n,o,a,s){var c=this.getByGiPath(i);void 0===c?window._LOG_GLOBAL.SHOW("SHOW_ERRORS","U_E cannot find "+i):(c.RemoveFromAncestors(),c.getOwnerEntity().FirePreupdate(!1),c.m_XeGsOffsets=e,c.m_Grips=s,c.getOwnerEntity().FireUpdate(),c.AddToAncestors())},XeEntities.prototype.R_E=function(e){var t,i=this.getXeEntitiesByGiPath(e);void 0===i?window._LOG_GLOBAL.SHOW("SHOW_ERRORS","R_E cannot find "+e):void 0!==(t=i["m_"+(e=e[e.length-1])])&&(t.RemoveFromAncestors(),void 0===t.m_Parent?t.FirePreupdate(!1,!0):t.getOwnerEntity().FirePreupdate(!1,!1),i.DXEO(t),i[e="m_"+e]=void 0,delete i[e],void 0!==t.m_Parent)&&t.getOwnerEntity().FireUpdate()},XeEntities.prototype.ShowEntities=function(e){for(var t of e){t=this.getByHandle(t);t&&t.Show()}},XeEntities.prototype.HideEntities=function(e){for(var t of e){t=this.getByHandle(t);t&&t.Hide()}},XeEntities.prototype.onPreUpdate=function(){this.Fire(!1,!1,!1)},XeEntities.prototype.RemoveEntities=function(e){for(var t of e)this.R_E(t)},window.m_iLastHeaderNumber=0,window.m_iCurrentHeaderNumber=-1,XeEntities.prototype.onUpdate=function(){this.m_Hide&&(this.HideEntities(this.m_Hide),this.m_Hide=void 0),this.m_Show&&(this.ShowEntities(this.m_Show),this.m_Show=void 0),this.m_MyParent instanceof XeDatabase&&(this.Fire(!0,!1,!1),window.getXeApplication().PostUpdate(0,0),0===this.m_EntitiesLeft)&&this.getXeDocument().getXeGsDevice().FireLastEntitySent()};var XeGsOffsets=function(){},XeGsOffset=function(){};XeGsOffset.prototype.getItemNameByIndex=function(e){return["o","s"][e]},XeEntity.prototype.getXeDocument=function(){return this.getXeDatabase().getXeDocument()},XeEntity.prototype.getXeDatabase=function(){return this.m_MyParent.getXeDatabase()},XeEntity.prototype.IsXeCollectionMember=function(){return!0},XeEntity.prototype.getClass=function(){return this.m_Class},XeEntity.prototype.MyAddress=function(){return this.getXeDocument().MyAddress()},XeEntity.prototype.getHandle=function(){var e;return void 0===this.m_Handle&&(e=this.getGiPath(),this.m_Handle=e[e.length-1]),this.m_Handle},XeEntity.prototype.getOwnerEntity=function(){var e=this.getGiPath();return 1==e.length?this:this.getXeDatabase().getXeEntities().getByHandle(e[0])},XeEntity.prototype.getGiPath=function(){return this.m_Path},XeEntity.prototype.getLayerObject=function(){var e;return this.m_LayerObject||(e=this.getXeDatabase().getXeLayers()["m_"+this.getLayer()],this.m_LayerObject=e),this.m_LayerObject},XeEntity.prototype.getXeEntities=function(){return this.m_MyParent},XeEntity.prototype.getParent=function(){return this.m_Parent},XeEntity.prototype.draw_dgi=function(e,t){},XeEntity.prototype.copy_ext=function(e){},XeEntity.prototype.getXeGsOffsetsWithNested=function(){if(!this.m_XeGsOffsetsWithNested){if(!this.m_XeEntities)return this.getXeGsOffsets();var i={};if(Object.assign(i,this.getXeGsOffsets()),this.m_XeEntities)for(var e in this.m_XeEntities){e=this.m_XeEntities.getByHandle(e);if(e){var t=e.getXeGsOffsetsWithNested();if(t)for(var r in t){var n=i[r],o=t[r];if(n){var a={};for(let e=0;e<n.length;e++)a[n[e].o]=n[e].s;for(let e=0;e<o.length;e++)a[o[e].o]=o[e].s;var s,c=[];let e=-1,t=0;for(s in a){var l=parseInt(s),d=a[s];e<0?(e=l,t=d):e+t==l?t+=d:(c.push({o:e,s:t}),e=l,t=d)}0<=e&&c.push({o:e,s:t}),i[r]=c}else i[r]=o}}}this.m_XeGsOffsetsWithNested=i}return this.m_XeGsOffsetsWithNested},XeEntity.prototype.getExtents=function(){for(var e=this.getXeDatabase().getXeDocument().getXeGsDevice().getChunks(),t=this.getXeGsOffsets(),i=new GeNeo.OdGeExtents3d,r=0;r<t.length;r++){var n=t[r],o=e["m_"+n.k];o&&(o=o.getExtents(n),i.addPoint(o.minPoint()),i.addPoint(o.maxPoint()))}if(this.m_XeEntities)for(var a in this.m_XeEntities){var a=this.m_XeEntities.getByHandle(a);a&&(a=a.getExtents(),i.addPoint(a.minPoint()),i.addPoint(a.maxPoint()))}return i},XeEntity.prototype.getCachedXeGsOffsets=function(){return this.getXeGsOffsetsWithNested()},XeEntity.prototype._sort_xegsoffsets_by_key=function(e,t){return e.k>t.k?1:e.k<t.k?-1:0},XeEntity.prototype._sort_xegsoffsets_by_offset=function(e,t){return e.o>t.o?1:e.o<t.o?-1:0},XeEntity.prototype.draw_gl=function(e,t,i){throw"XeEntity.prototype.draw_gl"},XeEntity.prototype.invalidateEntitiesCache=function(e){if(e)for(var t=this.getXeDatabase().getXeEntities(),i=0;i<e.length;i++){var r=t.getByHandle(e[i]);if(r&&this.m_Handle===r.m_Handle)return void window.XeLogger.warn("invalidateEntitiesCache self depended m_Handle:"+this.m_Handle);r&&("AcDbHatch"===r.getClass()&&delete r.m_Dependent,r.invalidateCache())}},XeEntity.prototype.invalidateCache=function(){this.m_Dependent&&this.invalidateEntitiesCache(this.m_Dependent.getResult()),delete this.m_Associated,delete this.m_AssociatedPoints,delete this.m_Dependent,delete this.m_OrdinateLinePoints,delete this.m_XeGsOffsetsWithNested},XeEntity.prototype.invalidateCacheNew=function(){this.m_Dependent&&this.invalidateEntitiesCache(this.m_Dependent.getResult()),delete this.m_Associated,delete this.m_AssociatedPoints,delete this.m_Dependent,delete this.m_DependentCopy,delete this.m_OrdinateLinePoints,delete this.m_XeGsOffsetsWithNested,delete this.m_XeGsOffsets,delete this.m_GripsData,delete this.m_CustomGrips,delete this.m_Group},XeEntity.prototype.FirePreupdate=function(e,t){this.invalidateCache(),!0===t&&(t=this.getXeEntities().getXeDocument().getXeGsDevice(),this.getParent()||1!==this.getPath().length||t.getXeColorPickingMap().deleteKey(this.getHandle()),window.getXeApplication().m_ErasedEntities.push(this.getHandle()))},XeEntity.prototype.FirePreupdateNew=function(e,t){this.invalidateCacheNew()},XeEntity.prototype.FireUpdate=function(){var e,t=this.getHandle(),i=(this.invalidateCache(),window.getXeApplication().m_UpdatedEntities.push(t),this.getXeDocument()),r=0<this.getOwner(),r=(!this.getParent()&&1===this.getPath().length&&r&&i.getXeGsDevice().getXeColorPickingMap().addKey(t),i.getXeInputPointManager()),n=r.GetDragInfo(),o={};for(e in n.waitingPreviews)n.waitingPreviews[e].removeOnNextEntityUpdate?n.waitingPreviews[e].deallocate():o[e]=n.waitingPreviews[e];n.waitingPreviews=o,n.waitingPreviews[t]?r.ClearDragDrop():-1<n.handles.indexOf(t)&&this.Hide()},XeEntity.prototype.FireUpdateNew=function(){var e,t=this.getHandle(),i=(window.getXeApplication().m_UpdatedEntities.push(t),this.getXeDocument()),r=0<this.getOwner(),r=(!this.getParent()&&1===this.getPath().length&&r&&i.getXeGsDevice().getXeColorPickingMap().addKey(t),i.getXeInputPointManager()),n=r.GetDragInfo(),o={};for(e in n.waitingPreviews)n.waitingPreviews[e].removeOnNextEntityUpdate?n.waitingPreviews[e].deallocate():o[e]=n.waitingPreviews[e];n.waitingPreviews=o,n.waitingPreviews[t]?r.ClearDragDrop():-1<n.handles.indexOf(t)&&this.Hide()},XeEntity.prototype.EraseGraphics=function(){var e,t,i,r=this.getXeDatabase().getXeDocument().getXeGsDevice().getChunks(),n={},o={},a=this.getXeGsOffsetsWithNested();for(e in a){var s=r[e],c=a[e];if(s)for(let e=0;e<c.length;e++){var l=c[e];s&&(s.getIndexes&&s.getIndexes()?(n[s.getId()]=!0,s.A_IU(0,0,l.o,l.s,0,0,0,0)):s.getItems&&s.getItems()&&(o[s.getId()]=!0,s.A_SU(0,0,l.o,l.s)))}}for(t in n){var d,u=r.getById(t);u&&((d=document.createEvent("Event")).initEvent("PreUpdate_XeGsIndexedChunk",!0,!0),d.m_Item=u,d.m_FullUpdate=!0,d.m_Erased=!1,document.dispatchEvent(d),(d=document.createEvent("Event")).initEvent("Update_XeGsIndexedChunk",!0,!0),d.m_Item=u,d.m_FullUpdate=!0,d.m_Erased=!1,document.dispatchEvent(d))}for(i in o){var p,m=r.getById(i);m&&((p=document.createEvent("Event")).initEvent("PreUpdate_XeGsSimpleChunk",!0,!0),p.m_Item=m,p.m_FullUpdate=!0,p.m_Erased=!1,document.dispatchEvent(p),(p=document.createEvent("Event")).initEvent("Update_XeGsSimpleChunk",!0,!0),p.m_Item=m,p.m_FullUpdate=!0,p.m_Erased=!1,document.dispatchEvent(p))}},XeEntity.prototype.Erase=function(){this.invalidateCache(),this.EraseGraphics(),this.getXeDatabase().DoErase(this.getHandle()),this.getXeDatabase().getXeEntities().R_E(this.getPath())},XeEntity.prototype.IsHidden=function(){return null==this.m_XeDrawMode&&(this.m_XeDrawMode=XeDrawMode.kNormal),this.m_XeDrawMode===XeDrawMode.kHidden},XeEntity.prototype.setDrawMode=function(t){t=t||XeDrawMode.kNormal,this.m_XeDrawMode==t&&this.m_XeDrawMode==XeDrawMode.kNormal||this.setDrawModeByXeGsOffsets(t),this.m_XeDrawMode!=t&&XeEntity.prototype.procAllChilds(this,e=>{e.m_XeDrawMode=t}),this.m_XeDrawMode=t},XeEntity.prototype.setDrawModeByXeGsOffsets=function(t){var e,i=this.getXeDatabase().getXeDocument().getXeGsDevice().getChunks(),r=this.getXeGsOffsetsWithNested();for(e in r){var n=i[e],o=r[e];for(let e=0;e<o.length;e++){var a=o[e];n&&n.setDrawMode(t,a.o,a.s)}}},XeEntity.prototype.GetGripMoveIndex=function(){},XeEntity.prototype.CheckIfGrip=function(t){var e=this.getLayerObject();if(e&&!0!==e.getLocked()){var i=this.GetGripsData();for(let e=0;e<i.length;++e)if(i[e].IsMouseOver(t))return e;e=this.GetGripMoveIndex();if(0<=e&&i.length>e){var r=this.getXeDatabase().getXeDocument().getXeInputPointManager().GetApertureSelection();if(0<r.length){var n=this.getHandle();if(n===r[0])return e;if("AcDbMText"===this.getClass()){r=this.getXeDatabase().getXeEntities().getByHandle(r[0]);if(void 0!==r.getMTextId&&r.getMTextId()==n)return e}}}}},XeEntity.prototype.CheckIfGrips=function(t){var e=this.getLayerObject();if(!e)return[];if(!0===e.getLocked())return[];var i=[],r=this.GetGripsData();for(let e=0;e<r.length;++e)r[e].IsMouseOver(t)&&i.push(e);if(0<=r.m_GripMoveIndex&&r.length>r.m_GripMoveIndex){e=this.getXeDatabase().getXeDocument().getXeInputPointManager().GetApertureSelection();if(0<e.length)if(this.getHandle()===e[0])return[r.m_GripMoveIndex]}return i},XeEntity.prototype.HasCustomGrips=function(){return Array.isArray(this.m_CustomGrips)&&0<this.m_CustomGrips.length},XeEntity.prototype.GetCustomGrips=function(){return this.HasCustomGrips()?this.m_CustomGrips:[]},XeEntity.prototype.GetGripsData=function(){if(this.HasCustomGrips())return this.m_CustomGrips;var e=this.m_GripsData;if(XeUtility.IsNonEmptyArray(e))return e;e=this.getGrips();let i=this.getHandle();return this.m_GripsData=e.map((e,t)=>new XeGrip(e,t,i)),this.m_GripsData},XeEntity.prototype.GetGripDataAt=function(e){return this.GetGripsData()[e]},XeEntity.prototype.FindGripsAt=function(t,i){var e=this.getLayerObject();return!e||!0===e.getLocked()?[]:(e=this.GetGripsData(),i||=!1,e.filter(e=>e.IsMouseOver(t,i)))},XeEntity.prototype.getAllChildsArray=function(e,t){var i=e.m_XeEntities;if(i)for(var r in i){r=i.getByHandle(r);r&&(XeEntity.prototype.getAllChildsArray(r,t),t.push(r))}},XeEntity.prototype.procAllChilds=function(e,t){t(e);var i=e.m_XeEntities;if(i)for(var r in i){r=i.getByHandle(r);r&&XeEntity.prototype.procAllChilds(r,t)}},XeEntity.prototype.RequestAncestors=function(){return this.m_Ancestors=this.m_Ancestors||XeRequest.prototype.FakePromise(this,this.getHandle(),"RequestAncestors"),this.m_Ancestors},XeEntity.prototype.getAncestors=function(){return this.RequestAncestors().getResult()},XeEntity.prototype.RequestNoteAnnotations=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_FlagNotes=this.m_FlagNotes||XeRequest.prototype.Promise(this,{handle:this.getHandle(),pt:e},"RequestNoteAnnotations"),this.m_FlagNotes},XeEntity.prototype.getNoteAnnotations=function(){return this.RequestNoteAnnotations().getResult()},XeEntity.prototype.RequestSecondaryDatums=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_Datums=this.m_Datums||XeRequest.prototype.Promise(this,{handle:this.getHandle(),pt:e},"RequestSecondaryDatums"),this.m_Datums},XeEntity.prototype.getSecondaryDatums=function(){return this.RequestSecondaryDatums().getResult()},XeEntity.prototype.RequestViewType=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_OsView=this.m_OsView||XeRequest.prototype.Promise(this,{handle:this.getHandle(),pt:e},"RequestViewType"),this.m_OsView},XeEntity.prototype.getViewType=function(){return this.RequestViewType().getResult()},XeEntity.prototype.RequestGroup=function(){this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_Group=this.m_Group||XeRequest.prototype.Promise(this,this.getHandle(),"RequestGroup"),this.m_Group},XeEntity.prototype.getGroup=function(){return this.RequestGroup().getResult()},XeEntity.prototype.isLeader=function(){return"OnshapeMLeader"==this.getClass()||"AcDbLeader"==this.getClass()},XeEntity.prototype.getLeaders=function(){var e=this.getXeDatabase().getXeEntities(),t=[],i=this.getAncestors();if(i)for(var r=0;r<i.length;r++){var n=e.getByHandle(i[r]);n&&n.isLeader()&&t.push(n)}return t},XeEntity.prototype.RequestDependent=function(){return this.m_Dependent=this.m_Dependent||XeRequest.prototype.FakePromise(this,this.getHandle(),"RequestDependent"),this.m_Dependent},XeEntity.prototype.getDependent=function(){return this.RequestDependent(),this.m_Dependent.m_Result||[]},XeEntity.prototype.addDependent=function(e){this.RequestDependent(),this.m_Dependent.m_Result||(this.m_Dependent.m_Result=[]),this.m_Dependent.m_Result.push(e)},XeEntity.prototype.removeDependent=function(t){this.m_Dependent&&this.m_Dependent.m_Result&&(this.m_Dependent.m_Result=this.m_Dependent.m_Result.filter(function(e){return e!=t}))},XeEntity.prototype.AddToAncestors=function(){var e=this.getXeDatabase().getXeEntities(),t=this.getAncestors();if(t)for(var i=0;i<t.length;i++){var r=e.getByHandle(t[i]);r&&r.addDependent(this.getHandle())}},XeEntity.prototype.RemoveFromAncestors=function(){var e=this.getXeDatabase().getXeEntities(),t=this.getAncestors();if(t)for(var i=0;i<t.length;i++){var r=e.getByHandle(t[i]);r&&r.removeDependent(this.getHandle())}},XeEntity.prototype.RequestDependentCopy=function(){return this.m_DependentCopy=this.m_DependentCopy||XeRequest.prototype.Promise(this,this.getHandle(),"RequestDependentCopy"),this.m_DependentCopy},XeEntity.prototype.getDependentCopy=function(){if(this.RequestDependentCopy(),this.m_DependentCopy.m_Result)return this.m_DependentCopy.m_Result.d},XeEntity.prototype.getDependentCopyForValidation=function(){if(this.RequestDependentCopy(),this.m_DependentCopy.m_Result)return this.m_DependentCopy.m_Result.v},XeEntity.prototype.getDependentCopyForSoftValidation=function(){if(this.RequestDependentCopy(),this.m_DependentCopy.m_Result)return this.m_DependentCopy.m_Result.s},XeEntity.prototype.RequestGripType=function(){return"AcDbRadialDimension"!==this.getClass()&&"AcDbDiametricDimension"!==this.getClass()||(this.m_GripType=this.m_GripType||XeRequest.prototype.Promise(this,this.getHandle(),"RequestGripType")),this.m_GripType},XeEntity.prototype.getGripType=function(){if(this.RequestGripType(),this.m_GripType.m_Result)return this.m_GripType.m_Result},XeEntity.prototype.OnStartDragDrop=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager();if(e){var t=e.GetDragInfo(),i=t.actualPreview;if(i){var r=this.getXeDatabase().getXeEntities(),n=this.getDependent();for(let e=0;e<n.length;e++){var o,a=n[e];0<=t.handles.indexOf(a)||((o=r.getByHandle(a))?this.ValidDragObj(o)&&(o.getGroup(),o.RequestDependent().then(o.OnStartDragDrop.bind(o)),i.addXeEntity(o,!0),o.IsHidden()||(t.handles.push(a),o.Hide())):0)}null!=this.AddOsObjects&&this.AddOsObjects(function(e){e.Hide()});e=this.getXeDatabase().getXeDocument().getXeGsDevice();e&&(e.invalidateSelectionScene(),e.invalidateClientTrackersGL(),this.getXeDatabase().getXeDocument().getXeInputPointManager().InvalidateApertureSelection())}}},XeEntity.prototype.OnStartDragCopy=function(){var a=this,e=this.getXeDatabase().getXeDocument().getXeInputPointManager();if(e){var o=e.GetDragInfo(),s=o.actualPreview;if(s){a.RequestAncestors().then(function(){var e=a.getXeDatabase().getXeDocument().getXeInputPointManager();if(e){var t=e.GetDragInfo(),i=t.actualPreview,r=a.getLeaders();if(r)for(var n=0;n<r.length;n++){var o=r[n];o&&(i.addXeEntity(o,!0),t.handles.push(o.getHandle()))}}});let n=this.getXeDatabase().getXeEntities();a.isLeader()&&this.RequestDependent().then(function(){var t=a.getDependent();for(let e=0;e<t.length;e++){var i,r=t[e];0<=o.handles.indexOf(r)||((i=n.getByHandle(r))&&!i.IsHidden()?(s.addXeEntity(i,!0),o.handles.push(r)):0)}});e=this.getXeDatabase().getXeDocument().getXeInputPointManager();if(e){var t=e.getDependentCopySet(this);if(void 0!==t&&t&&0<t.length){var i=e.GetDragInfo(),r=i.actualPreview;for(let e=0;e<t.length;e++){var c=t[e],l=n.getByHandle(c);l&&(r.addXeEntity(l,!0),i.handles.push(c))}}}e=this.getXeDatabase().getXeDocument().getXeGsDevice();e&&(e.invalidateSelectionScene(),e.invalidateClientTrackersGL(),this.getXeDatabase().getXeDocument().getXeInputPointManager().InvalidateApertureSelection())}}},XeEntity.prototype.RequestTooltip=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_Tooltip=this.m_Tooltip||XeRequest.prototype.FakePromise(this,{handle:this.getHandle(),pt:e},"RequestTooltip"),this.m_Tooltip},XeEntity.prototype.RequestAssociated=function(){return this.m_Associated=this.m_Associated||XeRequest.prototype.FakePromise(this,this.getHandle(),"RequestAssociated"),this.m_Associated},XeEntity.prototype.getAssociated=function(){return this.RequestAssociated(),this.m_Associated.m_Result?this.m_Associated.m_Result.paths:[]},XeEntity.prototype.getAssociatedPoints=function(){if(this.RequestAssociated(),this.m_Associated.m_Result)return this.m_Associated.m_Result.points},XeEntity.prototype.getAssociatedFilledAreaPoints=function(){if(this.RequestAssociated(),this.m_Associated.m_Result)return this.m_Associated.m_Result.filledAreaPoints},XeEntity.prototype.RequestBeautifulLine=function(){return this.m_OrdinateLinePoints=this.m_OrdinateLinePoints||XeRequest.prototype.FakePromise(this,this.getHandle(),"RequestBeautifulLine"),this.m_OrdinateLinePoints},XeEntity.prototype.getOrdinateLinePoints=function(){return this.RequestBeautifulLine(),this.m_OrdinateLinePoints.getResult()},XeEntity.prototype.drawGrip=function(e,t,i,r,n,o,a){t.fillStyle=o,t.strokeStyle=a,t.beginPath(),t.moveTo(i-n,r-n),t.lineTo(i-n,r+n),t.lineTo(i+n,r+n),t.lineTo(i+n,r-n),t.lineTo(i-n,r-n),t.fill(),t.stroke()},XeEntity.prototype.Hide=function(){this.setDrawMode(XeDrawMode.kHidden)},XeEntity.prototype.Show=function(){this.setDrawMode(XeDrawMode.kNormal)},XeEntity.prototype.getGripType=function(e){},XeEntity.prototype.onPreUpdate=function(){this.FirePreupdateNew(),this.m_PreviousDrawMode=this.m_XeDrawMode},XeEntity.prototype.onUpdateCommon=function(e){var t,i=e.getOwnerEntity();i&&delete i.m_XeGsOffsetsWithNested,e.m_E?(t=e.getXeEntities().getXeDocument().getXeGsDevice(),e.getParent()||1!==e.getPath().length||t.getXeColorPickingMap().deleteKey(e.getHandle()),window.getXeApplication().m_ErasedEntities.push(e.getHandle()),this.getXeDatabase().getXeEntities().R_E(this.getPath()),e.m_E=void 0):(e.m_XeDrawMode==XeDrawMode.kHidden?e.Hide():e.Show(),(1===e.getGiPath().length?e:i).FireUpdateNew())},XeEntity.prototype.onUpdate=function(){this.onUpdateCommon(this)},XeEntity.prototype.getItemNameByIndex=function(e){return["XeGsOffsets","Owner","Path","DrawOrder","Layer","Assoc","Class","XeDrawMode","Grips","ReactorId","CustomGrips"][e]},XeEntity.prototype.createClassByIndex=function(e){var t=[XeGsOffsets];return e>=t.length?{}:new t[e]},XeGlyphItem.prototype.getCache=function(){var e=XeGlyphItem.prototype.getType.call(this),t=XeGlyphItem.prototype.getVerts2d.call(this),i=XeGlyphItem.prototype.getIndexes.call(this);if(!t||!i||!e)return null;var r=0,n=t.length/2;if("PPL2"===e||"PPG2"===e)for(m=0;m<i.length;m++)1<i[m]?r+=2*i[m]-2:1==i[m]&&(r+=2);else"LS2"!==e&&"TS2"!==e||(r+=i.length);for(var o,a,s=new Float32Array(3*(1+n)),n=new Float32Array(1+n),c=XeWebGlRenderer.prototype.getIndexArrayType(r),l=1,d=0,u=0,p=l,m=0;m<t.length;m+=2)o=t[m],a=t[m+1],s[3*l]=o,s[3*l+1]=a,s[3*l+2]=0,l++;if(i=XeGlyphItem.prototype.getIndexes.call(this),"PPL2"===(e=XeGlyphItem.prototype.getType.call(this))||"PPG2"===e)for(m=0;m<i.length;m++){var h=i[m]-1;if(0<=h){for(c[d++]=p,u=1;u<h;u++)c[d]=c[d+1]=p+u,d+=2;c[d++]=p+h,p+=1+h}}else if("LS2"===e||"TS2"===e)for(m=0;m<i.length;m++)c[d++]=i[m]+p;e="TS2"===e?"TS":"LS";return(new XeDrawObjectUtils).createChunkGeometry(e,0,void 0,!1,c,s,n)};class XeGlyphItemDeserializer{static DeserializeGlyph(e,t){return new XeGlyphItem(t,e.get("Key"),void 0,e.get("Type"),e.get("Verts2d"),e.get("Indexes"))}}XeGlyphStorage.prototype.ClearGLCache=function(e){for(var t=this.getItems(),i=0;i<t.length;i++){var r=t[i];r&&(r.xeGlDrawObject&&XeGLDrawObject.prototype.deallocate(r.xeGlDrawObject),delete r.xeGlDrawObject)}},XeGlyphStorage.prototype.create_gl_geom=function(){for(var e=this.getItems(),t=0;t<e.length;t++){var i,r=e[t];!r||r.xeGlDrawObject||(i=XeGlyphItem.prototype.getCache.call(r))&&(r.xeGlDrawObject=i)}};class XeGlyphStorageDeserializer{static DeserializeXeGlyphStorage(e,t){let i=e.getXeGlyphStorage();i||(e.m_XeGlyphStorage=new XeGlyphStorage(e,[]),i=e.getXeGlyphStorage()),t.get("Items").forEach(e=>{i.m_Items.push(XeGlyphItemDeserializer.DeserializeGlyph(e,i))}),i.Fire(!0,!1,!1)}}function angle(e){let t=Math.atan2(e.y,e.x);return t<0?t+=2*Math.PI:0==t&&(GeNeo.OdZero(e.x)?t=GeNeo.OdLessOrEqual(e.y,0)?1.5*Math.PI:.5*Math.PI:e.x<0&&(t=Math.PI)),t}function angleOnPlane(e,t){var i=e.perpVector().normalize(),e=e.crossProduct(i).normalize();return angle(new GeNeo.OdGeVector2d(t.dotProduct(i),t.dotProduct(e)))}XeGroupDictionary.prototype.getXeDatabase=function(){return this.m_MyParent},XeGroupDictionary.prototype.deallocate=function(){},XeGroupDictionary.prototype.clean=function(){var e,t=this.getXeDatabase().getXeGroupDictionary();for(e in t)t.hasOwnProperty(e)&&t[e]&&delete t[e]},XeGroupDictionary.prototype.getGroupsByIdArray=function(e){var i,r=0,n=!1;function o(e){var t;return!!i&&(t=e,0===i.indexOf("m_")&&(t="m_"+e,0),i===t)}var t,a,s=e.map(function(e){return{id:e,found:!1}}),c=[];for([t,a]of Object.entries(this)){var l=this[t];if("XeDbGroup"===l.m_ClassName){let e=l.getAllEntityIds(),t=!1;for(r=0;r<s.length;r++)i=s[r].id,e.find(o)&&l.getIsSelectable()&&(n=s[r].found=!0,t=!0),i=void 0;t&&c.push(l)}}for(var d=[],r=0;r<s.length;r++)s[r].found||d.push(s[r].id);return{found:n,groupped:c,ungroupped:d}},XeGsArcItem.prototype.getExtents=function(){for(var e=new GeNeo.OdGeExtents3d,t=(new XeGiSimplifier).process_arc(this,"AVG").getVertexes(),i=new GeNeo.OdGePoint3d,r=1;r<t.length;r+=3)i.set(t[3*r],t[3*r+1],t[3*r+2]),e.addPoint(i);return e},XeGsArcItem.prototype.getOrder=function(){return this.m_d[1]},XeGsArcItem.prototype.getCenter=function(){var e=[];return e[0]=this.m_d[2],e[1]=this.m_d[3],e[2]=this.m_d[4],e},XeGsArcItem.prototype.getNormal=function(){var e=[];return e[0]=this.m_d[5],e[1]=this.m_d[6],e[2]=this.m_d[7],e},XeGsArcItem.prototype.getStartVector=function(){var e=[];return e[0]=this.m_d[8],e[1]=this.m_d[9],e[2]=this.m_d[10],e},XeGsArcItem.prototype.getRadius=function(){return this.m_d[11]},XeGsArcItem.prototype.getSweepAngle=function(){return this.m_d[12]},XeGsArcItem.prototype.copy_ext=function(e){},XeGsArcItem.prototype.getXeGsDrawViewport=function(){var e=this.getChunk();if(e)return e.getXeGsDrawViewport()},XeGsArcItem.prototype.process_points=function(e,t,i){var r=i;return i||(i=this.getXeGsDrawViewport(),r=new XeGiSimplifier(i)),r.process_arc(this,e,t),!0},XeGsArcItem.prototype.getTransform=function(){if(!this.m_TransformMatrix){var t=new GeNeo.OdGeMatrix3d;void 0!==this.m_CachedCircleRotationAngle&&t.setToRotation(this.m_CachedCircleRotationAngle,new GeNeo.OdGeVector3d(0,0,1),new GeNeo.OdGePoint3d(0,0,0));let e=new GeNeo.OdGeVector3d(this.getNormal()[0],this.getNormal()[1],this.getNormal()[2]);e.length()<GeNeo.equalVector()&&(e=new GeNeo.OdGeVector3d(0,0,1));var i=new GeNeo.OdGeMatrix3d,r=(i.setToPlaneToWorld(e),new GeNeo.OdGeMatrix3d),n=(r.setToTranslation(new GeNeo.OdGeVector3d(this.getCenter()[0],this.getCenter()[1],this.getCenter()[2])),new GeNeo.OdGeMatrix3d),r=(n.setToScaling(this.getRadius(),new GeNeo.OdGePoint3d(0,0,0)),r.mult(n).mult(i).mult(t));this.m_TransformMatrix=r}return this.m_TransformMatrix},XeGsArcItem.prototype.getAlphaBeta=function(){if(!this.m_AlphaBeta){var n=this.getStartVector(),n=new GeNeo.OdGeVector3d(n[0],n[1],n[2]);let e=new GeNeo.OdGeVector3d(this.getNormal()[0],this.getNormal()[1],this.getNormal()[2]);n=angleOnPlane(e=e.length()<GeNeo.equalVector()?new GeNeo.OdGeVector3d(0,0,1):e,n);let t=this.getSweepAngle(),i=(t<0&&(t=2*Math.PI+t),n>=Math.PI?n-2*Math.PI:n),r=(i-=Math.PI/2)+t;n=i;i=-r,(r=-n)>=2*Math.PI?(i-=2*Math.PI,r-=2*Math.PI):i<-2*Math.PI&&(i+=2*Math.PI,r+=2*Math.PI),i<0?(this.m_CachedCircleRotationAngle=-i,i=0,r+=this.m_CachedCircleRotationAngle):this.m_CachedCircleRotationAngle=0,this.m_AlphaBeta=[i,r]}return this.m_AlphaBeta},XeGsChildItem.prototype.getExtents=function(){for(var e=this.getXeGsDevice().getChunks(),t=new GeNeo.OdGeExtents3d,i=this.getChunks(),r=0;r<i.length;r++){var n,o,a=e["m_"+i[r]];a&&(o=a.getOwner(),n=a.getVpNum(),void 0!==o)&&void 0!==n&&void 0!==a.getGeometryToModelMatrix()&&(a.getGeometryToModelMatrix(),o=a.getExtents(),t.addPoint(o.minPoint()),t.addPoint(o.maxPoint()))}return t},XeGsChunk.prototype.getXeDocument=function(){return this.getXeGsDevice().getXeDocument()},XeGsChunk.prototype.getXeGsDevice=function(){return this.m_MyParent.getXeGsDevice()},XeGsChunk.prototype.IsXeCollectionMember=function(){return!0},XeGsChunk.prototype.FinalRelease=function(){this.getXeGsDevice().remove_from_chunk_cache(this),this.m_StoredDeviation=void 0,this.deallocateDrawObjects()},XeGsChunk.prototype.getLayerObject=function(){var e;return this.m_LayerObject||(e=this.getXeGsDevice().getXeDocument().getXeDatabase().getXeLayers()["m_"+this.getLayer()],this.m_LayerObject=e),this.m_LayerObject},XeGsChunk.prototype.getMAX_VERTEX_COUNT=function(){return XeWebDrawerEngine.prototype.bDrawInstancedLineweight?32767:3e3},XeGsChunk.prototype.getVertex=function(e){var t=this.getVertexes(),t=new GeNeo.OdGePoint3d(t[3*e],t[3*e+1],t[3*e+2]);return t.transformBy(this.getGeometryToModelMatrix()),t},XeGsChunk.prototype.getExtents=function(e){throw"XeGsChunk.prototype.getExtents"},XeGsChunk.prototype.draw_gdi=function(e,t,i,r,n){throw"XeGsChunk.prototype.draw_gdi"},XeGsChunk.prototype.getXeGsDrawViewport=function(){var e=this.getXeGsDevice().getXeGsViewports(),t="m_"+this.getVpNum();return e[t]||void 0},XeGsChunk.prototype.getRenderMode=function(){return this.m_RenderMode},XeGsChunk.prototype.recalculateGeometryByDeviation=function(e,t){},XeGsChunk.prototype.setGeometryToModelMatrix=function(e){this.m_GeometryToModelMatrix=new GeNeo.OdGeMatrix3d(e)},XeGsChunk.prototype.copy_ext=function(e){e.setGeometryToModelMatrix(this.getGeometryToModelMatrix()),e.invalidateChunk()},XeGsChunk.prototype.deallocateDrawObjects=function(){},XeGsChunk.prototype.iMAX_LINETYPE_ARRAY_COUNT=function(){return window.XeShaders.iMAX_LINETYPE_ARRAY_COUNT()},XeGsChunk.prototype.createDrawObjects=function(){},XeGsChunk.prototype.getColorPickingArray=function(){return this.m_ColorPickingArray||(this.m_ColorPickingArray=new XeGsColorPickingArray(this)),this.m_ColorPickingArray.resize(),this.m_ColorPickingArray},XeGsChunk.prototype.getColorPickingArraySize=function(){return 0},XeGsChunk.prototype.updateColorPickingColors=function(e){},XeGsChunk.prototype._copyToLTColorPickingArray=function(e){if(e){var t=e.geometry.attributes.index?.array,i=e.geometry.attributes.colorPickingColor?.array,r=e.geometry.attributes.ltColorPickingColor?.array;if(t&&i&&r){for(let e=0;e<t.length;e+=2){var n=4*t[e],o=4*t[e+1],a=4*(e+1),s=4*(e+1+1);r[a]=i[n],r[1+a]=i[1+n],r[2+a]=i[2+n],r[3+a]=i[3+n],r[s]=i[o],r[1+s]=i[1+o],r[2+s]=i[2+o],r[3+s]=i[3+o]}e.geometry.attributes.ltColorPickingColor.needsUpdate=!0}}},XeGsChunk.prototype.getDrawModes=function(){return this.m_XeDrawModes||(this.m_XeDrawModes={1:[],2:[],4:[],8:[],16:[]}),this.m_XeDrawModes},XeGsChunk.prototype.setDrawMode=function(e,t,i){var r,n,o=this.getDrawModes();for(r in o)o.hasOwnProperty(r)&&(n=parseInt(r),e!==XeDrawMode.kNormal&&n===e||o[r].length&&XeGsOffsetsHelper.IntersectXeGsOffsets(o[r],t,i,XeGsOffsetsHelper.XeGsOffsetsIntersectMethod.kRemoveFrom));e!==XeDrawMode.kNormal&&XeGsOffsetsHelper.IntersectXeGsOffsets(o[e],t,i,XeGsOffsetsHelper.XeGsOffsetsIntersectMethod.kAddTo),this.__setDrawModeImpl(e,t,i),this.invalidateChunk()},XeGsChunk.prototype.__setDrawModeImpl=function(e,t,i){},XeGsChunk.prototype.isDrawAllowed=function(e){var t=this.getVpNum(),i=this.getOwner(),r=1==i||2==i,i=2==i,n=!1;return t===e.getVpNum()?n=!0:0===t&&(n=!r||!!e.getOverall()==i),n},XeGsChunk.prototype.getSelectionIgnore=function(){return this.m_SelectionFlags&XeGiSubEntityTraitsData.prototype.SelectionFlags.kSelectionIgnore},XeGsChunk.prototype.getHighlightGeom=function(){return this.m_SelectionFlags&XeGiSubEntityTraitsData.prototype.SelectionFlags.kHighlightingGeometry},XeGsChunk.prototype.getHighlightIgnore=function(){return this.m_SelectionFlags&XeGiSubEntityTraitsData.prototype.SelectionFlags.kHiddenInHighlight},XeGsChunk.prototype.getDrawOnSelection=function(){return this.m_SelectionFlags&XeGiSubEntityTraitsData.prototype.SelectionFlags.kFxDrawWhenSelected},XeGsChunk.prototype.getSkipDrawOnSelection=function(){return this.m_SelectionFlags&XeGiSubEntityTraitsData.prototype.SelectionFlags.kFxSkipDrawWhenSelected},XeGsChunk.prototype.isImageChunk=function(){return"MS"===this.getType()},XeGsChunk.prototype.isTextChunk=function(){return"WS"===this.getType()},XeGsChunk.prototype.isSplineChunk=function(){return"SS"===this.getType()},XeGsChunk.prototype.isFromText=function(){return this.isTextChunk()||this.getTextFlags()},XeGsChunk.prototype.invalidateChunk=function(){this.isValid()&&(this.m_bValid=!1,this.getColorPickingArray())&&this.getColorPickingArray().invalidate(),this.isTracker()?this.getXeGsDevice().invalidateClientTrackersGL():(this.getXeGsDevice().invalidateScene(),this.getXeGsDevice().invalidateSelectionScene())},XeGsChunk.prototype.isValid=function(){return this.m_bValid},XeGsChunk.prototype.setValid=function(){this.m_bValid=!0},XeGsChunk.prototype.isTracker=function(){return-2===this.getOwner()},XeGsChunk.prototype.UpdateChunkCache=function(t){if(!this.isValid()){var i=this.getXeGsDevice();i.append_to_chunk_cache(this),(!this.isTracker()||window._LOG_GLOBAL.GET("SHOW_GSDATA_JSON_FOR_GL_TRACKERS"))&&(window._LOG_GLOBAL.SHOW("SHOW_GSDATA_JSON",">> XeGsSimpleChunk; id : "+this.getId()),window._LOG_GLOBAL.SHOW("SHOW_GSDATA_JSON",this));let e=i.getDeviation(i.getActiveViewport().getVpNum());t&&(e/=(new GeNeo.OdGeMatrix3d).fromFlatArray(t).scale());i=this.createDrawObjects(e);console.assert("boolean"==typeof i,"error with createDrawObjects",this),this.m_U=void 0,i&&this.setValid()}},XeGsChunk.prototype.isBlockRef=function(){return"HS"==this.m_Type},XeGsChunk.prototype.isFromBlock=function(){return 0==this.m_Owner},XeGsChunk.prototype.hasExtents=function(){return this.m_ExtentsMin&&this.m_ExtentsMax},XeGsChunk.prototype.getChunkExtents=function(){return new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(this.m_ExtentsMin[0],this.m_ExtentsMin[1],this.m_ExtentsMin[2]),new GeNeo.OdGePoint3d(this.m_ExtentsMax[0],this.m_ExtentsMax[1],this.m_ExtentsMax[2]))},XeGsChunk.prototype.drawChunk=function(i,r,n,o,a,s,c){this.UpdateChunkCache(),i.renderMode===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&this.updateColorPickingColors(),XeWebDrawerEngineImpl.prototype.__fillSceneArrayRecursionCounter++;var l=1<XeWebDrawerEngineImpl.prototype.__fillSceneArrayRecursionCounter,d=!1,u=this.getOwner(),p=this.getVpNum();if(void 0===u||void 0===p)window.XeLogger.error("Bad chunk -> chunk_owner = "+u+" || chunk_vpNum "+p);else{var m=n&&-1!==n&&-2!==n?(g=n.getVpNum(),n.getOverall()?2:1):(g=0,-1*n),d=u===m&&(0===p||p===g)||l&&0===u&&(0===p||p===g),m=(this.isTracker()&&(d=!0),this.getLayerObject());let e=m;window.IsOsVersion()&&r===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW&&m&&m.IsDefPoints()&&(d=!1);var h,g,u=this.isBlockRef();let t=a;l&&e&&"0"===e.getName()&&t&&(e=t.getByBlockLayer()),(d=n&&-1!==n&&-2!==n&&(!e||!u&&e.getOff()||n.isLayerFrozenInViewport(e,l))?!1:d)&&(o?h=o:(h=new XeChunkPassOptions,r===XeWebDrawerEngine.prototype.RENDERER_USER_VIEW?h.setIfNotPassArray(["getSelectionGeom","getHighlightGeom","getDrawOnSelection"]):r===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&h.setIfNotPassArray(["getSelectionIgnore","getHighlightGeom","getDrawOnSelection"])),p=c&&c.xeGsOffsets?c.xeGsOffsets:void 0,g=c&&c.colorArray?c.colorArray:void 0,m=c&&null!=c.alpha?c.alpha:void 0,a=c&&null!=c.lwPx?c.lwPx:void 0,d=c&&c.bAddLw?c.bAddLw:void 0,o=c&&c.xeColorPicker?c.xeColorPicker:void 0,r===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW&&(a=m=g=p=null,d=!1,o=l?o:null),u&&!l&&(t=new XeGiSubEntityTraitsData(this,void 0),(r=new OdCmEntityColor).m_RGBM=this.getColor(),t.setByBlockColor(r),t.setByBlockLayer(e),t.setByBlockLineWeight(this.getLineWeight()),(u=new OdCmTransparency).serializeIn(this.getTransparency()),t.setByBlockTransparency(u),t.setByBlockLinetypeTableRecordName(this.getLinetypeTableRecordName())),this.DrawChunkInternal(i,n,p,g,m,a,d,o,h,t,s,c)),XeWebDrawerEngineImpl.prototype.__fillSceneArrayRecursionCounter--}},XeGsChunk.prototype.A_IU=function(e,t,i,r,n,o,a,s,c,l,d,u,p){},XeGsChunk.prototype.U_IU=function(){},XeGsChunk.prototype.E_IU=function(){},XeGsChunk.prototype.A_SU=function(e,t,i,r,n){},XeGsChunk.prototype.U_SU=function(){},XeGsChunk.prototype.E_SU=function(){},XeGsChunk.prototype.isTransparent=function(){var e=this.getLayerObject();return XeGiSubEntityTraitsData.prototype.resolveTransparency(this,e)<255},XeGsChunk.prototype.getLinetypeTableRecord=function(){if(!this.m_bLinetypeTableRecord){this.m_bLinetypeTableRecord=!0,this.m_LinetypeTableRecord=void 0;var e=this.getLayerObject(),e=XeGiSubEntityTraitsData.prototype.resolveLinetype(this,e);if(!e)return this.m_LinetypeTableRecord;if(0==this.getLinetypeScale())return this.m_LinetypeTableRecord;if(e.getArrayPattern().length<2)return this.m_LinetypeTableRecord;this.m_LinetypeTableRecord=e}return this.m_LinetypeTableRecord},XeGsChunk.prototype.hasLinetype=function(){return this.m_bLinetypeTableRecord||this.getLinetypeTableRecord(),void 0!==this.m_LinetypeTableRecord},XeGsChunk.prototype.getLinetypeTableRecordHandle=function(){return this.m_bLinetypeTableRecord||this.getLinetypeTableRecord(),this.m_LinetypeTableRecord?this.m_LinetypeTableRecord.getHandle():"0"},XeGsChunk.prototype.getArcType=function(){return"CS"==this.m_Type?2:"AS"==this.m_Type||"EAS"==this.m_Type||"SS"==this.m_Type?1:void 0===this.m_ArcType?0:this.m_ArcType},XeGsChunk.prototype.setArcType=function(e){return this.m_ArcType=e},XeGsChunk.prototype.getHasNormal=function(){return void 0===this.m_HasNormal&&(this.m_HasNormal=-1!=this.m_Type.indexOf("N")),!!this.m_HasNormal},XeGsChunk.prototype.setShaderKey=function(e){this.m_shaderKey=e},XeGsChunk.prototype.setLTShaderKey=function(e){this.m_ltShaderKey=e},XeGsChunk.prototype.setShader=function(e){this.m_Shader=e},XeGsChunk.prototype.getShaderKey=function(){return this.m_shaderKey},XeGsChunk.prototype.getLTShaderKey=function(){return this.m_ltShaderKey},XeGsChunk.prototype.getShader=function(){return this.m_Shader},XeGsChunk.prototype.DrawChunkInternal=function(i,r,n,o,a,s,c,l,d,u,p,m,h){if(0!=this.getOwner()&&this.hasExtents()){var g=this.getChunkExtents();if(g.isValidExtents()){var g=new GeNeo.OdGeExtents3d(g.minPoint(),g.maxPoint()),y=(m&&m.transform_base&&g.transformBy(m.transform_base),g.transformBy(this.getGeometryToModelMatrix()),g.transformBy(r.worldToDeviceMatrix()),g=new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(g.minPoint().x,g.minPoint().y,0),new GeNeo.OdGePoint3d(g.maxPoint().x,g.maxPoint().y,0)),r.visibleScreenRect());if(new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(y.xmin,y.ymin,0),new GeNeo.OdGePoint3d(y.xmax,y.ymax,0)).intersectWithExtents(g)==GeNeo.OdGeExtents3d.kIntersectNot)return}}if((!window.IsOsVersion()||_!==XeWebDrawerEngine.prototype.RENDERER_USER_VIEW||!this.getLayerObject().IsDefPoints())&&(!d||d.check(this))){p&&(y=p(this,r,n,o,a,s,c,l,d,u))&&(r=y.in_XeGsViewport,n=y.in_XeGsOffsets_OR_NULL,o=y.in_ColorArray_OR_NULL,a=y.in_Alpha_OR_NULL,s=y.in_LwPx_OR_NULL,c=y.in_bAddLw,l=y.in_XeColorPickerParams_OR_Undef,d=y.in_XeChunkPassOptions_OR_Undef,u=y.in_XeGiSubEntityTraitsData_OR_Undef);g=this.getXeGsDevice().getXeDocument().getXeDatabase();if(this.isValid()){var f,_=window.getXeApplication().getDrawingEngine().getActualRenderMode(),p=(!window.IsOsVersion()||window.getXeApplication().GetCapability("new_lwlt_shader_draw"))&&!window.forceOldLWLTShader();p||void 0===c&&(c=!0),o&&((f=[o[0],o[1],o[2]])[0]=1<f[0]?f[0]/255:f[0],f[1]=1<f[1]?f[1]/255:f[1],f[2]=1<f[2]?f[2]/255:f[2]);let e=!1;e=p?(d=_==XeWebDrawerEngine.prototype.RENDERER_CP_VIEW,!(2*XeLineWeightModule.getHalfLwPixelWidth(r,this,u)+(s||0)<2)&&!d&&(0<s&&c||g.getLWDISPLAY())):(g.getXeLinetypeTable(),y=this.getLayerObject(),o=!1,(p=XeGiSubEntityTraitsData.prototype.resolveLinetype(this,y,null))&&(o=2<=p.getArrayPattern().length),0<s||c&&(g.getLWDISPLAY()||o));_={};Object.assign(_,h);let t;(t=_.xeGlDrawObject||this.getGLDrawObject())&&(_.m_xeGsChunk=this,_.m_xeGsChunkDecoration=m,_.m_xeGsChunkTraits=u,n&&(_.offsets=n),f&&(_.color=f),null!==a&&(_.alpha=a),l&&l.uniform_CPColor&&(_.uniform_CPColor=l.uniform_CPColor),_.bInsideBlockDraw=1<XeWebDrawerEngineImpl.prototype.__fillSceneArrayRecursionCounter,XeWebDrawerEngine.prototype.bDrawInstancedLineweight&&(d=this.getType(),_.bDrawLineweightLine=e&&("LS"===d||"LSN"===d||"LSNC"===d||"IS"===d||"CS"===d||"AS"===d||"EAS"===d),0<s)&&(_.lwPx=s),t.draw_gl_object(i,r,_))}}},XeGsChunk.prototype._fillColorPickingArray=function(e,t,i,r){if(e){var n=e.geometry.attributes.index?.array,o=e.geometry.attributes.colorPickingColor?.array;if(n&&o){for(var a=t;a<t+i;a++)o[4*n[a]+3]=((4278190080&r)>>24)/255,o[4*n[a]+0]=((16711680&r)>>16)/255,o[4*n[a]+1]=((65280&r)>>8)/255,o[4*n[a]+2]=(255&r)/255;e.geometry.attributes.colorPickingColor.needsUpdate=!0}}},XeGsChunk.prototype.onPreUpdate=function(e){},XeGsChunk.prototype.onUpdate=function(e){e.invalidateChunk()},XeGsChunk.prototype.getItemNameByIndex=function(e){return["ExtentsMin","ExtentsMax","Id","Type","VpNum","Denominator","Layer","LineWeight","PlineGen","LinetypeScale","LinetypeTableRecordName","Color","Transparency","GeometryToModelMatrix","TrackerName","SelectionFlags","SelectionGeom","DrawFlags","RenderMode","Owner","Flags","TextFlags"][e]},XeGsChunk.prototype.createClassByIndex=function(e){return{}},XeGsCircleItem.prototype.getExtents=function(){for(var e=new GeNeo.OdGeExtents3d,t=(new XeGiSimplifier).process_ellipse(this,"AVG").getVertexes(),i=new GeNeo.OdGePoint3d,r=1;r<t.length;r+=3)i.set(t[3*r],t[3*r+1],t[3*r+2]),e.addPoint(i);return e},XeGsCircleItem.prototype.getOrder=function(){return this.m_d[1]},XeGsCircleItem.prototype.getCenter=function(){var e=[];return e[0]=this.m_d[2],e[1]=this.m_d[3],e[2]=this.m_d[4],e},XeGsCircleItem.prototype.getxDir=function(){var e=[];return e[0]=this.m_d[5],e[1]=this.m_d[6],e[2]=this.m_d[7],e},XeGsCircleItem.prototype.getyDir=function(){var e=[];return e[0]=this.m_d[8],e[1]=this.m_d[9],e[2]=this.m_d[10],e},XeGsCircleItem.prototype.getNormal=function(){var e=[];return e[0]=this.m_d[11],e[1]=this.m_d[12],e[2]=this.m_d[13],e},XeGsCircleItem.prototype.getRadius=function(){return void 0===this.m_Radius&&(this.m_Radius=this.m_d[14],this.m_roundedRadius=+this.m_Radius.toFixed(6)),this.m_roundedRadius},XeGsCircleItem.prototype.copy_ext=function(e){},XeGsCircleItem.prototype.getXeGsDrawViewport=function(){var e=this.getChunk();if(e)return e.getXeGsDrawViewport()},XeGsCircleItem.prototype.process_points=function(e,t,i){var r=i;return i||(i=this.getXeGsDrawViewport(),r=new XeGiSimplifier(i)),r.process_circle(this,e,t),!0},XeGsCircleItem.prototype.getGrips=function(){var i=this.getChunk();if(i){var r=this.getCenter(),n=this.getNormal(),o=this.getRadius(),i=((r=new GeNeo.OdGePoint3d(r[0],r[1],r[2])).transformBy(i.getGeometryToModelMatrix()),(n=new GeNeo.OdGeVector3d(n[0],n[1],n[2])).transformBy(i.getGeometryToModelMatrix()),this.m_Grips=[],new GeNeo.OdGeMatrix3d);i.setToPlaneToWorld(n);let e=i.getCsXAxis(),t=(e=e.mult(o),i.getCsYAxis());return t=t.mult(o),this.m_Grips.push([r.x,r.y,r.z]),this.m_Grips.push([r.x+e.x,r.y+e.y,r.z+e.z]),this.m_Grips.push([r.x-e.x,r.y-e.y,r.z-e.z]),this.m_Grips.push([r.x+t.x,r.y+t.y,r.z+t.z]),this.m_Grips.push([r.x-t.x,r.y-t.y,r.z-t.z]),this.m_Grips}},XeGsCircleItem.prototype.getTransform=function(){if(!this.m_TransformMatrix){let e=new GeNeo.OdGeVector3d(this.getNormal()[0],this.getNormal()[1],this.getNormal()[2]);e.length()<GeNeo.equalVector()&&(e=new GeNeo.OdGeVector3d(0,0,1));var t=new GeNeo.OdGeMatrix3d,i=(t.setToPlaneToWorld(e),new GeNeo.OdGeMatrix3d),r=(i.setToTranslation(new GeNeo.OdGeVector3d(this.getCenter()[0],this.getCenter()[1],this.getCenter()[2])),new GeNeo.OdGeMatrix3d),i=(r.setToScaling(this.getRadius(),new GeNeo.OdGePoint3d(0,0,0)),i.mult(r).mult(t));this.m_TransformMatrix=i}return this.m_TransformMatrix},document.addEventListener("PreUpdate_XeGsGeometryChunks",function(e){e.m_FullUpdate&&e.m_Item.getXeGsDevice().getChunkCache().trackers.reset()}),document.addEventListener("Update_XeGsSimpleChunk",function(e){e.m_Item.invalidateChunk()}),document.addEventListener("Update_XeGsIndexedChunk",function(e){e.m_Item.invalidateChunk()}),document.addEventListener("PreUpdate_XeGsArcItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsArcItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("PreUpdate_XeGsCircleItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsCircleItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("PreUpdate_XeGsTextItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsTextItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("PreUpdate_XeGsChildItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsChildItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("PreUpdate_XeGsImageItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsImageItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("PreUpdate_XeGsInfiniteItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsInfiniteItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("PreUpdate_XeGsOLEItem",function(e){XeGsDevice.prototype.PreUpdate_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeGsOLEItem",function(e){XeGsDevice.prototype.Update_XeGsSimpleItem.call(void 0,e.m_Item)}),document.addEventListener("Update_XeLayer",function(e){var t=(new Date).getTime();XeGsDevice.prototype.Update_XeLayer_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("Update_XeGlyphStorage",function(e){e=e.m_Item;XeWebGlRenderer.prototype.global_gl_context&&e.create_gl_geom()}),document.addEventListener("PreUpdate_XeGsDevice",function(e){var t=(new Date).getTime();XeGsDevice.prototype.PreUpdate_XeDevice_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("Update_XeGsDevice",function(e){var t=(new Date).getTime();XeGsDevice.prototype.Update_XeDevice_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("PreUpdate_XeLayoutPaper",function(e){var t=(new Date).getTime();XeGsDevice.prototype.PreUpdate_XeLayoutPaper_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("Update_XeLayoutPaper",function(e){var t=(new Date).getTime();XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("XeGsDevice_LastChunk",function(e){var t=(new Date).getTime();XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("PreUpdate_XeGsViewports",function(e){var t=(new Date).getTime();XeGsDevice.prototype.PreUpdate_XeGsViewports_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("Update_XeGsViewports",function(e){var t=(new Date).getTime();XeGsDevice.prototype.Update_XeGsViewports_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("PreUpdate_XeGsViewport",function(e){var t=(new Date).getTime();XeGsDevice.prototype.PreUpdate_XeGsViewport_Handler.call(void 0,e.m_Item,e.m_FullUpdate),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("Update_XeGsViewport",function(e){var t=(new Date).getTime();XeGsDevice.prototype.Update_XeViewport_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("PreUpdate_XeDatabase",function(e){e.m_Item}),document.addEventListener("Update_XeDatabase",function(e){var t=(new Date).getTime(),e=e.m_Item.getXeDocument().getXeGsDevice();e&&e.invalidateScene(),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("PreUpdate_XeEntities",function(e){}),document.addEventListener("Update_XePalette",function(e){var t=(new Date).getTime();XeGsDevice.prototype.Update_XePalette_Handler.call(void 0,e.m_Item),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})}),document.addEventListener("Update_XeSelectionSet",function(e){e=e.m_Item.getXeDocument().getXeGsDevice();e&&(e.invalidateClientTrackers(),e.invalidateClientTrackersGL())}),document.addEventListener("Update_XeDocument",function(e){}),document.addEventListener("Update_XeCommandProcessor",function(e){e.m_Item.getXeDocument().getXeInputPointManager().InvalidateApertureSelection()}),document.addEventListener("XeClientStateUpdated",function(e){e=e.m_Item.getXeGsDevice();e&&(e.invalidateClientTrackers(),e.invalidateClientTrackersGL())}),document.addEventListener("XeStopLoadingTextureImgEvent",function(e){e.m_Item;var e=window.getXeActiveDocument();e&&(e=e.getXeGsDevice())&&(e.invalidateScene(),e.invalidateSelectionScene())}),XeGsDevice.prototype.FinalConstruct=function(){this.m_ColorPickingMap=new XeColorPickingMap,this.m_ChunkCache={paperspace:new XeChunkCache,modelspace:new XeChunkCache,trackers:new XeChunkCache,blocks:new XeChunkCache};let r=this;this.setFrameLoop_counter=0,this.setFrameLoop_requestAnimationFrameId=0,this.m_bSceneValid=!1,this.m_bClientTrackersValid=!1,this.m_bClientTrackersGLValid=!1,this.m_bServerTrackersValid=!1,this.m_bSelectionSceneValid=!1,this.m_bZoomSwitch=!1,this.m_bPanningSwitch=!1,this.m_bOrbitSwitch=!1,this.m_bDynamicZoomSwitch=!1,this.m_bContinuousActionSwitch=!1,this.m_MousePanDown=null,this.m_MousePanDownInitialScr=null,this.m_ZoomCallbackFuncArray=[],this.getXeColorPickingMap().reset(),this.invalidateColorPickingMap(),this.m_Chunks=new XeGsGeometryChunks(this),r._frame_loop_handler_=function(e){var t,i=r.getXeDocument().getXeInputPointManager().getInputPointManager();e&&i&&(t=i.getMouse3dConnexion())&&t._3Dconnexion&&t.isInMotion&&t._3Dconnexion.update3dcontroller({frame:{time:e}}),i?(r.setFrameLoop_requestAnimationFrameId=window.requestAnimationFrame(r._frame_loop_handler_),0===r.setFrameLoop_counter&&(window.cancelAnimationFrame(r.setFrameLoop_requestAnimationFrameId),r.setFrameLoop_requestAnimationFrameId=0),0<window.XeAnimationsRunning.count||window.XeAnimationsRunning.draw_last?window.XeAnimationsRunning.draw_last&&(window.XeAnimationsRunning.draw_last=!1):r.calcPan()||r.getOrbit(),r.getZoomPanViewport().invalidate(),r.invalidateViewports(),r.invalidateScene(),r.invalidateClientTrackers(),r.invalidateClientTrackersGL(),r.invalidateSelectionScene()):(r.setFrameLoop_requestAnimationFrameId&&window.cancelAnimationFrame(r.setFrameLoop_requestAnimationFrameId),r.setFrameLoop_counter=0,r.setFrameLoop_requestAnimationFrameId=0)}},XeGsDevice.prototype.FinalRelease=function(){},XeGsDevice.prototype.MyAddress=function(){return this.getXeDocument().MyAddress()+".m_XeGsDevice"},XeGsDevice.prototype.getXeDocument=function(){return this.m_MyParent},XeGsDevice.prototype.updateViewportsDCSize=function(){var e,t=this.getXeGsViewports();if(this.getOverallViewport())this.UpdatePaperViewportsSize();else for(e in t){var i=t.getByVpnum(e);i&&i.setViewportDc({xmin:i.getVisibleScreenRect_m_min_x(),ymin:this.getPixelHeight()-i.getVisibleScreenRect_m_min_y(),xmax:i.getVisibleScreenRect_m_min_x()+i.getVisiblePxWidth(),ymax:this.getPixelHeight()-i.getVisibleScreenRect_m_min_y()+i.getVisiblePxHeight()})}},XeGsDevice.prototype.UpdatePaperViewportsSize=function(){var e,t=this.getXeGsViewports(),i=this.getOverallViewport();if(i){i.setViewportDc({xmin:0,xmax:this.getPixelWidth(),ymin:0,ymax:this.getPixelHeight()});var r=i.worldToDeviceMatrix();for(e in t){var n,o,a,s,c=t.getByVpnum(e);c&&!c.getOverall()&&(s=c.getWidth()/2,n=c.getHeight()/2,o=c.getCenter(),a=new GeNeo.OdGePoint3d(o[0]-s,o[1]-n,0),s=new GeNeo.OdGePoint3d(o[0]+s,o[1]+n,0),a.transformBy(r),s.transformBy(r),c.setViewportDc({xmin:a.x,xmax:s.x,ymin:a.y,ymax:s.y}))}}},XeGsDevice.prototype.invalidateViewports=function(){var e,t=this.getXeGsViewports();for(e in t){var i=t.getByVpnum(e);i&&i.invalidate()}this.updateViewportsDCSize()},XeGsDevice.prototype.getActiveViewport=function(){return this.getXeGsViewports().getActiveViewport()},XeGsDevice.prototype.getOverallViewport=function(){var e,t=this.getXeGsViewports();for(e in t){var i=t.getByVpnum(e);if(i&&!0===i.getOverall())return i}},XeGsDevice.prototype.getZoomPanViewport=function(){var e=this.getActiveViewport();return e&&(!0===e.getLocked()?this.getOverallViewport():e)},XeGsDevice.prototype.FireLastChunkSent=function(){var e=document.createEvent("Event");e.initEvent("XeGsDevice_LastChunk",!0,!0),e.m_XeDocument=this.getXeDocument(),document.dispatchEvent(e),window.XeLogger.debug("--Last Chunk--")},XeGsDevice.prototype.FireLastEntitySent=function(){var e=this.getXeDocument(),t=e.getXeDatabase(),e=e.getXeInputPointManager(),t=(t&&t.getXeEntities()&&t.getXeEntities().ProcessOrphanes(),this.invalidateColorPickingMap(),e.InvalidateApertureSelection(),this.invalidateSelectionScene(),document.createEvent("Event"));t.initEvent("XeGsDevice_LastEntity",!0,!0),t.m_Item=this,t.m_XeDocument=this.getXeDocument(),document.dispatchEvent(t),window.XeLogger.debug("--Last Entity--")},XeGsDevice.prototype.getDeviation=function(e,t){var i=null,r=this.getXeGsViewports();if(0===e){var n,o=!1,a=!1;for(n in t&&(o=1==(t=t.getOwner())||2==t,a=2==t),r){var s=r.getByVpnum(n);!s||o&&a&&!s.getOverall()||(null===i||s.getDeviation()<i)&&(i=s.getDeviation())}null===i&&(i=.5)}else t=r.getByVpnum(e),i=t?t.getDeviation():.5;return i},XeGsDevice.prototype.setFadeMode=function(e){this.m_FadeMode=e},XeGsDevice.prototype.AdjustViewports=function(e,t){var i=this.m_PixelWidth,r=this.m_PixelHeight,n=(this.m_PixelWidth=e)/i,o=(this.m_PixelHeight=t)/r,a=this.getXeGsViewports(),e=this.getOverallViewport();if(e)e.m_FieldWidth=e.m_FieldWidth*n,e.m_FieldHeight=e.m_FieldHeight*o;else for(var s in a)(s=a.getByVpnum(s))&&(s.m_FieldWidth=s.m_FieldWidth*n,s.m_FieldHeight=s.m_FieldHeight*o);this.invalidateViewports()},XeGsDevice.prototype.ValidateChunks=function(){var e=(new Date).getTime();let a=this.getXeDocument().getXeDatabase().getDEVOPTIONS()&DEVOPTIONS.DEVOPTIONS_DISABLE_CLIENT_SIDE_REGEN,t,s=(a||(t=this.getXeDocument().getXeGsDevice(),a=t.getPan()||t.getZoom()||t.getOrbit()),this.getActiveViewport()),c=new Set,l=(e,t,i=!1)=>{var r=d.getById(e);if(r&&(!r.isFromBlock()||i)&&!c.has(e)){if(c.add(e),r.isBlockRef())for(var n of r.m_Items)if(n instanceof XeGsChildItem)for(var o of n.m_Chunks)l(o,n.getTransform(),!0);a||r.recalculateGeometryByDeviation(s,t),r.UpdateChunkCache(t)}},d=this.getChunks();if(d)for(var i of d.getChunkIdList()){if(100<(new Date).getTime()-e){this.invalidateClientTrackers();break}l(i)}this.getXeColorPickingMap().updateChunks(this.getXeDocument())},XeGsDevice.prototype.invalidateScene=function(){this.getXeDocument().getXeInputPointManager().getPENDING()&&window.__IsDebugMode&&window.XeLogger.debug("invalidateScene is called from tracker"),this.m_bSceneValid=!1,this.m_bClientTrackersValid=!1,this.m_bClientTrackersGLValid=!1,this.m_bServerTrackersValid=!1,window.getXeApplication().dispatchRedrawEvent()},XeGsDevice.prototype.invalidateClientTrackers=function(){this.m_bClientTrackersValid=!1,window.getXeApplication().dispatchRedrawEvent()},XeGsDevice.prototype.invalidateClientTrackersGL=function(){this.m_bClientTrackersGLValid=!1,window.getXeApplication().dispatchRedrawEvent()},XeGsDevice.prototype.invalidateServerTrackers=function(){this.m_bServerTrackersValid=!1,window.getXeApplication().dispatchRedrawEvent()},XeGsDevice.prototype.invalidateSelectionScene=function(){this.m_bSelectionSceneValid=!1},XeGsDevice.prototype.invalidateColorPickingMap=function(){this.getXeColorPickingMap().invalidate()},XeGsDevice.prototype.getFxGDIDevice=function(){return this.m_FxGDIDevice||(this.m_FxGDIDevice=new CFxGDIContext(this.getXeDocument()),this.m_FxGDIDevice.initGDIContext(this.getXeDocument())),this.m_FxGDIDevice},XeGsDevice.prototype.append_to_chunk_cache=function(e){var t=this.getChunkCache();switch(e.getOwner()){case-2:t.trackers.add(e);break;case 1:case 2:case 0:break;default:}},XeGsDevice.prototype.remove_from_chunk_cache=function(e){var t=this.getChunkCache();switch(e.getOwner()){case-2:t.trackers.remove(e);break;case 1:case 2:case 0:break;default:}},XeGsDevice.prototype.clear_chunk_cache=function(){var e=this.getChunkCache();e.trackers.reset(),e.modelspace.reset(),e.paperspace.reset(),e.blocks.reset()},XeGsDevice.prototype.getPan=function(){return this.m_bPanningSwitch},XeGsDevice.prototype.setPan=function(t,i){if(this.m_bPanningSwitch!==t){(this.m_bPanningSwitch=t)&&(this.setZoom(!1),this.setOrbit(!1)),this.setContinuousAction(t),XeWebDrawerEngine.prototype.Performance_use_regenabort&&(t?this.getXeRenderer().setRegenAbortTiming(XeWebDrawerEngine.prototype.Performance_use_regenabort_timing):this.getXeRenderer().setRegenAbortTiming(-1));var r=this.getZoomPanViewport(),n=this.getXeDocument().getXeInputPointManager();let e=[0,0];(e=n?[n.getHitTestInfo().GetMousePosition().x,n.getHitTestInfo().GetMousePosition().y]:e)[1]=this.getPixelHeight()-e[1],e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),t&&!this.m_MousePanDownInitialScr&&(this.m_MousePanDownInitialScr=e);Math.sqrt(this.m_MousePanDownInitialScr[0]*this.m_MousePanDownInitialScr[0]+this.m_MousePanDownInitialScr[1]*this.m_MousePanDownInitialScr[1]),Math.sqrt(e[0]*e[0]+e[1]*e[1]);this.m_MousePanDown=i?new GeNeo.OdGePoint3d(i.x,i.y,i.z):n.getInputPointManager().PointToWCS(r,e),!this.m_bPanningSwitch&&n&&n.sendViewStateToServer(this.getXeDocument(),r),this.invalidateScene()}t||this.m_bPanningSwitch||(this.m_MousePanDown=void 0,this.m_MousePanDownInitialScr=void 0)},XeGsDevice.prototype.calcPan=function(){return this.calcPanImpl()},XeGsDevice.prototype.calcPanImpl=function(){var e,t=this.getXeDocument(),i=this.getZoomPanViewport();return!!i&&!(!this.m_bPanningSwitch||!this.m_MousePanDown||(e=[0,0],(e=(t=t.getXeInputPointManager())?[t.getHitTestInfo().GetMousePosition().x,t.getHitTestInfo().GetMousePosition().y]:e)[1]=this.getPixelHeight()-e[1],e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),t=t.getInputPointManager().PointToWCS(i,e),i.preventServerNotify(!0),(e=t.sub(this.m_MousePanDown)).transformBy(i.viewingMatrix()),e=e.negate(),i.dolly(e),i.preventServerNotify(!1),this.invalidateViewports(),0))},XeGsDevice.prototype.getOrbit=function(){return this.m_bOrbitSwitch},XeGsDevice.prototype.setOrbit=function(e){this.m_bOrbitSwitch=e},XeGsDevice.prototype.getDynamicZoom=function(){return this.m_bDynamicZoomSwitch},XeGsDevice.prototype.setDynamicZoom=function(e){this.m_bDynamicZoomSwitch=e},XeGsDevice.prototype.getContinuousAction=function(){return this.m_bContinuousActionSwitch},XeGsDevice.prototype.setContinuousAction=function(e){this.getContinuousAction()!==e&&(this.setFrameLoop(e),this.m_bContinuousActionSwitch=e)},XeGsDevice.prototype.setFrameLoop=function(e){var t=this.getXeDocument().getXeInputPointManager().getInputPointManager();this.setFrameLoop_counter=e?this.setFrameLoop_counter+1:this.setFrameLoop_counter-1,this.setFrameLoop_counter<0&&(this.setFrameLoop_counter=0),0<this.setFrameLoop_counter?this.setFrameLoop_requestAnimationFrameId||this._frame_loop_handler_():this.setFrameLoop._requestAnimationFrameId&&!t.DoZoom_Viewport_States.length&&(window.cancelAnimationFrame(this.setFrameLoop_requestAnimationFrameId),this.setFrameLoop_requestAnimationFrameId=0)},XeGsDevice.prototype.getZoom=function(){return this.m_bZoomSwitch},XeGsDevice.prototype.setZoom=function(e){var t,i;this.m_bZoomSwitch!==e&&((this.m_bZoomSwitch=e)&&(this.setPan(!1),this.setOrbit(!1)),i=(t=this.getXeDocument()).getXeInputPointManager(),e||i.sendViewStateToServer(t))},XeGsDevice.prototype.getChunkCache=function(){return this.m_ChunkCache},XeGsDevice.prototype.getXeColorPickingMap=function(){return this.m_ColorPickingMap},XeGsDevice.prototype.Update_XePalette_Handler=function(e){},XeGsDevice.prototype.PreUpdate_XeDevice_Handler=function(){},XeGsDevice.prototype.Update_XeDevice_Handler=function(e,t){},XeGsDevice.prototype.PreUpdate_XeGsViewports_Handler=function(){},XeGsDevice.prototype.Update_XeGsViewports_Handler=function(){},XeGsDevice.prototype.PreUpdate_XeGsViewport_Handler=function(e,t){},XeGsDevice.prototype.Update_XeViewport_Handler=function(e){var t=e.getXeGsDevice();e.invalidate(),e.createStencilScene(),t.invalidateScene(),t.invalidateSelectionScene(),t.getXeDocument().getXeInputPointManager().InvalidateApertureSelection()},XeGsDevice.prototype.PreUpdate_XeLayoutPaper_Handler=function(e){if(e.getScene&&e.getScene()){for(var t=e.getScene(),i=t.children.length,r=0;r<i;r++)XeGLDrawObject.prototype.deallocate(t.children[r]);t.children=[]}},XeGsDevice.prototype.Update_XeLayer_Handler=function(e){var e=e.getXeDocument(),t=e.getXeGsDevice();t&&(t.invalidateScene(),t.invalidateSelectionScene()),e.getXeDatabase()&&e.getXeDatabase().getXeEntities()&&e.getXeDatabase().getXeEntities().InvalidateLayerObjects(),t&&t.getChunks()&&t.getChunks().InvalidateLayerObjects(),e.getXeInputPointManager().InvalidateApertureSelection()},XeGsDevice.prototype.PreUpdate_XeGsSimpleItem=function(e){var t=(new Date).getTime();e&&e.invalidate(),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})},XeGsDevice.prototype.Update_XeGsSimpleItem=function(e){var t=(new Date).getTime();e&&e.invalidate(),XeWebDrawerEngine.prototype.bIsCollectStatisticEnabled&&XeWebDrawerEngine.prototype.emit_event("XeDrawingEngineProc",{data:{process_time:(new Date).getTime()-t,timestamp:(new Date).getTime()}})},XeGsDevice.prototype.StartGLProcessing=function(e){this.setPan(!1),this.setOrbit(!1),this.setContinuousAction(!1),this.m_MousePanDown=void 0,this.invalidateScene()},XeGsDevice.prototype.StopGLProcessing=function(e){this.setPan(!1),this.setOrbit(!1),this.setContinuousAction(!1),this.m_MousePanDown=void 0,this.getFxGDIDevice().ClearCache();var t=this.getXeDocument().getXeDatabase().getXeLayout().getPaper(),i=this.getXeGsViewports();if(i)for(var r in i){r=i.getByVpnum(r);r&&r.getStencilScene&&(XeWebDrawerEngine.prototype.deallocateScene(r.getStencilScene()),r.getStencilScene=void 0)}var n=this.getChunks();if(n)for(var o of n.getChunkIdList()){o=n.getById(o);o&&(o.deallocateDrawObjects(e),o.invalidateChunk())}t&&t.getScene&&(XeWebDrawerEngine.prototype.deallocateScene(t.getScene()),delete t.getScene,delete t.m_Scene),this.__screenCacheTexture&&(e.deleteTexture(this.__screenCacheTexture),delete this.__screenCacheTexture)},XeGsEllipArcItem.prototype.getOrder=function(){return this.m_d[1]},XeGsEllipArcItem.prototype.getCenter=function(){var e=[];return e[0]=this.m_d[2],e[1]=this.m_d[3],e[2]=this.m_d[4],e},XeGsEllipArcItem.prototype.getxDir=function(){var e=[];return e[0]=this.m_d[5],e[1]=this.m_d[6],e[2]=this.m_d[7],e},XeGsEllipArcItem.prototype.getyDir=function(){var e=[];return e[0]=this.m_d[8],e[1]=this.m_d[9],e[2]=this.m_d[10],e},XeGsEllipArcItem.prototype.getNormal=function(){var e=[];return e[0]=this.m_d[11],e[1]=this.m_d[12],e[2]=this.m_d[13],e},XeGsEllipArcItem.prototype.getMajorRadius=function(){return this.m_d[14]},XeGsEllipArcItem.prototype.getMinorRadius=function(){return this.m_d[15]},XeGsEllipArcItem.prototype.getStartAng=function(){return this.m_d[16]},XeGsEllipArcItem.prototype.getEndAng=function(){return this.m_d[17]},XeGsEllipArcItem.prototype.getXeGsDrawViewport=function(){var e=this.getChunk();if(e)return e.getXeGsDrawViewport()},XeGsEllipArcItem.prototype.process_points=function(e,t,i){var r=i;return i||(i=this.getXeGsDrawViewport(),r=new XeGiSimplifier(i)),r.process_ellipse(this,e,t),!0},XeGsEllipArcItem.prototype.isCircular=function(e){var t=new GeNeo.OdGeVector3d(this.getxDir()[0],this.getxDir()[1],this.getxDir()[2]),i=new GeNeo.OdGeVector3d(this.getyDir()[0],this.getyDir()[1],this.getyDir()[2]),t=Math.abs(t.dotProduct(i)),i=Math.abs(this.getMajorRadius()-this.getMinorRadius());return t<=e&&i<=e},XeGsEllipArcItem.prototype.getCircularRadius=function(){return(this.getMajorRadius()+this.getMinorRadius())/2},XeGsEllipArcItem.prototype.getTransform=function(){if(!this.m_TransformMatrix){var t=new GeNeo.OdGeMatrix3d;void 0!==this.m_CachedCircleRotationAngle&&t.setToRotation(this.m_CachedCircleRotationAngle,new GeNeo.OdGeVector3d(0,0,1),new GeNeo.OdGePoint3d(0,0,0));let e=new GeNeo.OdGeVector3d(this.getNormal()[0],this.getNormal()[1],this.getNormal()[2]);e.length()<GeNeo.equalVector()&&(e=new GeNeo.OdGeVector3d(0,0,1));var i=new GeNeo.OdGeMatrix3d,r=(i.setToPlaneToWorld(e),new GeNeo.OdGeMatrix3d),n=(r.setToTranslation(new GeNeo.OdGeVector3d(this.getCenter()[0],this.getCenter()[1],this.getCenter()[2])),new GeNeo.OdGeMatrix3d),r=(n.setToScaling(this.getCircularRadius(),new GeNeo.OdGePoint3d(0,0,0)),r.mult(n).mult(i).mult(t));this.m_TransformMatrix=r}return this.m_TransformMatrix},XeGsEllipArcItem.prototype.getSweepAngle=function(){return this.getEndAng()-this.getStartAng()},XeGsEllipArcItem.prototype.getRadius=function(){return this.getCircularRadius()},XeGsEllipArcItem.prototype.getAlphaBeta=function(){if(!this.m_AlphaBeta){var r=this.getStartAng();let e=this.getEndAng()-this.getStartAng(),t=(e<0&&(e=2*Math.PI+e),r>=Math.PI?r-2*Math.PI:r),i=(t-=Math.PI/2)+e;r=t;t=-i,(i=-r)>=2*Math.PI?(t-=2*Math.PI,i-=2*Math.PI):t<-2*Math.PI&&(t+=2*Math.PI,i+=2*Math.PI),t<0?(this.m_CachedCircleRotationAngle=-t,t=0,i+=this.m_CachedCircleRotationAngle):this.m_CachedCircleRotationAngle=0,this.m_AlphaBeta=[t,i]}return this.m_AlphaBeta},XeGsGeometryChunks.prototype.getXeDocument=function(){return this.getXeGsDevice().getXeDocument()},XeGsGeometryChunks.prototype.getXeGsDevice=function(){return this.m_MyParent},XeGsGeometryChunks.prototype.getById=function(e){var t=(t=this[e])||this["m_"+e];if(t&&t.IsXeCollectionMember)return t},XeGsGeometryChunks.prototype.InvalidateLayerObjects=function(){for(var e of this.getChunkIdList()){e=this.getById(e);e&&(e.m_LayerObject=void 0)}},XeGsGeometryChunks.prototype.eraseChunkById=function(e){var t=this.getById(e);null!=t&&(this.DXEO(t),delete this["m_"+e])},XeGsGeometryChunks.prototype._getChunksExtents=function(e,t,i,r){var n=this.getById(e);if(n){var e=n.getOwner();if(e===t)if(n.isBlockRef()){for(var o of n.m_Items)if(o instanceof XeGsChildItem)for(var a of o.m_Chunks){var s=(new GeNeo.OdGeMatrix3d).fromFlatArray(o.m_Transform),c=new GeNeo.OdGeMatrix3d;c.setToProduct(s,c),c.setToProduct(n.getGeometryToModelMatrix(),c),this._getChunksExtents(a,0,i,c)}}else n.hasExtents()&&((e=n.getChunkExtents()).isValidExtents()?((t=new GeNeo.OdGeMatrix3d).setToProduct(n.getGeometryToModelMatrix(),t),r&&t.setToProduct((new GeNeo.OdGeMatrix3d).fromFlatArray(r),t),e.transformBy(t),i.addPoint(e.minPoint()),i.addPoint(e.maxPoint())):window.XeLogger.warn("chunk",n.m_Id,"BS extents",e))}},XeGsGeometryChunks.prototype.getExtentsByChunkOwner=function(e){var t,i=new GeNeo.OdGeExtents3d;for(t of this.getChunkIdList())this._getChunksExtents(t,e,i);return i},XeGsGeometryChunks.prototype.getModelSpaceExtents=function(){return this.m_bModelSpaceChunksExtentsValid&&void 0!==this.m_ModelSpaceExtents||(this.m_ModelSpaceExtents=this.getExtentsByChunkOwner(1),this.m_bModelSpaceChunksExtentsValid=!0),this.m_ModelSpaceExtents},XeGsGeometryChunks.prototype.getPaperSpaceExtents=function(){return this.m_bPaperSpaceChunksExtentsValid&&void 0!==this.m_PaperSpaceExtents||(this.m_PaperSpaceExtents=this.getExtentsByChunkOwner(2),this.m_bPaperSpaceChunksExtentsValid=!0),this.m_PaperSpaceExtents};let kMAX_VALID_DEPTH_RANGE=1e4;XeGsGeometryChunks.prototype.getPlanesZ=function(e,t){var i,e=e?this.getModelSpaceExtents():this.getPaperSpaceExtents();return e&&e.isValidExtents()?((e=new GeNeo.OdGeExtents3d(e.minPoint(),e.maxPoint())).transformBy(t),t={near:e.minPoint().z,far:e.maxPoint().z},Math.abs(t.near-t.far)<=1e-4&&(t.far=t.near-1e-4,t.near=t.near+1e-4),(t.near+t.far==0?kMAX_VALID_DEPTH_RANGE:Math.abs((t.near-t.far)/(t.near+t.far)))<=1e-6&&(e=.5*(t.far+t.near),i=Math.abs(1e-6*(t.far+t.near)),t.far=e-.5*i,t.near=e+.5*i),t):{near:-kMAX_VALID_DEPTH_RANGE,far:kMAX_VALID_DEPTH_RANGE}},XeGsGeometryChunks.prototype.forEach=function(e){if(!("m_ChunksIdList"in this))throw new Error("No ChunksIdList is presented in the object");for(var t of this.m_ChunksIdList){t=this.getById(t);null!=t&&e(t)}},XeGsGeometryChunks.prototype.getChunkIdList=function(){return"m_ChunksIdList"in this?this.m_ChunksIdList:[]},XeGsGeometryChunks.prototype.onPreUpdate=function(){this.Fire(!1,!1,!1)},XeGsGeometryChunks.prototype.onUpdate=function(){if(this.m_EraseListId){for(let e=0;e<this.m_EraseListId.length;e++)this.eraseChunkById(this.m_EraseListId[e]);this.m_EraseListId=void 0}this.Fire(!0,!1,!1),window.getXeApplication().PostUpdate(0,0),0===this.m_ChunksLeft&&this.getXeGsDevice().FireLastChunkSent()},XeGsHatchItem.prototype.getOrder=function(){return this.m_Order},XeGsHatchItem.prototype.isPatternRecognizable=function(){var e=this.getPatternSize(),t=this.getXeGsDevice().getPixelWidth(),i=this.getXeGsDevice().getPixelHeight(),r=this.getXeGsDevice().getZoomPanViewport().getFieldWidth();return!(e.x>r/t||e.y>r/i)},XeGsHatchItem.prototype.isGradient=function(){return 0<this.getGradientIndexes().length},XeGsHatchItem.prototype.hasPattern=function(){return 0<this.getPatternDashes().length},XeGsHatchItem.prototype.handleSolid=function(e){var t=this.getSolidIndexes(),i=this.getSolidVertices();if(!(65534<=i.length)){var r=this.getGradientIndexes(),n=this.getGradientVertices(),o=this.getGradientColors();if(0==r.length){var a=e.getTriangleStripStorage(i.length/3),s=a.storage.indices.length,c=this.getOrder(),l=a.storage.vertices.length/3;for(let e=0;e<i.length;e+=3)a.storage.vertices.push(i[e]),a.storage.vertices.push(i[e+1]),a.storage.vertices.push(i[e+2]),a.storage.orders.push(c);for(let e=0;e<t.length;e+=3)a.storage.indices.push(t[e]+l),a.storage.indices.push(t[e+1]+l),a.storage.indices.push(t[e+2]+l);var d=a.storage.indices.length;a.mapper.map(e.itemIndex,s,d-s)}else{var u=e.getTriangleStripStorage(n.length/3),d=u.storage.indices.length,p=this.getOrder(),m=u.storage.vertices.length/3;for(let e=0;e<n.length;e+=3)u.storage.vertices.push(n[e]),u.storage.vertices.push(n[e+1]),u.storage.vertices.push(n[e+2]),u.storage.orders.push(p);for(let e=0;e<r.length;e+=3)u.storage.indices.push(r[e]+m),u.storage.indices.push(r[e+1]+m),u.storage.indices.push(r[e+2]+m);for(let e=0;e<o.length;e+=1)u.storage.colors.push(o[e]);var s=u.storage.indices.length,h=(u.mapper.map(e.itemIndex,d,s-d),[]);for(let e=0;e<t.length;e+=3){var g=[[i[3*t[e]],i[3*t[e]+1],i[3*t[e]+2]],[i[3*t[e+1]],i[3*t[e+1]+1],i[3*t[e+1]+2]],[i[3*t[e+2]],i[3*t[e+2]+1],i[3*t[e+2]+2]]];h.push(g)}u.storage.clippingfans.push(h)}return!0}window.XeLogger.warn("HATCH: We are out of short range!")},XeGsHatchItem.prototype.handlePattern=function(e){var t=this.getPatternDashes(),i=this.getPatternSize(),r=new GeNeo.OdGePoint3d(this.getMin()[0],this.getMin()[1],this.getMin()[2]),n=new GeNeo.OdGePoint3d(this.getMax()[0],this.getMax()[1],this.getMax()[2]),o=e.getLineStripsStorage(t.length/2),a=o.storage.indices.length;let s=o.storage.vertices.length/3;var c=this.getOrder();let l=Math.ceil((r.x-i[0])/i[0])*i[0],d=Math.ceil((r.y-i[1])/i[1])*i[1];for(;l<=n.x;){for(;d<=n.y;){for(let e=0;e<t.length;e+=2){var u=t[e],p=t[e+1];o.storage.vertices.push(l+u),o.storage.vertices.push(d+p),o.storage.vertices.push(0),o.storage.orders.push(c),o.storage.indices.push(s),s++}d+=i[1]}l+=i[0],d=Math.ceil((r.y-i[1])/i[1])*i[1]}var m=o.storage.indices.length,h=(o.mapper.map(e.itemIndex,a,m-a),this.getSolidIndexes()),g=this.getSolidVertices(),y=[];for(let e=0;e<h.length;e+=3){var f=[[g[3*h[e]],g[3*h[e]+1],g[3*h[e]+2]],[g[3*h[e+1]],g[3*h[e+1]+1],g[3*h[e+1]+2]],[g[3*h[e+2]],g[3*h[e+2]+1],g[3*h[e+2]+2]]];y.push(f)}return o.storage.clippingfans.push(y),!0},XeGsHatchItem.prototype.process_points=function(e,t){return!this.getPatternDashes().length||!this.isPatternRecognizable()?this.handleSolid(t):this.handlePattern(t)},XeGsImageItem.prototype.getExtents=function(){for(var e=new GeNeo.OdGeExtents3d,t=this.process_points().getVertexes(),i=new GeNeo.OdGePoint3d,r=1;r<t.length;r+=3)i.set(t[3*r],t[3*r+1],t[3*r+2]),e.addPoint(i);return e},XeGsImageItem.prototype.copy_ext=function(){};var XeGsBuffersHelper=function(){};XeGsBuffersHelper.prototype.reallocFloat32Buffer=function(e,t){var i;return e?e.length>=t?e:((i=new Float32Array(t)).set(e),i):new Float32Array(t)},XeGsBuffersHelper.prototype.reallocInt32Buffer=function(e,t){var i;return e?e.length>=t?e:((i=new Int32Array(t)).set(e),i):new Int32Array(t)},XeGsBuffersHelper.prototype.reallocUInt32Buffer=function(t,e){if(t){if(t.length>=e)return t;var i=t.length,r=new Uint32Array(e);for(let e=0;e<i;e++)r[e]=t[e];return r}return new Uint32Array(e)},XeGsBuffersHelper.prototype.reallocInt16Buffer=function(e,t){var i;return e?e.length>=t?e:((i=new Int16Array(t)).set(e),i):new Int16Array(t)},XeGsBuffersHelper.prototype.reallocUInt16Buffer=function(e,t){var i;return e?e.length>=t?e:((i=new Uint16Array(t)).set(e),i):new Uint16Array(t)},window.XeGsBuffersHelper=new XeGsBuffersHelper,XeGsIndexedChunk.prototype.getExtents=function(e){if(!e&&this.m_CachedExtents)return this.m_CachedExtents;for(var t=this.getIndexes(),i=this.getVertexes(),r=e=e||{o:0,s:t.length},n=r.o,o=r.o+r.s,a=new GeNeo.OdGeExtents3d,s=new GeNeo.OdGePoint3d,c=this.getGeometryToModelMatrix(),l=n;l<o;l++){var d=t[l];s.set(i[3*d],i[3*d+1],i[3*d+2]),s.transformBy(c),a.addPoint(s)}return e||(this.m_CachedExtents=a),a},XeGsIndexedChunk.prototype.getColorPickingArraySize=function(){return this.getIndexes()?this.getIndexes().length:0},XeGsIndexedChunk.prototype.getNumVertexes=function(){return this.getVertexes()?this.m_Vertexes.length/3:0},XeGsIndexedChunk.prototype.getNumIndexes=function(){return this.getIndexes()?this.m_Indexes.length:0},XeGsIndexedChunk.prototype.A_IU=function(e,t,i,r,n,o,a,s,c,l,d,u,p){this.invalidateChunk();let m;var h=3*this.getNumVertexes(),g=this.getNumVertexes(),y=this.getNumVertexes(),f=this.getNumIndexes();for(h+=3*o,g+=o,y+=o,f+=t,this.m_Vertexes=window.XeGsBuffersHelper.reallocFloat32Buffer(this.m_Vertexes,h),this.m_Order=window.XeGsBuffersHelper.reallocFloat32Buffer(this.m_Order,g),this.m_Indexes=window.XeGsBuffersHelper.reallocUInt16Buffer(this.m_Indexes,f),this.m_Colors=window.XeGsBuffersHelper.reallocInt32Buffer(this.m_Colors,y),m=0;m<o;m++)this.m_Vertexes[3*(n+m)]=c[3*m],this.m_Vertexes[3*(n+m)+1]=c[3*m+1],this.m_Vertexes[3*(n+m)+2]=c[3*m+2],null!=l&&0<l.length&&(this.m_Normals[n+m]=l[m]),null!=u&&0<u.length&&(this.m_Order[n+m]=u[m]),null!=d&&0<d.length&&(this.m_Colors[n+m]=d[m]);for(m=0;m<t;m++)this.m_Indexes[e+m]=p[m];for(m=0;m<s;m++)this.m_Vertexes[a+m]=this.m_Vertexes[0];for(m=0;m<r;m++)this.m_Indexes[i+m]=0},XeGsIndexedChunk.prototype.U_IU=function(){},XeGsIndexedChunk.prototype.E_IU=function(){},XeGsIndexedChunk.prototype.createDrawObjects=function(){this.deallocateDrawObjects();var e=new XeDrawObjectUtils;return this.getIndexes()&&this.getIndexes().length&&this.getVertexes()&&this.setGLDrawObject(e.createDrawObjects(this)),this.updateDrawModes(),!0},XeGsIndexedChunk.prototype.updateDrawModes=function(){var e,t=this.getDrawModes(),i=0,r=this.getGLDrawObject();for(e in r&&r.resetDrawModes(),t)if(t.hasOwnProperty(e)&&t[e]&&t[e].length)for(var n=t[e],o=parseInt(e),i=0;i<n.length;i++)this.__setDrawModeImpl(o,n[i].o,n[i].s)},XeGsIndexedChunk.prototype.__setDrawModeImpl=function(e,t,i){var r=this.getGLDrawObject();r&&r.setDrawMode(e,t,i)},XeGsIndexedChunk.prototype.getGLDrawObject=function(){return this.m_GLDrawObject},XeGsIndexedChunk.prototype.setGLDrawObject=function(e){this.m_GLDrawObject=e},XeGsIndexedChunk.prototype.getType=function(){return this.m_Type},XeGsIndexedChunk.prototype.deallocateDrawObjects=function(){var e=this.getGLDrawObject();e&&XeGLDrawObject.prototype.deallocate(e),this.setGLDrawObject(void 0)},XeGsIndexedChunk.prototype.updateColorPickingColors=function(e){if(!this.isTracker()&&(e||!this.getColorPickingArray().isValid())){if(!this.getGLDrawObject())return!1;(new Date).getTime();var t=this.getColorPickingArray().getArray();if(!t)return!1;for(var i=[],r=0,n=1;t.length>r;){for(;t.length>r+n&&t[r+n]==t[r];)n++;i.push({o:r,s:n,c:t[r]}),r+=n,n=1}for(var o=0;o<i.length;o++){var a=i[o].c;this._fillColorPickingArray(this.getGLDrawObject(),i[o].o,i[o].s,a)}this._copyToLTColorPickingArray(this.getGLDrawObject()),this.getColorPickingArray().setValid()}return!0},XeGsIndexedChunk.prototype.onPreUpdate=function(){XeGsChunk.prototype.onPreUpdate(this)},XeGsIndexedChunk.prototype.onUpdate=function(){if(this.m_U){for(let e=0;e<this.m_U.length;e++){var t=this.m_U[e];this.A_IU(t.m_AIO,t.m_AIS,t.m_RIO,t.m_RIS,t.m_AVO,t.m_AVS,t.m_RVO,t.m_RVS,t.m_NewVertexes,t.m_NewNormals,t.m_NewColors,t.m_NewOrder,t.m_NewIndexes)}this.m_U=void 0}else this.m_XeDrawModes=void 0;XeGsChunk.prototype.onUpdate(this)},XeGsInfiniteItem.prototype.getExtents=function(){var e=new GeNeo.OdGeExtents3d,t=new GeNeo.OdGePoint3d(this.m_FirstPoint[0],this.m_FirstPoint[1],this.m_FirstPoint[2]),i=new GeNeo.OdGePoint3d(this.m_SecondPoint[0],this.m_SecondPoint[1],this.m_SecondPoint[2]);return e.addPoint(t),e.addPoint(i),e},XeGsInfiniteItem.prototype.copy_ext=function(e){},XeGsInfiniteItem.prototype.getInfiniteLinePoints=function(e,t,i){var r=!this.m_XLine,t=(t=[t.x,t.y,t.z],i=[i.x,i.y,i.z],e.PointToSCS(t)),i=e.PointToSCS(i),n=i[0]-t[0],o=i[1]-t[1],a=Math.sqrt((n+o)*(n+o)),s=this.getXeGsDevice(),s=s.getPixelWidth()+s.getPixelHeight();return r||(t=[t[0]-s*n/a,t[1]-s*o/a]),i=[i[0]+s*n/a,i[1]+s*o/a],t=e.PointToWCS(t[0],t[1],!0),i=e.PointToWCS(i[0],i[1],!0),{point1:t=new GeNeo.OdGePoint3d(t[0],t[1],t[2]),point2:new GeNeo.OdGePoint3d(i[0],i[1],i[2])}},XeGsInfiniteItem.prototype.getExtents=function(){return new GeNeo.OdGeExtents3d},XeGsOLEItem.prototype.copy_ext=function(){},XeGsSimpleChunk.prototype.reduceSegmentCount=!0,XeGsSimpleChunk.prototype.reduceSegmentCountCoef=.8,XeGsSimpleChunk.prototype.recalculateGeometryByDeviation=function(e,t){var i=this.getType();"AS"!==i&&"CS"!==i&&"EAS"!==i&&"SS"!==i||!this.isTracker()&&(this.m_StoredDeviation||(this.m_StoredDeviation={}),i=e.getVpNum(),e=0==this.getVpNum()?0:i,i=this.getXeGsDevice().getDeviation(e,this),t&&(i/=(new GeNeo.OdGeMatrix3d).fromFlatArray(t).scale()),!(t=this.m_StoredDeviation[e])||i<t)&&(this.m_StoredDeviation[e]=i,i="m_"+this.getId(),XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i]={vpnum:e,previous_deviation:t,chunk:null},this.recalculateGeometryByDeviationHandler())},XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder={},XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHandler=function(){var e=this.getXeGsDevice();if(e){var t=e.getChunks();if(t)if(e.getXeGsViewports()){var i,r=0;for(i in XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder)if(d=XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i])if(l=t[i]){var n=l.getType();if("CS"!==n&&"AS"!==n&&"EAS"!==n&&"SS"!==n)delete XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i];else{var o=l.getItems();if(o.length){d.chunk=l;for(var a=!0,s=0;s<o.length;s++)o[s]&&(r++,a=!1);a?delete XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i]:0}else delete XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i]}}else delete XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i];XeGsSimpleChunk.prototype.reduceSegmentCount&&(e=XeGsSimpleChunk.prototype.reduceSegmentCountCoef,3500<r&&(XeGiSimplifier.prototype.maxLineCount=Math.floor(48*e)),XeGiSimplifier.prototype.maxLineCount=2500<r?Math.floor(64*e):1500<r?Math.floor(96*e):1e3<r?Math.floor(128*e):500<r?Math.floor(164*e):Math.floor(256*e));var c,l,d;(new Date).getTime();for(i in XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder)(d=XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder[i])&&((new Date).getTime(),(new Date).getTime(),c=d.vpnum,d.previous_deviation,(l=d.chunk).m_StoredDeviation)&&(l.invalidateChunk(),c=l.createDrawObjects(l.m_StoredDeviation[c]),console.assert("boolean"==typeof c,"error with createDrawObjects",this),c)&&l.setValid();XeGsSimpleChunk.prototype.recalculateGeometryByDeviationHolder={}}}},XeGsSimpleChunk.prototype.invalidateChunk=function(){if(this.isValid()){var e=this.getItems();if(e&&e.length)for(var t=0;t<e.length;t++){var i=e[t];i&&i.invalidate()}}XeGsChunk.prototype.invalidateChunk.call(this)};class XeGsSimpleChunkIntermediateStorage{constructor(){this.indices=new XeTypedArray(XeWebGlRenderer.prototype.getTypeOfIndexArray()),this.vertices=new XeTypedArray(Float32Array,3),this.orders=new XeTypedArray(Float32Array,1),this.colors=new XeTypedArray(Uint32Array,1),this.normals=new XeTypedArray(Float32Array,3),this.clippingfans=[]}reserve(e){this.indices.reservePlus(e),this.vertices.reservePlus(3*e),this.orders.reservePlus(e),this.colors.reservePlus(e),this.normals.reservePlus(3*e)}}class XeGsIntermediateSimplificationContainer{linesArray=[];trianglesArray=[];_pushNewStorage(e){var t={storage:new XeGsSimpleChunkIntermediateStorage,mapper:new XeIndexMapper,isLines:e};(e?this.linesArray:this.trianglesArray).push(t)}_getStorage(e,t,i){return 0==e.length&&this._pushNewStorage(t),i&&(this._isIndexOverflow(e[e.length-1].storage.vertices.length+3*i)&&this._pushNewStorage(t),e[e.length-1].storage.reserve(i)),e[e.length-1]}getLineStripsStorage(e){return this._getStorage(this.linesArray,!0,e)}getTriangleStripStorage(e){return this._getStorage(this.trianglesArray,!1,e)}_isIndexOverflow(e){return Math.pow(2,8*XeWebGlRenderer.prototype.getTypeOfIndexArray().BYTES_PER_ELEMENT)<e}itemIndex=0;assembleDrawObjects(r){var n,o=new XeDrawObjectUtils,a=[],s=[],c=[];for(n of[...this.linesArray,...this.trianglesArray]){let e,t,i;n.storage.normals.length==n.storage.vertices.length&&(t=n.storage.normals.fittedArray),(e=n.storage.colors.length==n.storage.vertices.length/3?n.storage.colors.fittedArray:e)||t?e?i=t?n.isLines?"LSNC":"TSNC":n.isLines?"LSC":"TSC":t&&(i=n.isLines?"LSN":"TSN"):i=n.isLines?"LS":"TS";var l=o.createChunkGeometry(i,r.getArcType(),r.getLinetypeTableRecord(),r.getPlineGen(),n.storage.indices.fittedArray,n.storage.vertices.fittedArray,n.storage.orders.fittedArray,e,t),d={};if(0<n.storage.clippingfans.length&&(d.clippingAreas=n.storage.clippingfans),null==l)return;a.push(l),s.push(n.mapper),c.push(d)}return[a,s,c]}}XeGsSimpleChunk.prototype.initGeomObjectsArrays=function(){this.m_CachedXeDrawObjects||(this.m_CachedXeDrawObjects=[],this.m_CachedXeDrawObjectsProperties=[],this.m_CachedXeDrawMappers=[])},XeGsSimpleChunk.prototype.createDrawObjects=function(e){this.initGeomObjectsArrays();e=this.process_points(e);return this.cleanUpBuffers(),this.updateDrawModes(),e},XeGsSimpleChunk.prototype.cleanUpBuffers=function(){let t=this.m_CachedXeDrawMappers.length;for(let e=0;e<t;e++)this.m_CachedXeDrawMappers[e].isMapped()||(XeGLDrawObject.prototype.deallocate(this.m_CachedXeDrawObjects[e]),this.m_CachedXeDrawObjects.splice(e,1),this.m_CachedXeDrawMappers.splice(e,1),this.m_CachedXeDrawObjectsProperties.splice(e,1),e--,t--)},XeGsSimpleChunk.prototype.removeItemFromBuffer=function(e){if(this.m_CachedXeDrawMappers)for(var t of this.m_CachedXeDrawMappers)t.remove(e)},XeGsSimpleChunk.prototype.process_points_infinite=function(){var t=new XeTypedArray(Float32Array,3),i=new XeTypedArray(Float32Array,3),r=new XeTypedArray(Float32Array,1),n=new XeTypedArray(Float32Array,1),o=new XeTypedArray(Float32Array),a=new XeTypedArray(Float32Array),s=new XeTypedArray(Float32Array),c=new XeTypedArray(Float32Array),l=new XeTypedArray(XeWebGlRenderer.prototype.getTypeOfIndexArray(),0),d=new XeIndexMapper,e=this.getItems();if(e&&e.length)for(var u=0;u<e.length;u++){var p=e[u];if(p&&!p.isValid()){this.removeItemFromBuffer(u);var m=t.length/3;let e=0;for(;t.push(p.m_FirstPoint[0]),t.push(p.m_FirstPoint[1]),t.push(p.m_FirstPoint[2]),i.push(p.m_SecondPoint[0]),i.push(p.m_SecondPoint[1]),i.push(p.m_SecondPoint[2]),r.push(p.m_Order),n.push(p.m_XLine?1:0),++e<2;);o.push(p.m_FirstPoint[0]),o.push(p.m_FirstPoint[1]),o.push(p.m_FirstPoint[2]),a.push(p.m_SecondPoint[0]),a.push(p.m_SecondPoint[1]),a.push(p.m_SecondPoint[2]),s.push(p.m_Order),c.push(p.m_XLine?1:0);var h=l.length;l.push(m),l.push(1+m),d.map(u,h,2),p.setValid()}}var g=new XeGLDrawObjectGeometry,g=(g.addAttribute("rayStartPoint",new XeGeometryAttribute(t.fittedArray)),g.addAttribute("rayDirection",new XeGeometryAttribute(i.fittedArray)),g.addAttribute("rayPropertiesArray",new XeGeometryAttribute(n.fittedArray)),g.addAttribute("fOrderValue",new XeGeometryAttribute(r.fittedArray)),g.addAttribute("rayStartArrayLW",new XeGeometryAttribute(o.fittedArray)),g.addAttribute("rayDirectionArrayLW",new XeGeometryAttribute(a.fittedArray)),g.addAttribute("rayPropertiesArrayLW",new XeGeometryAttribute(c.fittedArray)),g.addAttribute("rayOrdersArrayLW",new XeGeometryAttribute(s.fittedArray)),g.addAttribute("index",new XeGeometryAttribute(l.fittedArray)),g.addAttribute("ltIndex",new XeGeometryAttribute(l.fittedArray)),g.addAttribute("colorPickingColor",new XeGeometryAttribute(new Float32Array(4*t.length/3),!1)),new XeGLDrawObject(g,new XeGLDrawObjectMaterial({shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,!1)}),XeGLDrawObjectGlType.LINES));return this.m_CachedXeDrawObjects.push(g),this.m_CachedXeDrawMappers.push(d),this.m_CachedXeDrawObjectsProperties.push({}),!0},XeGsSimpleChunk.prototype.process_points_images=function(){try{var e=this.getItems();if(e&&e.length)for(var t=0;t<e.length;t++){var i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v=e[t];v&&!v.isValid()&&(this.removeItemFromBuffer(t),i=v.getURL())&&i.length&&(r=v.getOrder(),n=v.getOrigin(),o=v.getPixelWidth(),a=v.getPixelHeight(),s=[v.getU()[0]*o,v.getU()[1]*o,v.getU()[2]*o],c=[v.getV()[0]*a,v.getV()[1]*a,v.getV()[2]*a],l=v.getNumPoints(),d=new(XeWebGlRenderer.prototype.getTypeOfIndexArray())([1,3,2,3,4,2]),u=new Float32Array([0,0,0,n[0]+c[0],n[1]+c[1],n[2]+c[2],n[0]+s[0]+c[0],n[1]+s[1]+c[1],n[2]+s[2]+c[2],n[0],n[1],n[2],n[0]+s[0],n[1]+s[1],n[2]+s[2]]),p=new Float32Array([0,0,0,1,1,1,0,0,1,0]),m=new Float32Array([r,r,r,r,r,r]),(h=new XeGLDrawObjectGeometry).addAttribute("position",new XeGeometryAttribute(u)),h.addAttribute("fOrderValue",new XeGeometryAttribute(m)),h.addAttribute("uv",new XeGeometryAttribute(p)),h.addAttribute("index",new XeGeometryAttribute(d)),(g=new XeGLDrawObjectMaterial({shader:XeShader2dPrograms.getProgram(XeWebGlRenderer.prototype.global_gl_context,!1,!1)})).transparent=!0,g.side=THREE.DoubleSide,y=new XeGLDrawObject(h,g,XeGLDrawObjectGlType.TRIANGLES),XeTexture.prototype.downloadTexture(i),f={texture_link:i,uniform_CPColor:[0,0,0,0]},2<l&&(_=v.getBoundary(),f.clippingAreas=[_]),(w=new XeIndexMapper).map(t,0,d.length),this.m_CachedXeDrawObjects.push(y),this.m_CachedXeDrawObjectsProperties.push(f),this.m_CachedXeDrawMappers.push(w),v.setValid())}}catch(e){window.XeLogger.warn("process_points_images: "+e)}return!0},XeGsSimpleChunk.prototype.process_points_circles=function(e){var t=this.getItems();if(t&&t.length)for(var i=0;i<t.length;i++){var r=t[i];if(r&&!r.isValid()){this.removeItemFromBuffer(i);var n,o=XeWebGlRenderer.prototype.common_data.getXeGlCachedCircles().getCircleByScreenCoeff(XeGLCachedCircles.caclScreenCoef(r.getRadius(),2*Math.PI,e));for(n in this.m_CachedXeDrawObjectsProperties.push({uniform_CPColor:[0,0,0,0],itemTransformationMatrix:r.getTransform(),fOrderValue:r.getOrder(),fOrderValues:new Float32Array([r.getOrder(),r.getOrder()])}),this.m_CachedXeDrawObjects.push(o),o.geometry.attributes)o.geometry.attributes[n].needsUpdate=!0;var a=new XeIndexMapper;a.map(i,0,2*o.geometry.points_count),this.m_CachedXeDrawMappers.push(a),r.setValid()}}return!0},XeGsSimpleChunk.prototype.process_points_arc=function(e,t,i,r){var n=XeGLCachedCircles.MaxScreenCoef;if(2*t.getRadius()>n*e)return r.itemIndex=i,t.process_points(e,r);let o=XeWebGlRenderer.prototype.common_data.getXeGlCachedCircles().getCircleByScreenCoeff(XeGLCachedCircles.caclScreenCoef(t.getRadius(),t.getSweepAngle(),e)),a=o.geometry.points_count,s=2*Math.PI/a;var[n,c]=t.getAlphaBeta();let l,d;if(0<c){var u=n,p=c,m=u/(2*Math.PI),h=p/(2*Math.PI);for(l=Math.floor(a*m),d=Math.ceil(a*h);p-u<s;){var g=XeWebGlRenderer.prototype.common_data.getXeGlCachedCircles().getNextCircle(a);if(!g)return r.itemIndex=i,t.process_points(e,r);o=g,a=o.geometry.points_count,s=2*Math.PI/a,l=Math.floor(a*m),d=Math.ceil(a*h)}l=Math.min(Math.max(l,0),a),d=Math.min(Math.max(d,0),a);var y=o.geometry.attributes.index.array[2*l],f=o.geometry.attributes.index.array[2*l+2*(d-l)],f=o.geometry.attributes.fPatternCoord.array[f]-o.geometry.attributes.fPatternCoord.array[y],y=new XeIndexMapper;y.map(i,2*l,2*(d-l)),this.m_CachedXeDrawMappers.push(y),this.m_CachedXeDrawObjectsProperties.push({uniform_CPColor:[0,0,0,0],itemTransformationMatrix:t.getTransform(),fOrderValue:t.getOrder(),fOrderValues:new Float32Array([t.getOrder(),t.getOrder()]),fEndOverride:f})}else{var _=n,w=2*Math.PI+c,v=_/(2*Math.PI),C=w/(2*Math.PI);for(l=Math.floor(a*v),d=Math.ceil(a*C);w-_<s;){var T=XeWebGlRenderer.prototype.common_data.getXeGlCachedCircles().getNextCircle(a);if(!T)return r.itemIndex=i,t.process_points(e,r);o=T,a=o.geometry.points_count,s=2*Math.PI/a,l=Math.floor(a*v),d=Math.ceil(a*C)}l=Math.min(Math.max(l,0),a),d=Math.min(Math.max(d,0),a);y=o.geometry.attributes.index.array[2*l],f=o.geometry.attributes.index.array[2*l+2*(d-l)],n=o.geometry.attributes.fPatternCoord.array[f]-o.geometry.attributes.fPatternCoord.array[y],c=new XeIndexMapper;c.map(i,2*l,2*(d-l)),this.m_CachedXeDrawMappers.push(c),this.m_CachedXeDrawObjectsProperties.push({uniform_CPColor:[0,0,0,0],itemTransformationMatrix:t.getTransform(),fOrderValue:t.getOrder(),fOrderValues:new Float32Array([t.getOrder(),t.getOrder()]),fEndOverride:n})}return this.m_CachedXeDrawObjects.push(o),!0},XeGsSimpleChunk.prototype.process_points_arcs=function(e){var t=new XeGsIntermediateSimplificationContainer,i=this.getItems();let r=!0;if(i&&i.length)for(var n=0;n<i.length;n++){var o=i[n];o&&!o.isValid()&&(this.removeItemFromBuffer(n),this.process_points_arc(e,o,n,t)?o.setValid():r=!1)}var a=t.assembleDrawObjects(this);return null!=a&&(this.m_CachedXeDrawObjects.push(...a[0]),this.m_CachedXeDrawMappers.push(...a[1]),this.m_CachedXeDrawObjectsProperties.push(...a[2]),r)},XeGsSimpleChunk.prototype.process_points_elipses=function(t){var i=new XeGsIntermediateSimplificationContainer;let r=!0,e=this.getItems();if(e&&e.length)for(var n=0;n<e.length;n++){var o=e[n];if(o&&!o.isValid()){this.removeItemFromBuffer(n);let e=!1;(e=o.isCircular(.01)?this.process_points_arc(t,o,n,i):(i.itemIndex=n,o.process_points(t,i)))?o.setValid():r=!1}}var a=i.assembleDrawObjects(this);return null!=a&&(this.m_CachedXeDrawObjects.push(...a[0]),this.m_CachedXeDrawMappers.push(...a[1]),this.m_CachedXeDrawObjectsProperties.push(...a[2]),r)},XeGsSimpleChunk.prototype.process_points_simplf=function(e){var t=(e,t)=>{var i=new XeGsIntermediateSimplificationContainer;let r=!0,n=this.getItems(),o=0;if(n&&n.length){var a=0;t&&(a=new XeGiSimplifier(t));for(var s=0;s<n.length;s++){var c=n[s];c&&!c.isValid()&&(this.removeItemFromBuffer(s),i.itemIndex=s,c.process_points(e,i,a)?(c.setValid(),o++):r=!1)}}if(0!=o){t=i.assembleDrawObjects(this);if(null==t)return!1;this.m_CachedXeDrawObjects.push(...t[0]),this.m_CachedXeDrawMappers.push(...t[1]),this.m_CachedXeDrawObjectsProperties.push(...t[2])}return r};let i=!1,r=!1;var n=getXeActiveDocument().getXeGsDevice().getOverallViewport(),o=this.getXeGsDrawViewport();if((r=n&&!o?!0:r)&&window.fixAttribSegCalc()){var a,s=getXeActiveDocument().getXeGsDevice().m_XeGsViewports,c=0;for(a in s){var l=s.getByVpnum(a);l&&n.m_VpNum!=l.m_VpNum&&(!c||l.getDeviation()<c.getDeviation())&&(c=l)}if(!c)return!1;i=t(e,c)}else i=t(e);return i},XeGsSimpleChunk.prototype.process_points_hatch=function(e){var t=new XeGsIntermediateSimplificationContainer;let i=!0,r=this.getItems(),n=0;if(r&&r.length){for(var o,a=0;a<r.length;a++)!(s=r[a])||s.isValid()||s.isGradient()||s.hasPattern()||(this.removeItemFromBuffer(a),t.itemIndex=a,s.process_points(e,t)?(s.setValid(),n++):i=!1);0!=n&&null!=(o=t.assembleDrawObjects(this))&&(this.m_CachedXeDrawObjects.push(...o[0]),this.m_CachedXeDrawMappers.push(...o[1]),this.m_CachedXeDrawObjectsProperties.push(...o[2]));for(var s,c,a=0;a<r.length;a++)(s=r[a])&&!s.isValid()&&(s.isGradient()||s.hasPattern())&&(this.removeItemFromBuffer(a),(c=new XeGsIntermediateSimplificationContainer).itemIndex=a,s.process_points(e,c)?(s.setValid(),n++,null!=(c=c.assembleDrawObjects(this))&&(this.m_CachedXeDrawObjects.push(...c[0]),this.m_CachedXeDrawMappers.push(...c[1]),this.m_CachedXeDrawObjectsProperties.push(...c[2]))):i=!1)}return i},XeGsSimpleChunk.prototype.process_points=function(e){var t=(!window.IsOsVersion()||window.getXeApplication().GetCapability("new_lwlt_shader_draw"))&&!window.forceOldLWLTShader();let i=!0;switch(this.getType()){case"IS":i=this.process_points_infinite(e);break;case"MS":i=this.process_points_images(e);break;case"CS":i=!window.m_bForceProcPointsSimplf&&!window.m_bForceProcPointsSimplfCircle&&t?this.process_points_circles(e):this.process_points_simplf(e);break;case"AS":i=!window.m_bForceProcPointsSimplf&&!window.m_bForceProcPointsSimplfArc&&t?this.process_points_arcs(e):this.process_points_simplf(e);break;case"EAS":i=!window.m_bForceProcPointsSimplf&&!window.m_bForceProcPointsSimplfElipse&&t?this.process_points_elipses(e):this.process_points_simplf(e);break;case"HTCH":i=this.process_points_hatch(e);break;default:i=this.process_points_simplf(e)}return i},XeGsSimpleChunk.prototype.__setDrawModeImpl=function(e,t,i){var r,n;this.initGeomObjectsArrays();for([r,n]of this._perItemOffsetsToPerDrawObjectsOffsets([{o:t,s:i}]))for(var o of n)this.m_CachedXeDrawObjects[r].setDrawMode(e,o.o,o.s)},XeGsSimpleChunk.prototype.getExtents=function(e){var t=new GeNeo.OdGeExtents3d,i=this.getItems();if(i&&i.length)for(var r=(e=e||{o:0,s:i.length}).o,n=e.o+e.s,o=this.getGeometryToModelMatrix(),a=new GeNeo.OdGePoint3d,s=r;s<n;s++){var c=i[s];c&&(c=c.getExtents())&&(a.set(c.minPoint().x,c.minPoint().y,c.minPoint().z),a.transformBy(o),t.addPoint(a),a.set(c.maxPoint().x,c.maxPoint().y,c.maxPoint().z),a.transformBy(o),t.addPoint(a))}return t},XeGsSimpleChunk.prototype.DrawChunkInternal=function(e,t,i,r,n,o,a,s,c,l,d,u){(window.IsOsVersion()&&!window.getXeApplication().GetCapability("new_lwlt_shader_draw")||window.forceOldLWLTShader())&&void 0===a&&(a=!0);var p=this.getType();"HS"!==p?(this.isFromText()&&(a=!1),this.draw_gldrawobjects(e,t,i,r,n,o,a,s,c,l,d,u)):"HS"===p&&this.draw_blocks(e,t,i,r,n,o,a,s,c,l,d,u)},XeGsSimpleChunk.prototype.draw_blocks=function(r,n,e,o,a,s,c,l,d,t,u,p){var m=t;if(m){var h=this.getXeGsDevice(),g=h.getChunks(),y=window.getXeApplication().getDrawingEngine().getActualRenderMode(),f=y===XeWebDrawerEngine.prototype.RENDERER_CP_VIEW,_=this.getItems(),w=this.getColorPickingArray().getArray(),v=(v=e)||[{o:0,s:_.length}];let i=!1;if(this.hasExtents()){t=this.getChunkExtents();if(t.isValidExtents()){var e=new GeNeo.OdGeExtents3d(t.minPoint(),t.maxPoint()),t=(e.transformBy(this.getGeometryToModelMatrix()),e.transformBy(n.worldToDeviceMatrix()),e=new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(e.minPoint().x,e.minPoint().y,0),new GeNeo.OdGePoint3d(e.maxPoint().x,e.maxPoint().y,0)),n.visibleScreenRect()),C=new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(t.xmin,t.ymin,0),new GeNeo.OdGePoint3d(t.xmax,t.ymax,0));if(C.intersectWithExtents(e)==GeNeo.OdGeExtents3d.kIntersectNot)return;i=e.minPoint().distanceTo(e.maxPoint())<2}}for(var T=0;T<v.length;T++)for(var b=v[T],X=b.o+b.s,S=b.o;S<X;S++){var P=_[S];if(P){for(var D,x,O=w[S],G=null,E=(f&&(G=new Float32Array(4),O)&&(G[3]=((4278190080&O)>>24)/255,G[0]=((16711680&O)>>16)/255,G[1]=((65280&O)>>8)/255,G[2]=(255&O)/255),P.getChunks()),A=0,I=[],A=0;A<E.length;A++)x=E[A],(D=g.getById(x))&&I.push(D);if(I.length)for(A=0;A<I.length;A++)if(D=I[A]){var k=D.getOwner(),M=D.getVpNum();if(void 0===k||void 0===M||void 0===D.getGeometryToModelMatrix()){k="Bad chunk XeGsSimpleChunk.prototype.draw_blocks -> chunk_owner = "+k+" || chunk_vpNum "+M+" || chunk.getGeometryToModelMatrix() = "+D.getGeometryToModelMatrix();window.XeLogger.error(k)}else{M=(new GeNeo.OdGeMatrix3d).fromFlatArray(P.m_Transform),k=new GeNeo.OdGeMatrix3d;if(k.setToProduct(M,k),k.setToProduct(this.getGeometryToModelMatrix(),k),p&&p.transform_base&&k.setToProduct(p.transform_base,k),D.hasExtents()){M=D.getChunkExtents();if(M.isValidExtents()){M=new GeNeo.OdGeExtents3d(M.minPoint(),M.maxPoint());if(M.transformBy(D.getGeometryToModelMatrix()),M.transformBy(k),M.transformBy(n.worldToDeviceMatrix()),M=new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(M.minPoint().x,M.minPoint().y,0),new GeNeo.OdGePoint3d(M.maxPoint().x,M.maxPoint().y,0)),C.intersectWithExtents(M)==GeNeo.OdGeExtents3d.kIntersectNot)continue}}let e=this.getOwner(),t=this.getDenominator();0===e?t=this.getDenominator():1===e?t=h.getMSDenominator():2===e&&(t=h.getPSDenominator());M={order_base:P.getDrawOrder(),order_base_denominator:t,transform_base:k,colorArray:o,alpha:a,lwPx:s,bAddLw:c,xeColorPicker:f?{uniform_CPColor:G}:null};if(l&&(M.xeColorPicker={uniform_CPColor:l.uniform_CPColor}),D.drawChunk(r,y,n,d,m,u,M),i)return}}}}}else window.XeLogger.warn("XeGsSimpleChunk.prototype.draw_blocks  :: no traits ! ")},XeGsSimpleChunk.prototype.getItemsOffsets=function(){var e=this.getItems(),t=[];let i=0,r=0;for(;i<e.length;){if(e[i]){for(r=i+1;r<e.length&&e[r];)r++;t.push({o:i,s:r-i}),i=r}i++}return t},XeGsSimpleChunk.prototype.draw_gldrawobjects=function(e,t,i,r,n,o,a,s,c,l,d,u){var p,m;if(this.initGeomObjectsArrays(),i=i||this.getItemsOffsets())for([p,m]of this._perItemOffsetsToPerDrawObjectsOffsets(i)){var h={xeGlDrawObject:this.m_CachedXeDrawObjects[p]};this.m_CachedXeDrawObjectsProperties[p]&&Object.assign(h,this.m_CachedXeDrawObjectsProperties[p]),XeGsChunk.prototype.DrawChunkInternal.call(this,e,t,m,r,n,o,a,s,c,l,d,u,h)}},XeGsSimpleChunk.prototype.getColorPickingArraySize=function(){return this.getItems()?this.getItems().length:0},XeGsSimpleChunk.prototype.A_SU=function(i,r,n,o,a){if(this.invalidateChunk(),this.m_Items){let e,t;for(e=0;e<r;e++)t=i+e,this.m_Items[t]&&this.m_Items[t].FinalRelease(),this.m_Items[t]=Array.isArray(a)?a[e]:a,this.m_Items[t]&&this.m_Items[t].invalidate();for(e=0;e<o;e++)t=n+e,this.m_Items[t]&&(this.m_Items[t].FinalRelease(),this.m_Items[t]=void 0,this.removeItemFromBuffer(t))}else window.XeLogger.warn("XeGsSimpleChunk.prototype.A_SU - no items")},XeGsSimpleChunk.prototype.U_SU=function(){},XeGsSimpleChunk.prototype.E_SU=function(){},XeGsSimpleChunk.prototype.deallocateDrawObjects=function(){this.initGeomObjectsArrays();for(var e of this.m_CachedXeDrawObjects)XeGLDrawObject.prototype.deallocate(e);this.m_CachedXeDrawObjects=[],this.m_CachedXeDrawObjectsProperties=[],this.m_CachedXeDrawMappers=[]},XeGsSimpleChunk.prototype._perItemOffsetsToPerDrawObjectsOffsets=function(t){var i=new Map;for(let e=0;e<this.m_CachedXeDrawMappers.length;e++){var r=this.m_CachedXeDrawMappers[e].getByXeOffsets(t);if(r.length){i.set(e,[]);for(var n of r)i.get(e).push(n)}}return i},XeGsSimpleChunk.prototype.updateColorPickingColors=function(e){if(this.initGeomObjectsArrays(),!this.isTracker()&&(e||!this.getColorPickingArray().isValid())){if(!this.m_CachedXeDrawObjects?.length)return!1;(new Date).getTime();var t=this.getColorPickingArray().getArray();if(!t)return!1;for(var i=[],r=0,n=1;t.length>r;){for(;t.length>r+n&&t[r+n]==t[r];)n++;i.push({o:r,s:n,c:t[r]}),r+=n,n=1}for(var o,a=0;a<i.length;a++){var s,c,l,d=i[a].c;for([s,c]of this._perItemOffsetsToPerDrawObjectsOffsets([{o:i[a].o,s:i[a].s}])){for(let e of c)this._fillColorPickingArray(this.m_CachedXeDrawObjects[s],e.o,e.s,d);void 0!==this.m_CachedXeDrawObjectsProperties[s]?.uniform_CPColor&&((l=[])[3]=((4278190080&d)>>24)/255,l[0]=((16711680&d)>>16)/255,l[1]=((65280&d)>>8)/255,l[2]=(255&d)/255,this.m_CachedXeDrawObjectsProperties[s].uniform_CPColor=l)}}for(o of this.m_CachedXeDrawObjects)this._copyToLTColorPickingArray(o);this.getColorPickingArray().setValid()}return!0},XeGsSimpleChunk.prototype.updateDrawModes=function(){var e,t,i=this.getDrawModes();for(e of this.m_CachedXeDrawObjects)e.resetDrawModes();for(t in i)if(i.hasOwnProperty(t)&&i[t]&&i[t].length){var r,n=parseInt(t);for(r of i[t])this.__setDrawModeImpl(n,r.o,r.s)}},XeGsSimpleChunk.prototype.onPreUpdate=function(){XeGsChunk.prototype.onPreUpdate(this)},XeGsSimpleChunk.prototype.onUpdate=function(){if(this.m_U){for(let e=0;e<this.m_U.length;e++){var t=this.m_U[e];this.A_SU(0,0,t.m_RIO,t.m_RIS,void 0)}this.m_U=void 0}else this.m_XeDrawModes=void 0;XeGsChunk.prototype.onUpdate(this)},XeGsSimpleItem.prototype.getChunk=function(){return this.m_MyParent},XeGsSimpleItem.prototype.getXeGsDevice=function(){return this.getChunk().getXeGsDevice()},XeGsSimpleItem.prototype.FinalRelease=function(){},XeGsSimpleItem.prototype.draw_gdi=function(e,t,i){throw"XeGsSimpleItem.prototype.draw_gdi"},XeGsSimpleItem.prototype.isValid=function(){return this.m_bIsValid||(this.m_bIsValid=!1),this.m_bIsValid},XeGsSimpleItem.prototype.setValid=function(){this.m_bIsValid=!0},XeGsSimpleItem.prototype.invalidate=function(){this.m_bIsValid=!1},XeGsSimpleItem.prototype.copy_ext=function(e){},XeGsSimpleItem.prototype.process_points=function(){return!0},XeGsSimpleItem.prototype.getExtents=function(){},XeGsSplineItem.prototype.getOrder=function(){return Array.isArray(this.m_d)?this.m_d[1]:this.m_d.drawOrder},XeGsSplineItem.prototype.getXeGsDrawViewport=function(){var e=this.getChunk();if(e)return e.getXeGsDrawViewport()},XeGsSplineItem.prototype.process_points=function(e,t){var i=this.getXeGsDrawViewport();return new XeGiSimplifier(i).process_spline(this,e,t),!0},XeGsTextItem.prototype.getExtents=function(){for(var e=new GeNeo.OdGeExtents3d,t=this.process_points().getVertexes(),i=new GeNeo.OdGePoint3d,r=1;r<t.length;r+=3)i.set(t[3*r],t[3*r+1],t[3*r+2]),e.addPoint(i);return e},XeGsTextItem.prototype.copy_ext=function(e){},XeGsTextItem.prototype.getBaseTransform=function(){var e=this.getOrigin(),t=this.getvX(),i=this.getvY(),e=new GeNeo.OdGePoint3d(e[0],e[1],e[2]),t=new GeNeo.OdGeVector3d(t[0],t[1],t[2]),i=new GeNeo.OdGeVector3d(i[0],i[1],i[2]),r=t.crossProduct(i),n=new GeNeo.OdGeMatrix3d;return n.setCoordSystem(e,t,i,r),this.m_BaseTransformMatrix=n,this.m_BaseTransformMatrix},XeGsTextItem.prototype.process_points=function(e,t){var i=this.getGlyphs();if(void 0===i)return!1;if(!i.length)return!1;var r,n=this.getChunk().getXeGsDevice().getXeDocument()?.getXeGlyphStorage()?.getItems();if(!n)return!1;let o,a,s;var c=this.getBaseTransform(),l=this.getGTrans(),d=l.length/i.length;if(1!=d&&2!=d&&3!=d&&6!=d)throw"XeGsTextItem.prototype.process_points bad glyph transform";var u=this.getOrder();let p=0;for(o=0;o<i.length;o++){if(!(T=n[i[o]]))return!1;var m=new GeNeo.OdGeMatrix3d,h=new GeNeo.OdGeMatrix3d;switch(d){case 1:h.setentry(0,3,l[p++]);break;case 2:h.setentry(0,3,l[p++]),h.setentry(1,3,l[p++]);break;case 3:h.setentry(0,3,l[p++]),h.setentry(1,3,l[p++]),h.setentry(0,0,l[p]),h.setentry(1,1,l[p++]);break;case 6:h.setentry(0,0,l[p++]),h.setentry(0,1,l[p++]),h.setentry(0,3,l[p++]),h.setentry(1,0,l[p++]),h.setentry(1,1,l[p++]),h.setentry(1,3,l[p++])}m.setToProduct(c,h);var g=XeGlyphItem.prototype.getType.call(T),y=XeGlyphItem.prototype.getVerts2d.call(T),f="TS2"===g?t.getTriangleStripStorage(y.length/2):t.getLineStripsStorage(y.length/2),_=f.storage.indices.length;let e=f.storage.vertices.length/3;for(a=0;a<y.length;a+=2){var w=y[a],v=y[a+1];f.storage.vertices.push(m.get(0,0)*w+m.get(0,1)*v+m.get(0,3)),f.storage.vertices.push(m.get(1,0)*w+m.get(1,1)*v+m.get(1,3)),f.storage.vertices.push(m.get(2,0)*w+m.get(2,1)*v+m.get(2,3)),f.storage.orders.push(u)}if(r=XeGlyphItem.prototype.getIndexes.call(T),"PPL2"===g||"PPG2"===g)for(a=0;a<r.length;a++){var C=r[a]-1;if(0<=C){for(f.storage.indices.push(e),s=1;s<C;s++)f.storage.indices.push(e+s),f.storage.indices.push(e+s);f.storage.indices.push(e+C),e+=1+C}}else if("LS2"===g||"TS2"===g)for(a=0;a<r.length;a++)f.storage.indices.push(r[a]+e);var T=f.storage.indices.length,g=f.mapper.get(t.itemIndex);g?f.mapper.map(t.itemIndex,g.o,g.s+(T-_)):f.mapper.map(t.itemIndex,_,T-_)}return!0},XeGsTextItem.prototype.draw_gl=function(e,t,i,r,n,o,a,s,c){var l=this.getGlyphs();if(l){c&&((d=new Float32Array(4))[0]=((16711680&c)>>16)/255,d[1]=((65280&c)>>8)/255,d[2]=(255&c)/255,d[3]=((4278190080&c)>>24)/255);var d,u=t.getXeGsDevice().getXeDocument().getXeGlyphStorage().getItems(),p=this.getBaseTransform(),m=this.getGTrans(),h=m.length/l.length;if(1!=h&&2!=h&&3!=h&&6!=h)throw"XeGsTextItem.prototype.draw_gl bad glyph transform";for(var g=0,y=0;g<l.length;g++){var f=u[l[g]];if(f.xeGlDrawObject){f=f.xeGlDrawObject;if(f){var _=new GeNeo.OdGeMatrix3d,w=new GeNeo.OdGeMatrix3d;switch(h){case 1:w.setentry(0,3,m[y++]);break;case 2:w.setentry(0,3,m[y++]),w.setentry(1,3,m[y++]);break;case 3:w.setentry(0,3,m[y++]),w.setentry(1,3,m[y++]),w.setentry(0,0,m[y]),w.setentry(1,1,m[y++]);break;case 6:w.setentry(0,0,m[y++]),w.setentry(0,1,m[y++]),w.setentry(0,3,m[y++]),w.setentry(1,0,m[y++]),w.setentry(1,1,m[y++]),w.setentry(1,3,m[y++])}_.setToProduct(p,w);_={};_.m_xeGsChunk=t,r&&(_.color=r),null!=n&&(_.alpha=n),null!=s&&(_.lwUnits=s),null!=o&&(_.order=o),d&&(_.uniform_CPColor=d),f.draw_gl_object(e,i,_)}}}}},XeGsViewport.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_"+this.getVpNum()},XeGsViewport.prototype.getXeGsDevice=function(){return this.m_MyParent.getXeGsDevice()},XeGsViewport.prototype.IsXeCollectionMember=function(){return!0},XeGsViewport.prototype.RenderModeEnum={kBoundingBox:-1,k2DOptimized:0,kWireframe:1,kHiddenLine:2,kFlatShaded:3,kGouraudShaded:4,kFlatShadedWithWireframe:5,kGouraudShadedWithWireframe:6};var XeGsViewSnapshot=function(e){e instanceof XeGsViewport?this.initFrom(e):this.initEmpty()},XeDataTypeEnum=(XeGsViewSnapshot.prototype=Object.create(Object.prototype),XeGsViewSnapshot.prototype.constructor=Object,XeGsViewSnapshot.prototype.initEmpty=function(){this.m_Handle=null},XeGsViewSnapshot.prototype.initFrom=function(e){return this.m_Handle=e.m_Handle,this.m_VpNum=e.m_VpNum,this.m_Overall=e.m_Overall,this.m_UpVector=copyXeObjectMember(e.m_UpVector),this.m_Target=copyXeObjectMember(e.m_Target),this.m_Position=copyXeObjectMember(e.m_Position),this.m_FieldWidth=e.m_FieldWidth,this.m_FieldHeight=e.m_FieldHeight,this.m_Center=copyXeObjectMember(e.m_Center),this.m_Width=e.m_Width,this.m_Height=e.m_Height,this.m_Perspective=e.m_Perspective,this.m_FocalLength=e.m_FocalLength,this.m_Active=e.m_Active,this},XeGsViewSnapshot.prototype.applyTo=function(e){this.m_Handle===e.m_Handle&&(e.m_VpNum=this.m_VpNum,e.m_Overall=this.m_Overall,e.m_UpVector=copyXeObjectMember(this.m_UpVector),e.m_Target=copyXeObjectMember(this.m_Target),e.m_Position=copyXeObjectMember(this.m_Position),e.m_FieldWidth=this.m_FieldWidth,e.m_FieldHeight=this.m_FieldHeight,e.m_Center=copyXeObjectMember(this.m_Center),e.m_Width=this.m_Width,e.m_Height=this.m_Height,e.m_Perspective=this.m_Perspective,e.m_FocalLength=this.m_FocalLength,e.m_Active=this.m_Active)},XeGsViewSnapshot.prototype.compareTo=function(e){return null!==this.m_Handle&&null!==e.m_Handle&&!!(this.m_Handle===e.m_Handle&&this.m_VpNum===e.m_VpNum&&this.m_Overall===e.m_Overall&&compareArrays(this.m_UpVector,e.m_UpVector)&&compareArrays(this.m_Target,e.m_Target)&&compareArrays(this.m_Position,e.m_Position)&&this.m_FieldWidth===e.m_FieldWidth&&this.m_FieldHeight===e.m_FieldHeight&&compareArrays(this.m_Center,e.m_Center)&&this.m_Width===e.m_Width&&this.m_Height===e.m_Height&&this.m_Perspective===e.m_Perspective&&this.m_FocalLength===e.m_FocalLength&&this.m_Active===e.m_Active)},XeGsViewport.prototype.commitToServer=function(){this.preventServerNotify(!1),this.setTarget(this.getTarget()),this.setPosition(this.getPosition()),this.setUpVector(this.getUpVector()),this.setFieldWidth(this.getFieldWidth()),this.setFieldHeight(this.getFieldHeight())},XeGsViewport.prototype.getViewParameters=function(){return new XeGsViewSnapshot(this)},XeGsViewport.prototype.invalidate=function(){this.m_bStencilValid=!1,this.m_bLineweightsValid=!1,this.m_bViewingMatrixValid=!1,this.m_bScreenMatrixValid=!1,this.m_bProjectionMatrixValid=!1,this.m_bWorldToGLNormClippedProjMatrix=!1,this.m_bWorldToDeviceValid=!1,this.m_bVisibleScreenRectData=!1,this.m_bScreenRectData=!1,this.m_bNDCToPixelsMatrix=!1,this.m_bNumPixelsUnitSquareXY=!1},XeGsViewport.prototype.invalidateLineweights=function(){this.m_bLineweightsValid=!1},XeGsViewport.prototype.invalidateStencil=function(){this.m_bStencilValid=!1},XeGsViewport.prototype.isValid=function(){return this.m_bViewingMatrixValid&&this.m_bScreenMatrixValid&&this.m_bProjectionMatrixValid&&this.m_bWorldToDeviceValid&&this.m_bVisibleScreenRectData&&this.m_bScreenRectData&&this.m_bNDCToPixelsMatrix&&this.m_bNumPixelsUnitSquareXY},XeGsViewport.prototype.PERSP_CONST=42,XeGsViewport.prototype.getFocalLength=function(){var e=this.getFieldWidth(),t=this.getFieldHeight();return this.getLensLength()/this.PERSP_CONST*Math.sqrt(t*t+e*e)},XeGsViewport.prototype.setViewportDc=function(e){this.m_dcScreen={xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax},this.normalizeRect(this.m_dcScreen)},XeGsViewport.prototype.getViewportDc=function(){return this.m_dcScreen||{xmin:0,ymin:0,xmax:1e3,ymax:1e3}},XeGsViewport.prototype.getViewportNormalized=function(){return{xmin:0,ymin:0,xmax:1,ymax:1}},XeGsViewport.prototype.screenRect=function(){var e,t,i,r,n,o;return this.m_bScreenRectData||(e=this.getViewportNormalized(),o=this.screenMatrix(),i=new GeNeo.OdGePoint3d,r=new GeNeo.OdGeVector3d,n=new GeNeo.OdGeVector3d,t=new GeNeo.OdGeVector3d,o.getCoordSystem(i,r,n,t),o=i.convert2d(),t=r.convert2d(),i=n.convert2d(),(r=new GeNeo.OdGeMatrix2d).setCoordSystem(o,t,i),n=new GeNeo.OdGePoint2d(e.xmin,e.ymin),o=new GeNeo.OdGePoint2d(e.xmax,e.ymax),n.transformBy(r),o.transformBy(r),this.m_ScreenRectData={xmin:n.x,ymin:n.y,xmax:o.x,ymax:o.y},this.normalizeRect(this.m_ScreenRectData),this.m_bScreenRectData=!0),this.m_ScreenRectData},XeGsViewport.prototype.intersectedRectangle=function(e,t){if(this.normalizeRect(e),this.normalizeRect(t),!(e.xmin>=t.xmax||e.xmax<=t.xmin||e.ymin>=t.ymax||e.ymax<=t.ymin))return{xmin:(e.xmin<=t.xmin?t:e).xmin,xmax:(t.xmax<=e.xmax?t:e).xmax,ymin:(e.ymin<=t.ymin?t:e).ymin,ymax:(t.ymax<=e.ymax?t:e).ymax}},XeGsViewport.prototype.normalizeRect=function(e){var t;e.xmax<e.xmin&&(t=e.xmin,e.xmin=e.xmax,e.xmax=t),e.ymax<e.ymin&&(t=e.ymin,e.ymin=e.ymax,e.ymax=t)},XeGsViewport.prototype.visibleScreenRect=function(){var e,t;return this.m_bVisibleScreenRectData||(e=this.getXeGsDevice(),t=this.screenRect(),this.m_VisibleScreenRectData=this.intersectedRectangle(t,{xmin:0,xmax:e.getPixelWidth(),ymin:0,ymax:e.getPixelHeight()}),this.m_bVisibleScreenRectData=!0),this.m_VisibleScreenRectData},XeGsViewport.prototype.visibleScreenResolution=function(){var e=0,t=0,i=this.visibleScreenRect();return i&&(e=Math.floor(i.xmax-i.xmin),t=Math.floor(i.ymax-i.ymin)),[e,t]},XeGsViewport.prototype.visibleScreenRectInViewCoordinates=function(){var e,t,i,r,n,o=this.screenRect(),a=this.visibleScreenRect();if(a)return r=this.getFieldWidth(),e=this.getFieldHeight(),t=-r/2,t+=(a.xmin-o.xmin)/Math.abs(o.xmax-o.xmin)*r,i=r/2,i+=(a.xmax-o.xmax)/Math.abs(o.xmax-o.xmin)*r,r=-e/2,r+=(a.ymin-o.ymin)/Math.abs(o.ymax-o.ymin)*e,n=e/2,{left:t,right:i,top:n+=(a.ymax-o.ymax)/Math.abs(o.ymax-o.ymin)*e,bottom:r}},XeGsViewport.prototype.visibleScreenRectInPaperCoordinates=function(){var e,t,i,r,n,o=this.screenRect(),a=this.visibleScreenRect();if(a)return r=this.getWidth(),e=this.getHeight(),i=this.getCenter()[0],n=this.getCenter()[1],t=i-r/2,t+=(a.xmin-o.xmin)/Math.abs(o.xmax-o.xmin)*r,i=i+r/2,i+=(a.xmax-o.xmax)/Math.abs(o.xmax-o.xmin)*r,r=n-e/2,r+=(a.ymin-o.ymin)/Math.abs(o.ymax-o.ymin)*e,n=n+e/2,{left:t,right:i,top:n+=(a.ymax-o.ymax)/Math.abs(o.ymax-o.ymin)*e,bottom:r}},XeGsViewport.prototype.projectionMatrix=function(){var e,t,i,r;return this.m_bProjectionMatrixValid?this.m_projectionMatrix:(e=new GeNeo.OdGeMatrix3d,t=this.getViewportNormalized(),i=this.getFieldWidth(),r=this.getFieldHeight(),e.setentry(0,0,(t.xmax-t.xmin)/i),e.setentry(1,1,(t.ymax-t.ymin)/r),i=0,r=1,this.getPerspective()&&(r=(i=this.getFocalLength())+1),e.setentry(2,2,1/(r-i)),e.setentry(0,3,(t.xmax-t.xmin)/2),e.setentry(1,3,(t.ymax-t.ymin)/2),e.setentry(2,3,-i/(r-i)),this.getPerspective()&&(e=e.mult(this.perspectiveMatrix())),this.m_projectionMatrix=e,this.m_bProjectionMatrixValid=!0,e)},XeGsViewport.prototype.perspectiveMatrix=function(){var e=new GeNeo.OdGeMatrix3d;return this.getPerspective()&&e.setentry(3,2,-1/this.getFocalLength()),e},XeGsViewport.prototype.screenMatrix=function(){var e,t,i=this.getViewportDc();return this.m_bScreenMatrixValid?this.m_screenMatrix:(e=new GeNeo.OdGeMatrix3d,t=new GeNeo.OdGePoint2d(i.xmin,i.ymin),i=new GeNeo.OdGePoint2d(i.xmax,i.ymax),e.setentry(0,0,i.x-t.x),e.setentry(1,1,i.y-t.y),e.setentry(0,3,t.x),e.setentry(1,3,t.y),this.m_screenMatrix=e,this.m_bScreenMatrixValid=!0,e)},XeGsViewport.prototype.viewingMatrix=function(){var e,t,i,r,n;return this.m_bViewingMatrixValid?this.m_viewingMatrix:(e=new GeNeo.OdGeMatrix3d,t=this.getViewDir(),i=this.getTarget(),r=this.getUpVector(),t=new GeNeo.OdGeVector3d(t[0],t[1],t[2]),i=new GeNeo.OdGePoint3d(i[0],i[1],i[2]),n=(r=new GeNeo.OdGeVector3d(r[0],r[1],r[2])).crossProduct(t),e.setCoordSystem(i,n,r,t),this.m_viewingMatrix=e.invert(),this.m_bViewingMatrixValid=!0,e)},XeGsViewport.prototype.worldToDeviceMatrix=function(){var e,t,i;return this.m_bWorldToDeviceValid||(e=this.screenMatrix(),t=this.projectionMatrix(),i=this.viewingMatrix(),t=t.mult(i),i=e.mult(t),this.m_worldToDeviceMatrix=i,this.m_bWorldToDeviceValid=!0),this.m_worldToDeviceMatrix},XeGsViewport.prototype.getNear=function(){return this.m_dNear},XeGsViewport.prototype.getFar=function(){return this.m_dFar},XeGsViewport.prototype.setNear=function(e){this.m_dNear!==e&&(this.m_dNear=e,this.m_bWorldToGLNormClippedProjMatrix=!1)},XeGsViewport.prototype.setFar=function(e){this.m_dFar!==e&&(this.m_dFar=e,this.m_bWorldToGLNormClippedProjMatrix=!1)},XeGsViewport.prototype.worldToGLNormClippedProjMatrix=function(e,t){if(!this.m_bWorldToGLNormClippedProjMatrix){var i=new GeNeo.OdGeMatrix3d,r=0,n=0,o=0,a=0;if(this.getXeGsDevice().getOverallViewport()&&!this.getOverall()){var s=this.visibleScreenRectInViewCoordinates();if(!s)return i;r=s.left,n=s.right,o=s.top,a=s.bottom}else r=this.getFieldWidth()/-2,n=this.getFieldWidth()/2,o=this.getFieldHeight()/2,a=this.getFieldHeight()/-2;null!==this.m_dNear&&isFinite(this.m_dNear)||(this.m_dNear=-1e8),null!==this.m_dFar&&isFinite(this.m_dFar)||(this.m_dFar=1e8);var c,l,s=this.m_dNear,d=this.m_dFar;this.getPerspective()?(c=this.getFocalLength(),(l=new GeNeo.OdGeMatrix3d).setentry(3,2,-1/c),i.setentry(0,0,2/(n-r)),i.setentry(1,1,2/(o-a)),i.setentry(0,3,-(n+r)/(n-r)),i.setentry(1,3,-(a+o)/(o-a)),i.setentry(2,2,-2/(d-s)),i.setentry(2,3,-(d+s)/(d-s)),i=i.mult(l)):(i.setentry(0,0,2/(n-r)),i.setentry(1,1,2/(o-a)),i.setentry(0,3,-(n+r)/(n-r)),i.setentry(1,3,-(a+o)/(o-a)),i.setentry(2,2,-2/(d-s)),i.setentry(2,3,-(d+s)/(d-s))),this.m_worldToGLNormClippedProjMatrix=i,this.m_bWorldToGLNormClippedProjMatrix=!0}return this.m_worldToGLNormClippedProjMatrix},XeGsViewport.prototype.GET_X_Y_Z_BOOL=function(e,t,i,r){var n={x:0,y:0,z:0,bool:!1};if(void 0!==e)return e.constructor!==Number?e.constructor===Array||e.constructor===Float32Array?(n.x=e[0]||0,n.y=e[1]||0,n.z=e[2]||0,n.bool=r||!1):e.hasOwnProperty("elements")&&e.elements?(n.x=e.x||0,n.y=e.y||0,n.z=e.z||0,n.bool=r||!1):e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z")?(n.x=e.x,n.y=e.y,n.z=e.z,n.bool=r||!1):(n.x=0,n.y=0,n.z=0,n.bool=!1):(n.x=e,n.y=t,n.z=i||0,n.bool=r||!1),n},XeGsViewport.prototype.PointToSCS=function(e,t,i,r){e=this.GET_X_Y_Z_BOOL(e,t,i,r),t=[0,0];if(!e)return t;this.PointToSCSFast(t,e.x,e.y,e.z,e.bool);i=2147483647,r=-2147483648,e=[0,0];return e[0]=i<t[0]?i:t[0]<r?r:t[0],e[1]=i<t[1]?i:t[0]<r?r:t[1],e},XeGsViewport.prototype.PointToSCSFast=function(e,t,i,r,n){this.TMP_XGV_PTSCSFAST_OdGePoint3d||(this.TMP_XGV_PTSCSFAST_OdGePoint3d=new GeNeo.OdGePoint3d);var o=this.TMP_XGV_PTSCSFAST_OdGePoint3d,t=(o.set(t,i,r),this.worldToDeviceMatrix());o.transformBy(t),e[0]=o.x,e[1]=o.y,n||(i=this.getXeGsDevice(),e[1]=i.getPixelHeight()-e[1])},XeGsViewport.prototype.NumToSCS=function(e,t){var i=this.getUpVector(),i=new GeNeo.OdGeVector3d(i[0],i[1],i[2]).normalize(),r=[0,0],n=[0,0],o=[0,0];return this.PointToSCSFast(o,0,0,0,t),this.PointToSCSFast(r,i.x*e,i.y*e,i.z*e,t),n[0]=r[0]-o[0],n[1]=r[1]-o[1],Math.sqrt(n[0]*n[0]+n[1]*n[1])},XeGsViewport.prototype.getCustomScale=function(){var e=this.getHeight(),t=this.getFieldHeight();if(t)return e/t},XeGsViewport.prototype.getWorldToEyeTransform=function(){return new GeNeo.OdGeMatrix3d(this.viewingMatrix())},XeGsViewport.prototype.getEyeToWorldTransform=function(){return this.viewingMatrix().inverse()},XeGsViewport.prototype.getEyeToScreenMatrix=function(){var e=this.screenMatrix(),t=this.projectionMatrix();return e.mult(t)},XeGsViewport.prototype.getViewDir=function(){var e=this.getPosition(),t=this.getTarget(),e=new GeNeo.OdGeVector3d(e[0]-t[0],e[1]-t[1],e[2]-t[2]).normalize();return[e.x,e.y,e.z]},XeGsViewport.prototype.getViewRightDir=function(){var e=this.getViewRightDirOdVec3();return[e.x,e.y,e.z]},XeGsViewport.prototype.getViewRightDirOdVec3=function(){var e=this.getViewDir(),t=this.getUpVector(),e=new GeNeo.OdGeVector3d(e[0],e[1],e[2]),t=new GeNeo.OdGeVector3d(t[0],t[1],t[2]),e=e.crossProduct(t);return new GeNeo.OdGeVector3d(e.normalize())},XeGsViewport.prototype.PointToView=function(e,t){var i=this.getEyeToScreenMatrix(),r=new GeNeo.OdGePoint3d(0,0,0),e=(r.transformBy(i),new GeNeo.OdGePoint3d(e,t,r.z)),t=i.inverse();return e.transformBy(t),[e.x,e.y,0]},XeGsViewport.prototype.PointToWCSWithPlane=function(e,t,i){e=this.PointToView(e,t);if(null===e)return null;var t=this.getEyeToWorldTransform(),e=new GeNeo.OdGePoint3d(e[0],e[1],0),r=(e.transformBy(t),this.getViewDir()),r=new GeNeo.OdGeVector3d(r[0],r[1],r[2]);let n;if(this.getPerspective()){var o=new GeNeo.OdGePoint3d(0,0,this.getFocalLength());if(o.transformBy(t),(n=o.sub(e)).length()<=1e-9)return[0,0,0]}else n=r;t=new GeNeo.OdGePoint3d;return i.intersectWithLine3d(e,n,t),[t.x,t.y,t.z]},XeGsViewport.prototype.PointToWCS=function(e,t,i){return i&&(t=this.getXeGsDevice().getPixelHeight()-t),this.PointToWCSOnUCS(e,t)},XeGsViewport.prototype.GetElevatedUcsPlane=function(e,t,i){var r=new GeNeo.OdGePoint3d(this.getUCSOrigin()),n=new GeNeo.OdGeVector3d(this.getUCSxDir()),o=new GeNeo.OdGeVector3d(this.getUCSyDir()),a=n.crossProduct(o),s=this.getUCSElevation(),a=a.mult(s),r=r.add(a);e.assign(r),t.assign(n),i.assign(o)},XeGsViewport.prototype.PointToWCSOnUCS=function(e,t){var i,r=new GeNeo.OdGePoint3d,n=new GeNeo.OdGeVector3d,o=new GeNeo.OdGeVector3d,a=(this.GetElevatedUcsPlane(r,n,o),this.getViewDir()),a=new GeNeo.OdGeVector3d(a[0],a[1],a[2]),s=n.crossProduct(o);return a=a.isPerpendicularTo(s)?(i=n.crossProduct(s),a.isPerpendicularTo(i)?new GeNeo.OdGePlane(r,o,s):new GeNeo.OdGePlane(r,n,s)):new GeNeo.OdGePlane(r,n,o),this.PointToWCSWithPlane(e,t,a)},XeGsViewport.prototype.PointToUCS=function(e,t,i){var e=this.GET_X_Y_Z_BOOL(e,t,i),t=new GeNeo.OdGePoint3d(e.x,e.y,e.z),i=new GeNeo.OdGePoint3d(this.getUCSOrigin()),e=new GeNeo.OdGeVector3d(this.getUCSxDir()),r=new GeNeo.OdGeVector3d(this.getUCSyDir()),n=e.crossProduct(r),o=new GeNeo.OdGeMatrix3d,i=(o.setCoordSystem(i,e,r,n),o.invert());return t.transformBy(i),[t.x,t.y,t.z]},XeGsViewport.prototype.dolly=function(e){var t=e.x,i=e.y,e=e.z,r=this.getViewDir(),n=this.getUpVector(),r=new GeNeo.OdGeVector3d(r[0],r[1],r[2]),o=(o=(n=new GeNeo.OdGeVector3d(n[0],n[1],n[2])).crossProduct(r)).mult(t),t=n.mult(i),n=r.mult(e),i=[0,0,0],r=(i[0]=o.x+t.x+n.x,i[1]=o.y+t.y+n.y,i[2]=o.z+t.z+n.z,this.getPosition()),e=this.getTarget();r[0]+=i[0],r[1]+=i[1],r[2]+=i[2],e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],this.setTarget(e),this.setPosition(r),this.invalidate()},XeGsViewport.prototype.zoom=function(e){var t,i,r,n=this.getFieldWidth(),o=this.getFieldHeight(),a=this.getPosition().slice(),s=this.getTarget().slice();this.getPerspective()?(i=(t=new GeNeo.OdGeVector3d(s[0]-a[0],s[1]-a[1],s[2]-a[2])).length(),t.normalize(),r=.2*this.PERSP_CONST/this.getLensLength(),1<e&&i<r?(t.multAssign(i*(e-1)),s[0]+=t.x,s[1]+=t.y,s[2]+=t.z,a[0]+=t.x,a[1]+=t.y,a[2]+=t.z):(n*=r=1/e,o*=r,a[0]=s[0]-t.x*i*r,a[1]=s[1]-t.y*i*r,a[2]=s[2]-t.z*i*r)):(n/=e,o/=e),this.setFieldWidth(n),this.setFieldHeight(o),this.setTarget(s),this.setPosition(a),this.invalidate()},XeGsViewport.prototype.calculateLineweightCache=function(){this.lw_cache={},this.lw_cache.lw_to_units={},this.lw_cache.lw_to_pixels={};for(var e=window.XeLineweightUtils.getOdDb_kLnWt_Array(),t=0;t<e.length;t++)this.lw_cache.lw_to_units[e[t]]=window.XeLineweightUtils.GetLineWeightInUnits(this,e[t]),this.lw_cache.lw_to_pixels[e[t]]=window.XeLineweightUtils.GetLineWeightInPixels(this,e[t]);this.lw_cache.one_px_lw_unit=window.XeLineweightUtils.GetLineWeightInUnitsFromPixels(this,1)},XeGsViewport.prototype.getLineweightCache=function(){return this.lw_cache||this.calculateLineweightCache(),this.lw_cache},XeGsViewport.transformExtents=function(e,t,i){var r=new GeNeo.OdGeExtents3d,n=i,o=[new GeNeo.OdGePoint3d(e.x,e.y,e.z),new GeNeo.OdGePoint3d(e.x,t.y,e.z),new GeNeo.OdGePoint3d(t.x,t.y,e.z),new GeNeo.OdGePoint3d(t.x,e.y,e.z),new GeNeo.OdGePoint3d(e.x,e.y,t.z),new GeNeo.OdGePoint3d(e.x,t.y,t.z),new GeNeo.OdGePoint3d(t.x,t.y,t.z),new GeNeo.OdGePoint3d(t.x,e.y,t.z)];for(let e=0;e<8;e++)o[e].transformBy(n),r.addPoint(o[e]);return r},XeGsViewport.prototype.IsPointInside=function(e){if(this.getOverall())return!0;let i=!1;var r=e.x,n=e.y,e=this.getXeGsDevice().getOverallViewport();if(e){var o=this.getViewportExternalRegionInOverallWCS().slice(1),a=e.worldToDeviceMatrix();for(let e=0,t=o.length-1;e<o.length;t=e++){var s=new GeNeo.OdGePoint3d(o[e][0],o[e][1],o[e][2]),c=(s.transformBy(a),new GeNeo.OdGePoint3d(o[t][0],o[t][1],o[t][2])),l=(c.transformBy(a),s.x),s=s.y,d=c.x,c=c.y;n<s!=n<c&&r<(d-l)*(n-s)/(c-s)+l&&(i=!i)}}else{e=this.visibleScreenRect();if(!e)return!1;r>e.xmin&&r<e.xmax&&n>e.ymin&&n<e.ymax&&(i=!0)}return i},XeGsViewport.prototype.bForceSetActiveAction=!1,XeGsViewport.prototype.setActive=function(){if(-1!==this.getVpNum()){if(XeGsViewport.prototype.bForceSetActiveAction){var e,t=this.getXeGsDevice().getXeGsViewports();for(e in t){var i=t.getByVpnum(e);i&&(i.m_Active=!1)}this.m_Active=!0}this.getXeGsDevice().getXeDocument().RunCmd("'^C^C._SETVARIABLE CVPORT "+this.getVpNum(),"1\n")}},XeGsViewport.prototype.getViewportExternalRegionInOverallWCS=function(){return this.m_ViewportExternalRegionInOverallWCS||(this.m_ViewportExternalRegionInOverallWCS=[]),this.m_ViewportExternalRegionInOverallWCS},XeGsViewport.prototype.createStencilScene=function(){this.getStencilScene&&this.getStencilScene()&&XeWebDrawerEngine.prototype.deallocateScene(this.getStencilScene()),this.getStencilScene=null;var i=new GeNeo.OdGePoint3d,t=(this.m_ViewportExternalRegionInOverallWCS=[],this.getViewportExternalRegion());for(let e=0;e<t.length;e++)i.set(t[e][0],t[e][1],0),this.m_ViewportExternalRegionInOverallWCS.push([i.x,i.y,i.z]);var r=this.getViewportExternalRegionTriangleFan();this.m_ViewportExternalRegionTriangleFanArrayWCS=[];for(let e=0;e<r.length;e++){var n=r[e];if(!(n.length<3)){var o=[];for(let e=0,t=0;e<n.length;e++,t+=3)i.set(n[e][0],n[e][1],0),o.push([i.x,i.y,i.z]);this.m_ViewportExternalRegionTriangleFanArrayWCS.push(o)}}var e=new XeDrawScene;XeGsViewport.prototype._fillStencilScene(this.m_ViewportExternalRegionTriangleFanArrayWCS,null,e),0<e.children.length&&(this.getStencilScene=function(){return e})},XeGsViewport.prototype._fillStencilScene=function(e,t,i){var r=e,n=t,o=i,a=new GeNeo.OdGePoint3d;for(let e=0;e<r.length;e++){var s=r[e];if(!(s.length<3)){var c=new Float32Array(3*s.length);for(let e=0,t=0;e<s.length;e++,t+=3)a.set(s[e][0],s[e][1],0),n&&a.transformBy(n),c[t+0]=a.x,c[t+1]=a.y,c[t+2]=a.z;var l=new XeGLDrawObjectGeometry,d=(l.addAttribute("position",new XeGeometryAttribute(c,!0)),{color:[Math.random(),Math.random(),Math.random()],alpha:1}),d=new XeGLDrawObjectMaterial({attributes:{},uniforms:d,shader:window.XeShaders.container.SimpleShader}),l=(d.side=THREE.DoubleSide,new XeGLDrawObject(l,d,XeGLDrawObjectGlType.TRIANGLE_FAN));o.children.push(l)}}},XeGsViewport.prototype.getDeviation=function(){var e=this.screenRect(),t=Math.floor(e.xmax)-Math.floor(e.xmin),e=Math.floor(e.ymax)-Math.floor(e.ymin),t=t/this.getFieldWidth(),e=e/this.getFieldHeight();return.5/Math.max(t,e)},XeGsViewport.prototype.numPixelsUnitSquareXY=function(){var e,t;return this.m_bNumPixelsUnitSquareXY||(t=this.screenRect(),e=Math.floor(t.xmax)-Math.floor(t.xmin),t=Math.floor(t.ymax)-Math.floor(t.ymin),e=e/this.getFieldWidth(),t=t/this.getFieldHeight(),this.m_NumPixelsUnitSquareXY=[e,t],this.m_bNumPixelsUnitSquareXY=!0),this.m_NumPixelsUnitSquareXY},XeGsViewport.prototype.numPixelsUnitSquare=function(){return Math.max(...this.numPixelsUnitSquareXY())},XeGsViewport.prototype.NDCToPixelsMatrix=function(){var e,t;return this.m_bNDCToPixelsMatrix||(e={xmin:0,xmax:(e=this.getXeGsDevice()).getPixelWidth(),ymin:0,ymax:e.getPixelHeight()},(t=new GeNeo.OdGeMatrix3d).setToIdentity(),t.setentry(0,0,.5*(e.xmax-e.xmin)),t.setentry(1,1,.5*(e.ymax-e.ymin)),t.setentry(0,3,e.xmin+.5*(e.xmax-e.xmin)),t.setentry(1,3,e.ymin+.5*(e.ymax-e.ymin)),this.m_NDCToPixelsMatrix=t,this.m_bNDCToPixelsMatrix=!0),this.m_NDCToPixelsMatrix},XeGsViewport.prototype.isLayerFrozenInViewport=function(e,t){return(!0!==t||"0"!==e.getName())&&(!!e.getFrozen()||(this.m_bSortedFrozenLayerList||(this.m_aSortedFrozenLayerList=new Set(this.getFrozenLayers()),this.m_bSortedFrozenLayerList=!0),this.m_aSortedFrozenLayerList.has(e.getHandle())))},XeGsViewport.prototype.getPixelSize=function(){return 1/this.numPixelsUnitSquare()},XeGsViewports.prototype.getXeGsDevice=function(){return this.m_MyParent},XeGsViewports.prototype.MyAddress=function(){return this.getXeGsDevice().MyAddress()+".m_XeGsViewports"},XeGsViewports.prototype.getByVpnum=function(e){var t=(t=this[e])||this["m_"+e];if(t&&t.IsXeCollectionMember)return t},XeGsViewports.prototype.getActiveViewport=function(){let t;return Object.keys(this).forEach(e=>{e=this[e];e&&e.IsXeCollectionMember&&e.getActive()&&(t=e)}),t},XeInputPointManager.prototype.FinalConstruct=function(){this.m_HitTestInfo=new XeHitTestInfo,this.m_GripManager=new XeGripManager;let i=this;document.addEventListener("Update_XeGsViewports",function(e){var t=i.getXeDocument().getXeGsDevice().getActiveViewport();i.m_HitTestInfo.UpdateCursorPosition(t)})},XeInputPointManager.prototype.FinalRelease=function(){this.m_OldIPM&&this.m_OldIPM.StopProcessing()},XeInputPointManager.prototype.getInputPointManager=function(){return this.m_OldIPM||(this.m_OldIPM=new InputPointManager(this.getXeDocument())),this.m_OldIPM.isValid()||this.m_OldIPM.initInputPointManager(this.getXeDocument()),this.m_OldIPM},XeInputPointManager.prototype.MyAddress=function(){return this.getXeDocument.MyAddress()+".m_XeInputPointManager"},XeInputPointManager.prototype.getXeDocument=function(){return this.m_MyParent},XeInputPointManager.prototype.getIsTableEditorCommandManagment=function(){return!0},XeInputPointManager.prototype.InvalidateApertureSelection=function(){this.m_bApertureSelectionValid=!1},XeInputPointManager.prototype.GetApertureSelection=function(){var e,t,i;return this.m_bApertureSelectionValid||(e=this.getInsideCommand(),t=this.IsClientPending(),(i=this.getXeDocument().getXeGsDevice()).getPan())||i.getZoom()||i.getOrbit()||e||t||window.getXeApplication().getDrawingEngine()&&(i=window.getXeApplication().getDrawingEngine().getIntersected(this.getXeDocument()))&&(i.then(e=>{this.SetApertureSelection(e)}),this.m_bApertureSelectionValid=!0),this.selectedFullSubentPathes?this.selectedFullSubentPathes.slice():[]},XeInputPointManager.prototype.SetApertureSelection=function(e){let t=!1,i;e&&e.length?this.selectedFullSubentPathes&&this.selectedFullSubentPathes.length&&this.selectedFullSubentPathes[0]===e[0]||(this.selectedFullSubentPathes=e,t=!0):(this.selectedFullSubentPathes&&this.selectedFullSubentPathes.length&&(t=!0),this.selectedFullSubentPathes=[]),t&&(XeWebDrawerEngine.prototype.emit_event("XeApertureSelectionChanged",{apertureSelection:this.selectedFullSubentPathes.slice()}),i=this.getXeDocument().getXeGsDevice())&&(i.invalidateClientTrackers(),i.invalidateClientTrackersGL())},XeInputPointManager.prototype.getHitTestInfo=function(){return this.m_HitTestInfo},XeInputPointManager.prototype.getCursorPosition=function(){return this.getHitTestInfo().GetCursorPosition()},XeInputPointManager.prototype.getMousePosition=function(){return this.getHitTestInfo().GetMousePosition()},XeInputPointManager.prototype.drawRubberLine=function(e){var t,i,r,n,o;!0===this.getDrawRubberLine()&&(t=this.getDashedRubberLine(),o=this.getBASEPOINT(),n=this.getXeDocument().getXeGsDevice().getActiveViewport(),r=this.getSpecificRubberPoint(),n.PointToSCSFast(i=[0,0],r[0],r[1],r[2]),n.PointToSCSFast(r=[0,0],o[0],o[1],o[2]),n=window.XeUtils.intRGBToHex(this.getXeDocument().getXeGsDevice().getForeground()),o=e.strokeStyle,t?e.setLineDash([5,2]):e.setLineDash([]),e.strokeStyle=n,e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(i[0],i[1]),e.stroke(),e.setLineDash([]),e.strokeStyle=o)},XeInputPointManager.prototype.getSpecificRubberPoint=function(e){return this.getPENDING()?this.getRUBBERPOINT():this.getCursorPosition()},XeInputPointManager.prototype.GetWorkingPlaneCoordSystem=function(e,t,i,r){this.GetElevatedUcsPlaneCoordSystem(e,t,i,r)},XeInputPointManager.prototype.GetElevatedUcsPlaneCoordSystem=function(e,t,i,r){t.set(e.getUCSOrigin()[0],e.getUCSOrigin()[1],e.getUCSOrigin()[2]),i.set(e.getUCSxDir()[0],e.getUCSxDir()[1],e.getUCSxDir()[2]),r.set(e.getUCSyDir()[0],e.getUCSyDir()[1],e.getUCSyDir()[2]);i=i.crossProduct(r).normalize(),r=e.getUCSElevation();t.addAssign(i.multAssign(r))},XeInputPointManager.prototype.SqrDistance=function(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)},XeInputPointManager.prototype.MatchToDragDropFilter=function(e,t){var i=e.getLayerObject();if(!i)return!1;if(i.getLocked())return!1;if("AcDbTable"===e.getClass()){if(window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker"))return!1;window.getXeCallbacksContainer().proc(e,"UpdateTableSelection",null,t);i=e.getEntityData();if(i)if(i.cellIntersection.intersects)return!1}return!0},XeInputPointManager.prototype.StartSelection=function(e){!0!==this.m_bClientPending&&(this.m_bClientPending=!0,this.m_bInsideSelect=!0,this.getXeDocument().RunCmd("'._MAINSELECT "+e[0]+","+e[1]+","+e[2]+"\n"))},XeInputPointManager.prototype.GetDragInfo=function(){var e;return this.m_DragInfo||(e=function(t,i,e){t.values||(t.values={}),Object.defineProperty(t,i,{get:function(){return t.values[i]},set:function(e){t.values[i]=e}}),t.values[i]=e},this.m_DragInfo={values:{}},e(this.m_DragInfo,"entity",null),e(this.m_DragInfo,"handles",[]),e(this.m_DragInfo,"waitingPreviews",{}),e(this.m_DragInfo,"actualPreview",null),e(this.m_DragInfo,"IsCopy",!1)),this.m_DragInfo},XeInputPointManager.prototype.IsDraggingActive=function(){return 0<this.GetDragInfo().handles.length},XeInputPointManager.prototype.decorateDragPreview=function(e){e.getXeDrawDecoration().setLWThick(0);var t=e.getXeDrawDecoration().TYPE_ENUM.SelectionSet;e.getXeDrawDecoration().setType(t)},XeInputPointManager.prototype.IsDragCopying=function(e){return!1},XeInputPointManager.prototype.StartDragDrop=function(e,t,i){if(e.getParent()||1<e.getPath().length)throw"XeInputPointManager.prototype.StartDragDrop - entity.getPath().length > 1";this.m_CancelCurrentCommand=!1;var r=this.getXeDocument().getXeDatabase().getXeEntities();if(r&&!this.m_bClientPending){if(this.m_bClientPending=!0,i){if(!this.MatchToCopyDragDropFilter(e))return}else if(!this.MatchToDragDropFilter(e,t))return;var n=this.GetDragInfo(),o=(n.actualPreview&&(m=n.entity.getHandle(),n.waitingPreviews[m]&&n.waitingPreviews[m].deallocate(),n.waitingPreviews[n.entity.getHandle()]=n.actualPreview,n.actualPreview=null,n.IsCopy=!1),this.getXeDocument().getXeMainSelectionSet().getHandles());if(!i||(e=this.GetValidDragEnt(e,o))){n.IsCopy=i,n.entity=e,n.handles=[e.getHandle()];var a=new XeEntityPreview;for(a.setSortingByDrawOrder(!1),a.setSortingByChunkOffsets(!1),n.actualPreview=a,this.decorateDragPreview(a),u=0;u<o.length;u++){var s,c=o[u],l=r.getByHandle(c);l&&(s=!1,s=!!(i&&this.IsValidEntForCopy(l)&&!n.waitingPreviews[l.getHandle()]||!i&&this.MatchToDragDropFilter(l,t)&&!n.waitingPreviews[l.getHandle()])||s)&&!l.IsHidden()&&n.handles.push(l.getHandle())}for(var d=n.handles.length,u=0;u<n.handles.length;u++){c=n.handles[u];var p=r.getByHandle(c);p&&(a.addXeEntity(p,"AcDbHatch"!==p.getClass()),i?u<d&&p.OnStartDragCopy():p.RequestDependent().then(p.OnStartDragDrop.bind(p)),window.IsOsVersion())&&!i&&p.Hide()}var m=this.getXeDocument().getXeGsDevice();m&&(m.setContinuousAction(!0),m.invalidateSelectionScene(),m.invalidateClientTrackersGL(),this.InvalidateApertureSelection())}}},XeInputPointManager.prototype.GetValidDragEnt=function(e,t){var i=this.getXeDocument().getXeDatabase().getXeEntities();if(this.IsValidEntForCopy(e)){if("XeBlockReference"===e.m_ClassName)if(void 0!==e.getMTextId())return i.getByHandle(e.getMTextId());return e}if(!i)return!1;if(t)for(var r=0;r<t.length;r++){var n=i.getByHandle(t[r]);if(this.IsValidEntForCopy(n))return n}return null},XeInputPointManager.prototype.ClearDragDrop=function(e){XeInputPointManager.prototype.ClearDragDrop.clearDrawMode||(XeInputPointManager.prototype.ClearDragDrop.clearDrawMode=t=>{var i=this.getXeDocument().getXeDatabase().getXeEntities();if(i){t=t||[];for(let e=0;e<t.length;e++){var r=i.getByHandle(t[e]);r&&r.Show()}}});var t,i=XeInputPointManager.prototype.ClearDragDrop.clearDrawMode,r=this.GetDragInfo();for(t in r.waitingPreviews){r.waitingPreviews.hasOwnProperty(t)&&r.waitingPreviews[t]&&(r.waitingPreviews[t].deallocate(),delete r.waitingPreviews[t]);var n=this.getXeDocument().getXeDatabase().getXeEntities().getByHandle(t);n&&n.RequestDependent().then(i)}i(r.waitingHandles),r.waitingHandles=[],this.m_CancelCurrentCommand=!0,(r.entity&&r.entity.getHandle()===e||-1<r.handles.indexOf(e))&&this.EndDragDrop(r.entity),r.entity&&this.EndDragDrop(r.entity),this.m_CancelCurrentCommand=!1},XeInputPointManager.prototype.EndDragDrop=function(e,t,i){var r=this.getXeDocument(),n=r.getXeDatabase().getXeEntities();if(n){var o=this.GetDragInfo(),a=o.IsCopy;r.getXeMainSelectionSet();if(this.IsCancelled()){o.actualPreview.deallocate(),o.actualPreview=null,o.IsCopy=!1;for(let e=0;e<o.handles.length;e++){var s=o.handles[e],s=n.getByHandle(s);s&&s.Show()}}else{var c,r=o.actualPreview;r&&(c=o.entity.getHandle(),r.getXeDrawDecoration().setLWThick(0),r.getXeDrawDecoration().setColor(null),r.getXeDrawDecoration().setAlpha(null),o.waitingPreviews[c]&&o.waitingPreviews[c].deallocate(),o.waitingPreviews[c]=r,o.waitingPreviews[c].removeOnNextEntityUpdate=!!a,o.actualPreview=null,o.IsCopy=!1),!0===a?this.getXeDocument().RunCmd("._CLIENTDRAG _COPY "+o.handles+" "+t[0]+","+t[1]+","+t[2]+" "+i[0]+","+i[1]+","+i[2]+"\n"):this.getXeDocument().RunCmd("._CLIENTDRAG _MOVE "+o.handles+" "+t[0]+","+t[1]+","+t[2]+" "+i[0]+","+i[1]+","+i[2]+"\n")}o.entity=null,o.bIsCopy=!1,null==o.waitingHandles&&(o.waitingHandles=[]),o.handles&&Array.isArray(o.handles)&&(o.waitingHandles=o.waitingHandles.concat(o.handles)),o.handles=[];r=this.getXeDocument().getXeGsDevice();r&&(r.setContinuousAction(!1),r.invalidateSelectionScene(),r.invalidateClientTrackersGL(),this.InvalidateApertureSelection())}},XeInputPointManager.prototype.ClearClientPendingState=function(e){e.m_bClientPending=!1,e.m_bInsideSelect=!1,e.m_ClearClientPendingStateTimeout=void 0},XeInputPointManager.prototype.IsClientPending=function(){return!0===this.m_bClientPending},XeInputPointManager.prototype.SetClientPending=function(e){this.m_bClientPending=XeUtility.ValueOr(e,!0)},XeInputPointManager.prototype.GripManager=function(){return this.m_GripManager},XeInputPointManager.prototype.StartXeGripEdit=function(e){e instanceof XeGrip==!1||this.IsClientPending()||(this.SetClientPending(e.HasEditCommand()),this.GripManager().Activate(e))},XeInputPointManager.prototype.StartGripEdit=function(e,t,i){e=e.GetGripDataAt(i);this.StartXeGripEdit(e)},XeInputPointManager.prototype.ProcessMouseMove=function(){var e=this.getPENDING();if(!e){var e=this.getXeDocument().getXeDatabase().getPICKBOX(),t=this.getMousePosition(),t=!!this.m_LastClickScreen&&this.SqrDistance(this.m_LastClickScreen,t)>e*e,e=this.GetDragInfo();if(t&&this.m_EntityToDrag){var t=this.m_EntityToDrag.getHandle(),i=this.getXeDocument().getXeWorkingSelectionSet();if(!i.IsEmpty()){if(!i.IsMember(t))return;for(var r=this.getXeDocument().getXeMainSelectionSet(),n=uniq_fast(r.getHandles()),o=0;o<n.length;o++)i.IsMember(n[o])||r.Remove(n[o])}e.waitingPreviews[t]||this.StartDragDrop(this.m_EntityToDrag,this.m_LastClickWCS,!1),this.m_EntityToDrag=void 0}var a,t=e.actualPreview;t&&(e=this.getSpecificRubberPoint(),(a=new GeNeo.OdGeMatrix3d).setentry(0,3,e[0]-this.m_LastClickWCS[0]),a.setentry(1,3,e[1]-this.m_LastClickWCS[1]),a.setentry(2,3,e[2]-this.m_LastClickWCS[2]),a.setentry(3,3,1),t.setTransform(a))}},XeInputPointManager.prototype.ProcessKeyUp=function(e){},XeInputPointManager.prototype.ProcessMouseUp=function(){var e;this.m_ClearClientPendingStateTimeout&&clearTimeout(this.m_ClearClientPendingStateTimeout),this.m_ClearClientPendingStateTimeout=setTimeout(this.ClearClientPendingState,500,this),this.getPENDING()||this.getXeDocument().getXeDatabase().getXeEntities()&&(this.m_EntityToDrag=void 0,(e=this.GetDragInfo()).entity)&&this.EndDragDrop(e.entity,this.m_LastClickWCS,this.getSpecificRubberPoint(),!1)},XeInputPointManager.prototype.ProcessLeftMouseDown_WaitDoubleClickTimeout=0,XeInputPointManager.prototype.ProcessLeftMouseDown=function(){var l=this;var e=this.getPENDING(),d=this.getMousePosition(),t=(this.m_LastClickScreen=new GeNeo.OdGePoint2d(d.x,d.y),this.m_LastClickScreenInverted=new GeNeo.OdGePoint2d(d.x,this.getXeDocument().getXeGsDevice().getPixelHeight()-d.y),this.getXeDocument().getXeGsDevice().getActiveViewport()),i=this.getXeDocument().getXeGsDevice().getOverallViewport();if(this.m_LastClickWCS=t.PointToWCS(d.x,d.y,!0),e||!0===this.getXeDocument().getViewMode())i||(e=this.getHitViewport())&&e!==t&&0==(this.getXeDocument().getXeCommandProcessor().getFlags()&XeCommandProcessor.prototype.Flags.kViewOperation)&&(this.getXeDocument().getXeMainSelectionSet().ClearSelectionSet(),this.getXeDocument().getXeDatabase().setCVPORT(e.getVpNum()));else{let c=this.getXeDocument().getXeDatabase().getXeEntities();if(c){this.getXeDocument().getXeDatabase().getXeLayers();var u,e=this.GetApertureSelection();if(0<e.length){var r=e[0],r=c.getByHandle(r),n=Object.prototype.hasOwnProperty.call(r,"m_HyperLink");if("XeText"===r.m_ClassName&&n){n=r.getHyperLink();if(n)if(l.getXeDocument().getXeInputPointManager().getHitTestInfo().IsCtrlPressed())return window.open(n),void this.getXeDocument().getXeMainSelectionSet().ClearSelectionSet()}}r=(e=>{let t=!1;for(var i=e.getXeMainSelectionSet().getHandles(),r=e.getXeWorkingSelectionSet(),n=uniq_fast(i),o=0;o<n.length;o++){var a=n[o];if(r.IsEmpty()||r.IsMember(a)){a=c.getByHandle(a);if(a){var s=a.CheckIfGrip(d);if(0<=s){if((u=a.getLayerObject())&&!u.getOff()&&!u.getFrozen()&&!u.getLocked())return t=!0,l.StartGripEdit(a,d,s),!0;t=!0}}}}return t})(this.getXeDocument());(r=!r&&0<e.length?((e,t)=>{var i=e.getXeMainSelectionSet(),e=t[0];if(t=c.getByHandle(e)){e=t.getLayerObject();if(e){var r,n=!1,o=!1;if(i.IsMember(t.getHandle()))l.getHitTestInfo().IsShiftPressed()?(!1===(o=(r=window.XeActiveTrackers.TrackerData("TableEditTracker"))?r.isTableActive:o)&&i.Remove(t.getHandle()),n=!0):e.getLocked()||(0<=(r=t.CheckIfGrip(d))?l.StartGripEdit(t,d,r):l.m_EntityToDrag=t,n=!0);else if(window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker")&&"AcDbTable"===t.getClass())n=!0;else if(!l.getHitTestInfo().IsShiftPressed()){var a=[t.getHandle()];for(let e=0;e<a.length;e++){var s=a[e];i.Append(s),n=!0}}return n}}})(this.getXeDocument(),e):r)||(n=this.getXeDocument(),l.m_EntityToDrag=void 0,e=l.getHitViewport(),!i&&e&&e!==t?0==(n.getXeCommandProcessor().getFlags()&XeCommandProcessor.prototype.Flags.kViewOperation)&&(n.getXeMainSelectionSet().ClearSelectionSet(),n.getXeDatabase().setCVPORT(e.getVpNum())):(XeInputPointManager.prototype.ProcessLeftMouseDown_WaitDoubleClickTimeout&&clearTimeout(XeInputPointManager.prototype.ProcessLeftMouseDown_WaitDoubleClickTimeout),l.StartSelection(l.m_LastClickWCS)))}}},XeInputPointManager.prototype.ProcessLeftMouseDoubleClick=function(){let i=this,e=i.getMousePosition();i.m_LastClickScreen=new GeNeo.OdGePoint2d(e.x,e.y),i.m_LastClickScreenInverted=new GeNeo.OdGePoint2d(e.x,this.getXeDocument().getXeGsDevice().getPixelHeight()-e.y);var r,n,o,a=this.getXeDocument().getXeGsDevice().getActiveViewport(),s=this.getXeDocument().getXeGsDevice().getOverallViewport();i.m_LastClickWCS=a.PointToWCS(e.x,e.y,!0),!0===this.getXeDocument().getViewMode()||!(n=this.getXeDocument().getXeDatabase().getXeEntities())||!0===i.m_bClientPending&&!1===i.m_bInsideSelect||(i.m_bClientPending=!0,o=a.PointToWCS(e.x,e.y,!0),i.InvalidateApertureSelection(),window.getXeApplication().getDrawingEngine().getIntersected(this.getXeDocument()).then(e=>{var t=i.GetApertureSelection();0<t.length?(t=t[0],(t=n.getByHandle(t))&&(this.getXeDocument().RunCmd("'^C^C._CLIENTEDIT "+t.getHandle()+" "+o[0]+","+o[1]+","+o[2]+"\n"),this.getXeDocument().getXeMainSelectionSet().ClearSelectionSet())):s?(XeInputPointManager.prototype.ProcessLeftMouseDown_WaitDoubleClickTimeout&&clearTimeout(XeInputPointManager.prototype.ProcessLeftMouseDown_WaitDoubleClickTimeout),XeInputPointManager.prototype.ProcessLeftMouseDown_WaitDoubleClickTimeout=0,(r=i.getHitViewport())&&r!==a&&0==(this.getXeDocument().getXeCommandProcessor().getFlags()&XeCommandProcessor.prototype.Flags.kViewOperation)&&(this.getXeDocument().getXeMainSelectionSet().ClearSelectionSet(),r.setActive())):(t=clientSideTrackersHolder.CFxTableEditTrackerBase)&&1===t.GetTableEditType(o)&&t.getHandle()&&this.getXeDocument().RunCmd("'^C^C._CLIENTEDIT "+t.getHandle()+" "+o[0]+","+o[1]+","+o[2]+"\n")}))},XeInputPointManager.prototype.getHitViewport=function(){var e,t,i=this.getXeDocument().getXeGsDevice().getXeGsViewports(),r=this.getXeDocument().getXeGsDevice().getActiveViewport();for(e in i){var n=i.getByVpnum(e);if(n&&!n.getOverall()&&n.IsPointInside(this.m_LastClickScreenInverted)&&!n.getActive()){t=n;break}}return t||r.getOverall()||r.IsPointInside(this.m_LastClickScreenInverted)||(r=this.getXeDocument().getXeGsDevice().getOverallViewport())&&!r.getActive()&&(t=r),t},XeInputPointManager.prototype.CancelCurrentCommand=function(){this.m_CancelCurrentCommand=!0},XeInputPointManager.prototype.IsCancelled=function(){return this.m_CancelCurrentCommand},XeInputPointManager.prototype.PrepareTooltip=function(){var e,t,i=this,r=this.getXeDocument().getXeDatabase().getXeEntities();r&&(0<(e=this.GetApertureSelection()).length?(e=e[0],(t=r.getByHandle(e))&&(this.m_Tooltip_timeout&&clearTimeout(this.m_Tooltip_timeout),this.m_Tooltip_timeout=setTimeout(()=>t.RequestTooltip().then(e=>{var t=i.getXeDocument().getXeInputPointManager().getMousePosition();window.getXeApplication().getXeUI().ShowTooltip(t,e)}),500))):(this.m_Tooltip_timeout&&clearTimeout(this.m_Tooltip_timeout),window.getXeApplication().getXeUI().HideTooltip()))},XeInputPointManager.prototype.sendViewStateToServer=function(e,t){t=t||e.getXeGsDevice().getZoomPanViewport();t&&(e.CommandStart("CLIENT_SETVIEW"),t.commitToServer(),e.CommandEnd("CLIENT_SETVIEW"))},XeInputPointManager.prototype.setDrawTrackersOff=function(e){this.m_bDrawTrackersOff=e},XeInputPointManager.prototype.getDrawTrackersOff=function(){return this.m_bDrawTrackersOff},XeInputPointManager.prototype.getCanvas=function(){return this.m_OldIPM.getCanvas()},XeLayers.prototype.getXeDocument=function(){return this.getXeDatabase().getXeDocument()},XeLayers.prototype.getXeDatabase=function(){return this.m_MyParent},XeLayer.prototype.getXeDocument=function(){return this.getXeDatabase().getXeDocument()},XeLayer.prototype.getXeDatabase=function(){return this.m_MyParent.getXeDatabase()},XeLayer.prototype.IsDefPoints=function(){return"defpoints"===this.getName().toLowerCase()},XeLine.prototype.getClass=function(){return"AcDbLine"},XeLine.prototype.getGrips=function(){if(!(this.m_Grips&&0<this.m_Grips.length)){var t,e,i=this.getXeDatabase().getXeDocument().getXeGsDevice(),r=(i.getXeGsViewports(),i.getChunks()),n=(this.m_Grips=[[0,0,0],[0,0,0],[0,0,0]],0),o=1e7,a=this.getXeGsOffsets();for(e in a){var s,c=r[e],l=a[e];if(c)for(let e=0;e<l.length;e++)for(t=l[e].o;t<l[e].o+l[e].s;t++){var d=c.getIndexes()[t];d<o&&(s=c.getVertex(o=d),this.m_Grips[0]=[s.x,s.y,s.z]),n<d&&(s=c.getVertex(n=d),this.m_Grips[1]=[s.x,s.y,s.z])}}this.m_Grips[2]=[.5*(this.m_Grips[0][0]+this.m_Grips[1][0]),.5*(this.m_Grips[0][1]+this.m_Grips[1][1]),.5*(this.m_Grips[0][2]+this.m_Grips[1][2])]}return this.m_Grips},XeLine.prototype.RequestAssociated=function(){return this.m_Associated=this.m_Associated||XeRequest.prototype.FakePromise(this,this.getHandle(),"RequestAssociated"),this.m_Associated},XeLine.prototype.RequestAncestors=function(){return this.m_Ancestors=this.m_Ancestors||XeRequest.prototype.FakePromise(this,this.getHandle(),"RequestAncestors"),this.m_Ancestors},XeLinetypeTable.prototype.getXeDatabase=function(){return this.m_MyParent},XeLinetypeTable.prototype.getByHandle=function(e){var t=(t=this[e])||this["m_"+e];if(t&&t.IsXeCollectionMember)return t},XeLinetypeTable.prototype.getXeLinetypeTableRecordByName=function(e,t){if(e){var i,r;if(-1===e)return this.getXeDatabase().getXeLayers(),i=null,(t=t.getLayerObject())?this.getByHandle(t.getLineStyle()):i;for(r in this){var n=this.getByHandle(r);if(n){var o=n.getName();if(o===e)return n}}}return null},XeLinetypeTable.prototype.getLineDashGDI=function(e,t){for(var i=0===this.getXeDatabase().getMEASUREMENT()?1:25.4,r=this.__getLineDash(t),n=0;n<r.length;n++)r[n]=i*Math.abs(e.NumToSCS(r[n]));return r},XeLinetypeTable.prototype.__getLineDashById=function(e){var t=[];if(e){e=this.getByHandle(e);if(e)if(e.getIsSimple())for(var i=e.getArrayPattern(),r=0;r<i.length;r++)t.push(i[r])}return t},XeLinetypeTable.prototype.__getLineDash=function(e){if(e&&e.length)for(var t in this){var i=this.getByHandle(t);if(i){i=i.getName();if(i===e)return this.__getLineDashById(t)}}return[]},XeLinetypeTableRecord.prototype.IsXeCollectionMember=function(){return!0},XeLinetypeTableRecord.prototype.dashAt=function(e){return this.getArrayPattern()[e]},XeObject.prototype.getMyParent=function(){return this.m_MyParent},XeObject.prototype.MyAddress=function(){},XeObject.prototype.Fire=function(e,t,i){e?((e=document.createEvent("Event")).initEvent("Update_"+this.m_ClassName,!0,!0),e.m_Item=this,e.m_FullUpdate=t,window.getXeApplication().m_Events.push(e)):((e=document.createEvent("Event")).initEvent("PreUpdate_"+this.m_ClassName,!0,!0),e.m_Item=this,e.m_FullUpdate=t,e.m_Erased=i,document.dispatchEvent(e))},XeObject.prototype.RESET=function(e,t){this.DXEO(this[e]),delete this[e],this.SET(e,t)},XeObject.prototype.SET=function(e,t){this[e]=t},XeObject.prototype.NotifyServer=function(e,t,i){return window.getXeApplication().CallServer(this,e,t,i,!1,void 0,!1)},XeObject.prototype.RequestServer=function(e,t,i){return window.getXeApplication().CallServer(this,e,t,!1,!1,i,!0)},XeObject.prototype.CallMethod=function(e,t){return XeRequest.prototype.Promise(this,t,e)},{DataType_HEADER_SECTION:1,DataType_HEADER_ARRAY:2,DataType_FOOTER:3,DataType_BOOL:4,DataType_INT8:5,DataType_UINT8:6,DataType_INT16:7,DataType_UINT16:8,DataType_INT32:9,DataType_UINT32:10,DataType_INT64:11,DataType_UINT64:12,DataType_FLOAT:13,DataType_DOUBLE:14,DataType_OdDbHandle:15,DataType_OdGePoint2d:16,DataType_OdGeVector2d:17,DataType_OdGeVector3d:18,DataType_OdGePoint3d:19,DataType_OdGeMatrix2d:20,DataType_OdGeMatrix3d:21,DataType_CHAR_STRING:22,DataType_WCHAR_STRING:23,DataType_INDEX_TYPE:24,DataType_EVAL:25,DataType_JSON:26,DataType_ARRAY:32,DataType_F32:64,DataType_NATIVEJS:128});let getXeDataItem=function(viewIterPair){let getTextDecoder=function(){return window.m_XeTextDecoder||("TextDecoder"in window||window.XeLogger.error("Sorry, this browser does not support TextDecoder..."),window.m_XeTextDecoder=new TextDecoder("utf-8")),window.m_XeTextDecoder},getTextDecoderW=function(){return window.m_XeTextDecoderW||("TextDecoder"in window||window.XeLogger.error("Sorry, this browser does not support TextDecoder..."),window.m_XeTextDecoderW=new TextDecoder("utf-8")),window.m_XeTextDecoderW},getCharString=function(e,t){e=new Uint8Array(e.dataView.buffer,e.iter,t);return getTextDecoder().decode(e)},getWCharString=function(e,t){e=new Uint8Array(e.dataView.buffer,e.iter,t);return getTextDecoderW().decode(e)},getItemName=function(e){let t=0;for(;t<29;){if(0===e.dataView.getUint8(e.iter+t))break;t++}var i=getCharString(e,t);return e.iter+=29,i},alignIter=function(e){var t=e.iter;e.iter+=(t+7&-8)-t},getItemValue=function(viewiter,type){let val,isArray=0<(type&XeDataTypeEnum.DataType_ARRAY),isF32=(type&=~XeDataTypeEnum.DataType_ARRAY,0<(type&XeDataTypeEnum.DataType_F32)),isNATIVEJS=(type&=~XeDataTypeEnum.DataType_F32,0<(type&XeDataTypeEnum.DataType_NATIVEJS)),iArrayLength=(type&=~XeDataTypeEnum.DataType_NATIVEJS,0);switch(isArray&&(iArrayLength=viewiter.dataView.getUint32(viewiter.iter,!0),viewiter.iter+=4),type){case XeDataTypeEnum.DataType_HEADER_SECTION:case XeDataTypeEnum.DataType_HEADER_ARRAY:val=viewiter.dataView.getUint32(viewiter.iter,!0),viewiter.iter+=4;break;case XeDataTypeEnum.DataType_FOOTER:break;case XeDataTypeEnum.DataType_BOOL:isArray?(alignIter(viewiter),val=new Uint8Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=iArrayLength):(val=0<viewiter.dataView.getUint32(viewiter.iter),viewiter.iter+=4);break;case XeDataTypeEnum.DataType_INT8:isArray?(alignIter(viewiter),val=new Int8Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=iArrayLength):(val=viewiter.dataView.getInt8(viewiter.iter),viewiter.iter+=1);break;case XeDataTypeEnum.DataType_UINT8:isArray?(alignIter(viewiter),val=new Uint8Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=iArrayLength):(val=viewiter.dataView.getUint8(viewiter.iter),viewiter.iter+=1);break;case XeDataTypeEnum.DataType_INT16:isArray?(alignIter(viewiter),val=new Int16Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=2*iArrayLength):(val=viewiter.dataView.getInt16(viewiter.iter,!0),viewiter.iter+=2);break;case XeDataTypeEnum.DataType_UINT16:isArray?(alignIter(viewiter),val=new Uint16Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=2*iArrayLength):(val=viewiter.dataView.getUint16(viewiter.iter,!0),viewiter.iter+=2);break;case XeDataTypeEnum.DataType_INT32:if(isArray)if(alignIter(viewiter),isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let i=viewiter.dataView.getInt32(viewiter.iter,!0);val.push(i),viewiter.iter+=4}}else val=new Int32Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=4*iArrayLength;else val=viewiter.dataView.getInt32(viewiter.iter,!0),viewiter.iter+=4;break;case XeDataTypeEnum.DataType_UINT32:if(isArray)if(alignIter(viewiter),isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let i=viewiter.dataView.getUint32(viewiter.iter,!0);val.push(i),viewiter.iter+=4}}else val=new Uint32Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=4*iArrayLength;else val=viewiter.dataView.getUint32(viewiter.iter,!0),viewiter.iter+=4;break;case XeDataTypeEnum.DataType_INT64:if(isArray){alignIter(viewiter);let i=0}else val=viewiter.dataView.getBigInt64(viewiter.iter,!0),viewiter.iter+=8;break;case XeDataTypeEnum.DataType_UINT64:if(isArray){let i=0}else val=viewiter.dataView.getBigUint64(viewiter.iter,!0),viewiter.iter+=8;break;case XeDataTypeEnum.DataType_FLOAT:isArray?(alignIter(viewiter),val=new Float32Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=4*iArrayLength):(val=viewiter.dataView.getFloat32(viewiter.iter,!0),viewiter.iter+=4);break;case XeDataTypeEnum.DataType_DOUBLE:if(isArray)if(alignIter(viewiter),isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let i=viewiter.dataView.getFloat64(viewiter.iter,!0);val.push(i),viewiter.iter+=8}}else val=new Float64Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=8*iArrayLength;else val=viewiter.dataView.getFloat64(viewiter.iter,!0),viewiter.iter+=8;break;case XeDataTypeEnum.DataType_OdDbHandle:if(isArray){val=[];for(let n=0;n<iArrayLength;++n){let length=viewiter.dataView.getUint32(viewiter.iter,!0),str=(viewiter.iter+=4,getCharString(viewiter,length));viewiter.iter+=length,val.push(str)}}else{let length=viewiter.dataView.getUint32(viewiter.iter,!0);viewiter.iter+=4,val=getCharString(viewiter,length),viewiter.iter+=length}break;case XeDataTypeEnum.DataType_OdGePoint2d:if(isArray)if(alignIter(viewiter),isF32)val=new Float32Array(viewiter.dataView.buffer,viewiter.iter,2*iArrayLength),viewiter.iter+=8*iArrayLength;else if(isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val.push(new GeNeo.OdGePoint2d(x,y))}}else val=new Float64Array(viewiter.dataView.buffer,viewiter.iter,2*iArrayLength),viewiter.iter+=16*iArrayLength;else{let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val=[x,y]}break;case XeDataTypeEnum.DataType_OdGeVector2d:if(isArray)if(alignIter(viewiter),isF32)val=new Float32Array(viewiter.dataView.buffer,viewiter.iter,2*iArrayLength),viewiter.iter+=8*iArrayLength;else if(isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val.push(new GeNeo.OdGeVector2d(x,y))}}else val=new Float64Array(viewiter.dataView.buffer,viewiter.iter,2*iArrayLength),viewiter.iter+=16*iArrayLength;else{let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val=[x,y]}break;case XeDataTypeEnum.DataType_OdGeVector3d:if(isArray)if(alignIter(viewiter),isF32)if(isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let x=viewiter.dataView.getFloat32(viewiter.iter,!0),y=(viewiter.iter+=4,viewiter.dataView.getFloat32(viewiter.iter,!0)),z=(viewiter.iter+=4,viewiter.dataView.getFloat32(viewiter.iter,!0));viewiter.iter+=4,val.push([x,y,z])}}else val=new Float32Array(viewiter.dataView.buffer,viewiter.iter,3*iArrayLength),viewiter.iter+=12*iArrayLength;else if(isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0)),z=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val.push([x,y,z])}}else val=new Float64Array(viewiter.dataView.buffer,viewiter.iter,3*iArrayLength),viewiter.iter+=24*iArrayLength;else{let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0)),z=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val=[x,y,z]}break;case XeDataTypeEnum.DataType_OdGePoint3d:if(isArray)if(alignIter(viewiter),isF32)if(isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let x=viewiter.dataView.getFloat32(viewiter.iter,!0),y=(viewiter.iter+=4,viewiter.dataView.getFloat32(viewiter.iter,!0)),z=(viewiter.iter+=4,viewiter.dataView.getFloat32(viewiter.iter,!0));viewiter.iter+=4,val.push([x,y,z])}}else val=new Float32Array(viewiter.dataView.buffer,viewiter.iter,3*iArrayLength),viewiter.iter+=12*iArrayLength;else if(isNATIVEJS){val=[];for(let n=0;n<iArrayLength;++n){let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0)),z=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val.push([x,y,z])}}else val=new Float64Array(viewiter.dataView.buffer,viewiter.iter,3*iArrayLength),viewiter.iter+=24*iArrayLength;else{let x=viewiter.dataView.getFloat64(viewiter.iter,!0),y=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0)),z=(viewiter.iter+=8,viewiter.dataView.getFloat64(viewiter.iter,!0));viewiter.iter+=8,val=[x,y,z]}break;case XeDataTypeEnum.DataType_OdGeMatrix2d:isArray?(alignIter(viewiter),viewiter.iter+=36*iArrayLength):viewiter.iter+=72;break;case XeDataTypeEnum.DataType_OdGeMatrix3d:if(isArray)alignIter(viewiter),viewiter.iter+=64*iArrayLength;else{alignIter(viewiter);let flatarr=[];for(let n=0;n<16;++n){let x=viewiter.dataView.getFloat64(viewiter.iter,!0);viewiter.iter+=8,flatarr.push(x)}val=(new GeNeo.OdGeMatrix3d).fromFlatArray(flatarr)}break;case XeDataTypeEnum.DataType_CHAR_STRING:if(isArray){val=[];for(let n=0;n<iArrayLength;++n){let length=viewiter.dataView.getUint32(viewiter.iter,!0),str=(viewiter.iter+=4,getCharString(viewiter,length));viewiter.iter+=length,val.push(str)}}else{let length=viewiter.dataView.getUint32(viewiter.iter,!0);viewiter.iter+=4,val=getCharString(viewiter,length),viewiter.iter+=length}break;case XeDataTypeEnum.DataType_WCHAR_STRING:if(isArray){val=[];for(let n=0;n<iArrayLength;++n){let length=viewiter.dataView.getUint32(viewiter.iter,!0),str=(viewiter.iter+=4,alignIter(viewiter),getWCharString(viewiter,length));viewiter.iter+=length,val.push(str)}}else{let length=viewiter.dataView.getUint32(viewiter.iter,!0);viewiter.iter+=4,alignIter(viewiter),val=getWCharString(viewiter,length),viewiter.iter+=length}break;case XeDataTypeEnum.DataType_INDEX_TYPE:isArray?(alignIter(viewiter),val=new Uint16Array(viewiter.dataView.buffer,viewiter.iter,iArrayLength),viewiter.iter+=2*iArrayLength):(val=viewiter.dataView.getUint16(viewiter.iter,!0),viewiter.iter+=2);break;case XeDataTypeEnum.DataType_EVAL:{let length=viewiter.dataView.getUint32(viewiter.iter,!0),evalStr=(viewiter.iter+=4,getCharString(viewiter,length));viewiter.iter+=length,val=eval(evalStr)}break;case XeDataTypeEnum.DataType_JSON:{let length=viewiter.dataView.getUint32(viewiter.iter,!0),evalStr=(viewiter.iter+=4,getCharString(viewiter,length));viewiter.iter+=length,val=JSON.parse(evalStr)}break;default:window.XeLogger.error("Unknown type in getItemValue ")}return val};if(!(viewIterPair.iter>=viewIterPair.dataView.buffer.byteLength)){let m_Type=viewIterPair.dataView.getUint8(viewIterPair.iter),m_Flags=(viewIterPair.iter++,viewIterPair.dataView.getUint8(viewIterPair.iter)),m_Name=(viewIterPair.iter++,1&m_Flags?void 0:getItemName(viewIterPair)),m_Value=getItemValue(viewIterPair,m_Type);return{m_Type:m_Type,m_Name:m_Name,m_Value:m_Value,m_Flags:m_Flags}}};class XeObjectModelDeserializer{static ParseSection(viewiter,obj,parent){let item={},iMemberNumber=0;for(;item&&(item=getXeDataItem(viewiter),item);){let itemName=item.m_Name,strName=(void 0===itemName&&(itemName=obj instanceof Array?parent.getItemNameByIndex?parent.getItemNameByIndex(iMemberNumber):"":obj.getItemNameByIndex?obj.getItemNameByIndex(iMemberNumber):""),"m_");if("o"===itemName||"s"===itemName?strName=itemName:strName+=itemName,item.m_Type===XeDataTypeEnum.DataType_HEADER_SECTION){if(!obj){let doc=window.getXeApplication().getDocumentByFxNumber(item.m_Value);obj=doc,"Chunks"===itemName?obj=doc.getXeGsDevice():"XeEntities"===itemName&&(obj=doc.getXeDatabase())}let classItem=void 0,flags=(classItem=void 0===item.m_Name?void 0:getXeDataItem(viewiter),getXeDataItem(viewiter)),bCreate=1&flags.m_Value,child=void 0;if(bCreate||(child=obj[strName]),!child){if(obj instanceof Array){if(classItem){let className=classItem.m_Value;0<className.length?(child=eval("new "+className),"XeGsOffset"!==className&&(child.m_MyParent=parent)):child={}}else parent instanceof XeGsOffsets?child=new XeGsOffset:parent.createClassByIndex?(child=parent.createClassByIndex(iMemberNumber),child.m_MyParent=parent):child={};obj.push(child)}else{if(classItem){let className=classItem.m_Value;0<className.length?(child=eval("new "+className),"XeGsOffsets"!==className&&(child.m_MyParent=obj)):child={}}else obj.createClassByIndex?(child=obj.createClassByIndex(iMemberNumber),child instanceof XeGsOffsets||(child.m_MyParent=parent)):child={};obj[strName]=child}child.FinalConstruct&&child.FinalConstruct()}child.onPreUpdate&&child.onPreUpdate(),XeObjectModelDeserializer.ParseSection(viewiter,child,child.m_MyParent),child.onUpdate&&child.onUpdate()}else if(item.m_Type===XeDataTypeEnum.DataType_HEADER_ARRAY){let child=obj[strName];child||(obj[strName]=[],child=obj[strName]),child.onPreUpdate&&child.onPreUpdate(),XeObjectModelDeserializer.ParseSection(viewiter,child,obj),child.onUpdate&&child.onUpdate()}else{if(item.m_Type===XeDataTypeEnum.DataType_FOOTER)break;obj instanceof Array?obj.push(item.m_Value):obj[strName]=item.m_Value}iMemberNumber++}}static DeserializeXeObject(e,t){e={dataView:new DataView(e,t),iter:0};return XeObjectModelDeserializer.ParseSection(e,void 0,void 0),!0}}XePolyline.prototype.getClass=function(){return"AcDbPolyline"},XePolyline.prototype.getGrips=function(){if(!(this.m_Grips&&0<this.m_Grips.length)){var e,t=this.getXeDatabase().getXeDocument().getXeGsDevice(),r=(t.getXeGsViewports(),t.getChunks()),n=(this.m_Grips=[],this.getXeGsOffsets());for(e in n){var o=r[e],a=n[e];let t,i;if(o)for(let e=0;e<a.length;e++){for(var s=a[e],c=s.o+s.s,l=s.o;l<c;l+=2){t=o.getIndexes()[l];var d=[(i=o.getVertex(t)).x,i.y,i.z];this.m_Grips.push(d)}c&&(s=s.o+s.s-1,t=o.getIndexes()[s],s=[(i=o.getVertex(t)).x,i.y,i.z],this.m_Grips.push(s))}}}return this.m_Grips};var XeRequest=function(){this.m_inProgress=!1},XeTests=(XeRequest.prototype.Promise=function(r,n,o){if(!r||!o)throw"parameters required";let a=new Promise((t,i)=>{var e=new XeRequest;(e.m_Object=r).RequestServer(o,n,e),e.then(e=>{a.m_Result=e,t(e)},e=>{i(e)})});return a.getResult=function(){return a.m_Result},a},XeRequest.prototype.FakePromise=function(e,t,i){let r=new Promise((e,t)=>{e()});return r.getResult=function(){return r.m_Result},r},XeRequest.prototype.getHash=function(e,t){return this.m_Hash},XeRequest.prototype.getResult=function(){return this.m_Result},XeRequest.prototype.then=function(e,t){this.m_List||(this.m_List=[]),e?this.m_List.push(e):window.XeLogger.warn("Empty callback passed to XeRequest!"),this.m_List.push(e),this.m_Result&&this.Done(this.m_Result)},XeRequest.prototype.Done=function(e){if(this.m_inProgress=!1,this.m_Result=e,this.m_List)for(var t=0;t<this.m_List.length;t++)this.m_List[t].call(this.m_Object,e);this.m_List=[]},XeSelectionSet.prototype.getXeDocument=function(){return this.m_MyParent.getXeDocument()},XeSelectionSet.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+"."+this.m_Id},XeSelectionSet.prototype.Remove=function(e){let t=!1;for(var i,r=[],n=0;n<this.m_Handles.length;n++){var o=this.m_Handles[n];o===e?(this.CallMethod("Remove",e),t=!0):r.push(o)}this.m_Handles=r,delete this.m_XePreview,t&&((i=document.createEvent("Event")).initEvent("Update_XeSelectionSet",!0,!0),i.m_Item=this,document.dispatchEvent(i))},XeSelectionSet.prototype.Append=function(e){this.m_Handles.push(e),delete this.m_XePreview,this.CallMethod("Append",e);e=document.createEvent("Event");e.initEvent("Update_XeSelectionSet",!0,!0),e.m_Item=this,document.dispatchEvent(e)},XeSelectionSet.prototype.ClearSelectionSet=function(){var e=0<this.m_Handles.length;this.m_Handles=[],delete this.m_XePreview,this.CallMethod("Clear"),e&&((e=document.createEvent("Event")).initEvent("Update_XeSelectionSet",!0,!0),e.m_Item=this,document.dispatchEvent(e))},XeSelectionSet.prototype.IsMember=function(e){return 0<=this.m_Handles.indexOf(e)},XeSelectionSet.prototype.IsMainSelectionSet=function(){return"main"==this.m_Id},XeSelectionSet.prototype.IsEmpty=function(){return this.m_Handles.length<1},document.addEventListener("Update_XeEntities",function(e){e.m_Item.getXeDocument().getXeSelectionSets().ClearPreviewCache()}),document.addEventListener("Update_XeGsGeometryChunks",function(e){e.m_Item.getXeDocument().getXeSelectionSets().ClearPreviewCache()}),XeSelectionSets.prototype.getXeDocument=function(){return this.m_MyParent},XeSelectionSets.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_XeSelectionSets"},XeSelectionSets.prototype.A_XeSelectionSet=function(e,t,i,r,n,o,a,s){this.m_Items||(this.m_Items=new Map);t=new XeSelectionSet(this,e,t,i,r,n,o,a,s),t.IsMainSelectionSet()?this.m_Items[0]=t:this.m_Items[e]=t,i=document.createEvent("Event");i.initEvent("Update_XeSelectionSet",!0,!0),i.m_Item=t,document.dispatchEvent(i)},XeSelectionSets.prototype.U_XeSelectionSet=function(e,t,i,r,n,o,a){this.m_Items||(this.m_Items=new Map);e=this.m_Items[e];e&&(delete e.m_XePreview,e.setHandles(t),e.setColor(i),e.setAlpha(r),e.setThickness(n),e.setType(o),e.setGripsEnabled(a),(t=document.createEvent("Event")).initEvent("Update_XeSelectionSet",!0,!0),t.m_Item=e,document.dispatchEvent(t))},XeSelectionSets.prototype.R_XeSelectionSet=function(e){this.m_Items||(this.m_Items=new Map);var t,i=this.m_Items[e];i&&((t=document.createEvent("Event")).initEvent("Update_XeSelectionSet",!0,!0),t.m_Item=i,document.dispatchEvent(t)),delete this.m_Items[e]},XeSelectionSets.prototype.R_XeSelectionSets=function(e){for(var t=0;t<e.length;t++)this.R_XeSelectionSet(e[t])},XeSelectionSets.prototype.GetXeMainSelectionSet=function(){return this.m_Items||(this.m_Items=new Map),this.m_Items[0]},XeSelectionSets.prototype.GetXeWorkingSelectionSet=function(){return this.m_Items.WorkingSelectionSet},XeSelectionSets.prototype.ClearPreviewCache=function(){for(var e in this.m_Items)delete this.m_Items[e].m_XePreview},XeSelectionSets.prototype.InWorkingSelectionSet=function(i){if(0<i.length){var r=this.m_Items.WorkingSelectionSet;if(!r.IsEmpty()){var n=[];for(let e=0,t=i.length;e<t;e++)r.IsMember(i[e])&&n.push(i[e]);return n}}return i},XeTable.prototype.getClass=function(){return"AcDbTable"},XeText.prototype.getClass=function(){return"AcDbMText"},XeText.prototype.RequestTooltip=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_Tooltip=new XeRequest,(this.m_Tooltip.m_Object=this).RequestServer("RequestTooltip",{handle:this.getHandle(),pt:e},this.m_Tooltip),this.m_Tooltip},XeTrackers.prototype.getXeDocument=function(){return this.m_MyParent},XeTrackers.prototype.A_XeTracker=function(e,t){var i,r=this.getItems();t&&(i=!r.hasOwnProperty(e),r[e]=t,i)&&notifyTracker([e],"start",this.getXeDocument()),r.hasOwnProperty(e)&&!t&&(notifyTracker([e],"end",this.getXeDocument()),delete r[e])},XeTrackers.prototype.R_T=function(e){var t=this.getItems();t.hasOwnProperty(e)&&(notifyTracker([e],"end",this.getXeDocument()),delete t[e])},XeTrackers.prototype.getItems=function(){return this.m_Items||(this.m_Items={}),this.m_Items},XeTrackers.prototype.isTrackerActive=function(e){return this.getItems().hasOwnProperty(e)},XeTrackers.prototype.getTrackerData=function(e){return this.getItems()[e]},XeUI.prototype.MyAddress=function(){return"m_XeUI"},XeUIStatusBar.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_StatusBar"},XeUIProperties.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_Properties"},XeUILayerPanel.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_LayerPanel"},XeUICommandLine.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_CommandLine"},XeUINavigationToolbar.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_NavigationToolbar"},XeUIToolbarCollection.prototype.MyAddress=function(){return this.m_MyParent.MyAddress()+".m_ToolbarCollection"},XeUI.prototype.__baseoverrides={ProcessMouseClick:XeUI.prototype.ProcessMouseClick},XeUI.prototype.ProcessMouseClick=function(e,t){XeUI.prototype.__baseoverrides.ProcessMouseClick.call(this,{iMouseButton:e,clickType:t})},XeUI.prototype.addScrollbarToTable=function(e){e=e.children[0].children[3];null!==e&&$("#"+e.id).mCustomScrollbar("update")},XeUI.prototype.addScrollbarToChildEle=function(e,t,i){e=void 0===i?void 0===t?e:e.children[t]:e.children[t].children[i];void 0!==e&&$("#"+e.id).mCustomScrollbar("update")},XeUI.prototype.addScrollbarToBody=function(e){$("#"+e.id).mCustomScrollbar("update")},XeUI.prototype.handleCommandWindow=function(e,t,i,r){null!=e.timeOut&&(clearTimeout(e.timeOut),e.timeOut=void 0),t?(window.Wt&&(window.Wt.layouts2.scheduleAdjust(),window.Wt.layouts2.adjust()),$("#"+e.id).stop(1,1),$("#"+e.id).show()):i?$("#"+e.id).hide("fade",5e3):$("#"+e.id).hide(),r&&(e.timeOut=setTimeout(function(){$("#"+e.id).hide("fade",5e3)},1e3))},XeUI.prototype.FireWidget_Create=function(e){var t=document.createEvent("Event");t.initEvent("XeWidget_Create",!0,!0),t.m_id=e,document.dispatchEvent(t)},XeUI.prototype.FireWidget_PreUpdate=function(e){var t=document.createEvent("Event");t.initEvent("XeWidget_PreUpdate",!0,!0),t.m_id=e,document.dispatchEvent(t)},XeUI.prototype.FireWidget_Update=function(e){var t=document.createEvent("Event");t.initEvent("XeWidget_Update",!0,!0),t.m_id=e,document.dispatchEvent(t)},XeUI.prototype.FireWidget_Destroy=function(e){var t=document.createEvent("Event");t.initEvent("XeWidget_Destroy",!0,!0),t.m_id=e,document.dispatchEvent(t)},XeUI.prototype.HandelDialogTabEvent=function(i){window.addEventListener("keydown",function(e){var t;9==e.which&&(void 0!==(t=$("#"+i+" *[tabindex]:not(.disabled):not([style*='display: none'])"))&&0<t.size()&&!e.shiftKey?e.target.id===t[t.size()-1].id&&(e.preventDefault(),t[0].focus()):e.target.id===t[0].id&&(e.preventDefault(),t[t.size()-1].focus()))})},XeUI.prototype.OnPropertiesWidgetCreated=function(){},XeUI.prototype.OnPropertiesWidgetDestroyed=function(){},XeUI.prototype.OnPropertiesWidgetUpdated=function(){},XeUI.prototype.OnDimPaletteCreated=function(){},XeUI.prototype.OnDimPaletteDestroyed=function(){},XeUI.prototype.SelectInputFieldRange=function(e,t,i){e=$("#"+e.id);if(void 0!==e)return void 0===i&&(i=t),e.each(function(){var e;"selectionStart"in this?(this.selectionStart=t,this.selectionEnd=i):this.setSelectionRange?this.setSelectionRange(t,i):this.createTextRange&&((e=this.createTextRange()).collapse(!0),e.moveEnd("character",i),e.moveStart("character",t),e.select())})},XeUI.prototype.requestDimIconPosition=function(e){return this.m_DimIconPosition=this.m_DimIconPosition||XeRequest.prototype.Promise(this,e,"DimIconPosition"),this.m_DimIconPosition},XeUI.prototype.resetDimIconPosition=function(){this.m_DimIconPosition=void 0},XeUI.prototype.getDimIconPosition=function(){if(void 0!==this.m_DimIconPosition)return this.m_DimIconPosition.m_Result},XeUI.prototype.PlaceDialogue=function(r,n,o,a,s){r=$("#"+r.id);if(void 0!==r){let e,t=0,i;void 0!==(t=this.getNavigationToolbar()?$("#"+this.getNavigationToolbar().getId()):(i=document.querySelector('[data-object-name="navigationbar"]'),$(i)))&&(o+=e=t.height(),s+=e);var c=$(document).height(),l=$(document).width(),d=r.width(),u=r.height(),p=l/2,m=0;(0<=o||0<=s)&&(u+8<o&&d<l?(m=o-(u+8),p=d<l-(n=n<0?8:n)?n:l-d):u+8<c-s&&d<l?(m=s+8,p=d<l-(n=n<0?8:n)?n:l-d):d+8<n&&u<c?(p=n-(d+8),m=u<c-(o=o<0?8:o)?o:c-u):d+8<l-a&&u<c&&(p=n+8,m=u<c-(o=o<0?8:o)?o:c-u)),r.css("top",c<m?c/2:m),r.css("left",l<p?l/2:p)}},XeUI.prototype.highlightParentsInTree=function(){var e=document.getElementById("COsSheetManager");if(e){var t=e.getElementsByClassName("reference");if(t)for(var i,r,n=0;n<t.length;n++){var o=t[n].parentElement.parentElement.getElementsByClassName("active");o&&0<o.length?(i=t[n].closest("div"))&&i.parentElement&&(i.parentElement&&i.parentElement.classList&&i.parentElement.classList.add("highlight"),r=i.parentElement.closest("ul"))&&r.parentElement&&r.parentElement.firstChild&&r.parentElement.firstChild.classList.add("highlight"):(t[n].parentElement&&t[n].parentElement.classList&&t[n].parentElement.classList.remove("highlight"),(i=t[n].closest("div"))&&i.parentElement&&(r=i.parentElement.closest("ul"))&&r.parentElement&&r.parentElement.firstChild&&r.parentElement.firstChild.classList.remove("highlight"))}}e=document.getElementById("COsReferenceManager");if(e){var a=e.getElementsByClassName("reference");if(a)for(var s=0;s<a.length;s++){var c=a[s].parentElement;if(c&&0<c.nextSibling.children.length&&c.parentElement)for(var l=0;l<c.nextSibling.children.length;l++){var d,u,p=c.nextSibling.children.item(l);(u=(d=p&&p.firstChild&&p.firstChild.firstChild?p.firstChild:d)&&d.nextSibling?d.nextSibling.getElementsByClassName("active"):u)&&0<u.length?(c&&c.classList&&c.classList.add("highlight"),d&&d.classList&&d.classList.add("highlight")):(p=c.parentElement.getElementsByClassName("active"),c&&c.classList&&p&&0==p.length&&c.classList.remove("highlight"),d&&d.classList&&d.classList.remove("highlight"))}}}},XeUI.prototype.highlightDependentsInTree=function(e){null!=e.id&&($("#"+e.id),e&&!e.classList.contains("xenon-sheet-dependent-item")?e.classList.add("xenon-sheet-dependent-item"):e.classList.remove("xenon-sheet-dependent-item"))},XeUI.prototype.ShowTooltip=function(e,t){var i=document.getElementById("XeTooltip");null===i&&((i=document.createElement("div")).id="XeTooltip",i.className="noteeditor-field",i.style.pointerEvents="none",document.body.appendChild(i)),t?(i.style.visibility="visible",i.style.position="absolute",i.style.left=e.x+"px",i.style.top=e.y+"px",i.innerHTML=t):this.HideTooltip()},XeUI.prototype.HideTooltip=function(){var e=document.getElementById("XeTooltip");e&&(e.style.visibility="hidden")},XeUI.prototype.FocusInGraphicsArea=function(){return!!document.hasFocus&&!!document.hasFocus()&&("BODY"===document.activeElement.tagName.toUpperCase()||0<=document.activeElement.id.toUpperCase().search("DOCUMENTWINDOW"))},XeUI.prototype.onFxPopupMenuKeyDown=function(e){return 32===(e.keyCode||e.charCode)&&(e.stopPropagation(),e.preventDefault()),!1},window.UCS=function(e,t,i){(new Date).getTime(),window.getXeApplication().UpdateClientState(e,t,i),(new Date).getTime();0==t&&0==i||window.parent!==window&&window.parent.postMessage({messageName:"stepProgressor",messageParam:10+(e+1e3)/(e+t+1e3+i+10)*100},"*")},window.startWorkingSpinner=function(){window.m_startWorkingSpinnerTimeout&&(clearTimeout(window.m_startWorkingSpinnerTimeout),window.m_startWorkingSpinnerTimeout=void 0)},window.stopWorkingSpinner=function(){},window.RunATF=function(e){var t=document.createElement("script");t.src=e,window.XeLogger.log("================ATF start=================="),t.onload=()=>{window.m_XeTests&&window.XeLogger.log("================ATF end==================")},document.body.appendChild(t)},window.ReadyForScreenShots=function(){return!!window.getXeActiveDocument()&&!!window.getXeApplication().m_bStartupDone&&!window.getXeApplication().IsApplyingGsUpdates()&&window.m_bServerModelValid},window.P=function(e,t,i){if(window.m_bServerModelValid=!(0!==e||!t||!i),window.stopWorkingSpinner(),window.m_startWorkingSpinnerTimeout=setTimeout(window.startWorkingSpinner,3e3),window.m_bWasmReady)for(var r in window.m_XeApplication.m_XeDocuments){var n,r=window.m_XeApplication.m_XeDocuments[r];r.m_bStartupCalled||(0==r.getXeDatabase().getMEASUREMENT()?window.Wasm.initDatabase(0):window.Wasm.initDatabase(1),n=XeWebGlRenderer.prototype.testWebGL2()?2:1,window.IsOsVersion()?r.RunCmd("^C^C_OSSTARTUP "+n+"\n"):r.RunCmd("^C^C_STARTUP "+n+"\n"),r.m_bStartupCalled=!0)}window.m_XeApplication&&window.m_XeApplication.CheckStartupDone()},window.U=function(e){(new Date).getTime();window.getXeApplication().RR&&window.getXeApplication().RR(),window.getXeApplication().RR=function(){};var t=(new Date).getTime(),i=window.getXeApplication().m_EventData;if(i)for(var r=0;r<e.length;r++){var n,o,a=e[r],s=i[a];s?(delete i[a],n=t-s.m_creationTime,!0===window.__LogRequests&&(o=1e3<n?"====>LONG ":"",!0===s.m_Const&&(o+="Const "),o+="Event "+a+" done in "+n+" ms, val = "+JSON.stringify(s.m_Val),window.XeLogger.log(o))):!0===window.__LogRequests&&window.XeLogger.log("Unknown event with id = "+a)}},window.Fire_UpdateChunk=function(e,t){var i=document.createEvent("Event");e?i.initEvent("PreUpdate_XeGsIndexedChunk",!0,!0):i.initEvent("Update_XeGsIndexedChunk",!0,!0),i.m_Item=t,i.m_FullUpdate=!1,i.m_Erased=!1,document.dispatchEvent(i)},window.Fire_UpdateChunks=function(e){var t=window.getXeActiveDocument().getXeGsDevice().getChunks(),i=document.createEvent("Event");e?i.initEvent("PreUpdate_XeGsGeometryChunks",!0,!0):i.initEvent("Update_XeGsGeometryChunks",!0,!0),i.m_Item=t,i.m_FullUpdate=!1,i.m_Erased=!1,document.dispatchEvent(i)},window.UZ=function(e){e=window.atob(e);return window.RawDeflate.deflate(e,6)},window.B64F32=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),i=new DataView(e),r=0;r<t.length;r++)i.setInt8(r,t.charCodeAt(r));return new Float32Array(e)},window.B64I32=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),i=new DataView(e),r=0;r<t.length;r++)i.setInt8(r,t.charCodeAt(r));return new Int32Array(e)},window.B64UI32=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),i=new DataView(e),r=0;r<t.length;r++)i.setInt8(r,t.charCodeAt(r));return new Uint32Array(e)},window.B64UI16=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),i=new DataView(e),r=0;r<t.length;r++)i.setInt8(r,t.charCodeAt(r));return new Uint16Array(e)},window.ZB64S=function(e){return e?(e=window.atob(e),window.JSDeflate.inflate(e)):""},window.getXeApplication=function(){return window.m_XeApplication},window.getXeActiveDocument=function(){return window.m_XeApplication.getXeActiveDocument()},window.emulateContextLoss=function(){window.getXeApplication().getDrawingEngine().getXeRenderer().getGl().getExtension("WEBGL_lose_context").loseContext()},window.__LogRequests=!1,window.__logBinaryChunks=!1,window.__LogTraces=!1,window.m_forceOldLWLTShader=!1,window.m_bForceOutlines=!0,window.m_bForceProcPointsSimplf=!0,window.m_bForceProcPointsSimplfCircle=!1,window.m_bForceProcPointsSimplfArc=!1,window.m_bForceProcPointsSimplfElipse=!1,window.m_bFixAttribSegCalc=!0,window.forceOldLWLTShader=function(){return window.m_forceOldLWLTShader},window.forceOutlines=function(){return window.m_bForceOutlines},window.fixAttribSegCalc=function(){return!window.IsOsVersion()&&window.m_bFixAttribSegCalc},window.m_XeApplication=new XeApplication,function(){var n=this;n.ReportTestResult=function(e,t,i,r){window.XeLogger.log("Test "+e+" done in "+t+" ms, client repaint "+i+" ms");var n=window.getXeApplication().getDrawingEngine().getCanvasImage(),i={name:"xetest",appdata:window.applicationData,testName:e,clientTime:i,serverTime:t,testData:{image:n,testName:e,result:r}};window.parent.postMessage(i,"*")},n.RepaintClient=function(e,t){window.getXeApplication().redraw()},n.SendInputToServer=function(e){window.getXeApplication().SendUserInput(e)},n.emitMiddleMouseDown=function(e,t){var i=window.Wt.WT,r=window.getXeActiveDocument().getXeInputPointManager().getInputPointManager(),n=r.getOptions(),i=i.widgetPageCoordinates(n),n=e-i.x,i=t-i.y,o={xeWidgetId:"CANVAS"},e=(o.screenX=e,o.screenY=t,o.clientX=n,o.clientY=i,o.buttons=4,new MouseEvent("mousedown",o));r.onMouseDown(e)},n.emitMiddleMouseMove=function(e,t){var i=window.Wt.WT,r=window.getXeActiveDocument().getXeInputPointManager().getInputPointManager(),n=r.getOptions(),i=i.widgetPageCoordinates(n),n=e-i.x,i=t-i.y,o={xeWidgetId:"CANVAS"},e=(o.screenX=e,o.screenY=t,o.clientX=n,o.clientY=i,o.buttons=4,new MouseEvent("mousemove",o));r.onMouseMove(e)},n.emitMiddleMouseUp=function(e,t){var i=window.Wt.WT,r=window.getXeActiveDocument().getXeInputPointManager().getInputPointManager(),n=r.getOptions(),i=i.widgetPageCoordinates(n),n=e-i.x,i=t-i.y,o={xeWidgetId:"CANVAS"},e=(o.screenX=e,o.screenY=t,o.clientX=n,o.clientY=i,o.buttons=4,new MouseEvent("mouseup",o));r.onMouseUp(e)},n.emitMouseMove=function(e,t,i){var r=window.getXeActiveDocument().getXeGsDevice().getActiveViewport().PointToWCS(e,t,!0),i=i?{id:"CANVAS",type:"mousemove",mouse_button:{lmb:!0,mmb:!1,rmb:!1},modifiers:{shift:!1,ctrl:!1,alt:!1,meta:!1},mouse_position:{x:e,y:t},cursor_position:{x:r[0],y:r[1],z:r[2]},wheel_delta:0,key:{key:"",keyCode:0,charCode:0},unique_stat_id:8}:{id:"CANVAS",type:"mousemove",mouse_button:{lmb:!1,mmb:!1,rmb:!1},modifiers:{shift:!1,ctrl:!1,alt:!1,meta:!1},mouse_position:{x:e,y:t},cursor_position:{x:r[0],y:r[1],z:r[2]},wheel_delta:0,key:{key:"",keyCode:0,charCode:0},unique_stat_id:8};n.SendInputToServer(i)},n.emitMouseWheel=function(e,t,i){var r=window.Wt.WT,n=window.getXeActiveDocument().getXeInputPointManager().getInputPointManager(),o=n.getOptions(),r=r.widgetPageCoordinates(o),o=e-r.x,r=t-r.y,a=window.document.createEvent("MouseEvents");a.initMouseEvent("mousewheel",!0,!0,window.document.defaultView,1,e,t,o,r,!1,!1,!1,!1,0,null),a.deltaX=i,a.deltaY=i,a.xeWidgetId="CANVAS",n.updateInput(a)},n.emitMouseClick=function(e,t){var i=window.getXeActiveDocument().getXeGsDevice().getActiveViewport().PointToWCS(e,t,!0),r={id:"CANVAS",type:"mousedown",mouse_button:{lmb:!0,mmb:!1,rmb:!1},modifiers:{shift:!1,ctrl:!1,alt:!1,meta:!1},mouse_position:{x:e,y:t},cursor_position:{x:i[0],y:i[1],z:i[2]},wheel_delta:0,key:{key:"",keyCode:0,charCode:0},unique_stat_id:8};n.SendInputToServer(r),r={id:"CANVAS",type:"mouseup",mouse_button:{lmb:!0,mmb:!1,rmb:!1},modifiers:{shift:!1,ctrl:!1,alt:!1,meta:!1},mouse_position:{x:e,y:t},cursor_position:{x:i[0],y:i[1],z:i[2]},wheel_delta:0,key:{key:"",keyCode:0,charCode:0},unique_stat_id:8},n.SendInputToServer(r),r={id:"CANVAS",type:"click",mouse_button:{lmb:!0,mmb:!1,rmb:!1},modifiers:{shift:!1,ctrl:!1,alt:!1,meta:!1},mouse_position:{x:e,y:t},cursor_position:{x:i[0],y:i[1],z:i[2]},wheel_delta:0,key:{key:"",keyCode:0,charCode:0},unique_stat_id:8},n.SendInputToServer(r)},n.emitEnterPressed=function(){window.getXeActiveDocument().RunCmd("\n")},n.emitCancelPressed=function(){window.getXeActiveDocument().RunCmd("^C")}}),OsObjectsGroup=(XeWebDrawerEngineImpl.prototype.getIntersected=function(e){var t,i=e.getXeInputPointManager(),r=window.getXeApplication().getDrawingEngine().getImpl();if(i&&r&&(!window._LOG_GLOBAL||!window._LOG_GLOBAL.GET("DIS_CL_SIDE_SEL")))return(new Date).getTime(),t=e.getXeDatabase().getPICKBOX(),(i=[i.getHitTestInfo().GetMousePosition().x,i.getHitTestInfo().GetMousePosition().y])[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),r.getHandlesInSelection(e,i[0]-t-1,i[1]+t+1,2*t+1,2*t+1)},function(){}),isAssocGrip=(OsObjectsGroup.prototype.FilterObjectGroup=function(e){var t=[];if(null!=e&&null!=e.owngrp&&null!=e.childgrp){var i=JSON.parse(e.owngrp),r=JSON.parse(e.childgrp);for(let e=0;e<i.length;e++)t.indexOf(i[e])<0&&t.push(i[e]);for(let e=0;e<r.length;e++)t.indexOf(r[e])<0&&t.push(r[e])}return t},OsObjectsGroup.prototype.HasCallout=function(t){var i={set:[]};if(document.osObjectsGroup.GetCalloutGroup(t,i),null!=i)for(let e=0;e<i.set.length;e++){var r=t.getXeEntities().getByHandle(i.set[e]);if(null!=r&&("OnshapeBalloon"===r.getClass()||"OnshapeRevisionMarker"===r.getClass()))return!0}return!1},OsObjectsGroup.prototype.HasRadialOrDiametricDim=function(t){var i={set:[]};if(document.osObjectsGroup.GetCalloutGroup(t,i),null!=i)for(let e=0;e<i.set.length;e++){var r=t.getXeEntities().getByHandle(i.set[e]);if(null!=r&&("AcDbRadialDimension"===r.getClass()||"AcDbDiametricDimension"===r.getClass()))return!0}return!1},OsObjectsGroup.prototype.GetCalloutOwner=function(e){var t={set:[]};document.osObjectsGroup.GetCalloutGroup(e,t);let i,r,n,o;if(null!=t){var a=e.getXeEntities();for(let e=0;e<t.set.length;++e){var s=t.set[e],s=a.getByHandle(s);if(null!=s){if("XeDimension"==s.m_ClassName||"OsChamferCalloutNote"==s.getClass()||"AcDbMText"==s.getClass()||"OnshapeHoleTag"==s.getClass()||"OnshapeBendLineNote"==s.getClass()||"OnshapeWeldSymbol"==s.getClass()||"OnshapeSurfaceFinish"==s.getClass()||"AcDbBlockReference"==s.getClass())return s;null!==r&&"AcDbFcf"==s.getClass()?r=s:null!==n&&"OnshapeBalloon"==s.getClass()?n=s:"OnshapeRevisionMarker"==s.getClass()?o=s:"OnshapeDatum"==s.getClass()&&(i=s)}}}return null!=r?r:null!=i?i:null!=n?n:null!=o?o:null},OsObjectsGroup.prototype.GetCalloutGroup=function(e,t){var e=e.getGroup();(e=this.FilterObjectGroup(e)).length&&(t.set=e)},document.osObjectsGroup=new OsObjectsGroup,XeDatabase.prototype.setCURSORMODE=function(e){this.m_CURSORMODE=e},XeDatum.prototype.CheckIfGrip=function(a){var e=this.getEntityData();if(void 0===e)return XeEntity.prototype.CheckIfGrip_base_call.call(this,a);var t=this.CheckIfGrips(a);if(0<t.length)return t.includes(1)?1:t[0];t=this.getLayerObject();if(t&&!0!==t.getLocked()){var t=window.getXeActiveDocument(),s=t.getXeDatabase();let i=t.getXeGsDevice().getActiveViewport(),r=s.getAPERTURE(),n,o=0;return e.every(e=>{if(2===e.length){var t=i.PointToSCS(e[0]),e=i.PointToSCS(e[1]);if(t[0]-=r,t[1]+=r,e[0]+=r,e[1]-=r,a.x>t[0]&&a.x<e[0]&&a.y<t[1]&&a.y>e[1]&&0!==(n=o))return!1}return++o,!0}),n}},XeDatum.prototype.getCustomGripMode=function(e){let t;var i;return this.getGrips()[e]&&(i=XeEntity.prototype.CustomGripModeEnum,1===e&&(t=i.AlignToEdge),void 0===this.getEntityData()||2!==e&&3!==e&&4!==e&&5!==e&&6!==e||(t=i.DimensionText)),t},XeDatum.prototype.OnStartDragCopy=function(){var a=this,e=this.getXeDatabase().getXeDocument().getXeInputPointManager();if(e){var o=e.GetDragInfo(),s=o.actualPreview;if(s){a.RequestAncestors().then(function(){var e=a.getXeDatabase().getXeDocument().getXeInputPointManager();if(e){var t=e.GetDragInfo(),i=t.actualPreview,r=a.getLeaders();if(r)for(var n=0;n<r.length;n++){var o=r[n];o&&(i.addXeEntity(o,!0),t.handles.push(o.getHandle()))}}});let n=this.getXeDatabase().getXeEntities();a.isLeader()&&this.RequestDependent().then(function(){var t=a.getDependent();for(let e=0;e<t.length;e++){var i,r=t[e];0<=o.handles.indexOf(r)||((i=n.getByHandle(r))&&!i.IsHidden()?(s.addXeEntity(i,!0),o.handles.push(r)):0)}});var i=this.getXeDatabase().getXeDocument().getXeMainSelectionSet().getHandles();let t=!1;for(let e=i.length-1;0<=e;e--)i[e]===a.m_Ancestors.m_Result[0]&&(t=!0);e=this.getXeDatabase().getXeDocument().getXeInputPointManager();if(e&&t){var r=e.getDependentCopySet(this);if(void 0!==r&&r&&0<r.length){var c=e.GetDragInfo(),l=c.actualPreview;for(let e=0;e<r.length;e++){var d=r[e],u=n.getByHandle(d);u&&(l.addXeEntity(u,!0),c.handles.push(d))}}}e=this.getXeDatabase().getXeDocument().getXeGsDevice();e&&(e.invalidateSelectionScene(),e.invalidateClientTrackersGL(),this.getXeDatabase().getXeDocument().getXeInputPointManager().InvalidateApertureSelection())}}},XeDimension.prototype.IsPointInside=function(e,t){var i=!1,r=t[0],t=t[1];return i=r>e.minPoint().x&&r<e.maxPoint().x&&t>e.minPoint().y&&t<e.maxPoint().y?!0:i},XeDimension.prototype.getOrdinateParentId=function(){return void 0===this.m_OrdinateParentId?null:this.m_OrdinateParentId},XeDimension.prototype.getChildHandles=function(){return this.m_ChildHandles},XeDimension.prototype.CheckIfDimText=function(t){var i=this.getXeEntities().getXeDatabase().getXeDocument().getXeGsDevice(),e=i.getChunks();if(e){var r,n=this.getXeGsOffsetsWithNested();for(r in n){var o=e[r],a=n[r];if(o&&o.getSelectionGeom()){var s=o.getGeometryToModelMatrix(),c=o.getIndexes(),l=o.getVertexes(),d=new GeNeo.OdGeExtents3d;for(let e=0;e<a.length;e++){for(var u=a[e],p=u.o,m=p+u.s,h=new GeNeo.OdGePoint3d,g=p;g<m;g++)h.set(l[3*c[g]+0],l[3*c[g]+1],l[3*c[g]+2]),h.transformBy(s),d.addPoint(h);u=i.getActiveViewport().PointToWCS(t.x,t.y,!0);if(this.IsPointInside(d,u))return!0}}}return!1}},XeDimension.prototype.GetGripTextIndex=function(){return"AcDbRadialDimension"===this.getClass()||"AcDbDiametricDimension"===this.getClass()?0:"AcDb2LineAngularDimension"===this.getClass()?5:"AcDbOrdinateDimension"===this.getClass()?2:"AcDbRadialDimensionLarge"===this.getClass()?3:4},XeDimension.prototype.getGrips=function(){var e=this.getClass(),t=[];this.getXeEntities().getXeDatabase().getXeDocument().getXeDatabase().getMEASUREMENT();return"AcDbAlignedDimension"===e||"AcDbRotatedDimension"===e?(t=this.m_Grips.slice(),"AcDbRotatedDimension"!==e&&"AcDbAlignedDimension"!==e||8!==this.m_Grips.length&&10!==this.m_Grips.length&&12!==this.m_Grips.length||new GeNeo.OdGePoint3d(this.m_Grips[4]).isEqualTo(new GeNeo.OdGePoint3d(this.m_Grips[7]))&&t.splice(7,1),t):"AcDb2LineAngularDimension"===e?((t=this.m_Grips.slice())[4]=void 0,t):"AcDb3PointAngularDimension"===e?((t=this.m_Grips.slice())[3]=void 0,t):"AcDbRadialDimension"===e||"AcDbDiametricDimension"===e?this.m_Grips.slice():XeEntity.prototype.getGrips.call(this)},XeDimension.prototype.CheckIfGrip=function(e){var t=this.CheckIfGrips(e);if(0<t.length){for(var i in t)if(t[i]!==this.GetGripTextIndex())return t[i];return t[0]}var r=this.getLayerObject();return r&&!0!==r.getLocked()&&!0===this.CheckIfDimText(e)?this.GetGripTextIndex():void 0},XeDimension.prototype.drawGrip=function(e,t,i,r,n,o,a){var s,c;e!==this.GetGripTextIndex()&&this.getGrips()[e]&&(s=this.getClass(),c=this.getXeEntities().getXeDatabase().getXeDocument(),"AcDbRadialDimensionLarge"===s&&0===e?this.drawCenterMark(t,i,r,c):XeEntity.prototype.drawGrip.call(this,e,t,i,r,n,o,a))},XeDimension.prototype.drawCenterMark=function(e,t,i,r){var n=r.getXeDatabase().getGRIPSIZE(),o=t-n/2,a=i,s=t+n/2,c=i,l=t,d=i+n/2,i=i-n/2,n=r.getXeGsDevice().getForeground(),r=window.XeUtils.intRGBToHex(n);return e.strokeStyle=r,e.beginPath(),e.moveTo(o,a),e.lineTo(s,c),e.moveTo(l,d),e.lineTo(t,i),e.stroke(),!0},XeDimension.prototype.RequestBeautifulLine=function(){if(!this.m_OrdinateLinePoints){let e=this.getXeEntities().getXeDatabase().getXeDocument(),t=e.getXeInputPointManager().getMousePosition(),i=XeRequest.prototype.FakePromise;"AcDbOrdinateDimension"===this.getClass()&&(i=XeRequest.prototype.Promise),this.m_OrdinateLinePoints=i(this,{handle:this.getHandle(),pt:t},"RequestLine")}return this.m_OrdinateLinePoints},XeDocument.prototype.cmdERASE=function(){var e=this.getXeMainSelectionSet().getHandles(),t=this.getXeDatabase().getXeEntities();if(0<e.length){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=t.getByHandle(n);!o||"OnshapeBendLineNote"===o.getClass()||"OnshapeDepthPoint"===o.getClass()||"OnshapeOriginIndicator"===o.getClass()||"OnshapeHoleTag"===o.getClass()||"OnshapeCenterMark"===o.getClass()&&o.getAutoCenterMark()||i.push(o)}var a=i.reduce(function(e,t){return e&&"OnshapeSplinePoint"===o.getClass()},!0);if(0<i.length)if(a)this.RunCmd("_OSDELETE\n");else{this.CommandStart("CLIENT_ERASE");let t="";i.forEach(function(e){e.invalidateCache(),e.EraseGraphics(),e.getXeDatabase().getXeEntities().R_E(e.getPath()),t+=","+e.getHandle()}),""!=t&&this.getXeDatabase().DoErase(t),this.CommandEnd("CLIENT_ERASE")}}},XeDocument.prototype.RequestThumbnail=function(n){(0,XeRequest.prototype.Promise)(this,{layout:"",width:n.width,height:n.height},"RequestThumbnail").then(i=>{var r,e=new Image;e.crossOrigin="Anonymous",e.onload=function(){var e=document.createElement("CANVAS"),t=e.getContext("2d");e.height=n.height,e.width=n.width,t.drawImage(this,0,0),r=e.toDataURL("image/png"),window.osc&&window.osc._n(i,r,n)},e.src=i})},XeApplication.prototype.GetCapability=function(e){return window.OnshapeCapabilities.hasOwnProperty(e)&&window.OnshapeCapabilities[e]},window.getSessionId=function(){return window.applicationData&&window.applicationData.session?window.applicationData.session.sessionId:""},XeEntities.prototype.AddEntity=function(e,t){this.createByGiPath(e,t),t.getOwnerEntity().FireUpdate(),1==e.length&&(t.RequestGroups(),t.RequestNoteAnnotations(),t.RequestAssociated(),t.RequestDependentCopy(),t.RequestAncestors().then(function(){t.AddToAncestors()}),"OnshapeViewObject"==t.m_Class)&&(t.m_Dependent=void 0,t.RequestDependent())},XeEntities.prototype.A_XEI=function(e,t,i){t&&this.createByGiPath(t.getPath(),t);for(let e=0;e<i.length;e++){var r=i[e];r&&this.createByGiPath(r.getPath(),r)}t&&(t.FireUpdate(),t.RequestAssociated(),t.RequestAncestors().then(function(){t.AddToAncestors()}),t.RequestDependentCopy(),"OnshapeViewObject"==t.m_Class)&&(t.m_Dependent=void 0,t.RequestDependent()),t||(t=t.getXeEntities().getByHandle(e))&&delete t.m_XeGsOffsetsWithNested,t&&(t.m_XeDrawMode==XeDrawMode.kHidden?t.Hide():t.Show())},function(e,t){if(e&&0!==e.length)for(var i=0;i<e.length;i+=3)if(x=e[i],y=e[i+1],x.toPrecision(5)===t[0].toPrecision(5)&&y.toPrecision(5)===t[1].toPrecision(5))return!0;return!1});XeEntity.prototype.CheckIfGrip_base_call=XeEntity.prototype.CheckIfGrip,XeEntity.prototype.CheckIfGrip=function(e){var t;return window.getXeCallbacksContainer().hasOverrides(this)?window.getXeCallbacksContainer().proc(this,"CheckIfGrip",e,function(e){t=e}):t=XeEntity.prototype.CheckIfGrip_base_call.call(this,e),t},XeEntity.prototype.GetGripMoveIndex=function(){if("OnshapeSurfaceFinish"!==this.getClass()){if("OnshapeWeldSymbol"===this.getClass())if(1===this.getGrips().length)return 0;if("AcDbFcf"===this.getClass())return this.getGrips(),0;if("OnshapeBalloon"===this.getClass())return 1===this.getGrips().length?0:1;if("OnshapeDatum"===this.getClass())return 1!=document.osObjectsGroup.HasCallout(this)||document.osObjectsGroup.HasRadialOrDiametricDim(this)?0:this.getGrips().length-1;if("OsChamferCalloutNote"===this.getClass())if(1===this.getGrips().length)return 0;return"AcDbBlockReference"===this.getClass()&&void 0===this.getMTextId()?0:"OnshapeHoleTag"===this.getClass()||"OnshapeInspectionSymbol"===this.getClass()?1===this.getGrips().length?0:1:"OnshapeBendLineNote"===this.getClass()&&this.IsPartOfGroup()?1:"OnshapeRevisionMarker"===this.getClass()?this.getGrips().length-1:"AcDbPoint"===this.getClass()?0:void 0}var e=this.getGrips(),t=this.getLeaders();if(2===e.length&&t&&0<t.length)return 1;if(2===e.length&&0==this.IsAttachedToViewEdge()&&1==this.IsPartOfGroup())return 1;if(1===e.length){t=this.getAssociatedPoints();if(!isAssocGrip(t,e[0]))return 0}},XeEntity.prototype.IsPartOfGroup=function(){var e={set:[]};return document.osObjectsGroup.GetCalloutGroup(this,e),0!=e.set.length},XeEntity.prototype.IsAttachedToViewEdge=function(){var e=this.getXeEntities(),t=!1,i=this.getAncestors();if(i)for(var r=0;r<i.length;r++){var n=e.getByHandle(i[0]);if(n&&("OnshapeViewObject"===n.getClass()||"OnshapeCenterLine"===n.getClass()||"OnshapeSmartCenterLine"===n.getClass()||"XeLine"===n.m_ClassName)){t=!0;break}}return t},XeEntity.prototype.GetViewId=function(){var e=this.getXeEntities(),t=this.getAncestors();if(t)for(var i=0;i<t.length;i++){var r=e.getByHandle(t[i]);if(r){if("OnshapeViewObject"==r.getClass())return r.getHandle();if("XeDimension"==r.m_ClassName)return r.GetViewId();if("OnshapeMLeader"==r.getClass())return r.GetViewId();if("OsChamferCalloutNote"==r.getClass())return r.GetViewId()}}return""},XeEntity.prototype.AddOsObjects=function(e){let g=this;this.RequestGroup().then(function(){var e=g.getXeEntities().getXeDatabase().getXeDocument(),i=e.getXeInputPointManager();if(i){var r=i.GetDragInfo(),n=r.actualPreview;if(n){var o=e.getXeDatabase().getXeEntities(),i={set:[]},a=(document.osObjectsGroup.GetCalloutGroup(g,i),i.set);let t="";0<a.length&&(e=o.getByHandle(a[0]))&&(t=e.getClass());for(let e=0;e<a.length;e++){var s=o.getByHandle(a[e]);s&&"XeDimension"===s.m_ClassName&&(t="XeDimension")}for(let e=0;e<a.length;e++){var c=o.getByHandle(a[e]);if(c){var l=c.getHandle();if(!(0<=r.handles.indexOf(l))&&("XeDimension"!==t&&"OsChamferCalloutNote"!==t&&"OnshapeBendLineNote"!==t&&"OnshapeViewObject"!==c.getClass()&&("AcDbFcf"!==c.getClass()||"XeDimension"!==t))){if("AcDbFcf"===c.getClass()||"AcDbMText"===c.getClass()||"OnshapeDatum"===c.getClass()){var d=!1,u=c.getAncestors();if(u)for(var p=0;p<u.length;p++){var m=o.getByHandle(u[e]);if(m){var h=m.m_ClassName;if("OnshapeViewObject"===m.getClass()||"XeDimension"===h){d=!0;break}}}if("AcDbMText"===c.getClass()&&c.RequestNoteAnnotations().then(c.OnStartDragDrop.bind(c)),d)continue}!c||"XeDimension"===t||c.IsHidden()||(n.addXeEntity(c,!0),r.handles.push(l),c.Hide())}}}}}})},XeEntity.prototype.ValidDragObj=function(e){if(("OnshapeBalloon"==e.getClass()||"OnshapeRevisionMarker"==e.getClass())&&e.IsPartOfGroup()){var t=this.GetDragViewIds(),e=e.GetViewId();if(!t.includes(e))return!1}return!0},XeEntity.prototype.GetDragViewIds=function(){var e=this.getXeDatabase().getXeDocument(),t=e.getXeInputPointManager();if(t){var t=t.GetDragInfo(),i=[];if(t.actualPreview){var r=e.getXeDatabase().getXeEntities(),n=t.handles;if(n)for(let e=0;e<n.length;e++){var o=r.getByHandle(n[e]);o&&"OnshapeViewObject"==o.getClass()&&i.push(n[e])}}return i}},XeEntity.prototype.draw_gl=function(e,t,i){throw"XeEntity.prototype.draw_gl"},XeEntity.prototype.getCustomGripMode=function(e){var t,i=this.getXeDatabase(),r=(i.getMEASUREMENT(),XeEntity.prototype.CustomGripModeEnum),n=this.getClass(),o=this.getGrips(),a=o[e],s=!1;if(a){if(this instanceof XeDimension){if(e===this.GetGripTextIndex())return t=r.DimensionText;var c=this.getCustomGripModeFromType(e);if(void 0!==c)return c}(!this.m_IsForeshortenDim||void 0!==this.m_ForeshortenType&&2===this.m_ForeshortenType)&&(l=this.getAssociatedPoints());var l,d,u,p,m=this.getAssociated();if("AcDbAlignedDimension"===n)t=void 0,5!==e&&6!==e&&(7!==e||8!==o.length&&10!==o.length&&12!==o.length)||(t=r.Flip);else if("AcDbRotatedDimension"===n)s=!0,t=void 0,this.m_IsForeshortenDim?3===e||5===e||6===e||1===e||7===e&&(8===o.length||10===o.length||12===o.length)?t=r.NoDraw:0===e&&(t=r.PointAttachment):(0!==e&&1!==e||(m&&m.length&&(t=r.EdgeAttachment),isAssocGrip(l,a)&&(t=r.PointAttachment)),5!==e&&6!==e&&(7!==e||8!==o.length&&10!==o.length&&12!==o.length)||(t=r.Flip));else if("AcDb2LineAngularDimension"===n)t=void 0,0!==e&&1!==e&&2!==e&&3!==e||(t=r.AlignToEdge),6!==e&&7!==e||(t=r.Flip);else if("AcDb3PointAngularDimension"===n)t=void 0,5!==e&&6!==e||(t=r.Flip);else if("AcDbRadialDimension"===n||"AcDbDiametricDimension"===n){var c=this.getGripType();if(void 0!==c&&c.length>e)return(t=Number(c[e]))<0?void 0:t;t=void 0,1===e&&(t=r.AlignToEdge),2!==e&&3!==e||(t=r.Flip),4===o.length&&2===e&&"AcDbRadialDimension"===n&&(t=r.NormalResize)}else if("AcDbRadialDimensionLarge"===n)t=r.NormalResize;else if("AcDbMText"===n)if(1===o.length)t=r.AlignToEdge;else{if(t=r.NormalResize,e===this.GetGripMoveIndex())return t=void 0;2===e&&(t=r.Rotate),3===e&&(t=r.AlignToEdge)}else"OnshapeCenterLine"===n?(t=r.NormalResize,1!==e&&2!==e||(t=void 0)):"OnshapeSmartCenterLine"===n?(t=r.NormalResize,2!==e&&3!==e||(t=r.AlignToEdge)):"OnshapeDetailViewBoundary"===n?(e<o.length-1||2<o.length&&(c=this.getDependent())&&c.length)&&(t=r.PointAttachment):"OsChamferCalloutNote"===n?(t=void 0,0===e&&(t=r.DimensionText)):"AcDbTable"===n?(t=void 0,4!==e&&5!==e&&6!==e&&7!==e||(t=r.NormalResize)):"OnshapeCenterMarkRadialLine"===n&&(t=r.NormalResize);if(!s){if(m&&m.length&&t===r.AlignToEdge){var h=i.getXeEntities();for(let e=0;e<m.length;++e){var g=m[e];if(g&&0<g.length){g=g[0],g=h.getByHandle(g);if(null!=g&&"OnshapeInspectionSymbol"!==g.getClass()){t=r.EdgeAttachment;break}}}}if(l&&l.length)for(p=0;p<l.length;p+=3)if(d=l[p],u=l[p+1],d.toPrecision(5)===a[0].toPrecision(5)&&u.toPrecision(5)===a[1].toPrecision(5)){t=r.PointAttachment;break}}"AcDb3PointAngularDimension"===n&&this.getCustomAngularDim()&&void 0===t&&(t=r.NoDraw)}return t},XeEntity.prototype.CustomGripModeEnum={NormalResize:0,Rotate:1,Flip:2,AlignToEdge:3,DimensionText:4,PointAttachment:5,EdgeAttachment:6,Undefined:7,NoDraw:8},XeEntity.prototype.drawGrip=function(e,t,i,r,n,o,a){var s=OsTableTracker.prototype.FixedCornersEnum;if(this.getGrips()[e]){var c=this.GetGripMoveIndex();if(c!==e&&("OnshapeDatum"!==this.getClass()||0!=c)&&!("OnshapeSurfaceFinish"===this.getClass()&&1===e&&0==this.IsAttachedToViewEdge()||"AcDbMText"===this.getClass()&&3===e&&this.getIsGroupWithView()&&0==this.IsPartOfGroup())){if("AcDbTable"===this.getClass()&&this.m_EntityData&&this.m_EntityData.ONSHAPE_TABLE_FIXED_CORNER_DATA){var c=e,l=this.m_EntityData.ONSHAPE_TABLE_FIXED_CORNER_DATA.fixedCorner;if(l===s.FixedCornerBottomLeft){if(4===c||5===c)return}else if(l===s.FixedCornerBottomRight){if(6===c||5===c)return}else if(l===s.FixedCornerTopRight){if(6===c||7===c)return}else if(l===s.FixedCornerTopLeft&&(4===c||7===c))return;if((0===c||1===c||2===c||3===c)&&(0===c&&2===l||1===c&&0===l||2===c&&1===l||3===c&&3===l))return t.lineWidth=1,t.strokeStyle="#FFFFFF",t.fillStyle="#000000",t.beginPath(),t.arc(i,r,n,0,2*Math.PI,!1),t.fill(),void t.stroke()}s=XeEntity.prototype.CustomGripModeEnum,c=this.getCustomGripMode(e);"AcDbAlignedDimension"===this.getClass()&&(c===s.PointAttachment||void 0===c)&&this.getCustomWallThicknessDim()||(c!==s.PointAttachment&&c!==s.EdgeAttachment||(o="#90CEF1"),void 0===c?d():c===s.NormalResize?(t.lineWidth=1,t.strokeStyle=a,t.fillStyle=o,t.beginPath(),t.rect(i-n,r-n,2*n,2*n),t.fill(),t.stroke()):c===s.Rotate?(t.lineWidth=1,t.strokeStyle=o,t.fillStyle="#FFFFFF",t.beginPath(),t.arc(i,r,n,0,2*Math.PI,!1),t.fill(),t.stroke(),t.strokeStyle="#FFFFFF",t.beginPath(),t.arc(i,r,n+1,0,2*Math.PI,!1),t.stroke()):c===s.Flip?(l=n+=2,t.lineWidth=1,t.strokeStyle=a,t.fillStyle=o,t.beginPath(),t.moveTo(i-l,r),t.lineTo(i,r-l),t.lineTo(i+l,r),t.lineTo(i,r+l),t.closePath(),t.fill(),t.stroke()):c!==s.AlignToEdge&&c!==s.PointAttachment&&c!==s.EdgeAttachment&&c!==s.Undefined||d())}}function d(){t.lineWidth=1,t.strokeStyle=a,t.fillStyle=o,t.beginPath(),t.arc(i,r,n,0,2*Math.PI,!1),t.fill(),t.stroke()}},XeEntity.prototype.RequestAncestors=function(){return this.m_Ancestors=this.m_Ancestors||XeRequest.prototype.Promise(this,this.getHandle(),"RequestAncestors"),this.m_Ancestors},XeEntity.prototype.RequestDependent=function(){return this.m_Dependent=this.m_Dependent||XeRequest.prototype.Promise(this,this.getHandle(),"RequestDependent"),this.m_Dependent},XeEntity.prototype.RequestTooltip=function(){var e=this.getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_Tooltip=this.m_Tooltip||XeRequest.prototype.Promise(this,{handle:this.getHandle(),pt:e},"RequestTooltip"),this.m_Tooltip},XeEntity.prototype.RequestAssociated=function(){let n=this;return n.RequestAncestors().then(function(e){n.getXeEntities();var t=n.getLeaders();if(t)for(var i=0;i<t.length;i++){var r=t[i];r&&r.RequestAssociated()}}),n.m_Associated=n.m_Associated||XeRequest.prototype.Promise(n,n.getHandle(),"RequestAssociated"),n.m_Associated},XeEntity.prototype.GripIndexesEnum={kDefPoint1:1,kDefPoint2:2,kExtLineEnd:3,kDimLineDef:4,kDimCenter:5,kChordPoint:6,kFarChordPoint:7,kTextPosition:8,kXLine1:9,kXLine1End:10,kXLine2:11,kXLine2End:12,kArcPoint:13,kLeaderEndPoint:14,kOrigin:15,kOverrideCenter:16,kJogPoint:17,kFlipPoint:18,kTextFlip:19,kOrdinateJogPoint:20,kExtLineJogPoint1:21,kExtLineJogPoint2:22},XeEntity.prototype.getGripType=function(e){var t=this.getEntityData&&this.getEntityData();return void 0!==t&&0<t[e]?t[e]:void 0},XeEntity.prototype.isAssocPointGrip=function(e){var e=this.getGrips()[e],t=this.getAssociatedPoints();return isAssocGrip(t,e)},XeEntity.prototype.isAssocEdgeGrip=function(e){var t=this.getAssociated(),i=window.getXeActiveDocument().getXeDatabase().getXeEntities();for(let e=0;e<t.length;++e){var r=t[e];if(r&&0<r.length){r=r[0],r=i.getByHandle(r);if(null!=r)return!0}}return!1};let mapIndexesToGripMode=function(e){var t=XeEntity.prototype.CustomGripModeEnum,i=XeEntity.prototype.GripIndexesEnum;switch(e){case i.kDefPoint1:case i.kDefPoint2:return t.AlignToEdge;case i.kExtLineEnd:case i.kDimLineDef:return t.Undefined;case i.kDimCenter:return t.NormalResize;case i.kChordPoint:case i.kFarChordPoint:return t.AlignToEdge;case i.kTextPosition:return t.DimensionText;case i.kXLine1:case i.kXLine1End:case i.kXLine2:case i.kXLine2End:case i.kArcPoint:return t.AlignToEdge;case i.kLeaderEndPoint:return t.Undefined;case i.kOrigin:case i.kOverrideCenter:case i.kJogPoint:return t.NormalResize;case i.kFlipPoint:case i.kTextFlip:return t.Flip;case i.kOrdinateJogPoint:return t.AlignToEdge;case i.kExtLineJogPoint1:case i.kExtLineJogPoint2:return t.Undefined}return t.Undefined};XeEntity.prototype.getCustomGripModeFromType=function(t){var i=this.getGripType(t);if(void 0!==i){var r=this.getClass();let e=mapIndexesToGripMode(i);var n=XeEntity.prototype.CustomGripModeEnum,o=XeEntity.prototype.GripIndexesEnum,r=("AcDbRadialDimensionLarge"===r&&(e=n.NormalResize),"OnshapeInspectionSymbol"===this.getClass()||e!==n.AlignToEdge||i!==o.kDefPoint1&&i!==o.kDefPoint2||!this.isAssocEdgeGrip(t)||(e=n.EdgeAttachment),window.getXeApplication().GetCapability("drw_flip_grip_half_dimension")),a=window.getXeApplication().GetCapability("half_dim_elbow_flip_grip");return this.m_IsForeshortenDim&&(i===o.kDefPoint2||i===o.kDimLineDef||r&&i===o.kFlipPoint&&6===t||!r&&i===o.kFlipPoint||!a&&i===o.kTextFlip)&&(e=n.NoDraw),this.m_IsForeshortenDim,e=e!==n.NoDraw&&this.isAssocPointGrip(t)?n.PointAttachment:e}},XeEntity.prototype.onUpdate=function(){if(this.onUpdateCommon(this),1===this.getGiPath().length){let e=this;e.RequestGroup(),e.RequestNoteAnnotations(),e.RequestAssociated(),e.RequestAncestors().then(function(){e.AddToAncestors()}),e.RequestDependentCopy(),"OnshapeViewObject"==e.m_Class&&(e.m_Dependent=void 0,e.RequestDependent())}},XeGsSimpleChunk.prototype.reduceSegmentCount=!1,XeInputPointManager.prototype.getIsTableEditorCommandManagment=function(){return!0},XeInputPointManager.prototype.getSpecificRubberPoint=function(e){return this.getCursorPosition()},XeInputPointManager.prototype.MatchToDragDropFilter=function(e,t){var i=e.getLayerObject();if(!i)return!1;if(i.getLocked())return!1;if("AcDbTable"===e.getClass())return!1;if("AcDbHatch"===e.getClass())return!1;if(1===e.getAssoc())return!1;if("OnshapeBreakLine"===e.getClass())return!1;if("OnshapeDetailViewBoundary"===e.getClass())return!1;if("OnshapeMLeader"===e.getClass())return!1;if("OnshapeBalloon"===e.getClass()||"OnshapeRevisionMarker"===e.getClass()){i=e.getLeaders();if(null!=i&&0<i.length)return!1;if(1===e.getGrips().length)return!1}return"AcDbPoint"!==e.getClass()},XeInputPointManager.prototype.MatchToCopyDragDropFilter=function(e){return!!e.getLayerObject()},XeInputPointManager.prototype.isToggledDimJog=function(e,t){t=e.getGripType(t);return("AcDbRadialDimension"===e.getClass()&&"XeDimension"===e.m_ClassName||"AcDbRadialDimensionLarge"===e.getClass()&&"XeDimension"===e.m_ClassName)&&(t===XeEntity.prototype.GripIndexesEnum.kDimCenter||t===XeEntity.prototype.GripIndexesEnum.kOverrideCenter)},XeInputPointManager.prototype.StartGripEdit=function(t,e,i){var r=t.getLayerObject();if(!0!==this.m_bClientPending){if(r.getLocked())return!1;this.m_bClientPending=!0;this.getXeDocument().getXeMainSelectionSet();t.RequestDependent().then(function(e){t&&t.invalidateEntitiesCache(e||[])});var n,o,a,s,c,l,r=t.getGrips()[i],d=(t.m_ClassName,t.getClass());void 0!==window.noteActive&&!1!==window.noteActive||(this.isToggledDimJog(t,i)?window.getXeActiveDocument().RunCmd("'._OSTOGGLEDIMJOG _LMM "+t.getHandle()+"\n"):XeInputPointManager.prototype.getIsTableEditorCommandManagment()&&"AcDbTable"===d?(n=t.getEntityData&&t.getEntityData())&&n.gripEditDataOnLMB&&(20===n.gripEditDataOnLMB.gripIndex||21===n.gripEditDataOnLMB.gripIndex)?(o=(l=n.gripEditDataOnLMB).lineIntersection.type,a=l.LineIntersectionType,0<o&&(s=-1,c=l.lineIntersection.row,l=l.lineIntersection.column,o===a.Top?s=0:o===a.Right?s=1:o===a.Bottom?s=3:o===a.Left&&(s=2),delete n.gripEditDataOnLMB,0<=s)&&(this.getXeDocument().getViewMode()||this.getXeDocument().RunCmd("^C^C_OSTABLE_ACTION _RESIZE_CELL "+t.getHandle()+" "+s+" "+c+" "+l+" "+c+" "+l+" "+this.m_LastClickWCS[0]+","+this.m_LastClickWCS[1]+","+this.m_LastClickWCS[2]+"\n"))):void 0!==t.getMTextId&&void 0!==t.getMTextId()||this.getXeDocument().RunCmd("'._SNAPGRIP _LMM "+t.getHandle()+" "+i+" "+r[0]+","+r[1]+","+r[2]+" "+e[0]+","+e[1]+","+e[2]+"\n"):"AcDb3PointAngularDimension"===d&&t.getCustomAngularDim()&&2==i&&!XeInputPointManager.prototype.IsDimensionEntDangling(t)||("OnshapeCenterMark"===d&&this.getHitTestInfo().IsShiftPressed()?this.getXeDocument().RunCmd("'^C^C_ADJUSTONECENTERMARKEXT "+t.getHandle()+" "+i+" "+r[0]+","+r[1]+","+r[2]+"\n"):void 0!==t.getMTextId&&void 0!==t.getMTextId()||this.getXeDocument().RunCmd("'._SNAPGRIP _LMM "+t.getHandle()+" "+i+" "+r[0]+","+r[1]+","+r[2]+" "+e[0]+","+e[1]+","+e[2]+"\n")))}},XeInputPointManager.prototype.ProcessMouseMove=function(){var t=this.getPENDING();if(!(t||window.osws&&window.osws.isLock())){t=this.getXeDocument();if(t.getXeDatabase().getXeEntities()){var i=t.getXeDatabase().getPICKBOX(),r=this.getMousePosition(),i=!!this.m_LastClickScreen&&this.SqrDistance(this.m_LastClickScreen,r)>i*i,e=this.GetDragInfo();if(i){i=-1;if(this.m_EntityToGrip&&(i=this.m_EntityToGrip.CheckIfGrip(this.m_LastClickScreen),n=this.m_EntityToGrip,o=this.m_EntityToGrip.getClass(),0<=(i=XeInputPointManager.prototype.getIsTableEditorCommandManagment()&&void 0===i&&"AcDbTable"===o&&(o=n.getEntityData&&n.getEntityData())&&o.gripEditDataOnLMB&&o.gripEditDataOnLMB.gripIndex?o.gripEditDataOnLMB.gripIndex:i))&&i===this.m_EntityToGrip.GetGripMoveIndex()&&this.IsDragCopying(this.m_EntityToGrip)&&(i=-1,this.m_EntityToDrag=this.m_EntityToGrip,this.m_EntityToGrip=void 0),this.m_EntityToGrip){var n=this.m_EntityToGrip.getHandle();let e=!0;var o=this.m_EntityToGrip.getClass();!this.getHitTestInfo().IsShiftPressed()||"OnshapeBalloon"!==o&&"OnshapeRevisionMarker"!==o||this.m_EntityToGrip.IsPartOfGroup()&&(o=t.getXeGsDevice().getActiveViewport().PointToWCS(r.x,r.y,!0),t.RunCmd("'^C^C_MOVEANNOTATAION "+n+" "+o[0]+","+o[1]+","+o[2]+"\n"),e=!1),1==e&&0<=i&&this.StartGripEdit(this.m_EntityToGrip,this.m_LastClickWCS,i),this.m_EntityToGrip=void 0}else this.m_EntityToDrag?(r=this.m_EntityToDrag.getHandle(),e.waitingPreviews[r]||(t=this.IsDragCopying(this.m_EntityToDrag),this.StartDragDrop(this.m_EntityToDrag,this.m_LastClickWCS,t)),this.m_EntityToDrag=void 0):!0===this.m_bStartSelection&&(!0===window.IsOsVersion()&&!this.getHitTestInfo().IsLeftMouseButtonPressed()||this.StartSelection(this.m_LastClickWCS),this.m_bStartSelection=!1)}n=e.actualPreview;n&&(o=this.getSpecificRubberPoint(),(i=new GeNeo.OdGeMatrix3d).setentry(0,3,o[0]-this.m_LastClickWCS[0]),i.setentry(1,3,o[1]-this.m_LastClickWCS[1]),i.setentry(2,3,o[2]-this.m_LastClickWCS[2]),i.setentry(3,3,1),n.setTransform(i))}}},XeInputPointManager.prototype.DoubleClickTimeouts={},XeInputPointManager.prototype.ProcessMouseUp=function(){if(this.m_bLeftMouseButtonPressed){this.m_bLeftMouseButtonPressed=!1,this.m_bClientPending=!1;var t=this.getPENDING();if("ID_MOVEANNOTATAION"===window.CFxUI.getActiveCommand().id&&(e=this.getMousePosition(),e=this.getXeDocument().getXeGsDevice().getActiveViewport().PointToWCS(e.x,e.y,!0),this.getXeDocument().RunCmd(e[0]+","+e[1]+","+e[2])),!(t||window.osws&&window.osws.isLock())){var e=this.getXeDocument().getXeDatabase().getXeEntities();if(e){this.m_EntityToDrag=void 0,this.m_EntityToGrip=void 0,this.m_bStartSelection=!1;var t=this.getXeDocument().getXeMainSelectionSet(),i=t.getHandles(),r=this.GetDragInfo(),n=(e,t,i)=>{if(delete XeInputPointManager.prototype.DoubleClickTimeouts.onMouseUpPostponedFunction,e)t.Remove(i.getHandle());else{let e=!0;"XeBlockReference"===i.m_ClassName&&void 0!==i.getMTextId()&&(e=!1),i.getLayerObject().getLocked()||!0!==e||t.Append(i.getHandle())}};if(r.entity)o=r.bIsCopy,this.EndDragDrop(r.entity,this.m_LastClickWCS,this.getSpecificRubberPoint(),o);else{r=this.GetApertureSelection();if(0<r.length){var o=r[0],a=e.getByHandle(o);if(a){let e=!0;if("AcDbTable"===a.getClass()&&(r=a.getEntityData&&a.getEntityData())&&(e=r.gripEditDataOnLMB&&!0,delete r.gripEditDataOnLMB),e&&(!this.getXeDocument().getViewMode()||"OnshapeViewObject"===a.getClass())){let e=!1;for(var s=0;s<i.length;s++)if(i[s]===a.getHandle()){e=!0;break}"AcDbTable"===a.getClass()?(XeInputPointManager.prototype.DoubleClickTimeouts.onMouseUpPostponedFunction&&clearTimeout(XeInputPointManager.prototype.DoubleClickTimeouts.onMouseUpPostponedFunction),XeInputPointManager.prototype.DoubleClickTimeouts.onMouseUpPostponedFunction=setTimeout(n,XeDoubleClickWatcher.prototype.DblTimeoutTime,e,t,a)):n(e,t,a)}}}else t.ClearSelectionSet()}}}}},XeInputPointManager.prototype.ProcessLeftMouseDown=function(){this.m_bLeftMouseButtonPressed=!0;var u,p,e,t,m=this;function i(e,t,i){if(!t.length)return!1;for(var r,n,o=!1,a=m.getHitTestInfo(),s=0;s<t.length;s++)if((n=t[s])&&(n=u.getByHandle(n))){if(n.leftMouseDown&&n.leftMouseDown(a))return!1;if(void 0===(r=m.IsDragCopying(n)&&!m.IsGripCopying(n)?r:n.CheckIfGrip(p))&&([n,r]=(l=void 0,"AcDbBlockReference"===(d=n).getClass()&&void 0!==d.getMTextId()?(l=(d=u.getByHandle(d.getMTextId())).GetGripMoveIndex(),[d,l]):[d,void 0])),void 0!==r){if(((e,t)=>void 0!==e.m_IsConstraintsDim&&!1!==e.m_IsConstraintsDim&&("AcDbRotatedDimension"!==(e=e.getClass())&&"AcDbAlignedDimension"!==e||0!==t&&1!==t?"AcDb2LineAngularDimension"===e&&(0===t||1===t||2===t||3===t)||"AcDb3PointAngularDimension"===e&&(0===t||1===t||2===t)||("AcDbDiametricDimension"===e||"AcDbRadialDimension"===e)&&1===t:1))(n,r))return!1;if(o=!0,m.m_EntityToGrip=n,window.getXeCallbacksContainer().hasOverrides(n)){window.getXeCallbacksContainer().proc(n,"OnGripLeftMouseDown",r);break}var c,l=window.getXeApplication().GetCapability("half_dim_elbow_flip_grip"),d=window.getXeApplication().GetCapability("drw_flip_grip_half_dimension");if("AcDbRotatedDimension"===n.getClass()&&!0===n.m_IsForeshortenDim&&(!d&&(5===r||7===r||6===r||2===r)||d&&(6===r||2===r)||!l&&d&&7===r))break;if("AcDb3PointAngularDimension"===n.getClass()&&n.getCustomAngularDim()&&2==r&&!XeInputPointManager.prototype.IsDimensionEntDangling(n))break;m.isToggledDimJog(n,r)?e.RunCmd("'_OSTOGGLEDIMJOG _LBD "+n.getHandle()+"\n"):"XeDimension"===n.m_ClassName&&r!==n.GetGripTextIndex()?(c=n.getGrips()[r],e.RunCmd("'._SNAPGRIP _LBD "+n.getHandle()+" "+r+" "+c[0]+","+c[1]+","+c[2]+" "+m.m_LastClickWCS[0]+","+m.m_LastClickWCS[1]+","+m.m_LastClickWCS[2]+"\n")):"OnshapeMLeader"===n.getClass()&&a.IsAltPressed()&&(e.RunCmd("'._OSMLEADERADDBRANCH "+n.getHandle()+" "+r+"\n"),m.m_bClientPending=!0);break}i&&(m.m_EntityToDrag=n)}return o}this.getPENDING()||(u=this.getXeDocument().getXeDatabase().getXeEntities())&&(p=m.getMousePosition(),this.m_LastClickScreen=new GeNeo.OdGePoint2d(p.x,p.y),e=this.getXeDocument().getXeGsDevice().getActiveViewport(),m.m_LastClickWCS=e.PointToWCS(p.x,p.y,!0),this.getXeDocument().getViewMode()||this.getXeDocument().getMobileMode()||(t=(e=m.GetApertureSelection()).length?[e[0]]:[],i(this.getXeDocument(),this.getXeDocument().getXeMainSelectionSet().getHandles(),!1)||i(this.getXeDocument(),t,!0),m.m_EntityToGrip&&(m.m_EntityToDrag=void 0),e.length||(m.m_bStartSelection=!0,m.m_EntityToDrag=void 0),t[0]&&(e=t[0])&&(t=u.getByHandle(e))&&window.getXeCallbacksContainer().hasOverrides(t)&&window.getXeCallbacksContainer().proc(t,"ProcessLeftMouseDown")))},XeInputPointManager.prototype.IsDragCopying=function(e){var t=this.getHitTestInfo(),i=t.IsAltPressed(),t=t.IsLeftMouseButtonPressed(),r=!1;if(i&&t&&!(r=this.IsValidEntForCopy(e))){i=this.getXeDocument().getXeMainSelectionSet().getHandles();if(this.HasValidEntForCopy(i))return!0}return r},XeInputPointManager.prototype.IsGripCopyMode=function(){var e,t,i,r=!1;return r=!0===this.getHitTestInfo().IsAltPressed()&&(e=this.getXeDocument(),t=this.GetApertureSelection(),i=e.getXeDatabase().getXeEntities())&&0<=t.length&&(t=t[0],i=i.getByHandle(t))?e.getXeInputPointManager().IsValidEntForGripCopy(i):r},XeInputPointManager.prototype.IsGripCopying=function(e){var t=this.getHitTestInfo(),i=t.IsAltPressed(),t=t.IsLeftMouseButtonPressed(),r=!1;return r=i&&t?this.IsValidEntForGripCopy(e):r},XeInputPointManager.prototype.IsValidEntForGripCopy=function(e){return!(!e||!e.getClass)&&"OnshapeMLeader"===e.getClass()},XeInputPointManager.prototype.CanCopyWithoutDependency=function(e){var t=e.getClass();if("AcDbFcf"===t||"OnshapeWeldSymbol"===t||"OnshapeSurfaceFinish"===t||"AcDbLeader"===t||"OnshapeDatum"===t||"OnshapeBalloon"===t)return!0;if("AcDbBlockReference"===t)return(s=e.getLeaders())&&0<s.length||void 0!==e.getMTextId();if("OnshapeMLeader"===t){var i=this.getXeDocument().getXeDatabase().getXeEntities();if(!i)return!1;var r=e.getDependent();for(let e=0;e<r.length;e++){var n=r[e],n=i.getByHandle(n);if(n&&"OnshapeRevisionMarker"===n.getClass())return!1}var o=e.getDependentCopyForValidation();for(let e=0;e<o.length;e++){var a=o[e],a=i.getByHandle(a);if(a&&"OnshapeDetailViewBoundary"===a.getClass())return!1}return!0}if("AcDbTable"===t){if(e.getEntityData()&&e.getEntityData().ONSHAPE_SPLIT_TABLE_XDATA)return!1;var s=e.getEntityData()&&e.getEntityData().ONSHAPE_HOLE_TABLE_XDATA,t=e.getEntityData()&&e.getEntityData().ONSHAPE_REVISION_TABLE_XDATA;if(!s&&!t)return!0}return!1},XeInputPointManager.prototype.CanCopyMainSelectionSetAndEntWithoutDependency=function(e){if(!this.CanCopyWithoutDependency(e))return!1;var t,e=this.getXeDocument().getXeMainSelectionSet().getHandles(),i=this.getXeDocument().getXeDatabase().getXeEntities();for(t of e){var r=i.getByHandle(t);if(!this.CanCopyWithoutDependency(r))return!1}return!0},XeInputPointManager.prototype.IsValidEntForCopy=function(e){var t;return!(!e||!e.getClass||void 0===(t=this.getDependentCopySet(e))||!t)&&t.includes(e.getHandle())},XeInputPointManager.prototype.isCopyWhitelistEntity=function(e){var t=e.getClass(),e=e.m_ClassName;return"OnshapeCenterLine"===t||"OnshapeCenterMark"===t||"OnshapeCircularCenterLine"===t||"OnshapeSurfaceFinish"===t||"OnshapeVirtualSharp"===t||"Onshape2EdgeCenterLine"===t||"Onshape2PointCircularCenterLine"===t||"OnshapeAuxiliaryLine"===t||"OnshapeBalloon"===t||"OnshapeBendLineNote"===t||"OnshapeBreakLine"===t||"OsChamferCalloutNote"===t||"OnshapeDatum"===t||"OnshapeDepthPoint"===t||"OnshapeDetailViewBoundary"===t||"OnshapeHoleTag"===t||"OnshapeImage"===t||"OnshapeInspectionSymbol"===t||"OnshapeJoggedSectionLine"===t||"OnshapeMLeader"===t||"OnshapeOriginIndicator"===t||"OnshapeSectionLine"===t||"OnshapeSketchPoint"===t||"OnshapeSmartCenterLine"===t||"OnshapeSplinePoint"===t||"OnshapeViewObject"===t||"OnshapeWeldSymbol"===t||"AcDbTable"===t||"AcDbPolyline"===t||"AcDbCircle"===t||"AcDbCurve"===t||"AcDbDimension"===t||"AcDbFcf"===t||"AcDbHatch"===t||"AcDbLeader"===t||"AcDbLine"===t||"AcDbMText"===t||"AcDbText"===t||"AcDbSpline"===t||"AcDbBlockReference"===t||"AcDbSolid"===t||"AcDb2dPolyline"===t||"XeDimension"===e||"AcDbPoint"===t||"AcDbArc"===t},XeInputPointManager.prototype.getDependentCopySet=function(e){var i=this.getXeDocument().getXeMainSelectionSet().getHandles(),r=this.getXeDocument().getXeDatabase().getXeEntities();let t=!1,n=i.slice(),o=(n.push(e.getHandle()),[]),a=!0,s=!0;for(;a;){a=!1;for(var c of n){c=r.getByHandle(c);if(c){var l=c.getDependentCopy();if(l)if(s)o=o.concat(l);else{var d=c.getDependentCopyForValidation();for(let t of l)d.find(e=>e===t)&&o.push(t)}else t=!0}}for(let t of o)n.find(e=>e===t)||(n.push(t),a=!0);if(t)return[];s=!1}let u=!0;for(var p=[];u;){u=!1,p=[];for(var m of n){var h=r.getByHandle(m);if(h&&this.isCopyWhitelistEntity(h)){var g=h.getDependentCopyForValidation();if(!g)return[];for(let t of h.getDependentCopyForSoftValidation())i.find(e=>e===t)&&g.push(t);for(let t of g){var y=r.getByHandle(t);if((!y||"OnshapeMLeader"!==y.getClass()&&!this.CanCopyWithoutDependency(h)||e.getHandle()==t||i.find(e=>e===t))&&!n.find(e=>e===t)){p.push(m);break}}}else p.push(m)}let t=p;var f=n.length;n=n.filter(function(e){return t.indexOf(e)<0}),u=f>n.length}return n},XeInputPointManager.prototype.IsCopyMode=function(){var e,t,i=!1;return i=!0===this.getHitTestInfo().IsAltPressed()&&(t=this.GetApertureSelection(),!1===(i=(e=this.getXeDocument().getXeDatabase().getXeEntities())&&0<=t.length&&(t=t[0],e=e.getByHandle(t))?this.IsValidEntForCopy(e):i))&&(t=this.getXeDocument().getXeMainSelectionSet().getHandles())?this.HasValidEntForCopy(t):i},XeInputPointManager.prototype.HasValidEntForCopy=function(t){if(t&&t.length){var i=this.getXeDocument().getXeDatabase().getXeEntities();if(i)for(let e=0;e<t.length;e++){var r=t[e],r=i.getByHandle(r);if(this.IsValidEntForCopy(r))return!0}}return!1},XeInputPointManager.prototype.ProcessLeftMouseDoubleClick=function(){let o=this,a=this.getXeDocument();var e=a.getXeGsDevice(),t=o.getMousePosition(),i=(o.m_LastClickScreen=new GeNeo.OdGePoint2d(t.x,t.y),o.m_LastClickScreenInverted=new GeNeo.OdGePoint2d(t.x,e.getPixelHeight()-t.y),e.getActiveViewport()),s=(e.getOverallViewport(),o.m_LastClickWCS=i.PointToWCS(t.x,t.y,!0),a.getXeDatabase().getXeEntities());if(s){var r,c=i.PointToWCS(t.x,t.y,!0);for(r in XeInputPointManager.prototype.DoubleClickTimeouts)clearTimeout(XeInputPointManager.prototype.DoubleClickTimeouts[r]),delete XeInputPointManager.prototype.DoubleClickTimeouts[r];let n=clientSideTrackersHolder.CFxNoteClientTracker,e=window.getXeApplication().getDrawingEngine();e.getIntersected(a).then(e=>{var t,i,r;0<e.length?(e=e[0],(e=s.getByHandle(e))&&(r=e.getClass(),t=e.m_ClassName,!(i=!1)===a.getViewMode()&&(o.m_Tooltip_timeout&&clearTimeout(o.m_Tooltip_timeout),window.getXeApplication().getXeUI().HideTooltip(),"OnshapeViewObject"!==r)&&(a.RunCmd("'^C^C._CLIENTEDIT  "+c[0]+","+c[1]+","+c[2]+"\n"),i=!0),"AcDbSpline"!==r&&"OnshapeSplinePoint"!==r||(i=(r=window.XeActiveTrackers.TrackerData("COsSplinePointTracker"))&&r.active),"XeDimension"!==t&&"XeBlockReference"!==t||(window.XeFxQtWidgetDimPalletManager.setFocusOnShow=!0),i||(window.getXeCallbacksContainer().hasOverrides(e)?window.getXeCallbacksContainer().proc(e,"ProcessLeftMouseDoubleClick"):n&&n.IsPointNoteEditor(c)||(a.RunCmd("'^C^C._CLIENTEDIT "+e.getHandle()+" "+c[0]+","+c[1]+","+c[2]+"\n"),a.getXeMainSelectionSet().ClearSelectionSet())))):a.getViewMode()?a.RunCmd("'^C^C._CLIENTEDIT  "+c[0]+","+c[1]+","+c[2]+"\n"):(r=clientSideTrackersHolder.CFxTableEditTrackerBase)&&r.isTableActive&&1===r.GetTableEditType(c)&&r.getHandle()&&(n&&n.IsPointNoteEditor(c)||a.RunCmd("'^C^C._CLIENTEDIT "+r.getHandle()+" "+c[0]+","+c[1]+","+c[2]+"\n"))})}},XeInputPointManager.prototype.decorateDragPreview=function(e){e.getXeDrawDecoration().setLWThick(2);var t=e.getXeDrawDecoration().TYPE_ENUM.Transform;e.getXeDrawDecoration().setType(t),e.getXeDrawDecoration().setColor(window.OnshapeColors.select.rgb),e.getXeDrawDecoration().setAlpha(window.OnshapeColors.select.alpha)},XeInputPointManager.prototype.StartDragDrop=function(e,t,i){if(e.getParent()||1<e.getPath().length)throw"XeInputPointManager.prototype.StartDragDrop - entity.getPath().length > 1";if(!window.osws||!window.osws.isLock()){this.m_CancelCurrentCommand=!1;var r=this.getXeDocument().getXeDatabase().getXeEntities();if(r&&!this.m_bClientPending){if(this.m_bClientPending=!0,i){if(!this.MatchToCopyDragDropFilter(e))return}else if(!this.MatchToDragDropFilter(e,t))return;var n=this.GetDragInfo(),o=(n.actualPreview&&(m=n.entity.getHandle(),n.waitingPreviews[m]&&n.waitingPreviews[m].deallocate(),n.waitingPreviews[n.entity.getHandle()]=n.actualPreview,n.actualPreview=null,n.IsCopy=!1),this.getXeDocument().getXeMainSelectionSet().getHandles());if(!i||(e=this.GetValidDragEnt(e,o))){n.IsCopy=i,n.entity=e,n.handles=[e.getHandle()];var a=new XeEntityPreview;for(a.setSortingByDrawOrder(!1),a.setSortingByChunkOffsets(!1),n.actualPreview=a,this.decorateDragPreview(a),u=0;u<o.length;u++){var s,c=o[u],l=r.getByHandle(c);l&&(s=!1,s=!!(i&&this.IsValidEntForCopy(l)&&!n.waitingPreviews[l.getHandle()]||!i&&this.MatchToDragDropFilter(l,t)&&!n.waitingPreviews[l.getHandle()])||s)&&!l.IsHidden()&&(n.handles.push(l.getHandle()),void 0!==l.getMTextId)&&void 0!==l.getMTextId()&&n.handles.push(l.getMTextId())}for(var d=n.handles.length,u=0;u<n.handles.length;u++){c=n.handles[u];var p=r.getByHandle(c);p&&(a.addXeEntity(p,!0),i?u<d&&p.OnStartDragCopy():p.RequestDependent().then(p.OnStartDragDrop.bind(p)),window.IsOsVersion())&&!i&&p.Hide()}var m=this.getXeDocument().getXeGsDevice();m&&(m.setContinuousAction(!0),m.invalidateSelectionScene(),m.invalidateClientTrackersGL(),this.InvalidateApertureSelection())}}}},XeInputPointManager.prototype.IsDimensionEntDangling=function(e){var t=window.XeActiveTrackers.TrackerData("OsDanglingDimTracker"),i=e.getHandle();if(t&&t.length)for(let e=0;e<t.length;e++)if(0===t[e].handle.localeCompare(i))return!0;return!1},XeLinetypeTable.prototype.base_getLineDashGDI=XeLinetypeTable.prototype.getLineDashGDI,XeLinetypeTable.prototype.base_getLineDashGDI.bUseNew=!1,XeLinetypeTable.prototype.getLineDashGDI=function(e,t){if(!XeLinetypeTable.prototype.base_getLineDashGDI.bUseNew)return XeLinetypeTable.prototype.base_getLineDashGDI.call(this,e,t);var i=this.getXeDatabase(),r=i.getXeDocument().getXeGsDevice(),n=this.__getLineDash(t),o=1;r.getOverallViewport()&&(t=XeGlGlobalUniformData.prototype.OnshapeGlobalPatternScaleFactor_ansi,r=XeGlGlobalUniformData.prototype.OnshapeGlobalPatternScaleFactor_iso,o=(0===i.getMEASUREMENT()?t:r)/e.NumToSCS(1)),o=+o;for(var a=0;a<n.length;a++)n[a]=o*Math.abs(n[a])*e.NumToSCS(1);return n},XeTable.prototype.RequestTooltip=function(){var e=this.getXeEntities().getXeDatabase().getXeDocument().getXeInputPointManager().getMousePosition();return this.m_Tooltip=XeRequest.prototype.Promise(this,{handle:this.getHandle(),pt:e},"RequestTooltip"),this.m_Tooltip},XeText.prototype.GetGripMoveIndex=function(){var e=this.getGrips();return 3==e.length?2:5==e.length?4:4==e.length&&1==this.IsPartOfGroup()?3:void 0},XeGlGlobalUniformData.prototype.OnshapeGlobalPatternScaleFactor_ansi=223.2,XeGlGlobalUniformData.prototype.OnshapeGlobalPatternScaleFactor_iso=8.5,XeGlGlobalUniformData.prototype.getLWDISPSCALE=function(e){return 1},XeGlGlobalUniformData.prototype.IsAlwaysShowLinetype=function(e){var t=e.getXeGsDevice();e.getXeDatabase();return!!t.getOverallViewport()},XeGlGlobalUniformData.prototype.recalculatePatternScale=function(e,t,i,r){var n,o=1,a=e.getXeGsDevice(),s=a.getXeDocument().getXeDatabase();return a.getOverallViewport()&&(a=XeGlGlobalUniformData.prototype.OnshapeGlobalPatternScaleFactor_ansi,n=XeGlGlobalUniformData.prototype.OnshapeGlobalPatternScaleFactor_iso,o=(0===s.getMEASUREMENT()?a:n)/e.NumToSCS(1)),r*o};var XeCallbacksContainer=function(){this.register=function(e,t){s[e]=t},this.hasOverrides=function(e){return!!s[e.getClass()]},this.proc=function(){var e=arguments,t=e[0],i=e[1];if(!t||!i)throw"wrong usage of XeCallbacksContainer";for(var r=[],n=2;n<e.length;n++)r.push(e[n]);var o=t.getClass(),a=s[o];if(a){if(a instanceof XeCallbackHandler)return a[i].apply(t,r);throw"wrong usage of XeCallbackHandler for "+o}};var s={}},XeCallbackHandler=function(){},XeAcDbTableCallbackHandler=(XeCallbackHandler.prototype.CheckIfGrip=function(e,t){throw"ovveride"},XeCallbackHandler.prototype.OnGripLeftMouseDown=function(e){throw"ovveride"},XeCallbackHandler.prototype.ProcessLeftMouseDown=function(){throw"ovveride"},XeCallbackHandler.prototype.ProcessLeftMouseDoubleClick=function(){throw"ovveride"},window.getXeCallbacksContainer=function(){return window.XeCallbacksContainer.__singleton||(window.XeCallbacksContainer.__singleton=new XeCallbacksContainer),window.XeCallbacksContainer.__singleton},function(){XeCallbackHandler.call(this)}),ActiveTableCellTracker=(XeAcDbTableCallbackHandler.prototype=Object.create(XeCallbackHandler.prototype),XeAcDbTableCallbackHandler.prototype.constructor=XeAcDbTableCallbackHandler,XeAcDbTableCallbackHandler.prototype.bUseTableEditorCommandManagment_ProcessLeftMouseDoubleClick=!1,XeAcDbTableCallbackHandler.prototype.LineIntersectionType={Top:1,Left:2,Right:3,Bottom:4},XeAcDbTableCallbackHandler.prototype.UpdateTableSelection=function(i,e){var r=XeAcDbTableCallbackHandler.prototype.LineIntersectionType,t=window.getXeActiveDocument(),n=t.getXeDatabase(),o=t.getXeGsDevice();if(!(i=i||o.getActiveViewport()))return!0;var a=[(a=t.getXeInputPointManager().getMousePosition()).x,a.y],o=this.getEntityData(),s=o.cells,c=[],l={intersects:!1,row:0,column:0,lineIntersection:{type:0,row:0,column:0},LineIntersectionType:r},d=(o.cellIntersection=l,[0,0]);for(let t=0;t<s.length;t++){var u=s[t],p=(c.push([]),c[c.length-1]);for(let e=0;e<u.length;e++){var m=u[e].extents,h=(p.push([]),p[p.length-1]),g=m[0];if(i.PointToSCSFast(d,g[0],g[1],g[2]),h.push([d[0],d[1]]),g=m[1],i.PointToSCSFast(d,g[0],g[1],g[2]),h.push([d[0],d[1]]),g=m[3],i.PointToSCSFast(d,g[0],g[1],g[2]),h.push([d[0],d[1]]),g=m[2],i.PointToSCSFast(d,g[0],g[1],g[2]),h.push([d[0],d[1]]),!l.intersects){var y,f,_,w,v=[],C=!0;for(let e=0;e<h.length;e++){var T=[Math.floor(h[e][0]),Math.floor(h[e][1])];if(0===e);else if(!(C=T[0]!==v[0]||T[1]!==v[1]))break;v=[Math.floor(h[e][0]),Math.floor(h[e][1])]}C&&(m=n.getPICKBOX(),RecomputeDimBlock.isPointInside(a,h)&&(l.intersects=!0,l.row=t,l.column=e),g={x:a[0],y:a[1],r:m},m={x1:h[0][0],y1:h[0][1],x2:h[1][0],y2:h[1][1]},y={x1:h[1][0],y1:h[1][1],x2:h[2][0],y2:h[2][1]},f={x1:h[2][0],y1:h[2][1],x2:h[3][0],y2:h[3][1]},w=!(_={x1:h[3][0],y1:h[3][1],x2:h[0][0],y2:h[0][1]}),0<RecomputeDimBlock.isCircleLineIntersection(m,g).length?(l.lineIntersection.type=r.Top,w=!0):0<RecomputeDimBlock.isCircleLineIntersection(y,g).length?(l.lineIntersection.type=r.Right,w=!0):0<RecomputeDimBlock.isCircleLineIntersection(f,g).length?(l.lineIntersection.type=r.Bottom,w=!0):0<RecomputeDimBlock.isCircleLineIntersection(_,g).length&&(l.lineIntersection.type=r.Left,w=!0),w)&&(l.lineIntersection.row=t,l.lineIntersection.column=e)}}}return c},window.getXeCallbacksContainer().register("AcDbTable",new XeAcDbTableCallbackHandler),XeAcDbTableCallbackHandler.prototype.CheckIfGrip=function(e,t){var i,r=OsTableTracker.prototype.FixedCornersEnum,e=XeEntity.prototype.CheckIfGrip_base_call.call(this,e),n=this.getEntityData();return void 0!==e?n&&n.ONSHAPE_TABLE_FIXED_CORNER_DATA&&((i=n.ONSHAPE_TABLE_FIXED_CORNER_DATA.fixedCorner)===r.FixedCornerBottomLeft?4!==e&&5!==e||(e=void 0):i===r.FixedCornerBottomRight?6!==e&&5!==e||(e=void 0):i===r.FixedCornerTopRight?6!==e&&7!==e||(e=void 0):i!==r.FixedCornerTopLeft||4!==e&&7!==e||(e=void 0)):void 0===e&&n&&n.cellIntersection&&(r=(i=n.cellIntersection).lineIntersection.type,n=i.LineIntersectionType,0<r)&&(r===n.Left||r===n.Right?e=20:r!==n.Top&&r!==n.Bottom||(e=21)),t&&t(e),!0},XeAcDbTableCallbackHandler.prototype.OnGripLeftMouseDown=function(e){var t;XeInputPointManager.prototype.getIsTableEditorCommandManagment()&&void 0!==e&&(t=this.getEntityData&&this.getEntityData())&&t.cellIntersection&&(t.gripEditDataOnLMB=JSON.parse(JSON.stringify(t.cellIntersection)),t.gripEditDataOnLMB.gripIndex=e)},XeAcDbTableCallbackHandler.prototype.ProcessLeftMouseDown=function(){var e,t,i,r,n;XeInputPointManager.prototype.getIsTableEditorCommandManagment()&&(e=clientSideTrackersHolder.CFxActiveCellGripTracker,(t=(i=window.getXeActiveDocument()).getXeInputPointManager()).getInsideNEntsel()||t.IsDraggingActive()||t.m_EntityToGrip?e&&e.setByEntity(!1):(window.getXeCallbacksContainer().proc(this,"UpdateTableSelection"),(n=t.getHitTestInfo()).IsCtrlPressed(),n.IsMetaPressed(),n.IsAltPressed()&&(this.cellSelection=!1),n.IsShiftPressed(),t=t.getMousePosition(),r=i.getXeGsDevice().getActiveViewport(),i.getXeGsDevice().getOverallViewport(),i=r.PointToWCS(t.x,t.y,!0),i={x:i[0],y:i[1],z:i[2]},(r=this.getEntityData()).preventLeftMouseButton?r.cellSelection=!1:n.IsLeftButtonDown()&&(r.cellSelection=!1,(n=this.getLayerObject()).getOff()||n.getLocked()||n.getFrozen()?r.cellSelection=!1:r.cellIntersection.intersects&&this&&"AcDbTable"===this.getClass()&&(r.cellSelection={handle:this.getHandle(),mousePos:{x:t.x,y:t.y},mousePosWCS:{x:i.x,y:i.y,z:i.z}}),r.cellSelection||clientSideTrackersHolder.CFxNoteClientTracker&&clientSideTrackersHolder.CFxNoteClientTracker.isActive()||!window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker")||window.getXeActiveDocument().getViewMode()||window.getXeActiveDocument().RunCmd("^C^C_OSTABLE_ACTION _CLOSE_TABLE_EDITOR\n")),e&&e.setByEntity(this)))},XeAcDbTableCallbackHandler.prototype.bUseTableEditorCommandManagment_ProcessLeftMouseDoubleClick=!0,XeAcDbTableCallbackHandler.prototype.ProcessLeftMouseDoubleClick=function(){var e=window.getXeActiveDocument(),t=e.getXeGsDevice(),i=e.getXeInputPointManager().getMousePosition(),t=t.getActiveViewport().PointToWCS(i.x,i.y,!0),r=this.getHandle(),n=this.getEntityData();let o=!1;var a=clientSideTrackersHolder.CFxNoteClientTracker;if(XeAcDbTableCallbackHandler.prototype.bUseTableEditorCommandManagment_ProcessLeftMouseDoubleClick){var s,c,l,i=XeEntity.prototype.CheckIfGrip_base_call.call(this,i),d=window.XeActiveTrackers.TrackerData("COsHoleTableTracker");if(d&&d.tmpTableHandle===r)o=!0;else if(0===i||1===i||2===i||3===i)e.RunCmd("^C^C._OSTABLEPROPERTIESBYHANDLE "+r+"\n").then(()=>{}),o=!0;else if(!n||4!==i&&5!==i&&6!==i&&7!==i)n&&(n.cellIntersection||n.gripEditDataOnLMB)&&(e=(d=n.cellIntersection||n.gripEditDataOnLMB).lineIntersection.type,r=d.LineIntersectionType,0<e)&&(s=-1,c=null,l=d.lineIntersection.row,d=d.lineIntersection.column,e===r.Top?(s=0,c="_FIT_ROW"):e===r.Right?(s=1,c="_FIT_COLUMN"):e===r.Bottom?(s=3,c="_FIT_ROW"):e===r.Left&&(s=2,c="_FIT_COLUMN"),delete n.gripEditDataOnLMB,0<=s)&&c&&(window.getXeActiveDocument().getViewMode()||(window.getXeActiveDocument().RunCmd("^C^C_OSTABLE_ACTION "+c+" "+this.getHandle()+" "+s+" "+l+" "+d+" "+l+" "+d+" "+t[0]+","+t[1]+","+t[2]+"\n"),window.getXeActiveDocument().getXeMainSelectionSet().ClearSelectionSet()),o=!0);else{e=n.cells.length-1,r=n.cells[0].length-1;4===i||6===i?(window.getXeActiveDocument().RunCmd("^C^C_OSTABLE_ACTION _FIT_COLUMN "+this.getHandle()+" "+-1+" 0 0 "+e+" "+r+" "+t[0]+","+t[1]+","+t[2]+"\n"),window.getXeActiveDocument().getXeMainSelectionSet().ClearSelectionSet()):5!==i&&7!==i||(window.getXeActiveDocument().RunCmd("^C^C_OSTABLE_ACTION _FIT_ROW "+this.getHandle()+" "+-1+" 0 0 "+e+" "+r+" "+t[0]+","+t[1]+","+t[2]+"\n"),window.getXeActiveDocument().getXeMainSelectionSet().ClearSelectionSet()),o=!0}}o||a&&a.IsPointNoteEditor(t)||(window.getXeActiveDocument().RunCmd("'^C^C._CLIENTEDIT "+this.getHandle()+" "+t[0]+","+t[1]+","+t[2]+"\n"),window.getXeActiveDocument().getXeMainSelectionSet().ClearSelectionSet(),o=!0),o&&(n.preventLeftMouseButton&&clearTimeout(n.preventLeftMouseButton),n.preventLeftMouseButton=setTimeout(e=>{e.preventLeftMouseButton=0},1e3,n))},XeAcDbTableCallbackHandler.prototype.UpdateTableSelection=function(e){var t={Top:1,Left:2,Right:3,Bottom:4},i=window.getXeActiveDocument(),r=i.getXeDatabase(),n=i.getXeGsDevice();if(!(e=e||n.getActiveViewport()))return!0;for(var o=[(o=i.getXeInputPointManager().getMousePosition()).x,o.y],n=this.getEntityData(),a=(n.ONSHAPE_BOM_XDATA||n.ONSHAPE_HOLE_TABLE_XDATA||n.ONSHAPE_REVISION_TABLE_XDATA||n.ONSHAPE_CUTLIST_XDATA||n.ONSHAPE_FEATURESCRIPT_TABLE_XDATA,0),s=0,c=0,l=n.cells,d=[],u={intersects:!1,row:0,column:0,lineIntersection:{type:0,row:0,column:0},LineIntersectionType:t},p=(n.cellIntersection=u,[0,0]),a=0;a<l.length;a++)for(var m=l[a],h=(d.push([]),d[d.length-1]),s=0;s<m.length;s++){var g=m[s].extents,y=(h.push([]),h[h.length-1]),f=g[0];if(e.PointToSCSFast(p,f[0],f[1],f[2]),y.push([p[0],p[1]]),f=g[1],e.PointToSCSFast(p,f[0],f[1],f[2]),y.push([p[0],p[1]]),f=g[3],e.PointToSCSFast(p,f[0],f[1],f[2]),y.push([p[0],p[1]]),f=g[2],e.PointToSCSFast(p,f[0],f[1],f[2]),y.push([p[0],p[1]]),!u.intersects){for(var _,w,v,C,T=[],b=!0,c=0;c<y.length;c++){var X=[Math.floor(y[c][0]),Math.floor(y[c][1])];if(0===c);else if(!(b=X[0]!==T[0]||X[1]!==T[1]))break;T=[Math.floor(y[c][0]),Math.floor(y[c][1])]}b&&(g=r.getPICKBOX(),RecomputeDimBlock.isPointInside(o,y)&&(u.intersects=!0,u.row=a,u.column=s),f={x:o[0],y:o[1],r:g},g={x1:y[0][0],y1:y[0][1],x2:y[1][0],y2:y[1][1]},_={x1:y[1][0],y1:y[1][1],x2:y[2][0],y2:y[2][1]},w={x1:y[2][0],y1:y[2][1],x2:y[3][0],y2:y[3][1]},C=!(v={x1:y[3][0],y1:y[3][1],x2:y[0][0],y2:y[0][1]}),0<RecomputeDimBlock.isCircleLineIntersection(g,f).length?(u.lineIntersection.type=t.Top,C=!0):0<RecomputeDimBlock.isCircleLineIntersection(_,f).length?(u.lineIntersection.type=t.Right,C=!0):0<RecomputeDimBlock.isCircleLineIntersection(w,f).length?(u.lineIntersection.type=t.Bottom,C=!0):0<RecomputeDimBlock.isCircleLineIntersection(v,f).length&&(u.lineIntersection.type=t.Left,C=!0),C)&&(u.lineIntersection.row=a,u.lineIntersection.column=s)}}return d},function(){ClientSideTracker.call(this),this.drawOrder=11;for(var e=0;e<this.PE.length;e++)this.PE[e](this)}),CFxElasticArcTracker=(ActiveTableCellTracker.prototype=Object.create(ClientSideTracker.prototype),ActiveTableCellTracker.prototype.constructor=ActiveTableCellTracker,ActiveTableCellTracker.prototype.PE=[],ActiveTableCellTracker.prototype.drawGrip=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.moveTo(t-r,i-r),e.lineTo(t-r,i+r),e.lineTo(t+r,i+r),e.lineTo(t+r,i-r),e.lineTo(t-r,i-r),e.fill(),e.stroke()},ActiveTableCellTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker");if(t&&e.m_XeViewport){var i=e.m_XeViewport,r=e.m_XeMyDocument.getXeInputPointManager().getInsideNEntsel();if(!r){var n,o,a,r=e.m_XeMyDocument.getXeDatabase().getGRIPCOLOR(),s=e.m_XeMyDocument.getXeProfile().getGripAlpha(),c=window.XeUtils.intRGBAToHex(r,s),l=window.XeUtils.rgbaToHex(127,127,127,s),d=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE();if(t.grips&&t.grips.hasOwnProperty("length")&&t.grips.length)for(n=0;n<t.grips.length;n++)o=t.grips[n],a=i.PointToSCS(o),this.drawGrip(e.ctx,a[0],a[1],d,c,l);e.ctx.fillStyle=c,l=window.XeUtils.rgbaToHex(255,255,255,s),e.ctx.strokeStyle=l,t.bDrawSelRect&&t.startSelPt&&(r=e.m_XeMyDocument.getXeInputPointManager().getMousePosition(),a=i.PointToSCS(t.startSelPt),e.ctx.beginPath(),e.ctx.moveTo(r.x,r.y),e.ctx.lineTo(a[0],r.y),e.ctx.lineTo(a[0],a[1]),e.ctx.lineTo(r.x,a[1]),e.ctx.lineTo(r.x,r.y),e.ctx.stroke())}}return!0},function(){ClientSideTracker.call(this);this.drawOrder=10,this.getTrackerName=function(){return null}}),CFxElasticArcEndAngleTracker=(CFxElasticArcTracker.prototype=Object.create(ClientSideTracker.prototype),CFxElasticArcTracker.prototype.constructor=CFxElasticArcTracker,CFxElasticArcTracker.prototype.start=function(e){},CFxElasticArcTracker.prototype.end=function(e){},CFxElasticArcTracker.prototype.drawTracker=function(e){var t,i=window.XeActiveTrackers.TrackerData(this.getTrackerName());return!i||(t=e.ctx,e=e.m_XeViewport,!t)||!e||(RecomputeDimBlock.SET_DRAWCONTEXT(t,e),RecomputeDimBlock.SET_TEXT_WH(0,0),void RecomputeDimBlock.ADD_ARC_impl(i.center,i.normal,i.start_vec,i.sweep_angle,i.radius,i.lineWeight,i.color))},function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcEndAngleTracker"}}),CFxElasticArcEndPointTracker=(CFxElasticArcEndAngleTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcEndAngleTracker.prototype.constructor=CFxElasticArcEndAngleTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcEndPointTracker"}}),CFxElasticArcIncludedAngleTracker=(CFxElasticArcEndPointTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcEndPointTracker.prototype.constructor=CFxElasticArcEndPointTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcIncludedAngleTracker"}}),CFxElasticArcChordLengthTracker=(CFxElasticArcIncludedAngleTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcIncludedAngleTracker.prototype.constructor=CFxElasticArcIncludedAngleTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcChordLengthTracker"}}),CFxElasticArcCenterPointTracker=(CFxElasticArcChordLengthTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcChordLengthTracker.prototype.constructor=CFxElasticArcChordLengthTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcCenterPointTracker"}}),CFxElasticArcAngleTracker=(CFxElasticArcCenterPointTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcCenterPointTracker.prototype.constructor=CFxElasticArcCenterPointTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcAngleTracker"}}),CFxElasticArcTangentTracker=(CFxElasticArcAngleTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcAngleTracker.prototype.constructor=CFxElasticArcAngleTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcTangentTracker"}}),CFxElasticArcRadiusTracker=(CFxElasticArcTangentTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcTangentTracker.prototype.constructor=CFxElasticArcTangentTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcRadiusTracker"}}),CFxElasticArcAppendTracker=(CFxElasticArcRadiusTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcRadiusTracker.prototype.constructor=CFxElasticArcRadiusTracker,function(){CFxElasticArcTracker.call(this),this.getTrackerName=function(){return"CFxElasticArcAppendTracker"}}),AreaTracker=(CFxElasticArcAppendTracker.prototype=Object.create(CFxElasticArcTracker.prototype),CFxElasticArcAppendTracker.prototype.constructor=CFxElasticArcAppendTracker,function(){ClientSideTracker.call(this)}),BasePointTracker=(AreaTracker.prototype=Object.create(ClientSideTracker.prototype),AreaTracker.prototype.constructor=AreaTracker,AreaTracker.prototype.drawTracker=function(e){var t;if(e.m_XeViewport)return!(t=window.XeActiveTrackers.TrackerData("CFxAreaTracker"))||void(t.tempPointsArray&&t.polygonData&&(0<t.tempPointsArray.length||0<t.polygonData.length)&&this.drawPolygon(e))},AreaTracker.prototype.drawPolygon=function(e){var t=e.m_XeViewport,i=e.ctx,r=window.XeActiveTrackers.TrackerData("CFxAreaTracker"),n=(i.strokeStyle=r.layerColor,i.globalAlpha=.25,i.lineWidth=1,r.tempPointsArray),o=[];if(o[0]=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,o[1]=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().y,0<n.length){0==r.tempPolyType||2==r.tempPolyType?i.fillStyle="#328930":i.fillStyle="#b40000",i.beginPath();var a=t.PointToSCS(n[0]);i.moveTo(a[0],a[1]);for(var s=1;s<n.length;++s)a=t.PointToSCS(n[s]),i.lineTo(a[0],a[1]);i.lineTo(o[0],o[1]),i.closePath(),i.fill(),i.stroke()}var c=r.polygonData;if(0<c.length)for(var l=0;l<c.length;++l)if(c[l]&&c[l].polygonPointsArray){0==c[l].polygonType||2==c[l].polygonType?i.fillStyle="#328930":i.fillStyle="#b40000",i.beginPath(),i.moveTo(t.PointToSCS(c[l].polygonPointsArray[0])[0],t.PointToSCS(c[l].polygonPointsArray[0])[1]);for(var d=1;d<c[l].polygonPointsArray.length;++d)i.lineTo(t.PointToSCS(c[l].polygonPointsArray[d])[0],t.PointToSCS(c[l].polygonPointsArray[d])[1]);i.closePath(),i.fill(),i.stroke()}i.restore()},function(){ClientSideTracker.call(this)}),BigCrossCursor=(BasePointTracker.prototype=Object.create(ClientSideTracker.prototype),BasePointTracker.prototype.constructor=BasePointTracker,BasePointTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=window.XeActiveTrackers.TrackerData("CFxBasePointTracker");if(!t)return!0;var i=e.m_XeMyDocument.getXeGsDevice().getForeground(),r=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),t=e.m_XeViewport.PointToSCS(t.basePoint);e.ctx.strokeStyle=window.XeUtils.intRGBToHex(i),e.ctx.beginPath(),e.ctx.moveTo(t[0]-r,t[1]-r),e.ctx.lineTo(t[0]+r,t[1]+r),e.ctx.moveTo(t[0]+r,t[1]-r),e.ctx.lineTo(t[0]-r,t[1]+r),e.ctx.stroke()}},function(){ClientSideTracker.call(this),this.drawOrder=100}),BlipTracker=(BigCrossCursor.prototype=Object.create(ClientSideTracker.prototype),BigCrossCursor.prototype.constructor=BigCrossCursor,BigCrossCursor.prototype.drawTracker=function(e){},BigCrossCursor.prototype.getCursorAxisSize=function(e){var t=e.m_XeMyDocument.getXeDatabase().getCURSORSIZE(),i=t/100*Math.max(screen.width,screen.height),e=e.m_XeMyDocument.getXeDatabase().getSNAPSTYL();return 100===t?0===e?i:i/4:0===e?i/4:i/2},BigCrossCursor.prototype.getCursorColor=function(e,t,i){return e?i.getXeProfile().getModelCrosshairColor():i.getXeProfile().getLayoutCrosshairColor()},BigCrossCursor.prototype.isCursorColorRequireChange=function(e,t,i){var t=this.getCursorColor(e,t,i),r=0;return{cursorColor:t,backGroundColor:r=e?i.getXeProfile().getGraphicsWinModelBackgrndColor():i.getXeProfile().getGraphicsWinLayoutBackgrndColor(),result:Math.abs(window.XeUtils.GetRValue(t)-window.XeUtils.GetRValue(r))+Math.abs(window.XeUtils.GetGValue(t)-window.XeUtils.GetGValue(r))+Math.abs(window.XeUtils.GetBValue(t)-window.XeUtils.GetBValue(r))<84.15}},BigCrossCursor.prototype.drawBigCross=function(e){var t,i,r,n,o,a=e.m_XeMyDocument,s=a.getXeGsDevice().getActiveViewport(),c=a.getXeInputPointManager().getCursorPosition(),l=[0,0],s=(s.PointToSCSFast(l,c[0],c[1],c[2]),l[0]),c=l[1],l=e.ctx;e.m_XeViewport&&((t=e.m_XeViewport).getViewPlaneOrigin(),r=t.getViewRightDir(),n=t.getUpVector(),o=new GeNeo.OdGeVector3d(r[0],r[1],r[2]),i=new GeNeo.OdGeVector3d(n[0],n[1],n[2]),o=o.normal().crossProduct(i.normal()),(i=new GeNeo.OdGeMatrix3d).setToWorldToPlane(o),r=new GeNeo.OdGeVector3d(t.getViewRightDir()),n=new GeNeo.OdGeVector3d(t.getUpVector()),o=r.transformBy(i),t=n.transformBy(i),r=new GeNeo.OdGeVector2d(o.x,o.y),n=new GeNeo.OdGeVector2d(t.x,t.y),i=this.getCursorAxisSize(e),r=r.mult(i),n=n.mult(i),o=new GeNeo.OdGePoint2d(s,c),t=new GeNeo.OdGeVector2d(o.x-r.x,o.y+r.y),e=new GeNeo.OdGeVector2d(o.x+r.x,o.y-r.y),i=new GeNeo.OdGeVector2d(o.x-n.x,o.y+n.y),s=new GeNeo.OdGeVector2d(o.x+n.x,o.y-n.y),c=!t.isEqualTo(e),r=!i.isEqualTo(s),c)&&r&&(o=a.getModelLayoutActive(),o=(n=this.isCursorColorRequireChange(o,!1,a)).cursorColor,n.result&&(o=n.backGroundColor),l.strokeStyle=window.XeUtils.intRGBToHex(o),r&&(l.beginPath(),l.moveTo(i.x,i.y),l.lineTo(s.x,s.y),l.stroke()),c)&&(l.beginPath(),l.moveTo(t.x,t.y),l.lineTo(e.x,e.y),l.stroke())},function(){ClientSideTracker.call(this),this.drawOrder=5,this.blips=[]}),BrushTrackerCursor=(BlipTracker.prototype=Object.create(ClientSideTracker.prototype),BlipTracker.prototype.constructor=BlipTracker,BlipTracker.prototype.drawCross=function(e,t){var i=t.m_XeMyDocument.getXeGsDevice().getForeground();t.ctx.strokeStyle=window.XeUtils.intRGBToHex(i),t.ctx.beginPath(),t.ctx.moveTo(e.x-4,e.y),t.ctx.lineTo(e.x+4,e.y),t.ctx.moveTo(e.x,e.y+4),t.ctx.lineTo(e.x,e.y-4),t.ctx.stroke()},BlipTracker.prototype.drawTracker=function(e){if(e.m_XeMyDocument.getXeDatabase().getBLIPMODE())for(var t,i=0;i<this.blips.length;i++)t=this.blips[i],this.drawCross(t,e);else 0<this.blips.length&&this.blips.clear();return!0},BlipTracker.prototype.clear=function(){this.blips=[]},function(){ClientSideTracker.call(this);this.loadImage()}),CFxQtMTextStartPointTracker=(BrushTrackerCursor.prototype=Object.create(ClientSideTracker.prototype),BrushTrackerCursor.prototype.constructor=BrushTrackerCursor,BrushTrackerCursor.prototype.drawTracker=function(e){var t=window.getXeActiveDocument();if("_PROPERTYPAINTER"===t.getXeDatabase().getCMDNAMES()[0]){var i=e.ctx;if(!i)return!0;e=e.m_XeViewport.getXeGsDevice().getXeDocument().getXeInputPointManager();if(!e)return!1;var r=e.getMousePosition();if(!r)return!1;var n,o=t.getXeSelectionSets().getItems();for(n in o)0<o[n].getHandles().length&&i.drawImage(this.xeBrushCursorIcon.img,r.x-10,r.y-20,16,16)}return!0},BrushTrackerCursor.prototype.loadImage=function(){this.xeBrushCursorIcon=new XeImage("qtresources/brush.svg")},function(){ClientSideTracker.call(this),this.matrix_transform=new GeNeo.OdGeMatrix3d,this.chunks=[]});CFxQtMTextStartPointTracker.prototype=Object.create(ClientSideTracker.prototype),CFxQtMTextStartPointTracker.prototype.constructor=CFxQtMTextStartPointTracker,CFxQtMTextStartPointTracker.prototype.checkChunk=function(e){return!1},CFxQtMTextStartPointTracker.prototype.setMatrix=function(e){var t=e.getXeGsDevice().getXeDocument().getXeInputPointManager();t&&(t=[t.getHitTestInfo().GetMousePosition().x,t.getHitTestInfo().GetMousePosition().y],e=e.PointToWCS(t[0],t[1],!0),this.matrix_transform.setentry(0,3,e[0]),this.matrix_transform.setentry(1,3,e[1]),this.matrix_transform.setentry(2,3,e[2]),this.matrix_transform.setentry(3,3,1))},CFxQtMTextStartPointTracker.prototype.drawTrackerGl=function(e,t){var i=window.XeActiveTrackers.TrackerData("CFxQtMTextStartPointTracker");if(i&&e){this.setMatrix(e);var r=e.getXeGsDevice().getChunks();if(r)for(var n of r.getChunkIdList()){var o,n=r.getById(n);n&&"CFxQtMTextStartPointTracker"===n.getTrackerName()&&(o={order_base:.5,order_base_denominator:1e3,transform_base:this.matrix_transform},n.drawChunk(t,XeWebDrawerEngine.prototype.RENDERER_USER_VIEW,e,void 0,void 0,void 0,o))}}};class RbmMenu{constructor(){this.menuContainer=document.createElement("div"),this.menuContainer.className="rbm-menu",this.menuContainer.style.backgroundColor="white",this.menuContainer.style.border="thin solid #d2d2d2",this.menuContainer.style.borderRadius="4px",this.menuContainer.style.boxShadow="0 4px 10px 4px rgba(0, 0, 0, 0.1)",this.menuContainer.style.boxSizing="border-box",this.menuContainer.style.display="none",this.menuContainer.style.fontSize="small",this.menuContainer.style.outline="none",this.menuContainer.style.overflow="hidden",this.menuContainer.style.position="absolute",this.menuContainer.tabIndex=0,this.menuContainer.addEventListener("keydown",this.OnKeyDown.bind(this)),this.overlay=document.createElement("div"),this.overlay.style.backgroundColor="rgba(0, 0, 0, 0.0)",this.overlay.style.display="none",this.overlay.style.height="100%",this.overlay.style.left="0",this.overlay.style.position="fixed",this.overlay.style.top="0",this.overlay.style.width="100%",this.overlay.addEventListener("pointerdown",this.OnPointerDown.bind(this))}addMenuItem(e,t){let i=document.createElement("div");i.className="rbm-menu-item",i.style.backgroundColor="inherit",i.style.boxSizing="border-box",i.style.color="#777777",i.style.cursor="pointer",i.style.padding="2px 15px 2px 15px",i.textContent=e,i.addEventListener("click",t),i.addEventListener("pointerenter",()=>{i.style.backgroundColor="#dbf1fb"}),i.addEventListener("pointerleave",()=>{i.style.backgroundColor="inherit"}),this.menuContainer.appendChild(i)}hideMenu(){this.menuContainer.style.display="none",this.overlay.style.display="none"}showMenu(e){this.overlay.style.display="",this.menuContainer.style.left=e.x+"px",this.menuContainer.style.top=e.y+"px",this.menuContainer.style.display="",this.menuContainer.focus()}isVisible(){return"none"!==this.menuContainer.style.display}OnKeyDown(e){"Escape"!==e.key&&" "!==e.key||this.hideMenu()}OnPointerDown(e){e.stopPropagation(),e&&!1===this.menuContainer.contains(e.target)&&this.hideMenu()}}class ConstraintIconRbmMenu{constructor(){this.icon=null;var e=new RbmMenu;e.menuContainer.classList.add("constraint-icon-rbm-menu"),this.base=e}addMenuItem(e,t){this.base.addMenuItem(e,()=>t(this))}setIcon(e){this.icon=e}getMenuContainer(){return this.base.menuContainer}hideMenu(){this.base.hideMenu()}showMenu(e){this.base.showMenu(e)}isShowed(){return this.base.isVisible()}}class ConstraintIcon{constructor(e,t,i,r,n,o,a,s){var c=new Image;c.src=e,c.oncontextmenu=this.onRightMouseClick.bind(this),c.onmousedown=this.onMouseDown.bind(this),c.onmouseup=this.onMouseUp.bind(this),c.onmousemove=this.onMouseMove.bind(this),this.imgIsPressed=!1,this.imgOffset=[0,0],c.style.position="absolute",c.style.width=r+"px",c.style.height=n+"px",c.style.left=t.x+"px",c.style.top=t.y+"px",this.width=r,this.height=n,this.pos=t,this.img=c,this.uri=e,this.type=i,this.subEntityPath=o,this.groupId=a,this.groupNodeId=s,this.isVisible=!0,this.handle=void 0,this.rbmMenu=null}compareById(t,e,i){if(t.length!==this.subEntityPath.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==this.subEntityPath[e])return!1;return e===this.groupId&&i===this.groupNodeId}setVisible(e){this.isVisible=e}hideImgDOM(e){this.img.style.display=!0===e?"":"none"}isImageDOMHidden(){return"none"!==this.img.style.display}setImgPos(e){this.img.style.left=e.x+"px",this.img.style.top=e.y+"px",this.pos=e}onMouseDown(e){e.preventDefault(),this.imgIsPressed=!0,this.imgOffset=[this.img.offsetLeft-e.clientX,this.img.offsetTop-e.clientY]}onMouseUp(e){e.preventDefault(),this.imgIsPressed=!1}onMouseMove(e){e.preventDefault(),this.imgIsPressed&&(e={x:e.clientX,y:e.clientY},this.img.style.left=e.x+this.imgOffset[0]+"px",this.img.style.top=e.y+this.imgOffset[1]+"px")}onRightMouseClick(e){var t;e.preventDefault(),3===e.which&&(e={x:this.pos.x+this.width,y:this.pos.y},(t=clientSideTrackersHolder.CFxConstraintsTracker).rbmMenu.setIcon(this),t.rbmMenu.showMenu(e))}}function getXeIconMap(){let t=window.getXeApplication().getBaseUrl()+"/icons/constraint_icons/";let i=0;return new Map(["horizontal.svg","vertical.svg","parallel.svg","perpendicular.svg","perpendicular.svg","colinear.svg","coincident.svg","circular.svg","tangent.svg","equal.svg","equal.svg","symmetrical.svg","smooth.svg","lock.svg"].map(e=>[i++,t+e]))}let ConstraintsTracker=function(){ClientSideTracker.call(this),this.drawOrder=16,this.iconsList=[],this.xeIconMap=void 0;var e=new ConstraintIconRbmMenu;e.addMenuItem("Delete constraint",e=>{e=e.icon;e&&(e.setVisible(!1),window.getXeActiveDocument().RunCmd(`._DELETECONSTRAINT _ID ${e.groupId} ${e.groupNodeId}
`))}),e.addMenuItem("Hide constraint",e=>{e.icon&&e.icon.setVisible(!1)}),this.rbmMenu=e};ConstraintsTracker.prototype=Object.create(ClientSideTracker.prototype),ConstraintsTracker.prototype.constructor=ConstraintsTracker,ConstraintsTracker.prototype.clearIconList=function(){if(this.iconsList.length){var e=window.getXeActiveDocument().getClientTrackerWidget();let t=document.getElementById(e);this.iconsList.forEach(e=>{t.removeChild(e.img)}),this.iconsList=[]}},ConstraintsTracker.prototype.fetchIconData=function(o){var e=window.getXeActiveDocument().getXeConstraintManager();if(e){var t=window.getXeActiveDocument().getClientTrackerWidget(),a=document.getElementById(t);document.getElementById(this.rbmMenu.getMenuContainer().id)||a.appendChild(this.rbmMenu.getMenuContainer()),void 0===this.xeIconMap&&(this.xeIconMap=getXeIconMap());let r=e.getConstraintGroupId(),n=e.getConstraintGroupNodeId();var s=n.length;if(s){var c=e.getPos3d();let i=JSON.parse(e.getSubEntPathArray());var l=e.getConstraintType();for(let t=0,e=0;t<s;t++,e+=3){var d,u=this.iconsList.find(e=>e.compareById(i[t],r[t],n[t])),p=o([c[e],c[e+1],c[e+2]]);void 0===u?(d=l[t],d=new ConstraintIcon(this.xeIconMap.get(d),p,d,24,24,i[t],r[t],n[t]),this.iconsList.push(d),a.appendChild(d.img)):u.pos.x!==p.x&&u.pos.y!==p.y&&u.setImgPos(p)}}else this.clearIconList()}},ConstraintsTracker.prototype.start=function(){},ConstraintsTracker.prototype.end=function(){this.clearIconList()},ConstraintsTracker.prototype.update=function(e,t){let i=window.getXeActiveDocument().getXeGsDevice().getActiveViewport();this.fetchIconData(e=>{var t=[0,0];return i.PointToSCSFast(t,e[0],e[1],e[2]),{x:t[0],y:t[1]}})},ConstraintsTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){window.getXeActiveDocument().getXeDatabase(),e.m_XeViewport;for(var t in this.iconsList){t=this.iconsList[t];this.drawIcon({icon:t,ctx:e.ctx})}}return!0},ConstraintsTracker.prototype.drawIcon=function(e){e=e.icon;return e&&e.isImageDOMHidden()!==e.isVisible&&e.hideImgDOM(e.isVisible),!0},ConstraintsTracker.prototype.onMouseHover=e=>(e.m_XeViewport&&(window.getXeActiveDocument().getXeDatabase(),this.highlightConstraintedEntityes(!0)),!0),ConstraintsTracker.prototype.highlightConstraintedEntityes=e=>{};var const_cursor_size=32,XeCursorTrackerBase=function(e,t){this.tracker=e,this.isGripSnap=t,this.m_vX=new GeNeo.OdGeVector3d(1,0,0),this.m_vY=new GeNeo.OdGeVector3d(0,1,0),this.m_vZ=new GeNeo.OdGeVector3d(0,0,1)},GridSnapPointTracker=(XeCursorTrackerBase.prototype.isEnable=function(e){var e=e.m_XeMyDocument,t=e.getXeDatabase(),e=e.getXeInputPointManager(),i=e.getInsideCommand(),e=e.getInsideSelect(),t=1==t.getSNAPMODE()&&i&&!e;return t=this.isGripSnap?t:!t},XeCursorTrackerBase.prototype.getXY=function(e){var t,i=[0,0];return this.isGripSnap?(t=(e=e.m_XeMyDocument).getXeGsDevice().getActiveViewport(),e=e.getXeInputPointManager().getCURSORPOINT(),t=t.PointToSCS(e),i[0]=t[0],i[1]=t[1]):(e=this.tracker.getLastXY(),i[0]=e.x,i[1]=e.y),i},function(){ClientSideTracker.call(this);this.drawOrder=5,this.trackerBase=new XeCursorTrackerBase(this,!0)}),XeCursorTracker=function(){ClientSideCursorTrackerBase.call(this);var e=this,t=(this.m_bDrawAsSystemCursor=!0,{});e.getResources=function(){return t},e.performResourcesBase=function(){e.getResources().image_arrow=new XeImage("icons/arrow.png"),e.performResources()},e.drawOrder=99999,setTimeout(e.performResourcesBase,0),e.trackerBase=new XeCursorTrackerBase(this,!1)};XeCursorTracker.prototype=Object.create(ClientSideCursorTrackerBase.prototype),XeCursorTracker.prototype.constructor=XeCursorTracker,GridSnapPointTracker.prototype=Object.create(ClientSideTracker.prototype),GridSnapPointTracker.prototype.constructor=GridSnapPointTracker,XeCursorTrackerBase.prototype.getImgDataWH=function(e){var t,e=e.m_XeMyDocument,i=this.getCursorAxisSize(e),i=Math.round(i)+1;return{w:2*(i=e&&e.getXeDatabase()&&(t=e.getXeDatabase().getAPERTURE(),e.getXeDatabase().getAPBOX())?t<i?i:t+2:i)+2,h:2*i+2}},XeCursorTracker.prototype.performResources=function(){let t=this.getResources(),i=(t.canvas={},const_cursor_size);t.canvas.element=document.createElement("canvas"),t.canvas.context=t.canvas.element.getContext("2d"),t.canvas.element.width=i,t.canvas.element.height=i,t.canvas.clear=function(){t.canvas.context.clearRect(0,0,t.canvas.element.width,t.canvas.element.height)},t.canvas.make_url=function(){var e=XeCursorDrawer.prototype.create_CCS3_CursorOffests(i);return"url('"+t.canvas.element.toDataURL()+"') "+e.x+" "+e.y+", auto"}},XeCursorTrackerBase.prototype.drawArrow=function(e){var t,i;if(!this.isGripSnap)return t=e.ctx,e=this.getXY(e),i=this.tracker.getResources(),!!(t&&i.image_arrow&&i.image_arrow.imageLoaded)&&(t.drawImage(i.image_arrow.img,Math.floor(e[0]),Math.floor(e[1])),!0)},XeCursorTrackerBase.prototype.drawDWGCursor=function(t){var e=t.m_XeMyDocument,i=e.getXeGsDevice(),r=e.getXeDatabase(),e=e.getXeInputPointManager(),i=i.getPixelHeight();if(t.m_XeViewport){var n=t.m_XeViewport.visibleScreenRect();if(n){var o,a=Math.floor(n.xmin),i=i-Math.floor(n.ymin)-Math.floor(n.ymax-n.ymin),s=Math.floor(n.xmax-n.xmin),n=Math.floor(n.ymax-n.ymin),c=e.getHitTestInfo().GetMousePosition(),l=c.x,c=c.y,l=a<l&&l<a+s&&i<c&&c<i+n,a=r.getAPERTURE(),s=r.getAPBOX(),c=r.getOSMODE(),i=window.XeUtils.HasAnyModeEnabled(c,!0)&&t.m_XeMyDocument.getXeInputPointManager().getOsnapCalculationEnabled(),n=r.getPICKBOX(),c=r.getSELECTBOX(),d=r.getCURSORMODE(),u=!1,r=r.getCMDNAMES();if(r.length&&(u=-1<r[r.length-1].indexOf("_MAINSELECT")),e.getInsideCommand()||e.getInsideLISP()){if(l){if(4&d)return this.tracker.setCanvasCursorStyle(null),this.tracker.setCanvasClassName("interactive_text"),!(t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/CURSORMODE & 4");if(8&d)return this.tracker.setCanvasCursorStyle(null),this.tracker.setCanvasClassName("interactive_eresize"),!(t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/CURSORMODE & 8");if(2&d){if(l&&!u){if(e.getInsideSelect())return this.drawBox(t,n,!1),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawBox/"+n,!0;if(window.XeActiveTrackers.IsTrackerActive("CFxOrbitTracker"))return!1;if(window.XeActiveTrackers.IsTrackerActive("CFxBigCrossCursor"))return this.drawBigCross(t),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawBigCross",!0;{this.drawCross(t,!1);let e;s?e=a:i&&(e=c),this.drawBox(t,e,!1),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawCross/drawBox/"+e}}else r=this.drawArrow(t),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawArrow/"+r;return!0}return l&&!u?e.getInsideSelect()?(this.drawBox(t,n,!1),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawBox/"+n,!0):!window.XeActiveTrackers.IsTrackerActive("CFxOrbitTracker")&&(window.XeActiveTrackers.IsTrackerActive("CFxBigCrossCursor")?(this.drawBigCross(t),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawBigCross"):(this.drawCross(t,!1),s?o=a:i&&(o=c),this.drawBox(t,o,!1),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawCross/drawBox/"+o),!0):(r=this.drawArrow(t),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawArrow/"+r,!0)}u=this.drawArrow(t),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawArrow/"+u}else if(2&d){this.drawCross(t,!1);let e;s?e=a:i&&(e=c),this.drawBox(t,e,!1),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawCross/drawBox/"+e}else e=this.drawArrow(t),t.currentCursorDrawPath="XeCursorTracker/drawDWGCursor/drawArrow/"+e,l&&!1===t.m_XeMyDocument.getViewMode()&&(this.drawBox(t,c,!1),t.currentCursorDrawPath+="/drawBox/"+c);return!0}}},XeCursorTrackerBase.prototype.drawBox=function(e,t,i){if(!this.isEnable(e))return!1;var r=e.m_XeMyDocument,n=this.getXY(e),o=n[0],e=e.ctx,o=new GeNeo.OdGePoint2d(o,n[1]),n=[],o=(n[0]=new GeNeo.OdGePoint2d(o.x-t,o.y-t),n[1]=new GeNeo.OdGePoint2d(o.x-t,o.y+t),n[2]=new GeNeo.OdGePoint2d(o.x+t,o.y+t),n[3]=new GeNeo.OdGePoint2d(o.x+t,o.y-t),n[4]=new GeNeo.OdGePoint2d(o.x-t,o.y-t),r.getModelLayoutActive()),t=this.isCursorColorRequireChange(o,i,r),o=t.cursorColor,i=t.backGroundColor;r=t.result?(r=window.XeUtils.GetRValue(i),t=window.XeUtils.GetGValue(i),i=window.XeUtils.GetBValue(i),window.XeUtils.rgbToHex(r<64?255:r,t<64?255:t,i<64?255:i)):window.XeUtils.intRGBToHex(o),e.strokeStyle=r,e.beginPath(),e.moveTo(Math.floor(n[0].x),Math.floor(n[0].y)),e.lineTo(Math.floor(n[1].x),Math.floor(n[1].y)),e.lineTo(Math.floor(n[2].x),Math.floor(n[2].y)),e.lineTo(Math.floor(n[3].x),Math.floor(n[3].y)),e.lineTo(Math.floor(n[4].x),Math.floor(n[4].y)),e.stroke()},XeCursorTrackerBase.prototype.getCursorAxisSize=function(e){var t,i;return this.isGripSnap?const_cursor_size/2:(i=(t=e.getXeDatabase().getCURSORSIZE())/100*Math.max(screen.width,screen.height),e=e.getXeDatabase().getSNAPSTYL(),100===t?0===e?i:i/4:0===e?i/4:i/2)},XeCursorTrackerBase.prototype.drawCross=function(e,t){if(!this.isEnable(e))return!1;var i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T=e.ctx;e.m_XeViewport&&(r=e.m_XeViewport,i=e.m_XeMyDocument,c=this.isGripSnap,this.isGripSnap=!0,o=this.getXY(e),this.isGripSnap=c,c=new GeNeo.OdGePoint3d(o[0],o[1],0),o=this.getXY(e),e=new GeNeo.OdGePoint3d(o[0],o[1],0),o=new GeNeo.OdGeVector3d(r.getUCSxDir()),a=new GeNeo.OdGeVector3d(r.getUCSyDir()),s=o.crossProduct(a),l=this.getCursorAxisSize(i),t&&(l*=2),t=r.getWorldToEyeTransform(),(r=new GeNeo.OdGeMatrix3d).setentry(1,1,-1),r.setentry(1,3,1),r=r.mult(t),o.transformBy(r),a.transformBy(r),s.transformBy(r),this.m_vX.isEqualTo(o)&&this.m_vY.isEqualTo(a)&&this.m_vZ.isEqualTo(s)||(this.m_vX=o,this.m_vY=a,this.m_vZ=s,!this.tracker.resetCache)||this.tracker.resetCache(),t=c.add(o.mult(l)),r=c.add(a.mult(l)),n=c.add(s.mult(l)),o=c.sub(o.mult(l)),a=c.sub(a.mult(l)),s=c.sub(s.mult(l)),(l=new GeNeo.OdGeVector3d).setToDiff(e,c),t.setToSum(t,l),r.setToSum(r,l),n.setToSum(n,l),o.setToSum(o,l),a.setToSum(a,l),s.setToSum(s,l),e=!t.isEqualTo(o),c=!r.isEqualTo(a),l=!n.isEqualTo(s),d=i.getModelLayoutActive(),i.getXeProfile().getCrosshairTintMode()?(C=(_=this.isCursorTintColorRequireChange(d,i)).cursorTintColorAxisX,f=_.cursorTintColorAxisY,u=_.cursorTintColorAxisZ,p=_.backGroundColor,m=28.05,e&&(h=1&_.result?(h=window.XeUtils.GetRValue(C),w=window.XeUtils.GetGValue(C),v=window.XeUtils.GetBValue(C),window.XeUtils.rgbToHex(h<128?h+m+1:h-m-1,w<128?w+m+1:w-m-1,v<128?v+m+1:v-m-1)):window.XeUtils.rgbToHex(window.XeUtils.GetRValue(C),window.XeUtils.GetGValue(C),window.XeUtils.GetBValue(C))),c&&(g=2&_.result?(w=window.XeUtils.GetRValue(f),v=window.XeUtils.GetGValue(f),C=window.XeUtils.GetBValue(f),window.XeUtils.rgbToHex(w<128?w+m+1:w-m-1,v<128?v+m+1:v-m-1,C<128?C+m+1:C-m-1)):window.XeUtils.rgbToHex(window.XeUtils.GetRValue(f),window.XeUtils.GetGValue(f),window.XeUtils.GetBValue(f))),l&&(y=4&_.result?(w=window.XeUtils.GetRValue(u),v=window.XeUtils.GetGValue(u),C=window.XeUtils.GetBValue(u),window.XeUtils.rgbToHex(w<128?w+m+1:w-m-1,v<128?v+m+1:v-m-1,C<128?C+m+1:C-m-1)):window.XeUtils.rgbToHex(window.XeUtils.GetRValue(u),window.XeUtils.GetGValue(u),window.XeUtils.GetBValue(u)))):(_=(f=this.isCursorColorRequireChange(d,!1,i)).cursorColor,p=f.backGroundColor,h=f.result?(w=window.XeUtils.GetRValue(p),v=window.XeUtils.GetGValue(p),C=window.XeUtils.GetBValue(p),window.XeUtils.rgbToHex(w<64?255:w,v<64?255:v,C<64?255:C)):window.XeUtils.rgbToHex(window.XeUtils.GetRValue(_),window.XeUtils.GetGValue(_),window.XeUtils.GetBValue(_)),c&&(g=h),l&&(y=h)),l&&(T.strokeStyle=y,T.beginPath(),T.moveTo(Math.floor(n.x),Math.floor(n.y)),T.lineTo(Math.floor(s.x),Math.floor(s.y)),T.stroke()),c&&(T.strokeStyle=g,T.beginPath(),T.moveTo(Math.floor(r.x),Math.floor(r.y)),T.lineTo(Math.floor(a.x),Math.floor(a.y)),T.stroke()),e)&&(T.strokeStyle=h,T.beginPath(),T.moveTo(Math.floor(t.x),Math.floor(t.y)),T.lineTo(Math.floor(o.x),Math.floor(o.y)),T.stroke())},XeCursorTrackerBase.prototype.drawCursor=function(e){var t=e.m_XeMyDocument,i=t.getXeDatabase(),r=t.getXeDatabase().getAPERTURE(),n=t.getXeDatabase().getAPBOX(),o=t.getXeInputPointManager().getOsnapCalculationEnabled(),a=t.getXeDatabase().getSELECTBOX(),s=t.getXeDatabase().getCURSORMODE(),c=!1,i=i.getCMDNAMES();return(c=i.length?-1<i[i.length-1].indexOf("_MAINSELECT"):c)?(i=this.drawArrow(e),e.currentCursorDrawPath="XeCursorTracker/drawCursor/drawArrow/"+i,!0):(2&s?(this.drawCross(e,!0),e.currentCursorDrawPath="XeCursorTracker/drawCursor/drawCross/"+!0):(this.drawCross(e,!1),e.currentCursorDrawPath="XeCursorTracker/drawCursor/drawCross/"+!1),t.getXeInputPointManager().getInsideCommand()||t.getXeInputPointManager().getInsideLISP()?n&&o?(this.drawBox(e,r,!0),e.currentCursorDrawPath+="/drawBox/"+r+"/"+!0,!0):void 0:(this.drawBox(e,a,!1),e.currentCursorDrawPath+="/drawBox/"+a+"/"+!1,!0))},XeCursorTrackerBase.prototype.getCursorColor=function(e,t,i){return e?i.getXeProfile().getModelCrosshairColor():i.getXeProfile().getLayoutCrosshairColor()},XeCursorTrackerBase.prototype.isCursorTintColorRequireChange=function(e,t){var i=0,r=t.getXeProfile().getCrosshairXAxisColor(),n=t.getXeProfile().getCrosshairYAxisColor(),o=t.getXeProfile().getCrosshairZAxisColor(),a=0,a=e?t.getXeProfile().getGraphicsWinModelBackgrndColor():t.getXeProfile().getGraphicsWinLayoutBackgrndColor(),e=Math.abs(window.XeUtils.GetRValue(r)-window.XeUtils.GetRValue(a)),t=Math.abs(window.XeUtils.GetGValue(r)-window.XeUtils.GetGValue(a)),s=Math.abs(window.XeUtils.GetBValue(r)-window.XeUtils.GetBValue(a));return{cursorTintColorAxisX:r,cursorTintColorAxisY:n,cursorTintColorAxisZ:o,backGroundColor:a,result:(i|=e+t+s<84.15?1:0)|(Math.abs(window.XeUtils.GetRValue(n)-window.XeUtils.GetRValue(a))+Math.abs(window.XeUtils.GetGValue(n)-window.XeUtils.GetGValue(a))+Math.abs(window.XeUtils.GetBValue(n)-window.XeUtils.GetBValue(a))<84.15?2:0)|(Math.abs(window.XeUtils.GetRValue(o)-window.XeUtils.GetRValue(a))+Math.abs(window.XeUtils.GetGValue(o)-window.XeUtils.GetGValue(a))+Math.abs(window.XeUtils.GetBValue(o)-window.XeUtils.GetBValue(a))<84.15?4:0)}},XeCursorTrackerBase.prototype.isCursorColorRequireChange=function(e,t,i){var t=this.getCursorColor(e,t,i),r=0,r=e?i.getXeProfile().getGraphicsWinModelBackgrndColor():i.getXeProfile().getGraphicsWinLayoutBackgrndColor(),e=Math.abs(window.XeUtils.GetRValue(t)-window.XeUtils.GetRValue(r)),i=Math.abs(window.XeUtils.GetGValue(t)-window.XeUtils.GetGValue(r)),n=Math.abs(window.XeUtils.GetBValue(t)-window.XeUtils.GetBValue(r)),o=e+i+n<84.15;return{cursorColor:t=o?(e<<16)+(i<<8)+n:t,backGroundColor:r,result:o}},XeCursorTrackerBase.prototype.drawBigCross=function(e){if(!this.isEnable(e))return!1;var t,i,r,n,o=e.m_XeMyDocument,a=(o.getXeGsDevice().getActiveViewport(),o.getXeInputPointManager().getCursorPosition(),this.getXY(e)),s=a[0],a=a[1],c=e.ctx;e.m_XeViewport&&((e=e.m_XeViewport).getViewPlaneOrigin(),i=e.getViewRightDir(),n=e.getUpVector(),r=new GeNeo.OdGeVector3d(i[0],i[1],i[2]),t=new GeNeo.OdGeVector3d(n[0],n[1],n[2]),r=r.normal().crossProduct(t.normal()),(t=new GeNeo.OdGeMatrix3d).setToWorldToPlane(r),i=new GeNeo.OdGeVector3d(e.getViewRightDir()),n=new GeNeo.OdGeVector3d(e.getUpVector()),r=i.transformBy(t),e=n.transformBy(t),i=new GeNeo.OdGeVector2d(r.x,r.y),n=new GeNeo.OdGeVector2d(e.x,e.y),t=this.getCursorAxisSize(o),i=i.mult(t),n=n.mult(t),r=new GeNeo.OdGePoint2d(s,a),e=new GeNeo.OdGeVector2d(r.x-i.x,r.y+i.y),t=new GeNeo.OdGeVector2d(r.x+i.x,r.y-i.y),s=new GeNeo.OdGeVector2d(r.x-n.x,r.y+n.y),a=new GeNeo.OdGeVector2d(r.x+n.x,r.y-n.y),i=!e.isEqualTo(t),r=!s.isEqualTo(a),i)&&r&&(n=o.getModelLayoutActive(),n=this.isCursorColorRequireChange(n,!1,o).cursorColor,c.strokeStyle=window.XeUtils.intRGBToHex(n),r&&(c.beginPath(),c.moveTo(Math.floor(s.x),Math.floor(s.y)),c.lineTo(Math.floor(a.x),Math.floor(a.y)),c.stroke()),i)&&(c.beginPath(),c.moveTo(Math.floor(e.x),Math.floor(e.y)),c.lineTo(Math.floor(t.x),Math.floor(t.y)),c.stroke())},XeCursorTracker.prototype.drawIcon=function(e,t){if(this.m_bDrawAsSystemCursor)return this.drawTrackerBySystemCursor(e,t);this.drawTrackerIntoCanvas(e,t)},XeCursorTracker.prototype.drawTrackerIntoCanvas=function(e,t){if(e){var i=e,e=e.getXeGsDevice().getXeDocument();this.createDrawInfo();var r=this.getCursorPositionData(),n=r?r.cursorPosition:null;if(!(n=this.drawInfo.bDrawByRubberPoint?r?r.cursorPosition:null:(this.drawInfo.timeoutHandler&&(clearTimeout(this.drawInfo.timeoutHandler),this.drawInfo.timeoutHandler=0),r&&r.bSnapped&&(this.drawInfo.timeoutHandler=setTimeout(this.redrawByCursorPosition,this.drawInfo.fireTime,this,e)),e.getXeInputPointManager().getCursorPosition())))return!1;r=[0,0],i=(i.PointToSCSFast(r,n[0],n[1],n[2]),Math.round(r[0])),n=Math.round(r[1]),r=(this.setLastXY(i,n),this.trackerBase.getImgDataWH(t)),i=(null!==i&&null!==n&&isFinite(i)&&isFinite(n)&&this.setUnderCursorImgData(t.ctx.getImageData(Math.floor(i-r.w/2),Math.floor(n-r.h/2),Math.floor(r.w),Math.floor(r.h))),e.getXeDatabase().getCURSORMODE());1&i||2&i||!0===window.XeUtils.IsNoteCommand(e)?this.trackerBase.drawDWGCursor(t):(t.canvas.style.cursor="none",this.trackerBase.drawCursor(t))}},XeCursorTracker.prototype.drawTrackerBySystemCursor=function(e,t){var i;if(e)return e=t.canvas,this.setLastXY(Math.round(e.width/2),Math.round(e.height/2)),1&(i=(e=t.m_XeMyDocument).getXeDatabase().getCURSORMODE())||2&i||!0===window.XeUtils.IsNoteCommand(e)?this.trackerBase.drawDWGCursor(t):this.trackerBase.drawCursor(t)},GridSnapPointTracker.prototype.drawTracker=function(e){return this.trackerBase.isEnable(e)&&this.trackerBase.drawDWGCursor(e),!0};let DebugHelperTracker=function(){ClientSideTracker.call(this);let i=this;i.polygons=[],document.addEventListener("XeWebDrawerEngine.inited",function e(t){t=t.m_Item;t&&t.addOnBeforeSceneRedrawCallback&&t.addOnBeforeSceneRedrawCallback(e=>{e||(i.polygons=[])}),document.removeEventListener("XeWebDrawerEngine.inited",e,!1)},!1)};DebugHelperTracker.prototype=Object.create(ClientSideTracker.prototype),DebugHelperTracker.prototype.constructor=DebugHelperTracker,DebugHelperTracker.prototype.drawTracker=function(e){if(e.m_XeViewport&&this.polygons.length){var t=e.ctx,e=(t.save(),t.strokeStyle);t.strokeStyle="#b40000",t.lineWidth=1;for(let e=0;e<this.polygons.length;e++){var i=this.polygons[e],r=(t.strokeStyle=i.color,i.lines);for(let e=0;e<r.length;e+=2){var n=r[e],o=r[e+1];t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.stroke()}}t.strokeStyle=e,t.restore()}};var DeferredTracker=function(){ClientSideTracker.call(this),this.drawOrder=5,this.m_TrackerName="CFxDeferredTracker",this.TrackIconType={trackTan:0,trackDeferredTan:1,trackPer:2,trackDeferredPer:3,trackInt:4,trackDeferredInt:4,trackApint:5,trackDeferredApint:6}},CFxCmdCircleTracker=(DeferredTracker.prototype=Object.create(ClientSideTracker.prototype),DeferredTracker.prototype.constructor=DeferredTracker,DeferredTracker.prototype.convertToString=function(e){var t;return 1===e?t="Deferred Tangent":3===e?t="Deferred Perpendicular":5===e&&(t="Deferred Intersection"),t},DeferredTracker.prototype.drawTrackIcon=function(e,t,i,r,n){switch(e){case this.TrackIconType.trackTan:t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.arc(r[0],r[1],i,0,2*Math.PI),t.ctx.moveTo(r[0]-i,r[1]-i),t.ctx.lineTo(r[0]+i,r[1]-i),t.ctx.stroke();break;case this.TrackIconType.trackDeferredTan:this.drawTrackIcon(this.TrackIconType.trackTan,t,i,r,n),t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.arc(r[0]+i+4,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+8,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+12,r[1]+i,2,0,2*Math.PI),t.ctx.stroke();break;case this.TrackIconType.trackPer:t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.moveTo(r[0]-i,r[1]-i),t.ctx.lineTo(r[0]-i,r[1]+i),t.ctx.lineTo(r[0]+i,r[1]+i),t.ctx.moveTo(r[0]-i,r[1]),t.ctx.lineTo(r[0],r[1]),t.ctx.lineTo(r[0],r[1]+i),t.ctx.stroke();break;case this.TrackIconType.trackDeferredPer:this.drawTrackIcon(this.TrackIconType.trackPer,t,i,r,n),t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.arc(r[0]+i+4,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+8,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+12,r[1]+i,2,0,2*Math.PI),t.ctx.stroke();break;case this.TrackIconType.trackInt:t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.moveTo(r[0]-i,r[1]-i),t.ctx.lineTo(r[0]+i,r[1]+i),t.ctx.moveTo(r[0]-i,r[1]+i),t.ctx.lineTo(r[0]+i,r[1]-i),t.ctx.stroke();break;case this.TrackIconType.trackDeferredInt:this.drawTrackIcon(this.TrackIconType.trackInt,t,i,r,n),t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.arc(r[0]+i+4,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+8,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+12,r[1]+i,2,0,2*Math.PI),t.ctx.stroke();break;case this.TrackIconType.trackApint:t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.moveTo(r[0]-i,r[1]-i),t.ctx.lineTo(r[0]+i,r[1]+i),t.ctx.moveTo(r[0]-i,r[1]+i),t.ctx.lineTo(r[0]+i,r[1]-i),t.ctx.moveTo(r[0]-i,r[1]-i),t.ctx.lineTo(r[0]-i,r[1]+i),t.ctx.lineTo(r[0]+i,r[1]+i),t.ctx.lineTo(r[0]+i,r[1]-i),t.ctx.linetTo(r[0]-i,r[1]-i),t.ctx.stroke();break;case this.TrackIconType.trackDeferredApint:this.drawTrackIcon(this.TrackIconType.trackApint,t,i,r,n),t.ctx.strokeStyle=n,t.ctx.beginPath(),t.ctx.arc(r[0]+i+4,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[0]+i+8,r[1]+i,2,0,2*Math.PI),t.ctx.arc(r[1]+i+12,r[1]+i,2,0,2*Math.PI),t.ctx.stroke()}},DeferredTracker.prototype.drawTracker=function(e){var t,i,r,n=window.XeActiveTrackers.TrackerData(this.m_TrackerName);return!n||!n.type||(e.m_XeViewport?(t=e.m_XeViewport.PointToSCS(n.point),i=e.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),i=window.XeUtils.intRGBToHex(i),r=e.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE(),this.drawTrackIcon(n.type,e,r,t,i),!0):void 0)},function(){DeferredTracker.call(this),this.drawOrder=5,this.m_TrackerName="CFxTangentTracker"}),CFxCmdLineTracker=(CFxCmdCircleTracker.prototype=Object.create(DeferredTracker.prototype),CFxCmdCircleTracker.prototype.constructor=CFxCmdCircleTracker,CFxCmdCircleTracker.prototype.TypeEnum={eNormal:1,eTTr:2,eTTT:4},CFxCmdCircleTracker.prototype.convertToString=function(e){var t,i=CFxCmdCircleTracker.prototype.TypeEnum;return e===i.eNormal?t="Deferred Normal":e===i.eTTr?t="Deferred TTR":e===i.eTTT&&(t="Deferred TTT"),t},function(){DeferredTracker.call(this),this.drawOrder=5,this.m_TrackerName="CFxCmdLineTracker"}),DimensionTracker=(CFxCmdLineTracker.prototype=Object.create(DeferredTracker.prototype),CFxCmdLineTracker.prototype.constructor=CFxCmdLineTracker,CFxCmdLineTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a=window.XeActiveTrackers.TrackerData(this.m_TrackerName);return!a||(t=DeferredTracker.prototype.drawTracker.call(this,e),a.start_point&&(i=e.ctx,a=a.start_point,o=e.m_XeViewport,n=e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint(),o.PointToSCSFast(r=[0,0],n[0],n[1],n[2]),o.PointToSCSFast(n=[0,0],a[0],a[1],a[2]),o=i.strokeStyle,a=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),i.strokeStyle=a,i.beginPath(),i.moveTo(n[0],n[1]),i.lineTo(r[0],r[1]),i.stroke(),i.strokeStyle=o),t)},function(e){if(ClientSideTracker.call(this),!e)throw"DimensionTracker creation failed";this.getDims=function(){return this.dims},this.getTrackerName=function(){return e},this.drawOrder=5;var v=this.DimBlockRecomputer=null;let C={};var T=0,b=0;this.dims=null,"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.indexOf(e)}),this.drawTracker=function(e){var t=e.ctx,i=e.m_XeViewport,r=e.m_XeMyDocument;if(DbWasm.bADD_BOUNDARY_BOX=!0,this.DimBlockRecomputer=this.DimBlockRecomputer||new DbWasm.OdDbDimRecompute,this.DimBlockRecomputer&&(null==this.dims&&(this.initDims(),this._PE_call()),t)&&i){var n=this.getTrackerName(),o=window.XeActiveTrackers.TrackerData(n);if(o){var a=o.color,s=o.bgcolor;if(r.getXeDatabase().getLWDISPLAY()||(o.LineWeight=XeLineweightUtils.LineWeightEnum.kLnWtByLwDefault),void 0===a&&"Black"===s?a="#FFFFFF":"#ffffff"===a&&"White"===s&&(a="#000000"),this.dims.hasOwnProperty(n)&&this.dims[n]){var c,l,d,u,p=this.dims[n][o.type];if(void 0===p)return window._LOG_GLOBAL.SHOW("SHOW_ERRORS","Dimension tracker not configured: "+n+"/"+o.type),!0;v=p.dim,t.strokeStyle=a;var m,h=o;for(m in v.addToDb(),h)if(h.hasOwnProperty(m)){var g,y=h[m];if(C.hasOwnProperty(v.$$.ptr)){if(C[v.$$.ptr][m]===y)continue}else C[v.$$.ptr]={};!1===(C[v.$$.ptr][m]=y)?y=null:y.constructor===Array&&3===y.length&&(y=new GeNeo.OdGePoint3d(y[0],y[1],y[2])),m.startsWith("dim")?"txsty"!==(g=m.substring(3))&&"ltype"!==g&&"ltex1"!==g&&"ltex2"!==g&&(g="setDim"+m.substring(3),"function"==typeof v[g])&&v[g](y):(g="set"+(m[0].toUpperCase()+m.substring(1)),"function"==typeof v[g]&&v[g](y))}for(c in s=v,o.isUsingDefaultTextPosition?s.useDefaultTextPosition():s.useSetTextPosition(),p.props)p.props.hasOwnProperty(c)&&(l=o[c],Array.isArray(l)?(d=new GeNeo.OdGePoint3d(l[0],l[1],l[2]),void 0!==v[p.props[c]]&&v[p.props[c]](d)):void 0!==v[p.props[c]]&&v[p.props[c]](l));if(void 0!==o.textWidth&&void 0!==o.textHeight&&(b=o.textWidth,T=o.textHeight),p.hasOwnProperty("callees")&&p.callees.constructor===Array)for(u=0;u<p.callees.length;u++){var f=p.callees[u];o[f]&&void 0!==v[f]&&v[f]()}var _=this.getRubberPoint(e);if(_){if(void 0!==p.dependentPoints)for(u=0;u<p.dependentPoints.length;u++){var w=p.dependentPoints[u].cb(r,_,o,v,e);v[p.dependentPoints[u].name](new GeNeo.OdGePoint3d(w.x,w.y,w.z))}void 0!==p.val&&v[p.val](new GeNeo.OdGePoint3d(_.x,_.y,_.z)),void 0!==p.gripPointsPE&&void 0!==o.gripIndex&&void 0!==o.firstPoint&&(a=new GeNeo.OdGePoint3d,p.gripPointsPE.setTextParameters(b,T),p.gripPointsPE.getGripPointAt(v,o.gripIndex,a),s=new GeNeo.OdGeVector3d(_.x,_.y,_.z),a=new GeNeo.OdGeVector3d(a.x,a.y,a.z),s=s.setToDiff(s,a),p.gripPointsPE.moveGripPointAt(v,s,o.gripIndex));a={dimvars:o},s=(RecomputeDimBlock.SET_DRAWCONTEXT(t,i,a),RecomputeDimBlock.SET_TEXT_WH(b,T),RecomputeDimBlock.SET_ACTUAL_DIMTRACKER(n,p),RecomputeDimBlock.bADD_BOUNDARY_BOX=!1,p.comp);this.DimBlockRecomputer.recomputeDimBlock(v,s),RecomputeDimBlock.SET_DRAWCONTEXT(null,null,null)}}else window._LOG_GLOBAL.SHOW("SHOW_ERRORS","Dimension tracker not found: "+n);RecomputeDimBlock.SET_ACTUAL_DIMTRACKER(null,null,null,null),RecomputeDimBlock.bADD_BOUNDARY_BOX=!0}return!0}}}),DimFlipArrowTracker=(DimensionTracker.prototype=Object.create(ClientSideTracker.prototype),DimensionTracker.prototype.constructor=DimensionTracker,DimensionTracker.prototype.start=function(e){this.m_bLockPlacement=!1,DimensionTracker.prototype._drawXeGlDrawObjectMap={}},DimensionTracker.prototype.end=function(e){this.m_bLockPlacement=!1,DimensionTracker.prototype._drawXeGlDrawObjectMap={}},DimensionTracker.prototype._drawXeGlDrawObjectMap={},DimensionTracker.prototype.getRubberPoint=function(e){e=this.m_bLockPlacement?e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT():e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint();return new GeNeo.OdGePoint3d(e)},DimensionTracker.prototype.update=function(e,t){t.IsLeftButtonDown()&&(this.m_bLockPlacement=!0)},DimensionTracker.prototype._PE_call=function(){},DimensionTracker.prototype.initDims=function(){function a(n,o,t){try{var a=new GeNeo.OdGePoint3d(o.center);let e=new GeNeo.OdGeVector3d(o.normal);e=e.normalize();var s=new GeNeo.OdGePlane(a,e);let t=new GeNeo.OdGeVector3d(0,0,-1),i=(t=t.normalize(),new GeNeo.OdGePoint3d);var c=s.intersectWithLine3d(n,t,i);let r=(i=c?i:a.add(t.mult(o.radius))).sub(a);return r=r.normalize(),a.add(r.mult(o.radius))}catch(e){s=new GeNeo.OdGeVector3d(t.m_XeViewport.getUCSxDir()),c=new GeNeo.OdGePoint3d(o.center),a=(n.set(c.add(s.mult(o.radius/2))),c.add(s.mult(o.radius)));return a}}this.dims={CFxElasticDimLinearTracker:{AcDbRotatedDimension:{dim:DbWasm.OdDbRotatedDimension.createObject(),comp:new DbWasm.OdRotatedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",rotation:"setRotation"},val:"setTextPosition",dependentPoints:[{name:"setDimLinePoint",cb:function(e,t){return t}}]}},CFxElasticDimAlignedTracker:{AcDbAlignedDimension:{dim:DbWasm.OdDbAlignedDimension.createObject(),comp:new DbWasm.OdAlignedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point"},val:"setTextPosition",dependentPoints:[{name:"setDimLinePoint",cb:function(e,t){return t}}]}},CFxElasticDimRadialDiameterTracker:{AcDbDiametricDimension:{dim:DbWasm.OdDbDiametricDimension.createObject(),comp:new DbWasm.OdDiametricDimRecomputor,props:{},val:"setTextPosition",dependentPoints:[{name:"setFarChordPoint",cb:function(e,t,i,r,n){var o=new GeNeo.OdGePoint3d(i.center),t=a(t,i,n),i=o.sub(t);return o.add(i)}},{name:"setChordPoint",cb:function(e,t,i,r,n){return a(t,i,n)}}]},AcDbRadialDimension:{dim:DbWasm.OdDbRadialDimension.createObject(),comp:new DbWasm.OdRadialDimRecomputor,props:{center:"setCenter"},val:"setTextPosition",dependentPoints:[{name:"setChordPoint",cb:function(e,t,i,r,n){return t=a(t,i,n),0==i.extArcStartAngle&&0==i.extArcEndAngle&&(i=(n=new GeNeo.OdGePoint3d(i.center)).sub(t),t=n.add(i)),t}}]}},CFxElasticDimOrdinateTracker:{AcDbOrdinateDimension:{dim:DbWasm.OdDbOrdinateDimension.createObject(),comp:new DbWasm.OdOrdinateDimRecomputor,props:{definingPoint:"setDefiningPoint",leaderEndPoint:"setLeaderEndPoint",origin:"setOrigin",TextAttachment:"setTextAttachment"},dependentPoints:[{name:"setLeaderEndPoint",cb:function(e,t,i,r){return i.useXAxis?r.useXAxis():r.useYAxis(),t}}]}},CFxElasticDimAngularTracker:{AcDb2LineAngularDimension:{dim:DbWasm.OdDb2LineAngularDimension.createObject(),comp:new DbWasm.Od2LineAngularDimRecomputor,props:{xLine1Start:"setXLine1Start",xLine1End:"setXLine1End",xLine2Start:"setXLine2Start",xLine2End:"setXLine2End"},val:"setArcPoint",dependentPoints:[{name:"setTextPosition",cb:function(e,t){return t}}]},AcDb3PointAngularDimension:{dim:DbWasm.OdDb3PointAngularDimension.createObject(),comp:new DbWasm.Od3PointAngularDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",centerPoint:"setCenterPoint"},val:"setArcPoint",dependentPoints:[{name:"setTextPosition",cb:function(e,t){return t}}]}},CFxElasticDimArcTracker:{AcDbArcDimension:{dim:DbWasm.OdDbArcDimension.createObject(),comp:new DbWasm.OdArcDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",centerPoint:"setCenterPoint"},dependentPoints:[{name:"setTextPosition",cb:function(e,t,i){return t=void 0!==i.arcPoint?new GeNeo.OdGePoint3d(i.arcPoint):t}},{name:"setArcPoint",cb:function(e,t,i){return t=void 0!==i.arcPoint?new GeNeo.OdGePoint3d(i.arcPoint):t}}]}},CFxElasticDimRadialLargeTracker:{AcDbRadialDimensionLarge:{dim:DbWasm.OdDbRadialDimensionLarge.createObject(),comp:new DbWasm.OdRadialDimLargeRecomputor,props:{extArcStartAngle:"setExtArcStartAngle",extArcEndAngle:"setExtArcEndAngle",center:"setCenter",overrideCenter:"setOverrideCenter"},dependentPoints:[{name:"setChordPoint",cb:function(e,t,i,r,n){return a(t,i,n)}},{name:"setJogPoint",cb:function(e,t,i,r,n){var o=new GeNeo.OdGePoint3d(i.overrideCenter),t=a(t,i,n);return o.add(t.sub(o).mult(.5))}},{name:"setTextPosition",cb:function(e,t){return t}}]}},CFxElasticDimRadialJogTracker:{},CFxElasticDimBaselineRotatedTracker:{AcDbRotatedDimension:{dim:DbWasm.OdDbRotatedDimension.createObject(),comp:new DbWasm.OdRotatedDimRecomputor,props:{xLine1Point:"setXLine1Point",rotation:"setRotation"},dependentPoints:[{name:"setDimLinePoint",cb:function(e,t,i){var t=new GeNeo.OdGePoint3d(t.x,t.y,t.z),r=new GeNeo.OdGeVector3d(i.rotatedVec[0],i.rotatedVec[1],i.rotatedVec[2]),n=new GeNeo.OdGeLine3d(new GeNeo.OdGePoint3d(i.basePoint),r),r=r.perpVector(),o=new GeNeo.OdGeLine3d(t,r),a=new GeNeo.OdGePoint3d;return n.intersectWith(o,a),i.isContinue?new GeNeo.OdGePoint3d(a.x,a.y,a.z):((n=new GeNeo.OdGeVector3d(a.x-t.x,a.y-t.y,a.z-t.z)).isZeroLength()?n=r.normal():(o=n.normal(),n.x+=o.x*i.trackerDimdli,n.y+=o.y*i.trackerDimdli,n.z+=o.z*i.trackerDimdli),new GeNeo.OdGePoint3d(t.x+n.x,t.y+n.y,t.z+n.z))}},{name:"setXLine2Point",cb:function(e,t){return t}}]}},CFxElasticDimBaselineAngularTracker:{AcDb3PointAngularDimension:{dim:DbWasm.OdDb3PointAngularDimension.createObject(),comp:new DbWasm.Od3PointAngularDimRecomputor,props:{centerPoint:"setCenterPoint"},dependentPoints:[{name:"setArcPoint",cb:function(e,t,i,r){var n,o,a,s,c;return t=t,r=r,n=(i=i).m_bSetFirst,o=new GeNeo.OdGePoint3d(i.m_ptXLine1),a=new GeNeo.OdGePoint3d(i.m_ptXLine2),c=s=null,n=i.m_toContinue?t.distanceTo(o)>t.distanceTo(a):n,c=n?(s=t,a):(s=o,t),n=new GeNeo.OdGePoint3d(i.centerPoint),a=GeNeo.OdGeVector3d.kZAxis,t=(o=new GeNeo.OdGePlane(n,a)).closestPointTo(s),a=o.closestPointTo(c),o=t.sub(n),t=a.sub(n),o=o.normalize(),t=t.normalize(),a=(a=o.add(t)).normalize(),o=i.m_distance,a=a.mult(o),t=n.add(a),r.setXLine1Point(new GeNeo.OdGePoint3d(s.x,s.y,s.z)),r.setXLine2Point(new GeNeo.OdGePoint3d(c.x,c.y,c.z)),t}}]}},CFxElasticDimBaselineOrdinateTracker:{AcDbOrdinateDimension:{dim:DbWasm.OdDbOrdinateDimension.createObject(),comp:new DbWasm.OdOrdinateDimRecomputor,props:{origin:"setOrigin"},callees:["useXAxis","useYAxis"],val:"setDefiningPoint",dependentPoints:[{name:"setLeaderEndPoint",cb:function(e,t,i){var r,n,o=new GeNeo.OdGePoint3d(i.baseLeaderEndPoint),a=new GeNeo.OdGePoint3d(i.baseDefPoint),s=o;return i.useXAxis?(r=a.x<t.x?(r=o.x+i.trackerDimdli,Math.max(r,t.x)):(r=o.x-i.trackerDimdli,Math.min(r,t.x)),s.set(r,s.y,s.z)):(n=a.y<t.y?(n=o.y+i.trackerDimdli,Math.max(n,t.y)):(n=o.y-i.trackerDimdli,Math.min(n,t.y)),s.set(s.x,n,s.z)),s}}]}},CFxElasticDimPosTracker:{},CFxElasticSmartDimTracker:{AcDbAlignedDimension:{dim:DbWasm.OdDbAlignedDimension.createObject(),comp:new DbWasm.OdAlignedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point"},val:"setTextPosition",dependentPoints:[{name:"setDimLinePoint",cb:function(e,t){return t}}]},AcDbRotatedDimension:{dim:DbWasm.OdDbRotatedDimension.createObject(),comp:new DbWasm.OdRotatedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",rotation:"setRotation"},val:"setTextPosition",dependentPoints:[{name:"setDimLinePoint",cb:function(e,t){return t}}]}}}},function(){ClientSideTracker.call(this),this.drawOrder=5,this.squared_distance=function(e,t){var i=t[0]-e[0],t=t[1]-e[1];return i*i+t*t}}),DimPalletTracker=(DimFlipArrowTracker.prototype=Object.create(ClientSideTracker.prototype),DimFlipArrowTracker.prototype.constructor=DimFlipArrowTracker,DimFlipArrowTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxDimFlipArrowTracker");if(!t)return!0;if(e.m_XeViewport){var i=e.m_XeViewport,r=e.m_XeMyDocument,n=e.ctx;if(n)for(var o=[0,0],e=r.getXeInputPointManager(),e=((o=e?[e.getHitTestInfo().GetMousePosition().x,e.getHitTestInfo().GetMousePosition().y]:o)[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),r.getXeDatabase().getGRIPHOVER()),a=window.XeUtils.intRGBToHex(e),e=r.getXeDatabase().getGRIPCOLOR(),s=r.getXeProfile().getGripAlpha(),c=window.XeUtils.intRGBAToHex(e,s),l=r.getXeDatabase().getGRIPSIZE(),d=l*l,u=0;u<t.centers.length;u++){var p=i.PointToSCS(t.centers[u]),m=this.squared_distance(o,p)<=d?a:c;n.strokeStyle=m,n.lineWidth=1,n.beginPath(),n.arc(p[0],p[1],l,0,2*Math.PI),n.stroke()}return!0}},function(){ClientSideTracker.call(this);this.drawOrder=50,this.performResources(),this.position={x:0,y:0},this.init()}),DragTracker=(DimPalletTracker.prototype=Object.create(ClientSideTracker.prototype),DimPalletTracker.prototype.constructor=DimPalletTracker,DimPalletTracker.prototype.X_FACTOR_ICON_LOCATION=15,DimPalletTracker.prototype.Y_FACTOR_ICON_LOCATION=-30,DimPalletTracker.prototype.init=function(e){var c=this;function i(e,t){window.getXeActiveDocument();var i=t.m_CommandGlobalName;t.m_CommandStarted;c.bIgnoreDimOnEntityUpdate=i&&(-1<i.indexOf("SNAPGRIP")||-1<i.indexOf("DOCINIT")||-1<i.indexOf("STARTUP")||-1<i.indexOf("REBUILD"))}function l(){var e=window.getXeApplication().getXeUI();e&&e.resetDimIconPosition(),c.dimIconPosition=null,c.dimLastDimEntity=null}function s(){c.drawTrackerTimeout&&(clearTimeout(c.drawTrackerTimeout),c.drawTrackerTimeout=0)}function r(r){var e=r.getXeDatabase();let t=window.getXeApplication().getXeUI(),n=e.getXeEntities(),o=r.getXeInputPointManager(),a=e.getCMDNAMES();if(n&&r.getXeMainSelectionSet()){var i=r.getXeMainSelectionSet().getHandles();0===i.length&&(c.selectionSetLength=null,c.lastclick=null);for(let e=i.length-1;0<=e;e--){var s=(i=>{var e=n.getByHandle(i);if(e&&"XeDimension"===e.m_ClassName)return(e=t.requestDimIconPosition(i)).then(e=>{var t;r.getXeDatabase().getXeEntities().getByHandle(i)?(0===(t=r.getXeMainSelectionSet().getHandles()).length&&(e=null),o.m_LastClickWCS,console.log(c.lastCommand),0<a.length?("'_MAINSELECT"===a[0]&&"_SELECTALL"!==c.lastCommand&&(e=o.m_LastClickWCS,c.lastclick=e,c.selectionSetLength=t.length),d(e)):"_MAINSELECT"!==c.lastCommand&&"_DIMPAL"!==c.lastCommand?d(c.lastclick=e):c.lastclick&&c.selectionSetLength===t.length?d(c.lastclick):d(e)):l()}),e})(i[e]);if(s)return s}}}function d(i){new Promise((e,t)=>{e(c.dimIconPosition=i)})}c.dimIconPosition=null,c.dimLastDimEntity=null,c.dimCurrentDimCommand=null,c.dimPreviousDimCommand=null,c.lastCommand=null,c.lastclick=null,c.bIgnoreDimOnEntityUpdate=!0,c.selectionSetLength=null,c.xeImgIcon.img.onmouseover=function(){var e=window.getXeActiveDocument(),t=e.getXeDatabase();e.getXeInputPointManager();let i="";if(c.dimLastDimEntity){var r=c.dimLastDimEntity.getHandle();i="'_DIMPAL _BY_ID_STR "+r+"\n",s(),l()}else{var n=t.getXeEntities();if(n){var o=e.getXeMainSelectionSet().getHandles();for(let e=o.length-1;0<=e;e--){var a=o[e],a=n.getByHandle(a);if(a&&"XeDimension"===a.m_ClassName){i="'_DIMPAL _BY_SELECTION_SET\n";break}}}}i&&e.RunCmd(i).then(()=>{})},c.xeImgIcon.img.onmouseout=function(){},document.addEventListener("PreUpdate_XeCommandProcessor",function(e){i.states.prev=e.m_Item.copy()}),document.addEventListener("Update_XeCommandProcessor",function(e){var t;i.states.current=e.m_Item.copy(),i(i.states.prev,i.states.current),i.states.current.m_CommandStarted?(t=document.createEvent("Event")).initEvent("CommandStarted",!0,!0):(t=document.createEvent("Event")).initEvent("CommandFinished",!0,!0),document.dispatchEvent(t)}),i.states={prev:{},current:{}},document.addEventListener("PreUpdate_XeEntities",function(e){c.dimLastDimEntity=null,s()}),document.addEventListener("Update_XeEntities",function(e){var t=e.m_Item;let i;for(i=0;i<e.m_UpdatedEntities.length;i++){var r=t.getByHandle(e.m_UpdatedEntities[i]);!r||"XeDimension"!=r.m_ClassName||c.bIgnoreDimOnEntityUpdate||(c.dimLastDimEntity=r,s())}}),document.addEventListener("XeGsDevice_LastEntity",function(e){var e=e.m_Item.getXeDocument(),t=(e.getXeDatabase(),window.getXeApplication().getXeUI()),i=c.dimLastDimEntity;l(),c.dimLastDimEntity=i,r(e)||c.dimLastDimEntity&&(i=c.dimLastDimEntity.getHandle(),t.requestDimIconPosition(i).then(d))}),document.addEventListener("Update_XeSelectionSet",function(e){s();e=e.m_Item.getXeDocument();c.lastCommand=e.m_LastCommand,l(),r(e)})},DimPalletTracker.prototype.drawTracker=function(e){var t=this,i=e.m_XeMyDocument,r=(t.m_XeMyDocument=i).getXeDatabase();i.getXeInputPointManager();if(e.m_XeViewport&&e.canvas)if(this.checkAbortDraw(e))t.hideImageDOM();else{var n=t.dimIconPosition;if(n){var o=r.getXeEntities();if(o){var a=i.getXeMainSelectionSet().getHandles();for(let e=a.length-1;0<=e;e--){var s=a[e],s=o.getByHandle(s);if(s){s=s.getLayerObject();if(s&&s.getLocked())return t.hideImageDOM(),!0}}}r=[0,0];if(e.m_XeViewport.PointToSCSFast(r,n[0],n[1],n[2]),t.xeImgIcon.imageLoaded){if(t.bImageInsertedToDoc||(t.xeImgIcon.img.style.position="absolute",t.xeImgIcon.img.style.left="-999px",t.xeImgIcon.img.style.top="-999px",e=i.getClientTrackerWidget(),document.getElementById(e).appendChild(t.xeImgIcon.img),t.bImageInsertedToDoc=!0),r[0]=Math.floor(r[0]+DimPalletTracker.prototype.X_FACTOR_ICON_LOCATION),r[1]=Math.floor(r[1]+DimPalletTracker.prototype.Y_FACTOR_ICON_LOCATION),r[1]<0)return t.hideImageDOM(),!0;t.setImageDOMPosition(r)}}else t.hideImageDOM()}else t.hideImageDOM();return!0},DimPalletTracker.prototype.performResources=function(){this.xeImgIcon=new XeImage("qtresources/DimensionPalette/DimPaleteWidget.png")},DimPalletTracker.prototype.start=function(e){this.m_XeMyDocument=e},DimPalletTracker.prototype.end=function(e){this.xeImgIcon.imageLoaded&&this.bImageInsertedToDoc&&(e=e.getClientTrackerWidget(),document.getElementById(e).removeChild(this.xeImgIcon.img),this.bImageInsertedToDoc=!1)},DimPalletTracker.prototype.update=function(e,t){this.m_XeMyDocument=e.m_XeMyDocument;e=e.m_XeMyDocument.getXeGsDevice();e&&(e.getPan()||e.getOrbit())&&this.hideImageDOM()},DimPalletTracker.prototype.checkAbortDraw=function(e){return!(!window.XeFxQtWidgetDimPalletManager||!window.XeFxQtWidgetDimPalletManager.isShown)},DimPalletTracker.prototype.isImageDOMHidden=function(){return"none"===this.xeImgIcon.img.style.display},DimPalletTracker.prototype.hideImageDOM=function(){this.xeImgIcon.img.style.display="none"},DimPalletTracker.prototype.setImageDOMPosition=function(e){e=this.position={x:Math.round(e[0]),y:Math.round(e[1])};this.xeImgIcon.img.style.position="absolute",this.xeImgIcon.img.style.display="",this.xeImgIcon.img.style.left=e.x+"px",this.xeImgIcon.img.style.top=e.y+"px"},function(){ClientSideTracker.call(this);this.drawOrder=100,this.setXeEntityPreview=function(e){t=e},this.getXeEntityPreview=function(){return t},this.getTrackerName=function(){return"CFxDragTracker"},this.matrix_transform=new GeNeo.OdGeMatrix3d,this.correctByRubberPoint=!1,this.useLastOffset={bUse:!1,offset_wcs:[0,0,0]};var t=new XeEntityPreview}),DynamicOffsetTracker=(DragTracker.prototype=Object.create(ClientSideTracker.prototype),DragTracker.prototype.constructor=DragTracker,DragTracker.prototype.start=function(e){this.matrix_transform=new GeNeo.OdGeMatrix3d;var t=window.XeActiveTrackers.TrackerData(this.getTrackerName()),t=(t&&(t=t.ids.concat(t.depids),this.setIdArray(t)),this.useLastOffset={bUse:!1,offset_wcs:[0,0,0]},e.getXeGsDevice());t&&t.setContinuousAction(!0)},DragTracker.prototype.end=function(e){this.getXeEntityPreview().deallocate(),this.setXeEntityPreview(new XeEntityPreview),this.useLastOffset={bUse:!1,offset_wcs:[0,0,0]},this.matrix_transform=new GeNeo.OdGeMatrix3d;e=e.getXeGsDevice();e&&(e.setContinuousAction(!1),e.invalidateClientTrackersGL())},DragTracker.prototype.setIdArray=function(e){},DragTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview,t=(e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(0),e.getXeDrawDecoration().TYPE_ENUM.SelectionSet);return e.getXeDrawDecoration().setType(t),e},DragTracker.prototype.setMatrixTransform=function(e,t){this.matrix_transform.setentry(0,3,e[0]-t[0]),this.matrix_transform.setentry(1,3,e[1]-t[1]),this.matrix_transform.setentry(2,3,e[2]-t[2]),this.matrix_transform.setentry(3,3,1)},DragTracker.prototype.update=function(e,t){var i=window.XeActiveTrackers.TrackerData(this.getTrackerName());i&&!t.IsKeyboardEvent()&&!this.useLastOffset.bUse&&t.IsLeftButtonUp()&&(t=i.basePoint,i=window.getXeActiveDocument().getXeInputPointManager().getSpecificRubberPoint(),this.useLastOffset.bUse=!0,this.useLastOffset.offset_wcs=[i[0]-t[0],i[1]-t[1],i[2]-t[2]])},DragTracker.prototype.drawTracker=function(e){return!0},DragTracker.prototype.drawTrackerGl=function(e,t){var i,r,n,o=window.XeActiveTrackers.TrackerData(this.getTrackerName());if(o&&e)return i=e.getXeGsDevice().getXeDocument(),o=o.basePoint,n=[0,0],(n=(r=i.getXeInputPointManager())?[r.getHitTestInfo().GetMousePosition().x,r.getHitTestInfo().GetMousePosition().y]:n)[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),r=e.PointToWCS(n[0],n[1],!0),n=i.getXeInputPointManager().getSpecificRubberPoint(),this.setMatrixTransform(r,o),this.correctByRubberPoint?this.setMatrixTransform(n,o):this.useLastOffset.bUse&&this.setMatrixTransform(this.useLastOffset.offset_wcs,[0,0,0]),this.drawDragObjectsGl(e,t),this.correctByRubberPoint||(this.offsetCorrectionTimeout&&clearTimeout(this.offsetCorrectionTimeout),this.offsetCorrectionTimeout=setTimeout(this.redrawByCorrectionTimeout,175)),!0},DragTracker.prototype.redrawByCorrectionTimeout=function(){var e=window.getXeActiveDocument();clientSideTrackersHolder&&clientSideTrackersHolder.CFxDragTracker&&(clientSideTrackersHolder.CFxDragTracker.useLastOffset.bUse||(clientSideTrackersHolder.CFxDragTracker.correctByRubberPoint=!0,e.getXeGsDevice().invalidateClientTrackersGL(),clientSideTrackersHolder.CFxDragTracker.correctByRubberPoint=!1))},DragTracker.prototype.drawDragObjects=function(e){var t=this.getXeEntityPreview();t.setTransform(this.matrix_transform),t.draw_gdi(e)},DragTracker.prototype.drawDragObjectsGl=function(e,t){var i=this.getXeEntityPreview();i.setTransform(this.matrix_transform),i.draw_gl(t,e)},function(){ClientSideTracker.call(this)}),ElasticImageScaleTracker=(DynamicOffsetTracker.prototype=Object.create(ClientSideTracker.prototype),DynamicOffsetTracker.prototype.constructor=DynamicOffsetTracker,DynamicOffsetTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=window.XeActiveTrackers.TrackerData("CFxDynamicOffsetTracker");if(!t)return!0;var i=e.m_XeViewport.PointToSCS(t.pOnOrig),t=e.m_XeViewport.PointToSCS(t.pOnCloned);e.ctx.setLineDash([5,9]),0!=i[0]&&0!=i[1]&&(e.ctx.moveTo(i[0],i[1]),e.ctx.lineTo(t[0],t[1]),e.ctx.strokeStyle="rgb(224 ,224,224)",e.ctx.stroke())}},function(){ClientSideTracker.call(this)}),ElasticImageRotateTracker=(ElasticImageScaleTracker.prototype=Object.create(ClientSideTracker.prototype),ElasticImageScaleTracker.prototype.constructor=ElasticImageScaleTracker,ElasticImageScaleTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("CFxElasticImageScaleTracker");if(i&&i.basepoint&&i.scale){var r=i.basepoint,n=i.scale,o=i.imagewidth,i=i.imageheight,a=[];a.push(t.PointToSCS(r)),a.push(t.PointToSCS([r[0]+o*n,r[1]])),a.push(t.PointToSCS([r[0]+o*n,r[1]+i*n])),a.push(t.PointToSCS([r[0],r[1]+i*n])),a.push(t.PointToSCS(r)),e.ctx.setLineDash([]),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath();for(var s=0;s<5;s++)e.ctx.moveTo(a[s%5][0],a[s%5][1]),e.ctx.lineTo(a[(s+1)%5][0],a[(s+1)%5][1]);e.ctx.stroke()}return!0}},function(){ClientSideTracker.call(this)}),FxElasticImageFixedTracker=(ElasticImageRotateTracker.prototype=Object.create(ClientSideTracker.prototype),ElasticImageRotateTracker.prototype.constructor=ElasticImageRotateTracker,ElasticImageRotateTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("CFxElasticImageRotateTracker");if(i&&i.basepoint&&i.scale){var r=new GeNeo.OdGePoint3d(i.basepoint),n=new GeNeo.OdGePoint3d,o=new GeNeo.OdGeVector3d,a=new GeNeo.OdGeVector3d,n=(e.m_XeMyDocument.getXeInputPointManager().GetWorkingPlaneCoordSystem(t,n,o,a),(new GeNeo.OdGeMatrix3d).setToRotation(i.angle,GeNeo.OdGeVector3d.kZAxis,n)),s=(new GeNeo.OdGeMatrix3d).setToScaling(i.imagewidth*i.scale),i=(new GeNeo.OdGeMatrix3d).setToScaling(i.imageheight*i.scale),o=new GeNeo.OdGeVector3d(o.transformBy(n).transformBy(s)),s=new GeNeo.OdGeVector3d(a.transformBy(n).transformBy(i)),a=(new GeNeo.OdGeVector3d).setToSum(o,s),c=[],l=(c.push(t.PointToSCS(r)),c.push(t.PointToSCS(new GeNeo.OdGePoint3d(o.x+r.x,o.y+r.y,o.z+r.z))),c.push(t.PointToSCS(new GeNeo.OdGePoint3d(a.x+r.x,a.y+r.y,a.z+r.z))),c.push(t.PointToSCS(new GeNeo.OdGePoint3d(s.x+r.x,s.y+r.y,s.z+r.z))),c.push(t.PointToSCS(r)),c.length);e.ctx.setLineDash([]),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath();for(var d=0;d<l;d++)e.ctx.moveTo(c[d%l][0],c[d%l][1]),e.ctx.lineTo(c[(d+1)%l][0],c[(d+1)%l][1]);e.ctx.stroke()}return!0}},function(){ClientSideTracker.call(this)}),FrameTracker=(FxElasticImageFixedTracker.prototype=Object.create(ClientSideTracker.prototype),FxElasticImageFixedTracker.prototype.constructor=FxElasticImageFixedTracker,FxElasticImageFixedTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("CFxElasticImageFixedTracker");if(i&&i.basepoint){var r=new GeNeo.OdGePoint3d(i.basepoint[0],i.basepoint[1],i.basepoint[2]),n=new GeNeo.OdGePoint3d,o=new GeNeo.OdGeVector3d,a=new GeNeo.OdGeVector3d,n=(e.m_XeMyDocument.getXeInputPointManager().GetWorkingPlaneCoordSystem(t,n,o,a),(new GeNeo.OdGeMatrix3d).setToScaling(i.imagewidth*i.scale,new GeNeo.OdGePoint3d(0,0,0))),i=(new GeNeo.OdGeMatrix3d).setToScaling(i.imageheight*i.scale,new GeNeo.OdGePoint3d(0,0,0)),o=new GeNeo.OdGeVector3d(o.transformBy(n)),n=new GeNeo.OdGeVector3d(a.transformBy(i)),a=(new GeNeo.OdGeVector3d).setToSum(o,n),s=[],c=(s.push(t.PointToSCS(r)),s.push(t.PointToSCS(new GeNeo.OdGePoint3d(o.x+r.x,o.y+r.y,o.z+r.z))),s.push(t.PointToSCS(new GeNeo.OdGePoint3d(a.x+r.x,a.y+r.y,a.z+r.z))),s.push(t.PointToSCS(new GeNeo.OdGePoint3d(n.x+r.x,n.y+r.y,n.z+r.z))),s.push(t.PointToSCS(r)),s.length);e.ctx.setLineDash([]),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath();for(var l=0;l<c;l++)e.ctx.moveTo(s[l%c][0],s[l%c][1]),e.ctx.lineTo(s[(l+1)%c][0],s[(l+1)%c][1]);e.ctx.stroke()}return!0}},function(){ClientSideTracker.call(this),this.drawOrder=70,this.FrameMode={eNormal:0,ePolygon:1,eFence:2},this.ColorMode={eWhite:-2,eWhiteDashed:-1,eNormalColor:0,eWindow:1,eCrossing:2}}),FxDbgTracker=(FrameTracker.prototype=Object.create(ClientSideTracker.prototype),FrameTracker.prototype.constructor=FrameTracker,FrameTracker.prototype.drawEllipse=function(e,t,i,r,n){var o=r/2*.5522848,a=n/2*.5522848,s=t+r,c=i+n,r=t+r/2,n=i+n/2;e.beginPath(),e.moveTo(t,n),e.bezierCurveTo(t,n-a,r-o,i,r,i),e.bezierCurveTo(r+o,i,s,n-a,s,n),e.bezierCurveTo(s,n+a,r+o,c,r,c),e.bezierCurveTo(r-o,c,t,n+a,t,n),e.closePath(),e.stroke()},FrameTracker.prototype.drawArrow=function(e,t){e.className="interactive_arrow"},FrameTracker.prototype.drawDWGRectCircleIn=function(e,t,i){var r;this.x<0||this.x>t.width||this.y<0||this.y>t.height||(this.drawArrow(e,t),e=this.x+16,r=this.y+16,i=window.XeUtils.intRGBToHex(i.m_XeMyDocument.getXeGsDevice().getForeground()),t.strokeStyle=i,t.fillStyle=i,this.drawEllipse(t,e+2,r+2,6,4),t.fill(),t.rect(e,r,10,8),t.stroke())},FrameTracker.prototype.drawDWGRectCircleCross=function(e,t,i){var r;this.drawArrow(e,t),this.x<0||this.x>t.width||this.y<0||this.y>t.height||(e=this.x+16,r=this.y+16,i=window.XeUtils.intRGBToHex(i.m_XeMyDocument.getXeGsDevice().getForeground()),t.strokeStyle=i,t.fillStyle=i,this.drawEllipse(t,e+2,r-2,6,4),t.fill(),t.rect(e,r,10,8),t.stroke())},FrameTracker.prototype.rectFrame=function(e,t,i,r,n){e.fillStyle=i,e.strokeStyle=i;var i=n[2%r][0]-n[0%r][0],o=n[1%r][1]-n[0%r][1];t&&e.setLineDash([7,2]),e.globalAlpha=.2,e.lineWidth=1.1,e.beginPath(),e.rect(n[0%r][0],n[0%r][1],i,o),e.fill(),e.closePath(),e.globalAlpha=1,e.stroke()},FrameTracker.prototype.intToR=function(e){return e>>16&255},FrameTracker.prototype.intToG=function(e){return e>>8&255},FrameTracker.prototype.intToB=function(e){return 255&e},FrameTracker.prototype.drawFrame=function(e,t,i,r,n,o,a,s){let c=!0;switch(t.colorMode){case this.ColorMode.eWhite:break;case this.ColorMode.eWhiteDashed:e.ctx.setLineDash([7,2]),i=!0;break;case this.ColorMode.eNormalColor:var l,d,u;a[0]<=this.x?(l=this.intToR(t.windowareacolor),d=this.intToG(t.windowareacolor),u=this.intToB(t.windowareacolor),r=window.XeUtils.rgbToHex(l,d,u)):(l=this.intToR(t.crossingareacolor),d=this.intToG(t.crossingareacolor),u=this.intToB(t.crossingareacolor),r=window.XeUtils.rgbToHex(l,d,u),e.ctx.setLineDash([7,2]),i=!0),this.rectFrame(e.ctx,i,r,n,o),c=!1;break;case this.ColorMode.eWindow:r=window.XeUtils.rgbToHex(0,0,255);break;case this.ColorMode.eCrossing:r=window.XeUtils.rgbToHex(0,255,0),e.ctx.setLineDash([7,2]),i=!0}if(c){e.ctx.beginPath(),e.ctx.strokeStyle=r;var p=n-1;s&&p++;for(var m=0;m<p;m++)e.ctx.moveTo(o[m%n][0],o[m%n][1]),e.ctx.lineTo(o[(m+1)%n][0],o[(m+1)%n][1]);e.ctx.stroke()}e.ctx.setLineDash([]),i?this.drawDWGRectCircleCross(e.canvas,e.ctx,e):this.drawDWGRectCircleIn(e.canvas,e.ctx,e)},FrameTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxFrameTracker");if(!t)return!0;if(e.m_XeViewport){var i=e.m_XeViewport,r=e.m_XeMyDocument.getXeGsDevice().getActiveViewport(),n=e.m_XeMyDocument.getXeInputPointManager().getCursorPosition(),o=[0,0],a=(r.PointToSCSFast(o,n[0],n[1],n[2]),this.x=o[0],this.y=o[1],0),s=t.polygon.length;switch(t.frameMode){case this.FrameMode.eNormal:a=5;break;case this.FrameMode.eFence:a=s+1;break;case this.FrameMode.ePolygon:a=s<=1?s+1:s+2}var c,l,d=!0,u=i.PointToSCS(t.polygon[0]),p=[];switch(t.frameMode){case this.FrameMode.eNormal:p.push(u),p.push([u[0],this.y]),p.push([this.x,this.y]),p.push([this.x,u[1]]),p.push(u);break;case this.FrameMode.ePolygon:for(c=0;c<s;c++)l=i.PointToSCS(t.polygon[c]),p.push(l);s<=1?p.push([this.x,this.y]):(p.push([this.x,this.y]),p.push(u));break;case this.FrameMode.eFence:for(c=0;c<s;c++)l=i.PointToSCS(t.polygon[c]),p.push(l);p.push([this.x,this.y]),d=!1;break;default:var m="FrameTracker: unknown frameMode"+t.frameMode;window.XeLogger.error(m)}r=e.m_XeMyDocument.getXeGsDevice().getForeground(),n=window.XeUtils.intRGBToHex(r);return e.ctx.lineWidth=1,e.ctx.setLineDash([]),this.drawFrame(e,t,!1,n,a,p,u,d),!1}},function(){ClientSideTracker.call(this),this.drawOrder=10,this.fontSize=10}),GridTracker=(FxDbgTracker.prototype=Object.create(ClientSideTracker.prototype),FxDbgTracker.prototype.constructor=FxDbgTracker,FxDbgTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("FxDbgTracker");if(!i)return!1;var r=window.getXeActiveDocument().getXeInputPointManager().getMousePosition().x,n=window.getXeActiveDocument().getXeInputPointManager().getMousePosition().y;if(i.outputArray){e.ctx.save(),i.extents&&(o=i.extents[0],l=i.extents[1],a=t.PointToSCS(o),s=t.PointToSCS([l[0],o[1],o[2]]),c=t.PointToSCS(l),l=t.PointToSCS([o[0],l[1],o[2]]),e.ctx.fillStyle="rgba(255, 255, 0, 0.3)",e.ctx.strokeStyle="rgba(255, 255, 0, 0.3)",e.ctx.lineWidth=5,e.ctx.beginPath(),e.ctx.moveTo(a[0],a[1]),e.ctx.lineTo(s[0],s[1]),e.ctx.lineTo(c[0],c[1]),e.ctx.lineTo(l[0],l[1]),e.ctx.lineTo(a[0],a[1]),e.ctx.stroke()),e.ctx.textBaseline="top",e.ctx.font=this.fontSize.toString()+"px sans-serif";for(var o,a,s,c,l,d=new GeNeo.OdGeVector2d(0,this.fontSize+1),u=0;u<i.outputArray.length;u++){var p=(u+1)%i.outputArray.length,m=i.outputArray[p],h=new GeNeo.OdGePoint2d(t.PointToSCS(m.position));0==p&&(h.x=r,h.y=n);for(var g=0;g<m.textArray.length;g++){var y=m.textArray[g],f=e.ctx.measureText(y.text).width;e.ctx.fillStyle="rgba(255, 255, 255, 0.8)",e.ctx.fillRect(h.x-2,h.y-(0===g?1:0),f+4,this.fontSize+(0===g?2:1)),e.ctx.fillStyle=window.XeUtils.intRGBToHex(y.color),e.ctx.fillText(y.text,h.x,h.y),h=h.add(d)}}e.ctx.restore()}return!0}},function(){ClientSideTracker.call(this);this.drawOrder=15,this.setAlwaysActiveOnPan(!0),this.getLastViewParameters=function(){return t},this.setLastViewParameters=function(e){t=e},this.getGridArray=function(){return e},this.clearGridArray=function(){e=[]};var t=new XeGsViewSnapshot,e=[]}),GripPointTracker=(GridTracker.prototype=Object.create(ClientSideTracker.prototype),GridTracker.prototype.constructor=GridTracker,GridTracker.prototype.calculateWCSToSnapMatrix=function(e,t,i){Math.abs(+t.x)<GeNeo.equalPoint()&&(t.x=1),Math.abs(+t.y)<GeNeo.equalPoint()&&(t.y=1);var r=new GeNeo.OdGePoint3d,n=new GeNeo.OdGeVector3d,o=new GeNeo.OdGeVector3d,e=(e.GetElevatedUcsPlane(r,n,o),n.normal().crossProduct(o.normal())),r=GeNeo.OdGeMatrix3d.worldToPlane(e),e=n,n=o;e=e.transformBy(r).normalize(),n=n.transformBy(r).normalize();n=i.m_XeMyDocument.getXeDatabase().getSNAPSTYL()?(e.x=t.x/2,e.y=t.y,n.x=0,n.y=2*t.y,o=i.m_XeMyDocument.getXeDatabase().getSNAPANG(),a=(a=new GeNeo.OdGeMatrix3d).setToRotation(o,GeNeo.OdGeVector3d.kZAxis,GeNeo.OdGePoint3d.kOrigin),e=e.transformBy(a),n.transformBy(a)):(e=e.mult(t.x),n.mult(t.y));var o=i.m_XeMyDocument.getXeDatabase().getSNAPBASE(),a=new GeNeo.OdGePoint3d(o[0],o[1],0);return 1e10<a.asVector().length()&&(a=GeNeo.OdGePoint3d.kOrigin),t=new GeNeo.OdGePlane(a,e,n),{result:GeNeo.OdGeMatrix3d.alignCoordSys(a,e,n,e.crossProduct(n),GeNeo.OdGePoint3d.kOrigin,GeNeo.OdGeVector3d.kXAxis,GeNeo.OdGeVector3d.kYAxis,GeNeo.OdGeVector3d.kZAxis),wcs2ucs:r,planeUCS:t}},GridTracker.prototype.appendToImg=function(e,t,i,r,n,o,a){var s=this.getImageData(),e=4*(e+t*i);s.data[0+e]=r,s.data[1+e]=n,s.data[2+e]=o,s.data[3+e]=a},GridTracker.prototype.appendToGridArray=function(e,t,i,r,n,o){e={x:e,y:t,rgba:"rgba("+i+" , "+r+" , "+n+" , "+o+")"};this.getGridArray().push(e)},GridTracker.prototype.IsGridTooDense=function(e){var t=e.getXeGsDevice().getXeDocument().getXeDatabase().getGRIDUNIT();return t[0]<=0||t[1]<=0||(t=Math.sqrt(t[0]*t[0]+t[1]*t[1]),e.NumToSCS(t)<10)},GridTracker.prototype.calculateGrid=function(e){var t=e.m_XeMyDocument.getXeGsDevice(),i=t.getPixelWidth(),r=t.getPixelHeight();if(!window.XeActiveTrackers.TrackerData("CFxGridTracker"))return!1;if(!e.m_XeViewport)return!1;var n=e.m_XeViewport;if(this.getLastViewParameters().compareTo(n))return!0;this.getLastViewParameters().initFrom(n),this.clearGridArray();t=e.m_XeMyDocument.getXeDatabase().getGRIDUNIT();if(this.IsGridTooDense(n))return!0;var o=n.getViewportDc(),a=n.PointToWCSOnUCS(o.xmin,o.ymin),s=n.PointToWCSOnUCS(o.xmax,o.ymax),c=n.PointToWCSOnUCS(o.xmin,o.ymax),o=n.PointToWCSOnUCS(o.xmax,o.ymin),t=this.calculateWCSToSnapMatrix(n,new GeNeo.OdGePoint3d(t),e),l=t.result,d=t.wcs2ucs,u=t.planeUCS,a=new GeNeo.OdGePoint3d(a[0],a[1],a[2]).transformBy(d),s=new GeNeo.OdGePoint3d(s[0],s[1],s[2]).transformBy(d),c=new GeNeo.OdGePoint3d(c[0],c[1],c[2]).transformBy(d),o=new GeNeo.OdGePoint3d(o[0],o[1],o[2]).transformBy(d),t=new GeNeo.OdGeExtents2d,a=(t.addPoint(a.transformBy(l).convert2d()),t.addPoint(s.transformBy(l).convert2d()),t.addPoint(c.transformBy(l).convert2d()),t.addPoint(o.transformBy(l).convert2d()),t.minPoint()),p=t.maxPoint(),m=Math.floor(a.x),s=Math.floor(a.y),c=Math.abs(p.x-m+1),o=Math.abs(p.y-s+1);if(!(262144<c||262144<o||262144<c*o)){var h,g=e.m_XeMyDocument.getXeDatabase().getGRIDDISPLAY(),y=(g&=1,d.inverse()),l=e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getOverall()?(h=new GeNeo.OdGePoint2d(e.m_XeMyDocument.getXeDatabase().getPLIMMIN()),new GeNeo.OdGePoint2d(e.m_XeMyDocument.getXeDatabase().getPLIMMAX())):(h=new GeNeo.OdGePoint2d(e.m_XeMyDocument.getXeDatabase().getLIMMIN()),new GeNeo.OdGePoint2d(e.m_XeMyDocument.getXeDatabase().getLIMMAX())),f=new GeNeo.OdGeExtents2d,t=(f.addPoint(h),f.addPoint(l),GeNeo.equalPoint());f.expandBy(new GeNeo.OdGeVector2d(t,t)),f.expandBy(new GeNeo.OdGeVector2d(-t,-t));for(var _=s;_<=p.y;_++)for(var w=m;w<=p.x;w++){var v=u.evalPoint(w,_);(g||f.contains(v.convert2d()))&&(v.transformBy(y),0<=(v=n.PointToSCS(v))[0])&&v[0]<=i&&0<=v[1]&&v[1]<=r&&this.appendToGridArray(Math.floor(v[0]),Math.floor(v[1]))}return!0}},GridTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxGridTracker");if(t&&t.drawGrid){var i=e.ctx,r=(this.calculateGrid(e),this.getGridArray());if(!r.length)return!0;t=e.m_XeMyDocument.getXeGsDevice().getForeground(),e="rgba("+window.XeUtils.GetRValue(t)+" , "+window.XeUtils.GetGValue(t)+" , "+window.XeUtils.GetBValue(t)+" , 255)";i.fillStyle=e,i.strokeStyle=e,i.lineWidth=1;for(var n=0;n<r.length;n++){var o=r[n];i.fillRect(o.x-1,o.y-1,2,2)}}return!0},function(e){ClientSideTracker.call(this),this.drawOrder=16,this.bOnlyGL=e}),penBorderColor=[127,127,127],GrVecsTracker=(GripPointTracker.prototype=Object.create(ClientSideTracker.prototype),GripPointTracker.prototype.constructor=GripPointTracker,GripPointTracker.prototype.isDrawnOnlyInActiveViewport=function(){return!1},GripPointTracker.prototype.drawTracker=function(i){if(!this.bOnlyGL&&!i.m_XeMyDocument.getViewMode()){if(!i.m_XeViewport)return!0;var t=i.m_XeMyDocument,r=t.getXeDatabase();if(0!==r.getGRIPS()){var n=i.m_XeViewport.getOverall()?2:1,o=i.m_XeMyDocument.getXeDatabase().getCMDNAMES();if(o.length){var o=o[o.length-1],a=-1<o.indexOf("_MAINSELECT"),o=-1<o.indexOf("GRIP");if(!a&&!o)return!0}var a=r.getGRIPCOLOR(),o=t.getXeProfile().getGripAlpha(),s=r.getGRIPSIZE(),c=window.XeUtils.intRGBAToHex(a,o),l=window.XeUtils.rgbaToHex(penBorderColor[0],penBorderColor[1],penBorderColor[2],o),d=t.getXeWorkingSelectionSet().getHandles();let e=t.getXeMainSelectionSet().getHandles();e=uniq_fast(e);var u=r.getXeLayers();if(!(e.length>r.getGRIPOBJLIMIT())){var p=r.getXeEntities();if(p){var m=r.getXeGroupDictionary().getGroupsByIdArray(e),h=r.getGROUPDISPLAYMODE();m.found&&1<=h&&(e=m.ungroupped);for(var g=0;g<e.length;g++){var y=e[g],f=p.getByHandle(y);if(f&&(!(0<d.length)||d.includes(y))){if(f.getGrips()&&f.getGrips().length>r.getGRIPOBJLIMIT())break;y=u["m_"+f.getLayer()];y&&!y.getLocked()&&n===f.getOwner()&&(f.IsHidden()||n!==f.getOwner()||this.drawGrips(i,f,s,c,l),f.m_ClassName)&&"XeSpline"===f.m_ClassName&&1===f.getSplineType()&&this.drawSplineCVTracker(i,f)}}if(m.found&&1<=h)for(let e=0,t=m.groupped.length;e<t;e++){var _,w=m.groupped[e];w.getIsSelectable()&&(_=w.getGroupGrip(),this.drawGroupGrip(_,i,s,c,l),2==h)&&(_=w.getExtentsPoints(),this.drawGroupBoundingBox(_,i,s,c,l))}return!0}}}}},GripPointTracker.prototype.drawGrips=function(t,e,i,r,n){return!!t.m_XeViewport&&!!e&&(t.m_XeMyDocument.getXeInputPointManager().GripManager().Update(),e.GetGripsData().forEach(e=>e.DrawGrip(t)),!0)},GripPointTracker.prototype.getGroupGrip=function(e,t){for(var i,r=e.getXeGsDevice().getXeDocument().getXeDatabase().getXeEntities(),n=e.getOverall()?2:1,o=new GeNeo.OdGeExtents3d,a=!1,s=0;s<t.length;s++){var c=r[0!==t[s].indexOf("m_")?"m_"+t[s]:t[s]];c&&n===c.getOwner()&&(a=!0,c=c.getExtents(),o.addPoint(c.minPoint()),o.addPoint(c.maxPoint()))}if(a)return e=o.minPoint(),i=o.maxPoint(),new GeNeo.OdGePoint3d((e.x+i.x)/2,(e.y+i.y)/2,(e.z+i.z)/2)},GripPointTracker.prototype.drawGroupGrip=function(e,t,i,r,n){var o=t.ctx;e&&(e=(t=t.m_XeViewport.PointToSCS(e[0],e[1],e[2]))[0],t=t[1],o.fillStyle=r,o.strokeStyle=n,o.beginPath(),o.moveTo(e-i,t-i),o.lineTo(e-i,t+i),o.lineTo(e+i,t+i),o.lineTo(e+i,t-i),o.lineTo(e-i,t-i),o.fill(),o.stroke())},GripPointTracker.prototype.drawGroupBoundingBox=function(e,t,i,r,n){var o=t.ctx,a=t.m_XeViewport,s=e;if(s){o.setLineDash([1,2]),o.beginPath(),o.lineWidth=1;t=s[0],t=a.PointToSCS(t[0],t[1],t[2]);o.moveTo(t[0],t[1]);let e=1;for(;e<s.length;){var c=s[e],c=a.PointToSCS(c[0],c[1],c[2]);o.lineTo(c[0],c[1]),e++}o.stroke()}},GripPointTracker.prototype.drawSplineCVTracker=function(e,t){var i=t.m_Grips;e.ctx.setLineDash([3]),e.ctx.lineWidth=1,e.ctx.strokeStyle=window.XeUtils.intRGBToHex(window.getXeActiveDocument().getXeGsDevice().getForeground());let r=0;var n=i.length,o=(e.ctx.beginPath(),e.m_XeViewport.PointToSCS(i[0]));for(e.ctx.moveTo(o[0],o[1]),r++;r<n;)o=e.m_XeViewport.PointToSCS(i[r]),e.ctx.lineTo(o[0],o[1]),r++;e.ctx.stroke()},GripPointTracker.prototype.start=function(e){if(this.m_XeEntityPreviews)for(var t in this.m_XeEntityPreviews)this.m_XeEntityPreviews[t]&&this.m_XeEntityPreviews[t].deallocate();this.m_XeEntityPreviews={}},GripPointTracker.prototype.end=function(e){if(this.m_XeEntityPreviews)for(var t in this.m_XeEntityPreviews)this.m_XeEntityPreviews[t]&&this.m_XeEntityPreviews[t].deallocate();this.m_XeEntityPreviews={}},GripPointTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview;return e.setSortingByDrawOrder(!1),e.setSortingByChunkOffsets(!1),e},GripPointTracker.prototype.drawTrackerGl=function(e,t){if(this.bOnlyGL){var i=window.XeActiveTrackers.TrackerData("CFxGripTracker");if(i){var r,n,o,a=e.getXeGsDevice().getXeDocument().getXeDatabase().getXeEntities();if(a&&e)for(var s in i)i[s]&&(r=a.getByHandle(s))&&(o=new GeNeo.OdGeMatrix3d(i[s].matrix),this.m_XeEntityPreviews[s]?n=this.m_XeEntityPreviews[s]:((n=this.createXeEntityPreview()).addXeEntity(r),this.m_XeEntityPreviews[s]=n),n)&&(n.setTransform(o),n.draw_gl(t,e))}}},function(){ClientSideTracker.call(this),this.drawOrder=15}),HighlightTracker=(GrVecsTracker.prototype=Object.create(ClientSideTracker.prototype),GrVecsTracker.prototype.constructor=GrVecsTracker,GrVecsTracker.prototype.drawTracker=function(e){window.XeActiveTrackers.TrackerData("CFxGrVecsTracker");return!0},function(){ClientSideTracker.call(this);function e(e){e=e.m_Item;e&&e.getOwner&&0<=e.getOwner()&&(t.m_bWaitUntilLastEntity=!0)}this.drawOrder=1,this.imageLocked=new XeImage("icons/layer_locked.png"),this.AnnotativeImage=new XeImage("qtresources/Misc_annotative.png"),this.setIsNeedToDrawCheck=function(e){t.m_bIsNeedToDrawCheck=e},this.getIsNeedToDrawCheck=function(){return t.m_bIsNeedToDrawCheck},this.getXeDrawDecoration=function(){return t.m_XeDrawDecoration},this.isBypassed=function(){return t.m_bWaitUntilLastEntity||t.m_bWaitUntilLastChunk},document.addEventListener("PreUpdate_XeGsGeometryChunks",e),document.addEventListener("Update_XeGsGeometryChunks",e),document.addEventListener("PreUpdate_XeEntities",e),document.addEventListener("Update_XeEntities",e),document.addEventListener("XeGsDevice_LastEntity",function(e){t.m_bWaitUntilLastEntity=!1}),document.addEventListener("XeGsDevice_LastChunk",function(e){t.m_bWaitUntilLastChunk=!1});var t={m_bIsNeedToDrawCheck:!0,m_bWaitUntilLastChunk:!1,m_bWaitUntilLastEntity:!1,m_XeDrawDecoration:new XeDrawDecoration};Object.defineProperty(this,"debug",{get:function(){if(window.__IsDebugMode)return t}})}),highlight_color=(HighlightTracker.prototype=Object.create(ClientSideTracker.prototype),HighlightTracker.prototype.constructor=HighlightTracker,HighlightTracker.prototype.isDrawnOnlyInActiveViewport=function(){return!1},HighlightTracker.prototype.drawTracker=function(e){var t,i=e.m_XeMyDocument,r=i.getXeGsDevice(),i=i.getXeDatabase().getXeEntities();if(i&&!this.m_bBypassHighlightTracker)return e.m_XeViewport.getActive()&&this.drawLock(e),e.m_XeViewport,i=e.ctx,e=r.getForeground(),r=window.XeUtils.intRGBToHex(e),e=i.strokeStyle,t=i.lineWidth,i.setLineDash([4,2]),i.strokeStyle=r,i.lineWidth=1,i.strokeStyle=e,i.lineWidth=t,i.setLineDash([]),!0},HighlightTracker.prototype.createXePreview=function(e,t,i,r,n,o,a){var s=this.getXeDrawDecoration().TYPE_ENUM,c=a.getXeDatabase(),a=a.getXeGsDevice(),l=c.getXeEntities(),c=a.getActiveViewport();let d=c?c.getRenderMode():XeGsViewport.prototype.RenderModeEnum.k2DOptimized;if(l){var u=new XeEntityPreview;if(t&&0<t.length){u.setSortingByDrawOrder(!1),e!==s.NoDecoration&&u.getXeDrawDecoration().setLWThick(2),u.getXeDrawDecoration().setType(e),u.getXeDrawDecoration().setColor(i),u.getXeDrawDecoration().setAlpha(r);for(let e=0;e<t.length;e++){var p=t[e],p=l.getByStringGiPath(p);p&&u.addXeEntity(p,!1,m)}}return u}function m(e,t){return!("AcDb3dSolid"===e.getClass()&&d>XeGsViewport.prototype.RenderModeEnum.kWireframe&&-1<t.getType().indexOf("LS"))}},HighlightTracker.prototype.setBypass=function(e){this.m_bBypassHighlightTracker=e},{alpha:1}),HyperlinkTracker=(HighlightTracker.prototype.drawTrackerGl=function(t,i){if(!this.m_bBypassHighlightTracker&&t){var r=t.getXeGsDevice().getXeDocument(),n=this.getXeDrawDecoration().TYPE_ENUM;let e=r.getXeInputPointManager().GetApertureSelection();var o,a=r.getXeSelectionSets().getItems();for(o in a){var s,c=a[o];if(0<e.length){var l,d,u=r.getXeDatabase().getXeGroupDictionary().getGroupsByIdArray(e).groupped;for(l in u)u[l]&&(d=u[l].getAllEntityIds(),e=e.concat(d));var p=window.XeUtils.hexToRgbArray(window.XeUtils.intRGBToHex(c.getDynamicColor()));this.createXePreview(n.Highlight,e,p,highlight_color.alpha,null,1,r).draw_gl(i,t)}if("WorkingSelectionSet"===o){if(c&&!c.IsEmpty()){if(!c.m_XePreview){var m=new XeEntityPreview,h=(m.setSortingByDrawOrder(!1),m.setSortingByChunkOffsets(!1),c.getHandles()),g=r.getXeDatabase().getXeEntities();for(let e=0;e<h.length;e++){var y=g.getByStringGiPath(h[e]);y&&m.addXeEntity(y,!1)}c.m_XePreview=m}c.m_XePreview&&(r.getXeGsDevice().setFadeMode(!1),c.m_XePreview.draw_gl(i,t),r.getXeGsDevice().setFadeMode(!0))}}else c.m_XePreview||0<c.getHandles().length&&(p=window.XeUtils.hexToRgbArray(window.XeUtils.intRGBToHex(c.getColor())),s=1==c.getType()?n.Highlight:n.SelectionSet,c.m_XePreview=this.createXePreview(s,c.getHandles(),p,c.getAlpha(),null,c.getThickness(),r)),c.m_XePreview&&c.m_XePreview.draw_gl(i,t)}var f,_=window.XeActiveTrackers.TrackerData("CFxHighlightTracker");_&&0<_.highlighted.length&&(f=window.XeUtils.hexToRgbArray(window.XeUtils.intRGBToHex(_.dynamicColor)),_.highlighted.xe_preview=this.createXePreview(n.SelectionSet,_.highlighted,f,highlight_color.alpha,void 0,void 0,r),_.highlighted.xe_preview)&&_.highlighted.xe_preview.draw_gl(i,t)}},HighlightTracker.prototype.drawLock=function(e){var t=e.m_XeMyDocument.getXeInputPointManager().GetApertureSelection(),i=e.m_XeMyDocument.getXeDatabase().getXeEntities();e.m_XeMyDocument.getXeDatabase().getXeLayers();t&&0<t.length&&(t=t[0],i=i.getByHandle(t))&&(t=e.m_XeMyDocument.getXeInputPointManager().getMousePosition(),"XeText"==i.m_ClassName&&"Annotative"==i.getTextStyle()&&this.AnnotativeImage.imageLoaded&&e.ctx.drawImage(this.AnnotativeImage.img,t.x-25,t.y-30,25,25),i=i.getLayerObject())&&i.getLocked()&&this.imageLocked.imageLoaded&&e.ctx.drawImage(this.imageLocked.img,t.x+10,t.y,25,25)},function(){ClientSideTracker.call(this);this.loadImage(),this.drawOrder=15}),LastPointTracker=(HyperlinkTracker.prototype=Object.create(ClientSideTracker.prototype),HyperlinkTracker.prototype.constructor=HyperlinkTracker,HyperlinkTracker.prototype.drawTracker=function(t){var i=t.ctx;if(i){var r=t.m_XeViewport.getXeGsDevice().getXeDocument().getXeInputPointManager();if(!r)return!1;var n=r.getMousePosition();if(!n)return!1;var o=window.getXeActiveDocument().getModelLayoutActive();let e=null;e=!0===o?window.getXeActiveDocument().getXeProfile().getGraphicsWinModelBackgrndColor():window.getXeActiveDocument().getXeProfile().getGraphicsWinLayoutBackgrndColor();var o=255-Math.abs(window.XeUtils.GetRValue(e)),a=255-Math.abs(window.XeUtils.GetGValue(e)),s=255-Math.abs(window.XeUtils.GetBValue(e)),o=(e=window.XeUtils.intRGBToHex((o<<16)+(a<<8)+s),r.GetApertureSelection()),a=window.getXeActiveDocument().getXeInputPointManager().getInsideCommand();0<o.length&&!a&&(s=t.m_XeMyDocument.getXeDatabase().getXeEntities(),r=o[0],a=s.getByHandle(r),t=Object.prototype.hasOwnProperty.call(a,"m_HyperLink"),"XeText"===a.m_ClassName)&&t&&a.getHyperLink()&&(i.drawImage(this.xeHPLinkIcon.img,n.x-5,n.y+12,25,25),i.font="12px Arial",i.fillStyle=e,i.fillText((window.getXeApplication().RequestLocalizedStringMap(),window.getXeApplication().GetLocalizedStringMap().HyperlinkTracker_FollowLink),n.x+15,n.y+18))}return!0},HyperlinkTracker.prototype.loadImage=function(){this.xeHPLinkIcon=new XeImage("qtresources/hyperlink.svg")},function(){ClientSideTracker.call(this),this.drawOrder=15}),NoteBorderTracker=(LastPointTracker.prototype=Object.create(ClientSideTracker.prototype),LastPointTracker.prototype.constructor=LastPointTracker,LastPointTracker.prototype.drawTracker=function(e){var t,i,r=window.XeActiveTrackers.TrackerData("CFxLastPointTracker");return!r||!r.vertex||(e.m_XeViewport?(r=e.m_XeViewport.PointToSCS(r.vertex),t=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),i=e.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(i),e.ctx.beginPath(),e.ctx.arc(r[0],r[1],2*t,0,2*Math.PI),e.ctx.moveTo(r[0]-t-t/2+.5,r[1]),e.ctx.lineTo(r[0]-t/2+.5,r[1]),e.ctx.moveTo(r[0]+t+t/2+.5,r[1]),e.ctx.lineTo(r[0]+t/2+.5,r[1]),e.ctx.moveTo(r[0],r[1]-t-t/2+.5),e.ctx.lineTo(r[0],r[1]-t/2+.5),e.ctx.moveTo(r[0],r[1]+t+t/2+.5),e.ctx.lineTo(r[0],r[1]+t/2+.5),e.ctx.stroke(),!0):void 0)},function(){ClientSideTracker.call(this);document.noteImeHandler||(document.noteImeHandler=new NoteIMEHandler),this.drawOrder=1,this.editorType=0,this.setAlwaysActiveOnPan(!0),this.end=function(){document.noteImeHandler.disableIME()}}),Rect=(NoteBorderTracker.prototype=Object.create(ClientSideTracker.prototype),NoteBorderTracker.prototype.constructor=NoteBorderTracker,NoteBorderTracker.prototype.start=function(e){},NoteBorderTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a,s=window.XeActiveTrackers.TrackerData("CFxNoteBorderTracker");s&&(null!=s.editorType&&(this.editorType=s.editorType),a=e.m_XeViewport,s.box)&&(t=s.box[0],i=new GeNeo.OdGePoint3d(t[0],t[1],t[2]),t=s.box[1],r=new GeNeo.OdGePoint3d(t[0],t[1],t[2]),t=s.box[2],n=new GeNeo.OdGePoint3d(t[0],t[1],t[2]),t=s.box[3],o=new GeNeo.OdGePoint3d(t[0],t[1],t[2]),t=s.box[4],s=new GeNeo.OdGePoint3d(t[0],t[1],t[2]),this._min=o,this._max=r,3!==this.editorType)&&(t=a.PointToSCS(i),i=a.PointToSCS(r),r=a.PointToSCS(n),n=a.PointToSCS(o),a.PointToSCS(s),o=e.ctx.strokeStyle,a=e.ctx.globalCompositeOperation,s=e.m_XeMyDocument.getXeGsDevice().getForeground(),3===this.editorType&&e.ctx.setLineDash([5,3]),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(s),e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(t[0],t[1]),e.ctx.lineTo(i[0],i[1]),e.ctx.lineTo(r[0],r[1]),e.ctx.lineTo(n[0],n[1]),e.ctx.lineTo(t[0],t[1]),e.ctx.stroke(),e.ctx.strokeStyle=o,e.ctx.globalCompositeOperation=a,document.noteImeHandler.updateIME(),3===this.editorType)&&e.ctx.setLineDash([])},NoteBorderTracker.prototype.IsPointNoteEditor=function(e){var t,i;return!(!this._min||!this._max)&&(t=this._min,i=this._max,e.x>t.x)&&e.y>t.y&&e.x<i.x&&e.y<i.y},function(){this.p1=new GeNeo.OdGeVector3d,this.p2=new GeNeo.OdGeVector3d,this.p3=new GeNeo.OdGeVector3d,this.p4=new GeNeo.OdGeVector3d,this.contains=function(e){var t=this.p4.sub(this.p1),i=this.p4.sub(this.p3),r=this.p2.sub(this.p3),n=this.p2.sub(this.p1);return 0<=t.dotProduct(e.sub(this.p1))&&0<=i.dotProduct(e.sub(this.p3))&&0<=r.dotProduct(e.sub(this.p3))&&0<=n.dotProduct(e.sub(this.p1))}}),NoteClientTracker=function(){ClientSideTracker.call(this);var t=this;t.isActive=function(){return t.actualWidth&&t.actualHeight&&!0};t.end=function(){var e=window.getXeActiveDocument().getXeGsDevice();e&&e.getPan()||t.deallocate()},t.deallocate=function(){t.pixelArea=null,t.editorpt=null,t.noteInit=null,t.editorType=null,t.editorAlign=null,t.actualWidth=null,t.actualHeight=null,t.editorHeight=null,t.dir=new GeNeo.OdGeVector3d(1,0,0),t.normal=new GeNeo.OdGeVector3d(0,0,1),t.makeWYSiWYG=!0,t.editorRotation=0,t.bVerticalSupport=!1,t.bNoColumn=!0,t.bIsClickedOnLBtn=!1,t.bIsClickedOnRBtn=!1,t.textheight=0,t.drawOrder=10,t.currentTabType=0,t.clickedOnIndent=!1,t.clickedOnLeftMargin=!1,t.clickedOnRightMargin=!1,t.indent=null,t.indentLeft=null,t.indentRight=null,t.tabsData=null,t.ucsYAxis=new GeNeo.OdGeVector3d(0,1,0),t.ucsXAxis=new GeNeo.OdGeVector3d(1,0,0),t.m_rectRuler=[],t.m_rectRuler[0]=new GeNeo.OdGePoint3d(0,0,0),t.m_rectRuler[1]=new GeNeo.OdGePoint3d(0,0,0),t.m_rectRuler[2]=new GeNeo.OdGePoint3d(0,0,0),t.m_rectRuler[3]=new GeNeo.OdGePoint3d(0,0,0),t.m_rectRuler[4]=new GeNeo.OdGePoint3d(0,0,0)},t.setAlwaysActiveOnPan(!0),t.deallocate()},NoteMarkerTracker=(NoteClientTracker.prototype=Object.create(ClientSideTracker.prototype),NoteClientTracker.prototype.constructor=NoteClientTracker,NoteClientTracker.prototype.drawTracker=function(e){this.drawSelection(e);var t=window.XeActiveTrackers.TrackerData("CFxNoteClientTracker");if(t)return void 0!==t.ucsYAxis&&this.ucsYAxis!==t.ucsYAxis&&(this.ucsYAxis=new GeNeo.OdGeVector3d(t.ucsYAxis)),void 0!==t.ucsXAxis&&this.ucsXAxis!==t.ucsXAxis&&(this.ucsXAxis=new GeNeo.OdGeVector3d(t.ucsXAxis)),void 0!==t.editorRotation&&this.editorRotation!==t.editorRotation&&(this.editorRotation=t.editorRotation),this.pixelArea=t.pixelarea,this.editorpt=t.editorpt,this.noteInit=t.noteInit,this.editorType=t.editorType,this.editorAlign=t.editorAlign,this.actualWidth=t.actualWidth,this.actualHeight=t.actualHeight,this.editorHeight=t.editorHeight,this.textheight=t.textheight,void 0!==t.indent&&this.indent!==t.indent&&(this.indent=t.indent),void 0!==t.indentLeft&&this.indentLeft!==t.indentLeft&&(this.indentLeft=t.indentLeft),void 0!==t.indentRight&&this.indentRight!==t.indentRight&&(this.indentRight=t.indentRight),this.dir=t.dir,void 0!==t.clickedOnIndent&&this.clickedOnIndent!==t.clickedOnIndent&&(this.clickedOnIndent=t.clickedOnIndent),void 0!==t.clickedOnLeftMargin&&this.clickedOnLeftMargin!==t.clickedOnLeftMargin&&(this.clickedOnLeftMargin=t.clickedOnLeftMargin),void 0!==t.clickedOnRightMargin&&this.clickedOnRightMargin!==t.clickedOnRightMargin&&(this.clickedOnRightMargin=t.clickedOnRightMargin),void 0!==t.tabsData&&this.tabsData!==t.tabsData&&(this.tabsData=t.tabsData),void 0!==t.currentTabType&&this.currentTabType!==t.currentTabType&&(this.currentTabType=t.currentTabType),null!==this.pixelArea&&null!==this.editorpt&&null!==this.editorAlign&&null!==this.actualWidth&&null!==this.actualHeight&&null!==this.editorHeight&&null!==this.dir&&(t.isRulerEnabled&&this.drawRulerContainer(e),this.highlightSpecialGlyphs(e)),!0},NoteClientTracker.prototype.highlightSpecialGlyphs=function(e){var t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y=window.XeActiveTrackers.TrackerData("CFxNoteClientTracker");y&&y.box&&(t=e.m_XeViewport,i=!1,c=y.box[0],l=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),c=y.box[1],d=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),c=y.box[2],g=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),c=y.box[3],r=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),4<y.box.length&&(i=!0,c=y.box[4],n=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),c=y.box[5],o=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),c=y.box[6],a=new GeNeo.OdGePoint3d(c[0],c[1],c[2]),c=y.box[7],s=new GeNeo.OdGePoint3d(c[0],c[1],c[2])),y=t.PointToSCS(l),c=t.PointToSCS(d),l=t.PointToSCS(g),d=t.PointToSCS(r),i&&(u=t.PointToSCS(n),p=t.PointToSCS(o),m=t.PointToSCS(a),h=t.PointToSCS(s)),g=e.m_XeMyDocument.getXeGsDevice().getForeground(),e.ctx.fillStyle="#4ECDC4",e.ctx.globalAlpha=.5,e.ctx.strokeStyle=window.XeUtils.intRGBToHex(g),e.ctx.lineWidth=1,e.ctx.beginPath(),e.ctx.moveTo(y[0],y[1]),e.ctx.lineTo(c[0],c[1]),e.ctx.lineTo(l[0],l[1]),e.ctx.lineTo(d[0],d[1]),e.ctx.lineTo(y[0],y[1]),e.ctx.closePath(),e.ctx.fill(),e.ctx.stroke(),i)&&(e.ctx.fillStyle="#b94d31",e.ctx.beginPath(),e.ctx.moveTo(u[0],u[1]),e.ctx.lineTo(p[0],p[1]),e.ctx.lineTo(m[0],m[1]),e.ctx.lineTo(h[0],h[1]),e.ctx.lineTo(u[0],u[1]),e.ctx.closePath(),e.ctx.fill(),e.ctx.stroke())},NoteClientTracker.prototype.drawSelection=function(e){var t=window.XeActiveTrackers.TrackerData("CFxNoteClientTracker");if(!t||!t.sel||!t.sel.hasSel)return!0;for(var i=t.sel.color,r=window.XeUtils.GetRValue(i),n=window.XeUtils.GetGValue(i),o=window.XeUtils.GetBValue(i),i=window.XeUtils.RGBtoRGBA(r,n,o).rgba,a=0;a<t.sel.rects.length/4;a++){var s=t.sel.rects.slice(4*a,4*a+4);this.drawPolygon(e,s,i)}},NoteClientTracker.prototype.IsPointNoteEditor=function(e){if(null!==this.noteInit&&!1!==this.noteInit&&!0===window.XeUtils.IsNoteCommand(window.getXeActiveDocument())&&this._containerRect){var t=this._containerRect,i=new Rect,t=(i.p1=new GeNeo.OdGeVector3d(t[0].x,t[0].y,0),i.p2=new GeNeo.OdGeVector3d(t[1].x,t[1].y,0),i.p3=new GeNeo.OdGeVector3d(t[2].x,t[2].y,0),i.p4=new GeNeo.OdGeVector3d(t[3].x,t[3].y,0),new GeNeo.OdGePoint3d(e[0],e[1],e[2]));if(!0===i.contains(t))return!0;e=clientSideTrackersHolder.CFxNoteBorderTracker;if(e&&!0===e.IsPointNoteEditor(t))return!0}return!1},NoteClientTracker.prototype.drawRulerContainer=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=this.pixelArea,r=this.editorpt;if(i&&r){var n,o,a,r=18/Math.max(i[0],i[1]),s=3/Math.max(i[0],i[1]),s=30/Math.max(i[0],i[1]),c=26/Math.max(i[0],i[1]),l=new GeNeo.OdGeVector3d(this.dir),d=new GeNeo.OdGePoint3d(this.editorpt),u=new GeNeo.OdGeVector3d(this.ucsYAxis),p=(new GeNeo.OdGeVector3d(this.ucsXAxis),this.editorAlign),m=(this.editorHeight,[]);if(7===p||8===p||9===p?(a=new GeNeo.OdGePoint3d(d.y),m[2]=a.sub(u.mult(c+s/3)),m[3]=m[2].sub(l.mult(this.actualWidth))):(4===p||5===p||6===p?(a=new GeNeo.OdGePoint3d(d.x),g=new GeNeo.OdGePoint3d(d.y),m[3]=a.add(u.mult(s/3)),m[2]=g.add(u.mult(s/3))):(a=new GeNeo.OdGePoint3d(d.x),m[3]=a.add(u.mult(s/3))),m[2]=m[3].add(l.mult(this.actualWidth))),m[0]=m[3].add(u.mult(c)),m[1]=m[0].add(l.mult(this.actualWidth)),m[4]=m[0],this._containerRect=m,null!==this.editorType&&3!==this.editorType&&0!==this.editorType){var h=window.XeUtils.rgbToHex(183,183,183),g=(this.drawPolygon(e,m,h),h=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,m,h),[]),y=(0!==this.actualWidth&&(s=5/Math.max(i[0],i[1]),3===p||6===p||9===p?(g[3]=m[2],g[2]=g[3].add(l.mult(c))):(g[2]=m[3],g[3]=g[2].sub(l.mult(c))),g[0]=g[4]=g[3].add(u.mult(c)),g[1]=g[2].add(u.mult(c)),h=window.XeUtils.rgbToHex(183,183,183),this.drawPolygon(e,g,h),h=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,g,h),h=window.XeUtils.rgbToHex(255,255,255),this.drawInvertRect(e,g,s,!1,h),this.drawTabsInParagraph(e,g)),[]),f=[];if(!1===this.bNoColumn)3===p||6===p||9===p?(y[2]=m[3],y[3]=y[2].sub(l.mult(c/2)),y[0]=y[4]=y[3].add(u.mult(c)),y[1]=y[2].add(u.mult(c)),h=window.XeUtils.rgbToHex(183,183,183),this.drawPolygon(e,y,h),this.drawDiamondRectEx(e,y)):(f[3]=m[2],f[2]=f[3].add(l.mult(c/2)),f[0]=f[4]=f[3].add(u.mult(c)),f[1]=f[2].add(u.mult(c)),h=window.XeUtils.rgbToHex(183,183,183),this.drawPolygon(e,y,h),this.drawDiamondRectEx(e,f));else if(3===p||6===p||9===p){for(y[2]=m[3],y[3]=y[2].sub(l.mult(c)),y[0]=y[4]=y[3].add(u.mult(c)),y[1]=y[2].add(u.mult(c)),h=window.XeUtils.rgbToHex(183,183,183),this.drawPolygon(e,y,h),this.drawDragRectEx(e,y,!1),n=0;n<4;n++)n,y[n];y=this.drawReduceRect(e,y,s,!1)}else{for(f[3]=m[2],f[2]=f[3].add(l.mult(c)),f[0]=f[4]=f[3].add(u.mult(c)),f[1]=f[2].add(u.mult(c)),h=window.XeUtils.rgbToHex(183,183,183),this.drawPolygon(e,f,h),this.drawDragRectEx(e,f,!1),n=0;n<4;n++)n,f[n];f=this.drawReduceRect(e,f,s,!1)}this.m_rectRuler[3]=m[3].add(u.mult((c-r)/2)),this.m_rectRuler[2]=this.m_rectRuler[3].add(l.mult(this.actualWidth)),this.m_rectRuler[0]=this.m_rectRuler[3].add(u.mult(r)),this.m_rectRuler[1]=this.m_rectRuler[0].add(l.mult(this.actualWidth)),this.m_rectRuler[4]=this.m_rectRuler[0],h=window.XeUtils.rgbToHex(255,255,255),this.drawPolygon(e,this.m_rectRuler,h),h=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,this.m_rectRuler,h);var _=4/Math.max(i[0],i[1]),w=10/Math.max(i[0],i[1]),h=window.XeUtils.rgbToHex(0,0,0),v=[],C=this.m_rectRuler[0].sub(u.mult(r/2));try{for(var T=new GeNeo.OdGePoint3d(i),b=(t.PointToSCS(T),0),X=0,S=0,P=null;b<=this.actualWidth;){a=C.add(l.mult(b));this.textheight;if(0===X||4===X)v[0]=a.add(u.mult(w/2)),v[1]=a.sub(u.mult(w/2)),o=v[0],X=0;else{v[0]=a.add(u.mult(_/2)),v[1]=a.sub(u.mult(_/2));var D=v[0];if(o.x===D.x)break}if(X++,1==S)if(P.distanceTo(v[0])<=this.textheight)break;if(this.drawLine(e,v[0],v[1],h,!1),P=v[0],1e3<++S)break;b+=this.textheight}}catch(e){}this.drawIndentButton(e,this.m_rectRuler,0),this.drawIndentButton(e,this.m_rectRuler,1),this.drawIndentButton(e,this.m_rectRuler,2),this.manageTabs(e,this.m_rectRuler)}}}},NoteClientTracker.prototype.drawDiamondRectEx=function(e,t){var i=t[0].distanceTo(t[1]),r=t[0].distanceTo(t[3]),n=null,o=new GeNeo.OdGeVector3d(this.dir),t=(n=(n=t[0].sub(this.ucsYAxis.mult(r/2))).add(o.mult(i/2)),null[0]=null[4]=n.sub(o.mult((i=2*i/3)/2)),null[2]=n.add(o.mult(i/2)),null[1]=n.add(this.ucsYAxis.mult(i/2)),null[3]=n.sub(this.ucsYAxis.mult(i/2)),window.XeUtils.rgbToHex(255,0,0));this.drawPolygon(e,null,t),t=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,null,t)},NoteClientTracker.prototype.drawLine=function(e,t,i,r,n){if(e.m_XeViewport){var o=e.m_XeViewport,e=e.ctx;e.save(),!0===n&&e.setLineDash([5,2]),e.lineWidth=1,e.strokeStyle=r;try{var a=o.PointToSCS(t),s=(e.moveTo(a[0],a[1]),o.PointToSCS(i));e.lineTo(s[0],s[1]),e.stroke()}catch(e){}!0===n&&e.setLineDash([]),e.restore()}},NoteClientTracker.prototype.drawPolygon=function(e,t,i){if(e.m_XeViewport){var r=e.m_XeViewport,n=e.ctx;n.save(),n.lineWidth=1;try{n.beginPath(),n.fillStyle=i;var o=t[0],a=r.PointToSCS(o);n.moveTo(a[0],a[1]);for(var s=1;s<t.length;s++){var c=t[s],a=r.PointToSCS(c);n.lineTo(a[0],a[1])}n.closePath(),n.fill()}catch(e){}n.restore()}},NoteClientTracker.prototype.drawBoundaryLines=function(e,t,i){if(e.m_XeViewport){var r=e.m_XeViewport,e=e.ctx;e.save(),e.lineWidth=1,e.strokeStyle=i;0,t[0],1,0;try{e.beginPath();var n=t[0],o=r.PointToSCS(n),a=(e.moveTo(o[0],o[1]),t[1]),s=r.PointToSCS(a);e.lineTo(s[0],s[1]),n=t[1],o=r.PointToSCS(n),e.moveTo(o[0],o[1]),a=t[2],s=r.PointToSCS(a),e.lineTo(s[0],s[1]),n=t[2],o=r.PointToSCS(n),e.moveTo(o[0],o[1]),a=t[3],s=r.PointToSCS(a),e.lineTo(s[0],s[1]),n=t[3],o=r.PointToSCS(n),e.moveTo(o[0],o[1]),a=t[4],s=r.PointToSCS(a),e.lineTo(s[0],s[1]),e.stroke()}catch(e){}e.restore()}},NoteClientTracker.prototype.drawTabsInParagraph=function(e,t){var i,r,n,o;e.m_XeViewport&&(r=e.m_XeViewport,Math.max(this.pixelArea[0],this.pixelArea[1]),!(i=null)===this.makeWYSiWYG&&(new GeNeo.OdGeVector3d(this.ucsXAxis),i=new GeNeo.OdGeVector3d(this.ucsYAxis),new GeNeo.OdGePoint3d(r.getUCSOrigin())),i=this.ucsYAxis,r=t[0].distanceTo(t[3]),n=t[0].distanceTo(t[1]),o=new GeNeo.OdGeVector3d(this.dir),t=(t=t[0].add(o.mult(n/2))).sub(i.mult(r/2)),o=[],0===this.currentTabType?this.drawTabsGeometry(e,t,0,o):1===this.currentTabType?this.drawTabsGeometry(e,t,1,o):2===this.currentTabType?this.drawTabsGeometry(e,t,2,o):this.drawTabsGeometry(e,t,3,o))},NoteClientTracker.prototype.drawTabsGeometry=function(e,t,i,r){var n=6/Math.max(this.pixelArea[0],this.pixelArea[1]),o=1/Math.max(this.pixelArea[0],this.pixelArea[1]),a=window.XeUtils.rgbToHex(0,0,0),s=[],c=[],l=new GeNeo.OdGeVector3d(this.dir);return s[0]=t.sub(l.mult(o/2)),s[1]=t.add(l.mult(o/2)),s[0]=s[0].add(this.ucsYAxis.mult(n/2)),s[1]=s[1].add(this.ucsYAxis.mult(n/2)),s[2]=s[1].sub(this.ucsYAxis.mult(n)),s[3]=s[0].sub(this.ucsYAxis.mult(n)),s[4]=s[0],this.drawPolygon(e,s,a),this.drawBoundaryLines(e,s,a),0===i?(c[0]=s[3],c[1]=s[2].add(l.mult(n)),c[2]=c[1].sub(this.ucsYAxis.mult(o)),c[3]=c[0].sub(this.ucsYAxis.mult(o)),c[4]=c[0],this.drawPolygon(e,c,a),this.drawBoundaryLines(e,c,a),r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=c[1],r[4]=c[2],r[5]=c[3],r[6]=s[0],r[7]=r[8]=s[0]):1===i?(c[0]=s[3].sub(l.mult(n/2-o/2)),c[1]=s[2].add(l.mult(n/2-o/2)),c[2]=c[1].sub(this.ucsYAxis.mult(o)),c[3]=c[0].sub(this.ucsYAxis.mult(o)),c[4]=c[0],this.drawPolygon(e,c,a),this.drawBoundaryLines(e,c,a),r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=c[1],r[4]=c[2],r[5]=c[3],r[6]=c[0],r[7]=s[3],r[8]=s[0]):2===i?(c[0]=s[3].sub(l.mult(n)),c[1]=s[2],c[2]=c[1].sub(this.ucsYAxis.mult(o)),c[3]=c[0].sub(this.ucsYAxis.mult(o)),c[4]=c[0],this.drawPolygon(e,c,a),this.drawBoundaryLines(e,c,a),r[0]=s[0],r[1]=s[1],r[2]=c[2],r[3]=c[3],r[4]=c[0],r[5]=s[3],r[6]=s[0],r[7]=r[8]=s[0]):(c[0]=s[3].sub(l.mult(n/2-o/2)),c[1]=s[2].add(l.mult(n/2-o/2)),c[2]=c[1].sub(this.ucsYAxis.mult(o)),c[3]=c[0].sub(this.ucsYAxis.mult(o)),c[4]=c[0],this.drawPolygon(e,c,a),this.drawBoundaryLines(e,c,a),r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=c[1],r[4]=c[2],r[5]=c[3],r[6]=c[0],r[7]=s[3],r[8]=s[0],o=2/Math.max(this.pixelArea[0],this.pixelArea[1]),(t=[])[0]=s[1].add(l.mult(1.5*o)),t[1]=t[0].add(l.mult(o)),t[2]=t[1].sub(this.ucsYAxis.mult(o)),t[3]=t[0].sub(this.ucsYAxis.mult(o)),t[4]=t[0],a=window.XeUtils.rgbToHex(0,0,0),this.drawPolygon(e,t,a),this.drawBoundaryLines(e,t,a)),r},NoteClientTracker.prototype.drawInvertRect=function(e,t,i,r,n){var o,a,s;e.m_XeViewport&&(s=e.m_XeViewport,o=[],!(a=null)===this.makeWYSiWYG&&(new GeNeo.OdGeVector3d(this.ucsXAxis),a=new GeNeo.OdGeVector3d(this.ucsYAxis),new GeNeo.OdGePoint3d(s.getUCSOrigin())),a=this.rotateVec(a,this.editorRotation+Math.PI/4,this.normal),!0===this.bVerticalSupport&&(a=this.rotateVec(a,Math.PI/2,this.normal)),s=!0===r?-1:1,o[0]=t[0].sub(a.mult(i).mult(s)),o[2]=t[2].add(a.mult(i).mult(s)),a=GeNeo.OdGeVector3d.kYAxis,this.makeWYSiWYG&&(a=new GeNeo.OdGeVector3d(this.ucsYAxis)),a=this.rotateVec(a,this.editorRotation+7*Math.PI/4,this.normal),this.bVerticalSupport&&(a=this.rotateVec(a,3*Math.PI/2,this.normal)),o[1]=t[1].sub(a.mult(i).mult(s)),o[3]=t[3].add(a.mult(i).mult(s)),o[4]=o[0],this.drawPolygon(e,o,n),n=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,o,n))},NoteClientTracker.prototype.rotateVec=function(e,t,i){return e.rotateBy(t,i)},NoteClientTracker.prototype.drawReduceRect=function(e,t,i,r){var n,o;if(e.m_XeViewport)return e=e.m_XeViewport,n=[],!(o=null)===this.makeWYSiWYG&&(new GeNeo.OdGeVector3d(this.ucsXAxis),o=new GeNeo.OdGeVector3d(this.ucsYAxis),new GeNeo.OdGePoint3d(e.getUCSOrigin())),o=this.rotateVec(o,this.editorRotation+Math.PI/4,this.normal),e=1,n[0]=t[0].sub(o.mult(i*(e=!0===r?-1:e))),n[2]=t[2].add(o.mult(i*e)),!0===this.makeWYSiWYG&&(o=new GeNeo.OdGeVector3d(this.ucsYAxis)),o=this.rotateVec(o,this.editorRotation+3*Math.PI/2+Math.PI/4,this.normal),n[1]=t[1].sub(o.mult(e*i)),n[3]=t[3].add(o.mult(e*i)),n[4]=n[0],t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t},NoteClientTracker.prototype.drawIndentButton=function(e,t,i){if(0!==this.actualWidth&&e.m_XeViewport){var r=e.m_XeViewport,n=new GeNeo.OdGeVector3d(this.dir),o=this.textheight,a=this.editorAlign,s=this.editorHeight,c=[],l=7/Math.max(this.pixelArea[0],this.pixelArea[1]),d=2/Math.max(this.pixelArea[0],this.pixelArea[1]),u=6/Math.max(this.pixelArea[0],this.pixelArea[1]),p=1/Math.max(this.pixelArea[0],this.pixelArea[1]),m=(Math.max(this.pixelArea[0],this.pixelArea[1]),GeNeo.OdGeVector3d.kXAxis),h=GeNeo.OdGeVector3d.kYAxis,r=(GeNeo.OdGePoint3d.kOrigin,!0===this.makeWYSiWYG&&(m=new GeNeo.OdGeVector3d(this.ucsXAxis),h=new GeNeo.OdGeVector3d(this.ucsYAxis),new GeNeo.OdGePoint3d(r.getUCSOrigin())),GeNeo.OdGeVector3d.kXAxis),h=((r=this.normal===new GeNeo.OdGeVector3d(0,0,-1)?this.rotateVec(r,Math.PI,this.normal):r).angleTo(m,this.normal),this.ucsYAxis),m=0===i?(y=(g=t[0].add(n.mult(this.indent*o))).sub(h.mult(l)),g.add(h.mult(d))):(y=(g=1===i?t[3].add(n.mult(this.indentLeft*o)):((r=(r=this.actualWidth-this.indentRight*o)<0?0:r)>this.actualWidth&&(r=this.actualWidth),t[3].add(n.mult(r)))).add(h.mult(l)),g.sub(h.mult(d))),t=(m=m.sub(n.mult(u/2))).add(n.mult(u)),r=[],g=(r[0]=y,r[1]=m,r[2]=t,r[3]=r[0],r[4]=r[0],[]),h=[],d=[];if(0===i){if(this.actualWidth<this.indent*o)return;g[0]=r[0],g[1]=r[1],g[2]=r[2],g[3]=r[3],h[0]=h[4]=g[1],h[1]=g[2],h[2]=g[2].sub(this.ucsYAxis.mult(l)),h[3]=g[1].sub(this.ucsYAxis.mult(l)),h=this.drawReduceRect(e,h,p,!0)}else if(1===i){if(this.actualWidth<this.indentLeft*o)return;u=[];u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3],d[0]=d[4]=u[1].add(this.ucsYAxis.mult(l)),d[1]=u[2].add(this.ucsYAxis.mult(l)),d[2]=u[2],d[3]=u[1],d=this.drawReduceRect(e,d,p,!0)}else{var y=[];y[0]=r[0],y[1]=r[1],y[2]=r[2],y[3]=r[3],c[0]=c[4]=y[1].add(this.ucsYAxis.mult(l)),c[1]=y[2].add(this.ucsYAxis.mult(l)),c[2]=y[2],c[3]=y[1],c=this.drawReduceRect(e,c,p,!0)}m=window.XeUtils.rgbToHex(128,128,128),this.drawPolygon(e,r,m),m=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,r,m);t=this.clickedOnIndent,g=this.clickedOnLeftMargin,h=this.clickedOnRightMargin;(t||g||h)&&(!(i=0)===t?i=this.indent*o:!0===g?i=this.indentLeft*o:!0===h&&(i=this.actualWidth-this.indentRight*o),u=!0,(d=[])[0]=this.m_rectRuler[3].add(n.mult(i)),7===a||8===a||9===a?(d[1]=d[0].add(this.ucsYAxis.mult(s)),u=!1):d[1]=d[0].sub(this.ucsYAxis.mult(s)),this.drawDottedLines(e,d,s,!0,u))}},NoteClientTracker.prototype.drawDragRectEx=function(e,t,i){var r,n,o,a,s,c,l,d,u,p;e.m_XeViewport&&(d=e.m_XeViewport,a=new GeNeo.OdGeVector3d(this.dir),o=this.pixelArea,r=7/Math.max(o[0],o[1]),n=2/Math.max(o[0],o[1]),o=6/Math.max(o[0],o[1]),l=this.normal,!(s=c=null)===this.makeWYSiWYG&&(c=new GeNeo.OdGeVector3d(this.ucsXAxis),s=new GeNeo.OdGeVector3d(this.ucsYAxis),new GeNeo.OdGePoint3d(d.getUCSOrigin()),s=this.rotateVec(s,this.editorRotation+Math.PI/4,this.normal)),d=GeNeo.OdGeVector3d.kXAxis.angleTo(c,l),s=GeNeo.OdGeVector3d.kYAxis,s=this.rotateVec(s,this.editorRotation+d,this.normal),c=(c=t[0].sub(this.ucsYAxis.mult(t[0].distanceTo(t[3])/2))).add(a.mult(t[0].distanceTo(t[1])/2)),l=a,d=this.ucsYAxis,i&&(l=this.ucsYAxis,d=a),i=(s=c.add(l.mult(n))).add(l.mult(r)),a=(s=s.add(d.mult(o/2))).sub(d.mult(o)),(u=[])[0]=i,u[1]=s,u[2]=a,u[3]=u[0],u[4]=u[0],p=window.XeUtils.rgbToHex(128,128,128),this.drawPolygon(e,u,p),p=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,u,p),i=(s=c.sub(l.mult(n))).sub(l.mult(r)),a=(s=s.add(d.mult(o/2))).sub(d.mult(o)),u[0]=i,u[1]=s,u[2]=a,u[3]=u[0],u[4]=u[0],p=window.XeUtils.rgbToHex(128,128,128),this.drawPolygon(e,u,p),p=window.XeUtils.rgbToHex(0,0,0),this.drawBoundaryLines(e,u,p),this.drawBoundaryLines(e,t,p))},NoteClientTracker.prototype.manageTabs=function(e,t){var i=this.tabsData;if(null!==i&&null!==i.tabsPos)for(var r=0;r<i.tabsPos.length;r++)this.drawTab(e,t,i.tabsPos[r],i.tabsType[r],[])},NoteClientTracker.prototype.drawTab=function(e,t,i,r,n){var o,a,s;Math.max(this.pixelArea[0],this.pixelArea[1]);e.m_XeViewport&&(o=e.m_XeViewport,GeNeo.OdGeVector3d.kXAxis,s=GeNeo.OdGeVector3d.kYAxis,!null===this.makeWYSiWYG&&(new GeNeo.OdGeVector3d(this.ucsXAxis),s=new GeNeo.OdGeVector3d(this.ucsYAxis),new GeNeo.OdGePoint3d(o.getUCSOrigin())),s=this.ucsYAxis,i=new GeNeo.OdGeVector3d(this.dir).mult(i),i=t[0].add(i),a=t[0].distanceTo(t[3]),i=i.sub(s.mult(a/2)),o.PointToSCS(i),(s=new Rect).p1=new GeNeo.OdGeVector3d(t[0].x,t[0].y,0),s.p2=new GeNeo.OdGeVector3d(t[1].x,t[1].y,0),s.p3=new GeNeo.OdGeVector3d(t[2].x,t[2].y,0),s.p4=new GeNeo.OdGeVector3d(t[3].x,t[3].y,0),!1!==s.contains(i))&&0!==this.actualWidth&&(0===r?this.drawTabsGeometry(e,i,0,n):1===r?this.drawTabsGeometry(e,i,1,n):2===r?this.drawTabsGeometry(e,i,2,n):this.drawTabsGeometry(e,i,3,n))},NoteClientTracker.prototype.drawDottedLines=function(e,t,i,r,n){var o=this.pixelArea,a=this.dir,s=5/Math.max(o[0],o[1]),c=3/Math.max(o[0],o[1]),l=[];if(e.m_XeViewport){var d=e.m_XeViewport,u=window.XeUtils.rgbToHex(0,0,0),p=1,m=(!1===n&&(p=-1,n=new GeNeo.OdGePoint3d(o),d.PointToSCS(n)),s+c);if(0!==m)for(var h=0;h<i/m;h++){if(l[0]=h?r?l[1].sub(this.ucsYAxis.mult(p*c)):l[1].add(a.mult(c)):t[0],l[0].distanceTo(t[1])<s){s=l[0].distanceTo(t[1]),l[1]=r?l[0].sub(this.ucsYAxis.mult(p*s)):l[0].add(a.mult(s)),this.drawLine(e,l[0],l[1],u,!0);break}l[1]=r?l[0].sub(this.ucsYAxis.mult(p*s)):l[0].add(a.mult(s)),this.drawLine(e,l[0],l[1],u,!0)}}},function(){ClientSideTracker.call(this);var t=this;t.drawOrder=1,t.m_bShowMarker=!0,t.start=function(e){t.timerId=setInterval(t.blinkFunction,1e3)},t.end=function(){t.timerId&&clearInterval(t.timerId)},t.blinkFunction=function(){var e=window.getXeActiveDocument().getXeGsDevice();e&&(t.m_bShowMarker=!t.m_bShowMarker,e.invalidateClientTrackers())},t.setAlwaysActiveOnPan(!0)}),CFxOrbitTracker=(NoteMarkerTracker.prototype=Object.create(ClientSideTracker.prototype),NoteMarkerTracker.prototype.constructor=NoteMarkerTracker,NoteMarkerTracker.prototype.drawMarker=function(e,t,i){if(!e.m_XeViewport)return!0;var r=e.m_XeViewport,n=r.PointToSCS(t.markerPoint_0),o=r.PointToSCS(t.markerPoint_1),a=r.PointToSCS(t.markerPoint_2),s=r.PointToSCS(t.markerPoint_3),c=r.PointToSCS(t.markerPoint_4),l=r.PointToSCS(t.markerPoint_5),t=t.markerPoint_4,r=(r.PointToSCS(t),null),t=(null!==document.noteImeHandler&&(r=document.noteImeHandler.factor()),e.m_XeMyDocument.getXeGsDevice().getForeground());e.ctx.strokeStyle=window.XeUtils.intRGBToHex(t),e.ctx.lineWidth=2,e.ctx.beginPath(),e.ctx.moveTo(n[0]+i+r,n[1]),e.ctx.lineTo(o[0]+i+r,o[1]),e.ctx.moveTo(a[0]+i+r,a[1]),e.ctx.lineTo(s[0]+i+r,s[1]),e.ctx.moveTo(c[0]+i+r,c[1]),e.ctx.lineTo(l[0]+i+r,l[1]),e.ctx.stroke()},NoteMarkerTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxNoteMarkerTracker");if(t){var i=t.bVisible;if(i&&document.noteImeHandler.drawCursor()){if(document.noteImeHandler){if(!e.m_XeViewport)return!0;var i=e.m_XeViewport,r=i.PointToSCS(t.markerPoint_0),i=i.PointToSCS(t.markerPoint_1),n=i[1],o=r[0],r=r[1]-i[1];document.noteImeHandler.setTopLeft(n,o,r)}!0===this.m_bShowMarker&&(i=document.noteImeHandler.getTextOffset(),this.drawMarker(e,t,i))}}return!0},function(){ClientSideTracker.call(this);var d,h=this,e=(this.m_isInContinousOrbit=!1,0),u=new GeNeo.OdGePoint3d,p=!1,m=(h.drawOrder=15,this.m_bDrawAsSystemCursor=!0,this.getTrackerName=function(){return"CFxOrbitTracker"},this.m_img_orbit1=new XeImage("icons/orbit1.png"),this.m_img_orbit2=new XeImage("icons/orbit2.png"),this.m_img_orbit3=new XeImage("icons/orbit3.png"),this.m_img_orbit4=new XeImage("icons/orbit4.png"),this.m_OrbitModeEnum={eNotInitialized:0,eVerticalRotation:1,eHorizontalRotation:2,eCircleRotation:3,eMainRotation:4,eFreeRotation:5,eContinuous:6},this.initImpl=function(e,t){e=e.extentsCenter,t=t.getXeGsDevice().getZoomPanViewport();d=0,m.init(t,new GeNeo.OdGeVector3d(e[0],e[1],e[2]))},this.processContinuousOrbit=function(){p=!0,e=setInterval(this.continuousOrbitLoop,1)},this.continuousOrbitLoop=function(){var e=new GeNeo.OdGePoint3d;0<u.x?e.x=d.x+1:u.x<0?e.x=d.x-1:e.x=d.x,0<u.y?e.y=d.y+1:u.x<0?e.y=d.y-1:e.y=d.y,m.update(e,d)},this.updateImpl=function(e,t,i,r,n,o,a,s,c){m.getOrbit();if(m.requestAnimationFrame(!1,c),m.getMode()===h.m_OrbitModeEnum.eNotInitialized&&(m.changeMode(e),d=e),h.m_isInContinousOrbit){if(!t)return;m.changeMode(e),u=new GeNeo.OdGePoint3d(e.x-d.x,e.y-d.y),p||h.processContinuousOrbit()}var l=getAndroidVersion();0==d&&(d=e),t||!l&&r?(m.changeMode(e),d=e):n&&(o||a)&&2<new GeNeo.OdGeVector2d(e.x-d.x,e.y-d.y).length()&&(m.update(e,d),d=e),(i||s)&&(m.applyViewChangesToDb(c),window.XeActiveTrackers.TrackerData("CFxOrbitTracker").isTransparent)&&h.cancelCmd(c),n&&!o&&(d=e)},this.getHelper=function(){return m},this.m_bIsValid=!1,new function(){var n,o,l,d,t=this,i=!1,a=new GeNeo.OdGePoint2d,s=new GeNeo.OdGePoint2d,c=new GeNeo.OdGePoint2d,u=new GeNeo.OdGePoint2d,p=new GeNeo.OdGePoint2d,m=h.m_OrbitModeEnum.eNotInitialized;this.init=function(e,t){var i=(l=e).getScreenRectLLC(),e=e.getScreenRectURC(),i={x:i[0],y:i[1]},e={x:e[0],y:e[1]},r=new GeNeo.OdGeExtents2d;r.addPoint(new GeNeo.OdGePoint2d(i.x,i.y)),r.addPoint(new GeNeo.OdGePoint2d(e.x,e.y)),this.recalculateDims(r),d=t},this.recalculateDims=function(e){var t=e.minPoint(),e=e.maxPoint(),i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),i=(n=Math.floor(Math.min(i,r)/2*.8),Math.floor(Math.min(i,r)/2*.1));o=10<(o=i<20?i:20)?o:10,a.x=(t.x+e.x)/2,a.y=(t.y+e.y)/2,s.x=a.x-n,s.y=a.y,c.x=a.x+n,c.y=a.y,u.x=a.x,u.y=a.y-n,p.x=a.x,p.y=a.y+n},this.centerPoint=function(){return a},this.leftPoint=function(){return s},this.rightPoint=function(){return c},this.topPoint=function(){return u},this.bottomPoint=function(){return p},this.bigRadius=function(){return n},this.smallRadius=function(){return o},this.changeMode=function(e){var t=window.XeActiveTrackers.TrackerData("CFxOrbitTracker").mode;m=t==h.m_OrbitModeEnum.eMainRotation||t==h.m_OrbitModeEnum.eFreeRotation||t==h.m_OrbitModeEnum.eContinuous?this.getOrbitModeByHitTest(e):t},this.update=function(e,t){switch(m){case h.m_OrbitModeEnum.eCircleRotation:i=-(this.angle(a,t)-this.angle(a,e)),this.doRoll(i);break;case h.m_OrbitModeEnum.eHorizontalRotation:i=(t.x-e.x)*Math.PI/n/2,this.doOrbit(0,i);break;case h.m_OrbitModeEnum.eVerticalRotation:i=(t.y-e.y)*Math.PI/n/2,this.doOrbit(i,0);break;case h.m_OrbitModeEnum.eFreeRotation:case h.m_OrbitModeEnum.eMainRotation:var i=(t.y-e.y)*Math.PI/n/2,r=(t.x-e.x)*Math.PI/n/2;this.doOrbit(i,r)}},this.getMode=function(){return m},this.getOrbit=function(){return i},this.setOrbit=function(e){i=e},this.requestAnimationFrame=function(e,t){(i=e)&&t.getXeGsDevice().invalidateViewports(),t.getXeGsDevice().setOrbit(e)},this.setView=function(e,t,i){l&&(l.preventServerNotify(!0),l.setTarget([e.x,e.y,e.z]),l.setPosition([t.x,t.y,t.z]),l.setUpVector([i.x,i.y,i.z]),l.setFieldWidth(l.getFieldWidth()),l.setFieldHeight(l.getFieldHeight()),l.preventServerNotify(!1),l.getXeGsDevice().invalidateScene())},this.doOrbit=function(e,t){var i,r,n,o,a,s,c;l&&(i=l.getXeGsDevice().getXeDocument(),r=new GeNeo.OdGeVector3d(l.getTarget()),n=new GeNeo.OdGeVector3d(l.getPosition()),o=new GeNeo.OdGeVector3d(l.getUpVector()).normalize(),(a=new GeNeo.OdGeVector3d).setToDiff(d,r),r.setToSum(r,a),n.setToSum(n,a),(s=new GeNeo.OdGeVector3d).setToDiff(n,r),(c=o.crossProduct(s)).normalize(),0!==e&&(s.rotateBy(e,c),o.rotateBy(e,c),a.rotateBy(e,c)),0!==t&&(s.rotateBy(t,o),a.rotateBy(t,o)),r.setToDiff(r,a),n.setToSum(r,s),this.setView(r,n,o),this.requestAnimationFrame(!0,i))},this.doRoll=function(e){var t,i,r,n,o,a;0!==e&&l&&(t=l.getXeGsDevice().getXeDocument(),i=new GeNeo.OdGeVector3d(l.getTarget()),r=new GeNeo.OdGeVector3d(l.getPosition()),n=new GeNeo.OdGeVector3d(l.getUpVector()),(o=new GeNeo.OdGeVector3d).setToDiff(d,i),i.setToSum(i,o),r.setToSum(r,o),(a=new GeNeo.OdGeVector3d).setToDiff(r,i),n.rotateBy(e,a),o.rotateBy(e,a),i.setToDiff(i,o),r.setToSum(i,a),this.setView(i,r,n),this.requestAnimationFrame(!0,t))},this.getOrbitModeByHitTest=function(e){return this.isPointInsideCircle(e,u,o)||this.isPointInsideCircle(e,p,o)?(h._orbitMode=h.m_OrbitModeEnum.eVerticalRotation,h.m_OrbitModeEnum.eVerticalRotation):this.isPointInsideCircle(e,s,o)||this.isPointInsideCircle(e,c,o)?(h._orbitMode=h.m_OrbitModeEnum.eHorizontalRotation,h.m_OrbitModeEnum.eHorizontalRotation):this.isPointInsideCircle(e,a,n)?(h._orbitMode=h.m_OrbitModeEnum.eMainRotation,h.m_OrbitModeEnum.eMainRotation):(h._orbitMode=h.m_OrbitModeEnum.eCircleRotation,h.m_OrbitModeEnum.eCircleRotation)},this.isPointInsideCircle=function(e,t,i){var r=0;return h.m_img_orbit1.imageLoaded?r=h.m_img_orbit1.img.height/2:h.m_img_orbit2.imageLoaded?r=h.m_img_orbit2.img.height/2:h.m_img_orbit3.imageLoaded?r=h.m_img_orbit3.img.height/2:h.m_img_orbit4.imageLoaded&&(r=h.m_img_orbit4.img.height/2),Math.pow(e.x+r-t.x,2)+Math.pow(e.y+r-t.y,2)<=Math.pow(i,2)},this.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},t.applyViewChangesToDb=function(e){l&&(e.CommandStart("CLIENT_SETVIEW"),l.commitToServer(),e.CommandEnd("CLIENT_SETVIEW"),t.m_applyViewChangesToDbDefferedTimeout&&clearTimeout(t.m_applyViewChangesToDbDefferedTimeout),t.m_applyViewChangesToDbDefferedTimeout=0)}}),i={x:-1,y:-1},t=null;this.getLastPosition=function(){return i},this.setLastPosition=function(e,t){i.x=e,i.y=t},this.getImgData=function(){return t},this.setImgData=function(e){t=e},this.invalidate=function(){i.x=-1,i.y=-1,t=null,this.m_bIsValid=!1,this.cmdCancelled=!1,this.m_isInContinousOrbit=!1,p=!1,clearInterval(e),e=0,this.getHelper().applyViewChangesToDb(this.m_XeDocument)}}),OsnapPointTracker=(CFxOrbitTracker.prototype=Object.create(ClientSideTracker.prototype),CFxOrbitTracker.prototype.constructor=CFxOrbitTracker,CFxOrbitTracker.prototype.transparent=!1,CFxOrbitTracker.prototype.cmdCancelled=!1,CFxOrbitTracker.prototype.putImgData=function(e){var t;return!(!e.ctx||this.getHelper().getOrbit()||!this.getImgData()||(t=this.getLastPosition(),e.ctx.putImageData(this.getImgData(),t.x,t.y),0))},CFxOrbitTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxOrbitTracker");!t||t.isTransparent||!e.m_XeMyDocument.getXeInputPointManager().getHitTestInfo().IsShiftPressed()&&t.mode!=this.m_OrbitModeEnum.eFreeRotation||(t=this.getHelper(),e.ctx.strokeStyle="green",e.lineWidth=4,e.ctx.beginPath(),e.ctx.arc(t.centerPoint().x,t.centerPoint().y,t.bigRadius(),0,2*Math.PI),e.ctx.stroke(),e.ctx.closePath(),e.ctx.beginPath(),e.ctx.arc(t.leftPoint().x,t.leftPoint().y,t.smallRadius(),0,2*Math.PI),e.ctx.stroke(),e.ctx.closePath(),e.ctx.beginPath(),e.ctx.arc(t.rightPoint().x,t.rightPoint().y,t.smallRadius(),0,2*Math.PI),e.ctx.stroke(),e.ctx.closePath(),e.ctx.beginPath(),e.ctx.arc(t.topPoint().x,t.topPoint().y,t.smallRadius(),0,2*Math.PI),e.ctx.stroke(),e.ctx.closePath(),e.ctx.beginPath(),e.ctx.arc(t.bottomPoint().x,t.bottomPoint().y,t.smallRadius(),0,2*Math.PI),e.ctx.stroke(),e.ctx.closePath())},CFxOrbitTracker.prototype.drawIcon=function(e,t){if(this.m_bDrawAsSystemCursor)return this.drawTrackerBySystemCursor(e,t);this.drawTrackerIntoCanvas(e,t)},CFxOrbitTracker.prototype.drawTrackerIntoCanvas=function(e,t){if(!e)return!1;if(!window.XeActiveTrackers.TrackerData("CFxOrbitTracker")||!t.ctx)return!1;e=e.getXeGsDevice().getXeDocument().getXeInputPointManager().getMousePosition();if(!e)return!1;var i=null;switch(this._orbitMode){case this.m_OrbitModeEnum.eNotInitialized:return!1;case this.m_OrbitModeEnum.eVerticalRotation:i=this.m_img_orbit3;break;case this.m_OrbitModeEnum.eHorizontalRotation:i=this.m_img_orbit2;break;case this.m_OrbitModeEnum.eCircleRotation:i=this.m_img_orbit1;break;case this.m_OrbitModeEnum.eMainRotation:i=this.m_img_orbit4}var r=Math.round(e.x),e=Math.round(e.y);return this.setLastPosition(r,e),i&&i.imageLoaded&&null!==r&&null!==e&&isFinite(r)&&isFinite(e)?(this.setImgData(t.ctx.getImageData(r,e,i.img.width,i.img.height)),t.ctx.drawImage(i.img,r,e)):this.setImgData(t.ctx.getImageData(r,e,64,64)),!0},CFxOrbitTracker.prototype.drawTrackerBySystemCursor=function(e,t){if(!e)return!1;if(!window.XeActiveTrackers.TrackerData("CFxOrbitTracker")||!t.ctx)return!1;var i=null;switch(this._orbitMode){case this.m_OrbitModeEnum.eNotInitialized:return!(t.currentCursorDrawPath="CFxOrbitTracker/OrbitModeEnum.eNotInitialized");case this.m_OrbitModeEnum.eVerticalRotation:i=this.m_img_orbit3,t.currentCursorDrawPath="CFxOrbitTracker/OrbitModeEnum.eVerticalRotation/"+i.imageLoaded;break;case this.m_OrbitModeEnum.eHorizontalRotation:i=this.m_img_orbit2,t.currentCursorDrawPath="CFxOrbitTracker/OrbitModeEnum.eHorizontalRotation/"+i.imageLoaded;break;case this.m_OrbitModeEnum.eCircleRotation:i=this.m_img_orbit1,t.currentCursorDrawPath="CFxOrbitTracker/OrbitModeEnum.eCircleRotation/"+i.imageLoaded;break;case this.m_OrbitModeEnum.eFreeRotation:case this.m_OrbitModeEnum.eContinuous:case this.m_OrbitModeEnum.eMainRotation:i=this.m_img_orbit4,t.currentCursorDrawPath="CFxOrbitTracker/OrbitModeEnum.eMainRotation/"+i.imageLoaded}t.canvas;e=t.ctx;return this.setLastPosition(0,0),!!(i&&i.imageLoaded&&isFinite(0)&&isFinite(0))&&(e.drawImage(i.img,0,0),!0)},CFxOrbitTracker.prototype.update=function(e,t){if(window.XeActiveTrackers.TrackerData(this.getTrackerName())){var i,r,n,o,a,s,c=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker");if(!c)if(!t.IsKeyboardEvent())return c=e.m_XeMyDocument,t=new GeNeo.OdGePoint2d,(c=c.getXeInputPointManager())&&(t.x=c.getHitTestInfo().GetMousePosition().x,t.y=c.getHitTestInfo().GetMousePosition().y),t.x=Math.floor(t.x),t.y=Math.floor(t.y),i=c.getHitTestInfo().IsLeftButtonDown()||c.getHitTestInfo().IsTouchStarted(),r=c.getHitTestInfo().IsLeftButtonUp()||c.getHitTestInfo().IsTouchEnded(),n=c.getHitTestInfo().IsMiddleButtonDown()||c.getHitTestInfo().IsTouchStarted(),o=c.getHitTestInfo().IsMouseMoved(),a=c.getHitTestInfo().IsMiddleButtonUp(),s=c.getHitTestInfo().IsMiddleMouseButtonPressed(),c=c.getHitTestInfo().IsLeftMouseButtonPressed(),this.updateImpl(t,i,r,n,o,c,s,a,e.m_XeMyDocument),!0}},CFxOrbitTracker.prototype.start=function(e){this.m_XeDocument=e,this.invalidate(),this.getHelper().setOrbit(!1),this._orbitMode=window.XeActiveTrackers.TrackerData("CFxOrbitTracker").mode,this._orbitMode==this.m_OrbitModeEnum.eContinuous&&(this.m_isInContinousOrbit=!0);var t=window.XeActiveTrackers.TrackerData(this.getTrackerName());t?(this.initImpl(t,e),this.m_bIsValid=!0,clientSideTrackersHolder.CFxHighlightTracker&&clientSideTrackersHolder.CFxHighlightTracker.setBypass(!0)):this.m_bIsValid=!1},CFxOrbitTracker.prototype.end=function(e){this.getHelper().setOrbit(!1);var t=e.getXeGsDevice(),e=(this.m_bIsValid&&t&&(t.invalidateViewports(),t.invalidateScene(),t.invalidateSelectionScene(),e.getXeInputPointManager().InvalidateApertureSelection(),t.setOrbit(!1)),clientSideTrackersHolder&&clientSideTrackersHolder.hasOwnProperty("CFxHighlightTracker")&&clientSideTrackersHolder.CFxHighlightTracker?clientSideTrackersHolder.CFxHighlightTracker:null);e&&e.setBypass(!1),this.invalidate()},CFxOrbitTracker.prototype.cancelCmd=function(e){var t=window.XeActiveTrackers.TrackerData("CFxOrbitTracker");t&&t.isTransparent&&!this.cmdCancelled&&(e.RunCmd("^C"),this.cmdCancelled=!0)},function(){ClientSideTracker.call(this),this.drawOrder=5}),OsnapTooltipTracker=(OsnapPointTracker.prototype=Object.create(ClientSideTracker.prototype),OsnapPointTracker.prototype.constructor=OsnapPointTracker,OsnapPointTracker.prototype.OsnapMode={kOsModeStart:-2,kOsModeUndefined:-1,kOsModeNone:0,kOsModeFirst:1,kOsModeEnd:1,kOsModeMid:2,kOsModeCen:3,kOsModeNode:4,kOsModeQuad:5,kOsModeIntersec:6,kOsModeIns:7,kOsModePerp:8,kOsModeTan:9,kOsModeNear:10,kOsModeGeoCen:11,kOsModeApint:12,kOsModeExt:13,kOsModePar:14,kOsModeDisabled:15,kOsModeCustom:16,kOsModeLast:16},OsnapPointTracker.prototype.convertToString=function(e){function t(e){return window.getXeApplication().RequestLocalizedStringMap(),window.getXeApplication().GetLocalizedStringMap()[e]}var i=OsnapPointTracker.prototype.OsnapMode;switch(e){case i.kOsModeEnd:return t("OsnapPointTracker_kOsModeEnd");case i.kOsModeMid:return t("OsnapPointTracker_kOsModeMid");case i.kOsModeCen:return t("OsnapPointTracker_kOsModeCen");case i.kOsModeGeoCen:return t("OsnapPointTracker_kOsModeGeoCen");case i.kOsModeNode:return t("OsnapPointTracker_kOsModeNode");case i.kOsModeQuad:return t("OsnapPointTracker_kOsModeQuad");case i.kOsModeIntersec:return t("OsnapPointTracker_kOsModeIntersec");case i.kOsModeIns:return t("OsnapPointTracker_kOsModeIns");case i.kOsModePerp:return t("OsnapPointTracker_kOsModePerp");case i.kOsModeTan:return t("OsnapPointTracker_kOsModeTan");case i.kOsModeNear:return t("OsnapPointTracker_kOsModeNear");case i.kOsModeApint:return t("OsnapPointTracker_kOsModeApint");case i.kOsModeExt:return t("OsnapPointTracker_kOsModeExt");case i.kOsModePar:return t("OsnapPointTracker_kOsModePar");case i.kOsModeNone:return t("OsnapPointTracker_kOsModeNone");default:return t("OsnapPointTracker_default")}},OsnapPointTracker.prototype.drawCenter=function(e,t){var i,r;t.m_XeViewport&&(r=t.m_XeViewport,i=t.m_XeMyDocument.getXeGsDevice().getForeground(),i=window.XeUtils.intRGBToHex(i),r=r.PointToSCS(e),t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(r[0]-6,r[1]),t.ctx.lineTo(r[0]+6,r[1]),t.ctx.moveTo(r[0],r[1]-6),t.ctx.lineTo(r[0],r[1]+6),t.ctx.stroke())},OsnapPointTracker.prototype.drawBox=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]-r),t.ctx.stroke()},OsnapPointTracker.prototype.drawTriangle=function(e,t,i){var r=2*t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0],e[1]-r/2+.5),t.ctx.lineTo(e[0]+r/2+.5,e[1]+r*Math.sqrt(3)/6+.5),t.ctx.lineTo(e[0]-r/2+.5,e[1]+r*Math.sqrt(3)/6+.5),t.ctx.lineTo(e[0],e[1]-r/2+.5),t.ctx.stroke()},OsnapPointTracker.prototype.drawCircle=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.arc(e[0],e[1],r,0,2*Math.PI),t.ctx.stroke()},OsnapPointTracker.prototype.drawCross=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.moveTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.stroke()},OsnapPointTracker.prototype.drawDiamond=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]),t.ctx.lineTo(e[0],e[1]+r),t.ctx.lineTo(e[0]+r,e[1]),t.ctx.lineTo(e[0],e[1]-r),t.ctx.lineTo(e[0]-r,e[1]),t.ctx.stroke()},OsnapPointTracker.prototype.drawInsertion=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE(),n=.25*r+.5;t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-n,e[1]+n),t.ctx.lineTo(e[0]-r,e[1]+n),t.ctx.lineTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]+n,e[1]-r),t.ctx.lineTo(e[0]+n,e[1]-n),t.ctx.lineTo(e[0]+r,e[1]-n),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.lineTo(e[0]-n,e[1]+r),t.ctx.lineTo(e[0]-n,e[1]+n),t.ctx.stroke()},OsnapPointTracker.prototype.drawPerpendicular=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.moveTo(e[0]-r,e[1]),t.ctx.lineTo(e[0],e[1]),t.ctx.lineTo(e[0],e[1]+r),t.ctx.stroke()},OsnapPointTracker.prototype.drawTangent=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.stroke()},OsnapPointTracker.prototype.drawParallel=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE(),n=.25*r+.5;t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-n),t.ctx.lineTo(e[0]+r,e[1]-2*n),t.ctx.moveTo(e[0]-r,e[1]+2*n),t.ctx.lineTo(e[0]+r,e[1]+n),t.ctx.stroke()},OsnapPointTracker.prototype.drawNearest=function(e,t,i){var r=t.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.moveTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.stroke()},OsnapPointTracker.prototype.drawNode=function(e,t,i){if(i.m_XeViewport){var r=i.m_XeViewport.PointToSCS(e),e=i.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),n=window.XeUtils.intRGBToHex(e);switch(t){case this.OsnapMode.kOsModeEnd:this.drawBox(r,i,n);break;case this.OsnapMode.kOsModeMid:this.drawTriangle(r,i,n);break;case this.OsnapMode.kOsModeCen:this.drawCircle(r,i,n);break;case this.OsnapMode.kOsModeGeoCen:this.drawCircle(r,i,n),this.drawCross(r,i,n);break;case this.OsnapMode.kOsModeNode:this.drawCross(r,i,n),this.drawCircle(r,i,n);break;case this.OsnapMode.kOsModeQuad:this.drawDiamond(r,i,n);break;case this.OsnapMode.kOsModeIntersec:this.drawCross(r,i,n);break;case this.OsnapMode.kOsModeIns:this.drawInsertion(r,i,n);break;case this.OsnapMode.kOsModePerp:this.drawPerpendicular(r,i,n);break;case this.OsnapMode.kOsModeTan:this.drawCircle(r,i,n),this.drawTangent(r,i,n);break;case this.OsnapMode.kOsModeNear:this.drawCross(r,i,n),this.drawNearest(r,i,n);break;case this.OsnapMode.kOsModeApint:this.drawBox(r,i,n),this.drawCross(r,i,n);break;case this.OsnapMode.kOsModePar:this.drawParallel(r,i,n);break;case this.OsnapMode.kOsModeExt:case this.OsnapMode.kOsModeNone:}}},OsnapPointTracker.prototype.drawTracker=function(i){var r=window.XeActiveTrackers.TrackerData("CFxOsnapPointTracker");if(r&&r.centers){let e,t;for(t=0;t<r.centers.length;t++)e=r.centers[t],this.drawCenter(e,i),r.mode==this.OsnapMode.kOsModeGeoCen&&this.drawGeoCenter(e,i);r.location&&this.drawNode(r.location,r.mode,i)}return!0},OsnapPointTracker.prototype.drawGeoCenter=function(e,t){var i,r;t.m_XeViewport&&(r=t.m_XeViewport,i=t.m_XeMyDocument.getXeGsDevice().getForeground(),i=window.XeUtils.intRGBToHex(i),r=r.PointToSCS(e),t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(r[0]-6,r[1]),t.ctx.lineTo(r[0]+6,r[1]),t.ctx.moveTo(r[0],r[1]-6),t.ctx.lineTo(r[0],r[1]+6),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.moveTo(r[0]-5,r[1]),t.ctx.lineTo(r[0]+5,r[1]),t.ctx.moveTo(r[0],r[1]-5),t.ctx.lineTo(r[0],r[1]+5),t.ctx.stroke())},function(){ClientSideTracker.call(this)}),OtrackPointTracker=(OsnapTooltipTracker.prototype=Object.create(ClientSideTracker.prototype),OsnapTooltipTracker.prototype.constructor=OsnapTooltipTracker,OsnapTooltipTracker.prototype.drawTracker=function(e){var t,i,r,n;e.m_XeViewport&&(r=e.m_XeViewport,(n=window.XeActiveTrackers.TrackerData("CFxOsnapPointTracker"))&&0<n.mode&&n.location?(i=r.PointToSCS(n.location),t=OsnapPointTracker.prototype.convertToString(n.mode,e.m_XeMyDocument)):(n=window.XeActiveTrackers.TrackerData("CFxDeferredTracker")||window.XeActiveTrackers.TrackerData("CFxCmdLineTracker"))&&0<n.type&&n.point&&(i=r.PointToSCS(n.point),t=DeferredTracker.prototype.convertToString(n.type)),t)&&i&&(r=e.ctx,i[0]=Math.round(i[0]),i[1]=Math.round(i[1]),n=e.m_XeMyDocument.getXeGsDevice().getForeground(),window.XeUtils.intRGBToHex(n),r.save(),r.strokeStyle="#ffffff",r.fillStyle="#000000",r.lineWidth=1,r.font="13px Arial",e=r.measureText(t).width,r.fillRect(i[0]+14-4,i[1]+14-4,e+8,24),r.strokeRect(i[0]+14-4,i[1]+14-4,e+8,24),r.fillStyle="#ffffff",r.fillText(t,i[0]+14,i[1]+13+14),r.restore())},function(){ClientSideTracker.call(this),this.drawOrder=5,this.OtrackType={eUndefined:-1,eOsnap:1,eInference:2,eBase:3}}),PanZoomTracker=(OtrackPointTracker.prototype=Object.create(ClientSideTracker.prototype),OtrackPointTracker.prototype.constructor=OtrackPointTracker,OtrackPointTracker.prototype.drawCross=function(e,t){var i=t.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor();t.ctx.strokeStyle=window.XeUtils.intRGBToHex(i),t.ctx.setLineDash([]),t.ctx.beginPath(),t.ctx.moveTo(e[0]-5,e[1]),t.ctx.lineTo(e[0]+5,e[1]),t.ctx.moveTo(e[0],e[1]+5),t.ctx.lineTo(e[0],e[1]-5),t.ctx.stroke()},OtrackPointTracker.prototype.drawIntersectCross=function(e,t){t.ctx.strokeStyle="#FF0000",t.ctx.setLineDash([]),t.ctx.beginPath(),t.ctx.moveTo(e[0]-5,e[1]-5),t.ctx.lineTo(e[0]+5,e[1]+5),t.ctx.moveTo(e[0]-5,e[1]+5),t.ctx.lineTo(e[0]+5,e[1]-5),t.ctx.stroke()},OtrackPointTracker.prototype.drawInfiniteLine=function(e,t,i,r,n){n.ctx.beginPath(),n.ctx.setLineDash([1,2]),this.OtrackType.eOsnap===e&&13===t&&n.ctx.setLineDash([5]);var t=this.getLineColor(n),o=r[0]-i[0],a=r[1]-i[1],s=Math.sqrt(Math.pow(Math.abs(o)+Math.abs(a),2)),c=n.m_XeMyDocument.getXeGsDevice(),c=c.getPixelWidth()+c.getPixelHeight();e!==this.OtrackType.eBase&&(i=[i[0]-c*o/s,i[1]-c*a/s]),r=[r[0]+c*o/s,r[1]+c*a/s],n.ctx.strokeStyle=t,n.ctx.moveTo(i[0],i[1]),n.ctx.lineTo(r[0],r[1]),n.ctx.stroke(),n.ctx.setLineDash([])},OtrackPointTracker.prototype.getLineColor=function(e){return window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground())},OtrackPointTracker.prototype.drawLine=function(e,t,i,r,n){n.ctx.beginPath(),n.ctx.setLineDash([1,2]),this.OtrackType.eOsnap===e&&t===window.XeUtils.CFxOsnapPoint.kOsModeExt&&n.ctx.setLineDash([5]);e=this.getLineColor(n);n.ctx.strokeStyle=e,n.ctx.moveTo(i[0],i[1]),n.ctx.lineTo(r[0],r[1]),n.ctx.stroke(),n.ctx.setLineDash([])},OtrackPointTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t,i,r,n,o,a=e.m_XeViewport,s=window.XeActiveTrackers.TrackerData("CFxOtrackPointTracker");if(s){if(s.basepoints)for(i=0;i<s.basepoints.length;i++)t=s.basepoints[i].location,t=a.PointToSCS(t),this.drawCross(t,e);s.snappoint&&(t=s.snappoint.location,t=a.PointToSCS(t),this.drawIntersectCross(t,e)),s.line1&&(r=s.line1.point1,n=s.line1.point2,t=a.PointToSCS(r),o=a.PointToSCS(n),s.line1.infinite?this.drawInfiniteLine(s.line1.type,s.line1.basepointmode,t,o,e):this.drawLine(s.line1.type,s.line1.basepointmode,t,o,e)),s.line2&&(r=s.line2.point1,n=s.line2.point2,t=a.PointToSCS(r),o=a.PointToSCS(n),s.line2.infinite?this.drawInfiniteLine(s.line2.type,s.line2.basepointmode,t,o,e):this.drawLine(s.line2.type,s.line2.basepointmode,t,o,e))}return!0}},function(){ClientSideCursorTrackerBase.call(this),this.drawOrder=5,this.isActive=!1,this.imageHand1=new XeImage("icons/hand1.png"),this.imageHand2=new XeImage("icons/hand2.png"),this.imageDZoom=new XeImage("icons/dzoom.png"),this.m_bDrawAsSystemCursor=!0}),PickCursor=(PanZoomTracker.prototype=Object.create(ClientSideCursorTrackerBase.prototype),PanZoomTracker.prototype.constructor=PanZoomTracker,PanZoomTracker.prototype.TrackerType={eNone:-1,ePan:0,eZoom:1,eZoomWindow:2},PanZoomTracker.prototype.drawZoom=function(e){let t=e.ctx,i=!1;return this.imageDZoom.imageLoaded&&(t.drawImage(this.imageDZoom.img,this.x,this.y),this.setCanvasClassName("interactive_none"),i=!0),i},PanZoomTracker.prototype.drawPan=function(e,t){let i=e.ctx,r=!1;return t?this.imageHand2.imageLoaded&&(i.drawImage(this.imageHand2.img,this.x,this.y),r=!0):this.imageHand1.imageLoaded&&(i.drawImage(this.imageHand1.img,this.x,this.y),r=!0),r&&this.setCanvasClassName("interactive_none"),r},PanZoomTracker.prototype.drawZoomWindow=function(e,t){var i=e.ctx;if(e.m_XeViewport){var r=e.m_XeViewport,n=r.PointToSCS(t.start),r=r.PointToSCS(t.end),o=[];o.push(n),o.push([n[0],r[1]]),o.push([r[0],r[1]]),o.push([r[0],n[1]]),o.push(n),i.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),i.beginPath(),i.setLineDash([]);for(var a=0;a<4;a++)i.moveTo(o[a][0],o[a][1]),i.lineTo(o[a+1][0],o[a+1][1]);i.stroke()}},PanZoomTracker.prototype.getDrawType=function(e){var t=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker");if(t&&e){e=e.m_XeMyDocument.getXeInputPointManager();if(t){if(0!==t.zoomwindow)return this.TrackerType.eZoomWindow;switch(t.trackertype){case this.TrackerType.ePan:if(this.m_bIsTouchEvent)break;return this.TrackerType.ePan;case this.TrackerType.eZoom:return this.TrackerType.eZoom}}else if(e.getHitTestInfo().IsMiddleMouseButtonPressed())return this.TrackerType.ePan}return this.TrackerType.eNone},PanZoomTracker.prototype.update=function(e,t){this.m_bIsTouchEvent=t.IsTouchEvent(),!t.IsMouseEvent()&&!this.m_bIsTouchEvent||this.m_bDrawAsSystemCursor||(this.x=t.GetMousePosition().x,this.y=t.GetMousePosition().y),t.IsTouchStarted()&&(this.isActive=!0),t.IsTouchEnded()&&(this.isActive=!1),this.m_bPanHandActive=t.IsLeftMouseButtonPressed()||t.IsMiddleMouseButtonPressed()||t.IsRightMouseButtonPressed(),this.m_Type=this.getDrawType(e)},PanZoomTracker.prototype.getImgDataWH=function(){var e=null;switch(this.m_Type){case this.TrackerType.ePan:this.m_bPanHandActive?this.imageHand2.imageLoaded&&(e=this.imageHand2.img):this.imageHand1.imageLoaded&&(e=this.imageHand1.img);break;case this.TrackerType.eZoom:this.imageHand1.imageLoaded&&(e=this.imageDZoom.img);break;case this.TrackerType.eZoomWindow:}return e?{w:2*e.width,h:2*e.height}:null},PanZoomTracker.prototype.drawIcon=function(e,t){if(this.m_bDrawAsSystemCursor)return this.drawTrackerBySystemCursor(e,t);this.drawTrackerIntoCanvas(e,t)},PanZoomTracker.prototype.drawTrackerIntoCanvas=function(e,t){var i=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker");if(i&&t){var r=this.getDrawType(t),n=t.ctx,o=this.x,a=this.y,s=(this.setLastXY(this.x,this.y),this.getImgDataWH());switch(s&&null!==o&&null!==a&&isFinite(o)&&isFinite(a)&&this.setUnderCursorImgData(n.getImageData(o-s.w/2,a-s.h/2,s.w,s.h)),r){case this.TrackerType.ePan:return this.drawPan(t,this.m_bPanHandActive),!0;case this.TrackerType.eZoom:return this.drawZoom(t),!0;case this.TrackerType.eZoomWindow:return this.drawZoomWindow(t,i),!0}}return!1},PanZoomTracker.prototype.drawTrackerBySystemCursor=function(e,t){var i=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker");if(i&&t){var r=this.getDrawType(t),n=t.canvas;switch(this.setLastXY(Math.round(n.width/2),Math.round(n.height/2)),this.x=0,this.y=0,r){case this.TrackerType.ePan:var o=this.drawPan(t,this.m_bPanHandActive);return t.currentCursorDrawPath="PanZoomTracker/TrackerType.ePan/"+(this.m_bPanHandActive?"true":"false"),o;case this.TrackerType.eZoom:o=this.drawZoom(t);return t.currentCursorDrawPath="PanZoomTracker/TrackerType.eZoom",o;case this.TrackerType.eZoomWindow:return this.drawZoomWindow(t,i),!0}}return!1},PanZoomTracker.prototype.IsActive=function(){return this.isActive},function(){ClientSideCursorTrackerBase.call(this),this.drawOrder=100}),PolyLineVertexTracker=(PickCursor.prototype=Object.create(ClientSideCursorTrackerBase.prototype),PickCursor.prototype.constructor=PickCursor,PickCursor.prototype.getImgDataWH=function(){return{w:0,h:0}},PickCursor.prototype.drawTracker=function(e){return!0},function(){ClientSideTracker.call(this),this.drawOrder=100}),PowerTrimTracker=(PolyLineVertexTracker.prototype=Object.create(ClientSideTracker.prototype),PolyLineVertexTracker.prototype.constructor=PolyLineVertexTracker,PolyLineVertexTracker.prototype.drawTracker=function(e){var t,i;if(e.m_XeViewport)return t=e.m_XeViewport,(i=window.XeActiveTrackers.TrackerData("CFxPolyLineVertexTracker"))&&i.vertex&&(t=t.PointToSCS(i.vertex),i=2+e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath(),e.ctx.moveTo(t[0]-i,t[1]-i),e.ctx.lineTo(t[0]+i,t[1]+i),e.ctx.moveTo(t[0]-i,t[1]+i),e.ctx.lineTo(t[0]+i,t[1]-i),e.ctx.stroke()),!0},function(){ClientSideTracker.call(this),this.drawOrder=100}),RectTracker=(PowerTrimTracker.prototype=Object.create(ClientSideTracker.prototype),PowerTrimTracker.prototype.constructor=PowerTrimTracker,PowerTrimTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("CFxPowerTrimTracker");if(!i||!i.ptArray)return!0;var r=e.ctx,n=i.ptArray,o=t.PointToSCS(n[0]);if(null!==o){r.strokeStyle;r.setLineDash([1,2]);var a,i=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground());for(r.strokeStyle=i,r.beginPath(),r.moveTo(o[0],o[1]),a=1;a<n.length;a++)o=t.PointToSCS(n[a]),r.lineTo(o[0],o[1]);return r.stroke(),!0}}},function(){ClientSideTracker.call(this),this.drawOrder=100}),CFxSelectionSetTransformTracker=(RectTracker.prototype=Object.create(ClientSideTracker.prototype),RectTracker.prototype.constructor=RectTracker,RectTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("CFxRectTracker");if(i&&i.basepoint){var r=e.m_XeMyDocument.getXeGsDevice().getActiveViewport(),n=e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint(),o=[0,0],r=(r.PointToSCSFast(o,n[0],n[1],n[2]),this.x=o[0],this.y=o[1],t.PointToSCS(i.basepoint)),a=[];a.push(r),a.push([r[0],this.y]),a.push([this.x,this.y]),a.push([this.x,r[1]]),a.push(r),e.ctx.setLineDash([]),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath();for(var s=0;s<5;s++)e.ctx.moveTo(a[s%5][0],a[s%5][1]),e.ctx.lineTo(a[(s+1)%5][0],a[(s+1)%5][1]);e.ctx.stroke()}return!0}},function(){ClientSideTracker.call(this);this.drawOrder=10,this.getTrackerName=function(){return null},this.setXeEntityPreview=function(e){t=e},this.getXeEntityPreview=function(){return t};var t=new XeEntityPreview}),CFxSelectionSetTranslateTracker=(CFxSelectionSetTransformTracker.prototype=Object.create(ClientSideTracker.prototype),CFxSelectionSetTransformTracker.prototype.constructor=CFxSelectionSetTransformTracker,CFxSelectionSetTransformTracker.prototype.start=function(e){var t=this.getXeEntityPreview(),t=(t&&t.deallocate(),t=void 0,window.XeActiveTrackers.TrackerData(this.getTrackerName()));t&&this.setIdArray(t.ids,e)},CFxSelectionSetTransformTracker.prototype.end=function(e){var t=this.getXeEntityPreview();t&&t.deallocate(),t=void 0,this.setXeEntityPreview(new XeEntityPreview)},CFxSelectionSetTransformTracker.prototype.setIdArray=function(e,t){var i=t.getXeDatabase().getXeEntities(),r=this.createXeEntityPreview();if(e&&e.length){for(var n=0;n<e.length;n++){var o=i.getByHandle(e[n]);r.addXeEntity(o,"AcDbHatch"!==o.getClass())}this.setXeEntityPreview(r)}},CFxSelectionSetTransformTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview,t=(e.getXeDrawDecoration().setLWThick(0),e.getXeDrawDecoration().TYPE_ENUM.SelectionSet);return e.getXeDrawDecoration().setType(t),e},CFxSelectionSetTransformTracker.prototype.drawTracker=function(e){},CFxSelectionSetTransformTracker.prototype.drawTrackerGl=function(e,t){var i,r=window.XeActiveTrackers.TrackerData(this.getTrackerName());r&&r.basePoint&&e&&(r=r.basePoint,i=e.getXeGsDevice().getXeDocument().getXeInputPointManager().getSpecificRubberPoint(),i=new GeNeo.OdGePoint3d(i[0]-r[0],i[1]-r[1],i[2]-r[2]),(r=new GeNeo.OdGeMatrix3d).setToTranslation(i),(i=this.getXeEntityPreview()).setTransform(r),i.draw_gl(t,e))},function(){CFxSelectionSetTransformTracker.call(this),this.getTrackerName=function(){return"CFxSelectionSetTranslateTracker"}}),WaitCursor=(CFxSelectionSetTranslateTracker.prototype=Object.create(CFxSelectionSetTransformTracker.prototype),CFxSelectionSetTranslateTracker.prototype.constructor=CFxSelectionSetTranslateTracker,function(){ClientSideTracker.call(this);var i=new Spinner({lines:13,length:24,width:12,radius:40,corners:1,rotate:0,direction:1,color:"#000",speed:1.2,trail:59,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"});this.drawTracker=function(e){return!0},this.end=function(){i.stop()},this.start=function(e){var t=$("#xeMainFrame")[0];i.spin(t)}}),SplineEditVertexTracker=(WaitCursor.prototype=Object.create(ClientSideTracker.prototype),WaitCursor.prototype.constructor=WaitCursor,function(){ClientSideTracker.call(this)}),SplineEditFitpointTracker=(SplineEditVertexTracker.prototype=Object.create(ClientSideTracker.prototype),SplineEditVertexTracker.prototype.constructor=SplineEditVertexTracker,SplineEditVertexTracker.prototype.drawTracker=function(e){var t;if(e.m_XeViewport)return!(t=window.XeActiveTrackers.TrackerData("CFxSplineEditVertexTracker"))||void(0<t.CVPointArray.length&&this.drawPolyLineOnCV(e,t))},SplineEditVertexTracker.prototype.drawPolyLineOnCV=function(e,t){var i=t.CVPointArray,r=t.CurrentVertex,n=e.ctx,o=(n.setLineDash([3]),n.lineWidth=1,n.strokeStyle=window.XeUtils.intRGBToHex(window.getXeActiveDocument().getXeGsDevice().getForeground()),0),a=i.length,s=(n.beginPath(),e.m_XeViewport.PointToSCS(i[0]));for(n.moveTo(s[0],s[1]),o++;o<a;)s=e.m_XeViewport.PointToSCS(i[o]),n.lineTo(s[0],s[1]),o++;n.stroke();for(var t=window.getXeActiveDocument().getXeDatabase().getGRIPCOLOR(),c=window.XeUtils.intRGBToHex(t),t=window.getXeActiveDocument().getXeDatabase().getGRIPHOT(),l=window.XeUtils.intRGBToHex(t),d=0;d<a;d++)s=e.m_XeViewport.PointToSCS(i[d]),d===r?this.drawCVPoints(n,s[0],s[1],l):this.drawCVPoints(n,s[0],s[1],c)},SplineEditVertexTracker.prototype.drawCVPoints=function(e,t,i,r){e.strokeStyle=r,e.fillStyle=r,e.beginPath(),e.moveTo(t,i),e.ellipse(t,i,5,5,0,0,2*Math.PI),e.fill(),e.stroke()},function(){ClientSideTracker.call(this)}),SplineEditKinkTracker=(SplineEditFitpointTracker.prototype=Object.create(ClientSideTracker.prototype),SplineEditFitpointTracker.prototype.constructor=SplineEditFitpointTracker,SplineEditFitpointTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=window.XeActiveTrackers.TrackerData("CFxSplineEditFitpointTracker");if(!t)return!0;for(var i=window.getXeActiveDocument(),r=t.FitPointArray,n=t.CurrentFitpoint,o=e.ctx,t=i.getXeDatabase().getGRIPCOLOR(),a=window.XeUtils.intRGBToHex(t),t=i.getXeDatabase().getGRIPHOT(),s=window.XeUtils.intRGBToHex(t),c=window.XeUtils.intRGBToHex(i.getXeGsDevice().getForeground()),l=i.getXeDatabase().getGRIPSIZE(),d=0,u=r.length;d<u;){var p=e.m_XeViewport.PointToSCS(r[d]);d===n?this.drawGrip(o,p[0],p[1],l,s,c):this.drawGrip(o,p[0],p[1],l,a,c),d++}}},SplineEditFitpointTracker.prototype.drawGrip=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.moveTo(t-r,i-r),e.lineTo(t-r,i+r),e.lineTo(t+r,i+r),e.lineTo(t+r,i-r),e.lineTo(t-r,i-r),e.fill(),e.stroke()},function(){ClientSideTracker.call(this)}),TableEditTrackerBase=(SplineEditKinkTracker.prototype=Object.create(ClientSideTracker.prototype),SplineEditKinkTracker.prototype.constructor=SplineEditKinkTracker,SplineEditKinkTracker.prototype.drawTracker=function(e){var t;if(e.m_XeViewport)return!(t=window.XeActiveTrackers.TrackerData("CFxSplineEditKinkTracker"))||void(t.PointOnCurve&&t.bInit&&this.drawKinkMarker(e,t))},SplineEditKinkTracker.prototype.drawKinkMarker=function(e,t){var i=e.ctx,t=t.PointOnCurve,r=window.getXeActiveDocument().getXeDatabase().getGRIPSIZE(),n=(r*=2,window.XeUtils.intRGBToHex(window.getXeActiveDocument().getXeGsDevice().getForeground())),e=e.m_XeViewport.PointToSCS(t);i.strokeStyle=n,i.beginPath(),i.moveTo(e[0]-r,e[1]-r),i.lineTo(e[0]+r,e[1]+r),i.moveTo(e[0]+r,e[1]-r),i.lineTo(e[0]-r,e[1]+r),i.stroke()},function(){ClientSideTracker.call(this),this.drawOrder=9;this.cellExtents=null,this.id=null}),Tripod=(TableEditTrackerBase.prototype=Object.create(ClientSideTracker.prototype),TableEditTrackerBase.prototype.constructor=TableEditTrackerBase,TableEditTrackerBase.prototype.start=function(e){},TableEditTrackerBase.prototype.end=function(e){this.cellExtents=null,this.id=null,this.isTableActive=null},TableEditTrackerBase.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("TableEditTracker");return t&&(this.cellExtents=t.cellExt,this.isTableActive=t.isTableActive||!1,this.id=t.id),!0},TableEditTrackerBase.prototype.getHandle=function(){return this.id},TableEditTrackerBase.prototype.GetTableEditType=function(e){return this.cellExtents?!0===this.isTableActive?1:!1===this.isTableActive&&2:0},function(){ClientSideTracker.call(this);this.drawOrder=100,this.setAlwaysActiveOnPan(!0)}),CenterLine=(Tripod.prototype=Object.create(ClientSideTracker.prototype),Tripod.prototype.constructor=Tripod,Tripod.prototype.getAxisSize=function(e){var t=e.ctx;t.canvas.width,t.canvas.height;if(e.m_XeViewport)return t=e.m_XeViewport.getViewportDc(),e=Math.abs(t.ymax-t.ymin),t=Math.abs(t.xmax-t.xmin),~~(.12*Math.min(t,e))},Tripod.prototype.getBoxSize=function(e){return~~(.15*this.getAxisSize(e))},Tripod.prototype.getModelSpaceColor=function(e){return e.m_XeMyDocument.getXeGsDevice().getForeground()},Tripod.prototype.getPaperSpaceColor=function(e){return 255<<16},Tripod.prototype.isTripodInUCSOrigin=function(e){return e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getUCSIconAtOrigin()},Tripod.prototype.isVisible=function(e){return e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getUCSIconVisible()},Tripod.prototype.getLowerLeftPoint=function(e,t,i){if(i=i||50,e.m_XeViewport)return e=e.m_XeViewport.getViewportDc(),t=t?e.ymax:e.ymin,new GeNeo.OdGePoint2d(e.xmin+1.1*i,t-1.1*i,0)},Tripod.prototype.drawTracker=function(e){return this.isVisible(e)&&(!e.m_XeMyDocument.getModelLayoutActive()&&e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getOverall()?this.drawPaperSpaceType(e):this.drawModelSpaceType(e)),!0},Tripod.prototype.getUCSOriginVisible=function(e){if(e.m_XeViewport){var t,i,r=e.m_XeViewport,n=r.getUCSOrigin(),o=[0,0],n=(r.PointToSCSFast(o,n[0],n[1],n[2]),r.visibleScreenRect());if(n)return r=Math.floor(n.xmin),e=e.m_XeMyDocument.getXeGsDevice().getPixelHeight()-Math.floor(n.ymin)-Math.floor(n.ymax-n.ymin),t=Math.floor(n.xmax-n.xmin),n=Math.floor(n.ymax-n.ymin),i=o[1],r<(o=o[0])&&o<r+t&&e<i&&i<e+n}},Tripod.prototype.drawModelSpaceType=function(e){var t=e.ctx;if(e.m_XeViewport){var i=e.m_XeViewport,r=this.getModelSpaceColor(e),r=window.XeUtils.intRGBToHex(r),r=(t.strokeStyle=r,t.setLineDash([]),new GeNeo.OdGePoint3d(e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getUCSOrigin())),n=new GeNeo.OdGeVector3d(i.getUCSxDir()),o=new GeNeo.OdGeVector3d(i.getUCSyDir()),a=n.crossProduct(o),s=new GeNeo.OdGeMatrix3d(i.getUCSMatrix());if(s=s.inverse()){var s=s.isEqualTo(GeNeo.OdGeMatrix3d.kIdentity),c=i.PointToSCS(r),r=new GeNeo.OdGePoint3d(c[0],c[1],0),c=i.getWorldToEyeTransform(),i=new GeNeo.OdGeMatrix3d,i=(i.setentry(1,1,-1),i.setentry(1,3,1),i.mult(c)),c=(i.det(),n.transformBy(i),o.transformBy(i),a.transformBy(i),Math.sqrt(n.lengthSqrd()+o.lengthSqrd()+a.lengthSqrd())/Math.sqrt(3)),i=(n.mult(1/c),o.mult(1/c),a.mult(1/c),this.getBoxSize(e)),c=this.getAxisSize(e),l=this.getUCSOriginVisible(e);if(void 0===l)return!0;var d,u,e=(r=this.isTripodInUCSOrigin(e)&&l?r:this.getLowerLeftPoint(e,!(l=!1),c)).add(n.mult(c)),p=r.add(o.mult(c)),c=r.add(a.mult(c)),m=(n.isParallelTo(GeNeo.OdGeVector3d.kZAxis)||(m=e.add(n.mult(i)),this.drawXLetter(t,m,i),this.drawArrow(t,e,n,i)),o.isParallelTo(GeNeo.OdGeVector3d.kZAxis)||(m=p.add(o.mult(i)),this.drawYLetter(t,m,i),this.drawArrow(t,p,o,i)),a.isParallelTo(GeNeo.OdGeVector3d.kZAxis)||(m=c.add(a.mult(i)),this.drawZLetter(t,m,i),this.drawArrow(t,c,a,i)),r.add(n.mult(.5*i))),a=r.add(o.mult(.5*i));t.beginPath(),t.moveTo(m.x,m.y),t.lineTo(e.x,e.y),t.moveTo(a.x,a.y),t.lineTo(p.x,p.y),t.stroke(),new GeNeo.OdGeVector2d(c.x-r.x,c.y-r.y).isZeroLength()||(t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(c.x,c.y),t.stroke()),s&&(d=r.sub(n.mult(.5*i)).add(o.mult(.5*i)),u=r.add(n.mult(.5*i)).add(o.mult(.5*i)),m=r.add(n.mult(.5*i)).sub(o.mult(.5*i)),e=r.sub(n.mult(.5*i)).sub(o.mult(.5*i)),t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(u.x,u.y),t.lineTo(m.x,m.y),t.lineTo(e.x,e.y),t.lineTo(d.x,d.y),t.stroke()),l&&(d=r.sub(n.mult(.5*i)),u=r.add(n.mult(.5*i)),t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(u.x,u.y),d=r.sub(o.mult(.5*i)),u=r.add(o.mult(.5*i)),t.moveTo(d.x,d.y),t.lineTo(u.x,u.y),t.stroke())}}},Tripod.prototype.looksAtTheSameSide=function(e,t){return 0<e.dotProduct(t)},Tripod.prototype.drawPaperSpaceType=function(e){var t=e.ctx;if(e.m_XeViewport){var i=e.m_XeViewport,r=this.getPaperSpaceColor(e),r=window.XeUtils.intRGBToHex(r),r=(t.strokeStyle=r,t.setLineDash([]),new GeNeo.OdGePoint3d(e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getUCSOrigin())),n=new GeNeo.OdGeVector3d(i.getUCSxDir()),o=new GeNeo.OdGeVector3d(i.getUCSyDir()),a=n.crossProduct(o),s=new GeNeo.OdGeMatrix3d(i.getUCSMatrix());if(s=s.inverse()){var s=s.isEqualTo(GeNeo.OdGeMatrix3d.kIdentity),c=i.PointToSCS(r),r=new GeNeo.OdGePoint3d(c[0],c[1],0),c=i.getWorldToEyeTransform(),i=new GeNeo.OdGeMatrix3d,i=(i.setentry(1,1,-1),i.setentry(1,3,1),i.mult(c)),c=(i.setentry(2,2,1),i.det(),n.transformBy(i),o.transformBy(i),a.transformBy(i),this.getBoxSize(e)),i=this.getAxisSize(e),l=this.isTripodInUCSOrigin(e);if(void 0===(l=l&&e.m_XeMyDocument.getXeGsDevice().getActiveViewport().getUCSOriginVisible()))return!0;var l=(r=l?r:this.getLowerLeftPoint(e,!0)).add(n.mult(i/2)),e=r.add(o.mult(i));r.add(a.mult(i));t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(l.x,l.y),t.lineTo(e.x,e.y),t.lineTo(r.x,r.y),t.stroke(),n.isParallelTo(GeNeo.OdGeVector3d.kZAxis)||(a=r.add(n.mult(2*c).add(o.mult(.5*c))),this.drawXLetter(t,a,c)),o.isParallelTo(GeNeo.OdGeVector3d.kZAxis)||(i=r.add(n.mult(.5*c).add(o.mult(3*c))),this.drawYLetter(t,i,c)),s&&(e=(l=r).add(n.mult(c)).add(o.mult(c)),t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(e.x,l.y),t.lineTo(e.x,e.y),t.lineTo(l.x,e.y),t.lineTo(l.x,l.y),t.stroke())}}},Tripod.prototype.drawArrow=function(e,t,i,r){var n=(n=i.mult(-1)).rotateBy(Math.PI/6,GeNeo.OdGeVector3d.kZAxis),o=t.add(n.mult(r)),a=t,i=(n=(n=i.mult(-1)).rotateBy(-Math.PI/6,GeNeo.OdGeVector3d.kZAxis),t.add(n.mult(r)));e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke()},Tripod.prototype.drawXLetter=function(e,t,i){i*=1.35,e.beginPath(),e.moveTo(t.x-i/2+1,t.y-i/2),e.lineTo(t.x+i/2-1,t.y+i/2),e.moveTo(t.x-i/2+1,t.y+i/2),e.lineTo(t.x+i/2-1,t.y-i/2),e.stroke()},Tripod.prototype.drawYLetter=function(e,t,i){i*=1.35,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+i/2-1,t.y-i/2),e.moveTo(t.x,t.y),e.lineTo(t.x-i/2+1,t.y-i/2),e.moveTo(t.x,t.y),e.lineTo(t.x,t.y+i/2),e.stroke()},Tripod.prototype.drawZLetter=function(e,t,i){i*=1.35,e.beginPath(),e.moveTo(t.x-i/2+1,t.y-i/2),e.lineTo(t.x+i/2-1,t.y-i/2),e.lineTo(t.x-i/2-1,t.y+i/2),e.lineTo(t.x+i/2-1,t.y+i/2),e.stroke()},function(){ClientSideLineTracker.call(this),this.drawOrder=5,this.trackerName="CFxCenterLineTracker"}),UserIOCloudLineTracker=(CenterLine.prototype=Object.create(ClientSideLineTracker.prototype),CenterLine.prototype.constructor=CenterLine,function(){ClientSideTracker.call(this),this.pnts=[],this.tmppnts=[]}),UserIOExtendedIntersectionTracker=(UserIOCloudLineTracker.prototype=Object.create(ClientSideTracker.prototype),UserIOCloudLineTracker.prototype.constructor=UserIOCloudLineTracker,UserIOCloudLineTracker.prototype.drawLines=function(e,t,i,r,n){if(e.m_XeViewport){var o=e.m_XeViewport,a=e.ctx,s=o.PointToSCS(this.pnts[0]);if(null!==s){var c,e=a.strokeStyle;for(a.setLineDash(n),a.strokeStyle=r,a.beginPath(),a.moveTo(s[0],s[1]),c=1;c<this.pnts.length;c++)s=o.PointToSCS(this.pnts[c]),a.lineTo(s[0],s[1]);if(a.stroke(),0<this.tmppnts.length)for(a.beginPath(),a.strokeStyle=r,s=o.PointToSCS(this.pnts[this.pnts.length-1]),a.moveTo(s[0],s[1]),c=0;c<this.tmppnts.length;c++)s=o.PointToSCS(this.tmppnts[c]),a.lineTo(s[0],s[1]);a.lineTo(t,i),a.stroke(),a.setLineDash([]),a.strokeStyle=e}}},UserIOCloudLineTracker.prototype.drawTracker=function(e){var t,i,r=window.XeActiveTrackers.TrackerData("CFxUserIOCloudLineTracker");return r&&(i=e.m_XeMyDocument.getXeGsDevice().getActiveViewport(),t=e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint(),i.PointToSCSFast(i=[0,0],t[0],t[1],t[2]),this.x=i[0],this.y=i[1],r.hide||(t=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),0!==this.pnts.length&&this.pnts[this.pnts.length-1][0]===r.basepnt[0]&&this.pnts[this.pnts.length-1][1]===r.basepnt[1]||(this.pnts.push(r.basepnt),this.tmppnts=[]),e.m_XeMyDocument.getXeInputPointManager().getHitTestInfo().IsMiddleMouseButtonDown()&&(i=e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint(),this.tmppnts.push(i)),i=[],r.dash&&(i=[1,2]),this.drawLines(e,this.x,this.y,t,i))),!0},UserIOCloudLineTracker.prototype.end=function(e){this.pnts=[],this.tmppnts=[]},UserIOCloudLineTracker.prototype.start=function(e){this.pnts=[],this.tmppnts=[]},function(){ClientSideTracker.call(this)}),UserIOLineTracker=(UserIOExtendedIntersectionTracker.prototype=Object.create(ClientSideTracker.prototype),UserIOExtendedIntersectionTracker.prototype.constructor=UserIOExtendedIntersectionTracker,UserIOExtendedIntersectionTracker.prototype.drawTracker=function(e){window.XeActiveTrackers.TrackerData("CFxUserIOExtendedIntersectionTracker");return!0},function(){ClientSideTracker.call(this),this.pnts=[],this.tmppnts=[]}),UserIOMirrorLineTracker=(UserIOLineTracker.prototype=Object.create(ClientSideTracker.prototype),UserIOLineTracker.prototype.constructor=UserIOLineTracker,UserIOLineTracker.prototype.drawLines=function(e,t,i,r,n){if(e.m_XeViewport){var o,a=e.m_XeViewport,s=e.ctx,c=a.PointToSCS(this.pnts[0]),e=s.strokeStyle;for(s.setLineDash(n),s.strokeStyle=r,s.beginPath(),s.moveTo(c[0],c[1]),o=1;o<this.pnts.length;o++)c=a.PointToSCS(this.pnts[o]),s.lineTo(c[0],c[1]);if(s.stroke(),0<this.tmppnts.length)for(s.beginPath(),s.strokeStyle=r,c=a.PointToSCS(this.pnts[this.pnts.length-1]),s.moveTo(c[0],c[1]),o=0;o<this.tmppnts.length;o++)c=a.PointToSCS(this.tmppnts[o]),s.lineTo(c[0],c[1]);s.lineTo(t,i),s.stroke(),s.setLineDash([]),s.strokeStyle=e}},UserIOLineTracker.prototype.drawTracker=function(e){var t,i,r,n=window.XeActiveTrackers.TrackerData("CFxUserIOLineTracker");return!n||!!n.hide||(e.m_XeViewport?(t=e.m_XeViewport,r=e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint(),t.PointToSCSFast(t=[0,0],r[0],r[1],r[2]),i=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),!0===n.init&&(this.pnts=[]),0!==this.pnts.length&&this.pnts[this.pnts.length-1][0]===n.basepnt[0]&&this.pnts[this.pnts.length-1][1]===n.basepnt[1]||(this.pnts.push(n.basepnt),this.tmppnts=[]),e.m_XeMyDocument.getXeInputPointManager().getHitTestInfo().IsMiddleMouseButtonDown()&&this.tmppnts.push(r),r=[],n.dash&&(r=[1,2]),this.drawLines(e,t[0],t[1],i,r),!0):void 0)},UserIOLineTracker.prototype.end=function(e){this.pnts=[],this.tmppnts=[]},UserIOLineTracker.prototype.start=function(e){this.pnts=[],this.tmppnts=[]},function(){ClientSideLineTracker.call(this),this.drawOrder=5,this.trackerName="CFxMirrowLineTracker"}),VertexTracker=(UserIOMirrorLineTracker.prototype=Object.create(ClientSideLineTracker.prototype),UserIOMirrorLineTracker.prototype.constructor=UserIOMirrorLineTracker,function(){ClientSideTracker.call(this),this.drawOrder=100}),ViewportBorderLineTracker=(VertexTracker.prototype=Object.create(ClientSideTracker.prototype),VertexTracker.prototype.constructor=VertexTracker,VertexTracker.prototype.drawTracker=function(e){var t,i;if(e.m_XeViewport)return t=e.m_XeViewport,(i=window.XeActiveTrackers.TrackerData("CFxVertexTracker"))&&i.vertex&&(t=t.PointToSCS(i.vertex),i=2+e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath(),e.ctx.moveTo(t[0]-i,t[1]-i),e.ctx.lineTo(t[0]+i,t[1]+i),e.ctx.moveTo(t[0]-i,t[1]+i),e.ctx.lineTo(t[0]+i,t[1]-i),e.ctx.stroke()),!0},function(){ClientSideTracker.call(this),this.drawOrder=100,this.setAlwaysActiveOnPan(!0)}),ViewportFrameTracker=(ViewportBorderLineTracker.prototype=Object.create(ClientSideTracker.prototype),ViewportBorderLineTracker.prototype.constructor=ViewportBorderLineTracker,ViewportBorderLineTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport;if(e.ctx){var i,r=e.ctx,n=e.m_XeMyDocument.getXeGsDevice(),o=n.getPixelHeight(),a=(n.getPixelWidth(),n.getXeGsViewports()),s=n.getOverallViewport(),c=0;for(i in a)a.getByVpnum(i)&&c++;if(1<c&&!t.getOverall()){r.globalAlpha=1;var l,d,u,p,n=e.m_XeMyDocument.getXeGsDevice().getForeground();if(e.ctx.strokeStyle=window.XeUtils.intRGBToHex(n),!s)for(i in a){var m=a.getByVpnum(i);!m||m.getVpNum()===t.getVpNum()||m.getOverall()||(l=m.getVisibleScreenRect_m_min_x(),d=m.getVisibleScreenRect_m_max_y(),u=m.getVisiblePxWidth(),p=m.getVisiblePxHeight(),r.lineWidth=1,r.beginPath(),r.rect(l+1,d+1,u-1,p-1),r.stroke())}if(s){var h=t.getViewportExternalRegionInOverallWCS();if(!h)return;if(2<h.length){r.lineWidth=3,r.beginPath();var g=[0,0];s.PointToSCSFast(g,h[0][0],h[0][1],h[0][2]),r.moveTo(Math.floor(g[0]),g[1]);for(var y=1;y<h.length;y++)s.PointToSCSFast(g,h[y][0],h[y][1],h[y][2]),r.lineTo(Math.floor(g[0]),g[1]);r.stroke()}}else{e=t.visibleScreenRect();e&&(l=Math.floor(e.xmin),d=o-Math.floor(e.ymin)-Math.floor(e.ymax-e.ymin),u=Math.floor(e.xmax-e.xmin),p=Math.floor(e.ymax-e.ymin),r.lineWidth=3,r.beginPath(),r.rect(l+1,d+1,u-1,p-1),r.stroke())}}return!0}}},function(){ClientSideTracker.call(this)}),image_side=(ViewportFrameTracker.prototype=Object.create(ClientSideTracker.prototype),ViewportFrameTracker.prototype.constructor=ViewportFrameTracker,ViewportFrameTracker.prototype.drawTracker=function(e){window.XeActiveTrackers.TrackerData("CFxViewportFrameTracker");return!0},32),XeCursorDrawer=function(){this.m_Resources={};let t=this.m_Resources;t.canvas={},this.cached_cursors={},t.canvas.element=document.createElement("canvas"),t.canvas.context=t.canvas.element.getContext("2d"),t.canvas.element.width=image_side,t.canvas.element.height=image_side,this.curSNAPMODE=!1,t.canvas.clear=function(){t.canvas.context.clearRect(0,0,t.canvas.element.width,t.canvas.element.height)},t.canvas.make_url=function(){var e=XeCursorDrawer.prototype.create_CCS3_CursorOffests(image_side);return'url("'+t.canvas.element.toDataURL()+'") '+e.x+" "+e.y+", auto"}},TwoPointCircleTracker=(XeCursorDrawer.prototype.create_CCS3_CursorOffests=function(e){var t=window.GetXeDevicePixelRatio();let i=1,r=1;return XeCursorDrawer.prototype.CCS3_CheckSupport.detected&&XeCursorDrawer.prototype.CCS3_CheckSupport.detected.firefox&&(i=t,r=t),{x:Math.floor(e/2*i),y:Math.floor(e/2*r)}},XeCursorDrawer.prototype.bDrawAsSystemCursor=!0,XeCursorDrawer.prototype.CCS3_CheckSupport=function(){return!!window.XeUtils&&(XeCursorDrawer.prototype.CCS3_CheckSupport.detected||(XeCursorDrawer.prototype.CCS3_CheckSupport.detected={},"Firefox"===window.XeUtils.UserAgentDetector.browser&&(XeCursorDrawer.prototype.CCS3_CheckSupport.detected.firefox=!0),"Mac OS X"===window.XeUtils.UserAgentDetector.os&&(XeCursorDrawer.prototype.CCS3_CheckSupport.detected.macosx=!0),"Linux"===window.XeUtils.UserAgentDetector.os&&(XeCursorDrawer.prototype.CCS3_CheckSupport.detected.linux=!0),"Microsoft Internet Explorer"!==window.XeUtils.UserAgentDetector.browser&&"Microsoft Edge"!==window.XeUtils.UserAgentDetector.browser)||(XeCursorDrawer.prototype.CCS3_CheckSupport.detected.ie=!0),!XeCursorDrawer.prototype.CCS3_CheckSupport.detected.linux)&&!XeCursorDrawer.prototype.CCS3_CheckSupport.detected.ie},XeCursorDrawer.prototype.setCanvasClassName=function(e,t){e.className!==t&&(e.className=t)},XeCursorDrawer.prototype.setCanvasCursorStyle=function(e,t){e.style.cursor!==t&&(e.style.cursor="",e.style.cursor=t)},XeCursorDrawer.prototype.resetCursor=function(e){e&&(this.setCanvasCursorStyle(e,""),this.setCanvasClassName(e,"interactive_arrow"))},XeCursorDrawer.prototype.draw=function(e,t){var i=XeCursorDrawer.prototype.bDrawAsSystemCursor&&XeCursorDrawer.prototype.CCS3_CheckSupport();this.__draw(e,t,i)},XeCursorDrawer.prototype.__draw=function(r,n,o){let a=this;var s=r.m_XeMyDocument;s.getXeGsDevice().getPixelHeight();if(r.m_XeViewport=r.m_XeViewport||r.m_XeMyDocument.getXeGsDevice().getActiveViewport(),r.m_XeViewport){var c=r.m_XeViewport.visibleScreenRect();if(c){Math.floor(c.xmin),Math.floor(c.ymin),Math.floor(c.ymax-c.ymin),Math.floor(c.xmax-c.xmin),Math.floor(c.ymax-c.ymin);var c=r.m_XeMyDocument.getXeInputPointManager(),l=c.getHitTestInfo().GetMousePosition(),l=(l.x,c.getInputPointManager().isMouseOut());let t=r.canvas;var e=r.ctx;o&&(r.currentCursorDrawPath="",this.m_Resources.canvas.clear(),r.canvas=this.m_Resources.canvas.element,r.ctx=this.m_Resources.canvas.context);let i=!1;var d=clientSideTrackersHolder.XeCursorTracker,u=clientSideTrackersHolder.CFxPanZoomTracker,p=clientSideTrackersHolder.CFxOrbitTracker;if(o||this.setCanvasClassName(t,"interactive_none"),r.ctx||(r.ctx=r.canvas.getContext("2d")),r.ctx){if(r.ctx.save(),p&&p.m_bIsValid&&window.XeActiveTrackers.IsTrackerActive("CFxOrbitTracker")&&((p.m_bDrawAsSystemCursor=o)?c.getHitTestInfo().IsMiddleMouseButtonPressed()||(i=p.drawIcon(r.m_XeViewport,r)):(n||p.putImgData(r))&&(p.drawIcon(r.m_XeViewport,r),i=!0)),r.ctx.restore(),r.ctx.save(),!i){let e=PanZoomTracker.prototype.TrackerType.eNone;c=PanZoomTracker.prototype.TrackerType.eNone;let t=!1;u&&(u.setCanvasCursorStyle=g,u.setCanvasClassName=y,u.resetCursor=f,e=u.getDrawType(r),t=!1,e!==c?!(u.m_bDrawAsSystemCursor=o)&&(t=!!n||u.putImgData(r),l||!t)||(i=u.drawIcon(r.m_XeViewport,r)):o||u.setUnderCursorImgData(null));p=s.getXeDatabase().getSNAPMODE();p!=a.curSNAPMODE&&(a.curSNAPMODE=p,this.m_Resources.canvas.clear(),a.cached_cursors={}),d&&(i||e!==c?o||d.setUnderCursorImgData(null):(d.m_bDrawAsSystemCursor=o,d.setCanvasCursorStyle=g,d.setCanvasClassName=y,d.resetCursor=f,d.resetCache=function(){a.m_Resources.canvas.clear(),a.cached_cursors={}},o?i=d.drawIcon(r.m_XeViewport,r):(t=!!n||d.putImgData(r),!l&&t&&(d.drawIcon(r.m_XeViewport,r),i=!0))))}if(i&&o){if(this.setCanvasClassName(t,"interactive_none"),r.previousCursorDrawPath!==r.currentCursorDrawPath)if(a.cached_cursors[r.currentCursorDrawPath]){u=a.cached_cursors[r.currentCursorDrawPath];this.setCanvasCursorStyle(t,u)}else{for(var s=this.m_Resources.canvas.context,m=s.createImageData(2,2),h=0;h<m.data.length;h+=4)m.data[h+0]=0,m.data[h+1]=0,m.data[h+2]=0,m.data[h+3]=1;s.putImageData(m,0,0);p=this.m_Resources.canvas.make_url();a.cached_cursors[r.currentCursorDrawPath]=p,this.setCanvasCursorStyle(t,p)}r.previousCursorDrawPath=r.currentCursorDrawPath}r.ctx.restore(),r.m_XeViewport=null,r.canvas=t,r.ctx=e}function g(e){a.setCanvasCursorStyle(t,e)}function y(e){a.setCanvasClassName(t,e)}function f(){a.resetCursor(t)}}}else r.ctx=null,r.m_XeViewport=null},function(){ClientSideTracker.call(this),this.drawOrder=10}),TwoElasticPointCircleTracker=(TwoPointCircleTracker.prototype=Object.create(ClientSideTracker.prototype),TwoPointCircleTracker.prototype.constructor=TwoPointCircleTracker,TwoPointCircleTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var i=t.m_XeViewport,r=window.XeActiveTrackers.TrackerData("COs2PointCircularTracker");if(void 0===r)return!1;var n=new GeNeo.OdGePoint3d(r.centerPoint),n=new GeNeo.OdGePoint2d(i.PointToSCS(n)),o=t.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,a=t.m_XeMyDocument.getXeInputPointManager().getMousePosition().y,o=new GeNeo.OdGePoint2d(o,a),a=t.m_XeMyDocument.getXeGsDevice().getForeground(),a=(r.lineColor&&(a=r.lineColor),window.XeUtils.intRGBToHex(a));t.ctx.strokeStyle=a;a=t.m_XeMyDocument.getXeDatabase().getXeLinetypeTable().getLineDashGDI(i,"CENTER");t.ctx.setLineDash(a);let e;r.lineWidth&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&t.m_XeMyDocument.getXeGsDevice().getOverallViewport()?(i=t.m_XeMyDocument.getXeGsDevice().getActiveViewport(),(e=window.XeLineweightUtils.GetLineWeightInPixels(i,r.lineWidth))<1&&(e=1),1<(e=Math.round(e))&&1==(1&e)&&e++):e=window.XeLineweightUtils.getStndLineWeightPxSize(r.lineWidth,!0),t.ctx.lineWidth=e),t.ctx.beginPath();a=n.sub(o).length();return t.ctx.arc(n.x,n.y,a,0,2*Math.PI),t.ctx.stroke(),!0}},function(){ClientSideTracker.call(this),this.drawOrder=10});TwoElasticPointCircleTracker.prototype=Object.create(ClientSideTracker.prototype),TwoElasticPointCircleTracker.prototype.constructor=TwoElasticPointCircleTracker,TwoElasticPointCircleTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var i=t.m_XeViewport,r=window.XeActiveTrackers.TrackerData("COs2PointElasticCircularTracker");if(void 0===r)return!1;var n=new GeNeo.OdGePoint3d(r.centerPoint),n=new GeNeo.OdGePoint2d(i.PointToSCS(n)),o=i.NumToSCS(r.radius),a=window.getXeActiveDocument().getXeGsDevice().getForeground(),a=(r.lineColor&&(a=r.lineColor),window.XeUtils.intRGBToHex(a));t.ctx.strokeStyle=a;a=window.getXeActiveDocument().getXeDatabase().getXeLinetypeTable().getLineDashGDI(i,r.lineTypeName);t.ctx.setLineDash(a);let e;return r.lineWidth&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&window.getXeActiveDocument().getXeGsDevice().getOverallViewport()?(i=window.getXeActiveDocument().getXeGsDevice().getActiveViewport(),(e=window.XeLineweightUtils.GetLineWeightInPixels(i,r.lineWidth))<1&&(e=1),1<(e=Math.round(e))&&1==(1&e)&&e++):e=window.XeLineweightUtils.getStndLineWeightPxSize(r.lineWidth,!0),t.ctx.lineWidth=e),t.ctx.beginPath(),t.ctx.arc(n.x,n.y,o,0,2*Math.PI),t.ctx.stroke(),!0}},ActiveTableCellTracker.prototype.PE.push(function(e){document.addEventListener("Update_XeSelectionSet",function(e){e=e.m_Item;e.IsMainSelectionSet()&&e.getHandles().length&&window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker")&&!e.getXeDocument().getViewMode()&&e.getXeDocument().RunCmd("^C^C_OSTABLE_ACTION _CLOSE_TABLE_EDITOR\n")})}),ActiveTableCellTracker.prototype.drawGrip=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.fill(),e.stroke()},ActiveTableCellTracker.prototype.setByEntity=function(e){e?(e=e.getEntityData(),this.cellSelection=e.cellSelection):this.cellSelection=!1},ActiveTableCellTracker.prototype.update=function(e,t){var i,r,n,o,a;XeInputPointManager.prototype.getIsTableEditorCommandManagment()&&(e.m_XeMyDocument.getViewMode()?this.cellSelection=!1:t.IsKeyboardEvent()||(i=(r=e.m_XeMyDocument).getXeDatabase().getXeEntities(),(o=r.getXeInputPointManager()).getInsideNEntsel())||o.IsDraggingActive()||(a=o.GetApertureSelection(),o=o.getMousePosition(),n=r.getXeGsDevice().getActiveViewport(),r.getXeGsDevice().getOverallViewport(),r=n.PointToWCS(o.x,o.y,!0),r={x:r[0],y:r[1],z:r[2]},n=0,t.IsCtrlPressed()&&(n=n||1),t.IsMetaPressed()&&(n=n||16),t.IsAltPressed()&&(n=n||256,this.cellSelection=!1),t.IsShiftPressed()&&(n=n||4096),t.IsLeftButtonDown()?a.length||(this.cellSelection=!1,clientSideTrackersHolder.CFxNoteClientTracker&&clientSideTrackersHolder.CFxNoteClientTracker.isActive())||!window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker")||e.m_XeMyDocument.getViewMode()||e.m_XeMyDocument.RunCmd("^C^C_OSTABLE_ACTION _CLOSE_TABLE_EDITOR\n"):t.IsMouseMoved()?this.cellSelection&&(o=this.cellSelection.handle,a=i.getByHandle(o))&&"AcDbTable"===a.getClass()&&a.getEntityData()&&a.getEntityData().gripEditDataOnLMB&&(this.cellSelection=!1):t.IsLeftButtonUp()&&(this.cellSelection&&(o=this.cellSelection.handle,!(a=i.getByHandle(o))||"AcDbTable"!==a.getClass()||a.getEntityData()&&a.getEntityData().gripEditDataOnLMB||(t=this.cellSelection.mousePosWCS,e.m_XeMyDocument.getViewMode())||(e.m_XeMyDocument.getXeMainSelectionSet().ClearSelectionSet(),e.m_XeMyDocument.RunCmd("^C^C_OSTABLE_ACTION _SELECT_CELL "+a.getHandle()+" "+t.x+","+t.y+","+t.z+" "+r.x+","+r.y+","+r.z+" "+n+"\n"))),this.cellSelection=!1)))},ActiveTableCellTracker.prototype.drawTracker=function(e){var t=e.m_XeMyDocument,i=t.getXeDatabase(),r=i.getXeEntities(),t=t.getXeInputPointManager(),n=t.getMousePosition();if(e.m_XeViewport){var o=e.m_XeViewport,a=t.getInsideNEntsel();if(!a&&!0!==t.IsDraggingActive()){var s,c,a=window.XeUtils.rgbaToHex(244,204,133,255),l="#D8BF9F",d=(this.cellSelection&&(e.ctx.fillStyle=l,e.ctx.strokeStyle=a,d=this.cellSelection.mousePosWCS,d={x:(d=o.PointToSCS([d.x,d.y,d.z]))[0],y:d[1]},3<Math.abs(d.x-n.x)||3<Math.abs(d.y-n.y))&&(e.ctx.beginPath(),e.ctx.moveTo(n.x,n.y),e.ctx.lineTo(d.x,n.y),e.ctx.lineTo(d.x,d.y),e.ctx.lineTo(n.x,d.y),e.ctx.lineTo(n.x,n.y),e.ctx.stroke()),window.XeActiveTrackers.TrackerData("CFxActiveCellGripTracker"));if(d){this.x=t.getMousePosition().x,this.y=t.getMousePosition().y;var t=i.getGRIPSIZE(),u=(e.ctx.globalAlpha=1,e.ctx.lineWidth),p=(e.ctx.fillStyle=l,e.ctx.strokeStyle=a,e.ctx.lineWidth=t,d.extbox);if(HighlightTracker.prototype.bNewTableHighlight){if(p){e.ctx.strokeStyle="#2160a8";t=r.getByHandle(d.tableHandler),r=-2;if(t){if(-1===(r=0|t.getEntityData().tableStyle.lw_kDataRow_kHorzTop)){t=t.getLayerObject();if(!t)return;r=t.getLineWeight()}for(-2!==r&&-3!==r||(r=i.getLWDEFAULT()),e.ctx.lineCap="square",e.ctx.lineWidth=RecomputeDimBlock._getLwPx(o,r)+1,e.ctx.beginPath(),c=o.PointToSCS(p[0]),e.ctx.moveTo(c[0],c[1]),s=1;s<p.length;s++)c=o.PointToSCS(p[s]),e.ctx.lineTo(c[0],c[1]);e.ctx.stroke()}}}else if(p){for(e.ctx.beginPath(),c=o.PointToSCS(p[0]),e.ctx.moveTo(c[0],c[1]),s=1;s<p.length;s++)c=o.PointToSCS(p[s]),e.ctx.lineTo(c[0],c[1]);e.ctx.stroke()}e.ctx.lineWidth=u,e.ctx.fillStyle=l,e.ctx.fillStyle=l,a=window.XeUtils.rgbaToHex(244,204,133,255),e.ctx.strokeStyle=a,this.cellSelection||d.bDrawSelRect&&d.startSelPt&&(c=o.PointToSCS(d.startSelPt),e.ctx.beginPath(),e.ctx.moveTo(n.x,n.y),e.ctx.lineTo(c[0],n.y),e.ctx.lineTo(c[0],c[1]),e.ctx.lineTo(n.x,c[1]),e.ctx.lineTo(n.x,n.y),e.ctx.stroke())}}}return!0};let OsAngularCenterMarkTracker=function(){ClientSideTracker.call(this),this.drawOrder=10};OsAngularCenterMarkTracker.prototype=Object.create(ClientSideTracker.prototype),OsAngularCenterMarkTracker.prototype.constructor=OsAngularCenterMarkTracker,OsAngularCenterMarkTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("COsAngularCenterMarkTracker");if(i){var r=[],n=[],o=window.OnshapeColors.highlight.color,a=i.highlightedFirstEdgepoints;if(a){for(let e=0;e<a.length;++e){var s=t.PointToSCS(a[e][0],a[e][1]);r.push(s)}0<r.length&&this.drawLine(e.ctx,r,o)}var c=i.highlightedSecondEdgepoints;if(c){for(let e=0;e<c.length;++e){var l=t.PointToSCS(c[e][0],c[e][1]);n.push(l)}0<n.length&&this.drawLine(e.ctx,n,o)}}}return!0},OsAngularCenterMarkTracker.prototype.drawLine=function(e,t,i){e.strokeStyle=i,e.lineWidth=3,e.beginPath(),e.moveTo(t[0][0],t[0][1]),e.lineTo(t[1][0],t[1][1]),e.closePath(),e.stroke()};var AuxiliaryViewPlacementTracker=function(){ClientSidePlacementTracker.call(this),this.drawOrder=5,this.imgUrlDummy="",this.imgDummy=new Image,this.aDynUrls=[],this.aDynImgs=[]},AuxiliaryLineTracker=(AuxiliaryViewPlacementTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),AuxiliaryViewPlacementTracker.prototype.constructor=AuxiliaryViewPlacementTracker,AuxiliaryViewPlacementTracker.prototype.start=function(e){this.imgDummy=new Image,this.imgUrlDummy="",this.aDynUrls=[],this.aDynImgs=[]},AuxiliaryViewPlacementTracker.prototype.drawTracker=function(e){var c=e.m_XeMyDocument.getXeGsDevice(),l=window.XeActiveTrackers.TrackerData("COsAuxiliaryViewPlacementTracker");if(l){let i=l.width,r=l.height;var d=new GeNeo.OdGePoint3d(l.ptParentAnchor),u=new GeNeo.OdGePoint3d(l.ptViewCenter),p=l.bUseAnchorOffset,m=l.bFlipped;l.imgUrlDummy&&this.imgUrlDummy!==l.imgUrlDummy&&(this.imgDummy.src=l.imgUrlDummy,this.imgUrlDummy=l.imgUrlDummy);let n=this.imgDummy,o=0,a=0,s=new GeNeo.OdGePoint3d(e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT());if(s&&l.previews){let t=s.sub(d);var h=new GeNeo.OdGeVector3d(l.vDir);if(t.length()>l.minDelta){let e=1;(t=t.normalize()).angleTo(h)<Math.PI/2&&(e=0),m&&(e=0==e?1:0);var h=l.previews[e];if(h.sUrl||(t=s.sub(u)),h){h.vWH&&(i=h.vWH[0],r=h.vWH[1]),h.paddingLeft&&h.paddingTop&&(o=h.paddingLeft,a=h.paddingTop),h.sUrl&&this.aDynUrls[h.iDir]!==h.sUrl&&(this.aDynImgs[h.iDir]=new Image,this.aDynImgs[h.iDir].src=h.sUrl,this.aDynUrls[h.iDir]=h.sUrl,this.aDynImgs[h.iDir].onload=function(){c&&c.invalidateClientTrackers()}),this.aDynImgs[h.iDir]&&(n=this.aDynImgs[h.iDir]);m=new GeNeo.OdGeVector3d(h.vAnchorOffset),h=new GeNeo.OdGeVector3d(h.vAxisOffset);let e=s.sub(m);d=e.sub(d),d=h.mult(d.dotProduct(h));let t=s;u=t.sub(u),u=h.mult(u.dotProduct(h));t=t.sub(u),e=e.sub(d),s=p?e.add(m):t}}s&&(h=[s.x,s.y,s.z],this.drawPreview(e,h,i,r,o,a,n,l.bordercolor))}}return!0},function(){ClientSideTracker.call(this),this.drawOrder=10,this.Direction={eVertical:0,eHorizontal:1},this.ArrowHead={Filled:"ClosedFilled",Unfilled:"Closed",Dot:"DotSmall",Open:"Open"}});AuxiliaryLineTracker.prototype=Object.create(ClientSideTracker.prototype),AuxiliaryLineTracker.prototype.constructor=AuxiliaryLineTracker,AuxiliaryLineTracker.prototype.drawTracker=function(i){if(i.m_XeViewport){var r=i.m_XeMyDocument,n=window.XeActiveTrackers.TrackerData("COsAuxiliaryLineTracker");if(n){this.x=r.getXeInputPointManager().getMousePosition().x,this.y=r.getXeInputPointManager().getMousePosition().y;var o=n.isVisible;if(0!=o){n.arrowDirection,n.direction;var o=n.height,a=n.width,s=(n.offset,new GeNeo.OdGePoint3d(n.position)),c=(n.lineDirection,r.getXeGsDevice().getForeground()),c=(window.XeUtils.intRGBToHex(c),n.arrowSize),l=n.editTracker,d=(n.aT,n.lineColor,n.lineWeight),a=Math.sqrt(a*a+o*o)/4,o=(n.lineWeight?i.ctx.lineWidth=this.convertLineWeightToPixel(n.lineWeight,r):i.ctx.lineWidth=3,r.getXeDatabase()),u=0===o.getMEASUREMENT()?"ONS_PHANTOM":"ONS_DASHDOT",o=o.getXeLinetypeTable(),p=i.m_XeViewport,o=o.getLineDashGDI(p,u),p=n.isViewRefLineStyle,u=(i.ctx.setLineDash(o),i.ctx.lineWidth=this.convertLineWeightToPixel(d,r),i.ctx.lineCap="round",s.z=0,this.initCanvas(i,n),[]);if(n.first[0]!=n.second[0]||n.first[1]!=n.second[1]){o=new GeNeo.OdGePoint3d(n.first[0],n.first[1],0),d=new GeNeo.OdGePoint3d(n.second[0],n.second[1],0),s=new GeNeo.OdGePoint3d((n.first[0]+n.second[0])/2,(n.first[1]+n.second[1])/2,0);u.push(o),u.push(d),u.push(s);let e,t=[];l?(l=new GeNeo.OdGeVector3d(n.arrowDirection[0],n.arrowDirection[1],n.arrowDirection[2]),e=l,new GeNeo.OdGeVector3d(n.lineDirection[0],n.lineDirection[1],n.lineDirection[2]),t.push(o),t.push(d),t.push(s)):(e=this.computeAlignedArrowDirection(u,n,r),t=this.computeAlignPointArray(n,e,a,r),1==n.isFlipped&&e.negate()),p&&this.drawAlignedLinePoints(i,t),i.ctx.setLineDash([]),e&&(p?(this.drawArrow(i,t[0],e,c,n.isFirstAngle,n.arrowHead),this.drawArrow(i,t[1],e,c,n.isFirstAngle,n.arrowHead)):this.drawArrow(i,t[2],e,c,n.isFirstAngle,n.arrowHead))}}}}return!0},AuxiliaryLineTracker.prototype.getIntersectionPoint=function(e,t,i){var r=i[0],i=i[1],n=[],o=[],a=(n.push(new GeNeo.OdGePoint3d(r[0],r[1],0)),n.push(new GeNeo.OdGePoint3d(r[0],i[1],0)),n.push(new GeNeo.OdGePoint3d(i[0],i[1],0)),n.push(new GeNeo.OdGePoint3d(i[0],r[1],0)),n.push(new GeNeo.OdGePoint3d(r[0],r[1],0)),new GeNeo.OdGeLine3d(e,t)),s=[];t.perpVector(s);for(let e=0;e<n.length;e++){var c=new GeNeo.OdGeLine3d(new GeNeo.OdGePoint3d(n[e].x,n[e].y,0),s[0]),l=new GeNeo.OdGePoint3d;a.intersectWith(c,l)&&(l.z=0,o.push(l))}return o},AuxiliaryLineTracker.prototype.computAlignLineDirection=function(e){let t=new GeNeo.OdGeVector3d;return t=e.first&&e.second?(t=new GeNeo.OdGeVector3d(e.second[0]-e.first[0],e.second[1]-e.first[1],0)).normalize():t},AuxiliaryLineTracker.prototype.computeAlignPointArray=function(e,t,i,r){var n=[],t=new GeNeo.OdGeVector3d(t.x,t.y,t.z);t.normalize();let o=r.getXeDatabase().getMEASUREMENT(),a=e.arrowSize;o&&(a=a/25.4*2);var r=e.first[0]-t.x*(i+2*a),s=e.first[1]-t.y*(i+2*a),c=e.second[0]-t.x*(i+2*a),e=e.second[1]-t.y*(i+2*a),t=new GeNeo.OdGePoint3d(r,s,0),i=new GeNeo.OdGePoint3d(c,e,0),r=new GeNeo.OdGePoint3d((t.x+i.x)/2,(t.y+i.y)/2,0);return n.push(t),n.push(i),n.push(r),n},AuxiliaryLineTracker.prototype.projectOnVector=function(e,t){e=new GeNeo.OdGeVector3d(e.x,e.y,e.z),t=new GeNeo.OdGeVector3d(t.x,t.y,t.z).dotProduct(e)/e.lengthSqrd();return e.multAssign(t)},AuxiliaryLineTracker.prototype.drawAlignedLinePoints=function(t,i){let r=null;var n;let o;t.ctx.beginPath();for(let e=0;e<i.length;++e)n=i[e],r=(null!==r?(o=t.m_XeViewport.PointToSCS(n),t.ctx.lineTo(o[0],o[1])):(o=t.m_XeViewport.PointToSCS(n),t.ctx.moveTo(o[0],o[1])),n);t.ctx.stroke()},AuxiliaryLineTracker.prototype.convertLineWeightToPixel=function(e,t){let i;return!window.XeLineweightUtils.useModelSpaceLwAlways()&&t.getXeGsDevice().getOverallViewport()?(t=t.getXeGsDevice().getActiveViewport(),(i=window.XeLineweightUtils.GetLineWeightInPixels(t,e))<1&&(i=1),1<(i=Math.round(i))&&1==(1&i)&&i++):i=window.XeLineweightUtils.getStndLineWeightPxSize(e,!0),i},AuxiliaryLineTracker.prototype.initCanvas=function(e,t){var i=e.m_XeMyDocument.getXeDatabase(),r=i.getXeLinetypeTable(),i=0===i.getMEASUREMENT()?"ONS_PHANTOM":"ONS_DASHDOT",r=r.getLineDashGDI(e.m_XeViewport,i),i=(e.ctx.setLineDash(r),e.m_XeMyDocument.getXeGsDevice()),r=t.lineColor||i.getForeground(),t=window.XeUtils.intRGBToHex(r);e.ctx.strokeStyle=t,e.ctx.fillStyle=t},AuxiliaryLineTracker.prototype.drawArrow=function(i,e,r,n,o,a){var s=o?0:2*n;let c=GeNeo.OdGeVector3d.kXAxis.angleTo(r,GeNeo.OdGeVector3d.kZAxis);if(o&&(c+=Math.PI),i.ctx.beginPath(),a&&a===this.ArrowHead.Open){var r=i.m_XeMyDocument.getXeDatabase().getMEASUREMENT()?[new GeNeo.OdGePoint3d(s,0,0),new GeNeo.OdGePoint3d(s-n,n/6,0),new GeNeo.OdGePoint3d(s-n,n/24,0),new GeNeo.OdGePoint3d(s-2*n,n/120,0),new GeNeo.OdGePoint3d(0,0,0),new GeNeo.OdGePoint3d(s-n,-n/24,0),new GeNeo.OdGePoint3d(s-n,-n/6,0)]:[new GeNeo.OdGePoint3d(s,0,0),new GeNeo.OdGePoint3d(s-n,n/6,0),new GeNeo.OdGePoint3d(s-n,n/24,0),new GeNeo.OdGePoint3d(2*n,n/120,0),new GeNeo.OdGePoint3d(s-2*n,-n/25e3,0),new GeNeo.OdGePoint3d(s-n,-n/24,0),new GeNeo.OdGePoint3d(s-n,-n/6,0)],o=new GeNeo.OdGeMatrix3d,t=(o.setToRotation(c,GeNeo.OdGeVector3d.kZAxis,e),new GeNeo.OdGeMatrix3d),o=(t.setTranslation(e),o.mult(t)),t=(r[0].transformBy(o),i.m_XeViewport.PointToSCS(r[0]));i.ctx.moveTo(t[0],t[1]),r[1].transformBy(o),t=i.m_XeViewport.PointToSCS(r[1]),i.ctx.lineTo(t[0],t[1]),r[2].transformBy(o),t=i.m_XeViewport.PointToSCS(r[2]),i.ctx.moveTo(t[0],t[1]),r[3].transformBy(o),t=i.m_XeViewport.PointToSCS(r[3]),i.ctx.moveTo(t[0],t[1]),r[4].transformBy(o),t=i.m_XeViewport.PointToSCS(r[4]),i.ctx.lineTo(t[0],t[1]),r[5].transformBy(o),t=i.m_XeViewport.PointToSCS(r[5]),i.ctx.moveTo(t[0],t[1]),r[6].transformBy(o),t=i.m_XeViewport.PointToSCS(r[6]),i.ctx.moveTo(t[0],t[1]),t=i.m_XeViewport.PointToSCS(r[0]),i.ctx.lineTo(t[0],t[1]),i.ctx.stroke()}else{var l=[new GeNeo.OdGePoint3d(s,0,0),new GeNeo.OdGePoint3d(s-n,n/6,0),new GeNeo.OdGePoint3d(s-n,n/24,0),new GeNeo.OdGePoint3d(s-2*n,n/24,0),new GeNeo.OdGePoint3d(s-2*n,-n/24,0),new GeNeo.OdGePoint3d(s-n,-n/24,0),new GeNeo.OdGePoint3d(s-n,-n/6,0)],o=new GeNeo.OdGeMatrix3d,r=(o.setToRotation(c,GeNeo.OdGeVector3d.kZAxis,e),new GeNeo.OdGeMatrix3d),d=(r.setTranslation(e),o.mult(r));l[0].transformBy(d);let t=i.m_XeViewport.PointToSCS(l[0]);i.ctx.moveTo(t[0],t[1]);for(let e=1;e<l.length;++e)l[e].transformBy(d),t=i.m_XeViewport.PointToSCS(l[e]),i.ctx.lineTo(t[0],t[1]);a&&a===this.ArrowHead.Unfilled?(t=i.m_XeViewport.PointToSCS(l[0]),i.ctx.lineTo(t[0],t[1]),i.ctx.stroke()):i.ctx.fill()}},AuxiliaryLineTracker.prototype.drawGripPoints=function(t,i){var r=t.m_XeMyDocument.getXeDatabase().getGRIPSIZE();t.ctx.fillStyle=window.OnshapeColors.grippoint.selection_pen,t.ctx.strokeStyle="#FFFFFF";for(let e=0;e<i.length;e++){var n=i[e].location,n=t.m_XeViewport.PointToSCS(n);t.ctx.beginPath(),t.ctx.arc(n[0],n[1],r,0,2*Math.PI,!1),t.ctx.fill(),t.ctx.stroke()}return!0},AuxiliaryLineTracker.prototype.computeArrowDirection=function(e,t,i){t=new GeNeo.OdGeVector3d(t.x-e.x,t.y-e.y,0),e=[],i.crossProduct(e,t),t=[];return i.crossProduct(t,e[0]),t[0].isZeroLength()&&(t[0]=new GeNeo.OdGeVector3d(i.x,i.y,i.z),t[0].rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis)),t[0].normalize()},AuxiliaryLineTracker.prototype.computeAlignedArrowDirection=function(e,t,i){(r=new GeNeo.OdGeVector3d(e[0])).z=0,(e=new GeNeo.OdGeVector3d(e[1])).z=0;var e=e.sub(r),r=(e.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),e.z=0,new GeNeo.OdGePoint3d(i.getXeInputPointManager().getRUBBERPOINT()));return!r||(i=new GeNeo.OdGePoint3d(r.x,r.y,0),new GeNeo.OdGePoint3d(t.position[0],t.position[1],t.position[2]),r=new GeNeo.OdGePoint3d(t.first[0]+(t.second[0]-t.first[0])/2,t.first[1]+(t.second[1]-t.first[1])/2,t.first[2]+(t.second[2]-t.first[2])/2),(t=new GeNeo.OdGeLine3d).set(r,e),t=t.closestPointTo(i),i=r.asVector(),(r=t.asVector().sub(i).normalize())&&r.isCodirectionalTo(e)&&e.negate(),e)};let OsBOMTableRowSelectionTracker=function(){ClientSideTracker.call(this),this.drawOrder=10};OsBOMTableRowSelectionTracker.prototype=Object.create(ClientSideTracker.prototype),OsBOMTableRowSelectionTracker.prototype.constructor=OsBOMTableRowSelectionTracker,OsBOMTableRowSelectionTracker.prototype.drawTracker=function(t){if(!t.m_XeViewport)return!0;var e=t.m_XeViewport,i=t.m_XeMyDocument.getXeInputPointManager(),r=window.XeActiveTrackers.TrackerData("COsBOMTableRowSelectionTracker");if(!r)return!0;var e=e.getXeGsDevice().getXeDocument(),n=e.getXeDatabase(),o=n.getXeEntities();if(void 0===o)return!0;if(r.bomTableHandles){var a=[];for(let e=0;e<r.bomTableHandles.length;e++){var s=r.bomTableHandles[e],s=o.getByHandle(s);void 0!==s&&a.push(s)}if(a.length<1)return!0;var i=i.getHitTestInfo(),c=[i.GetMousePosition().x,i.GetMousePosition().y];for(let e=0;e<a.length;e++){var l=a[e];HighlightTracker.prototype.highlightTable(t,c,l,window.OnshapeColors.highlight.color,!1,!1,!1)}}if(!r.selectedRows)return!0;if(r.selectedRows.length<1)return!0;var d=e.getXeGsDevice().getActiveViewport(),u=t.ctx;if(u){for(let e=0;e<r.selectedRows.length;e++){var p=r.selectedRows[e].tableHandle,m=o.getByHandle(p);if(void 0!==m){var h=r.selectedRows[e].rows;for(let e=0;e<h.length;e++){var g=h[e];this.highlightRow(u,n,d,m,g,window.OnshapeColors.dependancy.color)}}}if(r.crossHighlightedRows)for(let e=0;e<r.crossHighlightedRows.length;e++){var y=r.crossHighlightedRows[e].tableHandle,f=r.crossHighlightedRows[e].row,y=o.getByHandle(y);void 0!==y&&this.highlightRow(u,n,d,y,f,window.OnshapeColors.duplicates.color)}return!0}},OsBOMTableRowSelectionTracker.prototype.highlightRow=function(e,t,i,r,n,o){e.strokeStyle=o;var o=r.getEntityData(),a=0|o.tableStyle.lw_kDataRow_kHorzTop;if(-1===a){r=r.getLayerObject();if(!r)return;a=r.getLineWeight()}-2!==a&&-3!==a||(a=t.getLWDEFAULT()),e.lineCap="square",e.lineWidth=RecomputeDimBlock._getLwPx(i,a)+1,e.globalAlpha=1,e.beginPath();r=o.cells[n],t=[0,0],a=r[0].extents[0],i.PointToSCSFast(t,a[0],a[1],a[2]),e.moveTo(t[0],t[1]),o=[0,0],a=r[r.length-1].extents[1];i.PointToSCSFast(o,a[0],a[1],a[2]),e.lineTo(o[0],o[1]),a=r[r.length-1].extents[3],i.PointToSCSFast(o,a[0],a[1],a[2]),e.lineTo(o[0],o[1]),a=r[0].extents[2],i.PointToSCSFast(o,a[0],a[1],a[2]),e.lineTo(o[0],o[1]),e.lineTo(t[0],t[1]),e.stroke()};var OsBOMTableTracker=function(){ClientSideTracker.call(this),this.drawOrder=10,this.m_bUpdateByRubberLine=!1,this.m_bIsLeftButtonUp=!1},BrokenViewTracker=(OsBOMTableTracker.prototype=Object.create(ClientSideTracker.prototype),OsBOMTableTracker.prototype.constructor=OsBOMTableTracker,OsBOMTableTracker.prototype.start=function(e){this.m_bIsLeftButtonUp=!1,this.updateByRubberLine(),document.addEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsBOMTableTracker.prototype.end=function(e){this.m_bIsLeftButtonUp=!1,document.removeEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsBOMTableTracker.prototype.updateByRubberLine=function(e){this.m_bUpdateByRubberLine=!0},OsBOMTableTracker.prototype.update=function(e,t){if(!window.XeActiveTrackers.TrackerData("COsBOMTableTracker"))return!0;var e=e.m_XeMyDocument,i=e.getXeInputPointManager(),e=e.getXeGsDevice().getActiveViewport();t.IsKeyboardEvent()||(t.IsLeftButtonDown(),t.IsLeftButtonUp()&&!this.m_bIsLeftButtonUp&&(t=i.getMousePosition(),this.m_bIsLeftButtonUp=e.PointToWCS(t.x,t.y,!0)))},OsBOMTableTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("COsBOMTableTracker");if(!t)return!0;OsTableTracker.prototype.drawTable.call(this,e,t)},function(){ClientSideTracker.call(this),this.drawOrder=10,this.Orientation={eVertical:0,eHorizontal:1}}),CenterLineSnapTracker=(BrokenViewTracker.prototype=Object.create(ClientSideTracker.prototype),BrokenViewTracker.prototype.constructor=BrokenViewTracker,BrokenViewTracker.prototype.drawPolyline=function(e,t){if(e&&!(e.length<2)){var i;t.ctx.setLineDash([5,2]),t.ctx.strokeStyle=window.XeUtils.intRGBToHex(t.m_XeMyDocument.getXeGsDevice().getForeground()),t.ctx.beginPath(),i=t.m_XeViewport.PointToSCS(e[0][0],e[0][1]),t.ctx.moveTo(i[0],i[1]);for(var r=1;r<e.length;r++)i=t.m_XeViewport.PointToSCS(e[r][0],e[r][1]),t.ctx.lineTo(i[0],i[1]);t.ctx.stroke()}},BrokenViewTracker.prototype.drawBreak=function(e,n){var o,a,s,t=window.XeActiveTrackers.TrackerData("COsBrokenViewTracker"),i=t.orientation,r=t.height,c=t.width,l=t.center,t=t.breakgeometry,d=n.m_XeViewport;!d||Math.abs(e[0]-l[0])>c/2||Math.abs(e[1]-l[1])>r/2||(o=i===this.Orientation.eVertical?e[0]-l[0]:0,a=i===this.Orientation.eHorizontal?e[1]-l[1]:0,t.polylines&&t.polylines.forEach(function(e){this.drawPolyline(e.map(function(e){return[e[0]+o,e[1]+a]}),n)},this),t.arcs&&(s=n.m_XeMyDocument.getXeGsDevice().getDeviation(d.getVpNum()),t.arcs.forEach(function(e){var t={x:e.center[0],y:e.center[1],z:0},i={x:e.refvec[0],y:e.refvec[1],z:0},r=[];new XeGiCircleArcSimplifier(t,{x:0,y:0,z:1},i,e.radius).getSamplePoints(0,(e.endang-e.startang)*(e.cw?-1:1),s,r),this.drawPolyline(r.map(function(e){return[e.x+o,e.y+a]}),n)},this)))},BrokenViewTracker.prototype.drawTracker=function(t){var e,i;return t.m_XeViewport&&(e=window.XeActiveTrackers.TrackerData("COsBrokenViewTracker"))&&((i=e.points)&&i.forEach(function(e){this.drawBreak(e,t)},this),e.drawcursorbreak)&&(i=new GeNeo.OdGePoint3d(t.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT()))&&this.drawBreak([i.x,i.y],t),!0},function(){ClientSideTracker.call(this)}),CenterLineTracker=(CenterLineSnapTracker.prototype=Object.create(ClientSideTracker.prototype),CenterLineSnapTracker.prototype.constructor=CenterLineSnapTracker,CenterLineSnapTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("COsCenterLineSnapTracker");if(t){var i=e.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),r=window.XeUtils.intRGBToHex(i),n=e.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();if(t.pointArray)for(var o=0;o<t.pointArray.length;o++){var a=t.pointArray[o].location,a=e.m_XeViewport.PointToSCS(a);this.drawCross(a,e,r,n)}}return!0},CenterLineSnapTracker.prototype.drawCross=function(e,t,i,r){t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.moveTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.stroke()},function(){ClientSideTracker.call(this),this.drawOrder=5,this.trackerName="COsCenterLineTracker"}),CenterMarkTracker=(CenterLineTracker.prototype=Object.create(ClientSideTracker.prototype),CenterLineTracker.prototype.constructor=CenterLineTracker,CenterLineTracker.prototype.drawLine=function(e,t,i,r,n){var o=e.strokeStyle;e.setLineDash(n),e.strokeStyle=r,e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(i[0],i[1]),e.stroke(),e.setLineDash([]),e.strokeStyle=o},CenterLineTracker.prototype.drawTracker=function(e){var t,i,r,n=window.XeActiveTrackers.TrackerData(this.trackerName);return!n||(e.m_XeViewport?(r=e.m_XeViewport,i=e.m_XeMyDocument.getXeGsDevice().getForeground(),n.lineColor&&(i=n.lineColor),n.lineWidth&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&e.m_XeMyDocument.getXeGsDevice().getOverallViewport()?(t=e.m_XeMyDocument.getXeGsDevice().getActiveViewport(),(t=window.XeLineweightUtils.GetLineWeightInPixels(t,n.lineWidth))<1&&(t=1),1<(t=Math.round(t))&&1==(1&t)&&t++):t=window.XeLineweightUtils.getStndLineWeightPxSize(n.lineWidth,!0),e.ctx.lineWidth=t),t=window.XeUtils.intRGBToHex(i),i=n.firstPoint,(n=e.m_XeMyDocument.getXeInputPointManager().getSpecificRubberPoint())&&(i=r.PointToSCS(i),n=r.PointToSCS(n),r=e.m_XeMyDocument.getXeDatabase().getXeLinetypeTable().getLineDashGDI(e.m_XeViewport,"CENTER"),this.drawLine(e.ctx,i,n,t,r)),!0):void 0)},function(){ClientSideTracker.call(this),this.drawOrder=10}),CircleTracker=(CenterMarkTracker.prototype=Object.create(ClientSideTracker.prototype),CenterMarkTracker.prototype.constructor=CenterMarkTracker,CenterMarkTracker.prototype.drawTracker=function(n){if(n.m_XeViewport){var o=n.m_XeViewport,a=window.XeActiveTrackers.TrackerData("COsCenterMarkTracker");if(void 0===a)return!0;this.x=n.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=n.m_XeMyDocument.getXeInputPointManager().getMousePosition().y;let e=n.m_XeMyDocument.getXeGsDevice().getForeground(),t=e;a.lineColor&&(e=a.lineColor),a.centerlineColor&&(t=a.centerlineColor);var s=window.XeUtils.intRGBToHex(e),c=window.XeUtils.intRGBToHex(t);let i=n.ctx.lineWidth,r=(a.thickness&&(i=this.getCalculatedLineWeight(n,a.thickness),n.ctx.lineWidth=i),n.ctx.lineWidth);if(a.centerlineThickness&&(r=this.getCalculatedLineWeight(n,a.centerlineThickness)),!0===a.showCentermarkPreview){let e,t;t=window.getXeApplication().GetCapability("drawings_centermarks_on_off_plane_holes")?(e=new GeNeo.OdGeVector3d(a.majorAxisDirection),new GeNeo.OdGeVector3d(a.minorAxisDirection)):(e=new GeNeo.OdGeVector3d(1,0,0),new GeNeo.OdGeVector3d(0,1,0)),this.drawSingleCenterMark(n,a,o,s,e,t,a.center_point,a.radius,a.radiusMajor,a.radiusMinor)}var l,d,u,p=n.m_XeMyDocument.getXeDatabase().getXeLinetypeTable().getLineDashGDI(n.m_XeViewport,"CENTER");return!0===a.showConnectingLines&&(3===a.hoverState?(n.ctx.strokeStyle="#cc925c",n.ctx.fillStyle="#cc925c"):n.ctx.strokeStyle=c,n.ctx.lineWidth=r,n.ctx.setLineDash(p),this.drawConnectingLines(n,o,a.connectingLinesStartPts,a.connectingLinesEndPts),0<a.dangleConnectingLinesStartPts.length||0<a.dangleConnectingLinesEndPts.length)&&(n.ctx.strokeStyle="#dd5228",n.ctx.fillStyle="#dd5228",this.drawConnectingLines(n,o,a.dangleConnectingLinesStartPts,a.dangleConnectingLinesEndPts)),!1!==a.showCircularPattern?(l=o.PointToSCS(a.boltCircleCenterPt[0],a.boltCircleCenterPt[1],0),!0===a.showPatternCentermark&&(n.ctx.lineWidth=i,d=new GeNeo.OdGeVector3d(1,0,0),u=new GeNeo.OdGeVector3d(0,1,0),2===a.hoverState?(n.ctx.strokeStyle="#cc925c",n.ctx.fillStyle="#cc925c",this.drawSingleCenterMark(n,a,o,"#cc925c",d,u,a.boltCircleCenterPt,a.boltCircleRadius,a.radiusMajor,a.radiusMinor)):this.drawSingleCenterMark(n,a,o,s,d,u,a.boltCircleCenterPt,a.boltCircleRadius,a.radiusMajor,a.radiusMinor)),n.ctx.lineWidth=r,!0===a.showBoltCircle&&(s=o.PointToSCS(a.boltCircleRadius,0,0)[0]-o.PointToSCS(0,0,0)[0],0===a.hoverState?(n.ctx.strokeStyle="#cc925c",n.ctx.fillStyle="#cc925c"):n.ctx.strokeStyle=c,n.ctx.setLineDash(p),n.ctx.beginPath(),n.ctx.arc(l[0],l[1],s,0,2*Math.PI),n.ctx.stroke()),!0===a.showRadialLines&&(1===a.hoverState?(n.ctx.strokeStyle="#cc925c",n.ctx.fillStyle="#cc925c"):n.ctx.strokeStyle=c,n.ctx.setLineDash(p),this.drawPatternRadialLines(n,o,l,a.radialPoints),n.ctx.strokeStyle="#dd5228",n.ctx.fillStyle="#dd5228",this.drawPatternRadialLines(n,o,l,a.dangleRadialPoints)),!0):void 0}},CenterMarkTracker.prototype.drawCentermarkExtensionLine=function(e,t,i,r,n,o,a){e.ctx.strokeStyle=t,e.ctx.setLineDash(a),e.ctx.beginPath(),e.ctx.moveTo(i,r),e.ctx.lineTo(n,o),e.ctx.closePath(),e.ctx.stroke()},CenterMarkTracker.prototype.drawSingleCenterMark=function(e,t,i,r,n,o,a,s,c,l){var d=e.m_XeMyDocument.getXeDatabase().getXeLinetypeTable(),u=d.getLineDashGDI(i,"CONTINUOUS"),p=new GeNeo.OdGePoint3d(a[0],a[1],0),m=(p.x=p.x-n.x*(t.size/2+t.markSize),p.y=p.y-n.y*(t.size/2+t.markSize),new GeNeo.OdGePoint3d(a[0],a[1],0)),h=(m.x=m.x+n.x*(t.size/2+t.markSize),m.y=m.y+n.y*(t.size/2+t.markSize),new GeNeo.OdGePoint3d(a[0],a[1],0)),a=(h.x=h.x+o.x*(t.size/2+t.markSize),h.y=h.y+o.y*(t.size/2+t.markSize),new GeNeo.OdGePoint3d(a[0],a[1],0)),g=(a.x=a.x-o.x*(t.size/2+t.markSize),a.y=a.y-o.y*(t.size/2+t.markSize),i.PointToSCS(p.x,p.y,0)),y=i.PointToSCS(m.x,m.y,0),f=i.PointToSCS(h.x,h.y,0),_=i.PointToSCS(a.x,a.y,0);this.drawCentermarkExtensionLine(e,r,g[0],g[1],y[0],y[1],u),this.drawCentermarkExtensionLine(e,r,f[0],f[1],_[0],_[1],u),t.extendedLinesVisibility&&(u=d.getLineDashGDI(i,"DASHED"),(g=new GeNeo.OdGePoint3d(p.x,p.y,0)).x=g.x-n.x*(t.gapSize+t.size/2),g.y=g.y-n.y*(t.gapSize+t.size/2),y=i.PointToSCS(g.x,g.y,0),0!=c?(g.x=g.x-n.x*c,g.y=g.y-n.y*c):(g.x=g.x-n.x*s,g.y=g.y-n.y*s),f=i.PointToSCS(g.x,g.y,0),this.drawCentermarkExtensionLine(e,r,y[0],y[1],f[0],f[1],u),(_=new GeNeo.OdGePoint3d(m.x,m.y,0)).x=_.x+n.x*(t.gapSize+t.size/2),_.y=_.y+n.y*(t.gapSize+t.size/2),d=i.PointToSCS(_.x,_.y,0),0!=c?(_.x=_.x+n.x*c,_.y=_.y+n.y*c):(_.x=_.x+n.x*s,_.y=_.y+n.y*s),p=i.PointToSCS(_.x,_.y,0),this.drawCentermarkExtensionLine(e,r,d[0],d[1],p[0],p[1],u),(g=new GeNeo.OdGePoint3d(h.x,h.y,0)).x=g.x+o.x*(t.gapSize+t.size/2),g.y=g.y+o.y*(t.gapSize+t.size/2),y=i.PointToSCS(g.x,g.y,0),0!=l?(g.x=g.x+o.x*l,g.y=g.y+o.y*l):(g.x=g.x+o.x*s,g.y=g.y+o.y*s),f=i.PointToSCS(g.x,g.y,0),this.drawCentermarkExtensionLine(e,r,y[0],y[1],f[0],f[1],u),(m=new GeNeo.OdGePoint3d(a.x,a.y,0)).x=m.x-o.x*(t.gapSize+t.size/2),m.y=m.y-o.y*(t.gapSize+t.size/2),c=i.PointToSCS(m.x,m.y,0),0!=l?(m.x=m.x-o.x*l,m.y=m.y-o.y*l):(m.x=m.x-o.x*s,m.y=m.y-o.y*s),n=i.PointToSCS(m.x,m.y,0),this.drawCentermarkExtensionLine(e,r,c[0],c[1],n[0],n[1],u))},CenterMarkTracker.prototype.drawPatternRadialLines=function(t,i,r,n){for(let e=0;e<n.length;e++){var o=i.PointToSCS(n[e][0],n[e][1],0);t.ctx.beginPath(),t.ctx.moveTo(r[0],r[1]),t.ctx.lineTo(o[0],o[1]),t.ctx.stroke()}},CenterMarkTracker.prototype.drawConnectingLines=function(t,i,r,n){for(let e=0;e<r.length&&e<n.length;e++){var o=i.PointToSCS(r[e][0],r[e][1],0),a=i.PointToSCS(n[e][0],n[e][1],0);t.ctx.beginPath(),t.ctx.moveTo(o[0],o[1]),t.ctx.lineTo(a[0],a[1]),t.ctx.stroke()}},CenterMarkTracker.prototype.getCalculatedLineWeight=function(e,t){let i;return!window.XeLineweightUtils.useModelSpaceLwAlways()&&e.m_XeMyDocument.getXeGsDevice().getOverallViewport()?(e=e.m_XeMyDocument.getXeGsDevice().getActiveViewport(),(i=window.XeLineweightUtils.GetLineWeightInPixels(e,t))<1&&(i=1),1<(i=Math.round(i))&&i%2==1&&i++):i=window.XeLineweightUtils.getStndLineWeightPxSize(t,!0),i},function(){ClientSideTracker.call(this),this.drawOrder=10});CircleTracker.prototype=Object.create(ClientSideTracker.prototype),CircleTracker.prototype.constructor=CircleTracker,CircleTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var i=t.m_XeViewport,r=window.XeActiveTrackers.TrackerData("OsElasticCircleTracker");if(r){void 0!==r.center&&void 0!==r.radius&&(n=(o=i.PointToSCS(r.center[0],r.center[1],0))[0],o=o[1],a=i.NumToSCS(r.radius));var n,o,a,s=t.m_XeMyDocument.getXeGsDevice().getForeground(),s=(r.lineColor&&(s=r.lineColor),window.XeUtils.intRGBToHex(s));t.ctx.strokeStyle=s;s=t.m_XeMyDocument.getXeDatabase().getXeLinetypeTable().getLineDashGDI(i,r.lineTypeName);t.ctx.setLineDash(s);let e;r.lineWidth&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&t.m_XeMyDocument.getXeGsDevice().getOverallViewport()?(i=t.m_XeMyDocument.getXeGsDevice().getActiveViewport(),(e=window.XeLineweightUtils.GetLineWeightInPixels(i,r.lineWidth))<1&&(e=1),1<(e=Math.round(e))&&1==(1&e)&&e++):e=window.XeLineweightUtils.getStndLineWeightPxSize(r.lineWidth,!0),t.ctx.lineWidth=e),t.ctx.beginPath(),t.ctx.arc(n,o,a,0*Math.PI,2*Math.PI),t.ctx.stroke()}return!0}};let delayInMilliseconds=1e3,hoverColor="#f1f155",defaultColor="#eee",colorRedundant="#D78281",colorRedundantOnClick="#D51608",colorRedundantOnHover="#BD3734",constraintsIconWidth=14,MainIconSet=-1,cmdOnClientPending=new Set(["","_CLIENTDRAG","_MAINSELECT","_SNAPGRIP"]);class OsConstraintsTracker extends ClientSideTracker{constructor(){super(),this.drawOrder=16,this.iconManager=new OsConstraintIconManager}start(){void 0===this.iconManager&&(this.iconManager=new OsConstraintIconManager)}end(){}updateEventManager(e){var t=window.getXeActiveDocument(),i=t.getXeInputPointManager(),r=i.IsClientPending(),n=t.getXeCommandProcessor().getCommandCounter();let o=t.getXeCommandProcessor().getCommandGlobalName();t=i.getInsideCommand()||void 0!==r&&r;void 0===this.eventManagerInit&&(this.canvas={height:e.canvas.height,width:e.canvas.width},this.counter=0,this.eventManagerInit=!0,this.status=!1),this.status!==t&&(i.IsDraggingActive()?(o="_CLIENTDRAG",t&&this.iconManager.dispatchEvent(new CustomEvent("CMD_ENTER",{detail:{cmd:o}})),this.status=t):this.counter!==n&&(t?this.iconManager.dispatchEvent(new CustomEvent("CMD_ENTER",{detail:{cmd:o}})):this.iconManager.dispatchEvent(new CustomEvent("CMD_LEAVE",{detail:{cmd:o}})),this.status=t)),this.counter!==n&&(t||this.iconManager.dispatchEvent(new CustomEvent("CMD_E",{detail:{cmd:o}})),this.counter=n),this.canvas.height===e.canvas.height&&this.canvas.width===e.canvas.width||(this.canvas.height=e.canvas.height,this.canvas.width=e.canvas.width,this.iconManager.dispatchEvent(new CustomEvent("HW_CHG")))}update(e,t){var i=window.getXeActiveDocument().getXeConstraintManager();if(i){for(var r=OsConstraintDataManager.getRemoveArray();0<r.length;){var n=r.shift();n&&this.iconManager.removeConstraint(n.groupId,n.nodeId)}for(var o=OsConstraintDataManager.getAppendArray();0<o.length;){var a=o.shift();a&&this.iconManager.appendConstraint(a.groupId,a.nodeId,a.type,a.subEntPaths,a.status)}for(var s=OsConstraintDataManager.getUpdateArray();0<s.length;){var c=s.shift();c&&this.iconManager.updateConstraint(c.groupId,c.nodeId,c.type,c.subEntPaths,c.status)}var i=i.getOsConstraintManager();i&&i.getShowCGroups&&(i=i.getShowCGroups())&&this.iconManager.updateShowCGroup(i),this.iconManager.update()}var i=window.getXeActiveDocument(),l=i.getXeGsDevice(),i=i.getXeInputPointManager();(l.getPan()||i.getHitTestInfo().IsMouseWheel())&&this.iconManager.OnWheel()}drawTracker(e){OsConstraintDataManager.hasData()&&this.iconManager.dispatchEvent(new CustomEvent("CMD_U",{detail:{updateInput:!0}}));var t,i=window.getXeActiveDocument(),i=(i.getXeGsDevice(),i.getXeInputPointManager());return i.getInsideCommand()||i.IsClientPending()||(t=i.GetApertureSelection())&&t.length&&this.iconManager.drawIconOnHover(t,i.getCursorPosition()),this.iconManager.hasObjectToHighlight()&&this.iconManager.drawCCGrip(e),this.updateEventManager(e),!0}static createXeEntityPreview(e=window.OnshapeColors.highlight){var t=new XeEntityPreview,i=(t.setSortingByDrawOrder(!1),t.setSortingByChunkOffsets(!1),t.getXeDrawDecoration().setLWThick(2),t.getXeDrawDecoration().TYPE_ENUM.SpecialSelectionSet);return t.getXeDrawDecoration().setType(i),t.getXeDrawDecoration().setColor(e.rgb),t.getXeDrawDecoration().setAlpha(e.alpha),t}drawTrackerGl(e,i){if(this.iconManager.hasObjectToHighlight()){var r,n=this.iconManager.getObjectToHighlight();let t;t=n.status?(r={color:"#D78281",rgb:window.XeUtils.hexToRgbArray("#D78281"),alpha:1},OsConstraintsTracker.createXeEntityPreview(r)):OsConstraintsTracker.createXeEntityPreview(),n.xeEntityArray.forEach(e=>{t.addXeEntity(e,!1)}),t.draw_gl(i,e)}return!0}}OsConstraintDataCollection.prototype.A_OsConstraintDataItem=function(e,t,i,r,n){this.m_Items||(this.m_Items=[]);e={groupId:e,nodeId:t,type:i,subEntPaths:JSON.parse(r),status:n};13!==e.type&&OsConstraintDataManager.append(e)},OsConstraintDataCollection.prototype.R_OsConstraintDataItemChanged=function(...e){this.m_Items&&(e={groupId:(e=e[0].replace(/ /g,"").split(","))[0],nodeId:e[1]},OsConstraintDataManager.remove(e))},OsConstraintDataCollection.prototype.U_OsConstraintDataItemChanged=function(...e){this.m_Items&&13!==(e={groupId:e[0],nodeId:e[1],type:e[2],subEntPaths:JSON.parse(e[3]),status:e[4]}).type&&OsConstraintDataManager.update(e)},XeCursorTracker.prototype.putImgData=function(e){return!1},XeCursorTracker.prototype.getCursorPosition=function(e){return e.getXeInputPointManager().getCursorPosition()},XeCursorTracker.prototype.performResources=function(){var e=this.getResources();e.DrawingCrosshair=new XeImage("icons/DrawingCrosshair-01.png"),e.DrawingCrosshairBox=new XeImage("icons/DrawingCrosshairBox3-01.png"),e.DrawingCrosshairInverted=new XeImage("icons/DrawingCrosshairInverted-01.png"),e.DrawingCrosshairBoxInverted=new XeImage("icons/DrawingCrosshairBox3Inverted-01.png")},XeCursorTracker.prototype.isImagesLoaded=function(){var e=this.getResources();return e.DrawingCrosshair.imageLoaded&&e.DrawingCrosshairBox.imageLoaded&&e.DrawingCrosshairInverted.imageLoaded&&e.DrawingCrosshairBoxInverted.imageLoaded},XeCursorTracker.prototype.drawArrow=function(e){return this.resetCursor(),!1},XeCursorTracker.prototype.drawCross=function(e,t,i){if(!e||!t)return this.resetCursor(),!1;if(this.m_bDrawAsSystemCursor){e=i.getModelLayoutActive()?"onshape_cross_cursor_inverted":"onshape_cross_cursor";this.setCanvasCursorStyle(null),this.setCanvasClassName(e)}else{if(!this.isImagesLoaded())return this.resetCursor(),!1;var e=this.getResources(),i=i.getModelLayoutActive()?e.DrawingCrosshairInverted:e.DrawingCrosshair,e=this.getLastXY(),r=e.x,e=e.y,n=i.img.width,o=i.img.height;t.setTransform(1,0,0,1,Math.floor(r-n/2),Math.floor(e-o/2)),t.drawImage(i.img,0,0),t.setTransform(1,0,0,1,0,0)}return!0},XeCursorTracker.prototype.drawCrossBox=function(e,t,i){if(!e||!t)return this.resetCursor(),!1;if(this.m_bDrawAsSystemCursor){e=i.getModelLayoutActive()?"onshape_box_cursor_inverted":"onshape_box_cursor";this.setCanvasCursorStyle(null),this.setCanvasClassName(e)}else{if(!this.isImagesLoaded())return this.resetCursor(),!1;var e=this.getResources(),i=i.getModelLayoutActive()?e.DrawingCrosshairBoxInverted:e.DrawingCrosshairBox,e=this.getLastXY(),r=e.x,e=e.y,n=i.img.width,o=i.img.height;t.setTransform(1,0,0,1,Math.floor(r-n/2),Math.floor(e-o/2)),t.drawImage(i.img,0,0),t.setTransform(1,0,0,1,0,0)}return!0},XeCursorTracker.prototype.drawIcon=function(e,t){return this.m_bDrawAsSystemCursor?this.drawTrackerBySystemCursor(e,t):this.drawTrackerIntoCanvas(e,t)},XeCursorTracker.prototype.drawTrackerIntoCanvas=function(e,t){if(e){var i=e,e=e.getXeGsDevice().getXeDocument(),r=e.getXeInputPointManager().getCursorPosition(t.m_XeMyDocument);if(r){var n=[0,0],i=(i.PointToSCSFast(n,r[0],r[1],r[2]),Math.round(n[0])),r=Math.round(n[1]),n=(this.setLastXY(i,r),this.setUnderCursorImgData(null),t.canvas),i=t.ctx;if(n&&i){var r=e.getXeDatabase().getAPBOX(),t=e.getXeInputPointManager().getOsnapCalculationEnabled(),o=e.getXeInputPointManager().getInsideSelect(),a=!1,s=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker"),s=(s&&(a=s.trackertype===PanZoomTracker.prototype.TrackerType.ePan),!1),c=((window.XeActiveTrackers.TrackerData("COsToleranceGripEditClientTracker")||window.XeActiveTrackers.TrackerData("COsProfileEditCursorTracker"))&&(s=!0),e.getXeDatabase().getCURSORMODE()),l=e.getXeInputPointManager().IsCopyMode();if(!e.getXeInputPointManager().getInsideCommand()&&!e.getXeInputPointManager().getInsideLISP())return 9==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_nwseresize"),!1):10==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_neswresize"),!1):11==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_hand"),!1):12==c?this.drawCross(n,i,e):13==c||!0===l?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_copy"),!1):14==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_ewresize"),!1):15==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_alias"),!1):16==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_move"),!1):17==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_eresize"),!1):18==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_sresize"),!1):19==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_nresize"),!1):20==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_col_resize"),!1):21==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_row_resize"),!1):this.drawArrow(n);if(!0===window.XeUtils.IsNoteCommand(e))4===c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_text")):8===c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_eresize")):this.drawCross(n,i,e);else if(r&&t)this.drawCrossBox(n,i,e);else if(o)this.drawCrossBox(n,i,e);else{if(s)return 16==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_move"),!1):12==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_none"),this.drawCross(n,i,e)):void this.drawArrow(n);a||s||this.drawCross(n,i,e)}}else this.drawArrow(n)}}},XeCursorTracker.prototype.drawTrackerBySystemCursor=function(e,t){var i,r,n,o,a,s,c,l;if(e)return i=t.canvas,t=t.ctx,e=e.getXeGsDevice().getXeDocument(),this.setLastXY(Math.round(i.width/2),Math.round(i.height/2)),r=e.getXeDatabase().getAPBOX(),n=e.getXeInputPointManager().getOsnapCalculationEnabled(),o=e.getXeInputPointManager().getInsideSelect(),a=!1,(s=window.XeActiveTrackers.TrackerData("CFxPanZoomTracker"))&&(a=s.trackertype===PanZoomTracker.prototype.TrackerType.ePan),s=!1,(window.XeActiveTrackers.TrackerData("COsToleranceGripEditClientTracker")||window.XeActiveTrackers.TrackerData("COsProfileEditCursorTracker"))&&(s=!0),c=e.getXeDatabase().getCURSORMODE(),l=e.getXeInputPointManager().IsCopyMode(),e.getXeInputPointManager().getInsideCommand()||e.getXeInputPointManager().getInsideLISP()?!0===window.XeUtils.IsNoteCommand(e)?4===c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_text"),!1):8===c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_eresize"),!1):this.drawCross(i,t,e):r&&n||o?this.drawCrossBox(i,t,e):s?16==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_move"),!1):12==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_none"),this.drawCross(i,t,e)):this.drawArrow(i):a?void 0:this.drawCross(i,t,e):9==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_nwseresize"),!1):10==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_neswresize"),!1):11==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_hand"),!1):12==c?this.drawCross(i,t,e):13==c||!0===l?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_copy"),!1):14==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_ewresize"),!1):15==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_alias"),!1):16==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_move"),!1):17==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_eresize"),!1):18==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_sresize"),!1):19==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_nresize"),!1):20==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_col_resize"),!1):21==c?(this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_row_resize"),!1):this.drawArrow(i)};var OsCustomTableTracker=function(){ClientSideTracker.call(this),this.drawOrder=10,this.m_bUpdateByRubberLine=!1,this.m_bIsLeftButtonUp=!1},OsCutlistTableTracker=(OsCustomTableTracker.prototype=Object.create(ClientSideTracker.prototype),OsCustomTableTracker.prototype.constructor=OsCustomTableTracker,OsCustomTableTracker.prototype.start=function(){this.m_bIsLeftButtonUp=!1,this.updateByRubberLine(),document.addEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsCustomTableTracker.prototype.end=function(){this.m_bIsLeftButtonUp=!1,document.removeEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsCustomTableTracker.prototype.updateByRubberLine=function(e){this.m_bUpdateByRubberLine=!0},OsCustomTableTracker.prototype.update=function(e,t){if(!window.XeActiveTrackers.TrackerData("COsCustomTableTracker"))return!0;var i=window.getXeActiveDocument(),r=i.getXeInputPointManager(),i=i.getXeGsDevice().getActiveViewport();t.IsKeyboardEvent()||(t.IsLeftButtonDown(),t.IsLeftButtonUp()&&!this.m_bIsLeftButtonUp&&(t=r.getMousePosition(),this.m_bIsLeftButtonUp=i.PointToWCS(t.x,t.y,!0)))},OsCustomTableTracker.prototype.drawTracker=function(t){var e=window.XeActiveTrackers.TrackerData("COsCustomTableTracker");if(e&&e.tables){var i=e.tables;for(let e=0;e<i.length;++e)OsTableTracker.prototype.drawTable.call(this,t,i[e])}},function(){ClientSideTracker.call(this),this.drawOrder=10,this.m_bUpdateByRubberLine=!1,this.m_bIsLeftButtonUp=!1});OsCutlistTableTracker.prototype=Object.create(ClientSideTracker.prototype),OsCutlistTableTracker.prototype.constructor=OsCutlistTableTracker,OsCutlistTableTracker.prototype.start=function(){this.m_bIsLeftButtonUp=!1,this.updateByRubberLine(),document.addEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsCutlistTableTracker.prototype.end=function(){this.m_bIsLeftButtonUp=!1,document.removeEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsCutlistTableTracker.prototype.updateByRubberLine=function(e){this.m_bUpdateByRubberLine=!0},OsCutlistTableTracker.prototype.update=function(e,t){if(!window.XeActiveTrackers.TrackerData("COsCutlistTableTracker"))return!0;var i=window.getXeActiveDocument(),r=i.getXeInputPointManager(),i=i.getXeGsDevice().getActiveViewport();t.IsKeyboardEvent()||(t.IsLeftButtonDown(),t.IsLeftButtonUp()&&!this.m_bIsLeftButtonUp&&(t=r.getMousePosition(),this.m_bIsLeftButtonUp=i.PointToWCS(t.x,t.y,!0)))},OsCutlistTableTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("COsCutlistTableTracker");if(!t)return!0;OsTableTracker.prototype.drawTable.call(this,e,t)};let OsDatumTracker=function(){ClientSideTracker.call(this),this.drawOrder=10};OsDatumTracker.prototype=Object.create(ClientSideTracker.prototype),OsDatumTracker.prototype.constructor=OsDatumTracker,OsDatumTracker.prototype.drawTracker=function(e){var t,i,r,n;if(e.m_XeViewport)return n=e.m_XeViewport,(t=window.XeActiveTrackers.TrackerData("COsDatumClientTracker"))&&(t.viewFramePoints&&((i=[]).push(n.PointToSCS(t.viewFramePoints[0])),i.push(n.PointToSCS(t.viewFramePoints[1])),i.push(n.PointToSCS(t.viewFramePoints[2])),i.push(n.PointToSCS(t.viewFramePoints[3])),r=window.OnshapeColors.highlight.color,this.drawFrame(e.ctx,i,r)),t.highlightPoint)&&(i=n.PointToSCS(t.highlightPoint[0],t.highlightPoint[1]),r=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),n=window.OnshapeColors.select.color,this.drawPoint(e.ctx,i[0],i[1],r,n,"#FFFFFF")),!0},OsDatumTracker.prototype.drawFrame=function(e,t,i){e.strokeStyle=i,e.lineWidth=3,e.beginPath(),e.moveTo(t[0][0],t[0][1]),e.lineTo(t[1][0],t[1][1]),e.lineTo(t[2][0],t[2][1]),e.lineTo(t[3][0],t[3][1]),e.lineTo(t[0][0],t[0][1]),e.closePath(),e.stroke()},OsDatumTracker.prototype.drawPoint=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.fill(),e.stroke()};var OsDebugTracker=function(){ClientSideTracker.call(this),this.drawOrder=10,this.fontSize=10},DetailViewCutLineTracker=(OsDebugTracker.prototype=Object.create(ClientSideTracker.prototype),OsDebugTracker.prototype.constructor=OsDebugTracker,OsDebugTracker.prototype.drawPoint=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.fill(),e.stroke()},OsDebugTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var i=t.m_XeViewport,e=window.XeActiveTrackers.TrackerData("OsDebugTracker");if(!e)return!1;var r=t.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,n=t.m_XeMyDocument.getXeInputPointManager().getMousePosition().y;if(e.outputArray){t.ctx.save(),t.ctx.textBaseline="top",t.ctx.font=this.fontSize.toString()+"px sans-serif";for(var o=new GeNeo.OdGeVector2d(0,this.fontSize+1),a=0;a<e.outputArray.length;a++){var s=(a+1)%e.outputArray.length,c=e.outputArray[s],l=new GeNeo.OdGePoint2d(i.PointToSCS(c.position));0==s&&(l.x=r,l.y=n);for(var d=0;d<c.textArray.length;d++){var u=c.textArray[d],p=t.ctx.measureText(u.text).width;t.ctx.fillStyle="rgba(255, 255, 255, 0.8)",t.ctx.fillRect(l.x-2,l.y-(0===d?1:0),p+4,this.fontSize+(0===d?2:1)),t.ctx.fillStyle=window.XeUtils.intRGBToHex(u.color),t.ctx.fillText(u.text,l.x,l.y),l=l.add(o)}}var m=e.highlightSeedpoints;for(let e=0;e<m.length;++e){var h=i.PointToSCS(m[e][0],m[e][1]),g=t.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),y=window.OnshapeColors.select.color;this.drawPoint(t.ctx,h[0],h[1],g,y,"#FFFFFF")}var f=e.highlightRegionpoints;for(let e=0;e<f.length;++e){var _=i.PointToSCS(f[e][0],f[e][1]),w=t.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),v=window.OnshapeColors.dependancy.color;this.drawPoint(t.ctx,_[0],_[1],w,v,"#FFFFFF")}t.ctx.restore()}return!0}},function(){ClientSideTracker.call(this),this.drawOrder=10,this.Direction={eVertical:0,eHorizontal:1}}),DetailViewPlacementTracker=(DetailViewCutLineTracker.prototype=Object.create(ClientSideTracker.prototype),DetailViewCutLineTracker.prototype.constructor=DetailViewCutLineTracker,DetailViewCutLineTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("COsDetailViewCutLineTracker");if(i){this.x=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().y;var r,n,o,a=i.direction,s=i.height,c=i.width,i=i.offset,l=e.m_XeMyDocument.getXeGsDevice().getForeground(),l=window.XeUtils.intRGBToHex(l),d=(e.ctx.setLineDash([5,2]),e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT());if(d)return r=d[0],n=d[0],o=d=d[1],a===this.Direction.eVertical?(d-=s/2,o+=s/2):(r-=c/2,n+=c/2),s=t.PointToSCS(r,d,0),c=t.PointToSCS(n,o,0),r=s[0],d=s[1],n=c[0],o=c[1],i=t.PointToSCS(i,0,0)[0]-t.PointToSCS(0,0,0)[0],a===this.Direction.eVertical?(d+=i,o-=i):(r-=i,n+=i),e.ctx.strokeStyle=l,e.ctx.beginPath(),e.ctx.moveTo(r,d),e.ctx.lineTo(n,o),e.ctx.stroke(),e.ctx.setLineDash([]),!0}}},function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.imgPath="",this.img=new Image}),DetailViewTracker=(DetailViewPlacementTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),DetailViewPlacementTracker.prototype.constructor=DetailViewPlacementTracker,DetailViewPlacementTracker.prototype.start=function(e){this.img=new Image,this.imgPath=""},DetailViewPlacementTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a,s,c;if(e.m_XeViewport)return t=e.m_XeViewport,i=e.m_XeMyDocument.getXeGsDevice(),(r=window.XeActiveTrackers.TrackerData("COsDetailViewPlacementTracker"))&&(o=e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT(),a=new GeNeo.OdGePoint3d(o),a=new GeNeo.OdGePoint3d(t.PointToSCS(a)),this.x=a.x,this.y=a.y,r.fixedPosition&&0<r.fixedPosition.length&&(this.x=r.fixedPosition[0],this.y=r.fixedPosition[1],o[0]=r.fixedPosition[0],o[1]=r.fixedPosition[1],o[2]=r.fixedPosition[2]),r.imgPath&&this.imgPath!==r.imgPath&&(this.img.src=r.imgPath,this.imgPath=r.imgPath,this.img.onload=function(){i&&i.invalidateClientTrackers()}),a=r.width,s=r.height,n=c=0,r.paddingLeft&&r.paddingTop&&(c=r.paddingLeft,n=r.paddingTop),this.drawPreview(e,o,a,s,c,n,this.img,r.bordercolor),o=new GeNeo.OdGePoint2d(t.PointToSCS(r.center)),a=(a=new GeNeo.OdGePoint3d(r.center)).add(new GeNeo.OdGeVector3d(r.radius,0,0)),s=new GeNeo.OdGePoint2d(t.PointToSCS(a)),c=o.distanceTo(s),e.ctx.strokeStyle=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),e.ctx.beginPath(),e.ctx.arc(o.x,o.y,c,0,2*Math.PI),e.ctx.stroke()),!0},function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.imgPath="",this.img=new Image}),DetailViewBoundaryTracker=(DetailViewTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),DetailViewTracker.prototype.constructor=DetailViewTracker,DetailViewTracker.prototype.start=function(e){this.img=new Image,this.imgPath=""},DetailViewTracker.prototype.drawTracker=function(e){var i=window.XeActiveTrackers.TrackerData("COsDetailViewTracker");if(i){let t=e.m_XeMyDocument;this.x=t.getXeInputPointManager().getMousePosition().x,this.y=t.getXeInputPointManager().getMousePosition().y;var r=i.isFirstAngle,n=i.cutlinestart,o=i.cutlineend,a=i.position,s=i.width,c=i.height,l=i.arrowSize,d=i.offset,u=0,p=0,m=(i.paddingLeft&&i.paddingTop&&(u=i.paddingLeft,p=i.paddingTop),i.imgPath&&this.imgPath!==i.imgPath&&(this.img.src=i.imgPath,this.imgPath=i.imgPath,this.img.onload=function(){var e=t.getXeGsDevice();e&&e.invalidateClientTrackers()}),t.getXeGsDevice().getForeground()),m=(window.XeUtils.intRGBToHex(m),r);n[0]===o[0]?a[0]>n[0]&&(m=!m):a[1]<n[1]&&(m=!m),this.drawCutLine(e,n,o,l,d,m,r),this.drawPreview(e,a,s,c,u,p,this.img,i.bordercolor)}return!0},function(){ClientSideTracker.call(this),this.drawOrder=10,this.fontSize=10}),DimArcToArcTracker=(DetailViewBoundaryTracker.prototype=Object.create(ClientSideTracker.prototype),DetailViewBoundaryTracker.prototype.constructor=DetailViewBoundaryTracker,DetailViewBoundaryTracker.prototype.drawTracker=function(s){if(s.m_XeViewport){var c=s.m_XeViewport,l=window.XeActiveTrackers.TrackerData("COsDetailViewBoundaryTracker");if(void 0===l)return!1;let e=new GeNeo.OdGePoint3d(l.centerPoint),t=new GeNeo.OdGePoint2d(c.PointToSCS(e)),i=s.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,r=s.m_XeMyDocument.getXeInputPointManager().getMousePosition().y,n=new GeNeo.OdGePoint2d(i,r),o=s.m_XeMyDocument.getXeGsDevice().getForeground();l.lineColor&&(o=l.lineColor);var c=window.XeUtils.intRGBToHex(o);s.ctx.strokeStyle=c;let a=1;l.lineWidth&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&s.m_XeMyDocument.getXeGsDevice().getOverallViewport()?(c=s.m_XeMyDocument.getXeGsDevice().getActiveViewport(),(a=window.XeLineweightUtils.GetLineWeightInPixels(c,l.lineWidth))<1&&(a=1),1<(a=Math.round(a))&&1==(1&a)&&a++):a=window.XeLineweightUtils.getStndLineWeightPxSize(l.lineWidth,!0),s.ctx.lineWidth=a),s.ctx.beginPath();c=t.sub(n).length();return s.ctx.arc(t.x,t.y,c,0,2*Math.PI),s.ctx.stroke(),!0}},function(){ClientSideTracker.call(this)}),OsDimExtLineHighlightTracker=(DimArcToArcTracker.prototype=Object.create(ClientSideTracker.prototype),DimArcToArcTracker.prototype.constructor=DimArcToArcTracker,DimArcToArcTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("COsDimArcToArcTracker");if(t){var i=e.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),r=window.XeUtils.intRGBToHex(i),n=e.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE();if(t.pointArray)for(var o=0;o<t.pointArray.length;o++){var a=t.pointArray[o].location,a=e.m_XeViewport.PointToSCS(a);this.drawBox(a,e,r,n),this.drawBox(a,e,r,n-2)}}return!0},DimArcToArcTracker.prototype.drawBox=function(e,t,i,r){t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]-r),t.ctx.stroke()},DimensionTracker.prototype._PE_call=function(){var r=this,e=r.getDims();e.OsElasticSmartDimTracker={AcDbAlignedDimension:{dim:DbWasm.OdDbAlignedDimension.createObject(),comp:new DbWasm.OdAlignedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point"},dependentPoints:[{name:"setTextPosition",cb:function(e,t,i){return r.Util.snapToCenter(e,t,i,void 0)}}]},AcDbRotatedDimension:{dim:DbWasm.OdDbRotatedDimension.createObject(),comp:new DbWasm.OdRotatedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",rotation:"setRotation"},dependentPoints:[{name:"setTextPosition",cb:function(e,t,i){return r.Util.snapToCenter(e,t,i,i.rotation)}}]}},e.OsElasticDimLinearTracker={AcDbRotatedDimension:{dim:DbWasm.OdDbRotatedDimension.createObject(),comp:new DbWasm.OdRotatedDimRecomputor,props:{xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",rotation:"setRotation"},dependentPoints:[{name:"setTextPosition",cb:function(e,t,i){return r.Util.snapToCenter(e,t,i,i.rotation)}}]}},e.COsElasticDimOrdinateTracker={AcDbOrdinateDimension:{dim:DbWasm.OdDbOrdinateDimension.createObject(),comp:new DbWasm.OdOrdinateDimRecomputor,props:{definingPoint:"setDefiningPoint",leaderEndPoint:"setLeaderEndPoint",origin:"setOrigin"},dependentPoints:[{name:"setLeaderEndPoint",cb:function(e,t,i,r){return i.useXAxis?r.useXAxis():r.useYAxis(),t}}]}},e.COsElasticDimBaselineOrdinateTracker={AcDbOrdinateDimension:{dim:DbWasm.OdDbOrdinateDimension.createObject(),comp:new DbWasm.OdOrdinateDimRecomputor,props:{origin:"setOrigin"},callees:["useXAxis","useYAxis"],val:"setDefiningPoint",dependentPoints:[{name:"setLeaderEndPoint",cb:function(e,t,i){var r,n,o=new GeNeo.OdGePoint3d(i.baseLeaderEndPoint),a=new GeNeo.OdGePoint3d(i.baseDefPoint),s=o;return i.useXAxis?(r=a.x<t.x?(r=o.x+i.trackerDimdli,Math.max(r,t.x)):(r=o.x-i.trackerDimdli,Math.min(r,t.x)),s.x=r):(n=a.y<t.y?(n=o.y+i.trackerDimdli,Math.max(n,t.y)):(n=o.y-i.trackerDimdli,Math.min(n,t.y)),s.y=n),s}}]}},e.OsDimGRIPTracker={dragAndDrop:!0,AcDb2LineAngularDimension:{gripPointsPE:new CFxGrips.CFx2LineAngularDimGripPointsPE,dim:DbWasm.OdDb2LineAngularDimension.createObject(),comp:new DbWasm.Od2LineAngularDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",xLine1Start:"setXLine1Start",xLine1End:"setXLine1End",xLine2Start:"setXLine2Start",xLine2End:"setXLine2End",arrowFirstIsFlipped:"setArrowFirstIsFlipped",arrowSecondIsFlipped:"setArrowSecondIsFlipped",xArcPoint:"setArcPoint",textPosition:"setTextPosition",extArcOn:"setExtArcOn"}},AcDb3PointAngularDimension:{gripPointsPE:new CFxGrips.CFx3PointAngularDimGripPointsPE,dim:DbWasm.OdDb3PointAngularDimension.createObject(),comp:new DbWasm.Od3PointAngularDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",arrowFirstIsFlipped:"setArrowFirstIsFlipped",arrowSecondIsFlipped:"setArrowSecondIsFlipped",centerPoint:"setCenterPoint",textPosition:"setTextPosition",arcPoint:"setArcPoint",extArcOn:"setExtArcOn"}},AcDbRotatedDimension:{gripPointsPE:new CFxGrips.CFxRotatedDimGripPointsPE,dim:DbWasm.OdDbRotatedDimension.createObject(),comp:new DbWasm.OdRotatedDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",arrowFirstIsFlipped:"setArrowFirstIsFlipped",arrowSecondIsFlipped:"setArrowSecondIsFlipped",rotation:"setRotation",textPosition:"setTextPosition",dimLinePoint:"setDimLinePoint",extArcOn:"setExtArcOn"}},AcDbRadialDimension:{gripPointsPE:new CFxGrips.CFxRadialDimGripPointsPE,dim:DbWasm.OdDbRadialDimension.createObject(),comp:new DbWasm.OdRadialDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",center:"setCenter",textPosition:"setTextPosition",arrowFirstIsFlipped:"setArrowFirstIsFlipped",arrowSecondIsFlipped:"setArrowSecondIsFlipped",chordPoint:"setChordPoint",extArcStartAngle:"setExtArcStartAngle",extArcEndAngle:"setExtArcEndAngle",extArcOn:"setExtArcOn"}},AcDbDiametricDimension:{gripPointsPE:new CFxGrips.CFxDiametricDimGripPointsPE,dim:DbWasm.OdDbDiametricDimension.createObject(),comp:new DbWasm.OdDiametricDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",textPosition:"setTextPosition",arrowFirstIsFlipped:"setArrowFirstIsFlipped",arrowSecondIsFlipped:"setArrowSecondIsFlipped",farChordPoint:"setFarChordPoint",chordPoint:"setChordPoint"}},AcDbAlignedDimension:{gripPointsPE:new CFxGrips.CFxAlignedDimGripPointsPE,dim:DbWasm.OdDbAlignedDimension.createObject(),comp:new DbWasm.OdAlignedDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",xLine1Point:"setXLine1Point",xLine2Point:"setXLine2Point",textPosition:"setTextPosition",dimLinePoint:"setDimLinePoint",arrowFirstIsFlipped:"setArrowFirstIsFlipped",arrowSecondIsFlipped:"setArrowSecondIsFlipped"}},AcDbOrdinateDimension:{gripPointsPE:new CFxGrips.CFxOrdinateDimGripPointsPE,dim:DbWasm.OdDbOrdinateDimension.createObject(),comp:new DbWasm.OdOrdinateDimRecomputor,props:{inspectionFrame:"setInspectionFrame",inspection:"setInspection",definingPoint:"setDefiningPoint",textPosition:"setTextPosition",leaderEndPoint:"setLeaderEndPoint",origin:"setOrigin"},dependentPoints:[{name:"setLeaderEndPoint",cb:function(e,t,i,r){return i.useXAxis?r.useXAxis():r.useYAxis(),new GeNeo.OdGePoint3d(i.leaderEndPoint)}}]}},"OsDimGRIPTracker"===r.getTrackerName()&&(r.update=function(e,t){t.IsLeftButtonUp()?r.m_bLockPlacement=!0:DimensionTracker.prototype.update.call(this,e,t)},r.decorator={additionalLwPx:2,color:4288181837},r.start=function(e){delete this.ptLinePrev,DimensionTracker.prototype.start.call(this)},r.end=function(e){delete this.ptLinePrev,DimensionTracker.prototype.end.call(this)},r.getRubberPoint=function(e){this.getTrackerName();return this.m_bLockPlacement&&this.ptLinePrev||(this.ptLinePrev=DimensionTracker.prototype.getRubberPoint.call(this,e)),this.ptLinePrev}),r.Util={snapToCenter:function(e,t,i,r){var n=GeNeo.OdGeVector3d.kZAxis,n=new GeNeo.OdGePlane(t,n),o=new GeNeo.OdGePoint3d(i.xLine1Point),i=new GeNeo.OdGePoint3d(i.xLine2Point),o=n.closestPointTo(o),i=n.closestPointTo(i),n=(void 0===r&&(r=(n=o.sub(i)).angleTo(GeNeo.OdGeVector3d.kXAxis),n=GeNeo.OdGeVector3d.kXAxis.crossProduct(n),GeNeo.OdEqual(n.angleTo(GeNeo.OdGeVector3d.kZAxis),Math.PI,GeNeo.equalVector()))&&(r=Math.PI-r),new GeNeo.OdGeLine3d(o,GeNeo.OdGeVector3d.kYAxis)),a=new GeNeo.OdGeLine3d(i,GeNeo.OdGeVector3d.kYAxis),s=new GeNeo.OdGeLine3d(t,GeNeo.OdGeVector3d.kXAxis),o=GeNeo.OdGeMatrix3d.rotation(r,GeNeo.OdGeVector3d.kZAxis,o),i=GeNeo.OdGeMatrix3d.rotation(r,GeNeo.OdGeVector3d.kZAxis,i),r=GeNeo.OdGeMatrix3d.rotation(r,GeNeo.OdGeVector3d.kZAxis,t),n=n.transformBy(o),a=a.transformBy(i),s=s.transformBy(r),o=new GeNeo.OdGePoint3d,i=(n.intersectWith(s,o),new GeNeo.OdGePoint3d),r=(a.intersectWith(s,i),o.add(i.asVector().sub(o.asVector()).mult(.5))),n=e.getXeGsDevice().getActiveViewport(),a=new GeNeo.OdGePoint2d(n.PointToSCS(t));return t=new GeNeo.OdGePoint2d(n.PointToSCS(r)).distanceTo(a)<10?r:t}}},function(){ClientSideTracker.call(this),this.drawOrder=5,this.trackerName="OsDimExtLineHighlightTracker"}),DimPointHighlightTracker=(OsDimExtLineHighlightTracker.prototype=Object.create(ClientSideTracker.prototype),OsDimExtLineHighlightTracker.prototype.constructor=OsDimExtLineHighlightTracker,OsDimExtLineHighlightTracker.prototype.drawTracker=function(i){var e=window.XeActiveTrackers.TrackerData(this.trackerName);if(!e)return!0;if(i.m_XeViewport){var t,r,n=i.m_XeViewport,o=i.m_XeMyDocument.getXeGsDevice().getForeground(),a=(e.lineColor&&(o=e.lineColor),i.ctx.lineWidth=e.lineWidth,window.XeUtils.intRGBToHex(o)),o=i.m_XeMyDocument.getXeDatabase().getXeLinetypeTable().getLineDashGDI(n,"SOLID"),s=(i.ctx.setLineDash(o),i.ctx.strokeStyle=a,e.HighlightData);if(e.IsArrowHighlight)for(let t=0;t<s.length;t++){var c=n.PointToSCS(s[t].FlipPoint);let e=n.NumToSCS(s[t].Radius);e<8&&(e=8),i.ctx.fillStyle=a,i.ctx.globalAlpha=.6,i.ctx.beginPath(),i.ctx.arc(c[0],c[1],e,0,2*Math.PI),i.ctx.fill(),i.ctx.closePath()}else for(let e=0;e<s.length;e++)i.ctx.beginPath(),s[e].IsArc?(RecomputeDimBlock.SET_DRAWCONTEXT(i.ctx,n),RecomputeDimBlock.SET_TEXT_WH(0,0),RecomputeDimBlock.ADD_ARC_impl(s[e].ArcCenter,s[e].normal,s[e].start_vec,s[e].sweep_angle,s[e].ArcRadius,s[e].lineWeight,a)):(t=n.PointToSCS(s[e].FirstPoint),r=n.PointToSCS(s[e].SecondPoint),i.ctx.moveTo(t[0],t[1]),i.ctx.lineTo(r[0],r[1])),i.ctx.stroke(),i.ctx.closePath();return!0}},DimPalletTracker.prototype.X_FACTOR_ICON_LOCATION=15,DimPalletTracker.prototype.Y_FACTOR_ICON_LOCATION=-45,DimPalletTracker.prototype.init=function(e){var p=this;function a(e){return e&&"XeDimension"===e.m_ClassName&&void 0!==e.m_IsConstraintsDim&&e.m_IsConstraintsDim}function s(e){return e&&"XeBlockReference"===e.m_ClassName&&(void 0===e.m_IsVisible||e.m_IsVisible)}p.m_XeMyDocument=e,p.dimIconPosition=null,p.dimEntityHandleBySelectionSet=null,p.dimLastDimEntity=null,p.dimCurrentDimCommand=null,p.dimPreviousDimCommand=null,p.isDimPanelActive=!1,p.xeImgIcon.img.onmouseover=function(){let e=p.m_XeMyDocument,r=e.getXeDatabase();e.getXeInputPointManager();p.isDimPanelActive=!0;let t="";if(p.dimLastDimEntity){let i=p.dimLastDimEntity.getHandle();t=a(p.dimLastDimEntity)?`^C^C._OSEDITDC _BY_ID_STR ${i}
`:`^C^C._DIMPAL _BY_ID_STR ${i}
`,p.dimLastDimEntity=null,c(),p.onDimpalCommandEnded=function(e){var t=window.getXeApplication().getXeUI();if(-1===e.indexOf("OSORDINATEDIMENSION")){let e=r.getXeEntities().getByHandle(i);e&&t.requestDimIconPosition(i).then(l).then(()=>{p.dimLastDimEntity=e})}}}else{var i=r.getXeEntities(),n=e.getXeMainSelectionSet().getHandles();for(let e=n.length-1;0<=e;e--){var o=n[e],o=i.getByHandle(o);if(o&&("XeDimension"===o.m_ClassName||"OsChamferCalloutNote"===o.m_Class||s(o))){t=a(o)?"^C^C._OSEDITDC _BY_SELECTION_SET\n":"^C^C._DIMPAL _BY_SELECTION_SET\n";break}}}t&&setTimeout(function(){p.isDimPanelActive&&e.RunCmd(t).then(()=>{})},500)},p.xeImgIcon.img.onmouseout=function(){p.isDimPanelActive=!1};let m=p.isDimCommand=function(e){return-1<e.indexOf("OSSMARTDIM")||-1<e.indexOf("OSCHAMFERDIMENSION")||-1<e.indexOf("OSLINEARALIGNEDDIMENSION")||-1<e.indexOf("OSPOINTTOLINEDIM")||-1<e.indexOf("OSLINETOLINEDIM")||-1<e.indexOf("OSANGLEDIMENSION")||-1<e.indexOf("OS3POINTANGLEDIMENSION")||-1<e.indexOf("OSRADIUSDIMENSION")||-1<e.indexOf("OSDIAMETERDIMENSION")||-1<e.indexOf("OSORDINATEDIMENSION")||-1<e.indexOf("OSHOLECALLOUT")||-1<e.indexOf("OSMAXORMINDIMENSION")};function t(e,t,r){r.getXeDatabase().getXeEntities();var i=r.getXeMainSelectionSet().getHandles(),n=t.m_CommandGlobalName,o=t.m_CommandStarted,a=!o,s=(s=n)&&-1<s.indexOf("_DIMPAL"),c=m(n),l=a&&2<=t.m_CommandCounter-e.m_CommandCounter;if(!(-1<n.indexOf("OSTOGGLEMIDQUADSNAPPING")||-1<n.indexOf("OSSHEETWIDGET")||-1<n.indexOf("OSUSERSETTINGS"))){var d=p.dimIconPosition,u=p.dimEntityHandleBySelectionSet;if(g(r),p.runOnDimpalCommandEnded&&p.runOnDimpalCommandEnded(),p.dimCurrentDimCommand=o&&c?n:null,o&&c&&(p.dimPreviousDimCommand=n),!o&&!l||c||s||(p.dimPreviousDimCommand=null),!t.m_CommandStarted&&m(t.m_CommandGlobalName)&&(m(e.m_CommandGlobalName)||-1<e.m_CommandGlobalName.indexOf("OSTOGGLEMIDQUADSNAPPING"))&&(-1<t.m_CommandGlobalName.indexOf("OSORDINATEDIMENSION")&&(p.dimShowDimTrackerAfterOrdinateCmd=!0),p.dimPreviousDimCommand=null),i.length)p.dimPreviousDimCommand=null,h(r)===u?(p.dimIconPosition=d,p.dimEntityHandleBySelectionSet=u):y(r);else if(a&&s&&p.dimPreviousDimCommand){let e=p.dimPreviousDimCommand,t="^C^C",i=!0;(i=-1<e.indexOf("OSORDINATEDIMENSION")?!1:i)&&(t+="_REPEAT"),r.RunCmd(t+" "+e+"\n").then(()=>{}),p.runOnDimpalCommandEnded=function(){p.onDimpalCommandEnded&&p.onDimpalCommandEnded(e),p.runOnDimpalCommandEnded=null,p.onDimpalCommandEnded=null},p.dimPreviousDimCommand=null}}}function h(e){var t=e.getXeDatabase().getXeEntities(),i=e.getXeMainSelectionSet().getHandles();for(let e=i.length-1;0<=e;e--){var r=i[e],n=t.getByHandle(r);if(n&&("XeDimension"===n.m_ClassName||"OsChamferCalloutNote"===n.m_Class||s(n)))return r}}function g(e){p.m_XeMyDocument=e;e=window.getXeApplication().getXeUI();e&&e.resetDimIconPosition(),p.dimIconPosition=null,p.dimEntityHandleBySelectionSet=null,p.dimLastDimEntity=null}function c(){p.drawTrackerTimeout&&(clearTimeout(p.drawTrackerTimeout),p.drawTrackerTimeout=0)}function y(n){var e=(p.m_XeMyDocument=n).getXeDatabase();let t=window.getXeApplication().getXeUI(),i=e.getXeEntities();var r=n.getXeMainSelectionSet().getHandles();for(let e=r.length-1;0<=e;e--){var o=(r=>{var e=i.getByHandle(r);return e&&("XeDimension"===e.m_ClassName||"OsChamferCalloutNote"===e.m_Class||s(e))?((e=t.requestDimIconPosition(r)).then(e=>{var t=h(n),i=n.getXeDatabase().getXeEntities().getByHandle(r);t&&r===t&&i?(p.dimEntityHandleBySelectionSet=r,l(e)):(g(n),p.dimEntityHandleBySelectionSet=null)}),e):void 0})(r[e]);if(o)return o}}function l(i){new Promise((e,t)=>{e(p.dimIconPosition=i)})}document.addEventListener("PreUpdate_XeCommandProcessor",function(e){t.states.prev=e.m_Item.copy()}),document.addEventListener("Update_XeCommandProcessor",function(e){t.states.current=e.m_Item.copy(),t(t.states.prev,t.states.current,e.m_Item.getXeDocument())}),t.states={prev:{},current:{}},document.addEventListener("PreUpdate_XeEntities",function(e){}),document.addEventListener("Update_XeEntities",function(e){var t=e.m_Item;let i;for(i=0;i<e.m_UpdatedEntities.length;i++){var r=t.getByHandle(e.m_UpdatedEntities[i]);r&&("OsChamferCalloutNote"===r.m_Class||"XeDimension"===r.m_ClassName||s(r))&&(p.dimCurrentDimCommand&&(p.dimLastDimEntity=r),p.dimShowDimTrackerAfterOrdinateCmd)&&(p.dimLastDimEntity=r)}}),document.addEventListener("XeGsDevice_LastEntity",function(e){var e=e.m_Item.getXeDocument(),t=(e.getXeDatabase(),window.getXeApplication().getXeUI()),i=p.dimLastDimEntity;if(p.dimShowDimTrackerAfterOrdinateCmd=!1,g(e),p.dimLastDimEntity=i,y(e))p.dimLastDimEntity=null;else if(p.dimLastDimEntity){let e=!0;(e="_OSORDINATEDIMENSION"===p.dimCurrentDimCommand&&"AcDbOrdinateDimension"===p.dimLastDimEntity.getClass()?!1:e)&&(i=p.dimLastDimEntity.getHandle(),t.requestDimIconPosition(i).then(l))}}),document.addEventListener("Update_XeSelectionSet",function(e){var t,e=e.m_Item;!e.IsMainSelectionSet()||(t=h(e=e.getXeDocument()))&&p.dimEntityHandleBySelectionSet&&t===p.dimEntityHandleBySelectionSet||(c(),g(e),y(e))})},DimPalletTracker.prototype.drawTracker=function(e){var t=this,i=e.m_XeMyDocument;i.getXeDatabase(),i.getXeInputPointManager();if(e.m_XeViewport&&e.canvas)if(this.checkAbortDraw(e))t.hideImageDOM();else{var r=t.dimIconPosition;if(r){var n=[0,0];if(e.m_XeViewport.PointToSCSFast(n,r[0],r[1],r[2]),t.xeImgIcon.imageLoaded){if(t.bImageInsertedToDoc||(t.xeImgIcon.img.style.position="absolute",t.xeImgIcon.img.style.left="-999px",t.xeImgIcon.img.style.top="-999px",e=i.getClientTrackerWidget(),document.getElementById(e).appendChild(t.xeImgIcon.img),t.bImageInsertedToDoc=!0),n[0]=Math.floor(n[0]+DimPalletTracker.prototype.X_FACTOR_ICON_LOCATION),n[1]=Math.floor(n[1]+DimPalletTracker.prototype.Y_FACTOR_ICON_LOCATION),n[1]<0)return t.hideImageDOM(),!0;t.setImageDOMPosition(n)}}else t.hideImageDOM()}else t.hideImageDOM();return!0},DimPalletTracker.prototype.hideDueRMBMenu=function(){let e=this;var t=document.querySelectorAll("[data-object-name*='RmbMenu']");let i=!1;for(let e=0;e<t.length;e++){var r=t[e];if(r&&"none"!==r.style.display&&""!==r.style.display){i=!0;break}}i&&(e.hideImageDOM(),e.clearHideImageDOMTimeout(!1),e.hideImageDOM.timeout=setTimeout(()=>{e.clearHideImageDOMTimeout(!0)},2e3))},DimPalletTracker.prototype.update=function(e,t){this.m_XeMyDocument=e.m_XeMyDocument;e=e.m_XeMyDocument.getXeGsDevice();(e.getPan()||e.getOrbit())&&this.hideImageDOM(),this.hideDueRMBMenu()},DimPalletTracker.prototype.hideImageDOM=function(){this.xeImgIcon.img.style.display="none"},DimPalletTracker.prototype.clearHideImageDOMTimeout=function(e){var t=window.getXeActiveDocument();this.hideImageDOM.timeout&&clearTimeout(this.hideImageDOM.timeout),this.hideImageDOM.timeout=0,e&&(e=t.getXeInputPointManager().getInputPointManager().getOptions())&&(e.m_XeViewport=t.getXeGsDevice().getActiveViewport(),this.drawTracker(e))},DimPalletTracker.prototype.setImageDOMPosition_base=DimPalletTracker.prototype.setImageDOMPosition,DimPalletTracker.prototype.setImageDOMPosition=function(e){this.hideImageDOM.timeout?this.hideImageDOM():this.setImageDOMPosition_base(e)},DimPalletTracker.prototype.performResources=function(){this.xeImgIcon=new XeImage("qtresources/DimensionPalette/DimPaleteWidget.png")},DimPalletTracker.prototype.checkAbortDraw=function(e){if(e.m_XeMyDocument.getXeInputPointManager().IsClientPending())return!0;if(window.XeFxQtWidgetDimPalletManager&&window.XeFxQtWidgetDimPalletManager.isShown)return!0;var t,i=window.XeActiveTrackers.TrackerData("CFxHighlightTracker");if(i&&i.highlighted&&0<i.highlighted.length)return!0;let r=!1,n=!1,o=!1,a=!1,s=!1,c=!1,l=!1,d=!1,u=!1,p=!1;if(e.m_XeMyDocument&&e.m_XeMyDocument.getXeDatabase()&&(t=e.m_XeMyDocument.getXeDatabase().getCMDNAMES())&&t.length&&(r=!0,n=this.isDimCommand(t[0]),o="_OSORDINATEDIMENSION"===t[0],a="_OSVIEWPROPERTIES"===t[0],s="_OSIMAGEPROPERTIES"===t[0],c="_OSEDITTOLERANCE"===t[0],l="_OSMOVETOSHEET"===t[0],d="_OSBOMTABLEPROPERTIES"===t[0],u="_OSCUTLISTTABLEPROPERTIES"===t[0],p="_OSCUSTOMTABLEPROPERTIES"===t[0]),a||s||c||l||d||u||p)return!0;if(!o&&(i=window.XeActiveTrackers.TrackerData("CFxDimPointHighlightTracker"))&&i.pointArray&&0<i.pointArray.length)return!0;if(r&&!n)return!0;var m,h=e.m_XeMyDocument.getXeInputPointManager().GetDragInfo();for(m in h.waitingPreviews){var g=h.waitingPreviews[m];if(g){var y=g.getHandles();for(let e=0;e<y.length;e++){var f=y[e];if(this.dimEntityHandleBySelectionSet===f)return!0}}}return!1},function(){ClientSideTracker.call(this);this.drawType={eDrawGrip:1,eDrawCenterMark:2,eDrawBox:3}}),DrawingViewTracker=(DimPointHighlightTracker.prototype=Object.create(ClientSideTracker.prototype),DimPointHighlightTracker.prototype.constructor=DimPointHighlightTracker,DimPointHighlightTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("CFxDimPointHighlightTracker");if(t){var i=e.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),r=window.XeUtils.intRGBToHex(i),n=e.m_XeMyDocument.getXeDatabase().getDYNASNAPSIZE(),o=t.drawType;if(t.pointArray)for(var a=0;a<t.pointArray.length;a++){var s=t.pointArray[a].location;o===this.drawType.eDrawGrip?this.drawVertexTracker(e,s):o===this.drawType.eDrawCenterMark?this.drawCenterMark(e,s):(s=e.m_XeViewport.PointToSCS(s),this.drawBox(s,e,r,n),this.drawBox(s,e,r,n-2))}}return!0},DimPointHighlightTracker.prototype.drawVertexTracker=function(e,t){var t=e.m_XeViewport.PointToSCS(t),i=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),r=t[0],t=t[1];return e.ctx.fillStyle="#D8A566",e.ctx.beginPath(),e.ctx.strokeStyle="#FFFFFF",e.ctx.arc(r,t,i,0,2*Math.PI,!1),e.ctx.fill(),e.ctx.stroke(),!0},DimPointHighlightTracker.prototype.drawCenterMark=function(e,t){t=e.m_XeViewport.PointToSCS(t);return XeDimension.prototype.drawCenterMark.call(this,e.ctx,t[0],t[1],e.m_XeMyDocument)},DimPointHighlightTracker.prototype.drawBox=function(e,t,i,r){t.ctx.strokeStyle=i,t.ctx.beginPath(),t.ctx.moveTo(e[0]-r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]+r),t.ctx.lineTo(e[0]+r,e[1]-r),t.ctx.lineTo(e[0]-r,e[1]-r),t.ctx.stroke()},DragTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview,t=(e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(2),e.getXeDrawDecoration().TYPE_ENUM.Transform);return e.getXeDrawDecoration().setType(t),e.getXeDrawDecoration().setColor(window.OnshapeColors.select.rgb),e.getXeDrawDecoration().setAlpha(window.OnshapeColors.select.alpha),e},DragTracker.prototype.drawDragObjects=function(e){var t=this.getXeEntityPreview();t.setTransform(this.matrix_transform),t.draw_gdi(e,window.OnshapeColors.select.rgb,window.OnshapeColors.select.alpha)},function(){ClientSidePlacementTracker.call(this),this.drawOrder=5,this.imgUrlDummy="",this.imgDummy=new Image,this.aDynUrls=[],this.aDynImgs=[]}),ElasticArcTracker=(DrawingViewTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),DrawingViewTracker.prototype.constructor=DrawingViewTracker,DrawingViewTracker.prototype.start=function(e){this.imgDummy=new Image,this.imgUrlDummy="",this.aDynUrls=[],this.aDynImgs=[]},DrawingViewTracker.prototype.drawPreview=function(e,t,i,r,n,o,a,s){var c,l,d,u,p,m=e.ctx;m&&a&&t&&e.m_XeViewport&&(i=(p=t[0]-i/2)+i,r=(t=t[1]-r/2)+r,c=(e=e.m_XeViewport).PointToSCS(p,t,0),l=e.PointToSCS(p,r,0),d=e.PointToSCS(i,r,0),u=e.PointToSCS(i,t,0),i=[i-n,t+o,0],t=e.PointToSCS([p+n,r-o,0]),p=e.PointToSCS(i),a.complete&&a.src&&0<a.naturalWidth&&(r=(n=[p[0]-t[0],p[1]-t[1]])[0]/a.naturalWidth,m.drawImage(a,t[0],t[1]+(n[1]-(o=a.naturalHeight*r))/2,n[0],o)),m.strokeStyle=window.XeUtils.intRGBToHex(s||11511194),m.beginPath(),m.moveTo(c[0],c[1]),m.lineTo(l[0],l[1]),m.lineTo(d[0],d[1]),m.lineTo(u[0],u[1]),m.lineTo(c[0],c[1]),m.stroke())},DrawingViewTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a,s=e.m_XeMyDocument.getXeGsDevice(),c=window.XeActiveTrackers.TrackerData("COsDrawingViewTracker");return c&&(t=c.width,i=c.height,n=r=0,c.paddingLeft&&c.paddingTop&&(r=c.paddingLeft,n=c.paddingTop),o=this.imgDummy,c.imageUrl&&this.aDynUrls[c.partId]!==c.imageUrl&&(this.aDynImgs[c.partId]=new Image,this.aDynImgs[c.partId].src=c.imageUrl,this.aDynUrls[c.partId]=c.imageUrl,this.aDynImgs[c.partId].onload=function(){s&&s.invalidateClientTrackers()}),this.aDynImgs[c.partId]&&(o=this.aDynImgs[c.partId]),a=e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT())&&this.drawPreview(e,a,t,i,r,n,o,c.bordercolor),!0},function(){ClientSideTracker.call(this),self.drawOrder=10});ElasticArcTracker.prototype=Object.create(ClientSideTracker.prototype),ElasticArcTracker.prototype.constructor=ElasticArcTracker,ElasticArcTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("COsElasticArcTracker");if(void 0===t)return!1;if(0===t.radius)return!1;var i=e.ctx,r=e.m_XeViewport;if(!i||!r)return!1;RecomputeDimBlock.SET_DRAWCONTEXT(i,r),RecomputeDimBlock.SET_TEXT_WH(0,0);let n=e.m_XeMyDocument.getXeGsDevice().getForeground();t.lineColor&&-1!==t.lineColor&&(n=t.lineColor);i=window.XeUtils.intRGBToHex(n);return RecomputeDimBlock.ADD_ARC_impl(t.center,t.normal,t.start_vec,t.sweep_angle,t.radius,t.lineWeight,i),!0},FrameTracker.prototype.drawFrame=function(e,t,i,r,n,o,a,s){switch(t.colorMode){case this.ColorMode.eWhite:break;case this.ColorMode.eWhiteDashed:e.ctx.setLineDash([9,8,9,8]),0;break;case this.ColorMode.eNormalColor:a[0]<=this.x?r="#1B5FAA":(r="#FFC20E",e.ctx.setLineDash([9,8,9,8]),0);break;case this.ColorMode.eWindow:r="#1B5FAA";break;case this.ColorMode.eCrossing:r="#FFC20E",e.ctx.setLineDash([9,8,9,8]),0}e.ctx.globalAlpha=1,e.ctx.strokeStyle=r,e.ctx.beginPath();var c=n-1;s&&c++;for(var l=0;l<c;l++)e.ctx.moveTo(o[l%n][0],o[l%n][1]),e.ctx.lineTo(o[(l+1)%n][0],o[(l+1)%n][1]);e.ctx.stroke(),e.ctx.globalAlpha=.2,e.ctx.fillStyle=r,e.ctx.fillRect(a[0],a[1],this.x-a[0],this.y-a[1]),e.ctx.setLineDash([]),e.ctx.globalAlpha=1},GripPointTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview,t=(e.setSortingByDrawOrder(!1),e.setSortingByChunkOffsets(!1),e.getXeDrawDecoration().setLWThick(2),e.getXeDrawDecoration().TYPE_ENUM.Transform);return e.getXeDrawDecoration().setType(t),e.getXeDrawDecoration().setColor(window.OnshapeColors.select.rgb),e.getXeDrawDecoration().setAlpha(1),e},GripPointTracker.prototype.update=function(e,t){t.IsKeyboardEvent()},GripPointTracker.prototype.setCustomGripCursor=function(e,t){var i=t.m_XeMyDocument.getXeInputPointManager().getMousePosition(),t=t.m_XeMyDocument.getXeDatabase(),r=e.getClass(),i=e.CheckIfGrip(i);void 0===i||window.noteActive||("AcDbTable"===r?0===i||1===i||2===i||3===i?t.setCURSORMODE(11):4===i?t.setCURSORMODE(14):5===i?t.setCURSORMODE(18):6===i?t.setCURSORMODE(17):7===i?t.setCURSORMODE(19):20===i?t.setCURSORMODE(20):21===i&&t.setCURSORMODE(21):"OnshapeImage"===r?t.setCURSORMODE(9):(r=XeEntity.prototype.CustomGripModeEnum,(e=e.getCustomGripMode(i))===r.NormalResize?t.setCURSORMODE(2):e===r.Rotate?t.setCURSORMODE(12):e===r.Flip?t.setCURSORMODE(15):e!==r.AlignToEdge&&e!==r.DimensionText&&e!==r.PointAttachment&&e!==r.EdgeAttachment||t.setCURSORMODE(16)))},GripPointTracker.prototype.drawTracker=function(t){if(!this.bOnlyGL&&t.m_XeViewport){var i=t.m_XeViewport.getOverall()?2:1,r=window.OnshapeColors.grippoint,e=t.m_XeMyDocument,n=e.getXeDatabase(),o=e.getXeInputPointManager(),a=n.getGRIPSIZE(),s=n.getXeEntities(),n=(9<=n.getCURSORMODE()&&n.setCURSORMODE(2),noteEditorHandler&&noteEditorHandler.isNoteEditorActive()),c=t.m_XeMyDocument.getXeInputPointManager().getInsideCommand(),l=t.m_XeMyDocument.getXeInputPointManager().IsClientPending();t.m_XeMyDocument.getXeInputPointManager().getPENDING();if(!n&&!l&&!c){l=o.GetApertureSelection();if(l&&0<l.length){c=l[0],l=s.getByHandle(c);if(l){if(e.getViewMode()&&"OnshapeDetailViewBoundary"!==l.getClass())return!0;l.getLayerObject().getLocked()||(o.getInsideCommand()||this.setCustomGripCursor(l,t),l.IsHidden())||i!==l.getOwner()||"AcDbTable"===l.getClass()&&window.noteActive||(this.drawHoverGrip(t,l,a,r.selection_pen,r.selection_border),this.drawGrips(t,l,a,r.selection_pen,r.selection_border))}}}if(!n){if(e.getViewMode())return;var d,u=e.getXeSelectionSets().getItems();for(d in u){var p=u[d];if(p.getGripsEnabled()){var m=p.getHandles();for(let e=0;e<m.length;e++){var h=m[e],h=s.getByHandle(h);!h||h.IsHidden()||i!==h.getOwner()||this.drawGrips(t,h,a,r.selection_pen,r.selection_border)}}}}}return!0},GripPointTracker.prototype.drawHoverGrip=function(e,t,i,r,n){if(!e.m_XeViewport)return!0;var o,a=e.m_XeViewport,s=e.m_XeMyDocument.getXeInputPointManager().getMousePosition(),s=t.CheckIfGrip(s);void 0!==s&&(o=t.getGrips(),a=a.PointToSCS(o[s]),t.drawGrip(s,e.ctx,a[0],a[1],i,r,n))},GripPointTracker.prototype.drawGrips=function(t,e,i,r,n){if(!t.m_XeViewport)return!0;var o=t.m_XeViewport,a=e;if(a&&a.getGrips&&a.getGrips()&&!a.IsHidden()){var s=a.getGrips();for(let e=0;e<s.length;e++){var c=o.PointToSCS(s[e]);a.drawGrip(e,t.ctx,c[0],c[1],i,r,n)}}},HighlightTracker.prototype.bNewTableHighlight=!0,HighlightTracker.prototype.createXePreview=function(t,i,e,r,n,o,a){var s=a.getXeDatabase().getXeEntities(),c=new XeEntityPreview;if(i&&0<i.length){c.setSortingByDrawOrder(!1),c.getXeDrawDecoration().setLWThick(o),c.getXeDrawDecoration().setType(t),c.getXeDrawDecoration().setColor(e),c.getXeDrawDecoration().setAlpha(r);for(let e=0;e<i.length;e++){var l,d=i[e],d=s.getByStringGiPath(d);!d||!0===a.getViewMode()&&t===XeDrawDecoration.prototype.TYPE_ENUM.Highlight&&"OnshapeViewObject"!==d.getClass()&&"OnshapeDetailViewBoundary"!==d.getClass()||HighlightTracker.prototype.bNewTableHighlight&&"AcDbTable"===d.getClass()||void 0!==(l=d.getLayerObject())&&!0===l.getLocked()||c.addXeEntity(d,!1,n)}}return c},HighlightTracker.prototype.checkCFxDimPalletTracker=function(){var e=!1;return e=clientSideTrackersHolder.CFxDimPalletTracker&&clientSideTrackersHolder.CFxDimPalletTracker.CommandResumeHolder&&(clientSideTrackersHolder.CFxDimPalletTracker.CommandResumeHolder.bResumeLastCommand||clientSideTrackersHolder.CFxDimPalletTracker.CommandResumeHolder.bResumeNow||clientSideTrackersHolder.CFxDimPalletTracker.CommandResumeHolder.bResuming)?!0:e},HighlightTracker.prototype.addToDependencies=function(t,i){if(i&&i.length)for(let e=0;e<i.length;e++){var r=i[e];if(r){for(var n="",o=0;o<r.length;o++)0<o&&(n+="$"),n+=r[o];t.push(n)}}},HighlightTracker.prototype.drawTrackerGl=function(n,o){var a=n.getXeGsDevice().getXeDocument(),s=this.checkCFxDimPalletTracker();if(n){var c=n,l=XeDrawDecoration.prototype.TYPE_ENUM,d=window.OnshapeColors.highlight,u=window.OnshapeColors.select,p=window.OnshapeColors.dependancy,m=window.OnshapeColors.duplicates,h=window.OnshapeColors.calloutgrp,g=a.getXeDatabase().getXeEntities();if(g){var y=noteEditorHandler&&noteEditorHandler.isNoteEditorActive(),f=a.getXeInputPointManager().getInsideCommand(),_=a.getXeInputPointManager().IsClientPending(),w=(a.getXeInputPointManager().getPENDING(),window.XeActiveTrackers.TrackerData("OsDanglingDimTracker"));if(w&&w.length){var v=[];for(let e=0;e<w.length;e++){var C=w[e].handle,C=g.getByHandle(C);C&&!C.IsHidden()&&v.push(w[e])}var T=[];for(let e=0;e<v.length;e++){var b=[255,0,0],V=(v[e].rgbColor&&(b[2]=v[e].rgbColor>>16&255,b[1]=v[e].rgbColor>>8&255,b[0]=255&v[e].rgbColor),v[e].handle);T.push({key:V,color:b})}if(T.length)for(var X=0;X<T.length;X++)(N=this.createXePreview(l.Dangling,[T[X].key],T[X].color,1,function(e,t){return!("AcDbMText"===e.getClass()&&-1<t.getType().indexOf("TS"))},2,a)).draw_gl(o,n)}let t=[];var S=a.getXeSelectionSets().getItems();let e;for(e in S){var B=S[e];0<B.getHandles().length&&(t=t.concat(B.getHandles()))}let i=t.slice();y||f||_||0<(F=a.getXeInputPointManager().GetApertureSelection()).length&&(i=i.concat(F));var P=[],D=[],x=[],O=[];for(let e=0;e<i.length;e++){var G=i[e],G=g.getByHandle(G);if(G&&!G.IsHidden()){let e=G.getAssociated();HighlightTracker.prototype.bNewTableHighlight&&"AcDbTable"===G.getClass()&&(HighlightTracker.prototype.getTableDependencies(G,I={assoc:[],duplicates:[]}),this.addToDependencies(D,I.duplicates),e=I.assoc),this.addToDependencies(P,e);var E=G.getLeaders();if(E)for(var A=0;A<E.length;A++){var U=E[A];U&&(e=U.getAssociated(),this.addToDependencies(P,e))}}if(G&&!y){var I=G.getNoteAnnotations();if(void 0!==I&&void 0!==I[0]){var W=JSON.parse(I[0].ids);for(let e=0;e<W.length;e++){var H=W[e];t.indexOf(H)<0&&x.push(H)}}var k={set:[]};document.osObjectsGroup.GetCalloutGroup(G,k);for(let e=0;e<k.set.length;++e)t.indexOf(k.set[e])<0&&x.push(k.set[e])}if(void 0!==G&&"OnshapeDatum"===G.getClass()){var M=G.getSecondaryDatums();if(void 0!==M&&void 0!==M[0]){var j=JSON.parse(M[0].ids);for(let e=0;e<j.length;e++){var z=j[e];t.indexOf(z)<0&&x.push(z)}}}if(void 0!==G&&("OnshapeDetailViewBoundary"===G.getClass()||"OnshapeJoggedSectionLine"===G.getClass()||"OnshapeAuxiliaryLine"===G.getClass())){for(let e=0;e<P.length;++e)O.push(P[e]);P=[]}}if(!s&&c.getActive()&&0<x.length&&(N=this.createXePreview(l.GroupSet,x,h.rgb,h.alpha,null,2,a)).draw_gl(o,n),!s&&c.getActive()){var Y=[];for(let e=0;e<O.length;e++){var q=O[e];t.includes(q)||Y.push(q)}0<Y.length&&(N=this.createXePreview(l.SpecialSelectionSet,Y,p.rgb,p.alpha,null,2,a)).draw_gl(o,n)}if(!s&&c.getActive()){var K=[];for(let e=0;e<P.length;e++){var Z=P[e];t.includes(Z)||K.push(Z)}0<K.length&&(N=this.createXePreview(l.SelectionSet,K,p.rgb,p.alpha,null,2,a)).draw_gl(o,n)}!s&&c.getActive()&&0<D.length&&(N=this.createXePreview(l.SelectionSet,D,m.rgb,m.alpha,null,2,a)).draw_gl(o,n);let r;for(e in S){var J,Q,L=S[e];L.IsMainSelectionSet()?r=L:(L.m_XePreview||0<L.getHandles().length&&(J=window.XeUtils.hexToRgbArray(window.XeUtils.intRGBToHex(L.getColor())),Q=1==L.getType()?l.Highlight:l.SelectionSet,L.m_XePreview=this.createXePreview(Q,L.getHandles(),J,L.getAlpha(),null,L.getThickness(),a)),L.m_XePreview&&L.m_XePreview.draw_gl(o,n))}if(r&&(r.m_XePreview||0<r.getHandles().length&&(r.m_XePreview=this.createXePreview(l.SelectionSet,r.getHandles(),u.rgb,u.alpha,null,2,a)),r.m_XePreview)&&r.m_XePreview.draw_gl(o,n),y||f||_){var R=window.XeActiveTrackers.TrackerData("CFxHighlightTracker");if(R&&0<R.highlighted.length){var $=[],ee=[];for(let e=0;e<R.highlighted.length;e++){var te=R.highlighted[e];(te.includes("$")?ee:$).push(te)}var N,F=a.getXeInputPointManager().getInsideSelect(),h=a.getXeInputPointManager().getInsideNEntsel(),s=F&&!h?l.Highlight:l.SelectionSet,c=(h||F?d:u).rgb,m=(h||F?d:u).alpha;(N=this.createXePreview(s,$,c,m,null,2,a))&&N.draw_gl(o,n),(N=this.createXePreview(l.SelectionSet,ee,c,m,null,2,a))&&N.draw_gl(o,n)}}else a.getXeInputPointManager().GetApertureSelection();if(!y&&!f&&!_){var ie=a.getXeInputPointManager().GetApertureSelection();if(0<ie.length){var re=[];for(let e=0;e<ie.length;e++){var ne=ie[e],oe=g.getByHandle(ne);oe&&!oe.getLayerObject().getLocked()&&re.push(ne)}0<re.length&&(N=this.createXePreview(l.Highlight,re,d.rgb,d.alpha,null,2,a)).draw_gl(o,n)}}h=window.XeActiveTrackers.TrackerData("COsSheetFlyoutViewSelectionTracker");h&&0<h.annotations.length&&(N=this.createXePreview(l.SelectionSet,h.annotations,p.rgb,p.alpha,null,2,a)).draw_gl(o,n)}}},HighlightTracker.prototype.drawTracker=function(t){var i=t.m_XeViewport;if(!i)return!0;if(t.ctx){var r=t.m_XeMyDocument,n=r.getXeDatabase().getXeEntities();if(n){var o=r.getXeInputPointManager(),a=window.OnshapeColors.highlight,s=(window.OnshapeColors.select,window.OnshapeColors.dependancy,r.getXeDatabase().getGRIPSIZE()),c=window.XeActiveTrackers.TrackerData("OsDanglingDimTracker"),l=noteEditorHandler&&noteEditorHandler.isNoteEditorActive(),d=r.getXeInputPointManager().getInsideCommand(),u=r.getXeInputPointManager().IsClientPending();r.getXeInputPointManager().getPENDING();let e=[];l||d||u||0<(d=r.getXeInputPointManager().GetApertureSelection()).length&&(e=e.concat(d));var p,m=r.getXeSelectionSets().getItems();for(p in m){var h=m[p];0<h.getHandles().length&&(e=e.concat(h.getHandles()))}var g=0,y=0;if(!l&&c&&c.length)for(g=0;g<c.length;g++){var f=c[g].pts,_=c[g].handle,_=n.getByHandle(_);if(_&&!_.IsHidden())for(y=0;y<f.length;y++){var w=i.PointToSCS(f[y]),v=window.XeUtils.intRGBToHex(c[g].rgbColor);this.drawPoint(t.ctx,w[0],w[1],s,v,v)}}this.drawOrdinateLine(t,e),r.getViewMode()&&(d=(u=r.getXeInputPointManager().GetApertureSelection())&&u[0])&&n&&(r=n.getByHandle(d))&&!r.IsHidden()&&this.highlightAssociatedPoints(t,r);var C,u=o.getHitTestInfo(),T=[u.GetMousePosition().x,u.GetMousePosition().y];if(HighlightTracker.prototype.bNewTableHighlight)if(!l)if(0<e.length)for(C of new Set(e)){var b,X=n.getByStringGiPath(C);X&&!X.IsHidden()&&(void 0===(b=X.getLayerObject())||!0!==b.getLocked())&&("AcDbTable"===X.getClass()?HighlightTracker.prototype.highlightTable(t,T,X,a.color,!0,!1,!1):this.highlightAssociatedPoints(t,X))}}}},HighlightTracker.prototype.highlightTable=function(e,t,i,r,n,o,a){if(!e.m_XeMyDocument.getViewMode()&&!i.IsHidden()){var s=e.m_XeMyDocument.getXeDatabase(),c=window.XeUtils,l=e.m_XeViewport;if(!l)return!0;var d=e.ctx;if(d){var u=window.getXeCallbacksContainer().proc(i,"UpdateTableSelection",l),p=i.getEntityData(),e=(p.ONSHAPE_BOM_XDATA||p.ONSHAPE_HOLE_TABLE_XDATA||p.ONSHAPE_REVISION_TABLE_XDATA||p.ONSHAPE_CUTLIST_XDATA||p.ONSHAPE_FEATURESCRIPT_TABLE_XDATA)&&!0,m={header_row:c.RGBtoRGBA("#ebebeb").rgba,content_cell:c.RGBtoRGBA("#f1f1f1").rgba,hover_cell:c.RGBtoRGBA("#e2e2e2").rgba};const T=2,b=4;var h=p.cellIntersection;if(h.intersects){var g=null,y=m.hover_cell;if(n&&!e&&v(d,y,g=u[h.row][h.column]),o||e){var f,_=new Set;for(let t=0;t<u[h.row].length;t++)if(v(d,y,g=u[h.row][t]),t===h.column)for(let e=0;e<u.length;e++)e!==h.row&&C(u,e,t,g)&&_.add(e);for(f of _)for(let e=0;e<u[f].length;e++)g=u[f][e],1<f&&C(u,f-1,e,g)||v(d,y,g)}if(a||e)for(let i=0;i<u.length;i++)if(i!==h.row)for(let t=0;t<u[i].length;t++){let e=m.content_cell;var w=p.cells[i][t].rowType;w!==b&&w!==T||(e=m.header_row),g=u[i][t],1<i&&C(u,i-1,t,g)||v(d,e,g)}}c=0===p.flowDirection?-1:1,n=[0,0],o=(d.strokeStyle=r,0|p.tableStyle.lw_kDataRow_kHorzTop);if(-1===o){a=i.getLayerObject();if(!a)return;o=a.getLineWeight()}-2!==o&&-3!==o||(o=s.getLWDEFAULT()),d.lineCap="square",d.lineWidth=RecomputeDimBlock._getLwPx(l,o)+1,d.globalAlpha=1,d.beginPath(),l.PointToSCSFast(n,p.position[0],p.position[1],p.position[2]),d.moveTo(n[0],n[1]);e=[0,0];function v(t,e,i){t.globalAlpha=1,t.strokeStyle=e,t.fillStyle=e,t.lineWidth=1,t.beginPath(),t.moveTo(i[0][0],i[0][1]);for(let e=1;e<i.length;e++)t.lineTo(i[e][0],i[e][1]);t.lineTo(i[0][0],i[0][1]),t.fill()}function C(e,t,i,r){var n=e[t][i];let o=!0;for(let e=0;e<n.length;e++)if(n[e][0]!==r[e][0]||n[e][1]!==r[e][1]){o=!1;break}return o}l.PointToSCSFast(e,p.position[0]+p.width,p.position[1],p.position[2]),d.lineTo(e[0],e[1]),l.PointToSCSFast(e,p.position[0]+p.width,p.position[1]+c*p.height,p.position[2]),d.lineTo(e[0],e[1]),l.PointToSCSFast(e,p.position[0],p.position[1]+c*p.height,p.position[2]),d.lineTo(e[0],e[1]),d.lineTo(n[0],n[1]),d.stroke()}}},HighlightTracker.prototype.getTableDependencies=function(e,t){var i=e.getEntityData(),r=i.assocPaths,n=i.duplicatesAssocPaths;let o=[],a=[];if(r&&0!==r.length){var s,c=window.getXeCallbacksContainer().proc(e,"UpdateTableSelection"),l=i.cellIntersection,d=c[l.row][l.column],u=new Set;o=o.concat(r[l.row]),a=a.concat(n[l.row]);for(let e=0;e<c.length;e++)if(e!==l.row){var p=c[e][l.column];let t=!0;for(let e=0;e<p.length;e++)if(p[e][0]!==d[e][0]||p[e][1]!==d[e][1]){t=!1;break}t&&u.add(e)}for(s of u)o=o.concat(r[s]),a=a.concat(n[s]);t.assoc=o,t.duplicates=a}},HighlightTracker.prototype.drawPoint=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.fill(),e.stroke()},HighlightTracker.prototype.CheckIfGrip=function(e,t){var i=e.getLayerObject();if(i&&!0!==i.getLocked()){var r,i=e.getGrips(),n=e.getXeDatabase().getGRIPSIZE(),e=(n*=n,e.getXeDatabase().getXeDocument().getXeGsDevice().getActiveViewport());if(!(i.length<3))return r=[0,0],(i=i[2])&&(e.PointToSCSFast(r,i[0],i[1],i[2]),e=r[0],i=r[1],r=t[0],(e-=r)*e+(r=i-t[1])*r<=n)?2:void 0}},HighlightTracker.prototype.drawOrdinateLine=function(e,t){var i=e.m_XeViewport;if(!i)return!0;var r=e.m_XeMyDocument.getXeDatabase().getXeEntities();if(r){var t=t&&t[0],n=r[t];if((n=n||r.getByHandle(t))&&void 0!==n.getOrdinateParentId){t=n.getOrdinateParentId();if(null!=(t=null===t?n.getHandle():t)){var o=r.getByHandle(t);if(null!=o){var a=o.getChildHandles();if(void 0!==a){a.push(t);for(var s=0;s<a.length;s++){var c,l,d,u,p,m,h=a[s],h=r.getByHandle(h);void 0!==h&&(h=h.getOrdinateLinePoints())&&(c=e.m_XeMyDocument.getXeInputPointManager().getCursorPosition(),l=h[0],d=h[1],p=h[3],m=h[4],u=[0,0],e.m_XeMyDocument.getXeGsDevice().getActiveViewport().PointToSCSFast(u,c[0],c[1],c[2]),this.CheckIfGrip(n,u))&&(c=e.m_XeMyDocument.getXeDatabase().getGRIPCOLOR(),u=e.m_XeMyDocument.getXeProfile().getGripAlpha(),c=window.XeUtils.intRGBAToHex(c,u),u=window.XeUtils.rgbaToHex(0,0,0,u),e.ctx.setLineDash([2,5]),e.ctx.fillStyle=c,e.ctx.strokeStyle=u,e.ctx.beginPath(),l=(c=i.PointToSCS(h[0],h[1],0))[0],d=c[1],p=(u=i.PointToSCS(h[3],h[4],0))[0],m=u[1],e.ctx.moveTo(l,d),e.ctx.lineTo(p,m),e.ctx.fill(),e.ctx.stroke())}a.pop()}}}}return!0}},HighlightTracker.prototype.highlightAssociatedPoints=function(e,t){var r=e.m_XeMyDocument.getXeInputPointManager();if(r&&!(1<t.getGiPath().length)){var n=e.m_XeViewport;if(!n)return!0;var r=e.m_XeMyDocument.getXeDatabase().getXeEntities(),i=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE();if(r&&t&&!t.IsHidden()){(!t.m_IsForeshortenDim||void 0!==t.m_ForeshortenType&&2===t.m_ForeshortenType)&&(o=t.getAssociatedPoints());var o,a=window.OnshapeColors.dependancy.color;if(o)for(var s=0;s<o.length;s+=3){var c=n.PointToSCS(o[s],o[s+1],o[s+2]);this.drawPoint(e.ctx,c[0],c[1],i,a,"#FFFFFF")}var l=t.getAssociatedFilledAreaPoints();if(l){var r=window.XeUtils.RGBtoRGBA(a).rgba,d=e.ctx;d.fillStyle=r,d.strokeStyle=r,d.lineWidth=1;let i;for(let t=0;t<l.length;t+=3){let e=n.PointToSCS(l[t],l[t+1],l[t+2]);0===t?(i=e,d.beginPath(),d.moveTo(e[0],e[1])):d.lineTo(e[0],e[1])}i&&(d.lineTo(i[0],i[1]),d.fill())}var u=t.getLeaders();if(u)for(var p=0;p<u.length;p++){var m=u[p];if(m&&!m.IsHidden()&&(o=m.getAssociatedPoints()))for(var h=0;h<o.length;h+=3){var g=n.PointToSCS(o[h],o[h+1],o[h+2]);this.drawPoint(e.ctx,g[0],g[1],i,a,"#FFFFFF")}}}}};let OsHoleTableTracker=function(){ClientSideTracker.call(this),this.drawOrder=10,this.matrix_transform=new GeNeo.OdGeMatrix3d,this.xeTableEntityPreview=void 0,this.tableToHighlight=void 0};OsHoleTableTracker.prototype=Object.create(ClientSideTracker.prototype),OsHoleTableTracker.prototype.constructor=OsHoleTableTracker,OsHoleTableTracker.prototype.createXeTableEntityPreview=function(){var e=new XeEntityPreview;return e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(0),e},OsHoleTableTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var i=t.m_XeViewport,e=t.m_XeMyDocument.getXeInputPointManager(),r=window.XeActiveTrackers.TrackerData("COsHoleTableTracker");if(r){var n=r.highlightpoints;for(let e=0;e<n.length;++e){var o=i.PointToSCS(n[e][0],n[e][1]),a=t.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),s=window.OnshapeColors.select.color;this.drawPoint(t.ctx,o[0],o[1],a,s,"#FFFFFF")}var c,l,d,u=r.activeView,p=(u&&u.viewFramePoints&&((d=[]).push(i.PointToSCS(u.viewFramePoints[0])),d.push(i.PointToSCS(u.viewFramePoints[1])),d.push(i.PointToSCS(u.viewFramePoints[2])),d.push(i.PointToSCS(u.viewFramePoints[3])),u=window.OnshapeColors.highlight.color,this.drawFrame(t.ctx,d,u)),r.views);for(let e=0;e<p.length;++e)p[e]&&p[e].viewFramePoints&&((c=[]).push(i.PointToSCS(p[e].viewFramePoints[0])),c.push(i.PointToSCS(p[e].viewFramePoints[1])),c.push(i.PointToSCS(p[e].viewFramePoints[2])),c.push(i.PointToSCS(p[e].viewFramePoints[3])),l=window.OnshapeColors.dependancy.color,this.drawFrame(t.ctx,c,l));this.tableToHighlight&&(u=[(d=e.getHitTestInfo()).GetMousePosition().x,d.GetMousePosition().y],r=window.OnshapeColors.highlight,HighlightTracker.prototype.highlightTable(t,u,this.tableToHighlight,r.color,!1,!1,!1))}}return!0},OsHoleTableTracker.prototype.createXeEntityPreview=function(e){var t=new XeEntityPreview,i=(t.setSortingByDrawOrder(!1),t.getXeDrawDecoration().setLWThick(2),t.getXeDrawDecoration().TYPE_ENUM.SelectionSet);return t.getXeDrawDecoration().setType(i),t.getXeDrawDecoration().setColor(e.rgb),t.getXeDrawDecoration().setAlpha(e.alpha),t},OsHoleTableTracker.prototype.setMatrixTransform=function(e,t){this.matrix_transform.setentry(0,3,e[0]-t[0]),this.matrix_transform.setentry(1,3,e[1]-t[1]),this.matrix_transform.setentry(2,3,e[2]-t[2]),this.matrix_transform.setentry(3,3,1)},OsHoleTableTracker.prototype.clearXeEntityPreview=function(){this.xeTableEntityPreview&&(this.xeTableEntityPreview.deallocate(),this.xeTableEntityPreview=void 0,this.matrix_transform=new GeNeo.OdGeMatrix3d)},OsHoleTableTracker.prototype.start=function(e){},OsHoleTableTracker.prototype.end=function(e){this.clearXeEntityPreview()},OsHoleTableTracker.prototype.deallocate=function(e){this.clearXeEntityPreview()},OsHoleTableTracker.prototype.drawTrackerGl=function(e,t){if(!e)return!0;var i=window.XeActiveTrackers.TrackerData("COsHoleTableTracker");if(!i)return!0;var r=e.getXeGsDevice().getXeDocument(),n=r.getXeDatabase().getXeEntities();if(i.tableHandle){if(!this.xeTableEntityPreview){if(void 0===n)return!0;var o=n.getByHandle(i.tableHandle);if(void 0===o)return!0;if(this.xeTableEntityPreview=this.createXeTableEntityPreview(),this.xeTableEntityPreview.addXeEntity(o,!0),!o.IsHidden()){o.Hide();var o=r.getXeGsDevice();if(o)return void o.invalidateScene()}}if(this.xeTableEntityPreview)return o=r.getXeInputPointManager().getMousePosition(),o=e.PointToWCS(o.x,o.y,!0),this.setMatrixTransform(o,i.ptTablePosition),this.xeTableEntityPreview.setTransform(this.matrix_transform),this.xeTableEntityPreview.draw_gl(t,e),!0}if(!i.selectedHoles||!i.highlightedHoles||!i.duplicatedHoles)return!0;if(0<i.highlightedHoles.length){var a=this.createXeEntityPreview(window.OnshapeColors.highlight);for(let e=0;e<i.highlightedHoles.length;e++){var s=i.highlightedHoles[e],s=n.getByStringGiPath(s);s&&a.addXeEntity(s,!1)}a.draw_gl(t,e)}let c=i.selectedHoles,l=i.duplicatedHoles;r.getXeMainSelectionSet();function d(t,i){if(t&&t.length)for(let e=0;e<t.length;e++){var r=t[e];if(r){for(var n="m_",o=0;o<r.length;o++)0<o&&(n+="$"),n+=r[o];i&&!0===i?l.indexOf(n)<=-1&&l.push(n):c.indexOf(n)<=-1&&c.push(n)}}}this.tableToHighlight=void 0;var u=i.tableHandlesForCrossHighlight;if(u&&u.length)for(let e=0;e<u.length;e++){var p=u[e],p=n.getByHandle(p);p&&(window.getXeCallbacksContainer().proc(p,"UpdateTableSelection"),p.getEntityData().cellIntersection.intersects)&&(this.tableToHighlight=p,HighlightTracker.prototype.getTableDependencies(p,p={assoc:[],duplicates:[]}),d(p.assoc,!1),d(p.duplicates,!0))}if(0<c.length){var m,h=this.createXeEntityPreview(window.OnshapeColors.dependancy);for(let e=0;e<c.length;e++){let t=c[e];i.highlightedHoles.find(e=>e===t)||(m=n.getByStringGiPath(t))&&h.addXeEntity(m,!1)}h.draw_gl(t,e)}if(0<l.length){var g,y=this.createXeEntityPreview(window.OnshapeColors.duplicates);for(let e=0;e<l.length;e++){let t=l[e];i.highlightedHoles.find(e=>e===t)||(g=n.getByStringGiPath(t))&&y.addXeEntity(g,!1)}y.draw_gl(t,e)}},OsHoleTableTracker.prototype.drawPoint=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.fill(),e.stroke()},OsHoleTableTracker.prototype.drawFrame=function(e,t,i){e.strokeStyle=i,e.lineWidth=3,e.beginPath(),e.moveTo(t[0][0],t[0][1]),e.lineTo(t[1][0],t[1][1]),e.lineTo(t[2][0],t[2][1]),e.lineTo(t[3][0],t[3][1]),e.lineTo(t[0][0],t[0][1]),e.closePath(),e.stroke()};var ImageTracker=function(){ClientSidePlacementTracker.call(this),this.drawOrder=5,this.img=new Image,this.imgUrl=""};ImageTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),ImageTracker.prototype.constructor=ImageTracker,ImageTracker.prototype.start=function(e){this.img=new Image,this.imgUrl=""},ImageTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a,s=e.m_XeMyDocument.getXeGsDevice(),c=window.XeActiveTrackers.TrackerData("COsImageTracker");return c&&(c.imageUrl&&this.imgUrl!==c.imageUrl&&(this.img.src=c.imageUrl,this.imgUrl=c.imageUrl,this.img.onload=function(){s&&s.invalidateClientTrackers()}),t=new GeNeo.OdGePoint3d(c.firstCorner),i=new GeNeo.OdGePoint3d(e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT()),r=Math.abs(i.x-t.x),o=n=Math.abs(i.y-t.y),0<c.ratio&&(o=r/c.ratio),0===n&&(n=o,i.y=t.y+n),(a=[])[0]=t.x+(i.x-t.x)/2,a[1]=t.y+(i.y-t.y)*o/n/2,a)&&this.drawPreview(e,a,r,o,0,0,this.img,c.bordercolor),!0};class OsInferenceConstraintsTracker extends ClientSideTracker{constructor(){super(),this.drawOrder=16,this.iconsList=[],this.osIconMap=void 0,this.snapPosAlign={x:5,y:5};var e=document.createElement("div");e.className="icons-container",e.style.position="absolute",this.iconsContainer=e}start(){var e=window.getXeActiveDocument().getClientTrackerWidget();document.getElementById(e).appendChild(this.iconsContainer),this.osIconMap=getOsIconMap()}end(){var e=window.getXeActiveDocument().getClientTrackerWidget();document.getElementById(e).removeChild(this.iconsContainer)}setIconsSetVisible(e){this.iconsContainer.style.display=e?"":"none"}setIconContainerPos(e){this.iconsContainer.style.left=e[0]+this.snapPosAlign.x+"px",this.iconsContainer.style.top=e[1]+this.snapPosAlign.y+"px"}update(t,e){var i=window.XeActiveTrackers.TrackerData("CFxInferenceConstraintsTracker");if(i&&i.snapPos){var r=i.snapPos;if(r!==this.snapPos)this.iconsContainer.replaceChildren();else if(this.iconsContainer.childElementCount)return!0;this.snapPos=r;let e=t.m_XeMyDocument.getXeGsDevice().getActiveViewport();var n;this.setIconContainerPos((t=r[0],n=r[1],r=r[2],e.PointToSCS(t,n,r))),i.arrCnTypes.forEach(e=>{e=this.osIconMap.get(e),e=new OsConstraintIconInference(e);this.iconsContainer.appendChild(e.imgContainer)})}else this.iconsContainer.replaceChildren();return!0}}var JogSectionViewCutLineTracker=function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.Direction={eVertical:0,eHorizontal:1,eAngular:2,eAligned:3},this.DrawFlags={eDrawGripPoint:1,eDrawInitialCutline:2,eDrawAngleCutline:4,eDrawPreviewCutline:8,eDrawJogLine:16,eDrawAlignedCutline:32,eDrawAlignedViewPlane:64,eDrawAlignedRevolvePlane:128},this.ArrowHead={Filled:"ClosedFilled",Unfilled:"Closed",Dot:"DotSmall",Open:"Open"}},JogSectionViewPlacementTracker=(JogSectionViewCutLineTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),JogSectionViewCutLineTracker.prototype.constructor=JogSectionViewCutLineTracker,JogSectionViewCutLineTracker.prototype.drawTracker=function(n){if(n.m_XeViewport){var o=n.m_XeMyDocument,a=window.XeActiveTrackers.TrackerData("COsJogSectionViewCutLineTracker");if(a){var e=new GeNeo.OdGeVector3d(o.getXeInputPointManager().getRUBBERPOINT());if(e){var s=new GeNeo.OdGePoint3d(e.x,e.y,0),t=[this.DrawFlags.eDrawInitialCutline,this.DrawFlags.eDrawAngleCutline,this.DrawFlags.eDrawPreviewCutline,this.DrawFlags.eDrawGripPoint,this.DrawFlags.eDrawJogLine,this.DrawFlags.eDrawAlignedCutline,this.DrawFlags.eDrawAlignedViewPlane,this.DrawFlags.eDrawAlignedRevolvePlane];try{for(var i=0;i<t.length;i++){var c,r,l,d,u,p,m,h=a.drawFlags&t[i];switch(h){case this.DrawFlags.eDrawGripPoint:this.drawGripPoints(n,a.pointArray),a.highlightedPoint&&a.direction===this.Direction.eAligned&&this.highlightPoint(n,a.highlightedPoint);break;case this.DrawFlags.eDrawInitialCutline:var g=this.getInitialPointArray(a,s);this.initialDraw(n,a,g);break;case this.DrawFlags.eDrawAngleCutline:n.ctx.lineWidth=1,this.initCanvas(n,a),c=this.computePointArray(a,!0,!0,o),r=this.computeLineDirection(a,o),l=[],this.drawCutline(n,c,l,r);break;case this.DrawFlags.eDrawPreviewCutline:a.pointArray.length<1||(a.lineWeight?n.ctx.lineWidth=this.convertLineWeightToPixel(a.lineWeight,o):n.ctx.lineWidth=3,this.initCanvas(n,a),c=this.computePointArray(a,!1,!0,o),r=this.computeLineDirection(a,o),0<(l=a.proportionArray.slice()).length&&(l.splice(0,0,.5),l.push(.5)),this.drawCutline(n,c,l,r),!0===a.editTracker?(d=new GeNeo.OdGeVector3d(a.arrowDirection[0],a.arrowDirection[1],0)).isZeroLength()&&(d=this.computeArrowDirection(c[0],s,r),a.isFlipped)&&d.negate():(d=this.computeArrowDirection(c[0],s,r),a.isFlipped&&d.negate()),n.ctx.setLineDash([]),this.drawArrow(n,c[0],d,a.arrowSize,a.isFirstAngle,a.arrowHead),this.drawArrow(n,c[c.length-1],d,a.arrowSize,a.isFirstAngle,a.arrowHead));break;case this.DrawFlags.eDrawJogLine:a.pointArray.length<1||(n.ctx.lineWidth=1,this.initCanvas(n,a),c=this.computePointArray(a,!0,!1,o),r=this.computeLineDirection(a,o),l=a.proportionArray.slice(),this.drawCutline(n,c,l,r));break;case this.DrawFlags.eDrawAlignedCutline:{if(a.pointArray.length<1)break;a.lineWeight?n.ctx.lineWidth=this.convertLineWeightToPixel(a.lineWeight,o):n.ctx.lineWidth=3,this.initCanvas(n,a);var y=this.computeAlignPointArray(a,!0,!1,!0,o);this.drawAlignedLinePoints(n,y),n.ctx.setLineDash([]);let e,t;if(!0===a.editTracker)if(2==a.pointArray.length)e=this.computeAlignedArrowDirection(y,!0),(t=this.computeAlignedArrowDirection(y,!1)).negate(),a.sameAlignedViewDir&&(e.negate(),t.negate()),a.isFlipped&&(e.negate(),t.negate());else{if(a.pointArray.length<2)break;e=new GeNeo.OdGeVector3d(a.arrowDirection[0],a.arrowDirection[1],0),t=new GeNeo.OdGeVector3d(a.alignedArrowDirection[0],a.alignedArrowDirection[1],0)}else e=this.computeAlignedArrowDirection(y,!0),t=this.computeAlignedArrowDirection(y,!1);this.drawArrow(n,y[0],e,a.arrowSize,a.isFirstAngle,a.arrowHead),this.drawArrow(n,y[y.length-1],t,a.arrowSize,a.isFirstAngle,a.arrowHead)}break;case this.DrawFlags.eDrawAlignedViewPlane:{if(a.pointArray.length<1)break;a.lineWeight?n.ctx.lineWidth=this.convertLineWeightToPixel(a.lineWeight,o):n.ctx.lineWidth=3,this.initCanvas(n,a),c=this.computeAlignPointArray(a,!0,!0,!1,o),r=this.computAlignLineDirection(a,o),this.drawAlignedLinePoints(n,c);let e,t;if(!0===a.editTracker){if(a.pointArray.length<2)break;2==a.pointArray.length?(e=this.computeAlignedArrowDirection(c,!0),(t=this.computeAlignedArrowDirection(c,!1)).negate(),new GeNeo.OdGeVector3d(a.arrowDirection[0],a.arrowDirection[1],0),new GeNeo.OdGeVector3d(a.alignedArrowDirection[0],a.alignedArrowDirection[1],0).isCodirectionalTo(t)||(e.negate(),t.negate())):(e=new GeNeo.OdGeVector3d(a.arrowDirection[0],a.arrowDirection[1],0),t=new GeNeo.OdGeVector3d(a.alignedArrowDirection[0],a.alignedArrowDirection[1],0))}else e=this.computeAlignedArrowDirection(c,!0),t=this.computeAlignedArrowDirection(c,!1);n.ctx.setLineDash([]),this.drawArrow(n,c[0],e,a.arrowSize,a.isFirstAngle,a.arrowHead),this.drawArrow(n,c[c.length-1],t,a.arrowSize,a.isFirstAngle,a.arrowHead)}break;case this.DrawFlags.eDrawAlignedRevolvePlane:{if(a.pointArray.length<2)break;a.lineWeight?n.ctx.lineWidth=this.convertLineWeightToPixel(a.lineWeight,o):n.ctx.lineWidth=3,this.initCanvas(n,a),c=this.computeRevolvePlanePointArray(a,!0,o),this.drawAlignedLinePoints(n,c);let e=new GeNeo.OdGeVector3d(s.x-a.pointArray[0].location[0],s.y-a.pointArray[0].location[1],0),t=((e=e.normalize()).negate(),this.computAlignLineDirection(a,o)),i,r;if(!0===a.editTracker){if(a.pointArray.length<2)break;2==a.pointArray.length?(i=this.computeAlignedArrowDirection(c,!0),(r=this.computeAlignedArrowDirection(c,!1)).negate(),u=new GeNeo.OdGeVector3d(a.arrowDirection[0],a.arrowDirection[1],0),new GeNeo.OdGeVector3d(a.alignedArrowDirection[0],a.alignedArrowDirection[1],0),u.isCodirectionalTo(r)||(i.negate(),r.negate())):(i=new GeNeo.OdGeVector3d(a.arrowDirection[0],a.arrowDirection[1],0),r=new GeNeo.OdGeVector3d(a.alignedArrowDirection[0],a.alignedArrowDirection[1],0))}else i=this.computeArrowDirection(c[2],c[3],e),r=this.computeArrowDirection(c[1],s,t),2<a.pointArray.length&&((e=(e=new GeNeo.OdGeVector3d(a.pointArray[2].location[0]-a.pointArray[0].location[0],a.pointArray[2].location[1]-a.pointArray[0].location[1],0)).normalize()).negate(),(t=(t=new GeNeo.OdGeVector3d(a.pointArray[1].location[0]-a.pointArray[0].location[0],a.pointArray[1].location[1]-a.pointArray[0].location[1],0)).normalize()).negate(),i=this.computeArrowDirection(c[0],s,t),r=this.computeArrowDirection(c[c.length-1],s,e),(p=t.normalize()).rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),(m=e.normalize()).rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),i.isCodirectionalTo(p)&&m.negate(),r=m,a.isFlipped)&&(i.negate(),r.negate());n.ctx.setLineDash([]),this.drawArrow(n,c[0],i,a.arrowSize,a.isFirstAngle,a.arrowHead),this.drawArrow(n,c[c.length-1],r,a.arrowSize,a.isFirstAngle,a.arrowHead)}break;default:0!=h&&window.XeLogger.log("No Draw Function define for Flag: "+h)}}}catch(e){}}}}return!0},JogSectionViewCutLineTracker.prototype.computeAlignedArrowDirection=function(e,t){let i,r;t?((i=new GeNeo.OdGeVector3d(e[0])).z=0,(r=new GeNeo.OdGeVector3d(e[1])).z=0):((i=new GeNeo.OdGeVector3d(e[e.length-1])).z=0,(r=new GeNeo.OdGeVector3d(e[e.length-2])).z=0);t=r.sub(i).normalize();return t.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),t},JogSectionViewCutLineTracker.prototype.computeAlignPointArray=function(r,i,n,o,a){var s=[];let c=new GeNeo.OdGePoint3d(r.pointArray[0].location[0],r.pointArray[0].location[1],0),l,d;if(r.editTracker){if(1<r.pointArray.length){var u=new GeNeo.OdGePoint3d(a.getXeInputPointManager().getRUBBERPOINT()),u=new GeNeo.OdGePoint3d(u.x,u.y,0);d=2==r.pointArray.length?(l=o?(r.isAlignedCenterPointValid||(c=u),new GeNeo.OdGePoint3d(r.pointArray[0].location[0],r.pointArray[0].location[1],0)):u,new GeNeo.OdGePoint3d(r.pointArray[1].location[0],r.pointArray[1].location[1],0)):(l=new GeNeo.OdGePoint3d(r.pointArray[1].location[0],r.pointArray[1].location[1],0),new GeNeo.OdGePoint3d(r.pointArray[2].location[0],r.pointArray[2].location[1],0));let t=new GeNeo.OdGeVector3d(c.x-l.x,c.y-l.y,0),i=new GeNeo.OdGeVector3d(c.x-d.x,c.y-d.y,0);t=t.normalize(),i=i.normalize();o=[r.minext,r.maxext];if(0<r.pointArray.length){let e=[];e=this.getIntersectionPoint(l,t,o),0<(e=this.sortAngularPoints(e,t)).length&&(t.negate(),e[0].x=e[0].x+t.x*r.startOffsetProportion*r.offset,e[0].y=e[0].y+t.y*r.startOffsetProportion*r.offset,s.push(e[0])),s.push(c),e=[],e=this.getIntersectionPoint(d,i,o),0<(e=this.sortAngularPoints(e,i)).length&&(i.negate(),e[0].x=e[0].x+i.x*r.endOffsetProportion*r.offset,e[0].y=e[0].y+i.y*r.endOffsetProportion*r.offset,s.push(e[0]))}}}else{let t=new GeNeo.OdGeVector3d(0,1,0);u=new GeNeo.OdGeVector3d(-.7071,.7071,0);if(!0===i){o=[r.minext,r.maxext];if(0<r.pointArray.length){let e=[];e=this.getIntersectionPoint(c,u,o),0<(e=this.sortAngularPoints(e,u)).length&&(u.negate(),e[0].x=e[0].x+u.x*r.startOffsetProportion*r.offset,e[0].y=e[0].y+u.y*r.startOffsetProportion*r.offset,s.push(e[0]),u.negate()),s.push(c);i=this.computAlignLineDirection(r,a);(t=n?new GeNeo.OdGeVector3d(i.x,i.y,i.z):t).negate(),e=[],e=this.getIntersectionPoint(c,t,o),0<(e=this.sortAngularPoints(e,t)).length&&(t.negate(),e[0].x=e[0].x+t.x*r.endOffsetProportion*r.offset,e[0].y=e[0].y+t.y*r.endOffsetProportion*r.offset,s.push(e[0]),t.negate())}}}return s},JogSectionViewCutLineTracker.prototype.computeRevolvePlanePointArray=function(t,i,r){let n=[];for(let e=0;e<t.pointArray.length;++e){var o=new GeNeo.OdGePoint3d(t.pointArray[e].location[0],t.pointArray[e].location[1],0);n.push(o)}let e,a,s,c;if(t.pointArray.length<3){if(e=new GeNeo.OdGeVector3d(r.getXeInputPointManager().getRUBBERPOINT()),a=new GeNeo.OdGePoint3d(e.x,e.y,0),(s=(s=new GeNeo.OdGeVector3d(a.x-t.pointArray[0].location[0],a.y-t.pointArray[0].location[1],0)).normalize()).negate(),!0===i){i=[t.minext,t.maxext];if(0<n.length){var l=n[0],d=n[n.length-1];let e=[];e=this.getIntersectionPoint(l,s,i),0<(e=this.sortAngularPoints(e,s)).length&&(s.negate(),e[0].x=e[0].x+s.x*t.startOffsetProportion*t.offset,e[0].y=e[0].y+s.y*t.startOffsetProportion*t.offset,n.splice(0,0,e[0]),s.negate());l=this.computAlignLineDirection(t,r),r=new GeNeo.OdGeVector3d(l.x,l.y,l.z);r.negate(),e=[],e=this.getIntersectionPoint(d,r,i),0<(e=this.sortAngularPoints(e,r)).length&&(r.negate(),e[0].x=e[0].x+r.x*t.startOffsetProportion*t.offset,e[0].y=e[0].y+r.y*t.startOffsetProportion*t.offset,n.push(e[0]))}}}else{(s=(s=new GeNeo.OdGeVector3d(t.pointArray[2].location[0]-t.pointArray[0].location[0],t.pointArray[2].location[1]-t.pointArray[0].location[1],0)).normalize()).negate(),(c=(c=new GeNeo.OdGeVector3d(t.pointArray[1].location[0]-t.pointArray[0].location[0],t.pointArray[1].location[1]-t.pointArray[0].location[1],0)).normalize()).negate();l=[],d=[t.minext,t.maxext];if(0<n.length){i=n[1],r=n[2];let e=[];e=this.getIntersectionPoint(i,c,d),0<(e=this.sortAngularPoints(e,c)).length&&(c.negate(),e[0].x=e[0].x+c.x*t.startOffsetProportion*t.offset,e[0].y=e[0].y+c.y*t.startOffsetProportion*t.offset),l.push(e[0]),l.push(i),l.push(n[0]),e=[],e=this.getIntersectionPoint(r,s,d),0<(e=this.sortAngularPoints(e,s)).length&&(s.negate(),e[0].x=e[0].x+s.x*t.endOffsetProportion*t.offset,e[0].y=e[0].y+s.y*t.endOffsetProportion*t.offset),l.push(r),l.push(e[0]),n=l}}return n},JogSectionViewCutLineTracker.prototype.drawAlignedLinePoints=function(t,i){let r=null;var n;let o;t.ctx.beginPath();for(let e=0;e<i.length;++e)n=i[e],r=(null!==r?(o=t.m_XeViewport.PointToSCS(n),t.ctx.lineTo(o[0],o[1])):(o=t.m_XeViewport.PointToSCS(n),t.ctx.moveTo(o[0],o[1])),n);t.ctx.stroke()},JogSectionViewCutLineTracker.prototype.computAlignLineDirection=function(e,t){let i=new GeNeo.OdGeVector3d;return e.direction==this.Direction.eAligned&&e.pointArray.length<2?(t=new GeNeo.OdGeVector3d(t.getXeInputPointManager().getRUBBERPOINT()),t=new GeNeo.OdGePoint3d(t.x,t.y,0),(i=new GeNeo.OdGeVector3d(t.x-e.pointArray[0].location[0],t.y-e.pointArray[0].location[1],0)).isZeroLength()||(i=i.normalize())):(i=new GeNeo.OdGeVector3d(e.pointArray[1].location[0]-e.pointArray[0].location[0],e.pointArray[1].location[1]-e.pointArray[0].location[1],0)).isZeroLength()||(i=i.normalize()),i=i.isZeroLength()?new GeNeo.OdGeVector3d(0,0,1):i},JogSectionViewCutLineTracker.prototype.convertLineWeightToPixel=function(e,t){var i;return!window.XeLineweightUtils.useModelSpaceLwAlways()&&t.getXeGsDevice().getOverallViewport()?(t=t.getXeGsDevice().getActiveViewport(),(i=window.XeLineweightUtils.GetLineWeightInPixels(t,e))<1&&(i=1),1<(i=Math.round(i))&&1==(1&i)&&i++):i=window.XeLineweightUtils.getStndLineWeightPxSize(e,!0),i},JogSectionViewCutLineTracker.prototype.getInitialPointArray=function(t,e){var i=new GeNeo.OdGePoint3d(e.x,e.y,0),r=new GeNeo.OdGePoint3d(e.x,e.y,0),e=new GeNeo.OdGePoint3d(e.x,e.y,0),n=t.direction,o=t.height,a=t.width,s=t.offset;let c;if(n===this.Direction.eVertical)i.y=i.y-o/2+s,r.y=r.y+o/2-s,c=[i,r];else if(n===this.Direction.eHorizontal)i.x=i.x-a/2-s,r.x=r.x+a/2+s,c=[i,r];else if(n===this.Direction.eAngular){if(t.enableCutAngle){var l=t.cutAngleDirection[0],t=t.cutAngleDirection[1];let e;e=Math.abs(l)>Math.abs(t)?a/2/Math.abs(l):o/2/Math.abs(t),i.x=i.x+e*l,i.y=i.y+e*t,r.x=r.x-e*l,r.y=r.y-e*t}else i.x=i.x+a/2-s,i.y=i.y+o/2+s,r.x=r.x-a/2+s,r.y=r.y-o/2-s;c=[i,r]}else n===this.Direction.eAligned&&(i.y=i.y+o/2+s,r.x=r.x+a/2+s,r.y=r.y-o/2+s,c=[i,e,r]);return c},JogSectionViewCutLineTracker.prototype.initialDraw=function(e,t,i){var r=e.m_XeViewport,n=t.direction,o=new GeNeo.OdGePoint3d(r.PointToSCS(i[0])),a=new GeNeo.OdGePoint3d(r.PointToSCS(i[1]));let s=o.x,c=o.y,l=a.x,d=a.y;var u=e.m_XeMyDocument.getXeGsDevice().getForeground(),u=window.XeUtils.intRGBToHex(u);e.ctx.strokeStyle=u,e.ctx.setLineDash([5,2]),e.ctx.beginPath(),n===this.Direction.eAligned?!1===t.editTracker&&(o=new GeNeo.OdGePoint3d(r.PointToSCS(i[0])),u=new GeNeo.OdGePoint3d(r.PointToSCS(i[1])),a=new GeNeo.OdGePoint3d(r.PointToSCS(i[2])),s=o.x,c=o.y,l=a.x,d=a.y,n=u.x,t=u.y,e.ctx.moveTo(s,c),e.ctx.lineTo(n,t),e.ctx.lineTo(l,d)):(e.ctx.moveTo(s,c),e.ctx.lineTo(l,d));i=e.m_XeMyDocument.getXeDatabase(),o=i.getXeLinetypeTable(),a=0===i.getMEASUREMENT()?"ONS_PHANTOM":"ONS_DASHDOT",u=o.getLineDashGDI(r,a);e.ctx.setLineDash(u),e.ctx.stroke(),e.ctx.setLineDash([])},JogSectionViewCutLineTracker.prototype.initCanvas=function(e,t){var i=e.m_XeMyDocument.getXeDatabase(),r=i.getXeLinetypeTable(),i=0===i.getMEASUREMENT()?"ONS_PHANTOM":"ONS_DASHDOT",r=r.getLineDashGDI(e.m_XeViewport,i),i=(e.ctx.setLineDash(r),e.m_XeMyDocument.getXeGsDevice().getForeground()),r=(t.lineColor&&(i=t.lineColor),window.XeUtils.intRGBToHex(i));e.ctx.strokeStyle=r,e.ctx.fillStyle=r},JogSectionViewCutLineTracker.prototype.contains=function(e,t,i){return i[0]>e[0]&&i[1]>e[1]&&i[0]<t[0]&&i[1]<t[1]},JogSectionViewCutLineTracker.prototype.computeLineDirection=function(e,t){new GeNeo.OdGeVector3d;return e.enableCutAngle?new GeNeo.OdGeVector3d(e.cutAngleDirection).normalize():e.direction==this.Direction.eAngular&&e.pointArray.length<2?(t=new GeNeo.OdGeVector3d(t.getXeInputPointManager().getRUBBERPOINT()),t=new GeNeo.OdGePoint3d(t.x,t.y,0),new GeNeo.OdGeVector3d(t.x-e.pointArray[0].location[0],t.y-e.pointArray[0].location[1],0).normalize()):new GeNeo.OdGeVector3d(e.lineDirection[0],e.lineDirection[1],0)},JogSectionViewCutLineTracker.prototype.computeArrowDirection=function(e,t,i){t=new GeNeo.OdGeVector3d(t.x-e.x,t.y-e.y,0),e=i.crossProduct(t),t=i.crossProduct(e);return t.isZeroLength()&&(t=new GeNeo.OdGeVector3d(i.x,i.y,i.z)).rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),t.normalize()},JogSectionViewCutLineTracker.prototype.getIntersectionPoint=function(e,t,i){for(var r=i[0],i=i[1],n=[],o=[],a=(n.push(new GeNeo.OdGePoint3d(r[0],r[1],0)),n.push(new GeNeo.OdGePoint3d(r[0],i[1],0)),n.push(new GeNeo.OdGePoint3d(i[0],i[1],0)),n.push(new GeNeo.OdGePoint3d(i[0],r[1],0)),n.push(new GeNeo.OdGePoint3d(r[0],r[1],0)),new GeNeo.OdGeLine3d(e,t)),s=t.perpVector(),c=0;c<n.length;c++){var l=new GeNeo.OdGeLine3d(new GeNeo.OdGePoint3d(n[c].x,n[c].y,0),s),d=new GeNeo.OdGePoint3d;a.intersectWith(l,d)&&(d.z=0,o.push(d))}return o},JogSectionViewCutLineTracker.prototype.sortAngularPoints=function(e,t){if(e.length<2)return e;for(var i=new GeNeo.OdGeLine3d(e[0],t),r=new GeNeo.OdGePoint3d,n=[],o=[],a=[],s=0;s<e.length;++s){var c=i.closestPointTo(e[s]);if(0===n.length)n.push(c),r=c,a.push(0),o.push(e[s]);else if(new GeNeo.OdGeVector3d(c.x-r.x,c.y-r.y,0).isCodirectionalTo(t)){for(var l=r.distanceTo(c),d=!1,u=0;u<a.length;++u)if(a[u]>l){d=!0,n.splice(u,0,c),a.splice(u,0,l),o.splice(u,0,e[s]);break}!1===d&&(n.push(c),a.push(l),o.push(e[s]))}else{n.splice(0,0,r=c),o.splice(0,0,e[s]);for(var a=[],p=0;p<n.length;++p)a.push(r.distanceTo(n[p]))}}return o},JogSectionViewCutLineTracker.prototype.computePointArray=function(e,t,i,r){var n=[];!0===t&&(t=[(t=new GeNeo.OdGeVector3d(r.getXeInputPointManager().getRUBBERPOINT())).x,t.y,0],!0===this.contains(e.viewportminext,e.viewportmaxext,t))&&(t=new GeNeo.OdGePoint3d(t[0],t[1],0),n.push(t));for(var o=0;o<e.pointArray.length;++o){var a=new GeNeo.OdGePoint3d(e.pointArray[o].location[0],e.pointArray[o].location[1],0);n.push(a)}var s,c,t=this.computeLineDirection(e,r),n=this.sortAngularPoints(n,t);return!0===i&&(r=[e.minext,e.maxext],0<n.length)&&(i=n[0],s=n[n.length-1],t=new GeNeo.OdGeVector3d(t.x,t.y,t.z),c=[],c=this.getIntersectionPoint(i,t,r),0<(c=this.sortAngularPoints(c,t)).length&&(t.negate(),c[0].x=c[0].x+t.x*e.startOffsetProportion*e.offset,c[0].y=c[0].y+t.y*e.startOffsetProportion*e.offset,n.splice(0,0,c[0]),t.negate()),t.negate(),c=[],c=this.getIntersectionPoint(s,t,r),0<(c=this.sortAngularPoints(c,t)).length)&&(t.negate(),c[0].x=c[0].x+t.x*e.endOffsetProportion*e.offset,c[0].y=c[0].y+t.y*e.endOffsetProportion*e.offset,n.push(c[0])),n},JogSectionViewCutLineTracker.prototype.drawCutline=function(e,t,i,r){var n=null;e.ctx.beginPath();for(var o=0;o<t.length;++o)var a,s,c,l=t[o],n=(null!==n?(a=new GeNeo.OdGeLine3d(n,r).closestPointTo(l),a=n.distanceTo(a),c=.5,o-1<i.length&&(c=i[o-1]),c=new GeNeo.OdGePoint3d(n.x+a*c*r.x,n.y+a*c*r.y,0),s=.5,o-1<i.length&&(s=1-i[o-1]),a=new GeNeo.OdGePoint3d(l.x-a*s*r.x,l.y-a*s*r.y,0),s=e.m_XeViewport.PointToSCS(c),e.ctx.lineTo(s[0],s[1]),c=e.m_XeViewport.PointToSCS(a),e.ctx.lineTo(c[0],c[1]),s=e.m_XeViewport.PointToSCS(l),e.ctx.lineTo(s[0],s[1])):(s=e.m_XeViewport.PointToSCS(l),e.ctx.moveTo(s[0],s[1])),l);e.ctx.stroke()},JogSectionViewCutLineTracker.prototype.drawArrow=function(e,t,i,r,n,o){var a=n?0:2*r,i=GeNeo.OdGeVector3d.kXAxis.angleTo(i,GeNeo.OdGeVector3d.kZAxis);if(n&&(i+=Math.PI),e.ctx.beginPath(),o&&o===this.ArrowHead.Open){var n=e.m_XeMyDocument.getXeDatabase().getMEASUREMENT()?[new GeNeo.OdGePoint3d(a,0,0),new GeNeo.OdGePoint3d(a-r,r/6,0),new GeNeo.OdGePoint3d(a-r,r/24,0),new GeNeo.OdGePoint3d(a-2*r,r/120,0),new GeNeo.OdGePoint3d(0,0,0),new GeNeo.OdGePoint3d(a-r,-r/24,0),new GeNeo.OdGePoint3d(a-r,-r/6,0)]:[new GeNeo.OdGePoint3d(a,0,0),new GeNeo.OdGePoint3d(a-r,r/6,0),new GeNeo.OdGePoint3d(a-r,r/24,0),new GeNeo.OdGePoint3d(2*r,r/120,0),new GeNeo.OdGePoint3d(a-2*r,-r/25e3,0),new GeNeo.OdGePoint3d(a-r,-r/24,0),new GeNeo.OdGePoint3d(a-r,-r/6,0)],s=new GeNeo.OdGeMatrix3d,c=(s.setToRotation(i,GeNeo.OdGeVector3d.kZAxis,t),new GeNeo.OdGeMatrix3d),s=(c.setTranslation(t),s.mult(c)),c=(n[0].transformBy(s),e.m_XeViewport.PointToSCS(n[0]));e.ctx.moveTo(c[0],c[1]),n[1].transformBy(s),c=e.m_XeViewport.PointToSCS(n[1]),e.ctx.lineTo(c[0],c[1]),n[2].transformBy(s),c=e.m_XeViewport.PointToSCS(n[2]),e.ctx.moveTo(c[0],c[1]),n[3].transformBy(s),c=e.m_XeViewport.PointToSCS(n[3]),e.ctx.moveTo(c[0],c[1]),n[4].transformBy(s),c=e.m_XeViewport.PointToSCS(n[4]),e.ctx.lineTo(c[0],c[1]),n[5].transformBy(s),c=e.m_XeViewport.PointToSCS(n[5]),e.ctx.moveTo(c[0],c[1]),n[6].transformBy(s),c=e.m_XeViewport.PointToSCS(n[6]),e.ctx.moveTo(c[0],c[1]),c=e.m_XeViewport.PointToSCS(n[0]),e.ctx.lineTo(c[0],c[1]),e.ctx.stroke()}else{var l=[new GeNeo.OdGePoint3d(a,0,0),new GeNeo.OdGePoint3d(a-r,r/6,0),new GeNeo.OdGePoint3d(a-r,r/24,0),new GeNeo.OdGePoint3d(a-2*r,r/24,0),new GeNeo.OdGePoint3d(a-2*r,-r/24,0),new GeNeo.OdGePoint3d(a-r,-r/24,0),new GeNeo.OdGePoint3d(a-r,-r/6,0)],s=new GeNeo.OdGeMatrix3d,n=(s.setToRotation(i,GeNeo.OdGeVector3d.kZAxis,t),new GeNeo.OdGeMatrix3d),d=(n.setTranslation(t),s.mult(n)),u=(l[0].transformBy(d),e.m_XeViewport.PointToSCS(l[0]));e.ctx.moveTo(u[0],u[1]);for(var p=1;p<l.length;++p)l[p].transformBy(d),u=e.m_XeViewport.PointToSCS(l[p]),e.ctx.lineTo(u[0],u[1]);o&&o===this.ArrowHead.Unfilled?(u=e.m_XeViewport.PointToSCS(l[0]),e.ctx.lineTo(u[0],u[1]),e.ctx.stroke()):e.ctx.fill()}},JogSectionViewCutLineTracker.prototype.drawGripPoints=function(e,t){var i=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE();e.ctx.fillStyle=window.OnshapeColors.grippoint.selection_pen,e.ctx.strokeStyle="#FFFFFF";for(var r=0;r<t.length;r++){var n=t[r].location,n=e.m_XeViewport.PointToSCS(n);e.ctx.beginPath(),e.ctx.arc(n[0],n[1],i,0,2*Math.PI,!1),e.ctx.fill(),e.ctx.stroke()}return!0},JogSectionViewCutLineTracker.prototype.highlightPoint=function(e,t){var i=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),t=(e.ctx.fillStyle=window.OnshapeColors.grippoint.dependancy_pen,e.ctx.strokeStyle="#FFFFFF",e.m_XeViewport.PointToSCS(t));return e.ctx.beginPath(),e.ctx.arc(t[0],t[1],i,0,2*Math.PI,!1),e.ctx.fill(),e.ctx.stroke(),!0},function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.img=new Image,this.imgSrc="",this.Direction={eVertical:0,eHorizontal:1,eAngular:2,eAligned:3},this.DrawFlags={eRubberPreview:1,eFixedPositionPreview:2}}),OsJoggedSectionLineGripPointsTracker=(JogSectionViewPlacementTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),JogSectionViewPlacementTracker.prototype.constructor=JogSectionViewPlacementTracker,JogSectionViewPlacementTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var e=window.XeActiveTrackers.TrackerData("COsJogSectionViewPlacementTracker");if(e)for(var i=t.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT(),r=e.cutlinestart,n=e.cutlineend,o=e.width,a=e.height,s=e.direction,c=e.minext,l=e.maxext,d=(e.imgPath?this.imgSrc!==e.imgPath&&(this.imgSrc=e.imgPath,this.img.src=e.imgPath,this.img.onload=function(){var e=t.m_XeMyDocument.getXeGsDevice();e&&e.invalidateClientTrackers()}):(this.imgSrc="",this.img.src=""),0),u=0,p=(e.paddingLeft&&e.paddingTop&&(d=e.paddingLeft,u=e.paddingTop),i),m=[this.DrawFlags.eRubberPreview,this.DrawFlags.eFixedPositionPreview],h=0;h<m.length;h++){var g=e.drawFlags&m[h];switch(g){case this.DrawFlags.eRubberPreview:if(!0===this.contains(c,l,i))return!0;p=this.getAlignedPosition(i,r,n,s,e),this.drawPreview(t,p,o,a,d,u,this.img,e.bordercolor);break;case this.DrawFlags.eFixedPositionPreview:e.position&&(p=e.position),p=this.getAlignedPosition(p,r,n,s,e),this.drawPreview(t,p,o,a,d,u,this.img,e.bordercolor);break;default:0!=g&&window.XeLogger.log("No Draw Function define for Flag: "+g)}}return!0}},JogSectionViewPlacementTracker.prototype.contains=function(e,t,i){return i[0]>e[0]&&i[1]>e[1]&&i[0]<t[0]&&i[1]<t[1]},JogSectionViewPlacementTracker.prototype.getAlignedPosition=function(t,i,r,n,o){var a=t,s=(i[0]+r[0])/2,c=(i[1]+r[1])/2;if(n==this.Direction.eVertical)a[1]=c;else if(n==this.Direction.eHorizontal)a[0]=s;else if(n==this.Direction.eAligned){var l=o.alignedViewEndPoint,d=(i[0]+l[0])/2,u=(i[1]+l[1])/2,p=new GeNeo.OdGePoint3d(t[0],t[1],0),d=new GeNeo.OdGeVector3d(d,u,0),u=new GeNeo.OdGePoint3d(i[0],i[1],0),l=new GeNeo.OdGePoint3d(l[0],l[1],0),u=new GeNeo.OdGeLine3d(u,l).closestPointTo(p),l=new GeNeo.OdGeVector3d(p.x-u.x,p.y-u.y,0),p=new GeNeo.OdGeVector3d(d.x+l.x,d.y+l.y,0),u=new GeNeo.OdGePoint3d(p.x,p.y,p.z);a[0]=u.x,a[1]=u.y}else if(n==this.Direction.eAngular){d=new GeNeo.OdGePoint3d(t[0],t[1],0);let e=new GeNeo.OdGeVector3d(s,c,0);l=new GeNeo.OdGePoint3d(i[0],i[1],0),p=new GeNeo.OdGePoint3d(r[0],r[1],0),u=new GeNeo.OdGeLine3d,r=(o.enableCutAngle?((n=new GeNeo.OdGeVector3d(o.cutAngleDirection).normalize()).z=0,t=new GeNeo.OdGeLine3d(l,n).closestPointTo(p),s=new GeNeo.OdGePoint3d(t.x,t.y,0),u.set(l,s),c=(l.x+s.x)/2,i=(l.y+s.y)/2,e=new GeNeo.OdGeVector3d(c,i,0)):u.set(l,p),u.closestPointTo(d)),o=new GeNeo.OdGeVector3d(d.x-r.x,d.y-r.y,0),n=new GeNeo.OdGeVector3d(e.x+o.x,e.y+o.y,0),t=new GeNeo.OdGePoint3d(n.x,n.y,n.z);a[0]=t.x,a[1]=t.y}return a},function(){JogSectionViewCutLineTracker.call(this),this.GripType={eStartOffsetGrip:0,eEndOffsetGrip:1,eJoggedGrip:2,eAttachementGrip:3,eLowerLabelGrip:4,eUpperLabelGrip:5,eInvalidGrip:6}}),JoggedSectionLine=(OsJoggedSectionLineGripPointsTracker.prototype=Object.create(JogSectionViewCutLineTracker.prototype),OsJoggedSectionLineGripPointsTracker.prototype.constructor=JogSectionViewCutLineTracker,OsJoggedSectionLineGripPointsTracker.prototype.getRubberPoint=function(e){var t;return this.m_bLockPlacement?t=this.ptLinePrev||e.getXeInputPointManager().getRUBBERPOINT():(t=e.getXeInputPointManager().getSpecificRubberPoint(),this.ptLinePrev=t),new GeNeo.OdGePoint3d(t)},OsJoggedSectionLineGripPointsTracker.prototype.start=function(e){delete this.ptLinePrev,this.m_bLockPlacement=!1},OsJoggedSectionLineGripPointsTracker.prototype.end=function(e){delete this.ptLinePrev,this.m_bLockPlacement=!1},OsJoggedSectionLineGripPointsTracker.prototype.update=function(e,t){t.IsLeftButtonUp()&&(this.m_bLockPlacement=!0)},OsJoggedSectionLineGripPointsTracker.prototype.getGripPoints=function(e){var t=[];return e.getDirection()===JoggedSectionLine.Direction.eAligned?(t.push(e.getAlignedViewOffsetPoint(!0)),t.push(e.getAlignedViewOffsetPoint(!1))):(t.push(e.getOffsetPoint(!0)),t.push(e.getOffsetPoint(!1))),t=t.concat(e.getOriginalAttachmentArray()),(t=e.getDirection()!=JoggedSectionLine.Direction.eAligned?t.concat(e.getJoggedPointArray()):t).push(e.getTextPoint(!0)),t.push(e.getTextPoint(!1)),t},OsJoggedSectionLineGripPointsTracker.prototype.moveGripPointsAt=function(e,t,i){for(var r in t){var n=t[r];switch(this.computeGripType(e,n)){case this.GripType.eStartOffsetGrip:this.moveOffsetPoints(e,!0,i);break;case this.GripType.eEndOffsetGrip:this.moveOffsetPoints(e,!1,i);break;case this.GripType.eAttachementGrip:this.moveAttachementPoints(e,n-2,i);break;case this.GripType.eJoggedGrip:var o=n-e.getAttachmentPointArraySize()-2;this.moveJoggedPoints(e,o,i);break;case this.GripType.eUpperLabelGrip:this.moveLabelPoints(e,!0,i);break;case this.GripType.eLowerLabelGrip:this.moveLabelPoints(e,!1,i)}}},OsJoggedSectionLineGripPointsTracker.prototype.getOptions=function(){return this.options||window.XeActiveTrackers.TrackerData("OsJoggedSectionLineGripPointsTracker")},OsJoggedSectionLineGripPointsTracker.prototype.drawTracker=function(e){var t=this.getOptions();if(!t)return!0;var i=new JoggedSectionLine(t),r=this.getRubberPoint(e.m_XeMyDocument),n=new GeNeo.OdGePoint3d(t.lastPoint),r=new GeNeo.OdGeVector3d(r.x,r.y,r.z);new GeNeo.OdGeVector3d(n.x,n.y,n.z).isEqualTo(r)||(n=this.getGripPoints(i),t.gripIndex<n.length&&(n=n[t.gripIndex],r=r.setToDiff(r,n),n=[t.gripIndex],this.moveGripPointsAt(i,n,r),i.clearCache()));i.dim={m_dimlwd:0,m_dimgap:1},i.draw_gdi(e,{additionalLwPx:0}),this.options=null},OsJoggedSectionLineGripPointsTracker.prototype.computeGripType=function(e,t){var i,r=this.GripType.eInvalidGrip;return e&&(i=e.getAttachmentPointArraySize(),e=e.getJoggedPointArraySize(),t<2?r=0===t?this.GripType.eStartOffsetGrip:this.GripType.eEndOffsetGrip:t<i+2?r=this.GripType.eAttachementGrip:t<e+i+2?r=this.GripType.eJoggedGrip:t===(i=i+e+2)?r=this.GripType.eUpperLabelGrip:t===i+1&&(r=this.GripType.eLowerLabelGrip)),r},OsJoggedSectionLineGripPointsTracker.prototype.moveAttachementPoints=function(e,t,i){var i=e.getOriginalAttachmentPoint(t).add(i),r=e.getGeomExtents();r.isValidExtents()&&r.contains(i)&&(r=e.getDirectionVector(),e.setAttachmentPoint(t,i),e.getDirection()===JoggedSectionLine.Direction.eAngular)&&(t=e.getDirectionVector(),i=r.angleTo(t,GeNeo.OdGeVector3d.kZAxis),(r=e.getViewDirection()).rotateBy(i,GeNeo.OdGeVector3d.kZAxis),e.setViewDirection(r))},OsJoggedSectionLineGripPointsTracker.prototype.moveJoggedPoints=function(e,t,i){var r=e.getSortedAttachmentPointArray(),n=Math.floor(t/2),o=e.getLineCoordinate(r[n]),r=e.getLineCoordinate(r[n+1]),t=e.getJoggedPoint(t).add(i),i=e.getLineCoordinate(t);i<o||r<i||(e.getProportion(n),e.setProportion(n,(i-o)/(r-o)))},OsJoggedSectionLineGripPointsTracker.prototype.moveOffsetPoints=function(e,t,i){var r,n,o;e.getDirection()===JoggedSectionLine.Direction.eAligned?(r=e.getAlignedViewExtentPoint(t),r=e.getAlignLineCoordinate(r,t),n=e.getAlignedViewOffsetPoint(t).add(i),n=e.getAlignLineCoordinate(n,t),o=e.getAlignedAttachmentPoint(t),e.getAlignLineCoordinate(o,t),e.getAlignedDirectionVector(t),o=(t?-1:1)*(n-r)/e.maxOffset(),o=Math.min(o,1),e.setOffsetProportion(t,o)):(n=e.getExtentPoint(t),r=e.getLineCoordinate(n),o=e.getOffsetPoint(t).add(i),n=e.getLineCoordinate(o),i=e.getAttachmentPoint(t),e.getLineCoordinate(i),e.getDirectionVector(),o=(t?-1:1)*(n-r)/e.maxOffset(),o=Math.min(o,1),e.setOffsetProportion(t,o))},OsJoggedSectionLineGripPointsTracker.prototype.moveLabelPoints=function(e,t,i){i=e.getLabelOffset(t).add(i);e.setLabelOffset(t,i)},function(e){for(var m=this,d=e.d,a=[],t=[],r=null,n=null,i=e.enableCutAngle,o=e.cutAngleDirection,u=0;u<e.a.length;++u)a[u]=new GeNeo.OdGePoint3d(e.a[u]),t[u]=new GeNeo.OdGePoint3d(e.a[u]);function p(e,t,i,r){G.setLocation(new GeNeo.OdGePoint3d(i,r,0)),G.draw()}function h(e,t,i,r,n,o){m.getDirectionVector();var a=C?0:2*f,n=GeNeo.OdGeVector3d.kXAxis.angleTo(n,GeNeo.OdGeVector3d.kZAxis);if(C&&(n+=Math.PI),e.beginPath(),_&&"Open"===_){var o=o.m_XeMyDocument.getXeDatabase().getMEASUREMENT()?[new GeNeo.OdGePoint3d(a,0,0),new GeNeo.OdGePoint3d(a-f,f/6,0),new GeNeo.OdGePoint3d(a-f,f/24,0),new GeNeo.OdGePoint3d(a-2*f,f/120,0),new GeNeo.OdGePoint3d(0,0,0),new GeNeo.OdGePoint3d(a-f,-f/24,0),new GeNeo.OdGePoint3d(a-f,-f/6,0)]:[new GeNeo.OdGePoint3d(a,0,0),new GeNeo.OdGePoint3d(a-f,f/6,0),new GeNeo.OdGePoint3d(a-f,f/24,0),new GeNeo.OdGePoint3d(2*f,f/120,0),new GeNeo.OdGePoint3d(a-2*f,-f/25e3,0),new GeNeo.OdGePoint3d(a-f,-f/24,0),new GeNeo.OdGePoint3d(a-f,-f/6,0)],s=new GeNeo.OdGeMatrix3d,c=(s.setToRotation(n,GeNeo.OdGeVector3d.kZAxis,new GeNeo.OdGePoint3d(i,r,0)),new GeNeo.OdGeMatrix3d),s=(c.setTranslation(new GeNeo.OdGeVector3d(i,r,0)),s.mult(c)),c=(o[0].transformBy(s),t.PointToSCS(o[0]));e.moveTo(c[0],c[1]),o[1].transformBy(s),c=t.PointToSCS(o[1]),e.lineTo(c[0],c[1]),o[2].transformBy(s),c=t.PointToSCS(o[2]),e.moveTo(c[0],c[1]),o[3].transformBy(s),c=t.PointToSCS(o[3]),e.moveTo(c[0],c[1]),o[4].transformBy(s),c=t.PointToSCS(o[4]),e.lineTo(c[0],c[1]),o[5].transformBy(s),c=t.PointToSCS(o[5]),e.moveTo(c[0],c[1]),o[6].transformBy(s),c=t.PointToSCS(o[6]),e.moveTo(c[0],c[1]),c=t.PointToSCS(o[0]),e.lineTo(c[0],c[1]),e.stroke()}else{var l=[new GeNeo.OdGePoint3d(a,0,0),new GeNeo.OdGePoint3d(a-f,f/6,0),new GeNeo.OdGePoint3d(a-f,f/24,0),new GeNeo.OdGePoint3d(a-2*f,f/24,0),new GeNeo.OdGePoint3d(a-2*f,-f/24,0),new GeNeo.OdGePoint3d(a-f,-f/24,0),new GeNeo.OdGePoint3d(a-f,-f/6,0)],s=new GeNeo.OdGeMatrix3d,o=(s.setToRotation(n,GeNeo.OdGeVector3d.kZAxis,new GeNeo.OdGePoint3d(i,r,0)),new GeNeo.OdGeMatrix3d),d=(o.setTranslation(new GeNeo.OdGeVector3d(i,r,0)),s.mult(o)),u=(l[0].transformBy(d),t.PointToSCS(l[0]));e.moveTo(u[0],u[1]);for(var p=1;p<l.length;++p)l[p].transformBy(d),u=t.PointToSCS(l[p]),e.lineTo(u[0],u[1]);_&&"Closed"===_?(u=t.PointToSCS(l[0]),e.lineTo(u[0],u[1]),e.stroke()):e.fill()}}var s=e.j.slice(),c=new GeNeo.OdGePoint3d(e.uL),l=new GeNeo.OdGePoint3d(e.lL),g=new GeNeo.OdGeExtents3d(GeNeo.OdGePoint3d.kOrigin,GeNeo.OdGePoint3d.kOrigin),y=(e.gE&&(g=new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(e.gE[0]),new GeNeo.OdGePoint3d(e.gE[1]))),new GeNeo.OdGeExtents3d(GeNeo.OdGePoint3d.kOrigin,GeNeo.OdGePoint3d.kOrigin)),f=(e.aE&&(y=new GeNeo.OdGeExtents3d(new GeNeo.OdGePoint3d(e.aE[0]),new GeNeo.OdGePoint3d(e.aE[1]))),e.aS),_=e.aT,w=e.lineColor,v=e.lW,C=e.fA,T=new GeNeo.OdGeVector3d(e.v).normalize(),b=new GeNeo.OdGePoint3d(e.maxOffsetPoint),X=new GeNeo.OdGePoint3d(e.minOffsetPoint),S=e.sO,P=e.eO,D=e.maxO,x=e.minO,O=e.isArrowFlipped,G=DbWasm.OdDbMText.createObject();G.setDirection(GeNeo.OdGeVector3d.kXAxis),this.getOriginalAttachmentPoint=function(e){return a[e]},this.setAttachmentPoint=function(e,t){a[e]=t},this.getAttachmentPointArraySize=function(){return a.length},this.getOriginalAttachmentArray=function(){return a},this.getSortedAttachmentPointArray=function(){return r||(r=a.slice()).sort(function(e,t){return m.getLineCoordinate(e)>m.getLineCoordinate(t)?1:m.getLineCoordinate(e)<m.getLineCoordinate(t)?-1:0}),r},this.getAlignedSortedAttachmentPointArray=function(i){return i?(r||(r=a.slice()).sort(function(e,t){return m.getAlignLineCoordinate(e,i)>m.getAlignLineCoordinate(t,i)?1:m.getAlignLineCoordinate(e,i)<m.getAlignLineCoordinate(t,i)?-1:0}),r):(n||(n=t.slice()).sort(function(e,t){return m.getAlignLineCoordinate(e,i)>m.getAlignLineCoordinate(t,i)?1:m.getAlignLineCoordinate(e,i)<m.getAlignLineCoordinate(t,i)?-1:0}),n)},this.getProportion=function(e){return s[e]},this.setProportion=function(e,t){s[e]=t},this.getJoggedPointArraySize=function(){return d==JoggedSectionLine.Direction.eAngular&&a.length<=2&&!1===JoggedSectionLine._enableCutAngle||d==JoggedSectionLine.Direction.eAligned?0:2*(a.length-1)},this.getJoggedPointArray=function(){if(d==JoggedSectionLine.Direction.eAngular&&a.length<=2&&!1===JoggedSectionLine._enableCutAngle)return[];var e=m.getSortedAttachmentPointArray(),t=m.getDirectionVector(),i=[],r=e.length-1;for(u=0;u<r;u++){var n=m.getLineCoordinate(e[u])-m.getLineCoordinate(e[u+1]),o=t.mult(-n*s[u]),o=e[u].add(o),n=t.mult(n*(1-s[u])),n=e[u+1].add(n);i.push(o),i.push(n)}return i},this.getJoggedPoint=function(e){return this.getJoggedPointArray()[e]},this.getDirectionVector=function(){var e,t;return d==JoggedSectionLine.Direction.eVertical?GeNeo.OdGeVector3d.kYAxis:d==JoggedSectionLine.Direction.eHorizontal?GeNeo.OdGeVector3d.kXAxis:i?((e=new GeNeo.OdGeVector3d(o).normalize()).z=0,e):((e=new GeNeo.OdGeVector3d(a[0])).z=0,(t=new GeNeo.OdGeVector3d(a[1])).z=0,(e.y<t.y?e.sub(t):t.sub(e)).normalize())},this.getAlignedDirectionVector=function(i){if(d===JoggedSectionLine.Direction.eAligned){let e,t;return i?((e=new GeNeo.OdGeVector3d(a[1])).z=0,(t=new GeNeo.OdGeVector3d(a[0])).z=0):((e=new GeNeo.OdGeVector3d(a[0])).z=0,(t=new GeNeo.OdGeVector3d(a[2])).z=0),t.sub(e).normalize()}},this.getLineCoordinate=function(e){var t,i;return e.lineCoordinate||(t=m.getDirectionVector(),i=e.sub(GeNeo.OdGePoint3d.kOrigin),e.lineCoordinate=i.dotProduct(t)),e.lineCoordinate},this.getAlignLineCoordinate=function(e,t){var i;return e.lineCoordinate||(t=m.getAlignedDirectionVector(t),i=e.sub(GeNeo.OdGePoint3d.kOrigin),e.lineCoordinate=i.dotProduct(t)),e.lineCoordinate},this.clearCache=function(){for(u in a)delete a[u].lineCoordinate,delete t[u].lineCoordinate;n=r=null},this.maxOffset=function(){return D},this.setOffsetProportion=function(e,t){e?S=t:P=t},this.getAttachmentPoint=function(e){var t=m.getSortedAttachmentPointArray();return e?t[0]:t[t.length-1]},this.getAlignedAttachmentPoint=function(e){var t=m.getAlignedSortedAttachmentPointArray(e);return e?t[0]:t[t.length-1]},this.getExtentPoint=function(e){m.getSortedAttachmentPointArray();var t,i=m.getAttachmentPoint(e),r=m.getDirectionVector(),n=new GeNeo.OdGeLine3d,o=(n.set(i,r),[]),i=y.minPoint(),r=y.maxPoint(),a=(o.push(i),o.push(r),o.push(new GeNeo.OdGePoint3d(i.x,r.y,0)),o.push(new GeNeo.OdGePoint3d(r.x,i.y,0)),[]);for(t in o){var s=n.closestPointTo(o[t]);s&&a.push(s)}return a.sort(function(e,t){return m.getLineCoordinate(e)>m.getLineCoordinate(t)?1:m.getLineCoordinate(e)<m.getLineCoordinate(t)?-1:0}),e?a[0]:a[a.length-1]},this.getOffsetPoint=function(e){var t=this.getExtentPoint(e),i=m.getDirectionVector(),r=e?-S:P,r=i.mult(r*D);let n=t.add(r);var t=m.getLineCoordinate(n),r=m.getAttachmentPoint(e),e=(m.getLineCoordinate(r),b),r=X,o=m.getLineCoordinate(e),a=m.getLineCoordinate(r);return o<t&&t<a||(o=Math.abs(t-o),t=Math.abs(t-a),(a=new GeNeo.OdGeLine3d).set(n,i),n=o<t?a.closestPointTo(e):a.closestPointTo(r)),n},this.getAlignedViewOffsetPoint=function(e){var t=this.getAlignedViewExtentPoint(e),i=m.getAlignedDirectionVector(e),r=e?-S:P,r=i.mult(r*D),t=t.add(r),r=m.getAlignLineCoordinate(t,e),n=m.getAlignedAttachmentPoint(e),o=(e?-1:1)*x,n=m.getAlignLineCoordinate(n,e)+o;return(e&&n<r||!e&&r<n)&&i.mult(o),t},this.getAlignedViewExtentPoint=function(i){m.getAlignedSortedAttachmentPointArray(i);var e=m.getOriginalAttachmentArray();let t=e[1];0==i&&(t=e[2]);var r,e=m.getAlignedDirectionVector(i),n=new GeNeo.OdGeLine3d,o=(n.set(t,e),[]),e=y.minPoint(),a=y.maxPoint(),s=(o.push(e),o.push(a),o.push(new GeNeo.OdGePoint3d(e.x,a.y,0)),o.push(new GeNeo.OdGePoint3d(a.x,e.y,0)),[]);for(r in o){var c=o[r],c=n.closestPointTo(c);c&&s.push(c)}return s.sort(function(e,t){return m.getAlignLineCoordinate(e,i)>m.getAlignLineCoordinate(t,i)?1:m.getAlignLineCoordinate(e,i)<m.getAlignLineCoordinate(t,i)?-1:0}),i?s[0]:s[s.length-1]},this.getLabelPosition=function(e){var t=this.getLabelOffset(e);return(d===JoggedSectionLine.Direction.eAligned?this.getAlignedViewOffsetPoint(e):this.getOffsetPoint(e)).add(t)},this.getLabelOffset=function(e){return e?c:l},this.setLabelOffset=function(e,t){e?c=t:l=t},this.getTextPoint=function(e){return this.getLabelPosition(e).add(m.getCommonTextOffset(e))},this.getDrawPoints=function(){var e=m.getSortedAttachmentPointArray(),t=m.getDirectionVector(),i=[],r=(i.push(this.getOffsetPoint(!0)),e.length-1);for(u=0;u<r;u++){var n=m.getLineCoordinate(e[u])-m.getLineCoordinate(e[u+1]),o=t.mult(-n*s[u]),o=e[u].add(o),n=t.mult(n*(1-s[u])),n=e[u+1].add(n);i.push(e[u]),i.push(o),i.push(n)}return i.push(e[r]),i.push(this.getOffsetPoint(!1)),i},this.getDrawAlignedViewPoints=function(){var e=m.getOriginalAttachmentArray(),t=(m.getAlignedDirectionVector(!0),m.getAlignedDirectionVector(!1),[]),i=(t.push(this.getAlignedViewOffsetPoint(!0)),e.length);return 2<i&&(t.push(e[1]),t.push(e[0]),t.push(e[2])),t.push(this.getAlignedViewOffsetPoint(!1)),t},this.getGeomExtents=function(){return g},this.getCommonTextOffset=function(e){var t,i,r=2*f*(1+1/6);return(d===JoggedSectionLine.Direction.eAligned?(t=m.getAlignedDirectionVector(!0),i=m.getAlignedDirectionVector(!1),t.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),i.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),O||(t.negate(),i.negate()),e?t:i):T).mult(r)};this.draw_gdi=function(t,i){var r=t.ctx,n=t.m_XeViewport;if(r&&n){var o=t.m_XeMyDocument.getXeGsDevice(),i=(RecomputeDimBlock.SET_DRAWCONTEXT(t.ctx,t.m_XeViewport,i),RecomputeDimBlock.SET_TEXT_WH(1,1),RecomputeDimBlock.SET_ACTUAL_DIMTRACKER("OsJoggedSectionLineGripPointsTracker",this),RecomputeDimBlock.bADD_BOUNDARY_BOX=!1,w||o.getForeground()),o=window.XeUtils.intRGBToHex(i),i=(r.beginPath(),t.m_XeMyDocument),a=i.getXeDatabase(),s=0===a.getMEASUREMENT()?"ONS_PHANTOM":"ONS_DASHDOT",a=a.getXeLinetypeTable().getLineDashGDI(n,s);r.setLineDash(a),r.fillStyle=o,r.strokeStyle=o,r.lineWidth=this.convertLineWeightToPixel(v,i),r.lineCap="round";let e;e=d===JoggedSectionLine.Direction.eAligned?this.getDrawAlignedViewPoints():this.getDrawPoints();var s=n.PointToSCS(e[0]),c=(r.moveTo(s[0],s[1]),e.length);for(u=1;u<c;u++){var l=n.PointToSCS(e[u]);r.lineTo(l[0],l[1])}r.stroke(),r.setLineDash([]),d===JoggedSectionLine.Direction.eAligned?(a=m.getAlignedDirectionVector(!0),o=m.getAlignedDirectionVector(!1),a.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),o.rotateBy(Math.PI/2,GeNeo.OdGeVector3d.kZAxis),O||(a.negate(),o.negate()),h(r,n,e[0].x,e[0].y,a,t),h(r,n,e[c-1].x,e[c-1].y,o,t)):(h(r,n,e[0].x,e[0].y,T,t),h(r,n,e[c-1].x,e[c-1].y,T,t));i=m.getTextPoint(!0),s=(p(0,0,i.x,i.y),m.getTextPoint(!1));p(0,0,s.x,s.y)}},this.convertLineWeightToPixel=function(e,t){var i;return!window.XeLineweightUtils.useModelSpaceLwAlways()&&t.getXeGsDevice().getOverallViewport()?(t=t.getXeGsDevice().getActiveViewport(),(i=window.XeLineweightUtils.GetLineWeightInPixels(t,e))<1&&(i=1),1<(i=Math.round(i))&&1==(1&i)&&i++):i=window.XeLineweightUtils.getStndLineWeightPxSize(e,!0),i},m.getViewDirection=function(){return T},m.setViewDirection=function(e){T=e},m.getDirection=function(){return d}}),OsMeasurementTracker=(JoggedSectionLine.Direction={eVertical:0,eHorizontal:1,eAngular:2,eAligned:3},function(){ClientSideTracker.call(this),this.drawOrder=10,this.newPos=null,this.loaded=!1});OsMeasurementTracker.prototype=Object.create(ClientSideTracker.prototype),OsMeasurementTracker.prototype.constructor=OsMeasurementTracker,OsMeasurementTracker.prototype.drawTracker=function(t){if(t.m_XeViewport){var i=t.m_XeViewport,e=window.XeActiveTrackers.TrackerData("COsMeasurementTracker");if(void 0===e)return!1;var r,n=e.dlgObjName,o=(n&&(n=document.querySelector("div[data-object-name="+n+"]"))&&(r=n.clientWidth+n.offsetLeft,a=n.getElementsByClassName("valueContainer")[0])&&(r<a.clientWidth+a.offsetLeft&&this.updateDialogWidth(n,a),r=document.querySelector("[data-object-name=selectionQlvItem]"))&&(null==this.qlvItemOrg&&(this.qlvItemOrg=parseInt(r.style.width.replace("px",""))),r.style.width=this.qlvItemOrg+this.offWid+"px"),e.linesData);if(0!=o.length){var n=t.m_XeMyDocument.getXeProfile().getDynaSnapMarkerColor(),a=window.XeUtils.intRGBToHex(n);t.ctx.strokeStyle=a;t.m_XeMyDocument.getXeDatabase().getXeLinetypeTable();t.ctx.setLineDash([3,2]),t.ctx.lineWidth=3,t.ctx.beginPath();for(let e=0;e<o.length;e+=2){var s=o[e],c=o[e+1],s=i.PointToSCS(s),l=s[0],s=s[1],c=i.PointToSCS(c),d=c[0],c=c[1];t.ctx.moveTo(l,s),t.ctx.lineTo(d,c)}return t.ctx.stroke(),!0}}},OsMeasurementTracker.prototype.updateClassWidth=function(t,i,r){for(let e=0;e<t.length;e++){var n=t[e];if(null!=n&&null!=n.style){let e=parseInt(n.style.width.replace("px","")),t=null!=r?" !important":"";n.style.width=e+i+"px"+t}}},OsMeasurementTracker.prototype.updateDialogWidth=function(e,t){var t=t.clientWidth+t.offsetLeft;this.offWid=t-297,0<this.offWid&&(t=e.getElementsByClassName("osmeasurement"),this.updateClassWidth(t,this.offWid),t=e.getElementsByClassName("OsQlvItem"),this.updateClassWidth(t,this.offWid,!0),t=e.getElementsByClassName("OsQlvItemRow"),this.updateClassWidth(t,this.offWid),t=e.getElementsByClassName("XeDropdown"),this.updateClassWidth(t,this.offWid),t=e.getElementsByClassName("XeDialogHeader"),this.updateClassWidth(t,this.offWid),t=e.getElementsByClassName("XeDialogBody"),this.updateClassWidth(t,this.offWid),t=e.getElementsByClassName("dialog-layout"),this.updateClassWidth(t,this.offWid),e.style.width=297+this.offWid+"px")};let OsMLeaderHighlightTracker=function(){ClientSideTracker.call(this),this.drawOrder=10};OsMLeaderHighlightTracker.prototype=Object.create(ClientSideTracker.prototype),OsMLeaderHighlightTracker.prototype.constructor=OsMLeaderHighlightTracker,OsMLeaderHighlightTracker.prototype.drawTracker=function(e){var t,i,r,n,o;return e.m_XeViewport&&(t=e.m_XeViewport,n=window.XeActiveTrackers.TrackerData("COsMLeaderHighlightTracker"))&&(i=[],r=window.OnshapeColors.select.color,(o=n.highlightedStartEdgepoint)&&(o=t.PointToSCS(o[0],o[1]),i.push(o)),(o=n.highlightedEndEdgepoint)&&(n=t.PointToSCS(o[0],o[1]),i.push(n)),this.drawLine(e.ctx,i,r)),!0},OsMLeaderHighlightTracker.prototype.drawLine=function(e,t,i){1<t.length&&(e.strokeStyle=i,e.lineWidth=3,e.beginPath(),e.moveTo(t[0][0],t[0][1]),e.lineTo(t[1][0],t[1][1]),e.closePath(),e.stroke())};var NoteFieldTracker=function(){ClientSideTracker.call(this),this.drawOrder=10},NoteRotationTracker=(NoteFieldTracker.prototype=Object.create(ClientSideTracker.prototype),NoteFieldTracker.prototype.constructor=NoteFieldTracker,NoteFieldTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("CFxNoteFieldTracker"),r=document.getElementById("divToolTip");if(!i)return null!=r&&(r.style.visibility="hidden"),!0;if(null===r&&((r=document.createElement("div")).id="divToolTip",r.style.position="absolute",r.className+="noteeditor-field",document.body.appendChild(r)),null!==r){if(!e.m_XeViewport)return!0;e=t.PointToSCS(i.loc),t=e[1]-10,e=e[0]+10,t=t.toString()+"px",e=e.toString()+"px";r.style.left=e,r.style.top=t,r.innerHTML=i.tooltip,!0===i.show?(window.getXeApplication().getXeUI().HideTooltip(),r.style.visibility="visible"):r.style.visibility="hidden"}}},function(){ClientSideTracker.call(this);this.drawOrder=10,this.end=function(){var e=document.getElementById("noteRotation_element");e&&(e.style.top="-500px",e.style.left="-500px")}}),OrdinateGroupLineTracker=(NoteRotationTracker.prototype=Object.create(ClientSideTracker.prototype),NoteRotationTracker.prototype.constructor=NoteRotationTracker,NoteRotationTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("COsNoteRotationGripEditTracker");if(void 0===i)return!1;var r=i.RotationBoxLocation,n=i.RotationString,o=i.IsRotationGrip,r=t.PointToSCS(r),a=r[0],r=r[1],s=(a+=20,r-=20,i.BoundingBoxArr),i=e.m_XeMyDocument.getXeDatabase().getGRIPCOLOR(),c=e.m_XeMyDocument.getXeProfile().getGripAlpha(),l=window.XeUtils.intRGBAToHex(i,c),d=window.XeUtils.rgbaToHex(0,0,0,c),i=new GeNeo.OdGePoint3d,c=new GeNeo.OdGePoint3d,u=new GeNeo.OdGePoint3d,c=(i.set(s[1][0],s[1][1],s[1][2]),c.set(s[2][0],s[2][1],s[2][2]),u.set(s[3][0],s[3][1],s[3][2]),i.distanceTo(c));i.distanceTo(u)<c&&(i=s[2],s[2]=s[3],s[3]=i);for(var p=0;p<s.length;++p){var m=s[p],m=t.PointToSCS(m),h=s.length===p+1?s[0]:s[p+1],h=t.PointToSCS(h),g=(e.ctx.setLineDash([2,10]),e.ctx.fillStyle=l,e.ctx.strokeStyle=d,e.ctx.beginPath(),m[0]),m=m[1],y=h[0],h=h[1];e.ctx.moveTo(g,m),e.ctx.lineTo(y,h),e.ctx.fill(),e.ctx.stroke()}return 0!=o&&(null==(u=document.getElementById("noteRotation_element"))?((c=document.createElement("div")).id="noteRotation_element",c.style.position="absolute",c.style.outline="1px",c.style.border="solid",c.style.backgroundColor="white",c.style.borderColor="orange",c.style.top=r+"px",c.style.left=a+"px",c.style.color="black",c.style.textAlign="center",document.body.appendChild(c),u=c):u&&(u.style.top=r+"px",u.style.left=a+"px"),u)&&(u.innerHTML=n),!0}},function(){ClientSideTracker.call(this),this.drawOrder=10});OrdinateGroupLineTracker.prototype=Object.create(ClientSideTracker.prototype),OrdinateGroupLineTracker.prototype.constructor=OrdinateGroupLineTracker,OrdinateGroupLineTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("COsOrdinateDimGripEditTracker");if(void 0===i)return!1;for(var r=e.m_XeMyDocument.getXeDatabase().getGRIPCOLOR(),n=e.m_XeMyDocument.getXeProfile().getGripAlpha(),o=window.XeUtils.intRGBAToHex(r,n),a=window.XeUtils.rgbaToHex(0,0,0,n),s=i.OrdinateLinePoints,c=0;c<s.length;c+=2){var l=s[c],l=t.PointToSCS(l),d=s[c+1],d=t.PointToSCS(d),u=(e.ctx.setLineDash([2,5]),e.ctx.fillStyle=o,e.ctx.strokeStyle=a,e.ctx.beginPath(),l[0]),l=l[1],p=d[0],d=d[1];e.ctx.moveTo(u,l),e.ctx.lineTo(p,d),e.ctx.fill(),e.ctx.stroke()}return!0}},OtrackPointTracker.prototype.getLineColor=function(e){let t="#000000";return t=e.m_XeMyDocument.getModelLayoutActive()?window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeProfile().getAutoTrackingVecColor()):window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeProfile().getLayoutAutoTrackingVecColor())},PanZoomTracker.prototype.putImgData=function(e){return!1},PanZoomTracker.prototype.drawZoom=function(){return this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_arrow"),!1},PanZoomTracker.prototype.drawPan=function(){return this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_arrow"),!1},PanZoomTracker.prototype.drawZoomWindow=function(){return this.setCanvasCursorStyle(null),this.setCanvasClassName("interactive_arrow"),!1};class OsPathAndPointHighLightTracker extends ClientSideTracker{constructor(){super(),this.selectedGrips=[]}update(e,t){this.selectedGrips=[];var i=window.XeActiveTrackers.TrackerData("CFxPathAndPointHighLightTracker");if(!i)return!0;if(i.pointArray)for(var r=0;r<i.pointArray.length;r++){var n=i.pointArray[r].location;this.selectedGrips.push(n)}}drawTracker(t){return this.selectedGrips.forEach(e=>this.drawSnapPoint(t,e)),!0}drawSnapPoint(e,t){var t=e.m_XeViewport.PointToSCS(t),i=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),r=t[0],t=t[1];return e.ctx.fillStyle="#D8A566",e.ctx.beginPath(),e.ctx.strokeStyle="#FFFFFF",e.ctx.arc(r,t,i,0,2*Math.PI,!1),e.ctx.fill(),e.ctx.stroke(),!0}drawEntity(e){}}var OsProfileEditCursorTracker=function(){ClientSideTracker.call(this);this.drawOrder=20},OsProfileEditTracker=(OsProfileEditCursorTracker.prototype=Object.create(ClientSideTracker.prototype),OsProfileEditCursorTracker.prototype.constructor=OsProfileEditCursorTracker,OsProfileEditCursorTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=window.XeActiveTrackers.TrackerData("COsProfileEditCursorTracker");if(t){var i=e.m_XeMyDocument,r=i.getXeDatabase();if(t.isDragging)r.setCURSORMODE(12);else{var n=r.getXeEntities(),o=(r.preventServerNotify(!0),r.setCURSORMODE(2),r.preventServerNotify(!1),n.getByHandle(t.entity));if(void 0===o)return!1;if(!o.IsHidden()){if(o&&o.getGrips&&o.getGrips()&&o.getGrips().length)for(var a=o.getGrips(),s=0;s<a.length;s++){var c=e.m_XeViewport.PointToSCS(a[s]);o.drawGrip(s,e.ctx,c[0],c[1],r.getGRIPSIZE(),window.OnshapeColors.grippoint.dependancy_pen,window.OnshapeColors.grippoint.dependancy_border)}n=i.getXeInputPointManager().getMousePosition();if(void 0===o.CheckIfGrip(n))return!1;r.preventServerNotify(!0),r.setCURSORMODE(16),r.preventServerNotify(!1)}}}}return!0},function(){ClientSideTracker.call(this);this.drawOrder=20,this.matrix_transform=new GeNeo.OdGeMatrix3d,this.xeEntityPreview=void 0,this.xeEntity=void 0,this.ptStartSCS=void 0}),OsProfileToolTracker=(OsProfileEditTracker.prototype=Object.create(ClientSideTracker.prototype),OsProfileEditTracker.prototype.constructor=OsProfileEditTracker,OsProfileEditTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview,t=(e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(2),e.getXeDrawDecoration().TYPE_ENUM.Transform);return e.getXeDrawDecoration().setType(t),e.getXeDrawDecoration().setColor(window.OnshapeColors.select.rgb),e.getXeDrawDecoration().setAlpha(window.OnshapeColors.select.alpha),e},OsProfileEditTracker.prototype.setMatrixTransform=function(e,t){this.matrix_transform.setentry(0,3,e[0]-t[0]),this.matrix_transform.setentry(1,3,e[1]-t[1]),this.matrix_transform.setentry(2,3,e[2]-t[2]),this.matrix_transform.setentry(3,3,1)},OsProfileEditTracker.prototype.start=function(e){var t=window.XeActiveTrackers.TrackerData("COsProfileEditTracker");if(t&&e.getXeInputPointManager().getHitTestInfo().IsLeftMouseButtonPressed()){if(!this.xeEntityPreview){t=e.getXeDatabase().getXeEntities().getByHandle(t.entity);if(void 0===t)return!1;this.xeEntity=t,this.xeEntityPreview=this.createXeEntityPreview(),this.xeEntityPreview.addXeEntity(t,!0),this.xeEntity.Hide()}t=e.getXeGsDevice();t&&t.setContinuousAction(!0)}},OsProfileEditTracker.prototype.end=function(e){this.xeEntityPreview&&(this.xeEntityPreview.deallocate(),this.xeEntityPreview=void 0),this.xeEntity&&this.ptStartSCS&&(this.xeEntity=void 0,this.ptStartSCS=void 0),this.matrix_transform=new GeNeo.OdGeMatrix3d;e=e.getXeGsDevice();e&&(e.setContinuousAction(!1),e.invalidateClientTrackersGL())},OsProfileEditTracker.prototype.drawTrackerGl=function(e,t){var i,r;return!e||!(i=window.XeActiveTrackers.TrackerData("COsProfileEditTracker"))||!this.xeEntityPreview||(r=e.getXeGsDevice().getXeDocument().getXeInputPointManager().getMousePosition(),r=e.PointToWCS(r.x,r.y,!0),this.ptStartSCS=e.PointToSCS(i.ptStartPoint[0],i.ptStartPoint[1],i.ptStartPoint[2]),this.setMatrixTransform(r,i.ptStartPoint),this.xeEntityPreview.setTransform(this.matrix_transform),void this.xeEntityPreview.draw_gl(t,e))},function(){ClientSideTracker.call(this);this.drawOrder=20,this.originalDblTimeoutTime=XeDoubleClickWatcher.prototype.DblTimeoutTime}),ProjectedViewPlacementTracker=(OsProfileToolTracker.prototype=Object.create(ClientSideTracker.prototype),OsProfileToolTracker.prototype.constructor=OsProfileToolTracker,OsProfileToolTracker.prototype.drawTracker=function(e){return void 0===this.originalDblTimeoutTime&&(this.originalDblTimeoutTime=XeDoubleClickWatcher.prototype.DblTimeoutTime),window.XeActiveTrackers.TrackerData("COsProfileToolTracker")?XeDoubleClickWatcher.prototype.DblTimeoutTime=0:XeDoubleClickWatcher.prototype.DblTimeoutTime!==this.originalDblTimeoutTime&&(XeDoubleClickWatcher.prototype.DblTimeoutTime=this.originalDblTimeoutTime),!0},function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.imgUrlDummy="",this.imgDummy=new Image,this.aDynUrls=[],this.aDynImgs=[]}),OsRevisionMarkerTracker=(ProjectedViewPlacementTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),ProjectedViewPlacementTracker.prototype.constructor=ProjectedViewPlacementTracker,ProjectedViewPlacementTracker.prototype.start=function(e){this.imgDummy=new Image,this.imgUrlDummy="",this.aDynUrls=[],this.aDynImgs=[]},ProjectedViewPlacementTracker.prototype.drawTracker=function(m){var e=window.XeActiveTrackers.TrackerData("COsProjectedViewPlacementTracker");if(e){this.x=m.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=m.m_XeMyDocument.getXeInputPointManager().getMousePosition().y;let s=e.width,c=e.height;var h=new GeNeo.OdGePoint3d(e.ptParentAnchor),g=e.bUseAnchorOffset,y=new GeNeo.OdGePoint3d(e.ptBase);e.imgUrlDummy&&this.imgUrlDummy!==e.imgUrlDummy&&(this.imgDummy.src=e.imgUrlDummy,this.imgUrlDummy=e.imgUrlDummy);let l=this.imgDummy,d=0,u=0,p=new GeNeo.OdGePoint3d(m.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT());if(p){let o=e.previews,a=!1;if(e.previewsUsingParentViewSectionDataValue&&0<e.previewsUsingParentViewSectionDataValue.length&&m.m_XeMyDocument.getXeInputPointManager().getHitTestInfo().IsShiftPressed()&&(o=e.previewsUsingParentViewSectionDataValue,a=!0),o){let n=p.sub(y);if((n=new GeNeo.OdGeVector3d(n.x,n.y,0)).length()>e.minDelta){let e,t=-42,r=-1;for(e=0;e<o.length;e++){var i=new GeNeo.OdGeVector3d(o[e].vDir).dotProduct(n);i>t&&(t=i,r=e)}if(0<=r){var f=o[r];f.sUrl||(n=p.sub(y)),f.vWH&&(s=f.vWH[0],c=f.vWH[1]),f.paddingLeft&&f.paddingTop&&(d=f.paddingLeft,u=f.paddingTop);let e=f.iDir;!0===a&&(e+="_useParentViewSectionDataValue"),f.sUrl&&this.aDynUrls[e]!==f.sUrl&&(this.aDynImgs[e]=new Image,this.aDynImgs[e].src=f.sUrl,this.aDynUrls[e]=f.sUrl,this.aDynImgs[e].onload=function(){var e=m.m_XeMyDocument.getXeGsDevice();e&&e.invalidateClientTrackers()}),this.aDynImgs[e]&&(l=this.aDynImgs[e]);var _=new GeNeo.OdGeVector3d(f.vAnchorOffset),f=new GeNeo.OdGeVector3d(f.vAxisOffset);let t=p.sub(_);h=t.sub(h),h=f.mult(h.dotProduct(f));let i=p;y=i.sub(y),y=f.mult(y.dotProduct(f));i=i.sub(y),t=t.sub(h),p=g?t.add(_):i}}}p&&(f=[p.x,p.y,p.z],this.drawPreview(m,f,s,c,d,u,l,e.bordercolor))}}return!0},function(){ClientSideTracker.call(this),this.drawOrder=10,this.matrix_transform=new GeNeo.OdGeMatrix3d,this.xeEntityPreview=void 0}),OsRevisionTableTracker=(OsRevisionMarkerTracker.prototype=Object.create(ClientSideTracker.prototype),OsRevisionMarkerTracker.prototype.constructor=OsRevisionMarkerTracker,OsRevisionMarkerTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview;return e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(0),e},OsRevisionMarkerTracker.prototype.setMatrixTransform=function(e,t){this.matrix_transform.setentry(0,3,e[0]-t[0]),this.matrix_transform.setentry(1,3,e[1]-t[1]),this.matrix_transform.setentry(2,3,e[2]-t[2]),this.matrix_transform.setentry(3,3,1)},OsRevisionMarkerTracker.prototype.clearXeEntityPreview=function(){this.xeEntityPreview&&(this.xeEntityPreview.deallocate(),this.xeEntityPreview=void 0,this.matrix_transform=new GeNeo.OdGeMatrix3d)},OsRevisionMarkerTracker.prototype.start=function(){},OsRevisionMarkerTracker.prototype.end=function(){this.clearXeEntityPreview()},OsRevisionMarkerTracker.prototype.deallocate=function(e){this.clearXeEntityPreview()},OsRevisionMarkerTracker.prototype.drawTrackerGl=function(e,t,i){if(e.m_XeViewport){var r,n=window.XeActiveTrackers.TrackerData("COsRevisionMarkerTracker");if(void 0!==n&&n.handle){if(!this.xeEntityPreview){var o=window.getXeActiveDocument().getXeDatabase().getXeEntities();if(void 0===o)return!0;var o=o.getByHandle(n.handle);if(void 0===o)return!0;this.xeEntityPreview=this.createXeEntityPreview(),this.xeEntityPreview.addXeEntity(o,!0),o.m_XeDrawMode=XeDrawMode.kHidden,XeEntity.prototype.setDrawModeByCachedXeGsOffsets(o.getCachedXeGsOffsets(),XeDrawMode.kHidden)}this.xeEntityPreview&&(o=n.useExtPt,r=window.getXeActiveDocument().getXeInputPointManager().getMousePosition(),o?this.setMatrixTransform(n.ptPosition,[0,0,0]):(o=e.m_XeViewport.PointToWCS(r.x,r.y,!0),this.setMatrixTransform(o,n.ptPosition)),this.xeEntityPreview.setTransform(this.matrix_transform),this.xeEntityPreview.draw_gl(e,i))}return!0}},function(){ClientSideTracker.call(this),this.drawOrder=10,this.matrix_transform=new GeNeo.OdGeMatrix3d,this.xeTableEntityPreview=void 0,this.iRowCount=0,this.direction=0,this.cells=[]}),OsSectionDepthHighlightTracker=(OsRevisionTableTracker.prototype=Object.create(ClientSideTracker.prototype),OsRevisionTableTracker.prototype.constructor=OsRevisionTableTracker,OsRevisionTableTracker.prototype.createXeTableEntityPreview=function(){var e=new XeEntityPreview;return e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(0),e},OsRevisionTableTracker.prototype.setMatrixTransform=function(e,t){this.matrix_transform.setentry(0,3,e[0]-t[0]),this.matrix_transform.setentry(1,3,e[1]-t[1]),this.matrix_transform.setentry(2,3,e[2]-t[2]),this.matrix_transform.setentry(3,3,1)},OsRevisionTableTracker.prototype.clearXeEntityPreview=function(){this.xeTableEntityPreview&&(this.xeTableEntityPreview.deallocate(),this.xeTableEntityPreview=void 0,this.matrix_transform=new GeNeo.OdGeMatrix3d)},OsRevisionTableTracker.prototype.start=function(e){},OsRevisionTableTracker.prototype.end=function(e){this.clearXeEntityPreview()},OsRevisionTableTracker.prototype.deallocate=function(e){this.clearXeEntityPreview()},OsRevisionTableTracker.prototype.drawTrackerGl=function(e,t){if(!e)return!0;var i=e.getXeGsDevice().getXeDocument(),r=i.getXeDatabase().getXeEntities(),n=window.XeActiveTrackers.TrackerData("COsRevisionTableTracker");if(!n)return!0;if(n.tableHandle){if(!r)return!0;r=r.getByHandle(n.tableHandle);if(!r)return!0;var o=n.iRowCount!==this.iRowCount||n.direction!==this.direction||r.m_EntityData.cells!==this.cells;if(this.iRowCount=n.iRowCount,this.direction=n.direction,this.cells=r.m_EntityData.cells,!0==o&&this.clearXeEntityPreview(),this.xeTableEntityPreview||(r.IsHidden()&&r.Show(),this.xeTableEntityPreview=this.createXeTableEntityPreview(),this.xeTableEntityPreview.addXeEntity(r,!0)),this.xeTableEntityPreview){if(!r.IsHidden()){r.Hide();o=e.getXeGsDevice();if(o)return void o.invalidateScene()}r=i.getXeInputPointManager().getMousePosition(),o=e.PointToWCS(r.x,r.y,!0);return this.setMatrixTransform(o,n.ptTablePosition),this.xeTableEntityPreview.setTransform(this.matrix_transform),this.xeTableEntityPreview.draw_gl(t,e),!0}}},function(){ClientSideTracker.call(this),this.drawOrder=10}),SectionViewCutLineTracker=(OsSectionDepthHighlightTracker.prototype=Object.create(ClientSideTracker.prototype),OsSectionDepthHighlightTracker.prototype.constructor=OsSectionDepthHighlightTracker,OsSectionDepthHighlightTracker.prototype.drawTracker=function(e){var t,i,r;return e.m_XeViewport&&(t=window.XeActiveTrackers.TrackerData("COsSectionDepthHighlightTracker"))&&(t=t.highlightpoint)&&(t=e.m_XeViewport.PointToSCS(t[0],t[1]),i=e.m_XeMyDocument.getXeDatabase().getGRIPSIZE(),r=window.OnshapeColors.dependancy.color,this.drawPoint(e.ctx,t[0],t[1],i,r,"#FFFFFF")),!0},OsSectionDepthHighlightTracker.prototype.drawPoint=function(e,t,i,r,n,o){e.fillStyle=n,e.strokeStyle=o,e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.fill(),e.stroke()},function(){ClientSideTracker.call(this),this.drawOrder=10,this.Direction={eVertical:0,eHorizontal:1}}),SectionViewPlacementTracker=(SectionViewCutLineTracker.prototype=Object.create(ClientSideTracker.prototype),SectionViewCutLineTracker.prototype.constructor=SectionViewCutLineTracker,SectionViewCutLineTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a,s,c,l,d;return e.m_XeViewport&&(t=e.m_XeViewport,d=window.XeActiveTrackers.TrackerData("COsSectionViewCutLineTracker"))&&(this.x=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().y,i=d.direction,n=d.height,o=d.width,d=d.offset,r=e.m_XeMyDocument.getXeGsDevice().getForeground(),r=window.XeUtils.intRGBToHex(r),e.ctx.setLineDash([5,2]),s=new GeNeo.OdGeVector3d(e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT()))&&(a=s.x,c=s.x,l=s=s.y,i===this.Direction.eVertical?(s-=n/2,l+=n/2):(a-=o/2,c+=o/2),n=new GeNeo.OdGePoint3d(t.PointToSCS(a,s,0)),o=new GeNeo.OdGePoint3d(t.PointToSCS(c,l,0)),a=n.x,s=n.y,c=o.x,l=o.y,d=t.PointToSCS(d,0,0)[0]-t.PointToSCS(0,0,0)[0],i===this.Direction.eVertical?(s+=d,l-=d):(a-=d,c+=d),e.ctx.strokeStyle=r,e.ctx.beginPath(),e.ctx.moveTo(a,s),e.ctx.lineTo(c,l),e.ctx.stroke(),e.ctx.setLineDash([])),!0},function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.imgPathNeg="",this.imgPathPos="",this.imgPos=new Image,this.imgNeg=new Image}),SectionViewTracker=(SectionViewPlacementTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),SectionViewPlacementTracker.prototype.constructor=SectionViewPlacementTracker,SectionViewPlacementTracker.prototype.start=function(e){this.imgPos=new Image,this.imgNeg=new Image,this.imgPathPos="",this.imgPathNeg=""},SectionViewPlacementTracker.prototype.drawTracker=function(t){var e,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f;if(t.m_XeViewport)return h=t.m_XeViewport,(e=window.XeActiveTrackers.TrackerData("COsSectionViewPlacementTracker"))&&(i=t.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT(),r=new GeNeo.OdGePoint3d(h.PointToSCS(i)),this.x=r.x,this.y=r.y,r=e.isFirstAngle,n=e.cutlinestart,o=e.cutlineend,a=e.width,s=e.height,y=e.arrowSize,c=e.offset,d=l=0,e.paddingLeft&&e.paddingTop&&(l=e.paddingLeft,d=e.paddingTop),p=new GeNeo.OdGePoint3d(h.PointToSCS(n)),h=new GeNeo.OdGePoint3d(h.PointToSCS(o)),u=p.x,p=p.y,m=h.x,h=h.y,g=r,u===m?this.x>u&&(g=!g):this.y>p&&(g=!g),this.drawCutLine(t,n,o,y,c,g,r),e.imgPathPos&&this.imgPathPos!==e.imgPathPos&&(this.imgPos.src=e.imgPathPos,this.imgPathPos=e.imgPathPos,this.imgPos.onload=function(){var e=t.m_XeMyDocument.getXeGsDevice();e&&e.invalidateClientTrackers()}),e.imgPathNeg&&this.imgPathNeg!==e.imgPathNeg&&(this.imgNeg.src=e.imgPathNeg,this.imgPathNeg=e.imgPathNeg,this.imgNeg.onload=function(){var e=t.m_XeMyDocument.getXeGsDevice();e&&e.invalidateClientTrackers()}),y=!0,u===m?(i[1]=(n[1]+o[1])/2,this.y=(p+h)/2,this.x<u&&(y=!1)):(i[0]=(n[0]+o[0])/2,this.x=(u+m)/2,this.y<p&&(y=!1)),y?f=this.imgPos:(f=this.imgNeg,a=e.widthNeg,s=e.heightNeg,e.paddingLeftNeg&&e.paddingTopNeg&&(l=e.paddingLeftNeg,d=e.paddingTopNeg)),this.drawPreview(t,i,a,s,l,d,f,e.bordercolor)),!0},function(){ClientSidePlacementTracker.call(this),this.drawOrder=10,this.imgPath="",this.img=new Image}),OsShowHideEdgeTracker=(SectionViewTracker.prototype=Object.create(ClientSidePlacementTracker.prototype),SectionViewTracker.prototype.constructor=SectionViewTracker,SectionViewTracker.prototype.start=function(e){this.img=new Image,this.imgPath=""},SectionViewTracker.prototype.drawTracker=function(t){var e,i,r,n,o,a,s,c,l,d,u,p=window.XeActiveTrackers.TrackerData("COsSectionViewTracker");return p&&(this.x=t.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=t.m_XeMyDocument.getXeInputPointManager().getMousePosition().y,e=p.isFirstAngle,i=p.cutlinestart,r=p.cutlineend,n=p.position,o=p.width,a=p.height,s=p.arrowSize,c=p.offset,d=l=0,p.paddingLeft&&p.paddingTop&&(l=p.paddingLeft,d=p.paddingTop),p.imgPath&&this.imgPath!==p.imgPath&&(this.img.src=p.imgPath,this.imgPath=p.imgPath,this.img.onload=function(){var e=t.m_XeMyDocument.getXeGsDevice();e&&e.invalidateClientTrackers()}),u=t.m_XeMyDocument.getXeGsDevice().getForeground(),window.XeUtils.intRGBToHex(u),u=e,i[0]===r[0]?n[0]>i[0]&&(u=!u):n[1]<i[1]&&(u=!u),this.drawCutLine(t,i,r,s,c,u,e),this.drawPreview(t,n,o,a,l,d,this.img,p.bordercolor)),!0},function(){ClientSideTracker.call(this),this.drawOrder=10,this.xeEntityPreview=void 0,this.hiddenEntityPreview=void 0}),TableResizeTracker=(OsShowHideEdgeTracker.prototype=Object.create(ClientSideTracker.prototype),OsShowHideEdgeTracker.prototype.constructor=OsShowHideEdgeTracker,OsShowHideEdgeTracker.prototype.createXeEntityPreview=function(e){var t=new XeEntityPreview,i=(t.setSortingByDrawOrder(!1),[0,0,0]);return"gray"===e&&(i=[204,204,204]),t.getXeDrawDecoration().setLWThick(4),t.getXeDrawDecoration().setColor(i),t},OsShowHideEdgeTracker.prototype.clearXeEntityPreview=function(){this.xeEntityPreview&&(this.xeEntityPreview.deallocate(),this.xeEntityPreview=void 0),this.hiddenEntityPreview&&(this.hiddenEntityPreview.deallocate(),this.hiddenEntityPreview=void 0)},OsShowHideEdgeTracker.prototype.start=function(){},OsShowHideEdgeTracker.prototype.end=function(){this.clearXeEntityPreview()},OsShowHideEdgeTracker.prototype.deallocate=function(e){this.clearXeEntityPreview()},OsShowHideEdgeTracker.prototype.addEntities=function(e,t,i,r){for(var n=0;n<e.length;n++){var o=t.getByHandle(e[n]);if(null==o)for(var a=0;a<i.length;a++)(o=t.getByHandle(i[a]).getXeEntities().getByHandle(e[n]))&&(r?this.hiddenEntityPreview:this.xeEntityPreview).addXeEntity(o,!1);else(r?this.hiddenEntityPreview:this.xeEntityPreview).addXeEntity(o,!1)}},OsShowHideEdgeTracker.prototype.drawTrackerGl=function(e,t,i){var r,n,o,a,s;if(e.m_XeViewport)return void 0!==(r=window.XeActiveTrackers.TrackerData("COsShowHideEdgeTracker"))&&r.viewHandle&&void 0!==(n=window.getXeActiveDocument().getXeDatabase().getXeEntities())&&void 0!==(o=n.getByHandle(r.viewHandle))&&(o=o.getXeEntities(),a=r.subviewshandle,this.xeEntityPreview&&this.xeEntityPreview.deallocate(),this.xeEntityPreview=this.createXeEntityPreview("black"),s=r.visibleEntities,this.addEntities(s,o,a,!1),s=r.annotations,this.addEntities(s,n,a,!1),this.hiddenEntityPreview&&this.hiddenEntityPreview.deallocate(),this.hiddenEntityPreview=this.createXeEntityPreview("gray"),this.hiddenEntityPreview)&&(s=r.hiddenEntities,this.addEntities(s,o,a,!0),this.xeEntityPreview.draw_gl(e,i),this.hiddenEntityPreview.draw_gl(e,i)),!0},function(){ClientSideTracker.call(this)}),OsTableTracker=(TableResizeTracker.prototype=Object.create(ClientSideTracker.prototype),TableResizeTracker.prototype.constructor=TableResizeTracker,TableResizeTracker.prototype.start=function(e){var t=window.XeActiveTrackers.TrackerData("CFxTableGripTracker");if(!t)return!0;t=t.tableid,e=e.getXeDatabase().getXeEntities().getByHandle(t);e&&e.Hide()},TableResizeTracker.prototype.end=function(e){var t=document.getElementById("left_col_resize"),t=(t&&(t.style.top="-500px",t.style.left="-500px"),document.getElementById("right_col_resize")),t=(t&&(t.style.top="-500px",t.style.left="-500px"),document.getElementById("Upper_row_resize")),t=(t&&(t.style.top="-500px",t.style.left="-500px"),document.getElementById("Lower_row_resize")),t=(t&&(t.style.top="-500px",t.style.left="-500px"),window.XeActiveTrackers.TrackerData("CFxTableGripTracker"));if(!t)return!0;t=t.tableid,e=e.getXeDatabase().getXeEntities().getByHandle(t);e&&e.Show()},TableResizeTracker.prototype.drawTracker=function(e){var t,i,r,n,o,a,s,c,l,d;return e.m_XeViewport&&(a=window.XeActiveTrackers.TrackerData("CFxTableGripTracker"))&&(this.x=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().y,e=a.unit,t=a.gripIndex,a.isRowHeightChanging,a.isColWidthChanging,l=a.IsLeftBoundaryEdgeDragging,c=a.IsRightBoundaryEdgeDragging,i=a.IsTopBoundaryEdgeDragging,r=a.IsBottomBoundaryEdgeDragging,n=Number(a.UpperRowHeight).toFixed(3),s=Number(a.LeftColumnWidth).toFixed(3),o=Number(a.LowerRowHeight).toFixed(3),a=Number(a.RightColumnWidth).toFixed(3),1!=t&&2!=t||(l||(null==(l=document.getElementById("left_col_resize"))?((d=document.createElement("divLeftCol")).id="left_col_resize",d.style.position="absolute",d.style.backgroundColor="#e6e6e6",d.style.top=this.y+"px",d.style.left=this.x-80+"px",d.style.color="black",d.style.textAlign="center",document.body.appendChild(d),l=d):l&&(l.style.top=this.y+"px",l.style.left=this.x-80+"px"),l&&(l.innerHTML=s+" "+e)),c)||(null==(d=document.getElementById("right_col_resize"))?((l=document.createElement("divRightCol")).id="right_col_resize",l.style.position="absolute",l.style.backgroundColor="#e6e6e6",l.style.top=this.y+"px",l.style.left=this.x+10+"px",l.style.color="black",l.style.textAlign="center",document.body.appendChild(l),d=l):d&&(d.style.top=this.y+"px",d.style.left=this.x+10+"px"),d&&(d.innerHTML=a+" "+e)),0!=t&&3!=t||(i||(null==(s=document.getElementById("Upper_row_resize"))?((c=document.createElement("divUpperRow")).id="Upper_row_resize",c.style.position="absolute",c.style.backgroundColor="#e6e6e6",c.style.top=this.y+"px",c.style.left=this.x+"px",c.style.color="black",c.style.textAlign="center",document.body.appendChild(c),s=c):s&&(s.style.top=this.y+"px",s.style.left=this.x+"px"),s&&(s.innerHTML=n+" "+e)),r)||(null==(l=document.getElementById("Lower_row_resize"))?((d=document.createElement("divLowerRow")).id="Lower_row_resize",d.style.position="absolute",d.style.backgroundColor="#e6e6e6",d.style.top=this.y-40+"px",d.style.left=this.x+"px",d.style.color="black",d.style.textAlign="center",document.body.appendChild(d),l=d):l&&(l.style.top=this.y+45+"px",l.style.left=this.x+"px"),l&&(l.innerHTML=o+" "+e))),!0},function(){ClientSideTracker.call(this),this.drawOrder=10,this.m_bUpdateByRubberLine=!1}),COsOsViewsPreviewTracker=(OsTableTracker.prototype=Object.create(ClientSideTracker.prototype),OsTableTracker.prototype.constructor=OsTableTracker,OsTableTracker.prototype.start=function(e){this.updateByRubberLine(),document.addEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsTableTracker.prototype.end=function(e){document.removeEventListener("Update_XeInputPointManager",this.updateByRubberLine)},OsTableTracker.prototype.updateByRubberLine=function(e){this.m_bUpdateByRubberLine=!0},OsTableTracker.prototype.getLineWeight=function(e,t,i){var r;return t&&(!window.XeLineweightUtils.useModelSpaceLwAlways()&&i.m_XeMyDocument.getXeGsDevice().getOverallViewport()?((r=window.XeLineweightUtils.GetLineWeightInPixels(e,t))<1&&(r=1),1<(r=Math.round(r))&&1==(1&r)&&r++):r=window.XeLineweightUtils.getStndLineWeightPxSize(t,!0)),r},OsTableTracker.prototype.update=function(e,t){t.IsKeyboardEvent()||(t.IsLeftButtonDown(),t.IsLeftButtonUp())},OsTableTracker.prototype.FixedCornersEnum={FixedCornerNotSelected:-2,FixedCornerNone:-1,FixedCornerBottomLeft:0,FixedCornerBottomRight:1,FixedCornerTopLeft:2,FixedCornerTopRight:3},OsTableTracker.prototype.drawTracker=function(e){var t=window.XeActiveTrackers.TrackerData("COsTableTracker");if(!t)return!0;OsTableTracker.prototype.drawTable.call(this,e,t)},OsTableTracker.prototype.drawTable=function(i,n){var o=GeNeo.OdGeVector3d,a=OsTableTracker.prototype.FixedCornersEnum;if(i.m_XeViewport){var s=i.m_XeViewport,c=i.m_XeMyDocument,l=c.getXeInputPointManager(),c=c.getXeGsDevice(),c=(this.x=l.getMousePosition().x,this.y=l.getMousePosition().y,c.getForeground()),c=(window.XeUtils.intRGBToHex(c),OsTableTracker.prototype.getLineWeight.call(this,s,n.lwt)),d=new o(0,0,0),u=(this.m_bUpdateByRubberLine?(o=l.getRUBBERPOINT(),d.x=o[0],d.y=o[1],d.z=o[2],this.m_bUpdateByRubberLine=!1):(o=l.getMousePosition(),l=s.PointToWCS(o.x,o.y,!0),d.x=l[0],d.y=l[1],d.z=l[2]),this.m_bIsLeftButtonUp&&(d.x=this.m_bIsLeftButtonUp[0],d.y=this.m_bIsLeftButtonUp[1],d.z=this.m_bIsLeftButtonUp[2]),n.isFixedInsertionPoint&&(d.x=n.insertionPoint[0],d.y=n.insertionPoint[1],d.z=n.insertionPoint[2]),n.title),p=n.header,m=n.titleRowHeight,h=n.headerRowHeight,g=n.dataRowHeight;if(n.tableDirection&&n.tableHeightAxis){var y=new GeNeo.OdGeVector3d(n.tableDirection),f=new GeNeo.OdGeVector3d(n.tableHeightAxis),_=n.flowDirection,o=n.fixedCorner;{let r=[],t=0,e=0;if(n.columnWidthArray&&0<n.columnWidthArray.length&&n.columnWidthArray.length===n.columns)r=n.columnWidthArray;else if(0<n.columnWidth)for(let e=0;e<n.columns;e++)r.push(n.columnWidth);if(!r.length)return!0;for(let e=0;e<r.length;e++)t+=r[e];var w=n.rows+(u?1:0)+(p?1:0),v=(u&&(e+=m),p&&(e+=h),e+=g*n.rows,y.mult(t)),l=f.mult(e),C=(o===a.FixedCornerBottomLeft?(d.x-=l.x,d.y-=l.y,d.z-=l.z):o===a.FixedCornerBottomRight?(d.x-=v.x,d.y-=v.y,d.z-=v.z,d.x-=l.x,d.y-=l.y,d.z-=l.z):o===a.FixedCornerTopRight&&(d.x-=v.x,d.y-=v.y,d.z-=v.z),n.offset&&0<n.offset&&(o===a.FixedCornerBottomLeft||o===a.FixedCornerBottomRight?d.y+=n.offset:d.y-=n.offset),i.ctx),o=(C.lineWidth=c||1,new GeNeo.OdGePoint2d(s.PointToSCS(d.x+0,d.y+0,d.z+0))),a=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+v.x,d.y+v.y,d.z+v.z)),i=v.add(l),c=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+i.x,d.y+i.y,d.z+i.z)),i=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+l.x,d.y+l.y,d.z+l.z));C.beginPath(),C.moveTo(o.x,o.y),C.lineTo(a.x,a.y),C.lineTo(c.x,c.y),C.lineTo(i.x,i.y),C.lineTo(o.x,o.y),C.stroke(),_&&(d.x+=l.x,d.y+=l.y,d.z+=l.z);{let i=0;for(let e=0;e<w;e++)if(u&&0===e){i+=m*(_?-1:1);var T=f.mult(i),b=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+0+T.x,d.y+0+T.y,d.z+0+T.z)),T=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+v.x+T.x,d.y+v.y+T.y,d.z+v.z+T.z));C.beginPath(),C.moveTo(b.x,b.y),C.lineTo(T.x,T.y),C.stroke()}else if(!p||0!==e&&1!==e){var b=i,X=(i+=g*(_?-1:1),f.mult(b)),S=f.mult(i);e!==w-1&&(T=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+0+S.x,d.y+0+S.y,d.z+0+S.z)),x=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+v.x+S.x,d.y+v.y+S.y,d.z+v.z+S.z)),C.beginPath(),C.moveTo(T.x,T.y),C.lineTo(x.x,x.y),C.stroke());let t=0;for(let e=0;e<r.length-1;e++){t+=r[e];var P=y.mult(t),D=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+P.x+X.x,d.y+P.y+X.y,d.z+P.z+X.z)),P=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+P.x+S.x,d.y+P.y+S.y,d.z+P.z+S.z));C.beginPath(),C.moveTo(D.x,D.y),C.lineTo(P.x,P.y),C.stroke()}}else{var x=i,O=(i+=h*(_?-1:1),f.mult(x)),G=f.mult(i),E=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+0+G.x,d.y+0+G.y,d.z+0+G.z)),A=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+v.x+G.x,d.y+v.y+G.y,d.z+v.z+G.z));C.beginPath(),C.moveTo(E.x,E.y),C.lineTo(A.x,A.y),C.stroke();let t=0;for(let e=0;e<r.length-1;e++){t+=r[e];var I=y.mult(t),k=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+I.x+O.x,d.y+I.y+O.y,d.z+I.z+O.z)),I=new GeNeo.OdGePoint2d(s.PointToSCS(d.x+I.x+G.x,d.y+I.y+G.y,d.z+I.z+G.z));C.beginPath(),C.moveTo(k.x,k.y),C.lineTo(I.x,I.y),C.stroke()}}}}}}return!0},UserIOLineTracker.prototype.drawTracker=function(e){var t,i,r,n=window.XeActiveTrackers.TrackerData("CFxUserIOLineTracker");return n&&!n.hide&&(t=window.XeUtils.intRGBToHex(e.m_XeMyDocument.getXeGsDevice().getForeground()),!0===n.init&&(this.pnts=[]),0!==this.pnts.length&&this.pnts[this.pnts.length-1][0]===n.basepnt[0]&&this.pnts[this.pnts.length-1][1]===n.basepnt[1]||(this.pnts.push(n.basepnt),this.tmppnts=[]),(r=e.m_XeMyDocument).getXeInputPointManager().getHitTestInfo().IsMiddleMouseButtonDown()&&(i=r.getXeInputPointManager().getRUBBERPOINT(),this.tmppnts.push(i)),i=[],n.dash&&(i=[1,2]),n=r.getXeInputPointManager().getMousePosition().x,r=r.getXeInputPointManager().getMousePosition().y,this.drawLines(e,n,r,t,i)),!0},function(){ClientSideTracker.call(this);this.getTrackerName=function(){return"COsOsViewsPreviewTracker"},this.getXeEntityPreviewCollection=function(){return t},this.clearXeEntityPreviewCollection=function(){for(var e in t)t.hasOwnProperty(e)&&t[e].deallocate();t={}};var t={}}),OsWatermarkTracker=(COsOsViewsPreviewTracker.prototype=Object.create(ClientSideTracker.prototype),COsOsViewsPreviewTracker.prototype.constructor=COsOsViewsPreviewTracker,COsOsViewsPreviewTracker.prototype.start=function(e){},COsOsViewsPreviewTracker.prototype.end=function(e){},COsOsViewsPreviewTracker.prototype.deallocate=function(e){this.clearXeEntityPreviewCollection(e)},COsOsViewsPreviewTracker.prototype.updateId=function(e,t){var i=this.getXeEntityPreviewCollection();i[e]&&i[e].deallocate(),t?delete i[e]:void 0!==(t=window.getXeActiveDocument().getXeDatabase().getXeEntities())&&(i[e]=this.createXeEntityPreview(),t=t.getByHandle(e),i[e].addXeEntity(t,!0))},COsOsViewsPreviewTracker.prototype.createXeEntityPreview=function(){var e=new XeEntityPreview;return e.setSortingByDrawOrder(!1),e.getXeDrawDecoration().setLWThick(0),e},COsOsViewsPreviewTracker.prototype.update=function(e,t){},COsOsViewsPreviewTracker.prototype.drawTracker=function(e){return!0},COsOsViewsPreviewTracker.prototype.drawTrackerGl=function(e,t){var i,r=this.getXeEntityPreviewCollection();for(i in r)r.hasOwnProperty(i)&&r[i].draw_gl(t,e);return!0},function(){ClientSideTracker.call(this),this.drawOrder=1,this.setAlwaysActiveOnPan(!0)}),OsZoomWinTracker=(OsWatermarkTracker.prototype=Object.create(ClientSideTracker.prototype),OsWatermarkTracker.prototype.constructor=OsWatermarkTracker,OsWatermarkTracker.prototype.drawTracker=function(e){e.ctx.font="10px Noto Sans",e.ctx.fillText(" ",0,0);var t,i,r,n,o,a,s,c=window.XeActiveTrackers.TrackerData("COsWatermarkTracker");return!c||(e.m_XeMyDocument.getModelLayoutActive()?void 0:(e.m_XeViewport&&(s=e.m_XeViewport,r=e.m_XeMyDocument.getXeGsDevice().getForeground(),window.XeUtils.intRGBToHex(r),new GeNeo.OdGeVector3d(e.m_XeMyDocument.getXeInputPointManager().getRUBBERPOINT()))&&(r=e.m_XeMyDocument.getXeDatabase().getXeLayout().getPaper().getPoints(),a=new GeNeo.OdGePoint2d(s.PointToSCS(r[0][0],r[0][1],r[0][2])),s=new GeNeo.OdGePoint2d(s.PointToSCS(r[2][0],r[2][1],r[2][2])),r=new GeNeo.OdGeVector3d(s.x-a.x,s.y-a.y,0),t=GeNeo.OdGeVector3d.kXAxis,t=r.angleTo(t),i=(a.y-s.y)/10,e.ctx.font=i+"px Noto Sans",e.ctx.fillStyle="rgba(192,192,192,0.25)",n=e.ctx.measureText(c.watermarkText).width,o=s.distanceTo(a)/4,e.ctx.font=(i=i*o/n)+"px Noto Sans",r=(r=r.normalize()).mult(o/2),n=(n=new GeNeo.OdGePoint3d((a.x+s.x)/2,(a.y+s.y)/2,0)).sub(r),o=GeNeo.OdGeVector3d.kZAxis,a=(a=(a=r.crossProduct(o)).normalize()).mult(i/6),n=n.sub(a),s=GeNeo.OdGeMatrix3d.rotation(-t,o),e.ctx.setTransform(s.get(0,0),s.get(1,0),s.get(0,1),s.get(1,1),n.x,n.y),e.ctx.fillText(c.watermarkText,0,0)),!0))},XeCursorDrawer.prototype.bDrawAsSystemCursor=!0,XeCursorDrawer.prototype.draw=function(e,t){XeCursorDrawer.prototype.CCS3_CheckSupport(),this.__onshape_cursor_draw(e)},XeCursorDrawer.prototype.__onshape_cursor_draw=function(e){var t=clientSideTrackersHolder.XeCursorTracker;let i=e.canvas,r=i.className,n=i.style.cursor;function o(e){n=e}function a(e){r=e}t&&(t.m_bDrawAsSystemCursor=!0,t.setCanvasCursorStyle=o,t.setCanvasClassName=a,t.resetCursor=function(){o(i),a(i)},t.drawIcon(e.m_XeViewport,e)),this.setCanvasClassName(i,r),this.setCanvasCursorStyle(i,n)},function(){ClientSideTracker.call(this),this.drawOrder=10,this.fontSize=10});OsZoomWinTracker.prototype=Object.create(ClientSideTracker.prototype),OsZoomWinTracker.prototype.constructor=OsZoomWinTracker,OsZoomWinTracker.prototype.drawTracker=function(e){if(e.m_XeViewport){var t=e.m_XeViewport,i=window.XeActiveTrackers.TrackerData("COsZoomWinTracker");if(i&&i.bIsStartPointSelected){this.x=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().x,this.y=e.m_XeMyDocument.getXeInputPointManager().getMousePosition().y;var i=new GeNeo.OdGePoint3d(i.m_startPoint),t=new GeNeo.OdGePoint3d(t.PointToSCS(i)),r=[],i=(r.push(t),r.push(new GeNeo.OdGePoint2d(t.x,this.y)),r.push(new GeNeo.OdGePoint2d(this.x,this.y)),r.push(new GeNeo.OdGePoint2d(this.x,t.y)),r.push(t),e.m_XeMyDocument.getXeGsDevice().getForeground()),t=window.XeUtils.intRGBToHex(i);e.ctx.setLineDash([]),e.ctx.strokeStyle=t,e.ctx.beginPath();for(var n=0;n<5;n++)e.ctx.moveTo(r[n%5].x,r[n%5].y),e.ctx.lineTo(r[(n+1)%5].x,r[(n+1)%5].y);e.ctx.stroke()}return!0}};class OdDbFullSubentPath{constructor(e){this.subEntPath=void 0,this.index=void 0,this.type=void 0,Object.prototype.hasOwnProperty.call(e,"type")?(this.subEntPath=e.path,this.index=e.index,this.type=e.type,this.setVertexPoint(e)):this.subEntPath=e}getVertexPoint(){return this.vertexPoint}hasVertexPoint(){return void 0!==this.vertexPoint}setVertexPoint(e){Object.prototype.hasOwnProperty.call(e,"vertex_point")&&(this.vertexPoint=e.vertex_point)}comparePath(t){var i=Math.min(this.subEntPath.length,t.length);for(let e=0;e<i;e++){if(this.subEntPath[e]<t[e])return-1;if(this.subEntPath[e]>t[e])return 1}return this.subEntPath.length-t.length}compare(e){var t;if(e instanceof OdDbFullSubentPath)return 0!==(t=this.comparePath(e.subEntPath))?t:this.index<e.index?-1:this.index>e.index?1:this.type<e.type?-1:this.type>e.type?1:0;throw new Error("Can only compare OdDbFullSubentPath instances")}getStrSubentPath(){return this.subEntPath.join("$")}getPath(){return this.subEntPath}getIndex(){return this.index}getType(){return this.type}isVertex(){return this.type===SubentType.kVertex}isCompoundPath(){return 1<this.subEntPath.length}}let OsConstraintType={COINCIDENT:6};class OsConstraint{constructor(e,t,i,r,n,o){this.groupId=e,this.nodeId=t,this.type=i,this.subEntPaths=[],this.status=n,this.objectToHighlight=o,this.icons=[],this.iconsubentpath=void 0;for(let e=0;e<r.length;e++){var a=new OdDbFullSubentPath(r[e]);this.subEntPaths.push(a),this.iconsubentpath||a.isCompoundPath()&&!a.hasVertexPoint()?this.icons.push(new OsConstraintIconGroup(this)):(this.icons.push(new OsConstraintIconGroup(this,!1)),this.iconsubentpath={icon:this.icons[e],subentpath:this.subEntPaths[e]})}this.menu=new OsConstraintIconMenu,this.menu.addMenuItem("Delete constraint",(e,t)=>{this.menu.hideMenu(),this.OnDeleteConstraint()})}getSubEntPaths(){return this.subEntPaths.map(e=>e.getStrSubentPath())}getFullSubentPaths(e=!1){return e?this.iconsubentpath.subentpath:this.subEntPaths}getFullSubentPath(t){return this.subEntPaths.find(e=>e.getStrSubentPath()===t)}getnodeid(){return this.nodeId}getType(){return this.type}isValid(){return 0===this.status}update(t,e){if(this.subEntPaths.length===t.length)for(let e=0;e<t.length;e++)this.subEntPaths[e].setVertexPoint(t[e]);this.status=e,this.icons.forEach(e=>e.update()),e?this.iconsubentpath.icon.hideIconOnHover():this.iconsubentpath.icon.showIconOnHover()}hideIcon(){this.iconsubentpath.icon.hideIcon()}showIcon(){this.iconsubentpath.icon.showIcon()}OnContextMenu(e){this.menu.showMenu()}OnDeleteConstraint(){this.icons.forEach(e=>e.hide()),OsConstraintHelper.RunCmd(`^C^C_OSDELETECONSTRAINT ${this.groupId} ${this.nodeId}
`)}OnHighlightOut(){this.objectToHighlight.object=void 0}OnHighlight(){this.objectToHighlight.object=this}}let OsConstraintDataManager=(()=>{let t=[],i=[],r=[];return{append:function(e){t.push(e)},remove:function(e){i.push(e)},update:function(e){r.push(e)},getAppendArray:function(){return t},getRemoveArray:function(){return i},getUpdateArray:function(){return r},clear:function(){t=[],i=[],r=[]},hasDataToAppend:function(){return 0<t.length},hasDataToRemove:function(){return 0<i.length},hasDataToUpdate:function(){return 0<r.length},hasData:function(){return this.hasDataToAppend()||this.hasDataToRemove()||this.hasDataToUpdate()}}})(),SubentType={kEdge:2,kVertex:3},VertexSubentIdx={kNotDefine:0,kStart:-1,kEnd:-3,kCenter:-5,kMiddle:-6},AcDbCurveType=new Set(["AcDbCircle","AcDbEllipse"]);function getGripId(e,t){if("AcDbLine"===t)switch(e){case VertexSubentIdx.kStart:return 0;case VertexSubentIdx.kEnd:return 1;case VertexSubentIdx.kMiddle:return 2;default:return MainIconSet}else if("AcDbArc"===t)switch(e){case VertexSubentIdx.kStart:return 0;case VertexSubentIdx.kEnd:return 1;case VertexSubentIdx.kMiddle:return 2;case VertexSubentIdx.kCenter:return 3;default:return MainIconSet}else if(AcDbCurveType.has(t))switch(e){case VertexSubentIdx.kCenter:return 0;case VertexSubentIdx.kStart:return 1;case VertexSubentIdx.kEnd:return 2;case VertexSubentIdx.kMiddle:return 0;default:return MainIconSet}else if("AcDbPoint"===t||"OnshapeSketchPoint"===t)return e!==VertexSubentIdx.kStart?MainIconSet:0}function getGripCenterId(e){return"AcDbLine"===e||"AcDbArc"===e?2:AcDbCurveType.has(e)?0:void 0}function getVertexSubentIdx(e,t){if("AcDbLine"===t)switch(e){case 0:return VertexSubentIdx.kStart;case 1:return VertexSubentIdx.kEnd;case 2:return VertexSubentIdx.kMiddle;default:return VertexSubentIdx.kNotDefine}if("AcDbArc"===t)switch(e){case 0:return VertexSubentIdx.kStart;case 1:return VertexSubentIdx.kEnd;case 2:return VertexSubentIdx.kMiddle;case 3:return VertexSubentIdx.kCenter;default:return VertexSubentIdx.kNotDefine}else{if(AcDbCurveType.has(t))return 0!==e?VertexSubentIdx.kNotDefine:VertexSubentIdx.kCenter;if("AcDbPoint"===t||"OnshapeSketchPoint"===t)return 0!==e?VertexSubentIdx.kNotDefine:VertexSubentIdx.kStart}}function getOsIconMap(){let i=window.getXeApplication().getBaseUrl()+"qtresources/icons/constraints/";return new Map(["horizontal-button.svg","vertical-button.svg","parallel-button.svg","perpendicular-button.svg","kNormal","kColinear","coincident-button.svg","concentric-button.svg","tangent-button.svg","kEqualRadius","equal-button.svg","symmetric-button.svg","kG2Smooth","fix-button.svg"].map((e,t)=>[t,i+e]))}class OsConstraintHelper{static getEntityBy(e){return window.getXeActiveDocument().getXeDatabase().getXeEntities().getByStringGiPath(e)}static getXeDatabase(){return window.getXeActiveDocument().getXeDatabase()}static getImgContainer(){var e=window.getXeActiveDocument().getClientTrackerWidget();return document.getElementById(e)}static getMousePosition(){return window.getXeActiveDocument().getXeInputPointManager().getMousePosition()}static getCursorPosition(){return window.getXeActiveDocument().getXeInputPointManager().getCursorPosition()}static pointToSCS(e){var t=[0,0];return window.getXeActiveDocument().getXeGsDevice().getActiveViewport().PointToSCSFast(t,e[0],e[1],e[2]),t[0]=Math.round(t[0]),t[1]=Math.round(t[1]),t}static getIconSrc(e){return this.iconSrcMap||(this.iconSrcMap=getOsIconMap()),this.iconSrcMap.get(e)}static getViewMode(){return window.getXeActiveDocument().getViewMode()}static updateInput(e){window.getXeActiveDocument().getXeInputPointManager().getInputPointManager().updateInput(e)}static RunCmd(e){window.getXeActiveDocument().RunCmd(e)}}class OsConstraintIcon{constructor(e){this.node=e,this.m_iconSet=void 0,this.img=new Image,this.img.src=OsConstraintHelper.getIconSrc(this.node.getType()),this.img.tabIndex=-1,this.img.style.backgroundColor=this.node.isValid()?defaultColor:colorRedundant,this.img.style.outline="none",this.img.style.height=OsConstraintIcon.height()+"px",this.img.style.width=OsConstraintIcon.width()+"px",this.img.onclick=this.OnClick.bind(this),this.img.oncontextmenu=this.OnContextMenu.bind(this),this.img.onmouseout=this.OnMouseOut.bind(this),this.img.onmouseover=this.OnMouseOver.bind(this),this.img.onwheel=this.OnWheel.bind(this),this.img.addEventListener("pointerdown",e=>{}),this.pressed=!1}static height(){return 20}static width(){return 20}getImgContainer(){return this.img}isValid(){return this.node.isValid()}isVisible(){return"none"!==this.img.style.display}hide(){this.img.style.display="none"}show(){this.img.style.display=""}update(){this.img.style.backgroundColor=this.node.isValid()?defaultColor:colorRedundant}clear(){this.img.style.backgroundColor=this.node.isValid()?defaultColor:colorRedundant,this.pressed=!1,OsConstraintIconBase.setCurrentIcon(void 0)}refresh(){this.pressed||(this.img.style.backgroundColor=this.node.isValid()?defaultColor:colorRedundant),this.node.OnHighlightOut()}setIconSet(e){this.m_iconSet=e}OnClick(e){let t=OsConstraintIconBase.getCurrentIcon();t&&t.currentTarget!==this&&t.currentTarget.clear(),this.pressed=!this.pressed,this.node.isValid()?this.img.style.backgroundColor=this.pressed?"#f4a900":"#ffe666":this.img.style.backgroundColor=this.pressed?colorRedundantOnClick:colorRedundantOnHover,t=this.pressed?{OnKeyDown:this.OnKeyDown.bind(this),currentTarget:this,target:e.target}:void 0,OsConstraintIconBase.setCurrentIcon(t)}OnContextMenu(e){OsConstraintHelper.getViewMode()||document.querySelector(".Wt-popup.XeDialog.modal")||(this.node.OnContextMenu(e),this.node.menu.setOnHideMenu(()=>{this.m_iconSet&&this.m_iconSet instanceof OsConstraintIconSetOnHover&&(this.m_iconSet.setTimeoutOn(!0),this.m_iconSet.refresh()),this.refresh()}))}OnKeyDown(e){if(!e.repeat)switch(e.key){case"Backspace":case"Delete":OsConstraintHelper.getViewMode()||(this.clear(),this.node.menu.hideMenu(),this.node.OnDeleteConstraint());break;case"Escape":case" ":this.clear()}}OnMouseOut(e){this.node.menu.isVisible()||(this.pressed||(this.img.style.backgroundColor=this.node.isValid()?defaultColor:colorRedundant),this.node.OnHighlightOut())}OnMouseOver(e){this.pressed||(this.img.style.backgroundColor=this.node.isValid()?"#ffe666":colorRedundantOnHover),this.node.OnHighlight(),OsConstraintHelper.updateInput(e)}OnWheel(e){OsConstraintHelper.updateInput(e)}}class OsConstraintIconBase{static getCurrentIcon(){return this.object||(this.object=void 0),this.object}static setCurrentIcon(e){e?(this.object&&(document.removeEventListener("keydown",this.object.OnKeyDown),document.removeEventListener("pointerdown",OsConstraintIconBase.OnPointerDown)),document.addEventListener("keydown",e.OnKeyDown),document.addEventListener("pointerdown",OsConstraintIconBase.OnPointerDown)):this.object&&(document.removeEventListener("keydown",this.object.OnKeyDown),document.removeEventListener("pointerdown",OsConstraintIconBase.OnPointerDown)),this.object=e}static OnPointerDown(e){"mouse"===e.pointerType&&0===e.button&&OsConstraintIconBase.getCurrentIcon()&&OsConstraintIconBase.getCurrentIcon().currentTarget.clear()}}class OsConstraintIconGroup{constructor(e,t=!0){this.icon=t?void 0:new OsConstraintIcon(e),this.iconOnHover=new OsConstraintIcon(e)}hide(){this.icon&&this.icon.hide(),this.iconOnHover.hide()}hideIcon(){this.icon&&this.icon.hide()}hideIconOnHover(){this.iconOnHover.hide()}show(){this.icon&&this.icon.show(),this.iconOnHover.show()}showIcon(){this.icon&&this.icon.show()}showIconOnHover(){this.iconOnHover.show()}update(){this.icon&&this.icon.update(),this.iconOnHover.update()}}class OsConstraintIconInference{constructor(e,t=constraintsIconWidth,i=constraintsIconWidth){var r=new Image;r.src=e,r.tabIndex=0,r.style.verticalAlign="baseline",this.width=t,this.height=i,this.uri=e,this.pointSCS=[NaN,NaN],this.pointWCS=[NaN,NaN,NaN],this.imgContainer=document.createElement("div"),this.imgContainer.className="img-container",this.imgContainer.style.width=t+"px",this.imgContainer.style.height=i+"px",this.imgContainer.style.backgroundColor=defaultColor,this.imgContainer.style.padding="2px",this.imgContainer.style.display="inherit",this.imgContainer.appendChild(r)}setVisible(e){this.imgContainer.style.display=e?"flex":"none"}isVisible(){return"flex"===this.imgContainer.style.display}getImgPos(){return this.pointSCS}setImgPos(e){this.imgContainer.style.left=e[0]+"px",this.imgContainer.style.top=e[1]+"px",this.pointSCS=e}getPointWCS(){return this.pointWCS}setPointWCS(e){this.pointWCS=e}}class OsConstraintIconManager extends EventTarget{constructor(){super(),this.addEventListener("CMD_ENTER",this.OnClientPending.bind(this)),this.addEventListener("CMD_E",this.OnCommandEnd.bind(this)),this.addEventListener("CMD_U",this.OnCommandEnd.bind(this)),this.addEventListener("HW_CHG",this.OnWheel.bind(this)),this.constraints=new Map,this.entities=new Map,this.showCGroup=[],this.objectToHighlight={object:void 0},this.redundant=[],this.vertices=new OsConstraintVertexContainer,document.addEventListener("Update_XeEntities",this.OnUpdate_XeEntities.bind(this))}appendConstraint(n,e,t,i,r){let o=this.constraints.get(n),a=(o||(o=new Map,this.constraints.set(n,o)),o.get(e));a||(a=new OsConstraint(n,e,t,i,r,this.objectToHighlight),o.set(e,a));let s=(e,t,i=VertexSubentIdx.kNotDefine)=>{let r=this.entities.get(e);r||(r=new OsEntity(n,e),this.entities.set(e,r)),r.append(a,t,i,this.vertices)};(()=>{let n=[];var e=()=>1<n.length&&(()=>{for(let e=1;e<n.length;e++){if(n[0].vertex===n[e].vertex)return!1;var t=n[0].grippoint,i=n[e].grippoint;if(!OsConstraintVertex.compare(t,i))return!1}return!0})();if(a.getFullSubentPaths().forEach(e=>{var t,i;e.isVertex()&&(t=e.getStrSubentPath(),i=this.entities.get(t))&&(i=i.getIconSetInfo(e.getIndex()))&&i.vertex&&(i.bChanged=!i.vertex.compare(i.grippoint),i.subEntPath=t,n.push(i))}),e()){let r=n[0].vertex;for(;1<n.length;){var t,o=n.pop();r.merge(o.vertex),o.vertex.isEmpty()&&((t=o.vertex.iconSet.getImgContainer())&&OsConstraintHelper.getImgContainer().contains(t)&&OsConstraintHelper.getImgContainer().removeChild(t),(t=o.vertex.iconSetOnHover.getImgContainer())&&OsConstraintHelper.getImgContainer().contains(t)&&OsConstraintHelper.getImgContainer().removeChild(t),this.vertices.remove(o.vertex))}let i=(e,t,i)=>{i=i.get(e);i&&(i.iconSet=t,i.vertex=r)};r.pointer.forEach((e,t)=>{t=this.entities.get(t);t&&(i(e.vertexSubentIdx,r.iconSet,t.m_mapIconSet),i(e.vertexSubentIdx,r.iconSetOnHover,t.m_mapIconSetOnHover))})}n.forEach(e=>{e.bChanged&&e.vertex.update(()=>e.grippoint)})})(),a.getFullSubentPaths().forEach((e,t)=>{e.isVertex()?s(e.getStrSubentPath(),a.icons[t],e.getIndex()):s(e.getStrSubentPath(),a.icons[t])})}removeConstraint(e,t){var r=this.constraints.get(e);if(r){let c=r.get(t);if(c){let i=(e,t,i=VertexSubentIdx.kNotDefine)=>{var r=this.entities.get(e);r&&(r.remove(c,t,i,this.vertices),r.isEmpty())&&this.entities.delete(e)};c.getFullSubentPaths().forEach((e,t)=>{e.isVertex()?i(e.getStrSubentPath(),c.icons[t],e.getIndex()):i(e.getStrSubentPath(),c.icons[t])}),(()=>{let o=[],n=(i,e,r)=>{e=i.pointer.get(e);e&&e.nodes.forEach((e,t)=>{r.has(t)||t!==c.getnodeid()&&(r.set(t,e),e.getType()===OsConstraintType.COINCIDENT)&&e.getSubEntPaths().forEach(e=>{n(i,e,r)})})},e=()=>{let n=o[0].dependency;if(!n.size)return!1;for(let e=1;e<o.length;e++){var t=o[e].dependency;if(!t.size)return!1;if((t=>{for(let e=t.next();!e.done;e=t.next()){var i=e.value[1],r=e.value[0];if(i.getType()===OsConstraintType.COINCIDENT&&n.has(r))return!0}return!1})(t.entries()))return!1}return!0};var t=()=>!!(1<o.length&&(()=>{for(let e=1;e<o.length;e++)if(!o[e].vertex.compare(o[0].vertex.point))return!1;return!0})()&&(o.forEach(e=>{var t=e.dependency,i=e.subEntPath,e=e.vertex;n(e,i,t)}),e()));if(c.getFullSubentPaths().forEach(e=>{var t,i;e.isVertex()&&(t=e.getStrSubentPath(),i=this.entities.get(t))&&(i=i.getIconSetInfo(e.getIndex()))&&i.vertex&&(i.dependency=new Map,i.subEntPath=t,o.push(i))}),t()){var a=o[0].vertex;let r=(e,t,i,r)=>{r=r.get(e);r&&(r.iconSet=i,r.vertex=t)};for(let e=1;e<o.length;e++){var s=o[e];let i=this.vertices.create(a.point);OsConstraintHelper.getImgContainer().appendChild(i.iconSet.getImgContainer()),OsConstraintHelper.getImgContainer().appendChild(i.iconSetOnHover.getImgContainer()),a.split(i,(e=>{let t=[],n={current:{dependency:e},target:{dependency:o[0].dependency},pointer:new Map};return e.forEach((i,r)=>{i.getType()!==OsConstraintType.COINCIDENT?t.push(i):i.getSubEntPaths().forEach(e=>{let t=n.pointer.get(e);void 0===t&&(t=new Map,n.pointer.set(e,t)),t.set(r,i)})}),t.forEach(i=>{i.getSubEntPaths().forEach(e=>{var t=n.pointer.get(e);t&&t.set(e,i)})}),n})(s.dependency)),i.pointer.forEach((e,t)=>{t=this.entities.get(t);t&&(r(e.vertexSubentIdx,i,i.iconSet,t.m_mapIconSet),r(e.vertexSubentIdx,i,i.iconSetOnHover,t.m_mapIconSetOnHover))})}}})(),r.delete(t),0===r.size&&this.constraints.delete(e)}}}updateConstraint(e,t,i,r,n){var o=this.constraints.get(e);o&&(o=o.get(t))&&(!n&&n===o.status||this.redundant.push({groupId:e,nodeId:t}),o.update(r,n))}update(){if(this.redundant.length){let n=new Map,r=(t,e=!0)=>{var i=t.getFullSubentPaths(!0),r=this.entities.get(i.getStrSubentPath());if(r)if(e){let e=VertexSubentIdx.kNotDefine;i.isVertex()&&(e=i.getIndex()),t.isValid()?r.hide(e):r.show(n,e)}else t.isValid()||r.show(n)};this.redundant.forEach(e=>{let t=!0;this.showCGroup.includes(e.groupId)&&(t=!t);var i=this.constraints.get(e.groupId);i&&(i=i.get(e.nodeId))&&r(i,t)}),this.redundant=[]}}updateShowCGroup(t){if(this.showCGroup.length!==t.length){var e=this.showCGroup.filter(e=>!t.includes(e));let i=new Map;e.forEach(t=>{this.entities.forEach(e=>{e.getgroupid()===t&&e.hide()})}),t.forEach(t=>{this.entities.forEach(e=>{e.getgroupid()===t&&e.show(i)})}),this.showCGroup=t}}drawIconOnHover(e,t){e=this.entities.get(e.join("$"));e&&!this.showCGroup.includes(e.groupId)&&e.drawIconOnHover(t)}drawCCGrip(s){this.objectToHighlight.object.getFullSubentPaths().forEach((n,e)=>{if(n.getType()===SubentType.kVertex){let i=OsConstraintHelper.getXeDatabase().getGRIPSIZE(),r=window.OnshapeColors.grippoint;if(n.getVertexPoint()&&3===n.getVertexPoint().length){let e=n.getVertexPoint(),t=OsConstraintHelper.pointToSCS(e);o=t,s.ctx.lineWidth=1,s.ctx.strokeStyle=r.selection_border,s.ctx.fillStyle=r.selection_pen,s.ctx.beginPath(),s.ctx.arc(o[0],o[1],i,0,2*Math.PI,!1),s.ctx.fill(),void s.ctx.stroke()}else{var o=OsConstraintHelper.getEntityBy(n.getStrSubentPath());if(o){n=getGripId(n.getIndex(),o.getClass());if(void 0!==n){var a=o.getGrips();if(a&&!(a.length<=n)){let e=a[n],t=OsConstraintHelper.pointToSCS(e);o.drawGrip(n,s.ctx,t[0],t[1],i,r.selection_pen,r.selection_border)}}}}}})}hasObjectToHighlight(){return void 0!==this.objectToHighlight.object}getObjectToHighlight(){var e=this.objectToHighlight.object;let t={xeEntityArray:[],status:e.status};return e.getSubEntPaths().forEach(e=>{e=OsConstraintHelper.getEntityBy(e);e&&t.xeEntityArray.push(e)}),t}OnClientPending(e){e&&(e=e.detail.cmd,cmdOnClientPending.has(e))&&this.entities.forEach(e=>{e.OnClientPending()})}OnWheel(){let t=new Map;this.entities.forEach(e=>{e.OnWheel(t)})}OnCommandEnd(e){if(e){OsConstraintHelper.updateInput(e),this.vertices.forEach(e=>{e.update((e,t)=>{e=OsConstraintHelper.getEntityBy(e);if(e){var i=e.getClass();if(i){t=getGripId(t,i);if(void 0!==t){i=e.getGrips();if(i&&!(i.length<=t))return i[t]}}}})});let t=new Map;this.entities.forEach(e=>{this.showCGroup.includes(e.getgroupid())?e.show(t):e.showRedundant(t)})}}OnUpdate_XeEntities(e){e&&e.m_ErasedEntities&&e.m_ErasedEntities.length&&e.m_ErasedEntities.forEach(e=>{e=this.entities.get(e);e&&e.OnUpdateEntity()})}}class OsConstraintIconMenu extends RbmMenu{constructor(){super(),this.OnHideMenu=void 0,this.OnShowMenu=void 0}addMenuItem(e,t){super.addMenuItem(e,e=>t(e,this))}hideMenu(){super.hideMenu();var e=OsConstraintHelper.getImgContainer();e&&(e.contains(this.menuContainer)&&e.removeChild(this.menuContainer),e.contains(this.overlay))&&e.removeChild(this.overlay),this.OnHideMenu&&this.OnHideMenu()}showMenu(){this.OnShowMenu&&this.OnShowMenu();var e=OsConstraintHelper.getImgContainer();e&&(e.appendChild(this.overlay),e.appendChild(this.menuContainer)),super.showMenu(OsConstraintHelper.getMousePosition())}setOnHideMenu(e){this.OnHideMenu=e}setOnShowMenu(e){this.OnShowMenu=e}}class OsConstraintIconSet{constructor(){this.pointSCS=void 0,this.pointWCS=void 0,this.imgContainer=document.createElement("div"),this.imgContainer.tabIndex=-1,this.imgContainer.style.display="none",this.imgContainer.style.position="absolute",this.imgContainer.onclick=this.OnClick.bind(this),this.imgContainer.oncontextmenu=this.OnContextMenu.bind(this),this.imgContainer.onmouseout=this.OnMouseOut.bind(this),this.imgContainer.onmouseover=this.OnMouseOver.bind(this),this.imgContainer.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.pressed=!1}append(e){this.imgContainer.appendChild(e.getImgContainer())}remove(e){e=e.getImgContainer();e&&this.imgContainer.contains(e)&&this.imgContainer.removeChild(e)}getImgContainer(){return this.imgContainer}isEmpty(){return!1===this.imgContainer.hasChildNodes()}isVisible(){return"none"!==this.imgContainer.style.display}setVisible(e){this.imgContainer.style.display=e?"flex":"none"}getCount(){return this.imgContainer.childElementCount}getPointWCS(){return this.pointWCS}setPointWCS(e){this.pointWCS=e}setPosition(e){this.imgContainer.style.left=e[0]+"px",this.imgContainer.style.top=e[1]+"px"}hide(){this.setVisible(!1)}show(){this.setVisible(!0)}clear(){this.pressed=!1,OsConstraintIconSetBase.setCurrentIconSet(void 0)}OnClick(e){let t=OsConstraintIconSetBase.getCurrentIconSet();t&&(t.currentTarget!==this?t.currentTarget.clear():t.target!==e.target&&(this.pressed=!1)),this.pressed=!this.pressed,t=this.pressed?{OnKeyDown:this.OnKeyDown.bind(this),currentTarget:this,target:e.target}:void 0,OsConstraintIconSetBase.setCurrentIconSet(t)}OnContextMenu(e){}OnKeyDown(e){if(!e.repeat)switch(e.key){case"Backspace":case"Delete":OsConstraintHelper.getViewMode()||this.clear();break;case"Escape":case" ":this.clear()}}OnMouseOut(e){}OnMouseOver(e){}}class OsConstraintIconSetBase{static getCurrentIconSet(){return this.object||(this.object=void 0),this.object}static setCurrentIconSet(e){e?(this.object&&(document.removeEventListener("keydown",this.object.OnKeyDown),document.removeEventListener("pointerdown",OsConstraintIconSetBase.OnPointerDown)),document.addEventListener("keydown",e.OnKeyDown),document.addEventListener("pointerdown",OsConstraintIconSetBase.OnPointerDown)):this.object&&(document.removeEventListener("keydown",this.object.OnKeyDown),document.removeEventListener("pointerdown",OsConstraintIconSetBase.OnPointerDown)),this.object=e}static OnPointerDown(e){"mouse"===e.pointerType&&0===e.button&&OsConstraintIconSetBase.getCurrentIconSet()&&OsConstraintIconSetBase.getCurrentIconSet().currentTarget.clear()}}class OsConstraintIconSetOnHover extends OsConstraintIconSet{constructor(){super(),this.timeOut=void 0,this.timeOutOn=!0}showForDuration(){this.show(),this.isVisible()&&this.refresh()}clear(){super.clear(),this.isVisible()&&this.refresh()}refresh(){this.timeOut&&(this.timeOut=clearTimeout(this.timeOut)),this.timeOutOn&&!this.pressed&&(this.timeOut=setTimeout(this.hide.bind(this),delayInMilliseconds))}setTimeoutOn(e){this.timeOutOn=e}OnClick(e){super.OnClick(e)}OnContextMenu(e){super.OnContextMenu(e),this.timeOut&&(this.timeOut=clearTimeout(this.timeOut)),this.timeOutOn=!1}OnKeyDown(e){super.OnKeyDown(e)}OnMouseOut(e){super.OnMouseOut(e),this.timeOutOn&&!this.pressed&&(this.timeOut=setTimeout(this.hide.bind(this),delayInMilliseconds))}OnMouseOver(e){super.OnMouseOver(e),this.timeOut&&(this.timeOut=clearTimeout(this.timeOut))}}class OsConstraintUIDAllocator{constructor(){this.currentId=0,this.freeIds=new Set}allocateUID(){var e;return 0<this.freeIds.size?(e=this.freeIds.values().next().value,this.freeIds.delete(e),e):this.currentId++}freeUID(e){e<this.currentId&&this.freeIds.add(e)}}class OsConstraintVertex{constructor(e,t){this.iconSet=new OsConstraintIconSet,this.iconSetOnHover=new OsConstraintIconSetOnHover,this.pointer=new Map,this.point=e,this.u_id=t}clear(){this.pointer.forEach(e=>{e.nodes.clear()}),this.pointer.clear()}compare(e){return OsConstraintVertex.compare(this.point,e)}static compare(e,t){return Math.abs(e[0]-t[0])<1e-7&&Math.abs(e[1]-t[1])<1e-7&&Math.abs(e[2]-t[2])<1e-7}getUID(){return this.u_id}has(t){var e=t.getSubEntPaths();return!(t=>{if(t.length<=1)return!1;for(let e=1;e<t.length;e++)if(t[0]!==t[e])return!1;return!0})(e)&&e.every(e=>{e=this.pointer.get(e);return!!e&&e.nodes.has(t.getnodeid())})}isEmpty(){return this.iconSet.isEmpty()&&this.iconSetOnHover.isEmpty()}merge(e){let n=(e,t)=>{let i=this.pointer.get(e);return void 0===i&&(i={vertexSubentIdx:t,nodes:new Map},this.pointer.set(e,i)),i};var t=(e,t)=>{for(var i=e.getImgContainer(),r=t.getImgContainer();i.firstChild;)r.appendChild(i.firstChild)};t(e.iconSet,this.iconSet),t(e.iconSetOnHover,this.iconSetOnHover),e.pointer.forEach((e,t)=>{((e,t,i)=>{let r=n(e,t);r&&i.forEach(e=>{r.nodes.set(e.getnodeid(),e)})})(t,e.vertexSubentIdx,e.nodes)}),e.clear()}split(a,e){let n=(e,t)=>{t.icon&&e.iconSet.append(t.icon),e.iconSetOnHover.append(t.iconOnHover)};var t=(e,r)=>{e.forEach(t=>{var i=t.getSubEntPaths();for(let e=0;e<i.length;e++)if(r.pointer.has(i[e])){n(r,t.icons[e]);break}})};let s=e=>{let i=this.iconSet.getImgContainer(),r=this.iconSetOnHover.getImgContainer();e.icons.forEach(e=>{let t;e.icon&&(t=e.icon.getImgContainer(),i.contains(t))&&i.removeChild(t),t=e.iconOnHover.getImgContainer(),r.contains(t)&&r.removeChild(t)})};e.pointer.forEach((e,t)=>{let i=this.pointer.get(t);var r,n,o;i&&(r=((e,t,i)=>{let r=i.get(e);return void 0===r&&(r={vertexSubentIdx:t,nodes:new Map},i.set(e,r)),r})(t,i.vertexSubentIdx,a.pointer))&&(e.forEach((e,t)=>{i.nodes.has(t)&&s(e)}),n=i.nodes,o=r.nodes,e.forEach((e,t)=>{n.has(t)&&(o.set(t,e),n.delete(t))}),0===i.nodes.size)&&this.pointer.delete(t)}),t(e.current.dependency,a),t(e.target.dependency,this)}remove(e,t){var i=this.pointer.get(e);i&&(i.nodes.delete(t.getnodeid()),0===i.nodes.size)&&this.pointer.delete(e)}set(e,t,i){let r=this.pointer.get(e);void 0===r&&(r={vertexSubentIdx:t,nodes:new Map},this.pointer.set(e,r)),r.nodes.set(i.getnodeid(),i)}update(t){var i=this.pointer.entries();for(let e=i.next();!e.done;e=i.next()){var r=t(e.value[0],e.value[1].vertexSubentIdx);if(r){this.point=r;break}}}}class OsConstraintVertexContainer{constructor(){this.container=[],this.UID_allocator=new OsConstraintUIDAllocator}clear(){this.container=[]}create(e){e=new OsConstraintVertex(e,this.UID_allocator.allocateUID());return this.container.push(e),e}get(t,i=!1){if(t){let e=this.container.find(e=>e.compare(t));return e=void 0===e&&i?this.create(t):e}}forEach(e){this.container.forEach(e)}remove(t){var e=this.container.findIndex(e=>e.getUID()===t.getUID()&&e.compare(t.point));-1!==e&&this.container.splice(e,1),this.UID_allocator.freeUID(t.getUID())}}class OsEntity{constructor(e,t){this.m_mapIconSet=new Map,this.m_mapIconSetOnHover=new Map,this.groupId=e,this.subEntPath=t}getIconSetInfo(e){var t=this.m_mapIconSetOnHover.get(e);if(t){var i=OsConstraintHelper.getEntityBy(this.subEntPath);if(i){var r=i.getClass();if(r){e=getGripId(e,r);if(void 0!==e){r=i.getGrips();if(r&&!(r.length<=e))return{vertex:t.vertex,grippoint:r[e],issinfo:t}}}}}}append(n,e,o,t){let i=()=>{var e=OsConstraintHelper.getEntityBy(this.subEntPath);if(e){var t=e.getClass();if(t){t=getGripId(o,t);if(void 0!==t){e=e.getGrips();if(e&&!(e.length<=t))return e[t]}}}},r=()=>{var e=n.getFullSubentPath(this.subEntPath);if(e){if(e.hasVertexPoint())return e.getVertexPoint();var t=n.getFullSubentPaths();for(let e=0;e<t.length;e++)if(t[e].hasVertexPoint())return t[e].getVertexPoint()}},a=()=>{var e=i();return(e=e||r())?t.get(e,!0):void 0};var s,c=(e,t,i)=>{let r=e.get(o);if(void 0===r){if(!(r=i()))return;e.set(o,r),OsConstraintHelper.getImgContainer().appendChild(r.iconSet.getImgContainer())}return r.nodes.set(n.getnodeid(),n),r.vertex&&(r.vertex.set(this.subEntPath,o,n),r.vertex.has(n))||r.iconSet.append(t),r.iconSet};e.icon&&(s=c(this.m_mapIconSet,e.icon,()=>{var e={iconSet:void 0,nodes:new Map,vertex:void 0};if(o!==VertexSubentIdx.kNotDefine){var t=a();if(!t)return;e.iconSet=t.iconSet,e.vertex=t}else e.iconSet=new OsConstraintIconSet;return e}))&&e.icon.setIconSet(s),e.iconOnHover&&(s=c(this.m_mapIconSetOnHover,e.iconOnHover,()=>{var e={iconSet:void 0,nodes:new Map,vertex:void 0};if(o!==VertexSubentIdx.kNotDefine){var t=a();if(!t)return;e.iconSet=t.iconSetOnHover,e.vertex=t}else e.iconSet=new OsConstraintIconSetOnHover;return e}))&&e.iconOnHover.setIconSet(s)}remove(r,e,n,o){var t=(e,t)=>{var i=e.get(n);i&&(i.iconSet.remove(t),i.iconSet.isEmpty()&&(t=i.iconSet.getImgContainer())&&OsConstraintHelper.getImgContainer().contains(t)&&OsConstraintHelper.getImgContainer().removeChild(t),i.nodes.delete(r.getnodeid()),0===i.nodes.size&&e.delete(n),i.vertex)&&(i.vertex.remove(this.subEntPath,r),i.vertex.isEmpty())&&o.remove(i.vertex)};e.icon&&t(this.m_mapIconSet,e.icon),e.iconOnHover&&t(this.m_mapIconSetOnHover,e.iconOnHover)}static adjustIconSetPointSCS(e,t,i){var r=i[0],n=i[1],o=r+";"+n;let a=e.get(o);if(void 0===a)a=[],e.set(o,a);else if(a.includes(t))return!1;return i[0]=r+8,i[1]=n+8+(OsConstraintIcon.height()+3)*a.length,a.push(t),!0}isEmpty(){return 0===this.m_mapIconSet.size&&0===this.m_mapIconSetOnHover.size}drawIconOnHover(e){var t,i,r=OsConstraintHelper.getEntityBy(this.subEntPath);r&&(i=r.getClass())&&(t=OsConstraintHelper.pointToSCS(e),void 0!==(r=r.CheckIfGrip(t))?void 0!==(r=getVertexSubentIdx(r,i))&&(i=this.m_mapIconSetOnHover.get(r))&&(i.iconSet.isVisible()||(i.iconSet.setPointWCS(e),t[0]+=8,t[1]+=8,i.iconSet.setPosition(t)),i.iconSet.showForDuration()):(r=this.m_mapIconSetOnHover.get(VertexSubentIdx.kNotDefine))&&(r.iconSet.isVisible()||(r.iconSet.setPointWCS(e),t[0]+=8,t[1]+=8,r.iconSet.setPosition(t)),r.iconSet.showForDuration()))}getgroupid(){return this.groupId}hide(e=void 0){if(void 0!==e){e=this.m_mapIconSet.get(e);if(!e)return;let t;e.nodes.forEach(e=>{e.isValid()||(t=!0)}),void(t?e.nodes.forEach(e=>{e.isValid()&&e.hideIcon()}):(e.nodes.forEach(e=>{e.isValid()&&e.showIcon()}),e.iconSet.isVisible()&&e.iconSet.hide()))}else this.m_mapIconSet.forEach(e=>{let t;e.nodes.forEach(e=>{e.isValid()||(t=!0)}),t?e.nodes.forEach(e=>{e.isValid()&&e.hideIcon()}):(e.nodes.forEach(e=>{e.isValid()&&e.showIcon()}),e.iconSet.isVisible()&&e.iconSet.hide())}),this.m_mapIconSetOnHover.forEach(e=>{e.iconSet.isVisible()&&e.iconSet.hide()})}show(r,t=void 0){let n=(e,t)=>{var i=OsConstraintHelper.pointToSCS(t);e.setPointWCS(t),OsEntity.adjustIconSetPointSCS(r,e,i)&&(e.setPosition(i),e.show())},o=e=>{var t=OsConstraintHelper.getEntityBy(this.subEntPath);if(t){var i=t.getClass();if(i){e=e!==VertexSubentIdx.kNotDefine?getGripId(e,i):getGripCenterId(i);if(void 0!==e){i=t.getGrips();if(i&&!(i.length<=e))return i[e]}}}},a=e=>{let t;return e.nodes.forEach(e=>{e=e.getFullSubentPaths(!0);e.hasVertexPoint()&&void 0===t&&(t=e.getVertexPoint())}),t};if(void 0!==t){var i=this.m_mapIconSet.get(t);if(!i)return;let e;return(e=(e=a(i))||o(t))?(i.nodes.forEach(e=>{e.isValid()?e.hideIcon():e.showIcon()}),void n(i.iconSet,e)):void 0}this.m_mapIconSet.forEach((e,t)=>{let i;(i=(i=a(e))||o(t))&&(e.nodes.forEach(e=>{e.showIcon()}),n(e.iconSet,i))})}showRedundant(n,e=void 0){let o=e=>{var t=OsConstraintHelper.getEntityBy(this.subEntPath);if(t){var i=t.getClass();if(i){e=e!==VertexSubentIdx.kNotDefine?getGripId(e,i):getGripCenterId(i);if(void 0!==e){i=t.getGrips();if(i&&!(i.length<=e))return i[e]}}}},r=(e,t)=>{let i;var r;(i=(i=(e=>{let t;return e.nodes.forEach(e=>{e=e.getFullSubentPaths(!0);e.hasVertexPoint()&&void 0===t&&(t=e.getVertexPoint())}),t})(e))||o(t))&&(t=e.iconSet,e=i,r=OsConstraintHelper.pointToSCS(e),t.setPointWCS(e),OsEntity.adjustIconSetPointSCS(n,t,r))&&(t.setPosition(r),t.show())};void 0===e&&this.m_mapIconSet.forEach((e,t)=>{let i;e.nodes.forEach(e=>{e.isValid()||(i=!0)}),i&&(e.nodes.forEach(e=>{e.isValid()?e.hideIcon():e.showIcon()}),r(e,t))})}OnClientPending(){this.m_mapIconSet.forEach(e=>{e.iconSet.isVisible()&&e.iconSet.hide()}),this.m_mapIconSetOnHover.forEach(e=>{e.iconSet.isVisible()&&e.iconSet.hide()})}OnWheel(i){this.m_mapIconSet.forEach(e=>{var t;(e=e.iconSet).isVisible()&&(t=e.getPointWCS(),t=OsConstraintHelper.pointToSCS(t),OsEntity.adjustIconSetPointSCS(i,e,t))&&e.setPosition(t)}),this.m_mapIconSetOnHover.forEach(e=>{var t;(e=e.iconSet).isVisible()&&(t=e.getPointWCS(),(t=OsConstraintHelper.pointToSCS(t))[0]+=8,t[1]+=8,e.setPosition(t))})}OnUpdateEntity(){if(!OsConstraintHelper.getEntityBy(this.subEntPath)){let i=(e,t)=>{1<t.getCount()?(e=e.pointer.get(this.subEntPath))&&e.nodes.forEach(e=>{e.hideIcon()}):t.hide()};var e=(e,t)=>{t!==MainIconSet?e.vertex&&(i(e.vertex,e.vertex.iconSet),i(e.vertex,e.vertex.iconSetOnHover)):e.iconSet.hide()};this.m_mapIconSet.forEach(e),this.m_mapIconSetOnHover.forEach(e)}}}var ATFTest=function(){this.getGDIContext=function(){return window.getXeActiveDocument().getXeGsDevice().getFxGDIDevice()};var t=this;t.isOsViewsUploadedToServer=function(e){return!1},t.isDrawingLoadComplete=function(e){return!1},t.lastGeometryUpdateTS=-1,t.lastViewportUpdateTS=-1,t.lastLastStateUpdateTS=-1,document.addEventListener("Update_XeGsIndexedChunk",function(e){t.lastGeometryUpdateTS=(new Date).getTime()}),document.addEventListener("Update_XeGsViewport",function(e){t.lastViewportUpdateTS=(new Date).getTime()}),document.addEventListener("XeClientStateUpdated",function(e){t.lastLastStateUpdateTS=(new Date).getTime()})},OsBOMBalloonManager=(ATFTest.prototype.DrawingLoadComplete=function(){return this.isDrawingLoadComplete()},ATFTest.prototype.CommandComplete=function(){return window.getXeActiveDocument().getXeDatabase().getCMDNAMES()&&0===window.getXeActiveDocument().getXeDatabase().getCMDNAMES().length},ATFTest.prototype.LastDrawingUpdate=function(){return{geometry:this.lastGeometryUpdateTS,viewport:this.lastViewportUpdateTS,state:this.lastLastStateUpdateTS}},ATFTest.prototype.DrawingContent=function(){var e=window.getXeActiveDocument(),t=e.getXeDatabase().getXeEntities(),g=e.getXeGsDevice(),i=g.getXeGsViewports(),r=g.getChunks();if(window.getXeActiveDocument().getXeGsDevice().getActiveViewport()){var n,o=[];for(n in t){var a=t.getByHandle(n);if(a){var s,c=a.getCachedXeGsOffsets(),l=[],d=[];for(s in c)if(c.hasOwnProperty(s)){var u=r[s];if(u){var p=i.getByVpnum(u.getVpNum());if(p)for(var m=c[s],h=0;h<m.length;h++)var y=((e,t,i)=>{var r=[],n=[],o=t.getGeometryToModelMatrix();if(t instanceof XeGsSimpleChunk){for(var a,s,c=t.getItems(),l=i.o,d=l+i.s,u=new XeGsIntermediateSimplificationContainer,p=l;p<d;p++){var m,h=c[p];h&&(m=g.getDeviation(e.getVpNum()),h.process_points(m,u))}for(a of u.linesArray)r=r.concat(f(e,a.storage.indices.fittedArray,a.storage.vertices.fittedArray,o,null));for(s of u.trianglesArray)n=n.concat(_(e,s.storage.indices.fittedArray,s.storage.vertices.fittedArray,o,null))}else t instanceof XeGsIndexedChunk&&t.getIndexes()&&t.getVertexes()&&(-1!==t.getType().indexOf("LS")?r=r.concat(f(e,t.getIndexes(),t.getVertexes(),o,i)):-1!==t.getType().indexOf("TS")&&(n=n.concat(_(e,t.getIndexes(),t.getVertexes(),o,i))));return{_edges:r,_polygons:n}})(p,u,m[h]),l=l.concat(y._edges),d=d.concat(y._polygons)}}o.push({handle:a.getHandle(),objectType:a.getClass(),isHidden:a.IsHidden()||0===Object.getOwnPropertyNames(c).length,gripPoints:a.getGrips?a.getGrips():[],edges:l,polygons:d})}}return o}function f(e,t,i,r,n){var o=[],a=[0,0],s=[0,0],c=new GeNeo.OdGePoint3d,l=new GeNeo.OdGePoint3d,d=0,u=t.length;n&&(u=(d=n.o)+n.s);for(var p=d;p<u&&!(p>t.length-1||p+1>t.length-1);p+=2){var m=t[p];m<=0||(c.set(i[3*m],i[3*m+1],i[3*m+2]),(m=t[p+1])<=0)||(l.set(i[3*m],i[3*m+1],i[3*m+2]),m=c.isEqualTo(l),r&&(c.transformBy(r),l.transformBy(r)),e.PointToSCSFast(a,c.x,c.y,c.z),e.PointToSCSFast(s,l.x,l.y,l.z),m&&(s[0]+=1,s[1]+=1),o.push({start:a,end:s}))}return o}function _(e,t,i,r,n){var o=[],a=[0,0],s=[0,0],c=[0,0],l=new GeNeo.OdGePoint3d,d=new GeNeo.OdGePoint3d,u=new GeNeo.OdGePoint3d,p=0,m=t.length;n&&(m=(p=n.o)+n.s);for(var h=p;h<m&&!(h>t.length-1||h+1>t.length-1||h+2>t.length-1);h+=3){var g=t[h];g<=0||(l.set(i[3*g],i[3*g+1],i[3*g+2]),(g=t[h+1])<=0)||(d.set(i[3*g],i[3*g+1],i[3*g+2]),(g=t[h+2])<=0)||(u.set(i[3*g],i[3*g+1],i[3*g+2]),r&&(l.transformBy(r),d.transformBy(r),u.transformBy(r)),e.PointToSCSFast(a,l.x,l.y,l.z),e.PointToSCSFast(s,d.x,d.y,d.z),e.PointToSCSFast(c,u.x,u.y,u.z),l.isEqualTo(d)&&(s[0]+=1,s[1]+=1),d.isEqualTo(u)&&(--s[0],s[1]+=1),l.isEqualTo(u)&&(s[0]+=1,--s[1]),o.push([a,s,c]))}return o}},ATFTest.prototype.HighlightedObjects=function(){for(var e=window.getXeActiveDocument(),t=e.getXeDatabase().getXeEntities(),i=e.getXeInputPointManager().GetApertureSelection(),r=[],n=0;n<i.length;n++){var o=i[n],o=t.getByHandle(o);r.push({handle:o.getHandle(),objectType:o.getClass()})}return r},ATFTest.prototype.SelectedObjects=function(){for(var e=window.getXeActiveDocument().getXeDatabase().getXeEntities(),t=window.getXeActiveDocument().getXeMainSelectionSet().getHandles(),i=[],r=0;r<t.length;r++){var n=t[r],o=e.getByHandle(n);o&&i.push({handle:n,objectType:o.getClass()})}return i},ATFTest.prototype.ViewMatrix=function(){var e=window.getXeActiveDocument().getXeGsDevice().getActiveViewport(),t=e.worldToGLNormClippedProjMatrix(),e=e.viewingMatrix(),t=t.mult(e);return new Float32Array(t.toGLArray())},ATFTest.prototype.ClientsideCanvasContents=function(){if(clientSideTrackersHolder){var e,t,i={};for(e in clientSideTrackersHolder)clientSideTrackersHolder.hasOwnProperty(e)&&(clientSideTrackersHolder[e],t=window.XeActiveTrackers.TrackerData(e))&&(i[e]=t);return i}},ATFTest.prototype.ServersideCanvasContent=function(){if(this.getGDIContext().drawArray){for(var e={points:[],polylines:[],polygons:[]},t=[0,0],i=window.getXeActiveDocument().getXeGsDevice().getActiveViewport(),r=0;r<this.getGDIContext().drawArray.length;r++){var n=this.getGDIContext().drawArray[r],o=n.vertex_arr;switch(n.type){case this.getGDIContext().type.point:for(r=0;r<o.length;r++)i.PointToSCSFast(t,o[r][0],o[r][1],o[r][2]),e.points.push([t[0],t[1]]);break;case this.getGDIContext().type.polyline:for(r=0;r<o.length;r++)i.PointToSCSFast(t,o[r][0],o[r][1],o[r][2]),e.polylines.push([t[0],t[1]]);break;case this.getGDIContext().type.polygon:for(r=0;r<o.length;r++)i.PointToSCSFast(t,o[r][0],o[r][1],o[r][2]),e.polygons.push([t[0],t[1]])}}return e}},ATFTest.prototype.findAllButtonsInToolbar=function(e){for(var t=[],i=e.children,r=0;r<i.length;r++)t=t.concat(this.findAllButtonsInToolbar(i[r]));return-1<e.id.indexOf("button_ID_")&&t.push(e),t},ATFTest.prototype.ActiveToolbarButton=function(){var e=document.getElementById(window.getXeApplication().getXeUI().getNavigationToolbar().getId());if(!e)return null;var t=this.findAllButtonsInToolbar(e);if(!t||0===t.length)return null;for(var i,e="",r=0;r<t.length;r++){for(var n=!1,o=t[r].classList,a=0;a<o.length;a++)if("selected"===o[a]){i=t[r],n=!0;break}if(n)break}return e=i?i.id:e},ATFTest.prototype.IsPromptWidgetVisible=function(){for(var e=document.getElementsByTagName("div"),t=0;t<e.length;t++)if(-1<e[t].id.indexOf("PromptWidget"))return"none"!==e[t].style.display;return!1},window.ATFTestObject=new ATFTest,function(){var C=this;C.tabEventHandlers=new Map,C.initEventListener=function(u,r){u.history=[],u.curHistoryIndex=0,u.saveHistory=function(e){var t=u.innerHTML;t==u.history[u.curHistoryIndex]&&1!=e||(u.curHistoryIndex<u.history.length-1&&(u.history=u.history.slice(0,u.curHistoryIndex+1),u.curHistoryIndex++),u.history.push(t),u.curHistoryIndex=u.history.length-1)},u.undo=function(){0<u.curHistoryIndex&&(u.innerHTML=u.history[u.curHistoryIndex-1],C.emitBalloonTextEditChanged(u),window.Wt.layouts2.adjust(),u.curHistoryIndex--)},u.redo=function(){u.history[u.curHistoryIndex+1]&&(u.innerHTML=u.history[u.curHistoryIndex+1],C.emitBalloonTextEditChanged(u),window.Wt.layouts2.adjust(),u.curHistoryIndex++)},u.addEventListener("keypress",function(e){var t,i;(e.target.attributes.maxLength&&e.target.innerText.length>=e.target.attributes.maxLength.value||13==e.which&&(t=e.target.getElementsByTagName("div").length,i=e.target.getElementsByTagName("br").length-t,0<r)&&r<=t+i)&&e.preventDefault()}),u.addEventListener("keydown",function(e){if(u.saveHistory(),!0!==e.ctrlKey&&!0!==e.metaKey||89!==e.which&&90!==e.which){var t,i,r,n,o,a,s;if(C.fixCaretPosition(),window.Wt.layouts2.adjust(),"INPUT"===e.target.tagName.toUpperCase()||e.srcElement&&"INPUT"===e.srcElement.tagName.toUpperCase())if(46===e.keyCode||8===e.keyCode)return e.preventDefault(),i=e.target.parentElement,r=e.target.previousSibling,e.target.remove(),(t=$("body"))&&t.find(".tooltip").remove(),C.setCursor(i,r),void C.emitBalloonTextEditChanged(u);-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&e.target&&window.CFxUI.css_helper.hasStyleClass(e.target,"BalloonTextEdit")&&window.getSelection&&(i=window.getSelection()).rangeCount&&(n=(r=i.getRangeAt(0)).endContainer,46===e.keyCode||8===e.keyCode?(n.tagName&&"DIV"===n.tagName.toUpperCase()?r.startOffset===r.endOffset&&(46===e.keyCode?o=n.childNodes[r.startOffset]:0<r.startOffset&&(o=n.childNodes[r.startOffset-1]),o)&&o.tagName&&"INPUT"===o.tagName.toUpperCase()&&(a=o):46===e.keyCode&&0===n.data.substring(r.endOffset,n.length).length&&(s=n.nextSibling)&&s.tagName&&"INPUT"===s.tagName.toUpperCase()&&(a=s),a&&(e.preventDefault(),a.remove(),(t=$("body"))&&t.find(".tooltip").remove(),C.emitBalloonTextEditChanged(u))):37!==e.keyCode&&39!==e.keyCode||n.tagName&&"DIV"===n.tagName.toUpperCase()&&r.startOffset===r.endOffset&&(37===e.keyCode&&0<r.startOffset?o=n.childNodes[r.startOffset-1]:39===e.keyCode&&(o=n.childNodes[r.startOffset]),o)&&o.tagName&&"INPUT"===o.tagName.toUpperCase()&&(s=37===e.keyCode?r.startOffset-1:r.startOffset+1,r.setStart(n,s),r.setEnd(n,s),r.collapse(!0),i.removeAllRanges(),i.addRange(r),e.preventDefault()))}else 89===e.which?u.redo():u.undo(),e.preventDefault(),C.fixCaretPosition()}),u.addEventListener("keyup",function(t){var i=t.target.getElementsByTagName("div").length;if(0===i){for(var e=t.target.getElementsByTagName("br");e&&0<e.length;)t.target.removeChild(e[0]);var r=document.createElement("div");r.appendChild(document.createElement("br")),t.target.appendChild(r)}else{var n=[],o=t.target.getElementsByTagName("div");for(let e=0;e<i;e++){var a=o[e];a.parentNode===t.target&&n.push(a)}for(let e=0;e<n.length;e++)for(var s=n[e],c=(s.innerHTML.endsWith("<br>")||s.appendChild(document.createElement("br")),s.getElementsByTagName("span"));c&&0<c.length;){let e=c[0];for(;e.parentNode!==s;)e=e.parentNode;var l=document.createTextNode(e.innerText),d=e.nextSibling;s.removeChild(e),d?s.insertBefore(l,d):s.appendChild(l)}}r=u.innerText;!window.getXeApplication().GetCapability("drawings_symbols_dropdown_in_callout_dialog")||-1==r.indexOf("%%p")&&-1==r.indexOf("%%P")&&-1==r.indexOf("%%d")&&-1==r.indexOf("%%D")&&-1==r.indexOf("%%c")&&-1==r.indexOf("%%C")||C.replacePatternWithSymbol(u,1==t.ctrlKey&&("v"==t.key||"V"==t.key)),C.emitBalloonTextEditChanged(u),window.Wt.layouts2.adjust()}),u.addEventListener("paste",function(e){u.saveHistory(),e.preventDefault();var t=e.clipboardData.getData("text/plain");e.currentTarget.attributes.maxLength&&e.currentTarget.innerText.length+t.length>=e.currentTarget.attributes.maxLength.value||window.document.execCommand("insertText",!1,t)})},C.initializeTooltips=function(e){for(var t=e.getElementsByTagName("input"),i=0;i<t.length;i++){var r=t[i];0<r.dataset.displayName.length&&C.setTooltip(r,r.dataset.propType,r.dataset.displayName)}e=e.getElementsByTagName("img");1===e.length&&e[0].hasAttribute("data-flag-note-prop")&&C.setTooltip(e[0],"4","")},C.fixCaretPosition=function(){if(window.getSelection){var e=window.getSelection();if(e.rangeCount){var t=e.getRangeAt(0);if(!0===t.collapsed&&t.commonAncestorContainer&&window.CFxUI.css_helper.hasStyleClass(t.commonAncestorContainer,"BalloonTextEdit")){var i=t.commonAncestorContainer.getElementsByTagName("div")[0];if(!i){for(var r=t.commonAncestorContainer.getElementsByTagName("br"),n=0;n<r.length;n++)t.commonAncestorContainer.removeChild(r[n]);(i=document.createElement("div")).appendChild(document.createElement("br")),t.commonAncestorContainer.appendChild(i)}t.setStart(i,0),t.setEnd(i,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}}}},C.setCursor=function(e,t){var i,r,n;window.getSelection&&(i=document.createRange(),n=0,r=e,n=t?Array.prototype.indexOf.call(e.childNodes,t)+1:(e=(r=0<(t=e.getElementsByTagName("div")).length?t[t.length-1]:r).getElementsByTagName("br")[0],Array.prototype.indexOf.call(r.childNodes,e)),i.setStart(r,n),i.setEnd(r,n),i.collapse(!0),(t=window.getSelection()).removeAllRanges(),t.addRange(i))},C.emitBalloonTextEditChanged=function(e){for(var t=e.cloneNode(!0),i=t.getElementsByTagName("input"),r=0;r<i.length;r++){var n=i[r];n.dataset.displayName=n.dataset.displayName.replace(/[<>]/g,function(e){return{"<":"&lt;",">":"&gt;"}[e]}),n.value=n.value.replace(/[<>]/g,function(e){return{"<":"&lt;",">":"&gt;"}[e]})}Wt.emit(e,"BalloonTextEditChanged",t.innerHTML)},C.insertProperty=function(t,i,r,n,o,a,s){if(C.fixCaretPosition(),window.getSelection){var c=window.getSelection();if(!c.rangeCount){if("Safari"!==window.XeUtils.UserAgentDetector.browser)return;C.setCursor(t),c=window.getSelection()}t=c.getRangeAt(0);if(t.commonAncestorContainer&&t.commonAncestorContainer.parentNode&&(window.CFxUI.css_helper.hasStyleClass(t.commonAncestorContainer.parentNode,"BalloonTextEdit")||t.commonAncestorContainer.parentNode.parentNode&&window.CFxUI.css_helper.hasStyleClass(t.commonAncestorContainer.parentNode.parentNode,"BalloonTextEdit"))){var l,d,u=t.startContainer,p=u,m=t.endContainer,c=("DIV"!==u.tagName?(p=u.parentNode,l=document.createTextNode(u.data.substring(0,t.startOffset))):u=p.childNodes[t.startOffset],p.parentElement.saveHistory(),u.nextSibling);let e;if("4"===i){for(let e=0;e<p.parentElement.childNodes.length;++e){var h=p.parentElement.childNodes[e];if("DIV"===h.tagName){let t;for(let e=0;e<h.childNodes.length;++e)if("IMG"===h.childNodes[e].tagName){t=h.childNodes[e];break}if(t){h.removeChild(t);break}}}(e=document.createElement("img")).src=n,e.dataset.flagText=o,e.dataset.shapeType=a,e.dataset.fitOption=r,e.dataset.flagNoteProp=s,e.setAttribute("width",24),e.setAttribute("height",16),n=""}else{var g=document.createElement("input");g.type="button",g.dataset.propType=i,g.dataset.prop=r,g.dataset.displayName=n,g.dataset.valueType=a,g.dataset.placeholder=s,g.value=o,e=g}if(C.setTooltip(e,i,n),u){if("DIV"!==m.tagName)d=document.createTextNode(m.data.substring(t.endOffset,m.length));else{if(t.startOffset===t.endOffset)return p.contains(u)?p.insertBefore(e,u):c?p.insertBefore(e,c):p.appendChild(e),C.setCursor(p,e),void C.emitBalloonTextEditChanged(p.parentElement);m=p.childNodes[t.endOffset-1]}var y=[],f=!1;p.childNodes.forEach(function(e){!0===(f=e===u?!0:f)&&y.push(e),e===m&&(f=!1)});for(var r=m.nextSibling,_=0;_<y.length;_++)p.removeChild(y[_]);r?(l&&p.insertBefore(l,r),p.insertBefore(e,r),d&&p.insertBefore(d,r)):(l&&p.appendChild(l),p.appendChild(e),d&&p.appendChild(d))}else p.appendChild(e);C.setCursor(p,e),C.emitBalloonTextEditChanged(p.parentElement)}}},C.insertSymbol=function(e,t){if(C.fixCaretPosition(),window.getSelection){var i=window.getSelection();if(!i.rangeCount){if("Safari"!==window.XeUtils.UserAgentDetector.browser)return;C.setCursor(e),i=window.getSelection()}e=i.getRangeAt(0);if(e.commonAncestorContainer&&e.commonAncestorContainer.parentNode&&(window.CFxUI.css_helper.hasStyleClass(e.commonAncestorContainer.parentNode,"BalloonTextEdit")||e.commonAncestorContainer.parentNode.parentNode&&window.CFxUI.css_helper.hasStyleClass(e.commonAncestorContainer.parentNode.parentNode,"BalloonTextEdit"))){var r,n,o=e.startContainer,a=o,s=e.endContainer,i=("DIV"!==o.tagName?(a=o.parentNode,r=document.createTextNode(o.data.substring(0,e.startOffset))):o=a.childNodes[e.startOffset],a.parentElement.saveHistory(),o.nextSibling),t=document.createTextNode(t);if(o){if("DIV"!==s.tagName)n=document.createTextNode(s.data.substring(e.endOffset,s.length));else{if(e.startOffset===e.endOffset)return a.contains(o)?a.insertBefore(t,o):i?a.insertBefore(t,i):a.appendChild(t),C.setCursor(a,t),void C.emitBalloonTextEditChanged(a.parentElement);s=a.childNodes[e.endOffset-1]}var c=[],l=!1;a.childNodes.forEach(function(e){!0===(l=e===o?!0:l)&&c.push(e),e===s&&(l=!1)});for(var i=s.nextSibling,d=0;d<c.length;d++)a.removeChild(c[d]);i?(r&&a.insertBefore(r,i),a.insertBefore(t,i),n&&a.insertBefore(n,i)):(r&&a.appendChild(r),a.appendChild(t),n&&a.appendChild(n))}else a.appendChild(t);C.setCursor(a,t),C.emitBalloonTextEditChanged(a.parentElement)}}},C.getSymbol=function(e){"%%d"==e||"%%D"==e?t="0x00B0":"%%p"==e||"%%P"==e?t="0x00B1":"%%c"!=e&&"%%C"!=e||(t="0x00D8");var t,e=parseInt(t,16);return String.fromCharCode(e)},C.replacePatternWithSymbol=function(e,t){if(C.fixCaretPosition(),window.getSelection){var i=window.getSelection();if(!i.rangeCount){if("Safari"!==window.XeUtils.UserAgentDetector.browser)return;C.setCursor(e),i=window.getSelection()}e=i.getRangeAt(0);if(e.commonAncestorContainer&&e.commonAncestorContainer.parentNode&&(window.CFxUI.css_helper.hasStyleClass(e.commonAncestorContainer.parentNode,"BalloonTextEdit")||e.commonAncestorContainer.parentNode.parentNode&&window.CFxUI.css_helper.hasStyleClass(e.commonAncestorContainer.parentNode.parentNode,"BalloonTextEdit"))){var r,n=e.startContainer.parentNode,o=[],a=[],s=!1;if(n.childNodes.forEach(function(e){var t;"#text"==e.nodeName&&(t=e.textContent,["%%d","%%D","%%p","%%P","%%c","%%C"].forEach(function(e){-1!=t.indexOf(e)&&(a.push(e),s=!0)}),s)&&(o.push(e),r=e.nextSibling)}),s){for(var c=0;c<o.length;c++)n.removeChild(o[c]);for(var l="",d=0;d<o.length;d++)var u=o[d].textContent,l=l.concat(u);if(t){for(var p=0;p<a.length;p++){-1!=l.indexOf(a[p])&&(m=l.split(a[p])),v=C.getSymbol(a[p]);for(var m,h="",g=0;g<m.length;g++)h=h.concat(m[g]),g!=m.length-1&&(h=h.concat(v));l=h}l&&(i=document.createTextNode(l),n.insertBefore(i,r),C.setCursor(n,i))}else{var y,f,_,w,v=C.getSymbol(a[0]);["%%d","%%D","%%p","%%P","%%c","%%C"].forEach(function(e){-1!=l.indexOf(e)&&(y=l.split(e))}),2==y.length&&(f=y[0],_=y[1]),f&&(e=document.createTextNode(f),n.insertBefore(e,r)),v&&(w=document.createTextNode(v),n.insertBefore(w,r)),_&&(t=document.createTextNode(_),n.insertBefore(t,r)),C.setCursor(n,w)}C.emitBalloonTextEditChanged(n.parentElement)}}}},C.handleTabEvent=function(r){C.tabEventHandlers&&C.tabEventHandlers.forEach(function(e){e!==r&&C.removeTabEventHandler(r)}),C.tabEventHandlers.set(r,function(e){var t,i;9==e.which&&(i=(t=$("#"+r+" *[tabindex]:not(.disabled):not(.toolbar-button):not([style*='display: none'],[style*='display:none'])")).index(e.target),(e.shiftKey?e.target.id===t[0].id?t[t.length-1]:t[i-1]:e.target.id===t[t.length-1].id?t[0]:t[i+1]).focus(),e.preventDefault())}),window.addEventListener("keydown",C.tabEventHandlers.get(r))},C.removeTabEventHandler=function(e){C.tabEventHandlers&&C.tabEventHandlers.has(e)&&(window.removeEventListener("keydown",C.tabEventHandlers.get(e)),C.tabEventHandlers.delete(e))},C.setTooltip=function(t,i,r){let n=r,o="#"+$(".Wt-domRoot").get(0).id;window.getXeApplication().RequestLocalizedStringMap().then(function(e){e.hasOwnProperty("COsBalloonTextEdit_table")&&e.hasOwnProperty("COsBalloonTextEdit_part")&&e.hasOwnProperty("COsBalloonTextEdit_cutlist")&&e.hasOwnProperty("COsBalloonTextEdit_flagnote")&&(n=(n="0"===i?e.COsBalloonTextEdit_table:"4"===i?e.COsBalloonTextEdit_flagnote:"3"===i?e.COsBalloonTextEdit_cutlist:e.COsBalloonTextEdit_part).replace("%1",r)),$(t).tooltip({placement:"top",trigger:"hover",delay:{show:400,hide:1},title:n,container:o})})}});function OSC(){for(var M,L,R,I,k,e,t,N=new Map,F=new Map,i=decodeURIComponent(window.location.search.substr(1)).split("&"),r=0;r<i.length;r++)if(2===(e=i[r].split("=")).length)switch(e[0]){case"documentId":M=e[1];break;case"workspaceId":L=e[1];break;case"elementId":R=e[1];break;case"server":I=e[1];break;case"mobile":k=e[1]}function n(e,t){var i;window.OnshapeMobileInterface?window.OnshapeMobileInterface[e]&&window.OnshapeMobileInterface[e](R,"",t):window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface?(i={methodName:e,elementId:R},t&&(i.logErrorMessage=t),window.webkit.messageHandlers.OnshapeMobileInterface.postMessage(i)):window!==window.parent&&(i={documentId:M,workspaceId:L,elementId:R,messageName:e},t&&(i.logErrorMessage=t),window.parent.postMessage(i,"*")),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e)}function o(e,t,i,r,n,o){var a;window.OnshapeMobileInterface?window.OnshapeMobileInterface[e]&&window.OnshapeMobileInterface[e](R,t,r):window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface?(a={methodName:e,elementId:R,message:t},r&&(a.logErrorMessage=r),window.webkit.messageHandlers.OnshapeMobileInterface.postMessage(a)):window!==window.parent?(a={documentId:M,workspaceId:L,elementId:R,messageName:e,message:t,autoDismiss:i=null==i?!1:i},n&&(a.messageType=n),void 0!==o&&("text/html"===o?a.clipboardDataType=o:"clearData"===o&&(a.clipboardText="")),r&&(a.logErrorMessage=r),window.parent.postMessage(a,"*")):"errorReload"===e&&swal({title:t,type:"error",confirmButtonText:"Reload"},function(e){document.location=document.location}),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e)}function a(e,t,i){window.OnshapeMobileInterface||window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface||(window!==window.parent&&(t={documentId:M,workspaceId:L,elementId:R,messageName:e,storageKey:t},i&&(t.content=i),window.parent.postMessage(t,"*")),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e))}function s(){window.getXeApplication()&&window.getXeApplication().RequestLocalizedStringMap().then(function(e){let t="Session ended.";e.hasOwnProperty("SessionEndMessage")&&(t=e.SessionEndMessage),window.XeClientMessageProxy&&window.XeClientMessageProxy.call("errorReload",[t]),window.onunload(),window.Wt._p_.quit()}),t=null}function c(){null!==t&&(n("keepAlive"),setTimeout(c,6e5))}function V(e){XeRequest.prototype.Promise(window.getXeActiveDocument(),{},"RequestSheets").then(e=>{window.OnshapeMobileInterface||window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface||(window!==window.parent&&(e={messageName:"querySheetsResponse",documentId:M,workspaceId:L,elementId:R,sheets:e},window.parent.postMessage(e,"*")),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: querySheetsResponse"))})}function B(e,t){window.getXeApplication()?window.getXeActiveDocument()?window.getXeActiveDocument().RunCmd(e):window.XeLogger.warn("null XeDocument in RunCmd: "+t):window.XeLogger.warn("null XeApplication in RunCmd: "+t)}window.osc=this,window.osc._a=function(e){e&&e._m&&(e._mc?o(e._m,e._mc,e._ad,e._me,e._mt):n(e._m,e._me))},window.osc._ba=function(){setTimeout(c,6e5),t=setTimeout(s,144e5)},window.osc._bb=function(){null!==t&&(clearTimeout(t),t=setTimeout(s,144e5))},window.osc._c=function(e,t,i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b,X,S,P,D,x,O){var G,E,A,I,k;window!==window.parent&&(!0===(E=G={left:w,top:_},k=!1,"_OSPROPERTY_CHANGEDWGPROPERTIESFROMTEMPLATE"===(A=p)&&(A=$(".xenon-flyout-right"))&&(I=A.offset().top+A.outerHeight()-520,0<(A=A.position().left+40-300)&&(E.left=A,k=!0),0<I)&&(E.top=I,k=!0),k)&&(w=G.left,_=G.top),A={documentId:M,workspaceId:L,elementId:R,messageName:"openSelectItemDialog",dialogTitle:u,selectParts:i,selectAssemblies:e,selectPartStudios:t,selectSketches:r,selectFlattenedBodies:n,showPartStudioFilterBar:g,selectBlobs:o,selectBlobMimeTypes:a,blobItemTitle:s,selectApplications:c,selectApplicationFormatIds:l,applicationItemTitle:d,context:p,supportsCurrentDocumentVersions:y,openForDrawingTemplates:m,showImportButton:h,selectMultiple:f,defaultTop:_,defaultLeft:w,restrictToDocumentId:v,restrictToElementId:C,restrictToVersionId:T,restrictToMicroversionId:b,restrictToIdTag:X,sketchIds:S.split(","),restrictToConfiguration:P,showToolbarFSTables:D,showBrowseDocuments:x,supportsReferencesInThisWorkspace:O},t&&!i&&(A.includeEmptyPartStudios=!0,A.needPartStudioFilter=!1,A.partStudioItemPluralName="Part Studios",A.selectCompositeParts=!1,A.selectSurfaces=!1,A.selectWires=!1),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+A.messageName),window.parent.postMessage(A,"*"),N.set(p,!0),F.set(p,!0))},window.osc._d=function(t){if(t.origin&&t.data&&t.data.messageName){window.getXeApplication()||window.XeLogger.warn("null XeApplication in handlePostMessage: "+t.data.messageName),window.getXeActiveDocument()||window.XeLogger.warn("null XeDocument in handlePostMessage: "+t.data.messageName),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg received in application element.");let e=!1;var i,r,n,o,a,s,c,l,d,u,p,m,h,g,y,f,_,w,v,C,T,b,X,S,P,D,x,O,G,E,A;"queryDrawingJson"!==t.data.messageName&&"onshapeCreateAnnotations"!==t.data.messageName&&"onshapeEditAnnotations"!==t.data.messageName||(e=!0),I===t.origin||"true"===k||window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("OSC_DEBUG")||e?(window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Message safe and can be handled as it is from origin '"+t.origin+"', which matches server query parameter '"+I+"'."),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Message name = '"+t.data.messageName+"'"),u=!1,(d=window.getXeActiveDocument()&&window.getXeActiveDocument().getXeDatabase()?window.getXeActiveDocument().getXeDatabase().getCMDNAMES():[]).length&&(u=-1<(d=d[d.length-1]).indexOf("_OSREPLACEBOMREFERENCE")||-1<d.indexOf("_OSREPLACEREFERENCE")||-1<d.indexOf("_OSIMAGE")||-1<d.indexOf("_OSINSERTDWG")||-1<d.indexOf("_OSUPDATESKETCHDATA")||-1<d.indexOf("_OSPROPERTY_CHANGEDWGPROPERTIESFROMTEMPLATE")),d=jQuery("[data-object-name=COsDlgDrawingView]")[0],p=jQuery("[data-object-name=COsDlgBOMInsertion]")[0],X=jQuery("[data-object-name=COsDlgSheetProperties]")[0],i=jQuery("[data-object-name='OsDrawingExplorer']")[0],x=jQuery("[data-object-name=COsDlgCustomTableInsertion]")[0],"itemSelectedInSelectItemDialog"===t.data.messageName?(d?(Wt.emit(d,"partSelected",JSON.stringify(t.data)),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Wt emit partSelected( '"+t.data.documentId+"', '"+t.data.workspaceId+"', '"+t.data.elementId+"', '"+t.data.elementName+"', '"+t.data.partQuery+"', '"+t.data.partName+"')")):p?(Wt.emit(p,"bomSelected",JSON.stringify(t.data)),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Wt emit bomSelected( '"+t.data.documentId+"', '"+t.data.workspaceId+"', '"+t.data.elementId+"', '"+t.data.elementName+"')")):X?(Wt.emit(X,"dwtSelected",JSON.stringify(t.data)),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Wt emit dwtSelected( '"+t.data.documentId+"', '"+t.data.workspaceId+"', '"+t.data.elementId+"', '"+t.data.elementName+"')")):x?(Wt.emit(x,"partStudioSelected",JSON.stringify(t.data)),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Wt emit partStudioSelected( '"+t.data.documentId+"', '"+t.data.elementId+"', '"+t.data.elementName+"')")):"_OSUPDATESKETCHDATA"===t.data.context?B(t.data.sketchIds+"\n"+(t.data.partName+"\n")+"\n"):"_OSPROPERTY_CHANGEDWGPROPERTIESFROMTEMPLATE"===t.data.context?B(t.data.elementId+"\n"+(t.data.elementMicroversionId+"\n")+(t.data.documentId+"\n")+(t.data.documentMicroversionId+"\n")+(t.data.versionId+"\n")+(t.data.elementName+"\n")+t.data.elementType+"\n"):u&&(d="",l=c=s=a=o=r=D=n=P=S=b=T=m=A=X=p="\n",B((d=t.data.documentId?t.data.documentId:d)+(p=t.data.documentMicroversionId?"\n"+t.data.documentMicroversionId:p)+(A=t.data.versionId?"\n"+t.data.versionId:A)+(m=t.data.elementId?"\n"+t.data.elementId:m)+(T=t.data.elementName?"\n"+t.data.elementName:T)+(b=t.data.elementMicroversionId?"\n"+t.data.elementMicroversionId:b)+(X=t.data.elementConfiguration?"\n"+t.data.elementConfiguration:X)+(S=t.data.elementType?"\n"+t.data.elementType:S)+(P=t.data.partNumber?"\n"+t.data.partNumber:P)+(D=t.data.idTag?"\n"+t.data.idTag:D)+(r=t.data.partType?"\n"+t.data.partType:r)+(n=t.data.revision?"\n"+t.data.revision:n)+(t.data.isSketch?"\n1":"\n0")+(t.data.isFlattenedBody?"\n1":"\n0")+(o=!0===t.data.includeSurfaces?"\n1":o)+(a=!0===t.data.isSurface?"\n1":a)+(s=!0===t.data.isComposite?"\n1":s)+(c=!0===t.data.includeWires?"\n1":c)+(l=t.data.isConfigurable&&!0===t.data.isConfigurable?"\n1":l)+"\n")),N.set(t.data.context,!1)):"selectCustomFsTable"===t.data.messageName?(x&&(Wt.emit(x,"tableSelected",JSON.stringify(t.data)),window._LOG_GLOBAL)&&window._LOG_GLOBAL.SHOW("LOG_OSC","Wt emit tableSelected( "+JSON.stringify(t.data.fsTableInfo)+")"),N.set(t.data.context,!1)):"itemConfiguredInConfigureItemDialog"===t.data.messageName?(d="",B((d=t.data.elementConfiguration?t.data.elementConfiguration:d)+"\n\n"),N.set(t.data.context,!1)):"selectItemDialogClosed"===t.data.messageName?(p="_OSIMAGE"===t.data.context||"_OSINSERTDWG"===t.data.context||"_OSUPDATESKETCHDATA"===t.data.context||"_OSPROPERTY_CHANGEDWGPROPERTIESFROMTEMPLATE"===t.data.context||"_OSREPLACEREFERENCE"===t.data.context||"_OSREPLACEBOMREFERENCE"===t.data.context,u&&p&&(N.get(t.data.context)&&(B("^C^C"),F.set(t.data.context,!1)),N.set(t.data.context,!0)),window.focus()):"configureItemDialogClosed"===t.data.messageName?("_OSCHANGETARGETCONFIGURATION"!==t.data.context&&"_OSCHANGEVIEWTARGETCONFIGURATION"!==t.data.context&&"_OSCHANGEBOMTABLECONFIGURATION"!==t.data.context&&"_OSCHANGECUTLISTTABLECONFIGURATION"!==t.data.context&&"_OSCHANGECUSTOMTABLECONFIGURATION"!==t.data.context||(N.get(t.data.context)&&(B("^C^C"),F.set(t.data.context,!1)),N.set(t.data.context,!0)),window.focus()):"export"===t.data.messageName||"print"===t.data.messageName?("print"===(A=t.data).messageName||".pdf"===A.fileExtension?(window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Standard export"),e=>{var t,i,r,n,o;null!==e&&null!==e.baseFileName&&null!==e.fileExtension&&null!==e.overriddenDimensions&&null!==e.sheets&&null!==e.text&&null!==e.version?(t=void 0!==e.hideInspectionItems&&e.hideInspectionItems,i=void 0!==e.excludeOffSheetContent&&e.excludeOffSheetContent,r=void 0!==e.version?e.version:"1.5",n="print"===e.messageName?".pdf":e.fileExtension,o="^C^C_OSSAVEFILEFORDOWNLOAD\n"+{".dwg":"_DWG",".dxf":"_DXF",".dwt":"_DWT",".pdf":"_PDF"}[n]+"\n"+e.baseFileName+n+"\nshow\n"+ +("normal"===e.pdfText)+"\n",o+="print"===e.messageName?"true\nfalse\nfalse\n\n\n\n":e.triggerAutoDownload+"\n"+e.storeInDocument+"\n"+e.createDrawingIfPossible+"\n"+e.insertLocation.groupId+"\n"+e.insertLocation.elementId+"\n"+e.insertLocation.position+"\n",".pdf"===n&&(o=(o+=+("print"===e.messageName)+"\n"+e.pdfColor+"\n"+t+"\n"+i+"\n")+r+"\n"),window.getXeActiveDocument().RunCmd(o),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Export command sent: "+o)):window._LOG_GLOBAL&&(window._LOG_GLOBAL.SHOW("LOG_OSC","Export command wrong parameters"),window._LOG_GLOBAL.SHOW("LOG_OSC",e))}):e=>{var t,i;null!==e&&null!==e.baseFileName&&null!==e.fileExtension&&null!==e.overriddenDimensions&&null!==e.sheets&&null!==e.text&&null!==e.version&&null!==e.triggerAutoDownload&&null!==e.storeInDocument&&null!==e.createDrawingIfPossible&&null!==e.insertLocation&&void 0!==e.insertLocation.groupId&&void 0!==e.insertLocation.elementId&&void 0!==e.insertLocation.position&&void 0!==e.flatten?(i=void 0!==e.hideInspectionItems&&e.hideInspectionItems,t=void 0!==e.excludeOffSheetContent&&e.excludeOffSheetContent,i="^C^C_OSEXPORT\n"+e.baseFileName+"\n"+e.fileExtension+"\n"+e.version+"\n"+e.sheets+"\n"+e.overriddenDimensions+"\n"+e.text+"\n"+e.triggerAutoDownload+"\n"+e.storeInDocument+"\n"+e.createDrawingIfPossible+"\n"+e.insertLocation.groupId+"\n"+e.insertLocation.elementId+"\n"+e.insertLocation.position+"\n"+e.flatten+"\n"+e.splinesAsPolylines+"\n"+i+"\n"+t+"\n",window.getXeActiveDocument().RunCmd(i),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Export command sent: "+i)):window._LOG_GLOBAL&&(window._LOG_GLOBAL.SHOW("LOG_OSC","Export command wrong parameters"),window._LOG_GLOBAL.SHOW("LOG_OSC",e))})(A):"show"===t.data.messageName?(window.focus(),window.getXeApplication()&&(window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","-------------------\x3e window.getXeApplication().SetTabActive(true);"),window.getXeApplication().SetTabActive(!0)),window.osws&&window.osws.updateParentState(),(m=window.getXeActiveDocument())&&m.NotifyServer("UpdateUserSettings","")):"hide"===t.data.messageName?(window.OsMiniToolbar&&window.OsMiniToolbar.hideToolbar(null),$(".xenon-context-menu").hide(),window.getXeApplication()&&(window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","-------------------\x3e window.getXeApplication().SetTabActive(false);"),window.getXeApplication().SetTabActive(!1))):"startFirstViewCommand"===t.data.messageName?window.getXeActiveDocument()&&window.getXeActiveDocument().getXeInputPointManager()&&(window.getXeActiveDocument().getXeInputPointManager().getInsideCommand()&&"ID_OSCOMMANDUPDATEDIALOGPOSITION"!==window.CFxUI.getActiveCommand().id?window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Another command was already started before when received 'startFirstViewCommand' message."):(C=v=w=_=f=y=g=h=m=p=u=d=x=l=c=s=a=o=n=r=D=P=S=X=b=T="\n",t.data.documentId&&(T="\n"+t.data.documentId),t.data.documentMicroversionId&&(b="\n"+t.data.documentMicroversionId),t.data.versionId&&(X="\n"+t.data.versionId),t.data.elementId&&(S="\n"+t.data.elementId),t.data.elementName&&(P="\n"+t.data.elementName),t.data.elementMicroversionId&&(D="\n"+t.data.elementMicroversionId),t.data.elementConfiguration&&(x="\n"+t.data.elementConfiguration),t.data.elementType&&(r="\n"+t.data.elementType),t.data.partNumber&&(n="\n"+t.data.partNumber),t.data.idTag&&(o="\n"+t.data.idTag),t.data.partType&&(a="\n"+t.data.partType),t.data.revision&&(s="\n"+t.data.revision),h=t.data.isSketch?"\n1":"\n0",!0===t.data.isFlattenedBody&&(d="\n1"),!0===t.data.includeSurfaces&&(p="\n1"),!0===t.data.isSurface&&(m="\n1"),!0===t.data.isComposite&&(g="\n1"),t.data.itemName&&(c="\n"+t.data.itemName),t.data.defaultView&&(l="\n"+t.data.defaultView),t.data.itemType&&(u="\n"+t.data.itemType),B("_DRAWINGVIEW\n_Select"+T+b+X+S+P+D+x+r+n+o+a+s+h+d+p+m+g+(y=!0===t.data.includeWires?"\n1":y)+(f=t.data.isConfigurable&&!0===t.data.isConfigurable?"\n1":f)+c+l+u+(_=t.data.explosionId?"\n"+t.data.explosionId:_)+(w=t.data.namedPositionId?"\n"+t.data.namedPositionId:w)+(v=t.data.displayStateId?"\n"+t.data.displayStateId:v)+(C=t.data.namedView?"\n"+t.data.namedView:C)+"\n"))):"takeFocus"===t.data.messageName?window.focus():"userSettingsChanged"===t.data.messageName?(T=window.getXeActiveDocument())&&T.NotifyServer("UpdateUserSettings",""):"shortcutKeyEvent"===t.data.messageName?(b="",document.noteImeHandler.isEnabled()?document.noteImeHandler.setFocus(t):(!0===t.data.event.ctrlKey&&(b+="Ctrl+"),t.data.event.metaKey&&(b+="Meta+"),t.data.event.altKey&&(b+="Alt+"),t.data.event.shiftKey&&(b+="Shift+"),b=(b+=window.XeUtils.getXeCommonKeyboardString(t.data.event)).toUpperCase(),27===(t.data.event.keyCode||t.data.event.charCode)&&window.getXeActiveDocument().getXeInputPointManager().CancelCurrentCommand(),X=window.getXeActiveDocument().getXeInputPointManager().getInsideCommand(),S=!(!noteEditorHandler||!0!==noteEditorHandler.isNoteEditorActive()),P=window.CFxUI.getCXeShortcutsManager(),1!=t.data.event.repeat&&(X?S||window.XeActiveTrackers.IsTrackerActive("COsNoteRotationGripEditTracker")||P.fireShortcut(b):P.isDeleteShortcut(window.XeUtils.getXeCommonKeyboardString(t.data.event))?0<window.getXeActiveDocument().getXeMainSelectionSet().getHandles().length&&window.getXeActiveDocument().cmdERASE():P.fireShortcut(b)))):"appearanceSelectedInAppearanceDialog"===t.data.messageName?"_OSNOTE"===t.data.context?"CANCELLED"!==t.data.source&&"TEXT"!==t.data.source&&("CONFIRMED"===t.data.source?B("_Changecolor_Confirmed,"+t.data.red+","+t.data.green+","+t.data.blue+"\n"):B("_Changecolor,"+t.data.red+","+t.data.green+","+t.data.blue+"\n")):B(t.data.context+","+t.data.red+","+t.data.green+","+t.data.blue+"\n"):"appearanceDialogCommitted"===t.data.messageName?t.data.context&&("_OSNOTE"===t.data.context&&N.get(t.data.context)?(B("_Changecolor_OK"),F.set(t.data.context,!1)):N.get(t.data.context)&&(B("\n"),F.set(t.data.context,!1)),N.set(t.data.context,!0)):"appearanceDialogCancelled"===t.data.messageName?t.data.context&&("_OSNOTE"===t.data.context&&N.get(t.data.context)?(B("_Changecolor\n"),F.set(t.data.context,!1)):N.get(t.data.context)&&(B("_Reject\n"),F.set(t.data.context,!1)),N.set(t.data.context,!0)):"outOfDateReferenceData"===t.data.messageName?t.data.versionIdAndElementIdToVersionInfo&&t.data.fullRevisionIdToRevisionInfo&&(D=JSON.stringify(t.data.versionIdAndElementIdToVersionInfo),x=JSON.stringify(t.data.fullRevisionIdToRevisionInfo),i)&&Wt.emit(i,"latestVersionChanged",D,x):"querySheets"===t.data.messageName?V(t.data):"queryDrawingJson"===t.data.messageName?(E=t.data,XeRequest.prototype.Promise(window.getXeActiveDocument(),E,"queryDrawingJson").then(e=>{if(!(window.OnshapeMobileInterface||window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface)){if(window!==window.parent){var t={messageName:"queryDrawingJsonResponse",documentId:M,workspaceId:L,elementId:R,drawingJson:e};if("true"===E.fromOsAppExtension){var i=document.getElementsByTagName("iframe");for(let e=0;e<i.length;e++){var r=i[e];r.id.startsWith("OsAppExtensionPanel")&&(t.fromOsAppExtension="true",t.requestId=E.requestId,r.contentWindow.postMessage(t,"*"))}}else window.parent.postMessage(t,"*")}window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: queryDrawingJsonResponse")}})):"generateIFrameImage"===t.data.messageName?window.getXeActiveDocument().RequestThumbnail(t.data):"onshapeCreateAnnotations"===t.data.messageName?(G=t.data,XeRequest.prototype.Promise(window.getXeActiveDocument(),G,"onshapeCreateAnnotations").then(e=>{if(!(window.OnshapeMobileInterface||window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface)){if(window!==window.parent){var t={messageName:"queryCreateAnnotationsResponse",documentId:M,workspaceId:L,elementId:R,annotationsResponse:e};if("true"===G.fromOsAppExtension){var i=document.getElementsByTagName("iframe");for(let e=0;e<i.length;e++){var r=i[e];r.id.startsWith("OsAppExtensionPanel")&&(t.fromOsAppExtension="true",t.requestId=G.requestId,r.contentWindow.postMessage(t,"*"))}}else window.parent.postMessage(t,"*")}window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: queryCreateAnnotationsResponse")}})):"onshapeEditAnnotations"===t.data.messageName&&(O=t.data,XeRequest.prototype.Promise(window.getXeActiveDocument(),O,"onshapeEditAnnotations").then(e=>{if(!(window.OnshapeMobileInterface||window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface)){if(window!==window.parent){var t={messageName:"queryEditAnnotationsResponse",documentId:M,workspaceId:L,elementId:R,annotationsResponse:e};if("true"===O.fromOsAppExtension){var i=document.getElementsByTagName("iframe");for(let e=0;e<i.length;e++){var r=i[e];r.id.startsWith("OsAppExtensionPanel")&&(t.fromOsAppExtension="true",t.requestId=O.requestId,r.contentWindow.postMessage(t,"*"))}}else window.parent.postMessage(t,"*")}window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: queryEditAnnotationsResponse")}}))):window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Message NOT safe and should be ignored.")}else window._LOG_GLOBAL&&(window._LOG_GLOBAL.SHOW("LOG_OSC","Msg receive ERROR !"),window._LOG_GLOBAL.SHOW("LOG_OSC",t))},window.osc._h=function(e,t,i,r,n,o,a,s,c,l){window!==window.parent&&(e={documentId:M,workspaceId:L,elementId:R,messageName:e,anotherDocumentId:t,anotherWorkspaceId:i,anotherVersionId:r,anotherElementId:n,anotherPartId:o,anotherConfiguration:a,bomShouldBeOpen:s,customTableShouldBeOpen:c},c&&l&&(e.fsTableInfo=l),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e.messageName),window.parent.postMessage(e,"*"))},window.osc._i=function(e){F.get(e)&&(n("closeSelectItemDialog"),N.set(e,!1),F.set(e,!1))},window.osc._j=function(e,t,i,r,n,o,a,s,c,l,d,u,p){window!==window.parent&&(e={documentId:M,workspaceId:L,elementId:R,messageName:"openConfigureItemDialog",restrictToDocumentId:e,restrictToMicroversionId:t,restrictToVersionId:i,restrictToElementId:r,restrictToIdTag:n,elementConfiguration:o,selectAssemblies:a,selectPartStudios:s,selectParts:c,selectSketches:l,selectWires:d,dialogTitle:u,context:p},window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e.messageName),window.parent.postMessage(e,"*"),N.set(p,!0),F.set(p,!0))},window.osc._k=function(e){F.get(e)&&(n("closeConfigureItemDialog"),N.set(e,!1))},window.osc._l=function(e,t,i,r,n,o,a){var s,c,l;window!==window.parent&&(s=36,c=0,(l=$(".xenon-flyout-right"))&&0<(l=l.position().left+33-220)&&(c=l),"_OSEDITHATCH"===a&&(l=$("button.HatchColorBtn"))&&(s=l.offset().top,c=l.offset().left),"_OSCHANGEEDGELINETYPE"===a&&(l=$("button.EdgeColorBtn"))&&(s=l.offset().top,c=l.offset().left),"_OSNOTE"===a&&(l=$("button.NoteColorBtn"))&&(s=l.offset().top,c=l.offset().left),"_OSCREATEHATCH"!==a&&"_OSEDITREGIONHATCH"!==a||(l=$("button.HatchColorBtn"))&&(s=l.offset().top,c=l.offset().left),l={documentId:M,workspaceId:L,elementId:R,messageName:"openAppearanceDialog",dialogTitle:e,red:t,green:i,blue:r,alpha:n,showAlphaControls:"true"==o.toLowerCase(),context:a,defaultTop:s,defaultLeft:c},window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+l.messageName),window.parent.postMessage(l,"*"),N.set(a,!0),F.set(a,!0))},window.osc._m=function(e){F.get(e)&&(n("closeAppearanceDialog"),N.set(e,!1))},window.osc._n=function(e,t,i){var r;e=e,t=t,i=i,window.OnshapeMobileInterface?window.OnshapeMobileInterface.iFrameImageCompleted&&window.OnshapeMobileInterface.iFrameImageCompleted(R,e,t):window.webkit&&window.webkit.messageHandlers.OnshapeMobileInterface?window.webkit.messageHandlers.OnshapeMobileInterface.postMessage({methodName:"iFrameImageCompleted",elementId:R,message:e,imageData:t}):window!==window.parent&&(e={documentId:M,workspaceId:L,elementId:R,messageName:"iFrameImageCompleted",imageUrl:e,imageData:t,imageId:i.imageId,messageId:i.messageId,autoDismiss:r=null==r?!1:r},window.parent.postMessage(e,"*")),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: iFrameImageCompleted")},window.osc._qs=V,window.osc.sLI=function(e,t){a("setLocalItem",e,t)},window.osc._rLI=function(e){a("removeLocalItem",e)},window.osc._gLI=function(r){return new Promise(function(i){window.addEventListener("message",function e(t){t.origin&&t.data&&t.data.messageName&&(I===t.origin||"true"===k||window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("OSC_DEBUG"))&&"getLocalItemResponse"===t.data.messageName&&t.data.storageKey===r&&(window.removeEventListener("message",e),i(t.data.content))}),a("getLocalItem",r)})},window.osc._gCT=function(){return new Promise(function(i){window.addEventListener("message",function e(t){t.origin&&t.data&&t.data.messageName&&(I===t.origin||"true"===k||window._LOG_GLOBAL&&window._LOG_GLOBAL.GET("OSC_DEBUG"))&&"clipboardText"===t.data.messageName&&((t=t.data.clipboardText)?(t=window.btoa(encodeURIComponent(t)),window.removeEventListener("message",e),i(t)):(window.removeEventListener("message",e),i(" ")))}),o("triggerPostClipboardText","",!1,!1,"","text/html")})},window.osc._cOCT=function(){o("writeTextToClipboard","",!1,!1,"","clearData")},window.osc._pCFR=function(e,t,i,r,n){var o="copySourceDrawingViewForCorrespondence",e={messageName:o,documentId:M,elementId:R,workspaceId:L,wvm:e,wvmId:t,viewId:i};r&&(e.points=r),n&&(e.regionsOfInterest=regionsOfInterest),window.parent.postMessage(e,"*"),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+o)},window.osc._pRA=function(e,t,i,r,n,o,a){var s="copyDrawingViewAnnotations",e={messageName:s,documentId:M,elementId:R,workspaceId:L,viewId:e};t&&(e.points=t),i&&(e.regionsOfInterest=i),r&&(e.angleOfRotation=r),n&&(e.probabilityThreshold=n),o&&(e.transactionId=o),a&&(e.changeId=a),window.parent.postMessage(e,"*"),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+s)},window.osc._gRV=function(){let i="getSourceDrawingViewForCorrespondence";return new Promise(function(t){window.addEventListener("message",function(e){e.origin&&e.data&&e.data.messageName&&t(e.data.content)});var e={messageName:i,documentId:M,elementId:R,workspaceId:L};window.parent.postMessage(e,"*"),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+i)})},window.osc._gCRVD=function(){var e="clearSourceDrawingViewForCorrespondence",t={messageName:e,documentId:M,elementId:R,workspaceId:L};window.parent.postMessage(t,"*"),window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e)},window.osc._usrsnp=function(){n("openUserSnap")},window.osc._openRefMngr=function(e,t,i,r,n,o,a,s){window!==window.parent&&(e={documentId:M,workspaceId:L,elementId:R,messageName:e,anotherDocumentId:t,anotherWorkspaceId:i,anotherVersionId:r,anotherElementId:n,anotherPartId:o,anotherConfiguration:a,referenceIds:s},window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e.messageName),window.parent.postMessage(e,"*"))},window.osc._oEDIL=function(e){window!==window.parent&&(e={documentId:M,workspaceId:L,elementId:R,messageName:e,drawingExportFormat:"INSPECTION_LIST"},window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e.messageName),window.parent.postMessage(e,"*"))},window.osc._OsNewBannerConfirmationDia=function(e,t,i){window!==window.parent&&(t={documentId:M,workspaceId:L,elementId:R,messageName:e,[t]:i},window._LOG_GLOBAL&&window._LOG_GLOBAL.SHOW("LOG_OSC","Msg send from application element: "+e),window.parent.postMessage(t,"*"))},window.addEventListener("ospstm",window.osc._a,!1),window.addEventListener("message",window.osc._d,!1)}window.OsBOMBalloonManager=new OsBOMBalloonManager,window.OnshapeCapabilities={_afterUpdate:function(){window.OnshapeColors={highlight:{color:"#CCB292",rgb:window.XeUtils.hexToRgbArray("#CCB292"),alpha:1},select:{color:"#CC925C",rgb:window.XeUtils.hexToRgbArray("#CC925C"),alpha:1},dependancy:{color:"#90cef1",rgb:window.XeUtils.hexToRgbArray("#90cef1"),alpha:1},duplicates:{color:"#ebeb92",rgb:window.XeUtils.hexToRgbArray("#ebeb92"),alpha:1},calloutgrp:{color:"#ebeb92",rgb:window.XeUtils.hexToRgbArray("#ebeb92"),alpha:1},dangling:{color:"#000000",rgb:window.XeUtils.hexToRgbArray("#000000"),alpha:1},grippoint:{hover_pen:"#CCB292",hover_border:"#FFFFFF",selection_pen:"#CC925C",selection_border:"#FFFFFF",dependancy_pen:"#90cef1",dependancy_border:"#FFFFFF"}}}},window.OsUserSettings={};var OsWorkingSpinner=function(){var r=this,n=new XeSpinnerWaiter,o="",a=!1,i=!1;r.isLoadingWaiterWaiting=function(){return n.isWaiting()},r.isWorkingWaiterWaiting=function(){return n.isWaiting()},r.updateParentState=function(){window.getXeApplication().IsTabActive()&&(n.isWaiting()?a?window.XeClientMessageProxy.startLoadingSpinner([o]):window.XeClientMessageProxy.startWorkingSpinner([o]):(window.XeClientMessageProxy.stopLoadingSpinner([o]),window.XeClientMessageProxy.stopWorkingSpinner([o])))},r.startWait=function(e,t){var i=n.isWaiting();n.startWaiting(),i!=n.isWaiting()&&(a=e,o=t,r.updateParentState())},r.stopWait=function(){var e=n.isWaiting();n.stopWaiting(),e!=n.isWaiting()&&(r.updateParentState(),a=!1,o="")},r._ospstm_listener=function(e){var t;e&&("startLoadingSpinnerManager"===e._m?(t=e._mc,r.startWait(!0,t)):"stopLoadingSpinnerManager"===e._m?r.stopWait():"startLockSpinnerManager"===e._m?i=!0:"stopLockSpinnerManager"===e._m?i=!1:"startWorkingSpinnerManager"===e._m?(t=e._mc,r.startWait(!1,t)):"stopWorkingSpinnerManager"===e._m&&r.stopWait())},r.updateTextureImgFunc=function(e){r.startWait(!1,"texture_img")},r.lastTextureImgFunc=function(e){r.stopWait("texture_img")},r.isLock=function(){return i},r.init=function(){return window.addEventListener("osspinner",r._ospstm_listener),document.addEventListener("XeStartLoadingTextureImgEvent",r.updateTextureImgFunc),document.addEventListener("XeStopLoadingTextureImgEvent",r.lastTextureImgFunc),r.startWait(!0,"Loading drawing"),r},r.unnit=function(){return window.removeEventListener("osspinner",r._ospstm_listener),document.removeEventListener("XeStartLoadingTextureImgEvent",r.updateTextureImgFunc),document.removeEventListener("XeStopLoadingTextureImgEvent",r.lastTextureImgFunc),r}},XeBaseWatcher=(XeClientMessageProxy.prototype.init=function(){function e(e,t){var i;window.osc&&((i=document.createEvent("Event")).initEvent("ospstm",!0,!0),i._m=e,0<t.length&&(i._mc=t[0]),1<t.length&&(i._ad=t[1]),window.dispatchEvent(i))}var t=this;this.startWorkingSpinner=e.bind(null,"startWorkingSpinner"),this.stopWorkingSpinner=e.bind(null,"stopWorkingSpinner",[]),this.startLoadingSpinner=e.bind(null,"startLoadingSpinner"),this.stopLoadingSpinner=e.bind(null,"stopLoadingSpinner",[]),this.changeUrl=e.bind(null,"changeUrl",[]),this.closeFlyoutsAndMenus=e.bind(null,"closeFlyoutsAndMenus",[]),this.errorReload=e.bind(null,"errorReload"),this.returnToAssociatedWorkspace=e.bind(null,"returnToAssociatedWorkspace",[]),this.keepAlive=e.bind(null,"keepAlive",[]),this.restoreMoment=e.bind(null,"restoreMoment",[]),this.showKeyboardShortcutsHelp=e.bind(null,"showKeyboardShortcutsHelp",[]),this.showMessageBubble=e.bind(null,"showMessageBubble"),this.toggleTabManagerVisibility=e.bind(null,"toggleTabManagerVisibility",[]),this.openDrawingMiniToolbarPreferences=e.bind(null,"openDrawingMiniToolbarPreferences",[]),this.openCreateVersionDialog=e.bind(null,"openCreateVersionDialog",[]),this.openCreateReleaseDialog=e.bind(null,"openCreateReleaseDialog",[]),this.showElementTabSwitcherForward=e.bind(null,"showElementTabSwitcherForward",[]),this.showElementTabSwitcherBackward=e.bind(null,"showElementTabSwitcherBackward",[]),this.markupIsSupported=e.bind(null,"markupIsSupported",[]),this.sendLogMessage=function(e,t){var i,r;window!==window.parent&&(i="[sessionId: "+window.getSessionId()+"] ",i+=t,(r=document.createEvent("Event")).initEvent("ospstm",!0,!0),r._m="sendLogMessage",r._mc=e,r._ad=!1,r._me=i,window.dispatchEvent(r)),"error"===e?console.error(t):"warn"===e?console.warn(t):"debug"===e&&!window.__IsDebugMode||console.info(t)},this.commandStarted=function(){},this.commandEnded=function(){},t.measure_function_names=["OsViewsUpload::Begin","OsViewsUpload::End","OsHiddenLineUpload::Begin","OsHiddenLineUpload::End"],t.measure_function_names.forEach(function(n){t[n]=function(){try{var e;arguments[0]&&arguments[0][0]&&(e=JSON.parse(arguments[0][0]),t=n,i=e,(r=document.createEvent("Event")).initEvent("osviewinfo",!0,!0),r.name=t,r.data=i,document.dispatchEvent(r))}catch(e){}var t,i,r}})},XeGLDrawObject.prototype.fixHilghlightMode=!1,registerTracker("DebugHelperTracker",new DebugHelperTracker),registerTracker("CFxBigCrossCursor",new BigCrossCursor),registerTracker("CFxBlipTracker",new BlipTracker),registerTracker("CFxDeferredTracker",new DeferredTracker),registerTracker("CFxDragTracker",new DragTracker),registerTracker("CFxSelectionSetTranslateTracker",new CFxSelectionSetTranslateTracker),registerTracker("CFxElasticArcEndAngleTracker",new CFxElasticArcEndAngleTracker),registerTracker("CFxElasticArcEndPointTracker",new CFxElasticArcEndPointTracker),registerTracker("CFxElasticArcIncludedAngleTracker",new CFxElasticArcIncludedAngleTracker),registerTracker("CFxElasticArcChordLengthTracker",new CFxElasticArcChordLengthTracker),registerTracker("CFxElasticArcCenterPointTracker",new CFxElasticArcCenterPointTracker),registerTracker("CFxElasticArcAngleTracker",new CFxElasticArcAngleTracker),registerTracker("CFxElasticArcTangentTracker",new CFxElasticArcTangentTracker),registerTracker("CFxElasticArcRadiusTracker",new CFxElasticArcRadiusTracker),registerTracker("CFxElasticArcAppendTracker",new CFxElasticArcAppendTracker),registerTracker("CFxElasticDimLinearTracker",new DimensionTracker("CFxElasticDimLinearTracker")),registerTracker("CFxElasticDimAlignedTracker",new DimensionTracker("CFxElasticDimAlignedTracker")),registerTracker("CFxElasticDimAngularTracker",new DimensionTracker("CFxElasticDimAngularTracker")),registerTracker("OsDimGRIPTracker",new DimensionTracker("OsDimGRIPTracker")),registerTracker("CFxElasticDimArcTracker",new DimensionTracker("CFxElasticDimArcTracker")),registerTracker("CFxElasticDimOrdinateTracker",new DimensionTracker("CFxElasticDimOrdinateTracker")),registerTracker("CFxElasticDimRadialLargeTracker",new DimensionTracker("CFxElasticDimRadialLargeTracker")),registerTracker("CFxElasticDimRadialJogTracker",new DimensionTracker("CFxElasticDimRadialJogTracker")),registerTracker("CFxElasticDimBaselineTracker",new DimensionTracker("CFxElasticDimBaselineTracker")),registerTracker("CFxElasticDimBaselineRotatedTracker",new DimensionTracker("CFxElasticDimBaselineRotatedTracker")),registerTracker("CFxElasticDimBaselineAngularTracker",new DimensionTracker("CFxElasticDimBaselineAngularTracker")),registerTracker("CFxElasticDimBaselineOrdinateTracker",new DimensionTracker("CFxElasticDimBaselineOrdinateTracker")),registerTracker("CFxElasticDimPosTracker",new DimensionTracker("CFxElasticDimPosTracker")),registerTracker("CFxElasticDimRadialDiameterTracker",new DimensionTracker("CFxElasticDimRadialDiameterTracker")),registerTracker("CFxElasticSmartDimTracker",new DimensionTracker("CFxElasticSmartDimTracker")),registerTracker("OsElasticSmartDimTracker",new DimensionTracker("OsElasticSmartDimTracker")),registerTracker("OsElasticDimLinearTracker",new DimensionTracker("OsElasticDimLinearTracker")),registerTracker("COsElasticDimOrdinateTracker",new DimensionTracker("COsElasticDimOrdinateTracker")),registerTracker("COsElasticDimBaselineOrdinateTracker",new DimensionTracker("COsElasticDimBaselineOrdinateTracker")),registerTracker("CFxDimPalletTracker",new DimPalletTracker),registerTracker("CFxDimPointHighlightTracker",new DimPointHighlightTracker),registerTracker("COsDimArcToArcTracker",new DimArcToArcTracker),registerTracker("COsCenterLineSnapTracker",new CenterLineSnapTracker),registerTracker("CFxFrameTracker",new FrameTracker),registerTracker("CFxHighlightTracker",new HighlightTracker),registerTracker("CFxGripTracker",new GripPointTracker(!0)),registerTracker("CFxGripPointSetEx",new GripPointTracker),registerTracker("CFxActiveCellGripTracker",new ActiveTableCellTracker),registerTracker("CFxTableEditTrackerBase",new TableEditTrackerBase),registerTracker("CFxTableGripTracker",new TableResizeTracker),registerTracker("CFxLastPointTracker",new LastPointTracker),registerTracker("CFxPolyLineVertexTracker",new PolyLineVertexTracker),registerTracker("CFxRectTracker",new RectTracker),registerTracker("CFxOsnapPointTracker",new OsnapPointTracker),registerTracker("CFxOtrackPointTracker",new OtrackPointTracker),registerTracker("XeCursorTracker",new XeCursorTracker),registerTracker("CFxBigCrossCursor",new BigCrossCursor),registerTracker("CFxPanZoomTracker",new PanZoomTracker),registerTracker("CFxViewportBorderLineTracker",new ViewportBorderLineTracker),registerTracker("CFxNoteMarkerTracker",new NoteMarkerTracker),registerTracker("CFxNoteBorderTracker",new NoteBorderTracker),registerTracker("CFxNoteClientTracker",new NoteClientTracker),registerTracker("CFxQtMTextStartPointTracker",new CFxQtMTextStartPointTracker),registerTracker("COsAuxiliaryViewPlacementTracker",new AuxiliaryViewPlacementTracker),registerTracker("COsAuxiliaryLineTracker",new AuxiliaryLineTracker),registerTracker("COsDrawingViewTracker",new DrawingViewTracker),registerTracker("COsProjectedViewPlacementTracker",new ProjectedViewPlacementTracker),registerTracker("COsSectionViewCutLineTracker",new SectionViewCutLineTracker),registerTracker("COsSectionViewPlacementTracker",new SectionViewPlacementTracker),registerTracker("COsSectionViewTracker",new SectionViewTracker),registerTracker("OsDebugTracker",new OsDebugTracker),registerTracker("COsTableTracker",new OsTableTracker),registerTracker("COsZoomWinTracker",new OsZoomWinTracker),registerTracker("COsCenterMarkTracker",new CenterMarkTracker),registerTracker("COsDetailViewBoundaryTracker",new DetailViewBoundaryTracker),registerTracker("COsDetailViewPlacementTracker",new DetailViewPlacementTracker),registerTracker("OsElasticCircleTracker",new CircleTracker),registerTracker("COsElasticArcTracker",new ElasticArcTracker),registerTracker("COsJogSectionViewCutLineTracker",new JogSectionViewCutLineTracker),registerTracker("OsJoggedSectionLineGripPointsTracker",new OsJoggedSectionLineGripPointsTracker),registerTracker("COsImageTracker",new ImageTracker),registerTracker("COsJogSectionViewPlacementTracker",new JogSectionViewPlacementTracker),registerTracker("COsBrokenViewTracker",new BrokenViewTracker),registerTracker("CFxNoteFieldTracker",new NoteFieldTracker),registerTracker("COsOrdinateDimGripEditTracker",new OrdinateGroupLineTracker),registerTracker("COs2PointCircularTracker",new TwoPointCircleTracker),registerTracker("COs2PointElasticCircularTracker",new TwoElasticPointCircleTracker),registerTracker("COsOsViewsPreviewTracker",new COsOsViewsPreviewTracker),registerTracker("COsNoteRotationGripEditTracker",new NoteRotationTracker),registerTracker("COsBOMTableRowSelectionTracker",new OsBOMTableRowSelectionTracker),registerTracker("COsBOMTableTracker",new OsBOMTableTracker),registerTracker("COsWatermarkTracker",new OsWatermarkTracker),registerTracker("COsCenterLineTracker",new CenterLineTracker),registerTracker("COsSectionDepthHighlightTracker",new OsSectionDepthHighlightTracker),registerTracker("COsProfileEditCursorTracker",new OsProfileEditCursorTracker),registerTracker("COsProfileEditTracker",new OsProfileEditTracker),registerTracker("COsProfileToolTracker",new OsProfileToolTracker),registerTracker("FxDebugTracker",new FxDbgTracker),registerTracker("COsHoleTableTracker",new OsHoleTableTracker),registerTracker("COsMeasurementTracker",new OsMeasurementTracker),registerTracker("COsRevisionTableTracker",new OsRevisionTableTracker),registerTracker("COsRevisionMarkerTracker",new OsRevisionMarkerTracker),registerTracker("COsShowHideEdgeTracker",new OsShowHideEdgeTracker),registerTracker("COsCutlistTableTracker",new OsCutlistTableTracker),registerTracker("OsDimExtLineHighlightTracker",new OsDimExtLineHighlightTracker),registerTracker("CFxConstraintsTracker",new OsConstraintsTracker),registerTracker("CFxPathAndPointHighLightTracker",new OsPathAndPointHighLightTracker),registerTracker("COsAngularCenterMarkTracker",new OsAngularCenterMarkTracker),registerTracker("CFxInferenceConstraintsTracker",new OsInferenceConstraintsTracker),registerTracker("COsDatumClientTracker",new OsDatumTracker),registerTracker("COsCustomTableTracker",new OsCustomTableTracker),registerTracker("OsMLeaderHighlightTracker",new OsMLeaderHighlightTracker),window.XeUtils=new XeUtils,window.OnshapeColors={highlight:{color:"#bf9460",rgb:window.XeUtils.hexToRgbArray("#bf9460"),alpha:1},select:{color:"#98764d",rgb:window.XeUtils.hexToRgbArray("#98764d"),alpha:1},dependancy:{color:"#90cef1",rgb:window.XeUtils.hexToRgbArray("#90cef1"),alpha:1},duplicates:{color:"#ebeb92",rgb:window.XeUtils.hexToRgbArray("#ebeb92"),alpha:1},calloutgrp:{color:"#ebeb92",rgb:window.XeUtils.hexToRgbArray("#ebeb92"),alpha:1},dangling:{color:"#000000",rgb:window.XeUtils.hexToRgbArray("#000000"),alpha:1},grippoint:{hover_pen:"#D8BF9F",hover_border:"#FFFFFF",selection_pen:"#D8A566",selection_border:"#FFFFFF",dependancy_pen:"#90cef1",dependancy_border:"#FFFFFF"}},window.XeLineweightUtils=new XeLineweightUtils,window.xeGlGlobalUniformData=new XeGlGlobalUniformData,window.XeShaders=new XeShaders,window.osws||(window.osws=(new OsWorkingSpinner).init()),window.XeActiveTrackers=new XeActiveTrackers,window.IsOsVersion=function(){return!0},window.XeClientMessageProxy=new XeClientMessageProxy,window._googleAnalytics&&!0===window._googleAnalytics.enabled&&("true"===getURLQueryParams("nogaservice")||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?(console.log("<<<<<<<<<<<<<<<<<< GoogleAnalitics disabled ! >>>>>>>>>>>>>>>>>"),window.googleAnalyticsService=googleAnalyticsServiceDummy):window.googleAnalyticsService=new GoogleAnalyticsService(window._googleAnalytics.url,window._googleAnalytics.account)),new OSC,window.osc&&window.osc._ba(),$(function(){var a=/INPUT|SELECT|TEXTAREA/i,t=document.domain;try{document.domain="onshape.com",window._LOG_GLOBAL.SHOW("SHOW_ERRORS","document.domain set to "+document.domain)}catch(e){document.domain=t,window._LOG_GLOBAL.SHOW("SHOW_ERRORS",e+"\nSet back to "+t)}window.WebFontConfig={custom:{families:["Noto Sans"]}};var t=document.createElement("script"),e=document.scripts[0],t=(t.src="/www-editor/fonts/webFont.js",t.async=!0,e.parentNode.insertBefore(t,e),document.createElement("script"));t.src="https://widget.usersnap.com/cross-origin/080c9559-9a36-4733-979e-4ee15165c69d",t.defer=!0,e.parentNode.append(t),document.addEventListener("touchend",function(e){e.preventDefault();var t,e=e.changedTouches.length?e.changedTouches:e.targetTouches.length?e.targetTouches:e.touches.length?e.touches:null;e&&e.length&&(t=Math.floor(e[0].clientX),e=Math.floor(e[0].clientY),t=document.elementFromPoint(t,e))&&t.click&&t.click()},!1),$(document).bind("keydown keypress",function(e){var t,i=window.XeUtils.IsNoteCommand(window.getXeActiveDocument()),r=(a.test(e.target.tagName)||window.CFxUI.css_helper.hasStyleClass(e.target,"BalloonTextEdit"))&&!e.target.disabled&&!e.target.readOnly&&!e.target.xeAllowFireShortCuts,n=(window.XeUtils.DisableBroswerShortCutKeys(e),(e=>{let t="";return"keydown"===e.type&&(!e.key||1!==e.key.length||!1===r&&!1===i)&&(!0===e.ctrlKey&&(t+="Ctrl+"),!0===e.metaKey&&(t+="Meta+"),!0===e.altKey&&(t+="Alt+"),!0===e.shiftKey&&(t+="Shift+"),e.originalEvent.code)&&(t+=e.originalEvent.code),t})(e)),o=window.CFxUI.getCXeShortcutsManager().getShortcutConflict(n),n=window.CFxUI.getCXeShortcutsManager().getShortcutJSMessage(n);window.getXeApplication().GetCapability("drawings_custom_shortcut_keys")&&o?((t=document.createEvent("Event")).initEvent("ospstm",!0,!0),t._m="showMessageBubble",t._mc=o,t._mt="warning",window.dispatchEvent(t),e.preventDefault(),e.stopPropagation()):window.getXeApplication().GetCapability("drawings_custom_shortcut_keys")&&n?(n(),e.preventDefault(),e.stopPropagation()):8!==e.which&&47!==e.which&&39!==e.which||!1!==r?!0===e.shiftKey?window.getXeApplication().GetCapability("drawings_custom_shortcut_keys")||"keydown"!==e.type||"Slash"!==e.originalEvent.code||!1!==r||!1!==i?"keydown"===e.type&&!0===e.ctrlKey&&"Digit8"===e.originalEvent.code&&window.XeClientMessageProxy.changeUrl():window.XeClientMessageProxy.showKeyboardShortcutsHelp():!0===e.ctrlKey?(83===e.which||85===e.which?e.preventDefault():window.getXeApplication().GetCapability("drawings_custom_shortcut_keys")||"keydown"!==e.type||"Space"===e.originalEvent.code&&(window.XeClientMessageProxy.showElementTabSwitcherForward(),e.preventDefault(),e.stopPropagation()),!0!==i||85!==e.which&&70!==e.which&&79!==e.which&&82!==e.which&&73!==e.which&&66!==e.which||e.preventDefault()):window.getXeApplication().GetCapability("drawings_custom_shortcut_keys")||!0!==e.altKey?!0===i&&9===e.which&&!1===window.XeActiveTrackers.IsTrackerActive("COsTableTracker")&&e.preventDefault():"KeyT"===e.originalEvent.code&&window.XeClientMessageProxy.toggleTabManagerVisibility():e.preventDefault(),window.osc&&window.osc._bb(),document.noteImeHandler.isEnabled()&&document.noteImeHandler.setFocus(e)}),$(document).bind("click",function(e){window.XeClientMessageProxy.closeFlyoutsAndMenus(),window.focus()}),$(document).bind("mousemove mousedown",function(e){window.osc&&window.osc._bb()}),document.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},window.XeClientMessageProxy.keepAlive(),Wt.adhocs||(Wt.adhocs={},Wt.adhocs.toolTip_checkIsOver=function(){return!0})}),function(){var s=this;s.default_left=arguments[0]&&arguments[0][0]?arguments[0][0]:"110px",s.default_top=arguments[0]&&arguments[0][1]?arguments[0][1]:"42px",s.logo_txt="replace by watcher name",s.tooltip_txt="replace by your tooltip",s.updateLogo=function(){l.innerHTML=s.logo_txt+"<br><br>"+s.tooltip_txt},s.data=[{desc:"descrition of this param",value:0,units:" ms/ sec/ Mb etc .."}],s.addEventListeners=function(){throw"XeBaseWatcher :: self.addEventListeners should be overrided"},s.removeEventListeners=function(){throw"XeBaseWatcher :: self.removeEventListeners should be overrided"},s.hide=function(){c&&(s.clearDiv(),s.setPosition("-99999px","-99999px"),s.updateLogo(),c=!1,s.removeEventListeners())},s.show=function(){c||(s.setPosition(s.default_left,s.default_top),c=!0,s.addEventListeners(),r.clientWidth<20&&(r.style.width="100px"))},s.delete=function(){s.removeEventListeners();try{document.removeChild(l)}catch(e){}},s.clearDiv=function(){for(;l.hasChildNodes();)l.removeChild(l.lastChild)},s.draw=function(){if(c){s.clearDiv();var e="0x000000",t=(l.style.color="0xFFFFFF",document.createElement("TABLE"));t.style.width="100%";for(var i=0;i<s.data.length;i++){var r=t.insertRow(i),n=r.insertCell(0),o=r.insertCell(1),r=r.insertCell(2),a=document.createElement("span"),n=(a.style.color=e,a.textContent=s.data[i].desc,n.appendChild(a),document.createElement("span")),a=(n.style.color=e,n.textContent=s.data[i].value,o.appendChild(n),document.createElement("span"));a.style.color=e,a.textContent=s.data[i].units,r.appendChild(a)}l.appendChild(t)}},s.IsVisible=function(){return c};var c=!(s.addButton=function(e,t){var i=document.createElement("button");i.style.fontSize="12px",i.style.height="24px",i.style.textAlign="center",i.style.verticalAlign="center",i.style.padding="0px",i.style.margin="0px 5px 0px 5px",i.innerHTML=e,i.onclick=t,r.appendChild(i)});s.setPosition=function(e,t){i.style.left=e,i.style.top=t};var i=document.createElement("div"),r=(i.style.position="absolute",i.style.top="-99999px",i.style.left="-99999px",i.style.zIndex="100",i.style.width="auto",i.innerHTML="",document.createElement("div")),l=(r.style.width="auto",r.style.height="28px",r.style.backgroundColor="#F3F3F3",r.style.border="1px solid #000000",r.innerHTML="",document.createElement("div"));i.style.width="auto",l.innerHTML="",new WT_Jquery_DraggableFix(r,i,!1),s.updateLogo(),i.appendChild(r),i.appendChild(l),document.body.appendChild(i)}),XeCommandTimeReporter=function(){if(window.hasOwnProperty("_xe_cmd_time_rptr_ist")&&window._xe_cmd_time_rptr_ist)return window._xe_cmd_time_rptr_ist;window._xe_cmd_time_rptr_ist=this,XeBaseWatcher.call(this,arguments);var a=this;function i(){return(new Date).getTime()}function r(){console.warn("XeCommandTimeReporter::onDoneDefault callback out of use")}function n(e){a.values.command_start_up_responce_timestamp||(a.values.command_start_up_responce_timestamp=i(),a.areFinishEventsDone()&&(a.values.last_time=i(),a.preventOnDone||a.onDone()))}function o(e){a.values.xe_drawing_engine_proc_time+=e.data.process_time}function s(e){0===a.values.websocket_in_first_data_receive_ts&&(a.values.websocket_in_first_data_receive_ts=e.data.timestamp),a.values.websocket_in_last_data_receive_ts=e.data.timestamp,a.values.websocket_in_bytes+=e.data.bytes}function c(e){a.values.websocket_out_bytes+=e.data.bytes}function l(e){u.hasOwnProperty(e.type)&&"call_action"===d[e.type]?u[e.type](e):d[e.type]||(d[e.type]=i(),u.hasOwnProperty(e.type)&&u[e.type](e),a.areFinishEventsDone()&&(a.values.last_time=i(),a.preventOnDone||a.onDone()))}a.addEventListeners=function(){},a.removeEventListeners=function(){},a.logo_txt="XeCommandTimeReporter",a.tooltip_txt="Press avaible button to check statistics ...",a.updateLogo(),a.addButton("Run REGEN Cmd",function(){a.make_cmd_regen_test()}),a.out=function(){var e=a.values,t=arguments[0],i=arguments[1],r=e.command_start_up_responce_timestamp-e.button_press_timestamp,n=e.websocket_in_last_data_receive_ts-e.websocket_in_first_data_receive_ts,o=e.last_time-e.button_press_timestamp;a.data=[],a.data.push({desc:"Command",value:e.cmd_line,units:null},{desc:"Command start up lag (has eval_time + 1st ws msg time)",value:r,units:"ms"},{desc:"Client proc time due command",value:e.xe_drawing_engine_proc_time,units:"ms"},{desc:"Transfer time by WebSocket due command (witout 1st ws msg)",value:n,units:"ms"},{desc:"Full time for command ( from client call - up to last entity)",value:o,units:"ms"},{desc:"Data IN by WebSocket due command",value:(e.websocket_in_bytes/1048576).toFixed(3),units:"Mb"},{desc:"Data IN rate by WebSocket due command ",value:(e.websocket_in_bytes/(n/1e3*1024)).toFixed(3),units:"Kb/sec"},{desc:"Data FULL by WebSocket due command",value:((e.websocket_in_bytes+e.websocket_out_bytes)/1048576).toFixed(3),units:"Mb"},{desc:'Full redraw ( gl + gdi ) on "'+e.cmd_line+'" time',value:i,units:"ms"},{desc:'Full server "'+e.cmd_line+'" time',value:t,units:"ms"}),a.draw()},a.values={cmd_line:0,button_press_timestamp:0,command_start_up_responce_timestamp:0,xe_drawing_engine_proc_time:0,last_time:0,websocket_in_bytes:0,websocket_in_first_data_receive_ts:0,websocket_in_last_data_receive_ts:0,websocket_out_bytes:0,websocket_in_rate:0},a.onDone=r,a.preventOnDone=!1,a.runTest=function(e){for(var t in document.addEventListener("Update_XeCommandProcessor",n),document.addEventListener("WT_WS_DATAIN_LOG",s,!1),document.addEventListener("WT_WS_DATAOUT_LOG",c,!1),document.addEventListener("XeDrawingEngineProc",o,!1),d)d.hasOwnProperty(t)&&document.addEventListener(t,l);a.values.cmd_line=e,a.values.button_press_timestamp=i(),a.values.last_time=i(),window.getXeActiveDocument().RunCmd(e)},a.report=function(){var e="",t=a.values,i=t.command_start_up_responce_timestamp-t.button_press_timestamp,r=t.websocket_in_last_data_receive_ts-t.websocket_in_first_data_receive_ts;return(e+='Command                                                       : "'+t.cmd_line+'"\n')+("Command start up lag (has eval_time + 1st ws msg time)        : "+i+" ms\n")+("Client  proc time due command                                 : "+t.xe_drawing_engine_proc_time+" ms\n")+("Transfer time by WebSocket due command (witout 1st ws msg)    : "+r+" ms\n")+("Full time for command ( from client call - up to last entity) : "+(t.last_time-t.button_press_timestamp)+" ms\n")+("Data IN by WebSocket due command                              : "+(t.websocket_in_bytes/1048576).toFixed(3)+" Mb\n")+("Data IN rate by WebSocket due command                         : "+(t.websocket_in_bytes/(r/1e3*1024)).toFixed(3)+" Kb/sec\n")+("Data FULL by WebSocket due command                            : "+((t.websocket_in_bytes+t.websocket_out_bytes)/1048576).toFixed(3)+" Mb\n")},a.areFinishEventsDone=function(){for(var e in d)if(d.hasOwnProperty(e)&&!d[e])return!1;return!0},a.finish_by_event=function(e,t){t=!!t&&"call_action";d[e]=t},a.action_by_event=function(e,t){u[e]=t},a.reset=function(){for(var e in a.onDone=r,a.preventOnDone=!1,document.removeEventListener("Update_XeCommandProcessor",n),document.removeEventListener("WT_WS_DATAIN_LOG",s,!1),document.removeEventListener("WT_WS_DATAOUT_LOG",c,!1),document.removeEventListener("XeDrawingEngineProc",o,!1),d)d.hasOwnProperty(e)&&document.removeEventListener(e,l);for(var t in d={},u={},a.values)a.values.hasOwnProperty(t)&&(a.values[t]=0)},a.getEventTimestamps=function(){return d};var d={},u={};a.run_simple_cmd_test=function(e){a.reset(),a.onDone=function(){var e=(e="--------------------------------------------------------------\n")+a.report()+"--------------------------------------------------------------\n";a.out?a.out("not captured","not captured"):console.log(e),a.reset()},a.runTest(e)},a.make_cmd_regen_test=function(){var i=0,r=0,n=0;a.reset(),a.preventOnDone=!0,a.finish_by_event("XePerfEvent",!0),a.action_by_event("XePerfEvent",function(e){"command started - _REBUILD"===e.m_Name?r=e.m_Time:"lastentity"===e.m_Name&&(n=e.m_Time),0<r&&0<n&&(a.areFinishEventsDone()?a.onDone():a.preventOnDone=!1)}),a.finish_by_event("XeRedrawTimingEvent"),a.action_by_event("XeRedrawTimingEvent",function(e){e=e.data;i=e.CurrentTimings.gl_scene+e.CurrentTimings.gl_trackers+e.CurrentTimings.gdi_trackers+e.CurrentTimings.gdi_server_trackers}),a.finish_by_event("XeGsDevice_LastChunk"),a.finish_by_event("XeGsDevice_LastEntity"),a.onDone=function(){var e=n-r,t="--------------------------------------------------------------\n",t=(t=(t+=a.report())+("Full redraw ( gl + gdi ) on 'regen' time                      : "+i+"ms\n"))+("Full server 'regen' time                                      : "+e+"ms\n")+"--------------------------------------------------------------\n";a.out?a.out(e,i):console.log(t),a.reset()},a.runTest("regen")},this.applyPE()},XeDebugWidget=(XeCommandTimeReporter.prototype=Object.create(XeBaseWatcher.prototype),XeCommandTimeReporter.prototype.constructor=XeCommandTimeReporter,XeCommandTimeReporter.prototype.applyPE=function(){},function(){var o=this;if(window.hasOwnProperty("_xe_dbg_stat_wtchr")&&window._xe_dbg_stat_wtchr)return window._xe_dbg_stat_wtchr;window._xe_dbg_stat_wtchr=this,o.default_left=arguments[0]&&arguments[0][0]?arguments[0][0]:"110px",o.default_top=arguments[0]&&arguments[0][1]?arguments[0][1]:"42px",o.logo_txt="replace by watcher name",o.tooltip_txt="replace by your tooltip",o.updateLogo=function(){s.innerHTML=""},o.hide=function(){a&&(o.clearDiv(),o.setPosition("-99999px","-99999px"),o.updateLogo(),a=!1)},o.show=function(){a||(o.setPosition(o.default_left,o.default_top),a=!0,o.draw(),e.clientWidth<20&&(e.style.width="100px"))},o.clearDiv=function(){for(;s.hasChildNodes();)s.removeChild(s.lastChild)},o.data=[{desc:"XeRubberLinePointLagWatcher",func:function(){this.widget=this.widget||new XeRubberLinePointLagWatcher,this.widget.IsVisible()?this.widget.hide():this.widget.show()},widget:null},{desc:"XeFPSWatcher",func:function(){var e=window.getXeApplication().getDrawingEngine();e&&(this.widget=e.getStats(),this.widget)&&("none"!=this.widget.dom.style.display?this.widget.dom.style.display="none":this.widget.dom.style.display="")},widget:null},{desc:"XeMSWatcher",func:function(){this.widget=this.widget||new XeFPSWatcher,this.widget.IsVisible()?this.widget.hide():this.widget.show()},widget:null},{desc:"XeMemoryWatcher",func:function(){this.widget=this.widget||new XeMemoryWatcher,this.widget.IsVisible()?this.widget.hide():this.widget.show()},widget:null},{desc:"XeGLDrawElementsWatcher",func:function(){this.widget=this.widget||new XeGLDrawElementsWatcher,this.widget.IsVisible()?this.widget.hide():this.widget.show()},widget:null},{desc:"XeTimingWatcher",func:function(){this.widget=this.widget||new XeTimingWatcher,this.widget.IsVisible()?this.widget.hide():this.widget.show()},widget:null},{desc:"XeCommandTimeReporter",func:function(){this.widget=this.widget||new XeCommandTimeReporter,this.widget.IsVisible()?this.widget.hide():this.widget.show()},widget:null}],o.draw=function(){if(a){o.clearDiv();s.style.color="0xFFFFFF";var e=document.createElement("TABLE");e.style.width="100%";for(var t=0;t<o.data.length;t++){var i=e.insertRow(t),r=i.insertCell(0),i=i.insertCell(1),n=document.createElement("span"),r=(n.style.color="0x000000",n.textContent=o.data[t].desc,r.appendChild(n),document.createElement("input"));r.setAttribute("type","checkbox"),r.onchange=o.data[t].func,i.appendChild(r)}s.appendChild(e)}};var a=!(o.IsVisible=function(){return a}),i=(o.setPosition=function(e,t){i.style.left=e,i.style.top=t},document.createElement("div")),e=(i.style.position="absolute",i.style.top="-99999px",i.style.left="-99999px",i.style.zIndex="100",i.style.width="auto",i.innerHTML="",document.createElement("div")),s=(e.style.width="auto",e.style.height="28px",e.style.backgroundColor="#F3F3F3",e.style.border="1px solid #000000",e.innerHTML="",document.createElement("div"));i.style.width="auto",s.innerHTML="",new WT_Jquery_DraggableFix(e,i,!1),o.updateLogo(),i.appendChild(e),i.appendChild(s),document.body.appendChild(i)}),XeFPSWatcher=function(){if(XeBaseWatcher.call(this,arguments),window.hasOwnProperty("_xe_fps_wtchr")&&window._xe_fps_wtchr)return window._xe_fps_wtchr;var t=window._xe_fps_wtchr=this;function e(e){t.IsVisible()&&(e=e.data,t.data[0].value=e.CurrentTimings.gl_scene,t.data[1].value=e.CurrentTimings.gl_scene+e.CurrentTimings.gl_trackers+e.CurrentTimings.gdi_trackers+e.CurrentTimings.gdi_server_trackers,t.data[2].value=Math.round(e.AverageTimings.gl_scene),t.data[3].value=Math.round(e.AverageTimings.gl_scene+e.AverageTimings.gl_trackers+e.AverageTimings.gdi_trackers+e.AverageTimings.gdi_server_trackers),t.data[4].value=e.MaxTimings.gl_scene,t.data[5].value=e.MaxTimings.gl_scene+e.MaxTimings.gl_trackers+e.MaxTimings.gdi_trackers+e.MaxTimings.gdi_server_trackers,t.draw())}t.logo_txt="XeFPSWatcher",t.tooltip_txt="gathering statistics, please wait...",t.updateLogo(),t.data=[{desc:"Current gl_scene redraw",value:0,units:"ms"},{desc:"Current full redraw",value:0,units:"ms"},{desc:"Average gl_scene redraw",value:0,units:"ms"},{desc:"Average full redraw",value:0,units:"ms"},{desc:"Max full redraw",value:0,units:"ms"},{desc:"Max full redraw",value:0,units:"ms"}],t.addEventListeners=function(){document.addEventListener("XeRedrawTimingEvent",e,!1)},t.removeEventListeners=function(){document.removeEventListener("XeRedrawTimingEvent",e,!1)}},XeGLDrawElementsWatcher=(XeFPSWatcher.prototype=Object.create(XeBaseWatcher.prototype),XeFPSWatcher.prototype.constructor=XeFPSWatcher,function(){if(XeBaseWatcher.call(this,arguments),window.hasOwnProperty("_xe_gl_elmts_wtchr")&&window._xe_gl_elmts_wtchr)return window._xe_gl_elmts_wtchr;var n=window._xe_gl_elmts_wtchr=this;function e(e){if(n.IsVisible()){var t,i,r=e.data;for(t in n.data=[],r)r.hasOwnProperty(t)&&(i=r[t])&&n.data.push({desc:"GL DATA FOR VP num",value:t,units:"-----------------"},{desc:"gl draw calls",value:i.gldrawcalls,units:null},{desc:"gl points drawn",value:i.points,units:null},{desc:"gl lines drawn",value:i.lines,units:null},{desc:"gl triangles drawn",value:i.triangles,units:null});n.draw()}}n.logo_txt="XeGLDrawCountInfo",n.tooltip_txt="gathering statistics, please wait...",n.updateLogo(),n.data=[{desc:"Will be dynamically performed by each XeGLDrawCountInfoEvent",value:null,units:null}],n.addEventListeners=function(){document.addEventListener("XeGLDrawCountInfoEvent",e,!1)},n.removeEventListeners=function(){document.removeEventListener("XeGLDrawCountInfoEvent",e,!1)}}),XeMemoryWatcher=(XeGLDrawElementsWatcher.prototype=Object.create(XeBaseWatcher.prototype),XeGLDrawElementsWatcher.prototype.constructor=XeGLDrawElementsWatcher,function(){if(XeBaseWatcher.call(this,arguments),window.hasOwnProperty("_xe_mmr_wtchr")&&window._xe_mmr_wtchr)return window._xe_mmr_wtchr;var n=window._xe_mmr_wtchr=this;function e(e){var t,i,r;n.IsVisible()&&(r=n.getMemoryData())&&(t=r.jsHeapSizeLimit,i=r.totalJSHeapSize,r=r.usedJSHeapSize,n.data[1].value=Math.round(t/1048576),n.data[2].value=Math.round(i/1048576),n.data[3].value=Math.round(r/1048576),n.data[4].value=Math.round(r/i*100),n.data[5].value=Math.round(i/t*100),n.draw())}n.logo_txt="XeMemoryWatcher",n.tooltip_txt="You should start up chrome with --args --enable-precise-memory-info to see an actual result",n.updateLogo(),n.data=[{desc:"You should start up chrome with --args --enable-precise-memory-info to see an actual result ",value:"----",units:"----"},{desc:"Memory the JavaScript heap is limited to ",value:0,units:"Mb (jsHeapSizeLimit)"},{desc:"Memory allocated on the JavaScript heap (includes free space) ",value:0,units:"Mb (totalJSHeapSize)"},{desc:"Memory currently being used",value:0,units:"Mb (usedJSHeapSize)"},{desc:"Allocated Memory Used",value:0,units:"%"},{desc:"Crash Index (% of Heap Limit Allocated)",value:0,units:"%"}],n.getMemoryData=function(){var e=window.performance&&window.performance.memory?window.performance.memory:null;return e?{jsHeapSizeLimit:e.jsHeapSizeLimit,totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}:null},n.addEventListeners=function(){document.addEventListener("XeRedrawTimingEvent",e,!1),document.addEventListener("XeClientStateUpdated",e,!1),document.addEventListener("XeGsDevice_LastChunk",e,!1),document.addEventListener("XeGsDevice_LastEntity",e,!1)},n.removeEventListeners=function(){document.removeEventListener("XeRedrawTimingEvent",e,!1),document.removeEventListener("XeClientStateUpdated",e,!1),document.removeEventListener("XeGsDevice_LastChunk",e,!1),document.removeEventListener("XeGsDevice_LastEntity",e,!1)}}),CXePerfStat=(XeMemoryWatcher.prototype=Object.create(XeBaseWatcher.prototype),XeMemoryWatcher.prototype.constructor=XeMemoryWatcher,function(){var a=this;a.gpu="",a.totalWsTraffic=0,a.activityLog=[],a.initialTimestamp=(new Date).getTime(),a.flushCount=50,a.timeout_time=1e4,a.enableLog=!0,a.logOpenTimes=!0,a.persistent_values={sz_gl_memory:0},a.enable=function(){a.enableLog=!0},a.disable=function(){a.enableLog=!1},a.timestamp=function(e){return(new Date).getTime()},a.perfToTimestamp=function(e){return e>=a.initialTimestamp?e:a.timestamp()-window.performance.now()+e},a.onWebsocketMessage=function(e){a.closeActivity();var t=a.getActivity();t.sz_WSin=e.data.bytes,t.ts_WSin=e.data.timestamp,t.acts=[],a.totalWsTraffic+=e.data.bytes},a.onWebsocketSend=function(e){a.closeActivity();var t=a.getActivity();t.sz_WSout=e.data.bytes,t.ts_WSout=e.data.timestamp,t.acts=[],a.totalWsTraffic+=e.data.bytes},a.getActivity=function(){return void 0===a.lastActivity&&(a.lastActivity={acts:[]}),a.lastActivity.sz_gl_memory=a.persistent_values.sz_gl_memory,a.flushTimeout&&clearTimeout(a.flushTimeout),a.flushTimeout=setTimeout(a.flushActivityLog,a.timeout_time),a.lastActivity},a.closeActivity=function(){var e;void 0!==a.lastActivity&&(e=a.lastActivity,a.activityLog.push(e)),a.lastActivity=void 0,a.activityLog.length>a.flushCount&&a.flushActivityLog()},a.flushActivityLog=function(){var e;a.activityLog.length&&(a.enableLog&&(e=JSON.stringify(a.activityLog),window.getXeApplication().PerfLog(e)),a.activityLog=[])},a.OnXeWebGlRendererInit=function(e){var t=a.getActivity(),e=(t.ts_webgl_init=e.timestamp,e.data);a.gpu=e.gpu,t.xe_webgl_init={log:e.log,gpu:e.gpu,error:e.error},a.closeActivity()},a.OnRedrawComplete=function(e){var t=a.getActivity(),e=(t.ts_redraw=e.timestamp,e.data);t.xe_redraw_average_timing={gpu:a.gpu,gl_scene:e.AverageTimings.gl_scene,gl_trackers:e.AverageTimings.gl_trackers,gdi_trackers:e.AverageTimings.gdi_trackers,gdi_server_trackers:e.AverageTimings.gdi_server_trackers},a.closeActivity()},a.OnGLDrawCountInfoEvent=function(e){var t,i,r=a.getActivity(),n=e.data,o=0;for(t in n)n.hasOwnProperty(t)&&(i=n[t])&&(o+=i.gl_attr_mem_used+i.gl_unif_mem_used);a.persistent_values.sz_gl_memory=o,r.sz_gl_memory=a.persistent_values.sz_gl_memory},a.OnClientStateUpdated=function(){var e=a.getActivity(),t=(e.ts_clientStateU=a.timestamp(),window.getXeApplication().getPerfId());t&&""!==t&&e.acts.push(t)},document.addEventListener("XeGsDevice_LastChunk",function(e){a.getActivity().ts_lastChunk=a.timestamp()}),document.addEventListener("XeGsDevice_LastEntity",function(e){a.getActivity().ts_lastEntity=a.timestamp()}),document.addEventListener("XeClientStateUpdated",a.OnClientStateUpdated,!1),document.addEventListener("XeRedrawTimingEvent",a.OnRedrawComplete,!1),document.addEventListener("XeWebGlRendererInitEvent",a.OnXeWebGlRendererInit,!1),document.addEventListener("XeGLDrawCountInfoEvent",a.OnGLDrawCountInfoEvent,!1),document.addEventListener("WT_WS_DATAIN_LOG",a.onWebsocketMessage,!1),document.addEventListener("WT_WS_DATAOUT_LOG",a.onWebsocketSend,!1),a.onOSC=function(e){a.logOpenTimes&&e&&"stopLoadingSpinner"===e._m&&(e={message:e._m,time:Math.round(window.performance.now()),web_socket:a.totalWsTraffic,gl_memory:a.persistent_values.sz_gl_memory},window.getXeApplication().JsMessageProxy(["OsLoadStatistics",JSON.stringify(e)]))},window.addEventListener("ospstm",a.onOSC,!1)}),XeRubberLinePointLagWatcher=($(function(){var a=!1,s=!1,c=null;let l={},d={timestamp:(new Date).getTime(),bPan:!1,fpsMesuarmentsArray:[],avgPan:0},u=(window.getTrackJs().then(e=>{s=e,window.TrackJS.addMetadata("browser",XeUtils.UserAgentDetector.browser+" "+XeUtils.UserAgentDetector.browserVersion),window.TrackJS.addMetadata("mobile",XeUtils.UserAgentDetector.mobile),window.TrackJS.addMetadata("os",XeUtils.UserAgentDetector.os+" "+XeUtils.UserAgentDetector.osVersion),window.TrackJS.addMetadata("screen",XeUtils.UserAgentDetector.screen),window.TrackJS.addMetadata("devicePixelRatio",window.devicePixelRatio)}),document.addEventListener("XeWebDrawerEngine.setPan",function(e){e=e.data;if(d.bPan!=e.bPan){var r=(new Date).getTime()-d.timestamp;d.timestamp=(new Date).getTime();let t=window.getXeApplication().getDrawingEngine(),i=(d.bPan=e.bPan,d.handleTimeout&&clearTimeout(d.handleTimeout),d.handleInterval&&clearTimeout(d.handleInterval),d.handleTimeout=0,d.handleInterval=0,d.fpsMesuarmentsArray);if(0<i.length){let t=0;for(let e=0;e<i.length;e++)t+=i[e];d.avgPan=t/i.length}if(500<i.length&&(d.fpsMesuarmentsArray=[],i=d.fpsMesuarmentsArray),d.bPan)d.handleTimeout=setTimeout(()=>{d.handleInterval=setInterval(()=>{var e=t.getStats();e&&(e=e.getCurrentFPS(),i.push(e))},200)},200);else{for(var n in d.avgPan.toFixed(2),l)n,l[n];if((u.bytes/1048576).toFixed(2),s&&150<r&&window.TrackJS){for(var o in l)window.TrackJS.addMetadata("glDrawCountInfo."+o,l[o]);window.TrackJS.addMetadata("AVG PAN FPS ",d.avgPan.toFixed(2)+" Mb"),window.TrackJS.addMetadata("Downloaded data",(u.bytes/1048576).toFixed(2)+" Mb"),!a&&c&&(window.TrackJS.addMetadata("webgl",c.webgl),window.TrackJS.addMetadata("gpu",c.gpu),a=!0),30<d.avgPan?window.TrackJS.console.info("PAN LOG : 30 < FPS < 60"):20<d.avgPan?window.TrackJS.console.info("PAN LOG : 20 < FPS < 30"):10<d.avgPan?window.TrackJS.console.log("PAN LOG : 10 < FPS < 20"):0<d.avgPan&&window.TrackJS.console.warn("PAN LOG : 0 < FPS < 10")}}}},!1),document.addEventListener("XeWebGlRendererInitEvent",function(e){c=e.data},!1),document.addEventListener("XeGLDrawCountInfoEvent",function(e){var t,i,r=e.data;for(t in l.gl_memory_summ=0,l.gl_draw_calls=0,l.gl_points=0,l.gl_lines=0,l.gl_triangles=0,l.gl_instanced_points=0,l.gl_instanced_lines=0,l.gl_instanced_triangles=0,r)r.hasOwnProperty(t)&&(i=r[t])&&(l.gl_memory_summ+=i.gl_attr_mem_used+i.gl_unif_mem_used,l.gl_draw_calls+=i.gldrawcalls,l.gl_points+=i.points,l.gl_lines+=i.lines,l.gl_triangles+=i.triangles,l.gl_instanced_points+=i.instanced_points,l.gl_instanced_lines+=i.instanced_lines,l.gl_instanced_triangles+=i.instanced_triangles)},!1),{bytes:0});document.addEventListener("WT_WS_DATAIN_LOG",function(e){u.bytes+=e.data.bytes},!1),document.addEventListener("XeRedrawTimingEvent",function(e){if(s&&c){e=e.data.AverageTimings;if(a||(window.TrackJS.addMetadata("webgl",c.webgl),window.TrackJS.addMetadata("gpu",c.gpu),a=!0),window.TrackJS)if(1e3<e.gl_scene){for(var t in l)window.TrackJS.addMetadata("glDrawCountInfo."+t,l[t]);window.TrackJS.addMetadata("Downloaded data",(u.bytes/1048576).toFixed(2)+" Mb"),window.TrackJS.console.warn("FPS LOW. gl scene redraw takes more than 1 sec")}else if(200<e.gl_scene){for(var i in l)window.TrackJS.addMetadata("glDrawCountInfo."+i,l[i]);window.TrackJS.addMetadata("Downloaded data",(u.bytes/1048576).toFixed(2)+" Mb"),window.TrackJS.console.warn("FPS LOW. gl scene redraw takes more than 200 ms")}}},!1)}),function(){if(XeBaseWatcher.call(this,arguments),window.hasOwnProperty("_xe_rb_wtchr")&&window._xe_rb_wtchr)return window._xe_rb_wtchr;var i=window._xe_rb_wtchr=this,r=(i.logo_txt="XeRubberLinePointLagWatcher",i.tooltip_txt="gathering statistics, please wait...",i.updateLogo(),i.data=[{desc:"Will be dynamically performed",value:null,units:null}],{}),s={};function e(e){var t,i,r=(new Date).getTime(),n=e.data.id,o=e.data.full_time,a=e.data.objmodel_time,e=e.data.trackers_time,n=XeUniqueStatId.get(n);n&&(t=n.ts,s[n=n.type]?(i=s[n].count,++s[n].count,s[n].avg=(s[n].avg*i+r-t)/s[n].count,s[n].avg_server_full_time=(s[n].avg_server_full_time*i+o)/s[n].count,s[n].avg_objmodel_time=(s[n].avg_objmodel_time*i+a)/s[n].count,s[n].avg_trackers_time=(s[n].avg_trackers_time*i+e)/s[n].count):s[n]={avg:r-t,avg_server_full_time:o,avg_objmodel_time:a,avg_trackers_time:e,count:1},c())}function t(e){var t,i;r[e.data.chunk.getTrackerName()]?(t=r[e.data.chunk.getTrackerName()].avg,i=r[e.data.chunk.getTrackerName()].count,++r[e.data.chunk.getTrackerName()].count,r[e.data.chunk.getTrackerName()].avg=(t*i+e.data.process_time)/r[e.data.chunk.getTrackerName()].count):r[e.data.chunk.getTrackerName()]={avg:e.data.process_time,count:1},c()}function c(){if(i.IsVisible()){for(var e in i.data=[],i.data.push({desc:"----- Low level events average responce timings -----",value:"-----",units:"-----"}),s)s.hasOwnProperty(e)&&s[e]&&i.data.push({desc:e+" event time (avg)",value:s[e].avg.toFixed(2),units:"ms"},{desc:e+" server (from event recieve, before sending back) time (avg)",value:s[e].avg_server_full_time.toFixed(2),units:"ms"},{desc:e+" UpdateScene, UpdateClientState time (avg)",value:s[e].avg_trackers_time.toFixed(2),units:"ms"},{desc:e+" UpdateObjectModel time (avg)",value:s[e].avg_objmodel_time.toFixed(2),units:"ms"},{desc:e+" event count",value:s[e].count,units:""});for(var t in i.data.push({desc:"----- Trackers draw timings-----",value:"-----",units:"-----"}),r)r.hasOwnProperty(t)&&r[t]&&i.data.push({desc:"Creation "+t+" time (avg)",value:r[t].avg.toFixed(2),units:"ms"},{desc:t+" tracker chunks count",value:r[t].count,units:""});i.draw()}}i.addButton("Clear",function(){r={},s={},i.data=[{desc:'Will be dynamically performed by each "XeDrawingEngineProc-TrackerChunk" event',value:null,units:null}],i.IsVisible()&&i.draw()}),i.addEventListeners=function(){document.addEventListener("XeDrawingEngineProc-TrackerChunk",t,!1),document.addEventListener("XeUniqueStatId_ANSW",e,!1)},i.removeEventListeners=function(){document.removeEventListener("XeDrawingEngineProc-TrackerChunk",t,!1),document.removeEventListener("XeUniqueStatId_ANSW",e,!1)}}),XeTimingWatcher=(XeRubberLinePointLagWatcher.prototype=Object.create(XeBaseWatcher.prototype),XeRubberLinePointLagWatcher.prototype.constructor=XeRubberLinePointLagWatcher,function(){if(XeBaseWatcher.call(this,arguments),window.hasOwnProperty("_xe_tmgs_wthcr")&&window._xe_tmgs_wthcr)return arguments&&window._xe_tmgs_wthcr.setPosition(arguments[0],arguments[1]),window._xe_tmgs_wthcr;var r=window._xe_tmgs_wthcr=this;function e(){return(new Date).getTime()}r.logo_txt="XeTimingWatcher",r.tooltip_txt="gathering statistics, please wait...",r.updateLogo();var t=e();function i(){r.data=[{desc:"First redraw happens after",value:null,units:"sec of xe scripts started"},{desc:"Last  chunk  happens after",value:null,units:"sec of xe scripts started"},{desc:"Last  entity happens after",value:null,units:"sec of xe scripts started"},{desc:"Full socket data in ",value:null,num:0,units:"Mb"},{desc:"Full socket data out ",value:null,num:0,units:"Mb"},{desc:"Full socket data exchange",value:0,units:"Mb"},{desc:"Wt handleResponse func full time",value:0,units:"msec"},{desc:"Wt handleResponse func avg time",value:0,units:"msec",avg:0,count:0},{desc:"Client proc full time",value:0,units:"msec"},{desc:"Client proc avg time",value:0,units:"msec",avg:0,count:0}]}function n(){null===r.data[0].value&&(r.data[0].value=((e()-t)/1e3).toFixed(2),r.IsVisible())&&r.draw()}function o(){r.data[1].value=((e()-t)/1e3).toFixed(2),r.IsVisible()&&r.draw()}function a(){r.IsVisible()&&(r.data[2].value=((e()-t)/1e3).toFixed(2),r.draw())}function s(e){r.data[3].num+=e.data.bytes/1048576,r.data[3].value=r.data[3].num.toFixed(3),r.data[5].value=(r.data[3].num+r.data[4].num).toFixed(3),r.IsVisible()&&r.draw()}function c(e){r.data[4].num+=e.data.bytes/1048576,r.data[4].value=r.data[4].num.toFixed(3),r.data[5].value=(r.data[3].num+r.data[4].num).toFixed(3),r.IsVisible()&&r.draw()}function l(e){r.data[6].value+=e.data.time;var t=r.data[7],i=t.count++;t.avg=(t.avg*i+e.data.time)/t.count,t.value=t.avg.toFixed(2),r.IsVisible()&&r.draw()}function d(e){r.data[8].value+=e.data.process_time;var t=r.data[9],i=t.count++;t.avg=(t.avg*i+e.data.process_time)/t.count,t.value=t.avg.toFixed(2),r.IsVisible()&&r.draw()}r.addButton("Clear",i),i(),r.addEventListeners=function(){document.addEventListener("XeRedrawTimingEvent",n,!1),document.addEventListener("XeGsDevice_LastChunk",o,!1),document.addEventListener("XeGsDevice_LastEntity",a,!1),document.addEventListener("WT_WS_DATAIN_LOG",s,!1),document.addEventListener("WT_WS_DATAOUT_LOG",c,!1),document.addEventListener("WT_WS_HANDLERESPONCE",l,!1),document.addEventListener("XeDrawingEngineProc",d,!1)},r.removeEventListeners=function(){document.removeEventListener("XeRedrawTimingEvent",n,!1),document.removeEventListener("XeGsDevice_LastChunk",o,!1),document.removeEventListener("XeGsDevice_LastEntity",a,!1),document.removeEventListener("WT_WS_DATAIN_LOG",s,!1),document.removeEventListener("WT_WS_DATAOUT_LOG",c,!1),document.removeEventListener("WT_WS_HANDLERESPONCE",l,!1),document.removeEventListener("XeDrawingEngineProc",d,!1)}}),x=(XeTimingWatcher.prototype=Object.create(XeBaseWatcher.prototype),XeTimingWatcher.prototype.constructor=XeTimingWatcher,window.hasOwnProperty("_xe_tmgs_wthcr")&&window._xe_tmgs_wthcr||(window._xe_tmgs_wthcr=new XeTimingWatcher),XeCommandTimeReporter.prototype.applyPE=function(){var e=this,t=e.out.bind(this);e.addButton("OSLOAD",function(){e.make_onshape_cmd_test("_OSLOAD","OsViewsUpload::Begin","OsViewsUpload::End",!0)}),e.addButton("OSSHOWHIDDENLINE",function(){e.make_onshape_cmd_test("_OSSHOWHIDDENLINE","OsHiddenLineUpload::Begin","OsHiddenLineUpload::End",!0)}),e.addButton("RESET WIDGET",function(){e.out=t,e.reset(),e.updateLogo()}),e.logo_txt="XeCommandTimeReporter Onshape PE",e.tooltip_txt="Press avaible button to check statistics ...</br></br>For OSSHOWHIDDENLINE command - select object(s) first",e.updateLogo()},XeCommandTimeReporter.prototype.make_onshape_cmd_test=function(e,o,a,s){var c=this,l={},d=0,u=0,i=0,p=0;c.reset();var t=c.out.bind(this);function m(){document.removeEventListener("XeGsDevice_LastEntity",m,!1),i=(new Date).getTime(),c.onDone()}c.out=function(){var e,t=c.values;for(e in c.data=[],c.data.push({desc:"Command",value:t.cmd_line,units:null},{desc:"Command startup responce time ",value:u,units:"ms"}),l)if(l.hasOwnProperty(e)){if(!l[e].updated)return!1;c.data.push({desc:"OS VIEW "+e+" server upload time",value:l[e].server_upload_time,units:"ms"})}c.data.push({desc:"Data FULL by WebSocket due command",value:((t.websocket_in_bytes+t.websocket_out_bytes)/1048576).toFixed(3),units:"Mb"},{desc:"Gs data transfer and apply on client done by ",value:i-p,units:"ms"},{desc:"Full cmd time (by last entity )",value:i-d,units:"ms"}),c.draw()},c.preventOnDone=!0,c.finish_by_event("osviewinfo",!0),c.action_by_event("osviewinfo",function(e){if(e.name===o){0===u&&(u=(new Date).getTime()-d);var t,i=e.data;for(t in i)i.hasOwnProperty(t)&&(l[t]={updated:!1,server_timestamp:i[t],server_upload_time:0})}else if(e.name===a){p=(new Date).getTime();var r,n=e.data;for(r in n)n.hasOwnProperty(r)&&l.hasOwnProperty(r)?(l[r].server_upload_time=n[r]-l[r].server_timestamp,l[r].updated=!0):l.hasOwnProperty(r)||window.XeLogger.warn("XeCommandTimeReporter.prototype.make_cmd_osload_test : os view is not registered")}(()=>{for(var e in l)if(l.hasOwnProperty(e)&&!l[e].updated)return;return 1})()&&(s?document.addEventListener("XeGsDevice_LastEntity",m,!1):c.onDone())}),c.onDone=function(){c.out(),c.out=t,l={},p=u=d=i=0,c.reset()},d=(new Date).getTime(),c.runTest(e)},window.XePerfStat=new CXePerfStat,"110px"),y="42px",fps,memory,elements,timing,rb_lag,command_time_reporter;!bEnableAllGlDebugLog&&"true"!==getURLQueryParams("js-watchers")||(fps=new XeFPSWatcher(x,y),fps.show(),x="530px",y="404px",memory=new XeMemoryWatcher("110px","236px"),memory.show(),elements=new XeGLDrawElementsWatcher("110px","404px"),elements.show(),timing=new XeTimingWatcher("330px","42px"),timing.show(),rb_lag=new XeRubberLinePointLagWatcher("330px","404px"),rb_lag.show()),"true"===getURLQueryParams("xe-regen-reporter")&&(command_time_reporter=new XeCommandTimeReporter(x,y),command_time_reporter.show()),x=void 0,y=void 0;
//# sourceMappingURL=app.min.js.map